<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=latin1">
  <style type="text/css">
td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }
body .hll { background-color: #ffffcc }
body  { background: #f8f8f8; }
body .c { color: #408080; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #008000; font-weight: bold } /* Keyword */
body .o { color: #666666 } /* Operator */
body .cm { color: #408080; font-style: italic } /* Comment.Multiline */
body .cp { color: #BC7A00 } /* Comment.Preproc */
body .c1 { color: #408080; font-style: italic } /* Comment.Single */
body .cs { color: #408080; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #FF0000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #00A000 } /* Generic.Inserted */
body .go { color: #888888 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #008000 } /* Keyword.Pseudo */
body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #BA2121 } /* Literal.String */
body .na { color: #7D9029 } /* Name.Attribute */
body .nb { color: #008000 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #999999; font-weight: bold } /* Name.Entity */
body .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #A0A000 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #19177C } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sb { color: #BA2121 } /* Literal.String.Backtick */
body .sc { color: #BA2121 } /* Literal.String.Char */
body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #BA2121 } /* Literal.String.Double */
body .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #BA2121 } /* Literal.String.Heredoc */
body .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #BB6688 } /* Literal.String.Regex */
body .s1 { color: #BA2121 } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #008000 } /* Name.Builtin.Pseudo */
body .vc { color: #19177C } /* Name.Variable.Class */
body .vg { color: #19177C } /* Name.Variable.Global */
body .vi { color: #19177C } /* Name.Variable.Instance */
body .il { color: #666666 } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><pre><span class="c1">-- -*- haskell -*-</span>

<span class="c1">-- @@PLEAC@@_NAME</span>
<span class="c1">-- @@SKIP@@ Haskell</span>

<span class="c1">-- @@PLEAC@@_WEB</span>
<span class="c1">-- @@SKIP@@ http://www.haskell.org/</span>

<span class="c1">-- @@PLEAC@@_INTRO</span>
<span class="c1">-- @@SKIP@@ Please see http://haskell.org/haskellwiki/Cookbook for a more Haskell centered cookbook</span>

<span class="c1">-- @@PLEAC@@_1.0</span>
<span class="nf">str</span>  <span class="ow">=</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">n&quot;</span>                             <span class="c1">-- two characters, \ and an n</span>
<span class="nf">str2</span> <span class="ow">=</span> <span class="s">&quot;Jon &#39;Maddog&#39; Orwant&quot;</span>             <span class="c1">-- in haskell we can do string only with &quot;, no single quote</span>
<span class="nf">str3</span> <span class="ow">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>                              <span class="c1">-- a &quot;newline&quot; character</span>
<span class="nf">str4</span> <span class="ow">=</span> <span class="s">&quot;Jon </span><span class="se">\&quot;</span><span class="s">Maddog</span><span class="se">\&quot;</span><span class="s"> Orwant&quot;</span>           <span class="c1">-- literal double quotes</span>
<span class="nf">str5</span> <span class="ow">=</span> <span class="s">&quot;Multiline string must use a backslash at end of line</span><span class="se">\n\</span>
<span class="se">\</span><span class="s">and a backslash at beginning of line</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="nf">str6</span> <span class="ow">=</span> <span class="s">&quot;It is a common practice</span><span class="se">\n\</span>
<span class="se">       \</span><span class="s">to indent lines</span><span class="se">\n\</span>
<span class="se">       \</span><span class="s">(the indentation doesn&#39;t change the value of the string)</span><span class="se">\n</span><span class="s">&quot;</span>

<span class="c1">-- @@PLEAC@@_1.1</span>
<span class="nf">groupNelem</span> <span class="n">n</span> <span class="ow">=</span> <span class="n">unfoldr</span> <span class="n">f</span>
    <span class="kr">where</span> <span class="n">f</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="kt">Nothing</span>
          <span class="n">f</span> <span class="n">s</span> <span class="ow">=</span> <span class="kt">Just</span> <span class="p">(</span><span class="n">splitAt</span> <span class="n">n</span> <span class="n">s</span><span class="p">)</span>

<span class="c1">-- split at five byte boundaries</span>
<span class="nf">fivers</span> <span class="ow">=</span> <span class="n">groupNelem</span> <span class="mi">5</span>

<span class="c1">-- chop string into individual characters:</span>
<span class="c1">-- nothing to do</span>

<span class="nf">s</span>     <span class="ow">=</span> <span class="s">&quot;This is what you have&quot;</span>
<span class="nf">first</span> <span class="ow">=</span> <span class="n">take</span> <span class="mi">1</span> <span class="n">s</span>                          <span class="c1">-- &quot;T&quot;</span>
<span class="nf">start</span> <span class="ow">=</span> <span class="n">take</span> <span class="mi">2</span> <span class="o">$</span> <span class="n">drop</span> <span class="mi">5</span> <span class="n">s</span>                 <span class="c1">-- &quot;is&quot;</span>
<span class="nf">rest</span>  <span class="ow">=</span> <span class="n">drop</span> <span class="mi">13</span> <span class="n">s</span>                         <span class="c1">-- &quot;you have&quot;</span>
<span class="nf">last&#39;</span> <span class="ow">=</span> <span class="n">last</span> <span class="n">s</span>                            <span class="c1">-- &#39;e&#39;</span>

<span class="kr">import</span> <span class="nn">Text.Regex</span>
<span class="nf">s</span> <span class="ow">=</span> <span class="s">&quot;This is what you have&quot;</span>

<span class="c1">-- strings are immutable</span>
<span class="nf">s2</span> <span class="ow">=</span> <span class="n">a</span> <span class="o">++</span> <span class="s">&quot;wasn&#39;t&quot;</span> <span class="o">++</span> <span class="n">drop</span> <span class="mi">2</span> <span class="n">b</span>
     <span class="kr">where</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">=</span> <span class="n">splitAt</span> <span class="mi">5</span> <span class="n">s</span>
<span class="nf">s3</span> <span class="ow">=</span> <span class="n">subRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot; is &quot;</span><span class="p">)</span> <span class="n">s</span> <span class="s">&quot; wasn&#39;t &quot;</span> <span class="c1">-- &quot;This wasn&#39;t what you have&quot;</span>

<span class="c1">-- substitute &quot;at&quot; for &quot;is&quot;, restricted to first five characters</span>
<span class="nf">s4</span> <span class="ow">=</span> <span class="n">a&#39;</span> <span class="o">++</span> <span class="n">b</span>
    <span class="kr">where</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">=</span> <span class="n">splitAt</span> <span class="mi">5</span> <span class="n">s</span>
          <span class="n">a&#39;</span> <span class="ow">=</span> <span class="n">subRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;is&quot;</span><span class="p">)</span> <span class="n">a</span> <span class="s">&quot;at&quot;</span>
<span class="c1">-- do it another way</span>
<span class="kr">import</span> <span class="nn">Text.Regex</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Control.Arrow</span> <span class="k">as</span> <span class="n">Arrow</span>
<span class="nf">f</span> <span class="ow">=</span> <span class="n">uncurry</span> <span class="p">(</span><span class="o">++</span><span class="p">)</span> <span class="o">.</span> <span class="kt">Arrow</span><span class="o">.</span><span class="n">first</span> <span class="n">subst</span> <span class="o">.</span> <span class="n">splitAt</span> <span class="mi">5</span>
    <span class="kr">where</span> <span class="n">subst</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">subRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;is&quot;</span><span class="p">)</span> <span class="n">s</span> <span class="s">&quot;at&quot;</span>

<span class="c1">-- unpack chars using parsec</span>
<span class="kr">import</span> <span class="nn">Text.ParserCombinators.Parsec</span>
<span class="nf">fromRight</span> <span class="p">(</span><span class="kt">Right</span> <span class="n">v</span><span class="p">)</span> <span class="ow">=</span> <span class="n">v</span>
<span class="nf">fromRight</span> <span class="n">v</span> <span class="ow">=</span> <span class="ne">error</span> <span class="p">(</span><span class="s">&quot;fromRight: &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">v</span><span class="p">)</span>
<span class="nf">parseStr</span> <span class="n">parser</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">fromRight</span> <span class="o">$</span> <span class="n">parse</span> <span class="n">parser</span> <span class="s">&quot;&quot;</span> <span class="n">s</span>
<span class="nf">nchars</span> <span class="n">n</span> <span class="ow">=</span> <span class="n">count</span> <span class="n">n</span> <span class="n">anyToken</span>

<span class="nf">a</span> <span class="ow">=</span> <span class="s">&quot;To be or not to be&quot;</span>
<span class="nf">b</span> <span class="ow">=</span> <span class="n">parseStr</span> <span class="p">(</span><span class="n">nchars</span> <span class="mi">6</span> <span class="o">&gt;&gt;</span> <span class="n">nchars</span> <span class="mi">6</span><span class="p">)</span> <span class="n">a</span> <span class="c1">-- &quot;or not&quot;</span>

<span class="c1">-- not same example as perl&#39;s unpack with &quot;X5&quot; which means &quot;back up a byte&quot;</span>
<span class="c1">-- here is an example using lookAhead where we start again at some point</span>
<span class="p">[</span><span class="n">b3</span><span class="p">,</span><span class="n">c3</span><span class="p">]</span> <span class="ow">=</span> <span class="n">parseStr</span> <span class="p">(</span><span class="n">sequence</span> <span class="p">[</span> <span class="n">lookAhead</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="p">])</span> <span class="n">a</span> <span class="c1">-- [&quot;or&quot;,&quot;be&quot;]</span>
          <span class="kr">where</span> <span class="n">p1</span> <span class="ow">=</span> <span class="n">nchars</span> <span class="mi">6</span> <span class="o">&gt;&gt;</span> <span class="n">nchars</span> <span class="mi">2</span>
                <span class="n">p2</span> <span class="ow">=</span> <span class="n">nchars</span> <span class="mi">3</span> <span class="o">&gt;&gt;</span> <span class="n">nchars</span> <span class="mi">2</span>


<span class="kr">import</span> <span class="nn">List</span>
<span class="nf">cut2fmt</span> <span class="n">l</span> <span class="ow">=</span> <span class="n">zipWith</span> <span class="p">(</span><span class="o">-</span><span class="p">)</span> <span class="n">l</span> <span class="p">(</span><span class="mi">1</span><span class="kt">:</span><span class="n">l</span><span class="p">)</span>
<span class="nf">applyfmt</span> <span class="n">fmt</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">l</span> <span class="o">++</span> <span class="p">[</span><span class="n">s&#39;</span><span class="p">]</span>
    <span class="kr">where</span> <span class="p">(</span><span class="n">s&#39;</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="ow">=</span> <span class="n">mapAccumL</span> <span class="n">f</span> <span class="n">s</span> <span class="n">fmt</span>
          <span class="n">f</span> <span class="n">s</span> <span class="n">n</span> <span class="ow">=</span> <span class="p">(</span><span class="n">s&#39;</span><span class="p">,</span><span class="n">subs</span><span class="p">)</span>
              <span class="kr">where</span> <span class="p">(</span><span class="n">subs</span><span class="p">,</span><span class="n">s&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">splitAt</span> <span class="n">n</span> <span class="n">s</span>

<span class="nf">fmt</span> <span class="ow">=</span> <span class="n">cut2fmt</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">30</span><span class="p">]</span> <span class="c1">-- [7,6,6,6,4]</span>
<span class="nf">l</span> <span class="ow">=</span> <span class="n">applyfmt</span> <span class="n">fmt</span> <span class="s">&quot;12345678912345678901234567890123456789&quot;</span> 
<span class="c1">-- 1234567 891234 567890 123456 7890 123456789</span>

<span class="c1">-- @@PLEAC@@_1.2</span>
<span class="c1">-- boolean operators only work on booleans</span>
<span class="nf">a</span> <span class="ow">=</span> <span class="n">b</span> <span class="o">||</span> <span class="n">c</span>

<span class="c1">-- if you have an optional value, use type Maybe</span>
<span class="kr">import</span> <span class="nn">Maybe</span>
<span class="nf">v1</span> <span class="ow">=</span> <span class="n">fromMaybe</span> <span class="s">&quot;b&quot;</span> <span class="o">$</span> <span class="kt">Just</span> <span class="s">&quot;a&quot;</span>   <span class="c1">-- &quot;a&quot;</span>
<span class="nf">v2</span> <span class="ow">=</span> <span class="n">fromMaybe</span> <span class="s">&quot;b&quot;</span> <span class="o">$</span> <span class="kt">Nothing</span>    <span class="c1">-- &quot;b&quot;</span>

<span class="c1">-- to combine Maybe values, you can use mplus</span>
<span class="kr">import</span> <span class="nn">Control.Monad</span> <span class="p">(</span><span class="nf">mplus</span><span class="p">)</span>

<span class="nf">v1&#39;</span> <span class="ow">=</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;a&quot;</span><span class="p">)</span> <span class="p">`</span><span class="n">mplus</span><span class="p">`</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;b&quot;</span><span class="p">)</span> <span class="c1">-- Just &quot;a&quot;</span>
<span class="nf">v2&#39;</span> <span class="ow">=</span> <span class="kt">Nothing</span> <span class="p">`</span><span class="n">mplus</span><span class="p">`</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;b&quot;</span><span class="p">)</span>    <span class="c1">-- Just &quot;b&quot;</span>

<span class="c1">-- you could also define some perlish things:</span>
<span class="kr">class</span> <span class="kt">Default_val</span> <span class="n">a</span> <span class="kr">where</span>
    <span class="n">default_val</span> <span class="ow">::</span> <span class="n">a</span>
    <span class="n">is_default_val</span> <span class="ow">::</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>

<span class="kr">instance</span> <span class="kt">Default_val</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="kr">where</span> 
    <span class="n">default_val</span> <span class="ow">=</span> <span class="kt">[]</span>
    <span class="n">is_default_val</span> <span class="ow">=</span> <span class="n">null</span>
<span class="kr">instance</span> <span class="kt">Default_val</span> <span class="kt">Num</span> <span class="kr">where</span> 
    <span class="n">default_val</span> <span class="ow">=</span> <span class="mi">0</span>
    <span class="n">is_default_val</span> <span class="ow">=</span> <span class="p">(</span><span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

<span class="nf">a</span> <span class="o">&amp;&amp;&amp;</span> <span class="n">b</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">a</span><span class="o">.</span><span class="n">is_default_val</span> <span class="kr">then</span> <span class="n">default_val</span> <span class="kr">else</span> <span class="n">b</span>
<span class="nf">a</span> <span class="o">|||</span> <span class="n">b</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">a</span><span class="o">.</span><span class="n">is_default_val</span> <span class="kr">then</span> <span class="n">b</span> <span class="kr">else</span> <span class="n">a</span>

<span class="nf">foo</span> <span class="ow">=</span> <span class="n">bar</span> <span class="o">|||</span> <span class="s">&quot;DEFAULT VALUE&quot;</span>

<span class="c1">--</span>
<span class="kr">import</span> <span class="nn">Maybe</span>
<span class="kr">import</span> <span class="nn">System</span>
<span class="nf">argv0</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="n">listToMaybe</span> <span class="n">getArgs</span>
<span class="nf">dir</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="p">(</span><span class="n">fromMaybe</span> <span class="s">&quot;/tmp&quot;</span><span class="p">)</span> <span class="n">argv0</span>

<span class="c1">-- or</span>
<span class="nf">dir&#39;</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="p">(</span><span class="n">head</span> <span class="o">.</span> <span class="p">(</span><span class="o">++</span> <span class="p">[</span><span class="s">&quot;/tmp&quot;</span><span class="p">]))</span> <span class="n">getArgs</span>

<span class="c1">-- @@PLEAC@@_1.3</span>
<span class="c1">-- no side effect in haskell =&gt; swap is a nonsense</span>

<span class="c1">-- @@PLEAC@@_1.4</span>
<span class="kr">import</span> <span class="nn">Char</span>
<span class="nf">i</span> <span class="ow">=</span> <span class="n">ord</span> <span class="n">&#39;e&#39;</span>                     <span class="c1">-- 101</span>
<span class="nf">c</span> <span class="ow">=</span> <span class="n">chr</span> <span class="mi">101</span>                     <span class="c1">-- &#39;e&#39;</span>

<span class="kr">import</span> <span class="nn">Text.Printf</span>
<span class="nf">printf</span> <span class="s">&quot;Number %d is character %c</span><span class="se">\n</span><span class="s">&quot;</span> <span class="mi">101</span> <span class="mi">101</span>

<span class="nf">ascii_character_numbers</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">ord</span> <span class="s">&quot;sample&quot;</span> <span class="c1">-- [115,97,109,112,108,101]</span>
<span class="nf">word</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">chr</span> <span class="n">ascii_character_numbers</span>

<span class="nf">ibm</span> <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="n">chr</span> <span class="o">.</span> <span class="p">(</span><span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">.</span> <span class="n">ord</span><span class="p">)</span> <span class="s">&quot;HAL&quot;</span> <span class="c1">-- &quot;IBM&quot;</span>

<span class="c1">-- @@PLEAC@@_1.5</span>
<span class="nf">s</span> <span class="ow">=</span> <span class="s">&quot;an apple a day&quot;</span>
<span class="nf">msg1</span> <span class="ow">=</span> <span class="s">&quot;unique chars are: &quot;</span> <span class="o">++</span> <span class="n">sort</span> <span class="p">(</span><span class="n">nub</span> <span class="n">s</span><span class="p">)</span>
<span class="nf">msg2</span> <span class="ow">=</span> <span class="s">&quot;sum is &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">show</span> <span class="o">$</span> <span class="n">sum</span> <span class="o">$</span> <span class="n">map</span> <span class="n">ord</span> <span class="o">$</span> <span class="n">s</span><span class="p">)</span>


<span class="c1">-- slowcat -----------------------</span>
<span class="o">#!/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">runghc</span>
<span class="cm">{-# OPTIONS_GHC -fglasgow-exts #-}</span>

<span class="kr">import</span> <span class="nn">System</span>
<span class="kr">import</span> <span class="nn">System.IO</span>
<span class="kr">import</span> <span class="nn">System.Posix</span>
<span class="kr">import</span> <span class="nn">Text.Regex</span>

<span class="nf">any_input</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="n">getContents</span>
<span class="nf">any_input</span> <span class="p">(</span><span class="n">f</span><span class="kt">:</span><span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">readFile</span> <span class="n">f</span>

<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span> <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">args&#39;</span><span class="p">)</span> <span class="ow">&lt;-</span> <span class="n">fmap</span> <span class="n">get_time</span> <span class="n">getArgs</span>
          <span class="n">s</span> <span class="ow">&lt;-</span> <span class="n">any_input</span> <span class="n">args&#39;</span>
          <span class="n">hSetBuffering</span> <span class="n">stdout</span> <span class="kt">NoBuffering</span>
          <span class="n">mapM_</span> <span class="p">(</span><span class="nf">\</span><span class="n">c</span> <span class="ow">-&gt;</span> <span class="n">putChar</span> <span class="n">c</span> <span class="o">&gt;&gt;</span> <span class="n">usleep</span> <span class="p">(</span><span class="mi">5000</span> <span class="o">*</span> <span class="n">time</span><span class="p">))</span> <span class="n">s</span>
    <span class="kr">where</span> <span class="n">get_time</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">args</span><span class="p">)</span>
              <span class="o">|</span> <span class="p">(</span><span class="kt">Just</span> <span class="p">[</span><span class="n">d</span><span class="p">])</span> <span class="ow">&lt;-</span> <span class="n">matchRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;^-([0-9]+)&quot;</span><span class="p">)</span> <span class="n">x</span> <span class="ow">=</span> <span class="p">(</span><span class="n">read</span> <span class="n">d</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
          <span class="n">get_time</span> <span class="n">args</span> <span class="ow">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>


<span class="c1">-- @@PLEAC@@_1.6</span>
<span class="nf">string</span> <span class="ow">=</span> <span class="s">&quot;Yoda said, </span><span class="se">\&quot;</span><span class="s">can you see this?</span><span class="se">\&quot;</span><span class="s">&quot;</span>
<span class="nf">allwords</span> <span class="ow">=</span> <span class="n">words</span> <span class="n">string</span>
<span class="nf">revwords</span> <span class="ow">=</span> <span class="n">unwords</span> <span class="p">(</span><span class="n">reverse</span> <span class="n">allwords</span><span class="p">)</span>

<span class="nf">revwords</span> <span class="ow">=</span> <span class="p">(</span><span class="n">unwords</span> <span class="o">.</span> <span class="n">reverse</span> <span class="o">.</span> <span class="n">words</span><span class="p">)</span> <span class="n">string</span>

<span class="c1">-- another version of revwords which works for spaces</span>
<span class="nf">revwords&#39;</span> <span class="ow">=</span> <span class="p">(</span><span class="n">unwords</span> <span class="o">.</span> <span class="n">reverse</span> <span class="o">.</span> <span class="n">splitRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot; &quot;</span><span class="p">))</span> <span class="n">string</span>

<span class="c1">-- yet another version using a home made version of splitRegex&#39; which keeps the matched string</span>
<span class="kr">import</span> <span class="nn">List</span>
<span class="kr">import</span> <span class="nn">Text.Regex</span>

<span class="c1">-- special unfoldr (unfoldr only returns [b] whereas we also need the rest)</span>
<span class="c1">-- nb: we can use Control.Arrow.first which is \f (a,b) -&gt; (f a, b)</span>
<span class="c1">--     and write:  Arrow.first (a :) (unfoldr&#39; f b&#39;)</span>
<span class="nf">unfoldr&#39;</span> <span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="p">([</span><span class="n">b</span><span class="p">],</span> <span class="n">a</span><span class="p">)</span>
<span class="nf">unfoldr&#39;</span> <span class="n">f</span> <span class="n">b</span>  <span class="ow">=</span>
  <span class="kr">case</span> <span class="n">f</span> <span class="n">b</span> <span class="kr">of</span>
   <span class="kt">Just</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b&#39;</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kr">let</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">b&#39;&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">unfoldr&#39;</span> <span class="n">f</span> <span class="n">b&#39;</span> <span class="kr">in</span> <span class="p">(</span><span class="n">a</span><span class="kt">:</span><span class="n">l</span><span class="p">,</span> <span class="n">b&#39;&#39;</span><span class="p">)</span>
   <span class="kt">Nothing</span>      <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">[]</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="nf">splitRegex&#39;</span> <span class="ow">::</span> <span class="kt">Regex</span> <span class="ow">-&gt;</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="p">[(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">)]</span>
<span class="nf">splitRegex&#39;</span> <span class="n">re</span> <span class="n">s</span> <span class="ow">=</span> 
    <span class="kr">case</span> <span class="n">unfoldr&#39;</span> <span class="n">f</span> <span class="n">s</span> <span class="kr">of</span>
      <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">l</span>
      <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">l</span> <span class="o">++</span> <span class="p">[(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)]</span>
    <span class="kr">where</span> 
      <span class="c1">-- small helper functions which tranform matchRegexAll output</span>
      <span class="c1">-- to the one wanted by unfoldr&#39;</span>
      <span class="n">f</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="n">f&#39;</span> <span class="o">.</span> <span class="n">matchRegexAll</span> <span class="n">re</span>
      <span class="n">f&#39;</span> <span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">matched</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="p">((</span><span class="n">before</span><span class="p">,</span> <span class="n">matched</span><span class="p">),</span> <span class="n">after</span><span class="p">)</span>

<span class="nf">words&#39;</span> <span class="ow">=</span> <span class="n">concatMap</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">])</span> <span class="o">.</span> <span class="n">splitRegex&#39;</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">s+&quot;</span><span class="p">)</span>

<span class="nf">revwords&#39;</span> <span class="ow">=</span> <span class="p">(</span><span class="n">concat</span> <span class="o">.</span> <span class="n">reverse</span> <span class="o">.</span> <span class="n">words&#39;</span><span class="p">)</span> <span class="n">string</span>

<span class="cm">{-</span>
<span class="cm">import Test.QuickCheck</span>
<span class="cm">import Char</span>

<span class="cm">instance Arbitrary Char where</span>
<span class="cm">    arbitrary     = fmap chr $ choose (32,255)</span>
<span class="cm">    coarbitrary n = variant (ord n)</span>

<span class="cm">property_words&#39; s = (concat . words&#39;) s == s</span>
<span class="cm">verif = quickCheck property_words&#39;</span>
<span class="cm">-}</span>
<span class="c1">--</span>

<span class="nf">word</span> <span class="ow">=</span> <span class="s">&quot;reviver&quot;</span><span class="p">;</span>
<span class="nf">is_palindrome</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">s</span> <span class="o">==</span> <span class="n">reverse</span> <span class="n">s</span>

<span class="nf">long_palindromes</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="p">(</span><span class="n">filter</span> <span class="p">(</span><span class="nf">\</span><span class="n">s</span> <span class="ow">-&gt;</span> <span class="n">s</span> <span class="o">==</span> <span class="n">reverse</span> <span class="n">s</span> <span class="o">&amp;&amp;</span> <span class="n">length</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">.</span> <span class="n">lines</span><span class="p">)</span> <span class="o">$</span>
                      <span class="n">readFile</span> <span class="s">&quot;/usr/share/dict/words&quot;</span>

<span class="c1">-- @@PLEAC@@_1.7</span>

<span class="nf">expand_tabs</span> <span class="s">&quot;&quot;</span> <span class="ow">=</span> <span class="s">&quot;&quot;</span>
<span class="nf">expand_tabs</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">foldr1</span> <span class="p">((</span><span class="o">++</span><span class="p">)</span> <span class="o">.</span> <span class="n">adjust</span><span class="p">)</span> <span class="o">$</span> <span class="n">splitRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">)</span> <span class="n">s</span>
    <span class="kr">where</span> <span class="n">adjust</span> <span class="n">a</span> <span class="ow">=</span> <span class="n">a</span> <span class="o">++</span> <span class="n">replicate</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="p">(</span><span class="n">length</span> <span class="n">a</span><span class="p">)</span> <span class="p">`</span><span class="n">mod</span><span class="p">`</span> <span class="mi">8</span><span class="p">)</span> <span class="sc">&#39; &#39;</span>

<span class="c1">-- replace spaces with tab</span>
<span class="nf">unexpand</span> <span class="ow">=</span> <span class="n">concat</span> <span class="o">.</span> <span class="n">map</span> <span class="p">(</span><span class="n">reverse</span> <span class="o">.</span> <span class="n">unexp</span> <span class="o">.</span> <span class="n">reverse</span><span class="p">)</span> <span class="o">.</span> <span class="n">groupNelem</span> <span class="mi">8</span> <span class="kr">where</span>
    <span class="n">unexp</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">head</span> <span class="n">s</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span> <span class="o">&amp;&amp;</span> <span class="n">length</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">8</span> 
              <span class="kr">then</span> <span class="sc">&#39;</span><span class="se">\t</span><span class="sc">&#39;</span> <span class="kt">:</span> <span class="n">dropWhile</span> <span class="p">(</span><span class="o">==</span> <span class="sc">&#39; &#39;</span><span class="p">)</span> <span class="n">s</span>
              <span class="kr">else</span> <span class="n">s</span>
<span class="cm">{- </span>
<span class="cm">   Here is a property that can be given to quickCheck </span>
<span class="cm">   property_expand s = (expand_tabs . unexpand) s == s</span>
<span class="cm">-}</span>
			
<span class="c1">-- @@PLEAC@@_1.8</span>
<span class="c1">-- can&#39;t do eval in haskell</span>

<span class="c1">-- subRegex only allow a fixed string</span>
<span class="c1">-- subRegexOnceWith below takes a (String -&gt; String) function to compute a result</span>
<span class="c1">-- (and do the substitution only once)</span>
<span class="nf">subRegexOnceWith</span> <span class="n">re</span> <span class="n">new</span> <span class="n">s</span> <span class="ow">=</span> 
    <span class="kr">case</span> <span class="n">matchRegexAll</span> <span class="n">re</span> <span class="n">s</span> <span class="kr">of</span>
      <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="n">s</span>
      <span class="kt">Just</span> <span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">matched</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">before</span> <span class="o">++</span> <span class="n">new</span> <span class="n">matched</span> <span class="o">++</span> <span class="n">after</span>
<span class="nf">s</span> <span class="ow">=</span> <span class="n">subRegexOnceWith</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;[0-9]+&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">show</span> <span class="o">.</span> <span class="p">(</span><span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">.</span> <span class="n">read</span><span class="p">)</span> <span class="s">&quot;I am 17 years old&quot;</span>

<span class="c1">-- @@PLEAC@@_1.9</span>
<span class="kr">import</span> <span class="nn">Char</span>
<span class="nf">s1</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">toUpper</span> <span class="s">&quot;dromedary&quot;</span>       <span class="c1">-- &quot;DROMEDARY&quot;</span>
<span class="nf">s2</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">toLower</span> <span class="n">s1</span>              <span class="c1">-- &quot;dromedary&quot;</span>
<span class="nf">s3</span> <span class="ow">=</span> <span class="n">toUpper</span> <span class="p">(</span><span class="n">head</span> <span class="n">s2</span><span class="p">)</span> <span class="kt">:</span> <span class="n">tail</span> <span class="n">s2</span>

<span class="nf">capitalize</span> <span class="s">&quot;&quot;</span> <span class="ow">=</span> <span class="s">&quot;&quot;</span>
<span class="nf">capitalize</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">toUpper</span> <span class="n">x</span> <span class="kt">:</span> <span class="n">map</span> <span class="n">toLower</span> <span class="n">xs</span>

<span class="c1">-- capitalize each word&#39;s first character, downcase the rest</span>
<span class="nf">s4</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">capitalize</span> <span class="o">$</span> <span class="n">words</span> <span class="s">&quot;thIS is a loNG liNE&quot;</span>

<span class="c1">-- randcap: filter to randomly capitalize 20% of the letters</span>
<span class="o">#!/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">runghc</span>
<span class="kr">import</span> <span class="nn">System</span>
<span class="kr">import</span> <span class="nn">System.IO</span>
<span class="kr">import</span> <span class="nn">Random</span>
<span class="kr">import</span> <span class="nn">Char</span>

<span class="nf">any_input</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="n">getContents</span>
<span class="nf">any_input</span> <span class="p">(</span><span class="n">f</span><span class="kt">:</span><span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">readFile</span> <span class="n">f</span>

<span class="nf">rand</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">Int</span>
<span class="nf">rand</span> <span class="n">low</span> <span class="n">high</span> <span class="ow">=</span> <span class="n">getStdRandom</span> <span class="p">(</span><span class="n">randomR</span> <span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">))</span>

<span class="nf">randcap</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">String</span>
<span class="nf">randcap</span> <span class="ow">=</span> <span class="n">sequence</span> <span class="o">.</span> <span class="n">map</span> <span class="n">f</span> <span class="kr">where</span>
      <span class="n">f</span> <span class="n">c</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="p">(</span><span class="n">modify_char</span> <span class="n">c</span><span class="p">)</span> <span class="o">$</span> <span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
      <span class="n">modify_char</span> <span class="n">c</span> <span class="n">n</span> <span class="ow">=</span> <span class="p">(</span><span class="kr">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span> <span class="n">toUpper</span> <span class="kr">else</span> <span class="n">toLower</span><span class="p">)</span> <span class="n">c</span>

<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">s</span> <span class="ow">&lt;-</span> <span class="n">getArgs</span> <span class="o">&gt;&gt;=</span> <span class="n">any_input</span>
          <span class="n">randcap</span> <span class="n">s</span> <span class="o">&gt;&gt;=</span> <span class="n">putStr</span>

<span class="c1">-- @@PLEAC@@_1.10</span>
<span class="nf">s</span> <span class="ow">=</span> <span class="s">&quot;I have &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">++</span> <span class="s">&quot; guanacos.&quot;</span>

<span class="c1">-- multiline strings are quite ugly in haskell</span>
<span class="c1">-- so skipping the send_mail example</span>

<span class="c1">-- @@PLEAC@@_1.11</span>
<span class="nf">var</span> <span class="ow">=</span> <span class="s">&quot;your text</span><span class="se">\n\</span>
<span class="se">      \</span><span class="s">goes here</span><span class="se">\n</span><span class="s">&quot;</span>

<span class="c1">-- @@PLEAC@@_1.12</span>
<span class="kr">import</span> <span class="nn">Data.List</span>

<span class="nf">input</span> <span class="ow">=</span> <span class="s">&quot;Folding and splicing is the work of an editor,</span><span class="se">\</span>
<span class="se">        \</span><span class="s"> not a mere collection of silicon and mobile electrons!&quot;</span>

<span class="nf">wrap</span> <span class="n">columns</span> <span class="n">first_indent</span> <span class="n">indent</span> <span class="n">s</span> <span class="ow">=</span>
	<span class="n">intercalate</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">$</span> <span class="n">wgroup</span> <span class="p">(</span><span class="n">tail</span> <span class="n">first_indent</span><span class="p">)</span> <span class="p">(</span><span class="n">words</span> <span class="n">s</span><span class="p">)</span>
	<span class="kr">where</span> <span class="n">wgroup</span> <span class="n">current</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="p">[</span><span class="n">current</span><span class="p">]</span>
	      <span class="n">wgroup</span> <span class="n">current</span> <span class="p">(</span><span class="n">w</span> <span class="kt">:</span> <span class="n">ws</span><span class="p">)</span> <span class="ow">=</span>
	        <span class="kr">if</span> <span class="n">length</span> <span class="n">current</span> <span class="o">+</span> <span class="n">length</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">columns</span> 
                <span class="kr">then</span> <span class="n">wgroup</span> <span class="p">(</span><span class="n">current</span> <span class="o">++</span> <span class="s">&quot; &quot;</span> <span class="o">++</span> <span class="n">w</span><span class="p">)</span> <span class="n">ws</span> 
                <span class="kr">else</span> <span class="n">current</span> <span class="kt">:</span> <span class="n">wgroup</span> <span class="p">(</span><span class="n">indent</span> <span class="o">++</span> <span class="n">w</span><span class="p">)</span> <span class="n">ws</span>


<span class="c1">-- another version</span>
<span class="nf">wrap_simple</span> <span class="n">columns</span> <span class="n">s</span> <span class="ow">=</span>
    <span class="n">intercalate</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">$</span> <span class="n">map</span> <span class="n">unwords</span> <span class="o">$</span> <span class="n">groupWhile</span> <span class="n">pred</span> <span class="o">$</span> <span class="n">words</span> <span class="n">s</span>
    <span class="kr">where</span> <span class="n">pred</span> <span class="ow">=</span> <span class="p">(</span><span class="o">&lt;=</span> <span class="n">columns</span><span class="p">)</span> <span class="o">.</span> <span class="n">sum</span> <span class="o">.</span> <span class="n">map</span> <span class="p">((</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">.</span> <span class="n">length</span><span class="p">)</span>

<span class="nf">wrap</span> <span class="n">columns</span> <span class="n">first_indent</span> <span class="n">indent</span> <span class="n">s</span> <span class="ow">=</span>
    <span class="n">first_indent</span> <span class="o">++</span> <span class="n">intercalate</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">++</span> <span class="n">indent</span><span class="p">)</span> <span class="p">(</span><span class="n">map</span> <span class="n">unwords</span> <span class="o">$</span> <span class="n">first</span> <span class="kt">:</span> <span class="n">next</span><span class="p">)</span>
    <span class="kr">where</span> <span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span> <span class="ow">=</span> <span class="n">spanWhile</span> <span class="p">(</span><span class="n">pred</span> <span class="o">$</span> <span class="n">columns</span> <span class="o">-</span> <span class="n">length</span> <span class="n">first_indent</span><span class="p">)</span> <span class="p">(</span><span class="n">words</span> <span class="n">s</span><span class="p">)</span>
          <span class="n">next</span> <span class="ow">=</span> <span class="n">groupWhile</span> <span class="p">(</span><span class="n">pred</span> <span class="o">$</span> <span class="n">columns</span> <span class="o">-</span> <span class="n">length</span> <span class="n">indent</span><span class="p">)</span> <span class="n">rest</span> 
          <span class="n">pred</span> <span class="n">width</span> <span class="ow">=</span> <span class="p">(</span><span class="o">&lt;=</span> <span class="n">width</span><span class="p">)</span> <span class="o">.</span> <span class="n">sum</span> <span class="o">.</span> <span class="n">map</span> <span class="p">((</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">.</span> <span class="n">length</span><span class="p">)</span>

<span class="nf">spanWhile</span> <span class="ow">::</span> <span class="p">([</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="p">([</span><span class="n">a</span><span class="p">],[</span><span class="n">a</span><span class="p">])</span>
<span class="nf">spanWhile</span> <span class="n">p</span> <span class="n">l</span> <span class="ow">=</span> <span class="n">spanWhile&#39;</span> <span class="kt">[]</span> <span class="n">l</span>              
    <span class="kr">where</span> <span class="n">spanWhile&#39;</span> <span class="n">seen</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="p">(</span><span class="n">seen</span><span class="p">,</span> <span class="kt">[]</span><span class="p">)</span>
          <span class="n">spanWhile&#39;</span> <span class="n">seen</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span>
              <span class="kr">let</span> <span class="n">seen&#39;</span> <span class="ow">=</span> <span class="n">seen</span> <span class="o">++</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="kr">in</span>
              <span class="kr">if</span> <span class="n">p</span> <span class="n">seen&#39;</span> <span class="kr">then</span> <span class="n">spanWhile&#39;</span> <span class="n">seen&#39;</span> <span class="n">xs</span> <span class="kr">else</span> <span class="p">(</span><span class="n">seen</span><span class="p">,</span> <span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span>

<span class="nf">groupWhile</span> <span class="ow">::</span> <span class="p">([</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="p">[[</span><span class="n">a</span><span class="p">]]</span>
<span class="nf">groupWhile</span> <span class="n">p</span> <span class="n">l</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">spanWhile</span> <span class="n">p</span> <span class="n">l</span> <span class="kr">of</span>
                   <span class="p">(</span><span class="kt">[]</span><span class="p">,</span> <span class="kt">[]</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">[]</span>
                   <span class="p">(</span><span class="n">l&#39;</span><span class="p">,</span> <span class="kt">[]</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">l&#39;</span><span class="p">]</span>
                   <span class="p">(</span><span class="n">l&#39;</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">l&#39;</span> <span class="kt">:</span> <span class="n">groupWhile</span> <span class="n">p</span> <span class="n">rest</span>

<span class="c1">-- @@PLEAC@@_1.13</span>
<span class="kr">import</span> <span class="nn">Text.Regex</span>
<span class="kr">import</span> <span class="nn">Char</span>

<span class="nf">subRegexWith</span> <span class="n">re</span> <span class="n">new</span> <span class="n">s</span> <span class="ow">=</span>
    <span class="kr">case</span> <span class="n">matchRegexAll</span> <span class="n">re</span> <span class="n">s</span> <span class="kr">of</span>
      <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="n">s</span>
      <span class="kt">Just</span> <span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">matched</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">before</span> <span class="o">++</span> <span class="n">new</span> <span class="n">matched</span> <span class="o">++</span> <span class="p">(</span><span class="n">subRegexWith</span> <span class="n">re</span> <span class="n">new</span> <span class="n">after</span><span class="p">)</span>

<span class="nf">quoteMeta</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
<span class="nf">quoteMeta</span> <span class="ow">=</span> <span class="n">concatMap</span> <span class="p">(</span><span class="nf">\</span><span class="n">c</span> <span class="ow">-&gt;</span> <span class="kr">if</span> <span class="p">(</span><span class="n">isAlphaNum</span> <span class="n">c</span><span class="p">)</span> <span class="kr">then</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="kr">else</span> <span class="p">[</span><span class="sc">&#39;</span><span class="se">\\</span><span class="sc">&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">])</span>

<span class="nf">t1</span> <span class="ow">=</span> <span class="n">subRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="o">$</span> <span class="n">quoteMeta</span> <span class="s">&quot;^&quot;</span><span class="p">)</span> <span class="s">&quot;foo^bar&quot;</span> <span class="s">&quot;+&quot;</span> <span class="c1">-- &quot;foo+bar&quot; (without the quoteMeta, it goes into a dead loop)</span>
<span class="nf">t2</span> <span class="ow">=</span> <span class="n">subRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="o">$</span> <span class="n">quoteMeta</span> <span class="s">&quot;${&quot;</span><span class="p">)</span> <span class="s">&quot;${foo}bar&quot;</span> <span class="s">&quot;{&quot;</span> <span class="c1">-- &quot;{foo}bar&quot;</span>
<span class="nf">t3</span> <span class="ow">=</span> <span class="n">subRegexWith</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">$</span><span class="se">\\</span><span class="s">{[^}]*</span><span class="se">\\</span><span class="s">}&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">map</span> <span class="n">toUpper</span><span class="p">)</span> <span class="s">&quot;${foo}bar}&quot;</span> <span class="c1">-- &quot;${FOO}bar}&quot;</span>

<span class="c1">-- @@PLEAC@@_1.14</span>
<span class="nf">trim_beg</span><span class="p">,</span> <span class="n">trim_end</span><span class="p">,</span> <span class="n">trim</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
<span class="nf">trim_beg</span> <span class="ow">=</span> <span class="n">snd</span> <span class="o">.</span> <span class="n">span</span> <span class="n">isSpace</span>
<span class="nf">trim_end</span> <span class="ow">=</span> <span class="n">reverse</span> <span class="o">.</span> <span class="n">trim_beg</span> <span class="o">.</span> <span class="n">reverse</span>
<span class="nf">trim</span> <span class="ow">=</span> <span class="n">trim_end</span> <span class="o">.</span> <span class="n">trim_beg</span>

<span class="nf">trimmed</span> <span class="ow">=</span> <span class="s">&quot;&gt;&quot;</span> <span class="o">++</span> <span class="n">trim</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">       `Here&#39; </span><span class="se">\t</span><span class="s"> </span><span class="se">\t</span><span class="s"> </span><span class="se">\n\n\n</span><span class="s">&quot;</span> <span class="o">++</span> <span class="s">&quot;&lt;&quot;</span>

<span class="c1">-- @@PLEAC@@_1.15</span>
<span class="nf">parse_csv</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span>
<span class="nf">parse_csv</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">lex</span> <span class="n">s</span> <span class="kr">of</span>
	<span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
	<span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xs</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">x</span> <span class="kt">:</span> <span class="n">parse_csv</span> <span class="n">xs</span>
      <span class="kr">where</span>
	   <span class="n">lex</span> <span class="s">&quot;&quot;</span> <span class="ow">=</span> <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
	   <span class="n">lex</span> <span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">xs</span><span class="p">)</span>
	   <span class="n">lex</span> <span class="p">(</span><span class="sc">&#39;&quot;&#39;</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">x</span><span class="o">++</span><span class="n">x&#39;</span><span class="p">,</span><span class="n">xs&#39;&#39;</span><span class="p">)</span> <span class="kr">where</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">xs&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">lexString</span> <span class="n">xs</span>
		                             <span class="p">(</span><span class="n">x&#39;</span><span class="p">,</span><span class="n">xs&#39;&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">lex</span> <span class="n">xs&#39;</span>	 
	   <span class="n">lex</span> <span class="p">(</span><span class="n">other</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">other</span><span class="kt">:</span><span class="n">x</span><span class="p">,</span><span class="n">xs&#39;</span><span class="p">)</span> <span class="kr">where</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">xs&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">lex</span> <span class="n">xs</span>				       

           <span class="n">lexString</span> <span class="p">(</span><span class="sc">&#39;&quot;&#39;</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">xs</span><span class="p">)</span>
	   <span class="n">lexString</span> <span class="p">(</span><span class="sc">&#39;</span><span class="se">\\</span><span class="sc">&#39;</span><span class="kt">:</span><span class="n">c</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="sc">&#39;</span><span class="se">\\</span><span class="sc">&#39;</span><span class="kt">:</span><span class="n">c</span><span class="kt">:</span><span class="n">x</span> <span class="p">,</span> <span class="n">xs&#39;</span><span class="p">)</span> <span class="kr">where</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">xs&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">lexString</span> <span class="n">xs</span>
	   <span class="n">lexString</span> <span class="p">(</span><span class="n">c</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">c</span><span class="kt">:</span><span class="n">x</span><span class="p">,</span><span class="n">xs&#39;</span><span class="p">)</span> <span class="kr">where</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">xs&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">lexString</span> <span class="n">xs</span>

<span class="c1">-- the same using Parsec</span>
<span class="kr">import</span> <span class="nn">Text.ParserCombinators.Parsec</span>

<span class="nf">fromRight</span> <span class="p">(</span><span class="kt">Right</span> <span class="n">v</span><span class="p">)</span> <span class="ow">=</span> <span class="n">v</span>
<span class="nf">fromRight</span> <span class="n">v</span> <span class="ow">=</span> <span class="ne">error</span> <span class="p">(</span><span class="s">&quot;fromRight: &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">v</span><span class="p">)</span>
<span class="nf">parseStr</span> <span class="n">parser</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">fromRight</span> <span class="o">$</span> <span class="n">parse</span> <span class="n">parser</span> <span class="s">&quot;&quot;</span> <span class="n">s</span>
<span class="nf">toList</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="p">(</span><span class="nf">\</span><span class="n">c</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">c</span><span class="p">])</span>
<span class="nf">many_</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="n">concat</span> <span class="o">.</span> <span class="n">many</span>

<span class="nf">parse_csv&#39;</span> <span class="ow">=</span> <span class="n">parseStr</span> <span class="o">$</span> <span class="p">(</span><span class="n">quoted_string</span> <span class="o">&lt;|&gt;</span> <span class="n">raw_string</span><span class="p">)</span> <span class="p">`</span><span class="n">sepBy</span><span class="p">`</span> <span class="n">char</span> <span class="sc">&#39;,&#39;</span>
    <span class="kr">where</span> <span class="n">quoted_string</span> <span class="ow">=</span> <span class="n">between</span> <span class="p">(</span><span class="n">char</span> <span class="sc">&#39;&quot;&#39;</span><span class="p">)</span> <span class="p">(</span><span class="n">char</span> <span class="sc">&#39;&quot;&#39;</span><span class="p">)</span> <span class="p">(</span><span class="n">chars_until</span> <span class="sc">&#39;&quot;&#39;</span><span class="p">)</span>
          <span class="n">raw_string</span> <span class="ow">=</span> <span class="n">chars_until</span> <span class="sc">&#39;,&#39;</span>
          <span class="n">chars_until</span> <span class="n">c</span> <span class="ow">=</span> <span class="n">many_</span> <span class="p">(</span><span class="n">sequence</span> <span class="p">[</span> <span class="n">char</span> <span class="sc">&#39;</span><span class="se">\\</span><span class="sc">&#39;</span><span class="p">,</span> <span class="n">anyChar</span> <span class="p">]</span> <span class="o">&lt;|&gt;</span> <span class="n">toList</span> <span class="p">(</span><span class="n">noneOf</span> <span class="p">[</span><span class="n">c</span><span class="p">]))</span>

<span class="nf">test_string</span> <span class="ow">=</span> <span class="s">&quot;XYZZY,</span><span class="se">\&quot;\&quot;</span><span class="s">,</span><span class="se">\&quot;</span><span class="s">O&#39;Reilly, Inc</span><span class="se">\&quot;</span><span class="s">,</span><span class="se">\&quot;</span><span class="s">Wall, Larry</span><span class="se">\&quot;</span><span class="s">,</span><span class="se">\&quot;</span><span class="s">a </span><span class="se">\\\&quot;</span><span class="s">glub</span><span class="se">\\\&quot;</span><span class="s"> bit,</span><span class="se">\&quot;</span><span class="s">,5,</span><span class="se">\&quot;</span><span class="s">Error, Core Dumped</span><span class="se">\&quot;</span><span class="s">&quot;</span>

<span class="nf">output</span> <span class="ow">=</span> <span class="n">concatMap</span> <span class="n">format_it</span> <span class="o">$</span> <span class="n">zip</span> <span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="p">]</span> <span class="p">(</span><span class="n">parse_csv</span> <span class="n">test_string</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">format_it</span> <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">=</span> <span class="n">show</span> <span class="n">line</span> <span class="o">++</span> <span class="s">&quot; : &quot;</span> <span class="o">++</span> <span class="n">s</span> <span class="o">++</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>

<span class="c1">-- @@PLEAC@@_1.16</span>
<span class="kr">import</span> <span class="nn">List</span>
<span class="kr">import</span> <span class="nn">Maybe</span>
<span class="kr">import</span> <span class="nn">Char</span>
<span class="kr">import</span> <span class="nn">System.Posix.User</span>

<span class="nf">soundex</span> <span class="n">name</span> <span class="ow">=</span> <span class="p">(</span><span class="n">chars</span><span class="o">!!</span><span class="mi">0</span><span class="p">)</span> <span class="kt">:</span> <span class="n">concatMap</span> <span class="n">show</span> <span class="n">codes&#39;</span>
    <span class="kr">where</span>
      <span class="n">chars</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">toUpper</span> <span class="p">(</span><span class="n">filter</span> <span class="n">isAlpha</span> <span class="n">name</span><span class="p">)</span>

      <span class="c1">-- duplicate consecutive soundex digits are skipped</span>
      <span class="n">codes</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">head</span> <span class="o">$</span> <span class="n">group</span> <span class="o">$</span> <span class="n">map</span> <span class="n">letter_to_code</span> <span class="n">chars</span>

      <span class="c1">-- remove first, remove codes 0, add right-pad with 0</span>
      <span class="n">codes&#39;</span> <span class="ow">=</span> <span class="n">take</span> <span class="mi">3</span> <span class="p">(</span><span class="n">filter</span> <span class="p">(</span><span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="n">tail</span> <span class="n">codes</span><span class="p">)</span> <span class="o">++</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">..</span><span class="p">])</span>

<span class="nf">letter_to_code</span> <span class="ow">::</span> <span class="kt">Char</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
<span class="nf">letter_to_code</span> <span class="n">c</span> <span class="ow">=</span> <span class="n">snd</span> <span class="o">$</span> <span class="n">fromJust</span> <span class="o">$</span> <span class="n">find</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">letters</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">c</span> <span class="p">`</span><span class="n">elem</span><span class="p">`</span> <span class="n">letters</span><span class="p">)</span> <span class="n">letters_code</span>
<span class="nf">letters_code</span> <span class="ow">=</span>
    <span class="p">[</span> <span class="p">(</span><span class="s">&quot;AEIOUYHW&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">,</span> <span class="p">(</span><span class="s">&quot;BFPV&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">,</span> <span class="p">(</span><span class="s">&quot;CGJKQSXZ&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span> <span class="p">(</span><span class="s">&quot;DT&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="p">,</span> <span class="p">(</span><span class="s">&quot;L&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">,</span> <span class="p">(</span><span class="s">&quot;MN&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="p">,</span> <span class="p">(</span><span class="s">&quot;R&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="p">]</span>
	  
<span class="nf">errors</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="n">name</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">code</span> <span class="o">/=</span> <span class="n">soundex</span> <span class="n">name</span><span class="p">)</span>
            <span class="p">[</span> <span class="p">(</span><span class="s">&quot;H452&quot;</span><span class="p">,</span> <span class="s">&quot;holmes&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;A355&quot;</span><span class="p">,</span> <span class="s">&quot;adomomi&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;V536&quot;</span><span class="p">,</span> <span class="s">&quot;vonderlehr&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;B400&quot;</span><span class="p">,</span> <span class="s">&quot;ball&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;S000&quot;</span><span class="p">,</span> <span class="s">&quot;shaw&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;J250&quot;</span><span class="p">,</span> <span class="s">&quot;jackson&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;S545&quot;</span><span class="p">,</span> <span class="s">&quot;scanlon&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;S532&quot;</span><span class="p">,</span> <span class="s">&quot;saintjohn&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;K525&quot;</span><span class="p">,</span> <span class="s">&quot;kingsmith&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;B331&quot;</span><span class="p">,</span> <span class="s">&quot;booth-davis&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;K530&quot;</span><span class="p">,</span> <span class="s">&quot;Knuth&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;K530&quot;</span><span class="p">,</span> <span class="s">&quot;Kant&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;L300&quot;</span><span class="p">,</span> <span class="s">&quot;Lloyd&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;L300&quot;</span><span class="p">,</span> <span class="s">&quot;Ladd&quot;</span><span class="p">)</span>
	    <span class="p">]</span>


<span class="c1">-- one need to flush between putStr and getLine,</span>
<span class="c1">--   it would not be needed if we had printer a newline</span>
<span class="c1">-- the other solution is to disable buffering with hSetBuffering</span>
<span class="nf">putStr_getLine</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">putStr</span> <span class="n">s</span>
                      <span class="n">hFlush</span> <span class="n">stdout</span>
                      <span class="n">getLine</span>

<span class="nf">msoundex</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">user</span> <span class="ow">&lt;-</span> <span class="n">putStr_getLine</span> <span class="s">&quot;Lookup user: &quot;</span>
              <span class="n">matching</span> <span class="ow">&lt;-</span> <span class="n">fmap</span> <span class="p">(</span><span class="n">filter</span> <span class="o">$</span> <span class="n">matches</span> <span class="n">user</span><span class="p">)</span> <span class="n">getAllUserEntries</span>
              <span class="n">mapM_</span> <span class="p">(</span><span class="n">putStrLn</span> <span class="o">.</span> <span class="n">format_user</span><span class="p">)</span> <span class="n">matching</span>
    <span class="kr">where</span> 
      <span class="n">matches</span> <span class="n">wanted</span> <span class="n">user</span> <span class="ow">=</span> <span class="n">soundex</span> <span class="n">wanted</span> <span class="p">`</span><span class="n">elem</span><span class="p">`</span> <span class="p">(</span><span class="n">map</span> <span class="n">soundex</span> <span class="o">$</span> <span class="n">userName</span> <span class="n">user</span> <span class="kt">:</span> <span class="n">words</span> <span class="p">(</span><span class="n">userGecos</span> <span class="n">user</span><span class="p">))</span>
      <span class="n">format_user</span> <span class="n">user</span> <span class="ow">=</span> <span class="n">userName</span> <span class="n">user</span> <span class="o">++</span> <span class="s">&quot;: &quot;</span> <span class="o">++</span> <span class="n">userGecos</span> <span class="n">user</span>
			 
<span class="c1">-- @@PLEAC@@_1.17</span>
<span class="c1">-- <font size="-1"><a href="http://pleac.sourceforge.net/include/haskell/FixStyle.hs</span>">download the following standalone program</a></font>
<span class="kr">module</span> <span class="nn">Main</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Text.Regex.PCRE.String</span> <span class="k">as</span> <span class="n">PCRE</span>
<span class="kr">import</span> <span class="nn">Data.Char</span> <span class="p">(</span><span class="nf">toLower</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Data.List</span> <span class="p">(</span><span class="nf">intersperse</span><span class="p">)</span>

<span class="nf">transDict</span> <span class="ow">::</span> <span class="p">[(</span><span class="kt">String</span><span class="p">,</span><span class="kt">String</span><span class="p">)]</span>
<span class="nf">transDict</span> <span class="ow">=</span>
    <span class="p">[(</span><span class="s">&quot;analysed&quot;</span>      <span class="p">,</span><span class="s">&quot;analyzed&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;built-in&quot;</span>      <span class="p">,</span><span class="s">&quot;builtin&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;chastized&quot;</span>     <span class="p">,</span><span class="s">&quot;chastised&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;commandline&quot;</span>   <span class="p">,</span><span class="s">&quot;command-line&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;de-allocate&quot;</span>   <span class="p">,</span><span class="s">&quot;deallocate&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;dropin&quot;</span>        <span class="p">,</span><span class="s">&quot;drop-in&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;hardcode&quot;</span>      <span class="p">,</span><span class="s">&quot;hard-code&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;meta-data&quot;</span>     <span class="p">,</span><span class="s">&quot;metadata&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;multicharacter&quot;</span><span class="p">,</span><span class="s">&quot;multi-character&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;multiway&quot;</span>      <span class="p">,</span><span class="s">&quot;multi-way&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;non-empty&quot;</span>     <span class="p">,</span><span class="s">&quot;nonempty&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;non-profit&quot;</span>    <span class="p">,</span><span class="s">&quot;nonprofit&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;non-trappable&quot;</span> <span class="p">,</span><span class="s">&quot;nontrappable&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;pre-define&quot;</span>    <span class="p">,</span><span class="s">&quot;predefine&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;preextend&quot;</span>     <span class="p">,</span><span class="s">&quot;pre-extend&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;re-compiling&quot;</span>  <span class="p">,</span><span class="s">&quot;recompiling&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;reenter&quot;</span>       <span class="p">,</span><span class="s">&quot;re-enter&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;turnkey&quot;</span>       <span class="p">,</span><span class="s">&quot;turn-key&quot;</span><span class="p">)]</span>

<span class="nf">transWord</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
<span class="nf">transWord</span> <span class="n">word</span> <span class="ow">=</span> <span class="kr">case</span> <span class="p">(</span><span class="n">lookup</span> <span class="p">(</span><span class="n">map</span> <span class="n">toLower</span> <span class="n">word</span><span class="p">)</span> <span class="n">transDict</span><span class="p">)</span> <span class="kr">of</span>
                   <span class="kt">Just</span> <span class="n">trans</span> <span class="ow">-&gt;</span> <span class="n">trans</span>
                   <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="n">word</span>

<span class="nf">transDictRegex</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="kt">PCRE</span><span class="o">.</span><span class="kt">Regex</span>
<span class="nf">transDictRegex</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="n">compres</span> <span class="ow">&lt;-</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">compile</span> <span class="n">compopt</span> <span class="n">execopt</span> <span class="n">pattern</span>
  <span class="kr">case</span> <span class="n">compres</span> <span class="kr">of</span>
    <span class="kt">Left</span> <span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
        <span class="ow">-&gt;</span> <span class="ne">error</span> <span class="o">$</span>
           <span class="s">&quot;Regex pattern error&quot;</span> <span class="o">++</span>
           <span class="s">&quot; at offset &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">offset</span> <span class="o">++</span>
           <span class="s">&quot; for string: &quot;</span> <span class="o">++</span> <span class="n">string</span>
    <span class="kt">Right</span> <span class="n">regex</span>
        <span class="ow">-&gt;</span> <span class="n">return</span> <span class="n">regex</span>
  <span class="kr">where</span> <span class="n">pattern</span> <span class="ow">=</span> <span class="s">&quot;(&quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">concat</span> <span class="o">$</span> <span class="n">intersperse</span> <span class="s">&quot;|&quot;</span> <span class="o">$</span> <span class="n">map</span> <span class="n">fst</span> <span class="n">transDict</span><span class="p">)</span> <span class="o">++</span> <span class="s">&quot;)&quot;</span>
        <span class="n">compopt</span> <span class="ow">=</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">compCaseless</span> <span class="o">+</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">compMultiline</span> <span class="o">+</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">compUTF8</span>
        <span class="n">execopt</span> <span class="ow">=</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">execBlank</span>

<span class="nf">matchRegex</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="p">(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">)</span>
<span class="nf">matchRegex</span> <span class="n">input</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="n">regex</span> <span class="ow">&lt;-</span> <span class="n">transDictRegex</span>
  <span class="n">execres</span> <span class="ow">&lt;-</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">regexec</span> <span class="n">regex</span> <span class="n">input</span>
  <span class="kr">case</span> <span class="n">execres</span> <span class="kr">of</span>
    <span class="kt">Left</span> <span class="n">err</span> <span class="ow">-&gt;</span> <span class="ne">error</span> <span class="o">$</span> <span class="s">&quot;regexec WrapError &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">err</span> <span class="o">++</span> <span class="s">&quot;for: &quot;</span> <span class="o">++</span> <span class="n">input</span>
    <span class="kt">Right</span> <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="n">return</span> <span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="kt">[]</span><span class="p">,</span> <span class="kt">[]</span><span class="p">)</span>
    <span class="kt">Right</span> <span class="p">(</span><span class="kt">Just</span> <span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">tail</span><span class="p">,</span> <span class="kr">_</span><span class="p">))</span> <span class="ow">-&gt;</span> <span class="n">return</span> <span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">tail</span><span class="p">)</span>

<span class="nf">translate</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">String</span>
<span class="nf">translate</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">return</span> <span class="kt">[]</span>
<span class="nf">translate</span> <span class="n">input</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">tail</span><span class="p">)</span> <span class="ow">&lt;-</span> <span class="n">matchRegex</span> <span class="n">input</span>
  <span class="n">tailTrans</span> <span class="ow">&lt;-</span> <span class="p">(</span><span class="n">translate</span> <span class="n">tail</span><span class="p">)</span>
  <span class="n">return</span> <span class="o">$</span> <span class="n">head</span> <span class="o">++</span> <span class="p">(</span><span class="n">transWord</span> <span class="n">word</span><span class="p">)</span> <span class="o">++</span> <span class="n">tailTrans</span>

<span class="nf">main</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">getContents</span> <span class="o">&gt;&gt;=</span> <span class="n">translate</span> <span class="o">&gt;&gt;=</span> <span class="n">putStr</span>


<span class="c1">-- @@PLEAC@@_1.18</span>
<span class="c1">-- <font size="-1"><a href="http://pleac.sourceforge.net/include/haskell/PSGrep.hs</span>">download the following standalone program</a></font>
<span class="kr">module</span> <span class="nn">Main</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="nn">Data.Char</span> <span class="p">(</span><span class="nf">isSpace</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">System.Time</span> <span class="p">(</span><span class="kt">ClockTime</span><span class="p">(</span><span class="o">..</span><span class="p">))</span>
<span class="kr">import</span> <span class="nn">System.Exit</span> <span class="p">(</span><span class="kt">ExitCode</span><span class="p">(</span><span class="o">..</span><span class="p">))</span>
<span class="kr">import</span> <span class="nn">System.Process</span> <span class="p">(</span><span class="nf">readProcessWithExitCode</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Data.List</span> <span class="p">(</span><span class="nf">elemIndex</span><span class="p">,</span> <span class="nf">foldl&#39;</span><span class="p">,</span> <span class="nf">intercalate</span><span class="p">,</span> <span class="nf">words</span><span class="p">)</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Text</span> <span class="k">as</span> <span class="n">T</span>

<span class="nf">psFields</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span>
<span class="nf">psFields</span> <span class="ow">=</span> <span class="p">[</span><span class="s">&quot;flags&quot;</span><span class="p">,</span><span class="s">&quot;uid&quot;</span><span class="p">,</span><span class="s">&quot;pid&quot;</span><span class="p">,</span><span class="s">&quot;ppid&quot;</span><span class="p">,</span><span class="s">&quot;pri&quot;</span><span class="p">,</span><span class="s">&quot;nice&quot;</span><span class="p">,</span><span class="s">&quot;size&quot;</span><span class="p">,</span><span class="s">&quot;rss&quot;</span><span class="p">,</span><span class="s">&quot;wchan&quot;</span><span class="p">,</span><span class="s">&quot;stat&quot;</span><span class="p">,</span>
            <span class="s">&quot;tty&quot;</span><span class="p">,</span><span class="s">&quot;time&quot;</span><span class="p">,</span><span class="s">&quot;command&quot;</span><span class="p">]</span>


<span class="c1">-- Accessors for ps output line fields -----------------------------------------</span>

<span class="nf">breakPSFields</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span>
<span class="nf">breakPSFields</span> <span class="n">line</span> <span class="ow">=</span>
    <span class="n">breakFields</span> <span class="n">line</span> <span class="n">nInitCols</span>
    <span class="kr">where</span> <span class="n">nInitCols</span>        <span class="ow">=</span> <span class="p">(</span><span class="n">length</span> <span class="n">psFields</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
          <span class="n">dropSpace</span>        <span class="ow">=</span> <span class="n">dropWhile</span> <span class="n">isSpace</span>
          <span class="n">breakFields</span> <span class="kt">[]</span> <span class="kr">_</span> <span class="ow">=</span> <span class="kt">[]</span>
          <span class="n">breakFields</span> <span class="n">cs</span> <span class="mi">0</span> <span class="ow">=</span> <span class="p">[</span><span class="kt">T</span><span class="o">.</span><span class="n">unpack</span> <span class="o">$</span> <span class="kt">T</span><span class="o">.</span><span class="n">strip</span> <span class="o">$</span> <span class="kt">T</span><span class="o">.</span><span class="n">pack</span> <span class="n">cs</span><span class="p">]</span>
          <span class="n">breakFields</span> <span class="n">cs</span> <span class="n">n</span> <span class="ow">=</span> <span class="kr">let</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> <span class="ow">=</span> <span class="n">break</span> <span class="n">isSpace</span> <span class="o">$</span> <span class="n">dropSpace</span> <span class="n">cs</span>
                                 <span class="n">t&#39;</span>    <span class="ow">=</span> <span class="p">(</span><span class="n">breakFields</span> <span class="n">t</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                             <span class="kr">in</span> <span class="n">h</span><span class="kt">:</span><span class="n">t&#39;</span>

<span class="kr">type</span> <span class="kt">PSField</span> <span class="ow">=</span> <span class="p">([</span><span class="kt">String</span><span class="p">],</span> <span class="kt">String</span><span class="p">)</span>

<span class="nf">getPSFields</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="p">[</span><span class="kt">PSField</span><span class="p">]</span>
<span class="nf">getPSFields</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="p">(</span><span class="n">ecode</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="ow">&lt;-</span> <span class="n">readProcessWithExitCode</span> <span class="s">&quot;ps&quot;</span> <span class="n">psargs</span> <span class="kt">[]</span>
  <span class="kr">case</span> <span class="n">ecode</span> <span class="kr">of</span>
    <span class="kt">ExitFailure</span> <span class="n">eno</span> <span class="ow">-&gt;</span> <span class="ne">error</span> <span class="o">$</span> <span class="s">&quot;ps failure: [&quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">eno</span> <span class="o">++</span> <span class="s">&quot;] &quot;</span> <span class="o">++</span> <span class="n">err</span>
    <span class="kt">ExitSuccess</span> <span class="ow">-&gt;</span> <span class="n">return</span> <span class="o">$</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">l</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">breakPSFields</span> <span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">))</span> <span class="o">$</span> <span class="n">tail</span> <span class="o">$</span> <span class="n">lines</span> <span class="n">out</span>
  <span class="kr">where</span> <span class="n">psargs</span> <span class="ow">=</span> <span class="p">[</span><span class="s">&quot;ax&quot;</span><span class="p">,</span> <span class="s">&quot;-o&quot;</span><span class="p">,</span> <span class="n">intercalate</span> <span class="s">&quot;,&quot;</span> <span class="n">psFields</span><span class="p">]</span>

<span class="nf">filterPSFields</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">PSField</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="p">[</span><span class="kt">PSField</span><span class="p">]</span>
<span class="nf">filterPSFields</span> <span class="n">p</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">getPSFields</span> <span class="o">&gt;&gt;=</span> <span class="p">(</span><span class="nf">\</span><span class="n">fs</span> <span class="ow">-&gt;</span> <span class="n">return</span> <span class="o">$</span> <span class="n">filter</span> <span class="n">p</span> <span class="n">fs</span><span class="p">)</span>

<span class="nf">printPSFields</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">PSField</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="nf">printPSFields</span> <span class="n">p</span> <span class="ow">=</span> <span class="n">filterPSFields</span> <span class="n">p</span> <span class="o">&gt;&gt;=</span> <span class="n">mapM_</span> <span class="p">(</span><span class="n">putStrLn</span> <span class="o">.</span> <span class="n">snd</span><span class="p">)</span>


<span class="c1">-- Query DSL -------------------------------------------------------------------</span>

<span class="nf">parseInt</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
<span class="nf">parseInt</span> <span class="n">cs</span> <span class="ow">=</span> <span class="n">read</span> <span class="n">cs</span> <span class="ow">::</span> <span class="kt">Int</span>

<span class="nf">parseClockTime</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">ClockTime</span>
<span class="nf">parseClockTime</span> <span class="n">cs</span> <span class="ow">=</span> <span class="kt">TOD</span> <span class="p">(</span><span class="n">toInteger</span> <span class="n">secs</span><span class="p">)</span> <span class="mi">0</span>
                    <span class="kr">where</span> <span class="n">secs</span> <span class="ow">=</span> <span class="n">foldl&#39;</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">s</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span> <span class="mi">0</span> <span class="o">$</span>
                                 <span class="n">map</span> <span class="p">(</span><span class="n">parseInt</span> <span class="o">.</span> <span class="kt">T</span><span class="o">.</span><span class="n">unpack</span><span class="p">)</span> <span class="o">$</span>
                                 <span class="kt">T</span><span class="o">.</span><span class="n">split</span> <span class="p">(</span><span class="kt">T</span><span class="o">.</span><span class="n">pack</span> <span class="s">&quot;:&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">T</span><span class="o">.</span><span class="n">pack</span> <span class="n">cs</span><span class="p">)</span>

<span class="nf">liftAcP</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">String</span> <span class="ow">-&gt;</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">PSField</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
<span class="nf">liftAcP</span> <span class="n">a</span> <span class="n">p</span> <span class="n">f</span> <span class="n">v</span> <span class="n">s</span> <span class="ow">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">$</span> <span class="p">(</span><span class="n">fst</span> <span class="n">s</span><span class="p">)</span> <span class="o">!!</span> <span class="n">i</span><span class="p">)</span> <span class="p">`</span><span class="n">f</span><span class="p">`</span> <span class="n">v</span>
                    <span class="kr">where</span> <span class="n">i</span> <span class="ow">=</span> <span class="kr">case</span> <span class="p">(</span><span class="n">a</span> <span class="p">`</span><span class="n">elemIndex</span><span class="p">`</span> <span class="n">psFields</span><span class="p">)</span> <span class="kr">of</span>
                                <span class="kt">Just</span> <span class="n">n</span>  <span class="ow">-&gt;</span> <span class="n">n</span>
                                <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="ne">error</span> <span class="o">$</span> <span class="s">&quot;Wrong ps field: &quot;</span> <span class="o">++</span> <span class="n">a</span>

<span class="nf">flagsP</span>   <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;flags&quot;</span>   <span class="n">parseInt</span>
<span class="nf">uidP</span>     <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;uid&quot;</span>     <span class="n">parseInt</span>
<span class="nf">pidP</span>     <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;pid&quot;</span>     <span class="n">parseInt</span>
<span class="nf">ppidP</span>    <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;ppid&quot;</span>    <span class="n">parseInt</span>
<span class="nf">priP</span>     <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;pri&quot;</span>     <span class="n">parseInt</span>
<span class="nf">niceP</span>    <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;nice&quot;</span>    <span class="n">id</span>
<span class="nf">sizeP</span>    <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;size&quot;</span>    <span class="n">parseInt</span>
<span class="nf">rssP</span>     <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;rss&quot;</span>     <span class="n">parseInt</span>
<span class="nf">wchanP</span>   <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;wchan&quot;</span>   <span class="n">id</span>
<span class="nf">statP</span>    <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;stat&quot;</span>    <span class="n">id</span>
<span class="nf">ttyP</span>     <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;tty&quot;</span>     <span class="n">id</span>
<span class="nf">timeP</span>    <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;time&quot;</span>    <span class="n">parseClockTime</span>
<span class="nf">commandP</span> <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;command&quot;</span> <span class="n">id</span>

<span class="nf">liftOpP</span> <span class="n">o</span> <span class="n">x</span> <span class="n">y</span> <span class="n">s</span> <span class="ow">=</span> <span class="p">(</span><span class="n">x</span> <span class="n">s</span><span class="p">)</span> <span class="p">`</span><span class="n">o</span><span class="p">`</span> <span class="p">(</span><span class="n">y</span> <span class="n">s</span><span class="p">)</span>

<span class="p">(</span><span class="o">&amp;&amp;?</span><span class="p">)</span>    <span class="ow">=</span> <span class="n">liftOpP</span> <span class="p">(</span><span class="o">&amp;&amp;</span><span class="p">)</span>
<span class="kr">infixr</span> <span class="mi">3</span> <span class="o">&amp;&amp;?</span>

<span class="p">(</span><span class="o">||?</span><span class="p">)</span>    <span class="ow">=</span> <span class="n">liftOpP</span> <span class="p">(</span><span class="o">||</span><span class="p">)</span>
<span class="kr">infixr</span> <span class="mi">2</span> <span class="o">||?</span>


<span class="c1">-- Example Runs ----------------------------------------------------------------</span>

<span class="c1">-- You will need below ghc command line wrapper before using this script from</span>
<span class="c1">-- the command line.</span>

<span class="c1">--   $ cat PSGrep.sh</span>
<span class="c1">--   #!/bin/sh</span>
<span class="c1">--   ghc -e &quot;printPSFields \$ $@&quot; PSGrep.hs</span>

<span class="c1">-- Rest is trivial...</span>

<span class="c1">--   $ ./PSGrep.sh &#39;flagsP (==) 0 &amp;&amp;? sizeP (&lt;) 1024&#39;</span>
<span class="c1">--   0     0  3019     1  19   0   256   504 -      Ss+  tty2     00:00:00 /sbin/getty 38400 tty2</span>
<span class="c1">--   0     0  3020     1  19   0   256   508 -      Ss+  tty3     00:00:00 /sbin/getty 38400 tty3</span>
<span class="c1">--   0     0  3022     1  19   0   256   500 -      Ss+  tty4     00:00:00 /sbin/getty 38400 tty4</span>
<span class="c1">--   0     0  3023     1  19   0   256   504 -      Ss+  tty5     00:00:00 /sbin/getty 38400 tty5</span>
<span class="c1">--   0     0  3024     1  19   0   256   504 -      Ss+  tty6     00:00:00 /sbin/getty 38400 tty6</span>

			 
<span class="c1">----------------------------------------------------------------------------------------------------</span>
<span class="c1">-- @@PLEAC@@_2.1</span>
<span class="c1">-- using readIO</span>
<span class="nf">is_integer</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">catch</span> <span class="p">(</span><span class="kr">do</span> <span class="n">readIO</span> <span class="n">s</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="kt">Int</span>
                         <span class="n">putStrLn</span> <span class="s">&quot;is an integer&quot;</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">\</span><span class="kr">_</span> <span class="ow">-&gt;</span> <span class="n">putStrLn</span> <span class="s">&quot;is not&quot;</span><span class="p">)</span>

<span class="c1">-- using regexp</span>
<span class="nf">is_integer</span> <span class="ow">=</span> <span class="n">isJust</span> <span class="o">.</span> <span class="n">matchRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;^[+-]?[0-9]+$&quot;</span><span class="p">)</span>

<span class="c1">-- using reads</span>
<span class="nf">read_maybe</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">reads</span> <span class="n">s</span> <span class="kr">of</span>
                 <span class="p">[</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">Just</span> <span class="n">v</span>
                 <span class="kr">_</span> <span class="ow">-&gt;</span> <span class="kt">Nothing</span>

<span class="nf">is_integer</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">isJust</span> <span class="p">(</span><span class="n">read_maybe</span> <span class="n">s</span> <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">Int</span><span class="p">)</span>
<span class="nf">is_float</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">isJust</span> <span class="p">(</span><span class="n">read_maybe</span> <span class="n">s</span> <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">Double</span><span class="p">)</span>

<span class="c1">-- @@PLEAC@@_2.2</span>

<span class="c1">-- equal_num num1 num2 accuracy : returns true if num1 and num2 are</span>
<span class="c1">--   equal to accuracy number of decimal places</span>
<span class="nf">equal_num</span> <span class="n">n1</span> <span class="n">n2</span> <span class="n">accuracy</span> <span class="ow">=</span> <span class="n">abs</span> <span class="p">(</span><span class="n">n1</span> <span class="o">-</span> <span class="n">n2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">^^</span> <span class="p">(</span><span class="o">-</span><span class="n">accuracy</span><span class="p">)</span>

<span class="nf">wage</span> <span class="ow">=</span> <span class="mi">536</span>          <span class="c1">-- $5.36/hour</span>
<span class="nf">week</span> <span class="ow">=</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">wage</span>    <span class="c1">-- $214.40</span>
<span class="nf">weekwage</span> <span class="ow">::</span> <span class="kt">String</span>
<span class="nf">weekwage</span> <span class="ow">=</span> <span class="n">printf</span> <span class="s">&quot;One week&#39;s wage is: $%.2f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">(</span><span class="n">week</span> <span class="o">/</span> <span class="mi">100</span> <span class="ow">::</span> <span class="kt">Double</span><span class="p">)</span>

<span class="c1">-- @@PLEAC@@_2.3</span>
<span class="nf">rounded</span> <span class="ow">=</span> <span class="n">round</span> <span class="n">unrounded</span>

<span class="nf">a</span> <span class="ow">=</span> <span class="mf">0.255</span> <span class="ow">::</span> <span class="kt">Double</span>
<span class="nf">b</span> <span class="ow">=</span> <span class="n">printf</span> <span class="s">&quot;%.2f&quot;</span> <span class="n">a</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;Unrounded: &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">a</span> <span class="o">++</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Rounded: &quot;</span> <span class="o">++</span> <span class="n">b</span><span class="p">)</span>
       <span class="n">printf</span> <span class="s">&quot;Unrounded: %f</span><span class="se">\n</span><span class="s">Rounded: %.2f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">a</span> <span class="n">a</span>
<span class="c1">-- Unrounded: 0.255</span>
<span class="c1">-- Rounded: 0.26</span>
<span class="c1">-- Unrounded: 0.255</span>
<span class="c1">-- Rounded: 0.26</span>


<span class="nf">a</span> <span class="ow">=</span> <span class="p">[</span><span class="mf">3.3</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">3.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.3</span><span class="p">]</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="kr">let</span> <span class="n">l</span> <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">n</span> <span class="ow">-&gt;</span> <span class="n">printf</span> <span class="s">&quot;%.1f</span><span class="se">\t</span><span class="s">%d</span><span class="se">\t</span><span class="s">%d</span><span class="se">\t</span><span class="s">%d&quot;</span> <span class="p">(</span><span class="n">n</span> <span class="ow">::</span> <span class="kt">Double</span><span class="p">)</span> <span class="p">(</span><span class="n">truncate</span> <span class="n">n</span> <span class="ow">::</span> <span class="kt">Int</span><span class="p">)</span>
                                                 <span class="p">(</span><span class="n">floor</span> <span class="n">n</span> <span class="ow">::</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">(</span><span class="n">ceiling</span> <span class="n">n</span> <span class="ow">::</span> <span class="kt">Int</span><span class="p">))</span> <span class="n">a</span> <span class="kr">in</span>
    <span class="n">putStrLn</span> <span class="p">(</span><span class="n">unlines</span> <span class="o">$</span> <span class="s">&quot;number</span><span class="se">\t</span><span class="s">trncate</span><span class="se">\t</span><span class="s">floor</span><span class="se">\t</span><span class="s">ceiling&quot;</span> <span class="kt">:</span> <span class="n">l</span><span class="p">)</span>

<span class="c1">-- nb: to have a better looking output, use %4.1f and %2d instead of %.1f and %d</span>

<span class="c1">-- @@PLEAC@@_2.4</span>
<span class="nf">bin2dec</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span>
<span class="nf">bin2dec</span> <span class="ow">=</span> <span class="n">foldr</span> <span class="p">(</span><span class="nf">\</span><span class="n">c</span> <span class="n">s</span> <span class="ow">-&gt;</span> <span class="n">s</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="mi">0</span> <span class="o">.</span> <span class="n">reverse</span> <span class="o">.</span> <span class="n">map</span> <span class="n">c2i</span>
    <span class="kr">where</span> <span class="n">c2i</span> <span class="n">c</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;0&#39;</span> <span class="kr">then</span> <span class="mi">0</span> <span class="kr">else</span> <span class="mi">1</span>
<span class="c1">-- bin2dec &quot;0110110&quot; == 54</span>

<span class="nf">dec2bin</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">i2c</span> <span class="o">.</span> <span class="n">reverse</span> <span class="o">.</span> <span class="n">unfoldr</span> <span class="n">decomp</span>
    <span class="kr">where</span> <span class="n">decomp</span> <span class="n">n</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span> <span class="kt">Nothing</span> <span class="kr">else</span> <span class="kt">Just</span><span class="p">(</span><span class="n">n</span> <span class="p">`</span><span class="n">mod</span><span class="p">`</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="p">`</span><span class="n">div</span><span class="p">`</span> <span class="mi">2</span><span class="p">)</span>
          <span class="n">i2c</span> <span class="n">i</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span> <span class="sc">&#39;0&#39;</span> <span class="kr">else</span> <span class="sc">&#39;1&#39;</span>
<span class="c1">-- dec2bin 54 == &quot;110110&quot;</span>

<span class="cm">{-</span>
<span class="cm">import Test.QuickCheck</span>
<span class="cm">property_bindec n = n &gt;= 0 ==&gt; (bin2dec . dec2bin) n == n</span>
<span class="cm">verif = quickCheck property_bindec</span>
<span class="cm">-}</span>

<span class="c1">-- @@PLEAC@@_2.5</span>

<span class="c1">-- clean &amp; pure way:</span>
<span class="nf">m1</span> <span class="ow">=</span> <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;Infancy is: &quot;</span> <span class="o">++</span> <span class="n">unwords</span> <span class="p">(</span><span class="n">map</span> <span class="n">show</span> <span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="mi">2</span><span class="p">])</span>
<span class="c1">-- Infancy is: 0 1 2 </span>

<span class="c1">-- imperative way:</span>
<span class="nf">m2</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">putStr</span> <span class="s">&quot;Infancy is: &quot;</span>
        <span class="n">mapM_</span> <span class="p">(</span><span class="n">printf</span> <span class="s">&quot;%d &quot;</span><span class="p">)</span> <span class="p">[</span><span class="mi">0</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="o">..</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">putStrLn</span> <span class="s">&quot;&quot;</span>

<span class="c1">-- imperative way&#39;:</span>
<span class="nf">m2&#39;</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">putStr</span> <span class="s">&quot;Infancy is: &quot;</span>
         <span class="n">mapM_</span> <span class="p">(</span><span class="nf">\</span><span class="n">n</span> <span class="ow">-&gt;</span> <span class="n">putStr</span> <span class="o">$</span> <span class="n">show</span> <span class="n">n</span> <span class="o">++</span> <span class="s">&quot; &quot;</span><span class="p">)</span> <span class="p">[</span><span class="mi">0</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="o">..</span> <span class="mi">2</span><span class="p">]</span>
         <span class="n">putStrLn</span> <span class="s">&quot;&quot;</span>

<span class="c1">-- [0,2..8] == [0,2,4,6,8]</span>

<span class="c1">-- @@PLEAC@@_2.6</span>
<span class="nf">roman</span> <span class="n">n</span> <span class="ow">=</span> <span class="n">concat</span> <span class="o">$</span> <span class="n">reverse</span> <span class="o">$</span> <span class="n">snd</span> <span class="o">$</span> <span class="n">mapAccumL</span> <span class="n">transform</span> <span class="n">n</span> <span class="n">sets</span>
    <span class="kr">where</span>
      <span class="n">transform</span> <span class="n">n</span> <span class="n">set</span> <span class="ow">=</span> <span class="p">(</span><span class="n">n</span> <span class="p">`</span><span class="n">div</span><span class="p">`</span> <span class="mi">10</span><span class="p">,</span> <span class="n">roman</span> <span class="n">set</span> <span class="p">(</span><span class="n">n</span> <span class="p">`</span><span class="n">mod</span><span class="p">`</span> <span class="mi">10</span><span class="p">))</span>
      <span class="n">roman</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="n">n</span> <span class="ow">=</span> <span class="n">l</span> <span class="o">!!</span> <span class="n">n</span>
          <span class="kr">where</span> <span class="n">l</span> <span class="ow">=</span> <span class="p">[</span> <span class="kt">[]</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">v</span><span class="p">],</span> <span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">]</span> <span class="p">]</span>
      <span class="n">sets</span> <span class="ow">=</span> <span class="p">[(</span><span class="sc">&#39;I&#39;</span><span class="p">,</span><span class="sc">&#39;V&#39;</span><span class="p">,</span><span class="sc">&#39;X&#39;</span><span class="p">),</span> <span class="p">(</span><span class="sc">&#39;X&#39;</span><span class="p">,</span><span class="sc">&#39;L&#39;</span><span class="p">,</span><span class="sc">&#39;C&#39;</span><span class="p">),</span> <span class="p">(</span><span class="sc">&#39;C&#39;</span><span class="p">,</span><span class="sc">&#39;D&#39;</span><span class="p">,</span><span class="sc">&#39;M&#39;</span><span class="p">),</span> <span class="p">(</span><span class="sc">&#39;M&#39;</span><span class="p">,</span><span class="n">too_big</span><span class="p">,</span><span class="n">too_big</span><span class="p">)]</span> 
      <span class="n">too_big</span> <span class="ow">=</span> <span class="ne">error</span> <span class="s">&quot;roman: number greater than 3999&quot;</span>

<span class="nf">arabic</span> <span class="ow">=</span> <span class="n">sum</span> <span class="o">.</span> <span class="n">snd</span> <span class="o">.</span> <span class="n">mapAccumL</span> <span class="n">set_sign</span> <span class="mi">0</span> <span class="o">.</span> <span class="n">map</span> <span class="n">c2i</span> <span class="o">.</span> <span class="n">reverse</span>
    <span class="kr">where</span>
      <span class="c1">-- if the roman digit is smaller than biggest digit so far, substract it (eg: I is -1 in IV)</span>
      <span class="n">set_sign</span> <span class="n">max</span> <span class="n">i</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">max</span> <span class="kr">then</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="kr">else</span> <span class="p">(</span><span class="n">max</span><span class="p">,</span> <span class="o">-</span><span class="n">i</span><span class="p">)</span>
      <span class="n">c2i</span> <span class="n">c</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">toUpper</span> <span class="n">c</span> <span class="kr">of</span> 
                <span class="sc">&#39;I&#39;</span> <span class="ow">-&gt;</span> <span class="mi">1</span><span class="p">;</span> <span class="sc">&#39;V&#39;</span> <span class="ow">-&gt;</span> <span class="mi">5</span><span class="p">;</span> <span class="sc">&#39;X&#39;</span> <span class="ow">-&gt;</span> <span class="mi">10</span><span class="p">;</span> <span class="sc">&#39;L&#39;</span> <span class="ow">-&gt;</span> <span class="mi">50</span> 
                <span class="sc">&#39;C&#39;</span> <span class="ow">-&gt;</span> <span class="mi">100</span><span class="p">;</span> <span class="sc">&#39;D&#39;</span> <span class="ow">-&gt;</span> <span class="mi">500</span><span class="p">;</span> <span class="sc">&#39;M&#39;</span> <span class="ow">-&gt;</span> <span class="mi">1000</span>

<span class="nf">roman_fifteen</span> <span class="ow">=</span> <span class="n">roman</span> <span class="mi">15</span> <span class="c1">-- &quot;XV&quot;</span>
<span class="nf">s1</span> <span class="ow">=</span> <span class="s">&quot;Roman for fifteen is &quot;</span> <span class="o">++</span> <span class="n">roman_fifteen</span>
<span class="nf">arabic_fifteen</span> <span class="ow">=</span> <span class="n">arabic</span> <span class="n">roman_fifteen</span>
<span class="nf">s2</span> <span class="ow">=</span> <span class="s">&quot;Converted back, &quot;</span> <span class="o">++</span> <span class="n">roman_fifteen</span> <span class="o">++</span> <span class="s">&quot; is &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">arabic_fifteen</span>

<span class="cm">{-</span>
<span class="cm">property_roman_arabic n = n &gt;= 0 &amp;&amp; n &lt; 4000 ==&gt; (arabic . roman) n == n</span>
<span class="cm">verif = quickCheck property_roman_arabic</span>
<span class="cm">-}</span>

<span class="c1">-- @@PLEAC@@_2.7</span>
<span class="kr">import</span> <span class="nn">Random</span>
<span class="kr">import</span> <span class="nn">Control.Monad</span> <span class="p">(</span><span class="nf">replicateM</span><span class="p">)</span>

<span class="nf">rand</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">Int</span>
<span class="nf">rand</span> <span class="n">low</span> <span class="n">high</span> <span class="ow">=</span> <span class="n">getStdRandom</span> <span class="p">(</span><span class="n">randomR</span> <span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">))</span>

<span class="nf">n</span> <span class="ow">=</span> <span class="n">rand</span> <span class="mi">25</span> <span class="mi">75</span> <span class="c1">-- [25,75]</span>

<span class="nf">random_elt</span> <span class="n">l</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">i</span> <span class="ow">&lt;-</span> <span class="n">rand</span> <span class="mi">0</span> <span class="p">(</span><span class="n">length</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                  <span class="n">return</span> <span class="p">(</span><span class="n">l</span> <span class="o">!!</span> <span class="n">i</span><span class="p">)</span>

<span class="nf">password</span> <span class="ow">=</span> <span class="n">replicateM</span> <span class="mi">8</span> <span class="p">(</span><span class="n">random_elt</span> <span class="n">chars</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">chars</span> <span class="ow">=</span> <span class="n">concat</span> <span class="p">[</span> <span class="p">[</span><span class="sc">&#39;A&#39;</span><span class="o">..</span><span class="sc">&#39;Z&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">&#39;a&#39;</span><span class="o">..</span><span class="n">&#39;z&#39;</span><span class="p">],</span> <span class="p">[</span><span class="sc">&#39;0&#39;</span><span class="o">..</span><span class="sc">&#39;9&#39;</span><span class="p">],</span> <span class="s">&quot;!@$%^&amp;*&quot;</span> <span class="p">]</span>


<span class="c1">-- random_elt can be also be written</span>
<span class="nf">random_elt&#39;</span> <span class="n">l</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="p">(</span><span class="n">l</span> <span class="o">!!</span><span class="p">)</span> <span class="p">(</span><span class="n">rand</span> <span class="mi">0</span> <span class="o">$</span> <span class="n">length</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">-- @@PLEAC@@_2.8</span>
<span class="nf">srand</span> <span class="ow">=</span> <span class="n">setStdGen</span> <span class="o">.</span> <span class="n">mkStdGen</span>

<span class="nf">randfixed</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">srand</span> <span class="mi">2</span>
	       <span class="n">rand</span> <span class="mi">1</span> <span class="mi">10</span>

<span class="c1">-- @@PLEAC@@_2.9</span>
<span class="c1">-- you can provide your own random generator by playing with the StdGen type</span>

<span class="c1">-- @@PLEAC@@_2.10</span>
<span class="nf">std_rand</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="kt">Double</span>
<span class="nf">std_rand</span> <span class="ow">=</span> <span class="n">getStdRandom</span> <span class="p">(</span><span class="n">randomR</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="nf">gaussian_rand</span> <span class="ow">=</span> 
    <span class="kr">do</span> <span class="n">r1</span> <span class="ow">&lt;-</span> <span class="n">std_rand</span>
       <span class="n">r2</span> <span class="ow">&lt;-</span> <span class="n">std_rand</span>
       <span class="kr">let</span> <span class="n">u1</span> <span class="ow">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">r1</span> <span class="o">-</span> <span class="mi">1</span>
       <span class="kr">let</span> <span class="n">u2</span> <span class="ow">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">r2</span> <span class="o">-</span> <span class="mi">1</span>
       <span class="kr">let</span> <span class="n">w</span>  <span class="ow">=</span> <span class="n">u1</span><span class="o">*</span><span class="n">u1</span> <span class="o">+</span> <span class="n">u2</span><span class="o">*</span><span class="n">u2</span> <span class="c1">-- variance</span>
       <span class="kr">if</span> <span class="n">w</span> <span class="o">&gt;=</span> <span class="mi">1</span> 
         <span class="kr">then</span> <span class="n">gaussian_rand</span>
         <span class="kr">else</span> <span class="kr">let</span> <span class="n">w2</span> <span class="ow">=</span> <span class="n">sqrt</span> <span class="p">((</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">log</span> <span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">w</span><span class="p">)</span> <span class="kr">in</span> 
              <span class="n">return</span> <span class="p">(</span><span class="n">u2</span><span class="o">*</span><span class="n">w2</span><span class="p">,</span> <span class="n">u1</span><span class="o">*</span><span class="n">w2</span><span class="p">)</span> <span class="c1">-- gaussian-distributed numbers</span>

<span class="nf">mean</span> <span class="ow">=</span> <span class="mi">25</span>
<span class="nf">sdev</span> <span class="ow">=</span> <span class="mi">2</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">&lt;-</span> <span class="n">gaussian_rand</span> 
       <span class="kr">let</span> <span class="n">salary</span> <span class="ow">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">sdev</span> <span class="o">+</span> <span class="n">mean</span>
       <span class="n">printf</span> <span class="s">&quot;You have been hired at $%.2f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">salary</span>

<span class="c1">-- @@PLEAC@@_2.11</span>
<span class="nf">deg2rad</span> <span class="n">d</span> <span class="ow">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
<span class="nf">rad2deg</span> <span class="n">r</span> <span class="ow">=</span> <span class="n">r</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">pi</span>

<span class="nf">degree_sine</span> <span class="ow">=</span> <span class="n">sin</span> <span class="o">.</span> <span class="n">deg2rad</span>

<span class="c1">-- @@PLEAC@@_2.12</span>
<span class="nf">asin_val</span> <span class="ow">=</span> <span class="n">asin</span> <span class="mi">1</span>
<span class="nf">acos_val</span> <span class="ow">=</span> <span class="n">acos</span> <span class="mi">1</span>

<span class="c1">-- @@PLEAC@@_2.13</span>
<span class="nf">v</span> <span class="ow">=</span> <span class="n">log</span> <span class="mi">10</span>

<span class="nf">log10</span> <span class="ow">=</span> <span class="n">logBase</span> <span class="mi">10</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;log10(10,000)=&quot;</span> <span class="o">++</span> <span class="n">log10</span> <span class="mi">10000</span>
<span class="c1">-- log10(10,000) = 4</span>

<span class="c1">-- @@PLEAC@@_2.14</span>
<span class="c1">-- no standard matrix function in haskell library</span>
<span class="c1">-- here is a simple implementation</span>
<span class="c1">-- see also http://darcs.haskell.org/hugs98/demos/Matrix.hs</span>
<span class="c1">--       or http://darcs.haskell.org/nofib/ghc/matrix/Matrix.hs</span>

<span class="nf">sum_product</span> <span class="ow">::</span> <span class="kt">Num</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="n">a</span>
<span class="nf">sum_product</span> <span class="n">u</span> <span class="n">v</span> <span class="ow">=</span> <span class="n">sum</span> <span class="p">(</span><span class="n">zipWith</span> <span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">u</span> <span class="n">v</span><span class="p">)</span>

<span class="nf">matrix_zipWith</span> <span class="n">f</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="p">[</span><span class="n">zipWith</span> <span class="n">f</span> <span class="n">ak</span> <span class="n">bk</span> <span class="o">|</span> <span class="p">(</span><span class="n">ak</span><span class="p">,</span><span class="n">bk</span><span class="p">)</span> <span class="ow">&lt;-</span> <span class="n">zip</span> <span class="n">a</span> <span class="n">b</span><span class="p">]</span>

<span class="nf">add_matrices</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="n">matrix_zipWith</span> <span class="p">(</span><span class="o">+</span><span class="p">)</span>

<span class="nf">inner_product</span> <span class="ow">::</span> <span class="kt">Num</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="p">[[</span><span class="n">a</span><span class="p">]]</span> <span class="ow">-&gt;</span> <span class="p">[[</span><span class="n">a</span><span class="p">]]</span> <span class="ow">-&gt;</span> <span class="p">[[</span><span class="n">a</span><span class="p">]]</span>
<span class="nf">inner_product</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="n">mult</span> <span class="n">a</span> <span class="p">(</span><span class="n">transpose</span> <span class="n">b</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">mult</span> <span class="kt">[]</span> <span class="kr">_</span> <span class="ow">=</span> <span class="kt">[]</span>
          <span class="n">mult</span> <span class="p">(</span><span class="n">a_x</span><span class="kt">:</span><span class="n">a_xs</span><span class="p">)</span> <span class="n">b</span> <span class="ow">=</span> <span class="p">[</span><span class="n">sum_product</span> <span class="n">a_x</span> <span class="n">bi</span> <span class="o">|</span> <span class="n">bi</span> <span class="ow">&lt;-</span> <span class="n">b</span><span class="p">]</span> <span class="kt">:</span> <span class="n">mult</span> <span class="n">a_xs</span> <span class="n">b</span>

<span class="nf">a</span> <span class="ow">=</span> <span class="p">[</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span> <span class="p">]</span>
<span class="nf">b</span> <span class="ow">=</span> <span class="p">[</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
    <span class="p">,</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="p">,</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="p">]</span>
<span class="nf">c</span> <span class="ow">=</span> <span class="n">inner_product</span> <span class="n">a</span> <span class="n">b</span>

<span class="c1">-- @@PLEAC@@_2.15</span>
<span class="kr">import</span> <span class="nn">Complex</span>

<span class="nf">a</span> <span class="ow">=</span> <span class="mi">3</span> <span class="kt">:+</span> <span class="mi">5</span>    <span class="c1">-- 3 + 5i</span>
<span class="nf">b</span> <span class="ow">=</span> <span class="mi">2</span> <span class="kt">:+</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="c1">-- 2 - 2i</span>
<span class="nf">c</span> <span class="ow">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>     <span class="c1">-- 16 + 4i</span>

<span class="nf">t1</span> <span class="ow">=</span> <span class="p">(</span><span class="n">realPart</span> <span class="n">c</span><span class="p">,</span> <span class="n">imagPart</span> <span class="n">c</span><span class="p">,</span> <span class="n">conjugate</span> <span class="n">c</span><span class="p">)</span> <span class="c1">--  16, 4, 16-4i</span>

<span class="nf">d</span> <span class="ow">=</span> <span class="mi">3</span> <span class="kt">:+</span> <span class="mi">4</span>
<span class="nf">t2</span> <span class="ow">=</span> <span class="n">sqrt</span> <span class="n">d</span>  <span class="c1">-- 2 + i</span>

<span class="c1">-- @@PLEAC@@_2.16</span>
<span class="c1">-- &quot;read&quot; handles both octal and hexadecimal when prefixed with 0x or 0o</span>
<span class="c1">-- here are versions adding the prefix and calling &quot;read&quot;</span>
<span class="nf">hex</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">read</span> <span class="p">(</span><span class="s">&quot;0x&quot;</span> <span class="o">++</span> <span class="n">s</span><span class="p">)</span> <span class="ow">::</span> <span class="kt">Integer</span>
<span class="nf">oct</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">read</span> <span class="p">(</span><span class="s">&quot;0o&quot;</span> <span class="o">++</span> <span class="n">s</span><span class="p">)</span> <span class="ow">::</span> <span class="kt">Integer</span>

<span class="c1">-- hex &quot;45&quot; == 69</span>
<span class="c1">-- oct &quot;45&quot; == 37</span>
<span class="c1">-- hex &quot;45foo&quot; =&gt; Exception: Prelude.read: no parse</span>

<span class="c1">-- calling explicitly readHex or readOct:</span>
<span class="nf">hex</span> <span class="ow">=</span> <span class="n">fst</span> <span class="o">.</span> <span class="n">head</span> <span class="o">.</span> <span class="kt">Numeric</span><span class="o">.</span><span class="n">readHex</span>
<span class="nf">oct</span> <span class="ow">=</span> <span class="n">fst</span> <span class="o">.</span> <span class="n">head</span> <span class="o">.</span> <span class="kt">Numeric</span><span class="o">.</span><span class="n">readOct</span>

<span class="c1">-- one need to flush between putStr and getLine,</span>
<span class="c1">--   it would not be needed if we had printer a newline</span>
<span class="c1">-- the other solution is to disable buffering with hSetBuffering</span>
<span class="nf">putStr_getLine</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">putStr</span> <span class="n">s</span>
                      <span class="n">hFlush</span> <span class="n">stdout</span>
                      <span class="n">getLine</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">s</span> <span class="ow">&lt;-</span> <span class="n">putStr_getLine</span> <span class="s">&quot;Gimme a number in decimal, octal, or hex: &quot;</span>
       <span class="kr">let</span> <span class="n">n</span> <span class="ow">=</span> <span class="n">read</span> <span class="n">s</span> <span class="ow">::</span> <span class="kt">Integer</span>
       <span class="n">printf</span> <span class="s">&quot;%d %x %o</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">n</span> <span class="n">n</span> <span class="n">n</span>

<span class="nf">t&#39;</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">permissions</span> <span class="ow">&lt;-</span> <span class="n">putStr_getLine</span> <span class="s">&quot;Enter file permission in octal: &quot;</span>
	<span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;The decimal value is &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="p">(</span><span class="n">oct</span> <span class="n">permissions</span><span class="p">)</span>


<span class="c1">-- @@PLEAC@@_2.17</span>
<span class="kr">import</span> <span class="nn">Data.List</span>
<span class="c1">-- (using groupNelem from &quot;Helpers&quot;)</span>
<span class="nf">commify</span> <span class="ow">=</span> <span class="n">reverse</span> <span class="o">.</span> <span class="n">intercalate</span> <span class="s">&quot;,&quot;</span> <span class="o">.</span> <span class="n">groupNelem</span> <span class="mi">3</span> <span class="o">.</span> <span class="n">reverse</span>
<span class="c1">-- commify &quot;-1740525205&quot; == &quot;-1,740,525,205&quot;</span>

<span class="c1">-- a version handling decimal numbers (using subRegexOnceWith from &quot;Helpers&quot;)</span>
<span class="nf">commify&#39;</span> <span class="ow">=</span> <span class="n">subRegexOnceWith</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;[0-9]+&quot;</span><span class="p">)</span> <span class="n">commify</span>
<span class="c1">-- commify&#39; &quot;-1740525205.000001&quot; == &quot;-1,740,525,205.000001&quot;</span>


<span class="c1">-- @@PLEAC@@_2.18</span>
<span class="nf">hours</span> <span class="ow">=</span> <span class="mi">2</span>
<span class="nf">s</span> <span class="ow">=</span> <span class="s">&quot;It took &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">hours</span> <span class="o">++</span> <span class="s">&quot; hour&quot;</span> <span class="o">++</span> <span class="kr">if</span> <span class="n">hours</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span> <span class="s">&quot;&quot;</span> <span class="kr">else</span> <span class="s">&quot;s&quot;</span>

<span class="nf">s2</span> <span class="ow">=</span> <span class="n">printf</span> <span class="n">fmt</span> <span class="p">(</span><span class="n">hours</span> <span class="ow">::</span> <span class="kt">Int</span><span class="p">)</span> <span class="ow">::</span> <span class="kt">String</span>
    <span class="kr">where</span> <span class="n">fmt</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">hours</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span> <span class="s">&quot;%d hour is enough.</span><span class="se">\n</span><span class="s">&quot;</span> <span class="kr">else</span> <span class="s">&quot;%d hours are enough.</span><span class="se">\n</span><span class="s">&quot;</span>


<span class="c1">-- subRegex doesn&#39;t return wether it succeeded or not</span>
<span class="c1">-- calling matchRegex first</span>
<span class="nf">subRegexMaybe</span> <span class="ow">::</span> <span class="kt">Regex</span> <span class="ow">-&gt;</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">String</span>
<span class="nf">subRegexMaybe</span> <span class="n">re</span> <span class="n">s</span> <span class="n">repla</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">matchRegex</span> <span class="n">re</span> <span class="n">s</span> <span class="c1">-- discard the result</span>
                              <span class="kt">Just</span> <span class="p">(</span><span class="n">subRegex</span> <span class="n">re</span> <span class="n">s</span> <span class="n">repla</span><span class="p">)</span>

<span class="nf">subRegexMany</span> <span class="ow">::</span> <span class="p">[(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">)]</span> <span class="ow">-&gt;</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">String</span>
<span class="nf">subRegexMany</span> <span class="n">regexps</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">msum</span> <span class="p">(</span><span class="n">map</span> <span class="n">try_one</span> <span class="n">regexps</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">try_one</span> <span class="p">(</span><span class="n">re</span><span class="p">,</span> <span class="n">repla</span><span class="p">)</span> <span class="ow">=</span> <span class="n">subRegexMaybe</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="n">re</span><span class="p">)</span> <span class="n">s</span> <span class="n">repla</span>
<span class="c1">-- note the use of msum to take the first (Just _) in the list</span>
<span class="c1">-- here msum is used with type [Maybe a] -&gt; Maybe a</span>

<span class="nf">noun_plural</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">fromMaybe</span> <span class="p">(</span><span class="ne">error</span> <span class="s">&quot;can&#39;t get here&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">subRegexMany</span> <span class="n">regexps</span> <span class="n">s</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">regexps</span> <span class="ow">=</span> <span class="p">[</span> <span class="p">(</span><span class="s">&quot;ss$&quot;</span><span class="p">,</span> <span class="s">&quot;sses&quot;</span><span class="p">)</span>
                    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;([psc]h)$&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">1es&quot;</span><span class="p">)</span>
                    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;z$&quot;</span><span class="p">,</span> <span class="s">&quot;zes&quot;</span><span class="p">)</span>
                    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;ff$&quot;</span><span class="p">,</span> <span class="s">&quot;ffs&quot;</span><span class="p">)</span>
                    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;f$&quot;</span><span class="p">,</span> <span class="s">&quot;ves&quot;</span><span class="p">)</span>
                    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;ey$&quot;</span><span class="p">,</span> <span class="s">&quot;eys&quot;</span><span class="p">)</span>
                    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;y$&quot;</span><span class="p">,</span> <span class="s">&quot;ies&quot;</span><span class="p">)</span>
                    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;ix$&quot;</span><span class="p">,</span> <span class="s">&quot;ices&quot;</span><span class="p">)</span>
                    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;([sx])$&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">1es&quot;</span><span class="p">)</span>
                    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;(.)$&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">1s&quot;</span><span class="p">)</span> <span class="c1">-- note that subRegex is unsafe if the regexp matches an empty strings, cf documentation</span>
                    <span class="p">]</span>

<span class="nf">s</span> <span class="ow">=</span> <span class="n">unlines</span> <span class="o">$</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">s</span> <span class="ow">-&gt;</span> <span class="s">&quot;One &quot;</span> <span class="o">++</span> <span class="n">s</span> <span class="o">++</span> <span class="s">&quot;, two &quot;</span> <span class="o">++</span> <span class="n">noun_plural</span> <span class="n">s</span> <span class="o">++</span> <span class="s">&quot;.&quot;</span><span class="p">)</span> <span class="o">$</span> <span class="n">words</span> <span class="n">test_words</span>
    <span class="kr">where</span> <span class="n">test_words</span> <span class="ow">=</span> <span class="s">&quot;fish fly ox </span><span class="se">\</span>
<span class="se">                       \</span><span class="s">species genus phylum </span><span class="se">\</span>
<span class="se">                       \</span><span class="s">cherub radius jockey </span><span class="se">\</span>
<span class="se">                       \</span><span class="s">index matrix mythos </span><span class="se">\</span>
<span class="se">                       \</span><span class="s">phenomenon formula&quot;</span>

<span class="c1">-- @@PLEAC@@_2.19</span>
<span class="o">#!/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">runghc</span>

<span class="kr">import</span> <span class="nn">List</span>
<span class="kr">import</span> <span class="nn">System</span>
<span class="kr">import</span> <span class="nn">Text.Printf</span>

<span class="c1">-- from http://haskell.org/haskellwiki/99_questions/31_to_41#Problem_36</span>
<span class="nf">encode</span> <span class="ow">::</span> <span class="kt">Eq</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="p">[(</span><span class="n">a</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)]</span>
<span class="nf">encode</span> <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">head</span> <span class="n">x</span><span class="p">,</span> <span class="n">length</span> <span class="n">x</span><span class="p">))</span> <span class="o">.</span> <span class="n">group</span>

<span class="nf">primeFactors</span> <span class="n">n</span> <span class="ow">=</span> <span class="n">factor</span> <span class="n">n</span> <span class="n">primes</span>
  <span class="kr">where</span> <span class="n">factor</span> <span class="n">n</span> <span class="p">(</span><span class="n">p</span><span class="kt">:</span><span class="n">ps</span><span class="p">)</span> <span class="o">|</span> <span class="n">p</span><span class="o">*</span><span class="n">p</span> <span class="o">&gt;</span> <span class="n">n</span> <span class="ow">=</span> <span class="p">[</span><span class="n">n</span><span class="p">]</span>
                        <span class="o">|</span> <span class="n">n</span> <span class="p">`</span><span class="n">mod</span><span class="p">`</span> <span class="n">p</span> <span class="o">/=</span> <span class="mi">0</span> <span class="ow">=</span> <span class="n">factor</span> <span class="n">n</span> <span class="n">ps</span>
                        <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="n">p</span> <span class="kt">:</span> <span class="n">factor</span> <span class="p">(</span><span class="n">n</span> <span class="p">`</span><span class="n">div</span><span class="p">`</span> <span class="n">p</span><span class="p">)</span> <span class="p">(</span><span class="n">p</span><span class="kt">:</span><span class="n">ps</span><span class="p">)</span>
        <span class="n">primes</span> <span class="ow">=</span> <span class="mi">2</span> <span class="kt">:</span> <span class="n">filter</span> <span class="p">((</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="o">.</span> <span class="n">length</span> <span class="o">.</span> <span class="n">primeFactors</span><span class="p">)</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="o">..</span><span class="p">]</span>

<span class="nf">main</span> <span class="ow">=</span> <span class="n">getArgs</span> <span class="o">&gt;&gt;=</span> <span class="n">mapM_</span> <span class="n">do_one</span>
    <span class="kr">where</span> <span class="n">do_one</span> <span class="n">n</span> <span class="ow">=</span> <span class="n">printf</span> <span class="s">&quot;%-10s %s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">n</span> <span class="p">(</span><span class="n">to_string</span> <span class="o">$</span> <span class="n">encode</span> <span class="o">$</span> <span class="n">primeFactors</span> <span class="o">$</span> <span class="n">read</span> <span class="n">n</span><span class="p">)</span>
          <span class="n">to_string</span> <span class="p">[(</span><span class="kr">_</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span> <span class="ow">=</span> <span class="s">&quot;PRIME&quot;</span>
          <span class="n">to_string</span> <span class="n">l</span> <span class="ow">=</span> <span class="n">unwords</span> <span class="o">$</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">power</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">show</span> <span class="n">n</span> <span class="o">++</span> <span class="n">to_string_power</span> <span class="n">power</span><span class="p">)</span> <span class="n">l</span>
          <span class="n">to_string_power</span> <span class="n">p</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span> <span class="s">&quot;&quot;</span> <span class="kr">else</span> <span class="s">&quot;**&quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">p</span>

<span class="cm">{-</span>
<span class="cm">% bigfact  8 9 96 2178</span>
<span class="cm">8          2**3</span>
<span class="cm">9          3**2</span>
<span class="cm">96         2**5 3</span>
<span class="cm">2178       2 3**2 11**2</span>
<span class="cm">% bigfact 239322000000000000000000</span>
<span class="cm">239322000000000000000000 2**19 3 5**18 39887</span>
<span class="cm">% bigfact 25000000000000000000000000</span>
<span class="cm">25000000000000000000000000 2**24 5**26</span>
<span class="cm">-}</span>


<span class="c1">-- @@PLEAC@@_3.0</span>
<span class="c1">-- you can use haskell-98 standard module:</span>
<span class="kr">import</span> <span class="nn">Time</span>

<span class="nf">date</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="n">show</span> <span class="n">getClockTime</span>   <span class="c1">-- &quot;Wed Apr 25 19:43:29 CEST 2007&quot;</span>
<span class="nf">localtime</span> <span class="ow">=</span> <span class="n">getClockTime</span> <span class="o">&gt;&gt;=</span> <span class="n">toCalendarTime</span>
<span class="c1">-- =&gt; CalendarTime {ctYear = 2007, ctMonth = April, ctDay = 25, ctHour = 19, ctMin = 46, ctSec = 41, ctPicosec = 214805000000, ctWDay = Wednesday, ctYDay = 114, ctTZName = &quot;CEST&quot;, ctTZ = 7200, ctIsDST = True}</span>

<span class="nf">utc_time</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="n">toUTCTime</span> <span class="n">getClockTime</span>
<span class="c1">-- =&gt; CalendarTime {ctYear = 2007, ctMonth = April, ctDay = 25, ctHour = 17, ctMin = 47, ctSec = 59, ctPicosec = 325921000000, ctWDay = Wednesday, ctYDay = 114, ctTZName = &quot;UTC&quot;, ctTZ = 0, ctIsDST = False}</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">tm</span> <span class="ow">&lt;-</span> <span class="n">localtime</span>
       <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;Today is day &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="p">(</span><span class="n">ctYDay</span> <span class="n">tm</span><span class="p">)</span> <span class="o">++</span> <span class="s">&quot; of the current year&quot;</span>
<span class="c1">-- =&gt; Today is day 114 of the current year</span>


<span class="c1">-- or you can use new &quot;time library&quot;:</span>
<span class="kr">import</span> <span class="nn">Data.Time</span>

<span class="nf">date</span> <span class="ow">=</span> <span class="n">getCurrentTime</span>
<span class="c1">-- &quot;2008-04-18 14:11:22.476894 UTC&quot;</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">today</span> <span class="ow">&lt;-</span> <span class="n">fmap</span> <span class="n">utctDay</span> <span class="n">getCurrentTime</span>      
       <span class="kr">let</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">toGregorian</span> <span class="n">today</span>
       <span class="kr">let</span> <span class="n">days</span> <span class="ow">=</span> <span class="n">diffDays</span> <span class="n">today</span> <span class="p">(</span><span class="n">fromGregorian</span> <span class="n">year</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span>
       <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;Today is day &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">days</span> <span class="o">++</span> <span class="s">&quot; of the current year&quot;</span>
<span class="c1">-- =&gt; Today is day 108 of the current year</span>

<span class="c1">-- @@PLEAC@@_3.1</span>
<span class="kr">import</span> <span class="nn">Data.Time</span>
<span class="kr">import</span> <span class="nn">System.Locale</span> <span class="p">(</span><span class="nf">defaultTimeLocale</span><span class="p">)</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">tm</span> <span class="ow">&lt;-</span> <span class="n">getCurrentTime</span>
       <span class="kr">let</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span> <span class="ow">=</span> <span class="n">toGregorian</span> <span class="p">(</span><span class="n">utctDay</span> <span class="n">tm</span><span class="p">)</span>
       <span class="n">printf</span> <span class="s">&quot;The current date is %04d %02d %02d</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">year</span> <span class="n">month</span> <span class="n">day</span>

<span class="nf">t2</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">tm</span> <span class="ow">&lt;-</span> <span class="n">getCurrentTime</span>
        <span class="n">return</span> <span class="o">$</span> <span class="s">&quot;The current date is &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="p">(</span><span class="n">utctDay</span> <span class="n">tm</span><span class="p">)</span>
<span class="c1">-- The current date is 2008-04-18</span>

<span class="nf">t3</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="p">(</span><span class="n">formatTime</span> <span class="n">defaultTimeLocale</span> <span class="s">&quot;%Y-%m-%d&quot;</span><span class="p">)</span> <span class="n">getCurrentTime</span>
<span class="c1">-- =&gt; 2008-04-18</span>

<span class="c1">-- @@PLEAC@@_3.2</span>
<span class="kr">import</span> <span class="nn">Data.Time</span>
<span class="kr">import</span> <span class="nn">Data.Time.Clock.POSIX</span>

<span class="c1">-- !! epoch is not the &quot;base&quot; value in Data.Time, so do not use it unless you !!</span>
<span class="c1">-- !! really need it !!</span>

<span class="c1">-- if you want epoch, use:</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="n">getPOSIXTime</span>                <span class="c1">-- 1208529250.856017s</span>

<span class="c1">-- if you want to get epoch from a time, use:</span>
<span class="nf">t2</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="n">utcTimeToPOSIXSeconds</span> <span class="n">getCurrentTime</span> <span class="c1">-- 1208529250.856017s</span>

<span class="c1">-- @@PLEAC@@_3.3</span>
<span class="kr">import</span> <span class="nn">System.Time</span>
<span class="kr">import</span> <span class="nn">Data.Time</span>
<span class="kr">import</span> <span class="nn">Data.Time.Clock.POSIX</span>

<span class="nf">epoch</span> <span class="ow">=</span> <span class="mi">111111</span>
<span class="nf">t1</span> <span class="ow">=</span> <span class="n">posixSecondsToUTCTime</span> <span class="n">epoch</span>      <span class="c1">-- 1970-01-02 06:51:51 UTC</span>
<span class="nf">t2</span> <span class="ow">=</span> <span class="n">timeToTimeOfDay</span> <span class="p">(</span><span class="n">utctDayTime</span> <span class="n">t1</span><span class="p">)</span> <span class="c1">-- 06:51:51</span>

<span class="c1">-- @@PLEAC@@_3.4</span>
<span class="kr">import</span> <span class="nn">Data.Time</span>

<span class="nf">ten_seconds_before</span> <span class="ow">=</span> <span class="n">addUTCTime</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">now</span> <span class="ow">&lt;-</span> <span class="n">getCurrentTime</span>
       <span class="n">return</span> <span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="n">ten_seconds_before</span> <span class="n">now</span><span class="p">)</span>
<span class="c1">-- (2008-04-18 14:48:33.075113 UTC,</span>
<span class="c1">--  2008-04-18 14:48:23.075113 UTC)</span>

<span class="c1">-- ten_seconds_before can also be written:</span>
<span class="nf">ten_seconds_before</span> <span class="p">(</span><span class="kt">UTCTime</span> <span class="n">day</span> <span class="n">time</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">UTCTime</span> <span class="n">day</span> <span class="p">(</span><span class="n">time</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
<span class="nf">ten_seconds_before</span> <span class="n">t</span> <span class="ow">=</span> <span class="n">t</span> <span class="p">{</span> <span class="n">utctDayTime</span> <span class="ow">=</span> <span class="n">utctDayTime</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">10</span> <span class="p">}</span>


<span class="nf">birth_date</span> <span class="ow">=</span> <span class="n">fromGregorian</span> <span class="mi">1973</span> <span class="mi">1</span> <span class="mi">18</span>
<span class="nf">t</span>  <span class="ow">=</span> <span class="s">&quot;Nat was 55 days old on: &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="p">(</span><span class="n">addDays</span> <span class="mi">55</span> <span class="n">birth_date</span><span class="p">)</span>
<span class="c1">-- Nat was 55 days old on: 1973-03-14</span>

<span class="c1">-- @@PLEAC@@_3.5</span>
<span class="kr">import</span> <span class="nn">Data.Time</span>
<span class="kr">import</span> <span class="nn">Data.Time.Clock.POSIX</span>

<span class="nf">bree</span> <span class="ow">=</span> <span class="kt">UTCTime</span> <span class="p">(</span><span class="n">fromGregorian</span> <span class="mi">1981</span> <span class="mi">6</span> <span class="mi">16</span><span class="p">)</span> <span class="p">(</span><span class="n">timeOfDayToTime</span> <span class="o">$</span> <span class="kt">TimeOfDay</span> <span class="mi">4</span> <span class="mi">35</span> <span class="mi">25</span><span class="p">)</span> <span class="c1">-- 1981-06-16 04:35:25 UTC</span>
<span class="nf">nat</span>  <span class="ow">=</span> <span class="kt">UTCTime</span> <span class="p">(</span><span class="n">fromGregorian</span> <span class="mi">1973</span> <span class="mi">1</span> <span class="mi">18</span><span class="p">)</span> <span class="p">(</span><span class="n">timeOfDayToTime</span> <span class="o">$</span> <span class="kt">TimeOfDay</span> <span class="mi">3</span> <span class="mi">45</span> <span class="mi">50</span><span class="p">)</span> <span class="c1">-- 1973-01-18 03:45:50 UTC</span>
<span class="c1">-- or simpler:</span>
<span class="nf">bree&#39;</span> <span class="ow">=</span> <span class="n">read</span> <span class="s">&quot;1981-06-16 04:35:25&quot;</span> <span class="ow">::</span> <span class="kt">UTCTime</span>
<span class="nf">nat&#39;</span>  <span class="ow">=</span> <span class="n">read</span> <span class="s">&quot;1973-01-18 03:45:50&quot;</span> <span class="ow">::</span> <span class="kt">UTCTime</span>

<span class="nf">difference</span> <span class="ow">=</span> <span class="n">diffUTCTime</span> <span class="n">bree</span> <span class="n">nat</span> <span class="o">/</span> <span class="n">posixDayLength</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="s">&quot;There were &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">show</span> <span class="o">$</span> <span class="n">round</span> <span class="n">difference</span><span class="p">)</span> <span class="o">++</span> <span class="s">&quot; days between Nat and Bree&quot;</span>
<span class="c1">-- There were 3071 days between Nat and Bree</span>

<span class="nf">toFloat</span> <span class="n">n</span> <span class="ow">=</span> <span class="n">realToFrac</span> <span class="n">n</span> <span class="ow">::</span> <span class="kt">Float</span>
<span class="nf">t2</span> <span class="ow">=</span> <span class="n">printf</span> <span class="s">&quot;There were %.2f days between Nat and Bree&quot;</span> <span class="p">(</span><span class="n">toFloat</span> <span class="n">difference</span><span class="p">)</span> <span class="ow">::</span> <span class="kt">String</span>
<span class="c1">-- There were 3071.03 days between Nat and Bree</span>

<span class="c1">-- @@PLEAC@@_3.6</span>
<span class="kr">import</span> <span class="nn">Data.Time</span>
<span class="kr">import</span> <span class="nn">Data.Time.Calendar.MonthDay</span>
<span class="kr">import</span> <span class="nn">Data.Time.Calendar.OrdinalDate</span>
<span class="kr">import</span> <span class="nn">Locale</span>

<span class="p">(</span><span class="nf">year</span><span class="p">,</span> <span class="nf">month</span><span class="p">,</span> <span class="nf">day</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="mi">1981</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">printf</span> <span class="s">&quot;%d/%d/%d was a %s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">year</span> <span class="n">month</span> <span class="n">day</span> <span class="n">week_day_name</span>
       <span class="n">printf</span> <span class="s">&quot;%d/%d/%d was day %d of the week %d</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">year</span> <span class="n">month</span> <span class="n">day</span> <span class="n">week_day</span> <span class="n">week</span>
       <span class="n">printf</span> <span class="s">&quot;%d/%d/%d was day %d of month %d</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">year</span> <span class="n">month</span> <span class="n">day</span> <span class="n">month_day</span> <span class="n">month_</span>
       <span class="n">printf</span> <span class="s">&quot;%d/%d/%d was day %d of year %d</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">year</span> <span class="n">month</span> <span class="n">day</span> <span class="n">year_day</span> <span class="n">year_</span>
    <span class="kr">where</span> <span class="n">date</span> <span class="ow">=</span> <span class="p">(</span><span class="n">fromGregorian</span> <span class="n">year</span> <span class="n">month</span> <span class="n">day</span><span class="p">)</span>
          <span class="p">(</span><span class="n">week</span><span class="p">,</span> <span class="n">week_day</span><span class="p">)</span> <span class="ow">=</span> <span class="n">sundayStartWeek</span> <span class="n">date</span>
          <span class="p">(</span><span class="kr">_</span><span class="p">,</span> <span class="n">month_</span><span class="p">,</span> <span class="n">month_day</span><span class="p">)</span> <span class="ow">=</span> <span class="n">toGregorian</span> <span class="n">date</span>
          <span class="p">(</span><span class="n">year_</span><span class="p">,</span> <span class="n">year_day</span><span class="p">)</span> <span class="ow">=</span> <span class="n">toOrdinalDate</span> <span class="n">date</span>
          <span class="p">(</span><span class="n">week_day_name</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">wDays</span> <span class="n">defaultTimeLocale</span> <span class="o">!!</span> <span class="n">week_day</span>
<span class="c1">-- 1981/6/16 was a Tuesday</span>
<span class="c1">-- 1981/6/16 was day 2 of the week 24</span>
<span class="c1">-- 1981/6/16 was day 16 of month 6</span>
<span class="c1">-- 1981/6/16 was day 167 of year 1981</span>

<span class="c1">-- @@PLEAC@@_3.7</span>
<span class="kr">import</span> <span class="nn">Data.Time</span>
<span class="kr">import</span> <span class="nn">Data.Time.Format</span>
<span class="kr">import</span> <span class="nn">Data.Time.Clock.POSIX</span>
<span class="kr">import</span> <span class="nn">Locale</span>

<span class="nf">day</span> <span class="ow">::</span> <span class="kt">Day</span>
<span class="nf">day</span> <span class="ow">=</span> <span class="n">readTime</span> <span class="n">defaultTimeLocale</span> <span class="s">&quot;%F&quot;</span> <span class="s">&quot;1998-06-03&quot;</span>

<span class="c1">-- calculate epoch seconds at midnight on that day in UTC</span>
<span class="nf">epoch</span> <span class="ow">=</span> <span class="n">utcTimeToPOSIXSeconds</span> <span class="p">(</span><span class="kt">UTCTime</span> <span class="n">day</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1">-- 896832000s</span>

<span class="c1">-- readTime can return a UTCTime:</span>
<span class="nf">epoch_</span> <span class="ow">=</span> <span class="n">utcTimeToPOSIXSeconds</span> <span class="p">(</span><span class="n">readTime</span> <span class="n">defaultTimeLocale</span> <span class="s">&quot;%F&quot;</span> <span class="s">&quot;1998-06-03&quot;</span><span class="p">)</span>

<span class="c1">-- it seems readTime is not flexible, </span>
<span class="c1">-- for example &quot;%d/%m/%Y&quot; can&#39;t handle 16/6/1981, only 16/06/1981</span>
<span class="c1">--</span>
<span class="c1">-- here is an alternative solution, using regexp</span>
<span class="kr">import</span> <span class="nn">Data.Time</span>
<span class="kr">import</span> <span class="nn">Data.Time.Clock.POSIX</span>
<span class="kr">import</span> <span class="nn">Text.Regex</span>

<span class="nf">day</span> <span class="ow">=</span> <span class="n">fromGregorian</span> <span class="p">(</span><span class="n">read</span> <span class="n">year</span><span class="p">)</span> <span class="p">(</span><span class="n">read</span> <span class="n">month</span><span class="p">)</span> <span class="p">(</span><span class="n">read</span> <span class="n">day</span><span class="p">)</span>
      <span class="kr">where</span> <span class="kt">Just</span> <span class="p">[</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">]</span> <span class="ow">=</span> <span class="n">matchRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;(.*)-(.*)-(.*)&quot;</span><span class="p">)</span> <span class="s">&quot;1998-06-03&quot;</span>
<span class="c1">-- 1998-06-03</span>

<span class="c1">-- @@PLEAC@@_3.8</span>
<span class="c1">-- formatTime from Data.Time.Format allow powerful time formatting:</span>
<span class="kr">import</span> <span class="nn">Data.Time</span>
<span class="kr">import</span> <span class="nn">Data.Time.Format</span>
<span class="kr">import</span> <span class="nn">Locale</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">now</span> <span class="ow">&lt;-</span> <span class="n">getCurrentTime</span>
       <span class="n">return</span> <span class="o">$</span> <span class="n">formatTime</span> <span class="n">defaultTimeLocale</span> <span class="s">&quot;The date is %A (%a) %d/%m/%Y&quot;</span> <span class="n">now</span>
<span class="c1">-- &quot;The date is Tuesday (Tue) 28/10/2008&quot;</span>

<span class="c1">-- @@PLEAC@@_3.9</span>
<span class="c1">-- getCurrentTime/UTCTime has a precision of 1 picosecond, full precision is used by default</span>
<span class="kr">import</span> <span class="nn">Data.Time</span>
<span class="kr">import</span> <span class="nn">System.Posix.Unistd</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">t1</span> <span class="ow">&lt;-</span> <span class="n">getCurrentTime</span>
       <span class="n">usleep</span> <span class="mi">100000</span> <span class="c1">-- 100ms</span>
       <span class="n">t2</span> <span class="ow">&lt;-</span> <span class="n">getCurrentTime</span>
       <span class="n">return</span> <span class="p">(</span><span class="n">diffUTCTime</span> <span class="n">t2</span> <span class="n">t1</span><span class="p">)</span>
<span class="c1">-- 0.111262s</span>

<span class="c1">-- @@PLEAC@@_3.10</span>
<span class="c1">-- short sleeps:</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">usleep</span> <span class="mi">3100000</span>

<span class="c1">-- for even more precision, nanosleep is available</span>

<span class="c1">-- @@PLEAC@@_3.11</span>
<span class="c1">-- <font size="-1"><a href="http://pleac.sourceforge.net/include/haskell/MailHop.hs</span>">download the following standalone program</a></font>
<span class="kr">module</span> <span class="nn">Main</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="nn">Data.Char</span> <span class="p">(</span><span class="nf">toLower</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Data.Fixed</span> <span class="p">(</span><span class="nf">divMod&#39;</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Data.List</span> <span class="p">(</span><span class="nf">intersperse</span><span class="p">,</span> <span class="nf">isInfixOf</span><span class="p">,</span> <span class="nf">foldl&#39;</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">System.Environment</span> <span class="p">(</span><span class="nf">getArgs</span><span class="p">)</span>

<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Codec.MIME.Parse</span>       <span class="k">as</span> <span class="n">MIME</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Time.Clock</span>        <span class="k">as</span> <span class="n">CLOCK</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Time.Format</span>       <span class="k">as</span> <span class="n">TIME</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">System.Locale</span>          <span class="k">as</span> <span class="n">LOCALE</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Text.Regex.PCRE.String</span> <span class="k">as</span> <span class="n">PCRE</span>

<span class="kr">data</span> <span class="kt">ServerHeader</span> <span class="ow">=</span> <span class="kt">ServerHeader</span> <span class="p">{</span>
      <span class="n">receivedFrom</span> <span class="ow">::</span> <span class="kt">String</span>
    <span class="p">,</span> <span class="n">receivedBy</span>   <span class="ow">::</span> <span class="kt">String</span>
    <span class="p">,</span> <span class="n">receivedAt</span>   <span class="ow">::</span> <span class="kt">CLOCK</span><span class="o">.</span><span class="kt">UTCTime</span>
    <span class="p">}</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Show</span><span class="p">)</span>

<span class="nf">serverHeaderRegex</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="kt">PCRE</span><span class="o">.</span><span class="kt">Regex</span>
<span class="nf">serverHeaderRegex</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="kr">let</span> <span class="n">pattern</span> <span class="ow">=</span> <span class="s">&quot;from (.*) by (.*) with (.*); (.*)&quot;</span>
  <span class="n">compres</span> <span class="ow">&lt;-</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">compile</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">compBlank</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">execBlank</span> <span class="n">pattern</span>
  <span class="kr">case</span> <span class="n">compres</span> <span class="kr">of</span>
    <span class="kt">Left</span> <span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
        <span class="ow">-&gt;</span> <span class="ne">error</span> <span class="o">$</span>
           <span class="s">&quot;Regex pattern error&quot;</span> <span class="o">++</span>
           <span class="s">&quot; at offset &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">offset</span> <span class="o">++</span>
           <span class="s">&quot; for string: &quot;</span> <span class="o">++</span> <span class="n">string</span>
    <span class="kt">Right</span> <span class="n">regex</span>
        <span class="ow">-&gt;</span> <span class="n">return</span> <span class="n">regex</span>

<span class="nf">parseTime</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">CLOCK</span><span class="o">.</span><span class="kt">UTCTime</span>
<span class="nf">parseTime</span> <span class="n">time</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">parseres</span> <span class="kr">of</span>
                   <span class="kt">Just</span> <span class="n">utctime</span> <span class="ow">-&gt;</span> <span class="n">utctime</span>
                   <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="ne">error</span> <span class="o">$</span> <span class="s">&quot;Invalid data format: &quot;</span> <span class="o">++</span> <span class="n">time</span>
                 <span class="kr">where</span> <span class="n">parseres</span> <span class="ow">=</span> <span class="kt">TIME</span><span class="o">.</span><span class="n">parseTime</span>
                                  <span class="kt">LOCALE</span><span class="o">.</span><span class="n">defaultTimeLocale</span>
                                  <span class="s">&quot;%a, %e %b %Y %X %z (%Z)&quot;</span>
                                  <span class="n">time</span>
                                  <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">CLOCK</span><span class="o">.</span><span class="kt">UTCTime</span>

<span class="nf">parseServerHeader</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">ServerHeader</span>
<span class="nf">parseServerHeader</span> <span class="n">input</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="kr">let</span> <span class="n">header</span> <span class="ow">=</span> <span class="n">concat</span> <span class="o">$</span> <span class="n">intersperse</span> <span class="s">&quot; &quot;</span> <span class="o">$</span> <span class="n">words</span> <span class="n">input</span>
      <span class="n">headerWithFrom</span>  <span class="ow">=</span> <span class="kr">if</span> <span class="s">&quot;from&quot;</span> <span class="p">`</span><span class="n">isInfixOf</span><span class="p">`</span> <span class="n">header</span>
                        <span class="kr">then</span> <span class="n">header</span>
                        <span class="kr">else</span> <span class="s">&quot;from - &quot;</span> <span class="o">++</span> <span class="n">header</span>
  <span class="n">regex</span> <span class="ow">&lt;-</span> <span class="n">serverHeaderRegex</span>
  <span class="n">execres</span> <span class="ow">&lt;-</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">regexec</span> <span class="n">regex</span> <span class="n">headerWithFrom</span>
  <span class="kr">case</span> <span class="n">execres</span> <span class="kr">of</span>
    <span class="kt">Left</span> <span class="n">err</span> <span class="ow">-&gt;</span> <span class="ne">error</span> <span class="o">$</span> <span class="s">&quot;regexec WrapError &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">err</span> <span class="o">++</span> <span class="s">&quot;for: &quot;</span> <span class="o">++</span> <span class="n">input</span>
    <span class="kt">Right</span> <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="ne">error</span> <span class="o">$</span> <span class="s">&quot;Invalid server header: &quot;</span> <span class="o">++</span> <span class="n">headerWithFrom</span>
    <span class="kt">Right</span> <span class="p">(</span><span class="kt">Just</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="p">[</span><span class="n">from</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="n">time</span><span class="p">]))</span>
        <span class="ow">-&gt;</span> <span class="n">return</span> <span class="o">$</span> <span class="kt">ServerHeader</span> <span class="n">from</span> <span class="n">by</span> <span class="p">(</span><span class="n">parseTime</span> <span class="n">time</span><span class="p">)</span>

<span class="nf">parseServerHeaders</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="p">[</span><span class="kt">ServerHeader</span><span class="p">]</span>
<span class="nf">parseServerHeaders</span> <span class="n">contents</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="n">mapM</span> <span class="p">(</span><span class="n">parseServerHeader</span> <span class="o">.</span> <span class="n">snd</span><span class="p">)</span> <span class="o">$</span> <span class="n">reverse</span> <span class="o">$</span> <span class="n">filter</span> <span class="n">match</span> <span class="n">headers</span>
  <span class="kr">where</span> <span class="n">match</span>   <span class="ow">=</span> <span class="p">(</span><span class="o">==</span> <span class="s">&quot;received&quot;</span><span class="p">)</span> <span class="o">.</span> <span class="p">(</span><span class="n">map</span> <span class="n">toLower</span><span class="p">)</span> <span class="o">.</span> <span class="n">fst</span>
        <span class="n">headers</span> <span class="ow">=</span> <span class="n">fst</span> <span class="o">$</span> <span class="kt">MIME</span><span class="o">.</span><span class="n">parseHeaders</span> <span class="n">contents</span>

<span class="nf">prettifyTimeDiff</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">Real</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
<span class="nf">prettifyTimeDiff</span> <span class="n">diff</span> <span class="ow">=</span>
  <span class="n">concat</span> <span class="o">$</span> <span class="n">intersperse</span> <span class="s">&quot; &quot;</span> <span class="o">$</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">show</span> <span class="n">n</span> <span class="o">++</span> <span class="n">t</span><span class="p">)</span>
         <span class="o">$</span> <span class="kr">if</span> <span class="n">null</span> <span class="n">diffs</span> <span class="kr">then</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;s&quot;</span><span class="p">)]</span> <span class="kr">else</span> <span class="n">diffs</span>
  <span class="kr">where</span> <span class="n">merge</span> <span class="p">(</span><span class="n">tot</span><span class="p">,</span><span class="n">acc</span><span class="p">)</span> <span class="p">(</span><span class="n">sec</span><span class="p">,</span><span class="n">typ</span><span class="p">)</span> <span class="ow">=</span> <span class="kr">let</span> <span class="p">(</span><span class="n">sec&#39;</span><span class="p">,</span><span class="n">tot&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">divMod&#39;</span> <span class="n">tot</span> <span class="n">sec</span>
                                    <span class="kr">in</span> <span class="p">(</span><span class="n">tot&#39;</span><span class="p">,(</span><span class="n">sec&#39;</span><span class="p">,</span><span class="n">typ</span><span class="p">)</span><span class="kt">:</span><span class="n">acc</span><span class="p">)</span>
        <span class="n">metrics</span> <span class="ow">=</span> <span class="p">[(</span><span class="mi">86400</span><span class="p">,</span><span class="s">&quot;d&quot;</span><span class="p">),(</span><span class="mi">3600</span><span class="p">,</span><span class="s">&quot;h&quot;</span><span class="p">),(</span><span class="mi">60</span><span class="p">,</span><span class="s">&quot;m&quot;</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;s&quot;</span><span class="p">)]</span>
        <span class="n">diffs</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">((</span><span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">.</span> <span class="n">fst</span><span class="p">)</span> <span class="o">$</span> <span class="n">reverse</span> <span class="o">$</span> <span class="n">snd</span> <span class="o">$</span> <span class="n">foldl&#39;</span> <span class="n">merge</span> <span class="p">(</span><span class="n">diff</span><span class="p">,</span><span class="kt">[]</span><span class="p">)</span> <span class="n">metrics</span>

<span class="nf">printServerHeaders</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="nf">printServerHeaders</span> <span class="n">contents</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="n">headers</span> <span class="ow">&lt;-</span> <span class="n">parseServerHeaders</span> <span class="n">contents</span>
  <span class="n">mapM_</span> <span class="n">printHeader</span> <span class="p">(</span><span class="n">zip</span> <span class="n">headers</span> <span class="o">$</span> <span class="p">(</span><span class="n">head</span> <span class="n">headers</span><span class="p">)</span> <span class="kt">:</span> <span class="n">headers</span><span class="p">)</span>
  <span class="kr">where</span> <span class="n">printHeader</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="ow">=</span> <span class="kr">do</span>
          <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;after &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">prettifyTimeDiff</span> <span class="o">$</span> <span class="kt">CLOCK</span><span class="o">.</span><span class="n">diffUTCTime</span> <span class="p">(</span><span class="n">receivedAt</span> <span class="n">c</span><span class="p">)</span> <span class="p">(</span><span class="n">receivedAt</span> <span class="n">p</span><span class="p">))</span>
          <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot; from &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">receivedFrom</span> <span class="n">c</span><span class="p">)</span>
          <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;   by &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">receivedBy</span> <span class="n">c</span><span class="p">)</span>
          <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;   at &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">show</span> <span class="o">$</span> <span class="n">receivedAt</span> <span class="n">c</span><span class="p">)</span>

<span class="nf">main</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="n">args</span> <span class="ow">&lt;-</span> <span class="n">getArgs</span>
  <span class="kr">case</span> <span class="n">args</span> <span class="kr">of</span>
    <span class="kt">[]</span>         <span class="ow">-&gt;</span> <span class="n">getContents</span> <span class="o">&gt;&gt;=</span> <span class="n">printServerHeaders</span>
    <span class="p">[</span><span class="n">pathname</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="n">readFile</span> <span class="n">pathname</span> <span class="o">&gt;&gt;=</span> <span class="n">printServerHeaders</span>
    <span class="kr">_</span>          <span class="ow">-&gt;</span> <span class="ne">error</span> <span class="s">&quot;Arguments: [&lt;PATHNAME&gt;]&quot;</span>



<span class="c1">-- @@PLEAC@@_4.0</span>
<span class="nf">single_level</span> <span class="ow">=</span> <span class="p">[</span> <span class="s">&quot;this&quot;</span><span class="p">,</span> <span class="s">&quot;that&quot;</span><span class="p">,</span> <span class="s">&quot;the&quot;</span><span class="p">,</span> <span class="s">&quot;other&quot;</span> <span class="p">]</span>

<span class="c1">-- there is no non-homogeneous list. You can do things with tuples:</span>
<span class="nf">nested</span> <span class="ow">=</span> <span class="p">(</span><span class="s">&quot;this&quot;</span><span class="p">,</span> <span class="s">&quot;that&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;the&quot;</span><span class="p">,</span> <span class="s">&quot;other&quot;</span><span class="p">])</span> <span class="c1">-- (String, String, [String])</span>

<span class="c1">-- arrays are generally eschewed in Haskell, lists are prefered.</span>
<span class="c1">-- arrays are useful if you desperately need:</span>
<span class="c1">-- * huge amounts of raw data.</span>
<span class="c1">-- * constant (O(1)) lookup =&gt; use Data.Array</span>
<span class="c1">-- * constant (O(1)) update =&gt; use Data.Array.IO, Data.Array.ST or Data.Array.Storable</span>
<span class="c1">--                             (or even Data.Array.Diff)</span>
<span class="c1">-- see http://haskell.org/haskellwiki/Cookbook#Arrays</span>
<span class="c1">-- and http://www.haskell.org/haskellwiki/Modern_array_libraries for more</span>

<span class="c1">-- creating an Array from a list:</span>
<span class="kr">import</span> <span class="nn">Data.Array</span>
<span class="nf">listToArray</span> <span class="ow">::</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">Array</span> <span class="kt">Int</span> <span class="n">a</span>
<span class="nf">listToArray</span> <span class="n">l</span> <span class="ow">=</span> <span class="n">listArray</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="n">l</span>

<span class="nf">a1</span> <span class="ow">=</span> <span class="n">listToArray</span> <span class="n">l1</span>
<span class="c1">-- =&gt; array (0,3) [(0,&quot;Crosby&quot;),(1,&quot;Stills&quot;),(2,&quot;Nash&quot;),(3,&quot;Young&quot;)]</span>

<span class="c1">-- getting back the list</span>
<span class="nf">l1&#39;</span> <span class="ow">=</span> <span class="n">elems</span> <span class="n">a1</span>


<span class="c1">-- creating an IOArray from a list:</span>
<span class="kr">import</span> <span class="nn">Data.Array.IO</span>
<span class="nf">listToIOArray</span> <span class="ow">::</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="p">(</span><span class="kt">IOArray</span> <span class="kt">Int</span> <span class="n">a</span><span class="p">)</span>
<span class="nf">listToIOArray</span> <span class="n">l</span> <span class="ow">=</span> <span class="n">newListArray</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="n">l</span>

<span class="nf">a1</span> <span class="ow">=</span> <span class="n">listToIOArray</span> <span class="n">l1</span>

<span class="nf">l1&#39;</span> <span class="ow">=</span> <span class="n">a1</span> <span class="o">&gt;&gt;=</span> <span class="n">getElems</span> 


<span class="c1">-- @@PLEAC@@_4.1</span>
<span class="nf">a</span>  <span class="ow">=</span> <span class="p">[</span> <span class="s">&quot;quick&quot;</span><span class="p">,</span> <span class="s">&quot;brown&quot;</span><span class="p">,</span> <span class="s">&quot;fox&quot;</span> <span class="p">]</span>
<span class="nf">a&#39;</span> <span class="ow">=</span> <span class="n">words</span> <span class="s">&quot;Why are you teasing me?&quot;</span>

<span class="nf">l</span> <span class="ow">=</span> <span class="n">lines</span> 
      <span class="s">&quot;The boy stood on the burning deck</span><span class="se">\n\</span>
<span class="se">      \</span><span class="s">It was as hot as glass.&quot;</span>

<span class="nf">big_array</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">s</span> <span class="ow">&lt;-</span> <span class="n">readFile</span> <span class="s">&quot;mydatafile&quot;</span>
               <span class="n">return</span> <span class="p">(</span><span class="n">lines</span> <span class="n">s</span><span class="p">)</span>
<span class="c1">-- more compact:</span>
<span class="nf">big_array</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="n">lines</span> <span class="p">(</span><span class="n">readFile</span> <span class="s">&quot;mydatafile&quot;</span><span class="p">)</span>


<span class="c1">-- using readProcess from &quot;Helpers&quot;</span>
<span class="nf">his_host</span> <span class="ow">=</span> <span class="s">&quot;www.haskell.org&quot;</span>
<span class="nf">host_info</span> <span class="ow">=</span> <span class="kr">do</span> <span class="kt">Right</span> <span class="n">info</span> <span class="ow">&lt;-</span> <span class="n">readProcess</span> <span class="s">&quot;nslookup&quot;</span> <span class="p">[</span><span class="n">his_host</span><span class="p">]</span> <span class="s">&quot;&quot;</span>
               <span class="n">return</span> <span class="n">info</span>

<span class="c1">-- calling ps on our running process</span>
<span class="kr">import</span> <span class="nn">System</span>
<span class="kr">import</span> <span class="nn">System.Posix</span> <span class="p">(</span><span class="nf">getProcessID</span><span class="p">)</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">id</span> <span class="ow">&lt;-</span> <span class="n">getProcessID</span>
       <span class="n">system</span> <span class="p">(</span><span class="s">&quot;ps &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">id</span><span class="p">)</span>

<span class="c1">-- @@PLEAC@@_4.2</span>
<span class="kr">import</span> <span class="nn">Data.List</span>
<span class="nf">commify_series</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
<span class="nf">commify_series</span> <span class="kt">[]</span>  <span class="ow">=</span> <span class="s">&quot;&quot;</span>
<span class="nf">commify_series</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>  <span class="ow">=</span> <span class="n">x</span>
<span class="nf">commify_series</span> <span class="n">xs</span>  <span class="ow">=</span> <span class="n">intercalate</span> <span class="s">&quot;, &quot;</span> <span class="p">(</span><span class="n">init</span> <span class="n">xs</span><span class="p">)</span> <span class="o">++</span> <span class="s">&quot; and &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">last</span> <span class="n">xs</span><span class="p">)</span>

<span class="nf">array</span> <span class="ow">=</span> <span class="p">[</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;yellow&quot;</span><span class="p">,</span> <span class="s">&quot;green&quot;</span><span class="p">]</span>
<span class="nf">s1</span> <span class="ow">=</span> <span class="s">&quot;I have &quot;</span> <span class="o">++</span> <span class="n">commify_series</span> <span class="n">array</span> <span class="o">++</span> <span class="s">&quot; marbles&quot;</span> <span class="c1">-- I have red, yellow and green marbles</span>
<span class="nf">s2</span> <span class="ow">=</span> <span class="s">&quot;I have &quot;</span> <span class="o">++</span> <span class="n">concat</span>  <span class="n">array</span> <span class="o">++</span> <span class="s">&quot; marbles&quot;</span> <span class="c1">-- I have redyellowgreen marbles</span>
<span class="nf">s3</span> <span class="ow">=</span> <span class="s">&quot;I have &quot;</span> <span class="o">++</span> <span class="n">unwords</span> <span class="n">array</span> <span class="o">++</span> <span class="s">&quot; marbles&quot;</span> <span class="c1">-- I have red yellow green marbles</span>

<span class="c1">-- @@PLEAC@@_4.3</span>
<span class="c1">-- arrays can&#39;t be resized</span>
<span class="c1">-- similar behaviour for lists explained below</span>

<span class="nf">what_about_that_list</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">unlines</span>
    <span class="p">[</span> <span class="s">&quot;The list now has &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="p">(</span><span class="n">length</span> <span class="n">x</span><span class="p">)</span> <span class="o">++</span> <span class="s">&quot; elements.&quot;</span>
    <span class="p">,</span> <span class="s">&quot;The index of the last element is &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="p">(</span><span class="n">length</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">++</span> <span class="s">&quot;.&quot;</span>
    <span class="p">,</span> <span class="s">&quot;Element .3 is`&quot;</span> <span class="o">++</span> <span class="n">x</span><span class="o">!!</span><span class="mi">3</span> <span class="o">++</span> <span class="s">&quot;&#39;.&quot;</span>
    <span class="p">]</span>

<span class="nf">l1</span> <span class="ow">=</span> <span class="p">[</span> <span class="s">&quot;Crosby&quot;</span><span class="p">,</span> <span class="s">&quot;Stills&quot;</span><span class="p">,</span> <span class="s">&quot;Nash&quot;</span><span class="p">,</span> <span class="s">&quot;Young&quot;</span> <span class="p">]</span>

<span class="c1">-- remove last element</span>
<span class="nf">l2</span> <span class="ow">=</span> <span class="n">init</span> <span class="n">l1</span>    <span class="c1">-- [&quot;Crosby&quot;, &quot;Stills&quot;, &quot;Nash&quot;]</span>

<span class="c1">-- keep 3 elements</span>
<span class="nf">l3</span> <span class="ow">=</span> <span class="n">take</span> <span class="mi">3</span> <span class="n">l1</span>  <span class="c1">-- [&quot;Crosby&quot;, &quot;Stills&quot;, &quot;Nash&quot;]</span>

<span class="c1">-- calling what_about_that_list on l2 or l3 would raise</span>
<span class="c1">--   *** Exception: Prelude.(!!): index too large</span>
<span class="c1">-- when accessing element .3</span>

<span class="c1">-- grow list</span>
<span class="nf">l4</span> <span class="ow">=</span> <span class="n">take</span> <span class="mi">10001</span> <span class="p">(</span><span class="n">l1</span> <span class="o">++</span> <span class="n">repeat</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="c1">-- same, but much less haskell&#39;ish, prefer above</span>
<span class="nf">l4&#39;</span> <span class="ow">=</span> <span class="n">l1</span> <span class="o">++</span> <span class="n">replicate</span> <span class="p">(</span><span class="mi">10001</span> <span class="o">-</span> <span class="n">length</span> <span class="n">l1</span><span class="p">)</span> <span class="s">&quot;&quot;</span>

<span class="c1">-- writing a function that grow and shrink a list is easy:</span>
<span class="nf">resize_list</span> <span class="n">n</span> <span class="n">default_val</span> <span class="n">l</span> <span class="ow">=</span> <span class="n">take</span> <span class="n">n</span> <span class="p">(</span><span class="n">l</span> <span class="o">++</span> <span class="n">repeat</span> <span class="n">default_val</span><span class="p">)</span>



<span class="c1">-- @@PLEAC@@_4.4</span>
<span class="nf">bad_users</span> <span class="ow">=</span> <span class="n">filter</span> <span class="n">is_valid_user</span> <span class="n">all_users</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="n">mapM_</span> <span class="n">complain</span> <span class="n">bad_users</span>

<span class="nf">t&#39;</span> <span class="ow">=</span> <span class="n">mapM_</span> <span class="n">do_it</span> <span class="n">all_users</span>
    <span class="kr">where</span> <span class="n">do_it</span> <span class="n">user</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">usage</span> <span class="ow">&lt;-</span> <span class="n">get_usage</span> <span class="n">user</span>
                          <span class="n">when</span> <span class="p">(</span><span class="n">usage</span> <span class="o">&gt;</span> <span class="n">max_quota</span><span class="p">)</span> <span class="p">(</span><span class="n">complain</span> <span class="n">user</span><span class="p">)</span>

<span class="c1">-- equivalent of &quot;env | sort&quot;</span>
<span class="kr">import</span> <span class="nn">System.Environment</span>
<span class="kr">import</span> <span class="nn">List</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="n">getEnvironment</span> <span class="o">&gt;&gt;=</span> <span class="n">putStr</span> <span class="o">.</span> <span class="n">format</span>
    <span class="kr">where</span> <span class="n">format</span> <span class="ow">=</span> <span class="n">unlines</span> <span class="o">.</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">var</span> <span class="o">++</span> <span class="s">&quot;=&quot;</span> <span class="o">++</span> <span class="n">val</span><span class="p">)</span> <span class="o">.</span> <span class="n">sort</span>

<span class="c1">-- display lines from &quot;who&quot; matching &quot;simonpj&quot; (readProcess is in &quot;Helpers&quot;)</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="kt">Right</span> <span class="n">s</span> <span class="ow">&lt;-</span> <span class="n">readProcess</span> <span class="s">&quot;who&quot;</span> <span class="kt">[]</span> <span class="s">&quot;&quot;</span>
       <span class="n">mapM_</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="n">filter</span> <span class="p">(</span><span class="s">&quot;simonpj&quot;</span> <span class="p">`</span><span class="n">isPrefixOf</span><span class="p">`)</span> <span class="o">$</span> <span class="n">lines</span> <span class="n">s</span><span class="p">)</span>

<span class="c1">-- print file with words reversed:</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="n">readFile</span> <span class="s">&quot;/etc/fstab&quot;</span> <span class="o">&gt;&gt;=</span> <span class="n">putStr</span> <span class="o">.</span> <span class="n">reverse_words_of_each_line</span>
    <span class="kr">where</span> <span class="n">reverse_words_of_each_line</span> <span class="ow">=</span> <span class="n">unlines</span> <span class="o">.</span> <span class="n">map</span> <span class="p">(</span><span class="n">unwords</span> <span class="o">.</span> <span class="n">reverse</span> <span class="o">.</span> <span class="n">words</span><span class="p">)</span> <span class="o">.</span> <span class="n">lines</span>

<span class="c1">-- modify every element</span>
<span class="nf">l</span> <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="p">)</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>          <span class="c1">-- [0,1,2]</span>

<span class="c1">-- multiply everything in a and b by seven</span>
<span class="nf">l</span> <span class="ow">=</span> <span class="p">[</span> <span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="p">[</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span> <span class="p">]),</span> <span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">])</span> <span class="p">]</span>
<span class="nf">l&#39;</span> <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">xs</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">map</span> <span class="p">(</span><span class="o">*</span> <span class="mi">7</span><span class="p">)</span> <span class="n">xs</span><span class="p">))</span> <span class="n">l</span>
<span class="c1">-- =&gt; [ (&quot;a&quot;, [ 3.5, 21 ]), (&quot;b&quot;, [ 0, 7 ]) ]</span>
<span class="c1">-- same using Arrow.second</span>
<span class="nf">l_&#39;</span> <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="kt">Arrow</span><span class="o">.</span><span class="n">second</span> <span class="o">$</span> <span class="n">map</span> <span class="p">(</span><span class="o">*</span> <span class="mi">7</span><span class="p">))</span> <span class="n">l</span>
<span class="c1">-- for a more cryptic version, replace Arrow.second with fmap</span>

<span class="c1">-- same using Data.Map</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Map</span> <span class="k">as</span> <span class="n">Map</span>
<span class="nf">m</span> <span class="ow">=</span> <span class="kt">Map</span><span class="o">.</span><span class="n">fromList</span> <span class="p">[</span> <span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="p">[</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span> <span class="p">]),</span> <span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">])</span> <span class="p">]</span>
<span class="nf">m&#39;</span> <span class="ow">=</span> <span class="kt">Map</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="n">map</span> <span class="p">(</span><span class="o">*</span> <span class="mi">7</span><span class="p">))</span> <span class="n">m</span> 


<span class="c1">-- @@PLEAC@@_4.5</span>
<span class="c1">-- not relevant in haskell since we have always kind of references</span>


<span class="c1">-- @@PLEAC@@_4.6</span>
<span class="nf">l</span> <span class="ow">=</span> <span class="n">nub</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span> <span class="p">]</span>  <span class="c1">-- [ 1, 2, 3, 5 ]</span>

<span class="c1">-- generate a list of users logged in, removing duplicates (readProcess is in &quot;Helpers&quot;)</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="kt">Right</span> <span class="n">s</span> <span class="ow">&lt;-</span> <span class="n">readProcess</span> <span class="s">&quot;who&quot;</span> <span class="kt">[]</span> <span class="s">&quot;&quot;</span>
       <span class="kr">let</span> <span class="n">users</span> <span class="ow">=</span> <span class="n">sort</span> <span class="o">$</span> <span class="n">nub</span> <span class="o">$</span> <span class="n">map</span> <span class="p">(</span><span class="n">head</span> <span class="o">.</span> <span class="n">words</span><span class="p">)</span> <span class="o">$</span> <span class="n">lines</span> <span class="n">s</span>
       <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;users logged in: &quot;</span> <span class="o">++</span> <span class="n">unwords</span> <span class="n">users</span><span class="p">)</span>


<span class="c1">-- @@PLEAC@@_4.7</span>
<span class="nf">l</span> <span class="ow">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span> <span class="p">]</span> <span class="o">\\</span> <span class="p">[</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span> <span class="p">]</span>         <span class="c1">-- [ 2 ]</span>

<span class="c1">-- beware of duplicates:</span>
<span class="nf">xs</span> <span class="ow">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span> <span class="p">]</span>
<span class="nf">ys</span> <span class="ow">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span> <span class="p">]</span>
<span class="nf">l1</span> <span class="ow">=</span> <span class="n">xs</span> <span class="o">\\</span> <span class="n">ys</span>                   <span class="c1">-- [ 1, 3, 3, 5 ]</span>
<span class="nf">l2</span> <span class="ow">=</span> <span class="n">nub</span> <span class="n">xs</span> <span class="o">\\</span> <span class="n">ys</span>               <span class="c1">-- [ 3, 5 ]</span>
<span class="nf">l3</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(`</span><span class="n">notElem</span><span class="p">`</span> <span class="n">ys</span><span class="p">)</span> <span class="n">xs</span>   <span class="c1">-- [ 3, 3, 5 ]</span>

<span class="c1">-- for faster operations, use Data.Set:</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Set</span> <span class="k">as</span> <span class="n">Set</span>
<span class="nf">l</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(`</span><span class="kt">Set</span><span class="o">.</span><span class="n">notMember</span><span class="p">`</span> <span class="kt">Set</span><span class="o">.</span><span class="n">fromList</span> <span class="p">[</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span> <span class="p">])</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span> <span class="p">]</span>
<span class="c1">-- =&gt; [ 2 ]</span>

<span class="nf">s1</span> <span class="ow">=</span> <span class="kt">Set</span><span class="o">.</span><span class="n">fromList</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span> <span class="p">]</span>
<span class="nf">s2</span> <span class="ow">=</span> <span class="kt">Set</span><span class="o">.</span><span class="n">fromList</span> <span class="p">[</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span> <span class="p">]</span>
<span class="nf">s3</span> <span class="ow">=</span> <span class="kt">Set</span><span class="o">.\\</span> <span class="n">s1</span> <span class="n">s2</span>


<span class="c1">-- @@PLEAC@@_4.8</span>
<span class="nf">a</span> <span class="ow">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="nf">b</span> <span class="ow">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>

<span class="nf">l1</span> <span class="ow">=</span> <span class="n">a</span> <span class="p">`</span><span class="n">intersect</span><span class="p">`</span> <span class="n">b</span>            <span class="c1">-- [ 3, 5, 7 ]</span>
<span class="nf">l2</span> <span class="ow">=</span> <span class="n">a</span> <span class="p">`</span><span class="n">union</span><span class="p">`</span> <span class="n">b</span>                <span class="c1">-- [ 1, 3, 5, 6, 7, 8, 2, 9 ]</span>
<span class="nf">l3</span> <span class="ow">=</span> <span class="n">a</span> <span class="o">\\</span> <span class="n">b</span>                     <span class="c1">-- [ 1, 6, 8 ]</span>

<span class="c1">-- see also union and intersection in Data.Set</span>


<span class="c1">-- @@PLEAC@@_4.9</span>
<span class="nf">l</span> <span class="ow">=</span> <span class="p">[</span> <span class="s">&quot;Time&quot;</span><span class="p">,</span> <span class="s">&quot;Flies&quot;</span> <span class="p">]</span>
<span class="nf">l2</span> <span class="ow">=</span> <span class="n">l</span> <span class="o">++</span> <span class="p">[</span> <span class="s">&quot;An&quot;</span><span class="p">,</span> <span class="s">&quot;Arrow&quot;</span> <span class="p">]</span>   <span class="c1">-- [&quot;Time&quot;, &quot;Flies&quot;, &quot;An&quot;, &quot;Arrow&quot;]</span>

<span class="nf">insertAt</span> <span class="n">n</span> <span class="n">e</span> <span class="n">l</span> <span class="ow">=</span> <span class="n">before</span> <span class="o">++</span> <span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">++</span> <span class="n">after</span>
    <span class="kr">where</span> <span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">)</span> <span class="ow">=</span> <span class="n">splitAt</span> <span class="n">n</span> <span class="n">l</span>

<span class="nf">l3</span> <span class="ow">=</span> <span class="n">insertAt</span> <span class="mi">2</span> <span class="s">&quot;Like&quot;</span> <span class="n">l2</span> <span class="c1">-- [&quot;Time&quot;, &quot;Flies&quot;, &quot;Like&quot;, &quot;An&quot;, &quot;Arrow&quot;]</span>

<span class="nf">replaceAt</span> <span class="n">n</span> <span class="n">e</span> <span class="n">l</span> <span class="ow">=</span> <span class="n">before</span> <span class="o">++</span> <span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">++</span> <span class="n">tail</span> <span class="n">after</span>
    <span class="kr">where</span> <span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">)</span> <span class="ow">=</span> <span class="n">splitAt</span> <span class="n">n</span> <span class="n">l</span>

<span class="nf">replaceAllAt</span> <span class="n">assoc</span> <span class="n">l</span> <span class="ow">=</span> <span class="n">foldr</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">replaceAt</span> <span class="n">n</span> <span class="n">e</span><span class="p">)</span> <span class="n">l</span> <span class="n">assoc</span>

<span class="nf">l4</span> <span class="ow">=</span> <span class="n">replaceAt</span> <span class="mi">0</span> <span class="s">&quot;Fruit&quot;</span> <span class="n">l3</span>
<span class="nf">l5</span> <span class="ow">=</span> <span class="n">replaceAllAt</span> <span class="p">[</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s">&quot;A&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="s">&quot;Banana&quot;</span><span class="p">)</span> <span class="p">]</span> <span class="n">l4</span>
<span class="c1">-- =&gt; [&quot;Fruit&quot;, &quot;Flies&quot;, &quot;Like&quot;, &quot;A&quot;, &quot;Banana&quot;]</span>

<span class="c1">-- arrays are better suited for modifying an element,</span>
<span class="c1">-- but arrays are not suited for adding elements</span>
<span class="c1">-- (using listToArray from &quot;Helpers&quot;)</span>
<span class="nf">l3&#39;</span> <span class="ow">=</span> <span class="n">listToArray</span> <span class="n">l3</span>
<span class="nf">l4&#39;</span> <span class="ow">=</span> <span class="n">l3&#39;</span> <span class="kt">Array</span><span class="o">.//</span> <span class="p">[</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Fruit&quot;</span><span class="p">)</span> <span class="p">]</span>
<span class="nf">l5&#39;</span> <span class="ow">=</span> <span class="n">l4&#39;</span> <span class="kt">Array</span><span class="o">.//</span> <span class="p">[</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s">&quot;A&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="s">&quot;Banana&quot;</span><span class="p">)</span> <span class="p">]</span>


<span class="c1">-- @@PLEAC@@_4.10</span>
<span class="nf">l</span> <span class="ow">=</span> <span class="n">reverse</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">]</span>       <span class="c1">-- [5,4,3,2,1]</span>

<span class="nf">reverse_sort</span>   <span class="ow">=</span> <span class="n">reverse</span> <span class="o">.</span> <span class="n">sort</span>
<span class="nf">reverse_sort&#39;</span>  <span class="ow">=</span> <span class="n">sortBy</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="o">&lt;=&gt;</span> <span class="n">a</span><span class="p">)</span>
<span class="nf">reverse_sort&#39;&#39;</span> <span class="ow">=</span> <span class="n">sortBy</span> <span class="p">(</span><span class="n">flip</span> <span class="p">(</span><span class="o">&lt;=&gt;</span><span class="p">))</span>

<span class="nf">l</span> <span class="ow">=</span> <span class="n">reverse_sort</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>      <span class="c1">-- [5,3,2,1]</span>


<span class="c1">-- @@PLEAC@@_4.11</span>
<span class="c1">-- remove n elements from front of array</span>
<span class="p">(</span><span class="n">front</span><span class="p">,</span><span class="n">array&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">splitAt</span> <span class="n">array</span> <span class="n">n</span>

<span class="c1">-- remove n elements from the end of array</span>
<span class="p">(</span><span class="n">array&#39;</span><span class="p">,</span><span class="n">end</span><span class="p">)</span>  <span class="ow">=</span> <span class="n">splitAt</span> <span class="n">array</span> <span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">length</span> <span class="n">array</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span>

<span class="p">(</span><span class="n">this</span> <span class="kt">:</span> <span class="n">that</span> <span class="kt">:</span> <span class="n">friends&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="p">[</span> <span class="s">&quot;Peter&quot;</span><span class="p">,</span> <span class="s">&quot;Paul&quot;</span><span class="p">,</span> <span class="s">&quot;Mary&quot;</span><span class="p">,</span> <span class="s">&quot;Jim&quot;</span><span class="p">,</span> <span class="s">&quot;Tim&quot;</span> <span class="p">]</span>
<span class="c1">-- this contains &quot;Peter&quot;, that has &quot;Paul&quot;, and friends&#39; has &quot;Mary&quot;, &quot;Jim&quot;, and &quot;Tim&quot;</span>

<span class="nf">beverages</span> <span class="ow">=</span> <span class="n">words</span> <span class="s">&quot;Dew Jolt Cola Sprite Fresca&quot;</span>
<span class="p">(</span><span class="n">beverages&#39;</span><span class="p">,</span> <span class="n">pair</span><span class="p">)</span> <span class="ow">=</span> <span class="n">splitAt</span> <span class="p">(</span><span class="n">length</span> <span class="n">beverages</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="n">beverages</span> 
<span class="c1">-- pair contains [&quot;Sprite&quot;, &quot;Fresca&quot;]</span>
<span class="c1">-- and beverages&#39; has [&quot;Dew&quot;, &quot;Jolt&quot;, &quot;Cola&quot;]</span>


<span class="c1">-- @@PLEAC@@_4.12</span>
<span class="kr">data</span> <span class="kt">Employee</span> <span class="ow">=</span> <span class="kt">Employee</span> <span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="n">position</span> <span class="ow">::</span> <span class="kt">String</span>
                         <span class="p">,</span> <span class="n">salary</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="p">}</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Show</span><span class="p">,</span><span class="kt">Eq</span><span class="p">)</span>

<span class="nf">employees</span> <span class="ow">=</span> <span class="p">[</span> <span class="kt">Employee</span> <span class="p">{</span> <span class="n">name</span><span class="ow">=</span><span class="s">&quot;Jim&quot;</span><span class="p">,</span>  <span class="n">position</span><span class="ow">=</span><span class="s">&quot;Manager&quot;</span><span class="p">,</span>  <span class="n">salary</span><span class="ow">=</span><span class="mi">26000</span> <span class="p">}</span>
            <span class="p">,</span> <span class="kt">Employee</span> <span class="p">{</span> <span class="n">name</span><span class="ow">=</span><span class="s">&quot;Jill&quot;</span><span class="p">,</span> <span class="n">position</span><span class="ow">=</span><span class="s">&quot;Engineer&quot;</span><span class="p">,</span> <span class="n">salary</span><span class="ow">=</span><span class="mi">24000</span> <span class="p">}</span>
            <span class="p">,</span> <span class="kt">Employee</span> <span class="p">{</span> <span class="n">name</span><span class="ow">=</span><span class="s">&quot;Jack&quot;</span><span class="p">,</span> <span class="n">position</span><span class="ow">=</span><span class="s">&quot;Engineer&quot;</span><span class="p">,</span> <span class="n">salary</span><span class="ow">=</span><span class="mi">22000</span> <span class="p">}</span> <span class="p">]</span>

<span class="p">(</span><span class="kt">Just</span> <span class="n">engineer</span><span class="p">)</span> <span class="ow">=</span> <span class="n">find</span> <span class="p">((</span><span class="o">==</span> <span class="s">&quot;Engineer&quot;</span><span class="p">)</span> <span class="o">.</span> <span class="n">position</span><span class="p">)</span> <span class="n">employees</span>

<span class="nf">s</span> <span class="ow">=</span> <span class="n">name</span> <span class="n">engineer</span> <span class="o">++</span> <span class="s">&quot; is engineer&quot;</span>


<span class="c1">-- @@PLEAC@@_4.13</span>
<span class="nf">bigs</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(</span><span class="o">&gt;</span> <span class="mi">1000000</span><span class="p">)</span> <span class="n">nums</span>

<span class="c1">-- display lines from &quot;who&quot; matching &quot;simonpj&quot; (readProcess is in &quot;Helpers&quot;)</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="kt">Right</span> <span class="n">s</span> <span class="ow">&lt;-</span> <span class="n">readProcess</span> <span class="s">&quot;who&quot;</span> <span class="kt">[]</span> <span class="s">&quot;&quot;</span>
       <span class="n">mapM_</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="n">filter</span> <span class="p">(</span><span class="s">&quot;simonpj&quot;</span> <span class="p">`</span><span class="n">isPrefixOf</span><span class="p">`)</span> <span class="o">$</span> <span class="n">lines</span> <span class="n">s</span><span class="p">)</span>

<span class="c1">-- using employees defined in previous section</span>
<span class="nf">engineers</span>  <span class="ow">=</span> <span class="p">[</span> <span class="n">x</span> <span class="o">|</span> <span class="n">x</span> <span class="ow">&lt;-</span> <span class="n">employees</span><span class="p">,</span> <span class="n">position</span> <span class="n">x</span> <span class="o">==</span> <span class="s">&quot;Engineer&quot;</span><span class="p">]</span>
<span class="nf">engineers&#39;</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">((</span><span class="o">==</span> <span class="s">&quot;Engineer&quot;</span><span class="p">)</span> <span class="o">.</span> <span class="n">position</span><span class="p">)</span> <span class="n">employees</span>
<span class="c1">-- =&gt; [ Employee { name=&quot;Jill&quot;, ... }, Employee { name=&quot;Jack&quot;, ... } ]</span>

<span class="nf">secondary_assistance</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">((</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">26000</span> <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">30000</span><span class="p">)</span> <span class="o">.</span> <span class="n">salary</span><span class="p">)</span> <span class="n">employees</span>
<span class="c1">-- =&gt; [ Employee { name=&quot;Jim&quot;, position=&quot;Manager&quot;, salary=26000 } ]</span>


<span class="c1">-- @@PLEAC@@_4.14</span>
<span class="c1">-- sort works for numbers</span>
<span class="nf">l1</span> <span class="ow">=</span> <span class="n">sort</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>          <span class="c1">-- [3, 20, 100]</span>
<span class="c1">-- strings representing numbers will be sorted alphabetically</span>
<span class="nf">l2</span> <span class="ow">=</span> <span class="n">sort</span> <span class="p">[</span><span class="s">&quot;100&quot;</span><span class="p">,</span> <span class="s">&quot;3&quot;</span><span class="p">,</span> <span class="s">&quot;20&quot;</span><span class="p">]</span>    <span class="c1">-- [&quot;100&quot;, &quot;20&quot;, &quot;3&quot;]</span>

<span class="c1">-- you may specify another sort method (not lexicographic ordering):</span>
<span class="c1">-- for comparing: import Data.Ord (comparing)</span>
<span class="nf">l3</span> <span class="ow">=</span> <span class="n">sortBy</span> <span class="p">(</span><span class="n">comparing</span> <span class="p">(</span><span class="n">read</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Int</span><span class="p">))</span> <span class="p">[</span><span class="s">&quot;100&quot;</span><span class="p">,</span> <span class="s">&quot;3&quot;</span><span class="p">,</span> <span class="s">&quot;20&quot;</span><span class="p">]</span> <span class="c1">-- [&quot;3&quot;, &quot;20&quot;, &quot;100&quot;]</span>
<span class="c1">-- same, but may typically run faster</span>
<span class="nf">sortByKey</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">snd</span> <span class="o">.</span> <span class="n">sortBy</span> <span class="p">(</span><span class="n">comparing</span> <span class="n">fst</span><span class="p">)</span> <span class="o">.</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">f</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="nf">l3&#39;</span> <span class="ow">=</span> <span class="n">sortByKey</span> <span class="p">(</span><span class="n">read</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">[</span><span class="s">&quot;100&quot;</span><span class="p">,</span> <span class="s">&quot;3&quot;</span><span class="p">,</span> <span class="s">&quot;20&quot;</span><span class="p">]</span>

<span class="c1">-- more cryptic: replace (\x -&gt; (f x, x)) with (f Arrow.&amp;&amp;&amp; id)</span>


<span class="c1">-- @@PLEAC@@_4.15</span>
<span class="kr">data</span> <span class="kt">Employee</span> <span class="ow">=</span> <span class="kt">Employee</span> <span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="n">position</span> <span class="ow">::</span> <span class="kt">String</span>
                         <span class="p">,</span> <span class="n">salary</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="p">}</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Show</span><span class="p">,</span><span class="kt">Eq</span><span class="p">)</span>

<span class="nf">employees</span> <span class="ow">=</span> <span class="p">[</span> <span class="kt">Employee</span> <span class="p">{</span> <span class="n">name</span><span class="ow">=</span><span class="s">&quot;Jim&quot;</span><span class="p">,</span>  <span class="n">position</span><span class="ow">=</span><span class="s">&quot;Manager&quot;</span><span class="p">,</span>  <span class="n">salary</span><span class="ow">=</span><span class="mi">26000</span> <span class="p">}</span>
            <span class="p">,</span> <span class="kt">Employee</span> <span class="p">{</span> <span class="n">name</span><span class="ow">=</span><span class="s">&quot;Jill&quot;</span><span class="p">,</span> <span class="n">position</span><span class="ow">=</span><span class="s">&quot;Engineer&quot;</span><span class="p">,</span> <span class="n">salary</span><span class="ow">=</span><span class="mi">24000</span> <span class="p">}</span>
            <span class="p">,</span> <span class="kt">Employee</span> <span class="p">{</span> <span class="n">name</span><span class="ow">=</span><span class="s">&quot;Jack&quot;</span><span class="p">,</span> <span class="n">position</span><span class="ow">=</span><span class="s">&quot;Engineer&quot;</span><span class="p">,</span> <span class="n">salary</span><span class="ow">=</span><span class="mi">22000</span> <span class="p">}</span> <span class="p">]</span>

<span class="nf">employee_sorted</span> <span class="ow">=</span> <span class="n">sortBy</span> <span class="p">(</span><span class="n">comparing</span> <span class="n">name</span><span class="p">)</span> <span class="n">employees</span>
<span class="c1">-- =&gt; [ Employee { name=&quot;Jack&quot;, ... }, Employee { name=&quot;Jill&quot;, ... }, Employee { name=&quot;Jim&quot;, ... } ]</span>

<span class="nf">sortByKey</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">snd</span> <span class="o">.</span> <span class="n">sortBy</span> <span class="p">(</span><span class="n">comparing</span> <span class="n">fst</span><span class="p">)</span> <span class="o">.</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">f</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="nf">sortByKeyRev</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">snd</span> <span class="o">.</span> <span class="n">sortBy</span> <span class="p">(</span><span class="n">flip</span> <span class="o">$</span> <span class="n">comparing</span> <span class="n">fst</span><span class="p">)</span> <span class="o">.</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">f</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

<span class="nf">employee_sorted&#39;</span> <span class="ow">=</span> <span class="n">sortByKey</span> <span class="n">name</span> <span class="n">employees</span>

<span class="nf">ordered</span>     <span class="ow">=</span> <span class="n">sortByKey</span>    <span class="n">abs</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span> <span class="p">]</span> <span class="c1">-- [ 1, 2, -3, 6 ]</span>
<span class="nf">ordered_rev</span> <span class="ow">=</span> <span class="n">sortByKeyRev</span> <span class="n">abs</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span> <span class="p">]</span> <span class="c1">-- [ 6, -3, 2, 1 ]</span>

<span class="nf">names</span> <span class="ow">=</span> <span class="p">[</span> <span class="s">&quot;Azzz&quot;</span><span class="p">,</span> <span class="s">&quot;Za&quot;</span><span class="p">,</span> <span class="s">&quot;Bbbbbbb&quot;</span> <span class="p">]</span>
<span class="nf">sort_by_2nd_char</span>  <span class="ow">=</span> <span class="n">sortByKey</span> <span class="p">(</span><span class="o">!!</span> <span class="mi">1</span><span class="p">)</span> <span class="n">names</span> <span class="c1">-- [&quot;Za&quot;,&quot;Bbbbbbb&quot;,&quot;Azzz&quot;]</span>
<span class="nf">sort_by_last_char</span> <span class="ow">=</span> <span class="n">sortByKey</span> <span class="n">last</span> <span class="n">names</span>   <span class="c1">-- [&quot;Za&quot;,&quot;Bbbbbbb&quot;,&quot;Azzz&quot;]</span>
<span class="nf">sort_by_length</span>    <span class="ow">=</span> <span class="n">sortByKey</span> <span class="n">length</span> <span class="n">names</span> <span class="c1">-- [&quot;Za&quot;,&quot;Azzz&quot;,&quot;Bbbbbbb&quot;]</span>

<span class="c1">--</span>
<span class="kr">import</span> <span class="nn">Text.Regex</span>
<span class="nf">m</span> <span class="ow">=</span> <span class="n">readFile</span> <span class="s">&quot;/etc/passwd&quot;</span> <span class="o">&gt;&gt;=</span> <span class="p">(</span><span class="n">putStr</span> <span class="o">.</span> <span class="n">unlines</span> <span class="o">.</span> <span class="n">sortByKey</span> <span class="n">key</span> <span class="o">.</span> <span class="n">lines</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">key</span> <span class="n">line</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">splitRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;:&quot;</span><span class="p">)</span> <span class="n">line</span> <span class="kr">of</span>
                       <span class="p">(</span><span class="n">name</span> <span class="kt">:</span> <span class="kr">_</span> <span class="kt">:</span> <span class="n">uid</span> <span class="kt">:</span> <span class="n">gid</span> <span class="kt">:</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">-&gt;</span>
                           <span class="p">(</span><span class="n">read</span> <span class="n">gid</span> <span class="ow">::</span> <span class="kt">Int</span><span class="p">,</span> <span class="n">read</span> <span class="n">uid</span> <span class="ow">::</span> <span class="kt">Int</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> 


<span class="c1">-- @@PLEAC@@_4.16</span>
<span class="kr">import</span> <span class="nn">System.Posix</span> <span class="p">(</span><span class="nf">sleep</span><span class="p">)</span>

<span class="c1">-- circular lists are easily defined using infinite list</span>
<span class="nf">circular</span> <span class="ow">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">++</span> <span class="n">circular</span>

<span class="nf">m</span> <span class="ow">=</span> <span class="n">mapM_</span> <span class="n">do_it</span> <span class="p">(</span><span class="n">take</span> <span class="mi">10</span> <span class="n">circular</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">do_it</span> <span class="n">n</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;Handling process &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">n</span><span class="p">)</span>
		       <span class="n">sleep</span> <span class="mi">1</span>


<span class="c1">-- @@PLEAC@@_4.17</span>
<span class="nf">rand</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">Int</span>
<span class="nf">rand</span> <span class="n">low</span> <span class="n">high</span> <span class="ow">=</span> <span class="n">getStdRandom</span> <span class="p">(</span><span class="n">randomR</span> <span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">))</span>

<span class="nf">randomPermute</span> <span class="ow">::</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="nf">randomPermute</span> <span class="kt">[]</span>  <span class="ow">=</span> <span class="n">return</span> <span class="kt">[]</span>
<span class="nf">randomPermute</span> <span class="n">xs</span>  <span class="ow">=</span> 
    <span class="kr">do</span> <span class="n">n</span> <span class="ow">&lt;-</span> <span class="n">rand</span> <span class="mi">0</span> <span class="p">(</span><span class="n">length</span> <span class="n">xs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
       <span class="kr">let</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span> <span class="kt">:</span> <span class="n">b</span><span class="p">)</span> <span class="ow">=</span> <span class="n">splitAt</span> <span class="n">n</span> <span class="n">xs</span> <span class="c1">-- taking n-th element and putting it first</span>
       <span class="n">ab</span> <span class="ow">&lt;-</span> <span class="n">randomPermute</span> <span class="p">(</span><span class="n">a</span> <span class="o">++</span> <span class="n">b</span><span class="p">)</span>
       <span class="n">return</span> <span class="o">$</span> <span class="n">e</span> <span class="kt">:</span> <span class="n">ab</span>

<span class="nf">l</span> <span class="ow">=</span> <span class="n">randomPermute</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">]</span>        <span class="c1">-- example of result: [2,3,5,1,4]</span>


<span class="c1">-- @@PLEAC@@_4.18</span>
<span class="c1">-- using groupNelem from &quot;Helpers&quot;</span>
<span class="nf">make_columns</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span>
<span class="nf">make_columns</span> <span class="n">screen_width</span> <span class="n">mylist</span> <span class="ow">=</span> 
    <span class="n">map</span> <span class="n">concat</span> <span class="o">$</span> <span class="n">transpose</span> <span class="o">$</span> <span class="n">groupNelem</span> <span class="n">rows</span> <span class="o">$</span> <span class="n">map</span> <span class="n">pad_it</span> <span class="n">mylist</span>
        <span class="kr">where</span> <span class="n">maxlen</span> <span class="ow">=</span> <span class="n">maximum</span><span class="p">(</span><span class="n">map</span> <span class="n">length</span> <span class="n">mylist</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1">-- 1 needed to make extra space</span>
              <span class="n">cols</span> <span class="ow">=</span> <span class="n">max</span> <span class="mi">1</span> <span class="p">(</span><span class="n">screen_width</span> <span class="p">`</span><span class="n">div</span><span class="p">`</span> <span class="n">maxlen</span><span class="p">)</span>
              <span class="n">rows</span> <span class="ow">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">length</span> <span class="n">mylist</span> <span class="p">`</span><span class="n">div</span><span class="p">`</span> <span class="n">cols</span><span class="p">)</span>
              <span class="n">pad_it</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">take</span> <span class="n">maxlen</span> <span class="p">(</span><span class="n">s</span> <span class="o">++</span> <span class="n">repeat</span> <span class="sc">&#39; &#39;</span><span class="p">)</span>

<span class="c1">-- using external program &quot;resize -u&quot; to get terminal size (readProcess is in &quot;Helpers&quot;)</span>
<span class="nf">getTerminalSize</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">Int</span><span class="p">))</span>
<span class="nf">getTerminalSize</span> <span class="ow">=</span>
    <span class="kr">do</span> <span class="kt">Right</span> <span class="n">s</span> <span class="ow">&lt;-</span> <span class="n">readProcess</span> <span class="s">&quot;resize&quot;</span> <span class="p">[</span><span class="s">&quot;-u&quot;</span><span class="p">]</span> <span class="s">&quot;&quot;</span>
       <span class="kr">let</span> <span class="n">vars</span> <span class="ow">=</span> <span class="n">parse_shell_vars</span> <span class="n">s</span>
       <span class="n">return</span> <span class="o">$</span> <span class="kr">do</span> <span class="n">x</span> <span class="ow">&lt;-</span> <span class="n">lookup</span> <span class="s">&quot;COLUMNS&quot;</span> <span class="n">vars</span>
                   <span class="n">y</span> <span class="ow">&lt;-</span> <span class="n">lookup</span> <span class="s">&quot;LINES&quot;</span> <span class="n">vars</span>
                   <span class="n">return</span> <span class="p">(</span><span class="n">read</span> <span class="n">x</span><span class="p">,</span> <span class="n">read</span> <span class="n">y</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">parse_shell_vars</span> <span class="ow">=</span> <span class="n">catMaybes</span> <span class="o">.</span> <span class="n">map</span> <span class="n">break_it</span> <span class="o">.</span> <span class="n">lines</span>
          <span class="n">break_it</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">break</span> <span class="p">(</span><span class="o">==</span> <span class="sc">&#39;=&#39;</span><span class="p">)</span> <span class="n">s</span> <span class="kr">of</span>
                         <span class="p">(</span><span class="kr">_</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">Nothing</span>
                         <span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="kr">_</span><span class="kt">:</span><span class="n">val</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">Just</span> <span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="kr">if</span> <span class="n">last</span> <span class="n">val</span> <span class="o">==</span> <span class="sc">&#39;;&#39;</span> <span class="kr">then</span> <span class="n">init</span> <span class="n">val</span> <span class="kr">else</span> <span class="n">val</span><span class="p">)</span>

<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">size</span> <span class="ow">&lt;-</span> <span class="n">getTerminalSize</span>
          <span class="kr">let</span> <span class="n">width</span> <span class="ow">=</span> <span class="n">maybe</span> <span class="mi">80</span> <span class="n">fst</span> <span class="n">size</span>
          <span class="n">interact</span> <span class="p">(</span><span class="n">unlines</span> <span class="o">.</span> <span class="n">make_columns</span> <span class="n">width</span> <span class="o">.</span> <span class="n">words</span><span class="p">)</span>


<span class="c1">-- @@PLEAC@@_4.19</span>
<span class="nf">permutations</span> <span class="kt">[]</span>     <span class="ow">=</span>  <span class="p">[</span><span class="kt">[]</span><span class="p">]</span>
<span class="nf">permutations</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="p">[</span><span class="n">zs</span> <span class="o">|</span> <span class="n">ys</span> <span class="ow">&lt;-</span> <span class="n">permutations</span> <span class="n">xs</span><span class="p">,</span> <span class="n">zs</span> <span class="ow">&lt;-</span> <span class="n">interleave</span> <span class="n">x</span> <span class="n">ys</span> <span class="p">]</span>
  <span class="kr">where</span> <span class="n">interleave</span> <span class="n">x</span> <span class="kt">[]</span>     <span class="ow">=</span>  <span class="p">[[</span><span class="n">x</span><span class="p">]]</span>
        <span class="n">interleave</span> <span class="n">x</span> <span class="p">(</span><span class="n">y</span><span class="kt">:</span><span class="n">ys</span><span class="p">)</span> <span class="ow">=</span>  <span class="p">[</span><span class="n">x</span><span class="kt">:</span><span class="n">y</span><span class="kt">:</span><span class="n">ys</span><span class="p">]</span> <span class="o">++</span> <span class="n">map</span> <span class="p">(</span><span class="n">y</span><span class="kt">:</span><span class="p">)</span> <span class="p">(</span><span class="n">interleave</span> <span class="n">x</span> <span class="n">ys</span><span class="p">)</span>
<span class="c1">-- the list comprehension can be replaced by: concatMap (interleave x) $ permutations xs</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="n">mapM_</span> <span class="p">(</span><span class="n">putStrLn</span> <span class="o">.</span> <span class="n">unwords</span><span class="p">)</span> <span class="o">$</span> <span class="n">permutations</span> <span class="o">$</span> <span class="n">words</span> <span class="s">&quot;man bites dog&quot;</span> 
<span class="c1">-- man bites dog</span>
<span class="c1">-- bites man dog</span>
<span class="c1">-- bites dog man</span>
<span class="c1">-- man dog bites</span>
<span class="c1">-- dog man bites</span>
<span class="c1">-- dog bites man</span>


<span class="c1">-- @@PLEAC@@_5.0</span>
<span class="c1">-- using simple association list</span>
<span class="nf">age</span> <span class="ow">=</span> <span class="p">[</span> <span class="p">(</span><span class="s">&quot;Nat&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
      <span class="p">,</span> <span class="p">(</span><span class="s">&quot;Jules&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
      <span class="p">,</span> <span class="p">(</span><span class="s">&quot;Josh&quot;</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span> <span class="p">]</span>

<span class="c1">-- access by key:</span>
<span class="kt">Just</span> <span class="n">jules_age</span> <span class="ow">=</span> <span class="n">lookup</span> <span class="s">&quot;Jules&quot;</span> <span class="n">age</span>    <span class="c1">-- 25</span>

<span class="c1">-- using Data.Map</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Map</span> <span class="k">as</span> <span class="n">Map</span>
<span class="nf">age</span> <span class="ow">=</span> <span class="kt">Map</span><span class="o">.</span><span class="n">fromList</span> <span class="p">[</span> <span class="p">(</span><span class="s">&quot;Nat&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
		   <span class="p">,</span> <span class="p">(</span><span class="s">&quot;Jules&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
		   <span class="p">,</span> <span class="p">(</span><span class="s">&quot;Josh&quot;</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span> <span class="p">]</span>

<span class="c1">-- access by key:</span>
<span class="nf">jules_age&#39;</span> <span class="ow">=</span> <span class="n">age&#39;</span> <span class="kt">Map</span><span class="o">.!</span> <span class="s">&quot;Jules&quot;</span>   <span class="c1">-- 25</span>

<span class="c1">-- same, incrementally</span>
<span class="nf">age1</span> <span class="ow">=</span> <span class="kt">Map</span><span class="o">.</span><span class="n">empty</span>
<span class="nf">age2</span> <span class="ow">=</span> <span class="kt">Map</span><span class="o">.</span><span class="n">insert</span> <span class="s">&quot;Nat&quot;</span>   <span class="mi">24</span> <span class="n">age1</span>
<span class="nf">age3</span> <span class="ow">=</span> <span class="kt">Map</span><span class="o">.</span><span class="n">insert</span> <span class="s">&quot;Jules&quot;</span> <span class="mi">25</span> <span class="n">age2</span>
<span class="nf">age4</span> <span class="ow">=</span> <span class="kt">Map</span><span class="o">.</span><span class="n">insert</span> <span class="s">&quot;Josh&quot;</span>  <span class="mi">17</span> <span class="n">age3</span>
<span class="c1">-- =&gt; Map.fromList [(&quot;Josh&quot;,17),(&quot;Jules&quot;,25),(&quot;Nat&quot;,24)]</span>

<span class="nf">food_color</span> <span class="ow">=</span> <span class="p">[</span> <span class="p">(</span><span class="s">&quot;Apple&quot;</span> <span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>
	     <span class="p">,</span> <span class="p">(</span><span class="s">&quot;Banana&quot;</span><span class="p">,</span> <span class="s">&quot;yellow&quot;</span><span class="p">)</span>
	     <span class="p">,</span> <span class="p">(</span><span class="s">&quot;Lemon&quot;</span> <span class="p">,</span> <span class="s">&quot;yellow&quot;</span><span class="p">)</span>
	     <span class="p">,</span> <span class="p">(</span><span class="s">&quot;Carrot&quot;</span><span class="p">,</span> <span class="s">&quot;orange&quot;</span><span class="p">)</span> <span class="p">]</span>

<span class="nf">food_color&#39;</span> <span class="ow">=</span> <span class="kt">Map</span><span class="o">.</span><span class="n">fromList</span> <span class="n">food_color</span>


<span class="c1">-- @@PLEAC@@_5.1</span>
<span class="nf">food_color2</span> <span class="ow">=</span> <span class="p">(</span><span class="s">&quot;Raspberry&quot;</span><span class="p">,</span> <span class="s">&quot;pink&quot;</span><span class="p">)</span> <span class="kt">:</span> <span class="n">food_color</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;Know foods: &quot;</span> <span class="o">++</span> <span class="n">unwords</span> <span class="p">(</span><span class="n">map</span> <span class="n">fst</span> <span class="n">food_color2</span><span class="p">)</span>
<span class="c1">-- =&gt; Know foods: Raspberry Apple Banana Lemon Carrot</span>

<span class="c1">-- nb: it doesn&#39;t remove duplicates</span>
<span class="nf">food_color3</span> <span class="ow">=</span> <span class="p">(</span><span class="s">&quot;Raspberry&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">)</span> <span class="kt">:</span> <span class="n">food_color2</span>
<span class="c1">-- =&gt; [ (&quot;Raspberry&quot;,&quot;red&quot;), (&quot;Raspberry&quot;,&quot;pink&quot;), (&quot;Apple&quot;,&quot;red&quot;), ... ]</span>
<span class="c1">-- (see section &quot;Finding Common or Different Keys in Two Hashes&quot; for a solution removing duplicates)</span>


<span class="c1">-- same using Data.Map</span>
<span class="nf">food_color2&#39;</span> <span class="ow">=</span> <span class="kt">Map</span><span class="o">.</span><span class="n">insert</span> <span class="s">&quot;Raspberry&quot;</span> <span class="s">&quot;pink&quot;</span> <span class="n">food_color&#39;</span>

<span class="nf">t&#39;</span> <span class="ow">=</span> <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;Know foods: &quot;</span> <span class="o">++</span> <span class="n">unwords</span> <span class="p">(</span><span class="kt">Map</span><span class="o">.</span><span class="n">keys</span> <span class="n">food_color2&#39;</span><span class="p">)</span>
<span class="c1">-- =&gt; Know foods: Apple Banana Carrot Lemon Raspberry</span>

<span class="c1">-- nb: it does remove duplicates</span>
<span class="nf">food_color3&#39;</span> <span class="ow">=</span> <span class="kt">Map</span><span class="o">.</span><span class="n">insert</span> <span class="s">&quot;Raspberry&quot;</span> <span class="s">&quot;red&quot;</span> <span class="n">food_color2&#39;</span>
<span class="c1">-- Map.fromList [(&quot;Apple&quot;,&quot;red&quot;),(&quot;Banana&quot;,&quot;yellow&quot;),(&quot;Carrot&quot;,&quot;orange&quot;),(&quot;Lemon&quot;,&quot;yellow&quot;),(&quot;Raspberry&quot;,&quot;red&quot;)]</span>


<span class="c1">-- @@PLEAC@@_5.2</span>
<span class="nf">s</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">describe</span> <span class="p">[</span><span class="s">&quot;Banana&quot;</span><span class="p">,</span> <span class="s">&quot;Martini&quot;</span><span class="p">]</span>
    <span class="kr">where</span> <span class="n">describe</span> <span class="n">name</span> <span class="ow">=</span> <span class="n">name</span> <span class="o">++</span> <span class="s">&quot; is a &quot;</span> <span class="o">++</span> <span class="n">kind</span> <span class="n">name</span> <span class="o">++</span> <span class="s">&quot;.&quot;</span>
          <span class="n">kind</span> <span class="n">name</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">isJust</span> <span class="p">(</span><span class="n">lookup</span> <span class="n">name</span> <span class="n">food_color</span><span class="p">)</span> <span class="kr">then</span> <span class="s">&quot;food&quot;</span> <span class="kr">else</span> <span class="s">&quot;drink&quot;</span>
<span class="c1">-- =&gt; [&quot;Banana is a food.&quot;,&quot;Martini is a drink.&quot;]</span>

<span class="c1">--   isJust (lookup name food_color)   </span>
<span class="c1">-- can be replaced by</span>
<span class="c1">--   name `elem` map fst food_color</span>

<span class="c1">-- for Data.Map, replace (isJust . lookup) with Map.member:</span>
<span class="nf">s&#39;</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">describe</span> <span class="p">[</span><span class="s">&quot;Banana&quot;</span><span class="p">,</span> <span class="s">&quot;Martini&quot;</span><span class="p">]</span>
    <span class="kr">where</span> <span class="n">describe</span> <span class="n">name</span> <span class="ow">=</span> <span class="n">name</span> <span class="o">++</span> <span class="s">&quot; is a &quot;</span> <span class="o">++</span> <span class="n">kind</span> <span class="n">name</span> <span class="o">++</span> <span class="s">&quot;.&quot;</span>
          <span class="n">kind</span> <span class="n">name</span> <span class="ow">=</span> <span class="kr">if</span> <span class="kt">Map</span><span class="o">.</span><span class="n">member</span> <span class="n">name</span> <span class="n">food_color&#39;</span> <span class="kr">then</span> <span class="s">&quot;food&quot;</span> <span class="kr">else</span> <span class="s">&quot;drink&quot;</span>
<span class="c1">-- =&gt; [&quot;Banana is a food.&quot;,&quot;Martini is a drink.&quot;]</span>


<span class="c1">-- @@PLEAC@@_5.3</span>
<span class="c1">-- removing key on association list is done with a simple filter:</span>
<span class="nf">food_color2</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">((</span><span class="o">/=</span> <span class="s">&quot;Banana&quot;</span><span class="p">)</span> <span class="o">.</span> <span class="n">fst</span><span class="p">)</span> <span class="n">food_color</span>

<span class="nf">print_foods</span> <span class="n">foods</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;Keys: &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">unwords</span> <span class="o">$</span> <span class="n">map</span> <span class="n">fst</span> <span class="n">foods</span><span class="p">)</span>
                       <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;Values: &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">unwords</span> <span class="o">$</span> <span class="n">map</span> <span class="n">snd</span> <span class="n">foods</span><span class="p">)</span>

<span class="nf">before</span> <span class="ow">=</span> <span class="n">print_foods</span> <span class="n">food_color</span>
<span class="c1">-- Keys: Apple Banana Lemon Carrot</span>
<span class="c1">-- Values: red yellow yellow orange</span>
<span class="nf">after</span> <span class="ow">=</span> <span class="n">print_foods</span> <span class="n">food_color2</span>
<span class="c1">-- Keys: Apple Lemon Carrot</span>
<span class="c1">-- Values: red yellow orange</span>


<span class="c1">-- using Data.Map</span>
<span class="nf">food_color2&#39;</span> <span class="ow">=</span> <span class="kt">Map</span><span class="o">.</span><span class="n">delete</span> <span class="s">&quot;Banana&quot;</span> <span class="n">food_color&#39;</span>

<span class="nf">print_foods&#39;</span> <span class="n">foods</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;Keys: &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">unwords</span> <span class="o">$</span> <span class="kt">Map</span><span class="o">.</span><span class="n">keys</span> <span class="n">foods</span><span class="p">)</span>
                        <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;Values: &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">unwords</span> <span class="o">$</span> <span class="kt">Map</span><span class="o">.</span><span class="n">elems</span> <span class="n">foods</span><span class="p">)</span>

<span class="nf">before&#39;</span> <span class="ow">=</span> <span class="n">print_foods&#39;</span> <span class="n">food_color&#39;</span>
<span class="c1">-- Keys: Apple Banana Carrot Lemon</span>
<span class="c1">-- Values: red yellow orange yellow</span>
<span class="nf">after&#39;</span> <span class="ow">=</span> <span class="n">print_foods&#39;</span> <span class="n">food_color2&#39;</span>
<span class="c1">-- Keys: Apple Carrot Lemon</span>
<span class="c1">-- Values: red orange yellow</span>

<span class="c1">-- to remove a list of keys, simply use foldr:</span>
<span class="nf">food_color3&#39;</span> <span class="ow">=</span> <span class="n">foldr</span> <span class="kt">Map</span><span class="o">.</span><span class="n">delete</span> <span class="n">food_color&#39;</span> <span class="p">[</span> <span class="s">&quot;Banana&quot;</span><span class="p">,</span> <span class="s">&quot;Apple&quot;</span><span class="p">,</span> <span class="s">&quot;Cabbage&quot;</span> <span class="p">]</span>


<span class="c1">-- @@PLEAC@@_5.4</span>
<span class="nf">t</span>  <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">food</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">food</span> <span class="o">++</span> <span class="s">&quot; is &quot;</span> <span class="o">++</span> <span class="n">color</span><span class="p">)</span> <span class="n">food_color</span>
<span class="c1">-- [&quot;Apple is red&quot;,&quot;Banana is yellow&quot;,&quot;Lemon is yellow&quot;,&quot;Carrot is orange&quot;]</span>
<span class="nf">t2</span> <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">food</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">food</span> <span class="o">++</span> <span class="s">&quot; is &quot;</span> <span class="o">++</span> <span class="n">color</span><span class="p">)</span> <span class="o">$</span> <span class="n">sort</span> <span class="n">food_color</span>
<span class="c1">-- [&quot;Apple is red&quot;,&quot;Banana is yellow&quot;,&quot;Carrot is orange&quot;,&quot;Lemon is yellow&quot;]</span>

<span class="c1">-- using Data.Map</span>
<span class="nf">t&#39;</span>  <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">food</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">food</span> <span class="o">++</span> <span class="s">&quot; is &quot;</span> <span class="o">++</span> <span class="n">color</span><span class="p">)</span> <span class="o">$</span> <span class="kt">Map</span><span class="o">.</span><span class="n">assocs</span> <span class="n">food_color&#39;</span>
<span class="c1">-- [&quot;Apple is red&quot;,&quot;Banana is yellow&quot;,&quot;Carrot is orange&quot;,&quot;Lemon is yellow&quot;]</span>

<span class="nf">t2&#39;</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">format_it</span> <span class="o">$</span> <span class="n">sort</span> <span class="o">$</span> <span class="kt">Map</span><span class="o">.</span><span class="n">assocs</span> <span class="n">food_color&#39;</span>
    <span class="kr">where</span> <span class="n">format_it</span> <span class="p">(</span><span class="n">food</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="ow">=</span> <span class="n">food</span> <span class="o">++</span> <span class="s">&quot; is &quot;</span> <span class="o">++</span> <span class="n">color</span>
<span class="c1">-- [&quot;Apple is red&quot;,&quot;Banana is yellow&quot;,&quot;Carrot is orange&quot;,&quot;Lemon is yellow&quot;]</span>

<span class="c1">-- you can of course get keys first, and use Map.!</span>
<span class="nf">t2&#39;</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">format_it</span> <span class="o">$</span> <span class="n">sort</span> <span class="o">$</span> <span class="kt">Map</span><span class="o">.</span><span class="n">keys</span> <span class="n">food_color&#39;</span>
    <span class="kr">where</span> <span class="n">format_it</span> <span class="n">food</span> <span class="ow">=</span> <span class="n">food</span> <span class="o">++</span> <span class="s">&quot; is &quot;</span> <span class="o">++</span> <span class="n">food_color&#39;</span> <span class="kt">Map</span><span class="o">.!</span> <span class="n">food</span>

<span class="c1">-- countfrom - count number of messages from each sender</span>
<span class="o">#!/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">runghc</span>

<span class="kr">import</span> <span class="nn">System</span>
<span class="kr">import</span> <span class="nn">Maybe</span>
<span class="kr">import</span> <span class="nn">List</span>

<span class="nf">any_input</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="n">getContents</span>
<span class="nf">any_input</span> <span class="p">(</span><span class="n">f</span><span class="kt">:</span><span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">readFile</span> <span class="n">f</span>

<span class="nf">get_senders</span> <span class="ow">=</span> <span class="n">catMaybes</span> <span class="o">.</span> <span class="n">map</span> <span class="n">get_sender</span>
    <span class="kr">where</span> <span class="n">get_sender</span> <span class="n">line</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">prefix</span> <span class="p">`</span><span class="n">isPrefixOf</span><span class="p">`</span> <span class="n">line</span> 
                            <span class="kr">then</span> <span class="kt">Just</span> <span class="p">(</span><span class="n">drop</span> <span class="p">(</span><span class="n">length</span> <span class="n">prefix</span><span class="p">)</span> <span class="n">line</span><span class="p">)</span> 
                            <span class="kr">else</span> <span class="kt">Nothing</span>
          <span class="n">prefix</span> <span class="ow">=</span> <span class="s">&quot;From: &quot;</span>

<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">s</span> <span class="ow">&lt;-</span> <span class="n">getArgs</span> <span class="o">&gt;&gt;=</span> <span class="n">any_input</span>
          <span class="kr">let</span> <span class="n">senders</span> <span class="ow">=</span> <span class="n">group</span> <span class="o">$</span> <span class="n">sort</span> <span class="o">$</span> <span class="n">get_senders</span> <span class="p">(</span><span class="n">lines</span> <span class="n">s</span><span class="p">)</span>
          <span class="n">mapM_</span> <span class="p">(</span><span class="n">putStrLn</span> <span class="o">.</span> <span class="n">format_it</span><span class="p">)</span> <span class="o">$</span> <span class="n">senders</span>
    <span class="kr">where</span> <span class="n">format_it</span> <span class="n">froms</span><span class="o">@</span><span class="p">(</span><span class="n">name</span><span class="kt">:</span><span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">name</span> <span class="o">++</span> <span class="s">&quot;: &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="p">(</span><span class="n">length</span> <span class="n">froms</span><span class="p">)</span>


<span class="c1">-- @@PLEAC@@_5.5</span>
<span class="c1">-- show gives a string representation</span>
<span class="nf">s</span> <span class="ow">=</span> <span class="n">show</span> <span class="n">food_color</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="n">putStrLn</span> <span class="n">s</span>
<span class="c1">-- =&gt; [(&quot;Apple&quot;,&quot;red&quot;),(&quot;Banana&quot;,&quot;yellow&quot;),(&quot;Lemon&quot;,&quot;yellow&quot;),(&quot;Carrot&quot;,&quot;orange&quot;)]</span>

<span class="nf">s2</span>  <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">food</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">food</span> <span class="o">++</span> <span class="s">&quot; =&gt; &quot;</span> <span class="o">++</span> <span class="n">color</span><span class="p">)</span> <span class="n">food_color</span>
<span class="c1">-- see &quot;Traversing a Hash&quot; for more</span>


<span class="c1">-- @@PLEAC@@_5.6</span>
<span class="c1">-- association list as explained in previous sections keeps order</span>


<span class="c1">-- @@PLEAC@@_5.7</span>
<span class="c1">-- one can use simple list functions</span>
<span class="nf">lookupAll</span> <span class="n">k</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">snd</span> <span class="o">.</span> <span class="n">filter</span> <span class="p">((</span><span class="o">==</span> <span class="n">k</span><span class="p">)</span> <span class="o">.</span> <span class="n">fst</span><span class="p">)</span>

<span class="nf">color_to_foods</span> <span class="n">color</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">fst</span> <span class="o">$</span> <span class="n">filter</span> <span class="p">((</span><span class="o">==</span> <span class="n">color</span><span class="p">)</span> <span class="o">.</span> <span class="n">snd</span><span class="p">)</span> <span class="n">food_color</span>
<span class="nf">yellow_food</span> <span class="ow">=</span> <span class="n">color_to_foods</span> <span class="s">&quot;yellow&quot;</span> <span class="c1">-- [&quot;Banana&quot;,&quot;Lemon&quot;]</span>

<span class="c1">-- one can precompute it:</span>
<span class="nf">food_of_color</span> <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">color</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">color_to_foods</span> <span class="n">color</span><span class="p">))</span> <span class="n">colors</span>
                <span class="kr">where</span> <span class="n">colors</span> <span class="ow">=</span> <span class="n">nub</span> <span class="p">(</span><span class="n">map</span> <span class="n">snd</span> <span class="n">food_color</span><span class="p">)</span>
<span class="c1">-- =&gt; [(&quot;red&quot;,[&quot;Apple&quot;]), (&quot;yellow&quot;,[&quot;Banana&quot;,&quot;Lemon&quot;]), (&quot;orange&quot;,[&quot;Carrot&quot;])]</span>
<span class="c1">-- then use it</span>
<span class="nf">yellow_food_</span> <span class="ow">=</span> <span class="n">fromMaybe</span> <span class="kt">[]</span> <span class="p">(</span><span class="n">lookup</span> <span class="s">&quot;yellow&quot;</span> <span class="n">food_of_color</span><span class="p">)</span>

<span class="c1">-- another way to pre-compute</span>
<span class="nf">assocListGroupByKey</span> <span class="ow">::</span> <span class="kt">Ord</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)]</span> <span class="ow">-&gt;</span> <span class="p">[(</span><span class="n">a</span><span class="p">,[</span><span class="n">b</span><span class="p">])]</span>
<span class="nf">assocListGroupByKey</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">factorize</span> <span class="o">.</span> <span class="n">groupBy</span> <span class="n">same_key</span> <span class="o">.</span> <span class="n">sortBy</span> <span class="p">(</span><span class="n">comparing</span> <span class="n">fst</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">factorize</span> <span class="n">l</span><span class="o">@</span><span class="p">((</span><span class="n">user</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="kt">:</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">map</span> <span class="n">snd</span> <span class="n">l</span><span class="p">)</span>          
          <span class="n">same_key</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="kr">_</span><span class="p">)</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span>
<span class="c1">-- you can write: factorize = fst . head Arrow.&amp;&amp;&amp; map snd</span>
<span class="nf">food_of_color</span> <span class="ow">=</span> <span class="n">assocListGroupByKey</span> <span class="n">food_color</span>

<span class="c1">-- or one can use a full fledged data structure</span>
<span class="c1">-- (need: import qualified Data.Set as Set)</span>
<span class="nf">food_of_color&#39;</span> <span class="ow">=</span> <span class="n">foldl</span> <span class="p">(</span><span class="nf">\</span><span class="n">l</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">Map</span><span class="o">.</span><span class="n">alter</span> <span class="p">(</span><span class="n">add_it</span> <span class="n">v</span><span class="p">)</span> <span class="n">k</span> <span class="n">l</span><span class="p">)</span> <span class="kt">Map</span><span class="o">.</span><span class="n">empty</span> <span class="n">food_color</span>
    <span class="kr">where</span> <span class="n">add_it</span> <span class="n">val</span> <span class="n">prev</span> <span class="ow">=</span> <span class="kt">Just</span> <span class="p">(</span><span class="kt">Set</span><span class="o">.</span><span class="n">insert</span> <span class="n">val</span> <span class="o">$</span> <span class="n">fromMaybe</span> <span class="kt">Set</span><span class="o">.</span><span class="n">empty</span> <span class="n">prev</span><span class="p">)</span>
<span class="nf">yellow_food&#39;</span> <span class="ow">=</span> <span class="n">food_of_color&#39;</span> <span class="kt">Map</span><span class="o">.!</span> <span class="s">&quot;yellow&quot;</span>
<span class="c1">-- =&gt; Set.fromList [&quot;Banana&quot;,&quot;Lemon&quot;]</span>

<span class="c1">-- for every logged-in user, display the ttys on which it is logged</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="kt">Right</span> <span class="n">s</span> <span class="ow">&lt;-</span> <span class="n">readProcess</span> <span class="s">&quot;who&quot;</span> <span class="kt">[]</span> <span class="s">&quot;&quot;</span>
       <span class="kr">let</span> <span class="n">l</span> <span class="ow">=</span> <span class="n">assocListGroupByKey</span> <span class="o">$</span> <span class="n">map</span> <span class="p">(</span><span class="n">parse_it</span> <span class="o">.</span> <span class="n">words</span><span class="p">)</span> <span class="p">(</span><span class="n">lines</span> <span class="n">s</span><span class="p">)</span>
       <span class="n">mapM_</span> <span class="p">(</span><span class="n">putStrLn</span> <span class="o">.</span> <span class="n">format_it</span><span class="p">)</span> <span class="n">l</span>
    <span class="kr">where</span> <span class="n">format_it</span> <span class="n">l</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">ttys</span><span class="p">)</span> <span class="ow">=</span> <span class="n">user</span> <span class="o">++</span> <span class="s">&quot;: &quot;</span> <span class="o">++</span> <span class="n">unwords</span> <span class="n">ttys</span>
          <span class="n">parse_it</span> <span class="p">(</span><span class="n">user</span> <span class="kt">:</span> <span class="n">tty</span> <span class="kt">:</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">tty</span><span class="p">)</span>


<span class="c1">-- @@PLEAC@@_5.8</span>
<span class="nf">surname</span> <span class="ow">=</span> <span class="p">[</span> <span class="p">(</span><span class="s">&quot;Mickey&quot;</span><span class="p">,</span> <span class="s">&quot;Mantle&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;Babe&quot;</span><span class="p">,</span> <span class="s">&quot;Ruth&quot;</span><span class="p">)</span> <span class="p">];</span>
<span class="nf">first_name</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">swap</span> <span class="n">surname</span>
<span class="nf">swap</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>

<span class="kt">Just</span> <span class="n">name</span> <span class="ow">=</span> <span class="n">lookup</span> <span class="s">&quot;Mantle&quot;</span> <span class="n">first_name</span> <span class="c1">-- &quot;Mickey&quot;</span>

<span class="c1">-- see also section &quot;Hashes with Multiple Values Per Key&quot;</span>


<span class="c1">-- @@PLEAC@@_5.9</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">food</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">food</span> <span class="o">++</span> <span class="s">&quot; is &quot;</span> <span class="o">++</span> <span class="n">color</span><span class="p">)</span> <span class="o">$</span> <span class="n">sort</span> <span class="n">food_color</span>
<span class="c1">-- [&quot;Apple is red&quot;,&quot;Banana is yellow&quot;,&quot;Carrot is orange&quot;,&quot;Lemon is yellow&quot;]</span>

<span class="c1">-- sorting on length of color (sortByKey is in &quot;Helpers&quot;)</span>
<span class="nf">t2</span> <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">food</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">food</span> <span class="o">++</span> <span class="s">&quot; is &quot;</span> <span class="o">++</span> <span class="n">color</span><span class="p">)</span> <span class="o">$</span> <span class="n">sortByKey</span> <span class="p">(</span><span class="n">length</span> <span class="o">.</span> <span class="n">snd</span><span class="p">)</span> <span class="n">food_color</span>
<span class="c1">-- =&gt; [&quot;Apple is red&quot;,&quot;Banana is yellow&quot;,&quot;Lemon is yellow&quot;,&quot;Carrot is orange&quot;]</span>

<span class="c1">-- using Data.Map, the simplest is to use Map.assocs and do as above</span>
<span class="nf">t&#39;</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">format_it</span> <span class="o">$</span> <span class="n">sort</span> <span class="o">$</span> <span class="kt">Map</span><span class="o">.</span><span class="n">assocs</span> <span class="n">food_color&#39;</span>
    <span class="kr">where</span> <span class="n">format_it</span> <span class="p">(</span><span class="n">food</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="ow">=</span> <span class="n">food</span> <span class="o">++</span> <span class="s">&quot; is &quot;</span> <span class="o">++</span> <span class="n">color</span>
<span class="c1">-- [&quot;Apple is red&quot;,&quot;Banana is yellow&quot;,&quot;Carrot is orange&quot;,&quot;Lemon is yellow&quot;]</span>

<span class="c1">-- you can of course get keys first, and use Map.!</span>
<span class="nf">t_&#39;</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">format_it</span> <span class="o">$</span> <span class="n">sort</span> <span class="o">$</span> <span class="kt">Map</span><span class="o">.</span><span class="n">keys</span> <span class="n">food_color&#39;</span>
    <span class="kr">where</span> <span class="n">format_it</span> <span class="n">food</span> <span class="ow">=</span> <span class="n">food</span> <span class="o">++</span> <span class="s">&quot; is &quot;</span> <span class="o">++</span> <span class="n">food_color&#39;</span> <span class="kt">Map</span><span class="o">.!</span> <span class="n">food</span>


<span class="c1">-- @@PLEAC@@_5.10</span>
<span class="c1">-- food_color as per the introduction</span>
<span class="nf">drink_color</span> <span class="ow">=</span> <span class="p">[</span> <span class="p">(</span><span class="s">&quot;Galliano&quot;</span><span class="p">,</span> <span class="s">&quot;yellow&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;Mai Tai&quot;</span><span class="p">,</span> <span class="s">&quot;blue&quot;</span><span class="p">)</span> <span class="p">]</span>
<span class="nf">ingested_color</span> <span class="ow">=</span> <span class="n">drink_color</span> <span class="o">++</span> <span class="n">food_color</span>
<span class="c1">-- =&gt; [(&quot;Galliano&quot;,&quot;yellow&quot;),(&quot;Mai Tai&quot;,&quot;blue&quot;),(&quot;Apple&quot;,&quot;red&quot;),(&quot;Banana&quot;,&quot;yellow&quot;),(&quot;Lemon&quot;,&quot;yellow&quot;),(&quot;Carrot&quot;,&quot;orange&quot;)]</span>
<span class="c1">-- (it doesn&#39;t remove duplicates, see section &quot;Finding Common or Different Keys in Two Hashes&quot; for a solution removing duplicates)</span>

<span class="c1">-- using Data.Map</span>
<span class="nf">drink_color&#39;</span> <span class="ow">=</span> <span class="kt">Map</span><span class="o">.</span><span class="n">fromList</span> <span class="n">drink_color</span>
<span class="nf">ingested_color&#39;</span> <span class="ow">=</span> <span class="kt">Map</span><span class="o">.</span><span class="n">union</span> <span class="n">drink_color&#39;</span> <span class="n">food_color&#39;</span>
<span class="c1">-- =&gt; Map.fromList [(&quot;Apple&quot;,&quot;red&quot;),(&quot;Banana&quot;,&quot;yellow&quot;),(&quot;Carrot&quot;,&quot;orange&quot;),(&quot;Galliano&quot;,&quot;yellow&quot;),(&quot;Lemon&quot;,&quot;yellow&quot;),(&quot;Mai Tai&quot;,&quot;blue&quot;)]</span>


<span class="c1">-- @@PLEAC@@_5.11</span>
<span class="c1">-- food_color as per the introduction</span>
<span class="nf">citrus_color</span> <span class="ow">=</span> <span class="p">[</span> <span class="p">(</span><span class="s">&quot;Lemon&quot;</span><span class="p">,</span> <span class="s">&quot;yellow&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;Orange&quot;</span><span class="p">,</span> <span class="s">&quot;orange&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;Lime&quot;</span><span class="p">,</span> <span class="s">&quot;green&quot;</span><span class="p">)</span> <span class="p">]</span>
<span class="nf">common</span> <span class="ow">=</span> <span class="n">food_color</span> <span class="o">++</span> <span class="n">citrus_color</span>
<span class="c1">-- =&gt; [(&quot;Apple&quot;,&quot;red&quot;),(&quot;Banana&quot;,&quot;yellow&quot;),(&quot;Lemon&quot;,&quot;yellow&quot;),(&quot;Carrot&quot;,&quot;orange&quot;),(&quot;Lemon&quot;,&quot;yellow&quot;),(&quot;Orange&quot;,&quot;orange&quot;),(&quot;Lime&quot;,&quot;green&quot;)]</span>
<span class="c1">-- the duplicates are still here, to remove them:</span>
<span class="nf">nubByKey</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">nubBy</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">f</span> <span class="n">a</span> <span class="o">==</span> <span class="n">f</span> <span class="n">b</span><span class="p">)</span>
<span class="nf">common_</span> <span class="ow">=</span> <span class="n">nubByKey</span> <span class="n">fst</span> <span class="n">common</span>
<span class="c1">-- =&gt; [(&quot;Apple&quot;,&quot;red&quot;),(&quot;Banana&quot;,&quot;yellow&quot;),(&quot;Lemon&quot;,&quot;yellow&quot;),(&quot;Carrot&quot;,&quot;orange&quot;),(&quot;Orange&quot;,&quot;orange&quot;),(&quot;Lime&quot;,&quot;green&quot;)]</span>
<span class="c1">-- no more duplicates</span>

<span class="nf">non_citrus</span> <span class="ow">=</span> <span class="n">food_color</span> <span class="o">\\</span> <span class="n">citrus_color</span>
<span class="c1">-- =&gt; [(&quot;Apple&quot;,&quot;red&quot;),(&quot;Banana&quot;,&quot;yellow&quot;),(&quot;Carrot&quot;,&quot;orange&quot;)]</span>

<span class="c1">-- using Data.Map</span>
<span class="nf">citrus_color&#39;</span> <span class="ow">=</span> <span class="kt">Map</span><span class="o">.</span><span class="n">fromList</span> <span class="n">citrus_color</span>
<span class="nf">common&#39;</span> <span class="ow">=</span> <span class="kt">Map</span><span class="o">.</span><span class="n">union</span> <span class="n">food_color&#39;</span> <span class="n">citrus_color&#39;</span>
<span class="c1">-- =&gt; Map.fromList [(&quot;Apple&quot;,&quot;red&quot;),(&quot;Banana&quot;,&quot;yellow&quot;),(&quot;Carrot&quot;,&quot;orange&quot;),(&quot;Lemon&quot;,&quot;yellow&quot;),(&quot;Lime&quot;,&quot;green&quot;),(&quot;Orange&quot;,&quot;orange&quot;)]</span>
<span class="nf">non_citrus&#39;</span> <span class="ow">=</span> <span class="kt">Map</span><span class="o">.</span><span class="n">difference</span> <span class="n">food_color&#39;</span> <span class="n">citrus_color&#39;</span>
<span class="c1">-- =&gt; Map.fromList [(&quot;Apple&quot;,&quot;red&quot;),(&quot;Banana&quot;,&quot;yellow&quot;),(&quot;Carrot&quot;,&quot;orange&quot;)]</span>


<span class="c1">-- @@PLEAC@@_5.12</span>
<span class="c1">-- no problem here, haskell handles any kind of object for key-ing</span>

<span class="nf">name</span> <span class="ow">=</span> <span class="n">mapM</span> <span class="n">open_files</span> <span class="p">[</span> <span class="s">&quot;/etc/termcap&quot;</span><span class="p">,</span> <span class="s">&quot;/etc/passwd&quot;</span><span class="p">,</span> <span class="s">&quot;/bin/cat&quot;</span> <span class="p">]</span>
       <span class="kr">where</span> <span class="n">open_files</span> <span class="n">file</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">fh</span> <span class="ow">&lt;-</span> <span class="n">openFile</span> <span class="n">file</span> <span class="kt">ReadMode</span>
                                  <span class="n">return</span> <span class="p">(</span><span class="n">fh</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">files</span> <span class="ow">&lt;-</span> <span class="n">fmap</span> <span class="p">(</span><span class="n">map</span> <span class="n">snd</span><span class="p">)</span> <span class="n">name</span>
       <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;open files: &quot;</span> <span class="o">++</span> <span class="n">intercalate</span> <span class="s">&quot;, &quot;</span> <span class="n">files</span>
<span class="nf">t2</span> <span class="ow">=</span> <span class="n">name</span> <span class="o">&gt;&gt;=</span> <span class="n">mapM_</span> <span class="n">display_size</span>
    <span class="kr">where</span> <span class="n">display_size</span> <span class="p">(</span><span class="n">fh</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> <span class="ow">=</span> 
              <span class="kr">do</span> <span class="n">size</span> <span class="ow">&lt;-</span> <span class="n">hFileSize</span> <span class="n">fh</span>
                 <span class="n">printf</span> <span class="s">&quot;%s is %d bytes long.</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">file</span> <span class="n">size</span>


<span class="c1">-- @@PLEAC@@_5.13</span>
<span class="c1">-- presizing is only useful for mutable maps</span>

<span class="c1">-- about performance, one may use Map.IntMap when the keys are Int</span>


<span class="c1">-- @@PLEAC@@_5.14</span>
<span class="c1">-- from http://haskell.org/haskellwiki/99_questions/31_to_41#Problem_36</span>
<span class="nf">encode</span> <span class="ow">::</span> <span class="kt">Eq</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="p">[(</span><span class="n">a</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)]</span>
<span class="nf">encode</span> <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">head</span> <span class="n">x</span><span class="p">,</span> <span class="n">length</span> <span class="n">x</span><span class="p">))</span> <span class="o">.</span> <span class="n">group</span>

<span class="nf">s</span> <span class="ow">=</span> <span class="n">encode</span> <span class="o">$</span> <span class="n">sort</span> <span class="s">&quot;Apple Banana Lemon&quot;</span>
<span class="c1">-- =&gt; [(&#39; &#39;,2),(&#39;A&#39;,1),(&#39;B&#39;,1),(&#39;L&#39;,1),(&#39;a&#39;,3),(&#39;e&#39;,2),(&#39;l&#39;,1),(&#39;m&#39;,1),(&#39;n&#39;,3),(&#39;o&#39;,1),(&#39;p&#39;,2)]</span>


<span class="c1">-- @@PLEAC@@_5.15</span>
<span class="kr">import</span> <span class="nn">Data.List</span>

<span class="nf">father</span> <span class="ow">=</span> <span class="p">[</span> <span class="p">(</span><span class="s">&quot;Cain&quot;</span><span class="p">,</span>      <span class="s">&quot;Adam&quot;</span><span class="p">)</span>
	 <span class="p">,</span> <span class="p">(</span><span class="s">&quot;Abel&quot;</span><span class="p">,</span>      <span class="s">&quot;Adam&quot;</span><span class="p">)</span>
	 <span class="p">,</span> <span class="p">(</span><span class="s">&quot;Seth&quot;</span><span class="p">,</span>      <span class="s">&quot;Adam&quot;</span><span class="p">)</span>
	 <span class="p">,</span> <span class="p">(</span><span class="s">&quot;Enoch&quot;</span><span class="p">,</span>     <span class="s">&quot;Cain&quot;</span><span class="p">)</span>
	 <span class="p">,</span> <span class="p">(</span><span class="s">&quot;Irad&quot;</span><span class="p">,</span>      <span class="s">&quot;Enoch&quot;</span><span class="p">)</span>
	 <span class="p">,</span> <span class="p">(</span><span class="s">&quot;Mehujael&quot;</span><span class="p">,</span>  <span class="s">&quot;Irad&quot;</span><span class="p">)</span>
	 <span class="p">,</span> <span class="p">(</span><span class="s">&quot;Methusael&quot;</span><span class="p">,</span> <span class="s">&quot;Mehujael&quot;</span><span class="p">)</span>
	 <span class="p">,</span> <span class="p">(</span><span class="s">&quot;Lamech&quot;</span><span class="p">,</span>    <span class="s">&quot;Methusael&quot;</span><span class="p">)</span>
	 <span class="p">,</span> <span class="p">(</span><span class="s">&quot;Jabal&quot;</span><span class="p">,</span>     <span class="s">&quot;Lamech&quot;</span><span class="p">)</span>
	 <span class="p">,</span> <span class="p">(</span><span class="s">&quot;Jubal&quot;</span><span class="p">,</span>     <span class="s">&quot;Lamech&quot;</span><span class="p">)</span>
	 <span class="p">,</span> <span class="p">(</span><span class="s">&quot;Tubalcain&quot;</span><span class="p">,</span> <span class="s">&quot;Lamech&quot;</span><span class="p">)</span>
	 <span class="p">,</span> <span class="p">(</span><span class="s">&quot;Enos&quot;</span><span class="p">,</span>      <span class="s">&quot;Seth&quot;</span><span class="p">)</span>
	 <span class="p">]</span>

<span class="nf">upline</span> <span class="n">person</span> <span class="ow">=</span> <span class="n">person</span> <span class="kt">:</span> <span class="n">parents</span>
    <span class="kr">where</span> <span class="n">parents</span> <span class="ow">=</span> <span class="n">unfoldr</span> <span class="p">(</span><span class="nf">\</span><span class="n">name</span> <span class="ow">-&gt;</span> <span class="n">fmap</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">))</span> <span class="o">$</span> <span class="n">lookup</span> <span class="n">name</span> <span class="n">father</span><span class="p">)</span> <span class="n">person</span>
<span class="c1">-- you can replace (\x -&gt; (x,x)) with (join (,))   (&quot;join&quot; is from Control.Monad)</span>

<span class="nf">from_Irad</span> <span class="ow">=</span> <span class="n">upline</span> <span class="s">&quot;Irad&quot;</span>       <span class="c1">-- [&quot;Irad&quot;,&quot;Enoch&quot;,&quot;Cain&quot;,&quot;Adam&quot;]</span>

<span class="nf">ifNull</span> <span class="n">default_</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="n">default_</span>
<span class="nf">ifNull</span> <span class="kr">_</span> <span class="n">l</span> <span class="ow">=</span> <span class="n">l</span>

<span class="nf">downline</span> <span class="n">person</span> <span class="ow">=</span> <span class="n">person</span> <span class="o">++</span> <span class="s">&quot; begat &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">ifNull</span> <span class="s">&quot;Nobody&quot;</span> <span class="o">$</span> <span class="n">intercalate</span> <span class="s">&quot;, &quot;</span> <span class="o">$</span> <span class="n">children</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">children</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">fst</span> <span class="o">$</span> <span class="n">filter</span> <span class="p">((</span><span class="o">==</span> <span class="n">person</span><span class="p">)</span> <span class="o">.</span> <span class="n">snd</span><span class="p">)</span> <span class="n">father</span>

<span class="nf">to_Tubalcain</span> <span class="ow">=</span> <span class="n">downline</span> <span class="s">&quot;Tubalcain&quot;</span> <span class="c1">-- Tubalcain begat Nobody</span>
<span class="nf">to_Adam</span>      <span class="ow">=</span> <span class="n">downline</span> <span class="s">&quot;Adam&quot;</span>      <span class="c1">-- Adam begat Cain, Abel, Seth</span>


<span class="c1">-- the perl example is doing something quite weird,</span>
<span class="c1">-- include_free is the list of files which are not included by other files,</span>
<span class="c1">-- but that do include a file.</span>
<span class="nf">dir</span> <span class="ow">=</span> <span class="s">&quot;/usr/include&quot;</span>
<span class="nf">include_free</span> <span class="ow">=</span>
    <span class="kr">do</span> <span class="n">files</span> <span class="ow">&lt;-</span> <span class="n">getDirectoryContents</span> <span class="n">dir</span>
       <span class="kr">let</span> <span class="n">h_files</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(</span><span class="n">isSuffixOf</span> <span class="s">&quot;.h&quot;</span><span class="p">)</span> <span class="n">files</span>
       <span class="n">file2includes</span> <span class="ow">&lt;-</span> <span class="n">mapM</span> <span class="n">get_includes</span> <span class="n">h_files</span>
       <span class="c1">-- getting the files that do include something:</span>
       <span class="kr">let</span> <span class="n">files_</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">fst</span> <span class="o">$</span> <span class="n">filter</span> <span class="p">(</span><span class="n">not</span> <span class="o">.</span> <span class="n">null</span> <span class="o">.</span> <span class="n">snd</span><span class="p">)</span> <span class="n">file2includes</span>
       <span class="c1">-- removing files included by other files:</span>
       <span class="n">return</span> <span class="o">$</span> <span class="n">files_</span> <span class="o">\\</span> <span class="p">(</span><span class="n">concatMap</span> <span class="n">snd</span> <span class="n">file2includes</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">get_includes</span> <span class="n">h_file</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="p">(</span><span class="n">with_content</span> <span class="n">h_file</span><span class="p">)</span> <span class="p">(</span><span class="n">readFile</span> <span class="o">$</span> <span class="n">dir</span> <span class="o">++</span> <span class="s">&quot;/&quot;</span> <span class="o">++</span> <span class="n">h_file</span><span class="p">)</span>
          <span class="n">with_content</span> <span class="n">h_file</span> <span class="n">content</span> <span class="ow">=</span> <span class="p">(</span><span class="n">h_file</span><span class="p">,</span> <span class="n">content_to_includes</span> <span class="n">content</span><span class="p">)</span>
          <span class="n">content_to_includes</span> <span class="ow">=</span> <span class="n">catMaybes</span> <span class="o">.</span> <span class="n">map</span> <span class="p">(</span><span class="n">fmap</span> <span class="n">head</span> <span class="o">.</span> <span class="n">matchRegex</span> <span class="n">regex</span><span class="p">)</span> <span class="o">.</span> <span class="n">lines</span>
          <span class="n">regex</span> <span class="ow">=</span> <span class="n">mkRegex</span> <span class="s">&quot;^</span><span class="se">\\</span><span class="s">s*#</span><span class="se">\\</span><span class="s">s*include</span><span class="se">\\</span><span class="s">s*&lt;([^&gt;]+)&gt;&quot;</span>


<span class="c1">-- @@PLEAC@@_5.16</span>
<span class="kr">import</span> <span class="nn">Data.Ord</span> <span class="p">(</span><span class="nf">comparing</span><span class="p">)</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Tree</span> <span class="k">as</span> <span class="n">Tree</span>

<span class="nf">dirname_basename</span> <span class="n">file</span> <span class="ow">=</span> <span class="p">(</span><span class="kr">if</span> <span class="n">dir</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="kr">then</span> <span class="s">&quot;.&quot;</span> <span class="kr">else</span> <span class="p">(</span><span class="n">reverse</span> <span class="o">$</span> <span class="n">tail</span> <span class="n">dir</span><span class="p">),</span> <span class="n">reverse</span> <span class="n">base</span><span class="p">)</span>
    <span class="kr">where</span> <span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">dir</span><span class="p">)</span> <span class="ow">=</span> <span class="n">break</span> <span class="p">(</span><span class="o">==</span> <span class="sc">&#39;/&#39;</span><span class="p">)</span> <span class="o">$</span> <span class="n">reverse</span> <span class="n">file</span>

<span class="nf">dirname</span> <span class="ow">=</span> <span class="n">fst</span> <span class="o">.</span> <span class="n">dirname_basename</span>
<span class="nf">basename</span> <span class="ow">=</span> <span class="n">snd</span> <span class="o">.</span> <span class="n">dirname_basename</span>

<span class="nf">duProcessFakedInput</span> <span class="ow">=</span> 
    <span class="s">&quot;11732   groovysoap/lib</span><span class="se">\n\</span>
<span class="se">    \</span><span class="s">68      groovysoap/src/main/groovy/net/soap</span><span class="se">\n\</span>
<span class="se">    \</span><span class="s">71      groovysoap/src/main/groovy/net</span><span class="se">\n\</span>
<span class="se">    \</span><span class="s">74      groovysoap/src/main/groovy</span><span class="se">\n\</span>
<span class="se">    \</span><span class="s">77      groovysoap/src/main</span><span class="se">\n\</span>
<span class="se">    \</span><span class="s">9       groovysoap/src/examples</span><span class="se">\n\</span>
<span class="se">    \</span><span class="s">8       groovysoap/src/examples/groovy</span><span class="se">\n\</span>
<span class="se">    \</span><span class="s">102     groovysoap/src/test</span><span class="se">\n\</span>
<span class="se">    \</span><span class="s">202     groovysoap/src</span><span class="se">\n\</span>
<span class="se">    \</span><span class="s">11966   groovysoap</span><span class="se">\n</span><span class="s">&quot;</span>

<span class="nf">sortByKeyRev</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">snd</span> <span class="o">.</span> <span class="n">sortBy</span> <span class="p">(</span><span class="n">flip</span> <span class="o">$</span> <span class="n">comparing</span> <span class="n">fst</span><span class="p">)</span> <span class="o">.</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">f</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

<span class="nf">dirs_tree</span> <span class="ow">::</span> <span class="kt">Tree</span><span class="o">.</span><span class="kt">Tree</span> <span class="p">(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span>
<span class="nf">dirs_tree</span> <span class="ow">=</span> <span class="kt">Tree</span><span class="o">.</span><span class="n">unfoldTree</span> <span class="n">get_info</span> <span class="p">(</span><span class="n">last</span> <span class="n">dir2size</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">get_info</span> <span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span> <span class="ow">=</span> 
              <span class="kr">let</span> <span class="n">subdirs</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">((</span><span class="o">==</span> <span class="n">dir</span><span class="p">)</span> <span class="o">.</span> <span class="n">dirname</span> <span class="o">.</span> <span class="n">fst</span><span class="p">)</span> <span class="n">dir2size</span> <span class="kr">in</span>
              <span class="p">((</span><span class="n">dir</span><span class="p">,</span> <span class="n">size</span><span class="p">),</span> 
               <span class="kr">if</span> <span class="n">null</span> <span class="n">subdirs</span> <span class="kr">then</span> <span class="kt">[]</span> <span class="kr">else</span> 
                   <span class="n">sortByKeyRev</span> <span class="n">snd</span> <span class="o">$</span> <span class="n">subdirs</span> <span class="o">++</span> <span class="p">[</span> <span class="p">(</span><span class="n">dir</span> <span class="o">++</span> <span class="s">&quot;/.&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">sum</span> <span class="p">(</span><span class="n">map</span> <span class="n">snd</span> <span class="n">subdirs</span><span class="p">))</span> <span class="p">])</span>
          <span class="n">dir2size</span> <span class="ow">=</span> <span class="n">map</span> <span class="p">((</span><span class="nf">\</span><span class="p">(</span><span class="n">size</span><span class="kt">:</span><span class="n">dir</span><span class="kt">:</span><span class="kr">_</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">read</span> <span class="n">size</span><span class="p">))</span> <span class="o">.</span> <span class="n">words</span><span class="p">)</span> <span class="o">$</span> <span class="n">lines</span> <span class="n">duProcessFakedInput</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="n">putStr</span> <span class="o">$</span> <span class="kt">Tree</span><span class="o">.</span><span class="n">drawTree</span><span class="o">$</span> <span class="n">fmap</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">s</span><span class="p">)</span><span class="ow">-&gt;</span> <span class="n">show</span> <span class="n">s</span> <span class="o">++</span> <span class="s">&quot; &quot;</span> <span class="o">++</span> <span class="n">basename</span> <span class="n">f</span><span class="p">)</span> <span class="n">dirs_tree</span>
<span class="c1">-- using Tree.drawTree, the result is not as expected, but it&#39;s quite nice:</span>
<span class="c1">--</span>
<span class="c1">-- 11966 groovysoap</span>
<span class="c1">-- |</span>
<span class="c1">-- +- 11732 lib</span>
<span class="c1">-- |</span>
<span class="c1">-- +- 202 src</span>
<span class="c1">-- |  |</span>
<span class="c1">-- |  +- 102 test</span>
<span class="c1">-- |  |</span>
<span class="c1">-- |  +- 77 main</span>
<span class="c1">-- |  |  |</span>
<span class="c1">-- |  |  +- 74 groovy</span>
<span class="c1">-- |  |  |  |</span>
<span class="c1">-- |  |  |  +- 71 net</span>
<span class="c1">-- |  |  |  |  |</span>
<span class="c1">-- |  |  |  |  +- 68 soap</span>
<span class="c1">-- |  |  |  |  |</span>
<span class="c1">-- |  |  |  |  `- 3 .</span>
<span class="c1">-- |  |  |  |</span>
<span class="c1">-- |  |  |  `- 3 .</span>
<span class="c1">-- |  |  |</span>
<span class="c1">-- |  |  `- 3 .</span>
<span class="c1">-- |  |</span>
<span class="c1">-- |  +- 14 .</span>
<span class="c1">-- |  |</span>
<span class="c1">-- |  `- 9 examples</span>
<span class="c1">-- |     |</span>
<span class="c1">-- |     +- 8 groovy</span>
<span class="c1">-- |     |</span>
<span class="c1">-- |     `- 1 .</span>
<span class="c1">-- |</span>
<span class="c1">-- `- 32 .</span>

<span class="c1">-- now the exact same solution </span>
<span class="nf">mydraw</span> <span class="ow">::</span> <span class="kt">Tree</span><span class="o">.</span><span class="kt">Tree</span> <span class="p">(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
<span class="nf">mydraw</span> <span class="n">tree</span> <span class="ow">=</span> <span class="n">unlines</span> <span class="o">$</span> <span class="n">drawSubTrees</span> <span class="p">[</span><span class="n">tree</span><span class="p">]</span>
  <span class="kr">where</span> <span class="n">drawSubTrees</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="kt">[]</span>
	<span class="n">drawSubTrees</span> <span class="n">l</span><span class="o">@</span><span class="p">(</span><span class="kt">Tree</span><span class="o">.</span><span class="kt">Node</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="n">size_max</span><span class="p">)</span> <span class="kr">_</span> <span class="kt">:</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">=</span>
            <span class="kr">let</span> <span class="n">format</span> <span class="ow">=</span> <span class="s">&quot;%&quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="p">(</span><span class="n">length</span> <span class="o">$</span> <span class="n">show</span> <span class="n">size_max</span><span class="p">)</span> <span class="o">++</span> <span class="s">&quot;s %s&quot;</span> <span class="kr">in</span>
            <span class="kr">let</span> <span class="n">draw_one</span> <span class="p">(</span><span class="kt">Tree</span><span class="o">.</span><span class="kt">Node</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span> <span class="n">sub</span><span class="p">)</span> <span class="ow">=</span>
                    <span class="kr">let</span> <span class="n">name&#39;</span> <span class="ow">=</span> <span class="n">basename</span> <span class="n">name</span> <span class="kr">in</span>
                    <span class="n">printf</span> <span class="n">format</span> <span class="p">(</span><span class="n">show</span> <span class="n">size</span><span class="p">)</span> <span class="n">name&#39;</span> <span class="kt">:</span>
                           <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">s</span> <span class="ow">-&gt;</span> <span class="n">printf</span> <span class="n">format</span> <span class="s">&quot;|&quot;</span> <span class="p">(</span><span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="kr">_</span> <span class="ow">-&gt;</span> <span class="sc">&#39; &#39;</span><span class="p">)</span> <span class="n">name&#39;</span><span class="p">)</span> <span class="o">++</span> <span class="n">s</span><span class="p">)</span> <span class="p">(</span><span class="n">drawSubTrees</span> <span class="n">sub</span><span class="p">)</span> <span class="kr">in</span>
            <span class="n">concatMap</span> <span class="n">draw_one</span> <span class="n">l</span>

<span class="nf">t2</span> <span class="ow">=</span> <span class="n">putStr</span> <span class="o">$</span> <span class="n">mydraw</span> <span class="n">dirs_tree</span>

<span class="c1">--11966 groovysoap</span>
<span class="c1">--    |           11732 lib</span>
<span class="c1">--    |             202 src</span>
<span class="c1">--    |               |    102 test</span>
<span class="c1">--    |               |     77 main</span>
<span class="c1">--    |               |      |     74 groovy</span>
<span class="c1">--    |               |      |      |       71 net</span>
<span class="c1">--    |               |      |      |        |    68 soap</span>
<span class="c1">--    |               |      |      |        |     3 .</span>
<span class="c1">--    |               |      |      |        3 .</span>
<span class="c1">--    |               |      |      3 .</span>
<span class="c1">--    |               |     14 .</span>
<span class="c1">--    |               |      9 examples</span>
<span class="c1">--    |               |      |         8 groovy</span>
<span class="c1">--    |               |      |         1 .</span>
<span class="c1">--    |              32 .</span>

<span class="c1">-- @@PLEAC@@_6.0</span>
<span class="c1">-- for info about the various regexp libraries, see http://haskell.org/haskellwiki/Regular_expressions</span>
<span class="c1">--</span>
<span class="c1">-- [Oct 2008] Text.Regex.Posix/Text.Regex.Base provides =~ which is quite powerful</span>
<span class="c1">-- but it misses simple things like subRegex and splitRegex so in many cases</span>
<span class="c1">-- Text.Regex must be used</span>
<span class="c1">--</span>
<span class="c1">-- with Text.Regex.Posix:</span>
<span class="kr">import</span> <span class="nn">Text.Regex.Posix</span>
<span class="kr">import</span> <span class="nn">Text.Regex.Base</span>

<span class="nf">meadow</span> <span class="ow">=</span> <span class="p">[</span> <span class="s">&quot;sheeps are ovine&quot;</span><span class="p">,</span> <span class="s">&quot;Sheeps are ovine&quot;</span>
         <span class="p">,</span> <span class="s">&quot;Fine bovines demand fine toreadors.&quot;</span>
         <span class="p">,</span> <span class="s">&quot;Muskoxen are polar ovibovine species.&quot;</span>
         <span class="p">,</span> <span class="s">&quot;Grooviness went out of fashion decades ago.&quot;</span> <span class="p">]</span>

<span class="nf">t1</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(</span><span class="o">=~</span> <span class="s">&quot;sheep&quot;</span><span class="p">)</span> <span class="n">meadow</span>
<span class="c1">-- [&quot;sheeps are ovine&quot;]</span>

<span class="nf">t2</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(</span><span class="o">=~</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&lt;ovines?&quot;</span><span class="p">)</span> <span class="n">meadow</span>
<span class="c1">-- [&quot;sheeps are ovine&quot;,&quot;Sheeps are ovine&quot;]</span>

<span class="c1">-- below require &quot;import Data.Bits&quot; for .|. :</span>
<span class="nf">ignoreCase</span> <span class="ow">=</span> <span class="n">makeRegexOpts</span> <span class="p">(</span><span class="n">defaultCompOpt</span> <span class="o">.|.</span> <span class="n">compIgnoreCase</span><span class="p">)</span> <span class="n">defaultExecOpt</span>
<span class="nf">t3</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(</span><span class="n">matchTest</span> <span class="o">$</span> <span class="n">ignoreCase</span> <span class="s">&quot;sheep&quot;</span><span class="p">)</span> <span class="n">meadow</span>
<span class="c1">-- [&quot;sheeps are ovine&quot;,&quot;Sheeps are ovine&quot;]</span>


<span class="c1">-- the same with Text.Regex:</span>
<span class="kr">import</span> <span class="nn">Data.Maybe</span>
<span class="kr">import</span> <span class="nn">Text.Regex</span>

<span class="nf">t1</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(</span><span class="n">isJust</span> <span class="o">.</span> <span class="n">matchRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;sheep&quot;</span><span class="p">))</span> <span class="n">meadow</span>
<span class="c1">-- [&quot;sheeps are ovine&quot;]</span>

<span class="nf">t2</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(</span><span class="n">isJust</span> <span class="o">.</span> <span class="n">matchRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&lt;ovines?&quot;</span><span class="p">))</span> <span class="n">meadow</span>
<span class="c1">-- [&quot;sheeps are ovine&quot;,&quot;Sheeps are ovine&quot;]</span>

<span class="nf">ignoreCase</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">mkRegexWithOpts</span> <span class="n">s</span> <span class="kt">True</span> <span class="kt">False</span>
<span class="nf">t3</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(</span><span class="n">isJust</span> <span class="o">.</span> <span class="n">matchRegex</span> <span class="p">(</span><span class="n">ignoreCase</span> <span class="s">&quot;sheep&quot;</span><span class="p">))</span> <span class="n">meadow</span>
<span class="c1">-- [&quot;sheeps are ovine&quot;,&quot;Sheeps are ovine&quot;]</span>

<span class="c1">-- note that Data.ByteString.Char8 has a few interesting functions,</span>
<span class="c1">-- but usually regexps are better</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.ByteString.Char8</span> <span class="k">as</span> <span class="n">B</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="n">filter</span> <span class="n">is_sheep</span> <span class="n">meadow</span>
    <span class="kr">where</span> <span class="n">is_sheep</span> <span class="n">s</span> <span class="ow">=</span> <span class="kt">B</span><span class="o">.</span><span class="n">isInfixOf</span> <span class="p">(</span><span class="kt">B</span><span class="o">.</span><span class="n">pack</span> <span class="s">&quot;sheep&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">B</span><span class="o">.</span><span class="n">pack</span> <span class="n">s</span><span class="p">)</span>
<span class="c1">-- [&quot;sheeps are ovine&quot;]</span>


<span class="nf">s1</span> <span class="ow">=</span> <span class="n">subRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;o+&quot;</span><span class="p">)</span> <span class="s">&quot;good food&quot;</span> <span class="s">&quot;e&quot;</span>
<span class="c1">-- ged fed </span>

<span class="c1">-- the following helper functions are useful</span>
<span class="nf">subRegexWith</span> <span class="n">re</span> <span class="n">new</span> <span class="n">s</span> <span class="ow">=</span>
    <span class="kr">case</span> <span class="n">matchRegexAll</span> <span class="n">re</span> <span class="n">s</span> <span class="kr">of</span>
      <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="n">s</span>
      <span class="kt">Just</span> <span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">matched</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">before</span> <span class="o">++</span> <span class="n">new</span> <span class="n">matched</span> <span class="o">++</span> <span class="p">(</span><span class="n">subRegexWith</span> <span class="n">re</span> <span class="n">new</span> <span class="n">after</span><span class="p">)</span>
<span class="nf">subRegexOnceWith</span> <span class="n">re</span> <span class="n">new</span> <span class="n">s</span> <span class="ow">=</span> 
    <span class="kr">case</span> <span class="n">matchRegexAll</span> <span class="n">re</span> <span class="n">s</span> <span class="kr">of</span>
      <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="n">s</span>
      <span class="kt">Just</span> <span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">matched</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">before</span> <span class="o">++</span> <span class="n">new</span> <span class="n">matched</span> <span class="o">++</span> <span class="n">after</span>

<span class="nf">s2</span> <span class="ow">=</span> <span class="n">subRegexOnceWith</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;o+&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">\</span><span class="kr">_</span> <span class="ow">-&gt;</span> <span class="s">&quot;e&quot;</span><span class="p">)</span> <span class="s">&quot;good food&quot;</span> 
<span class="c1">-- ged food</span>


<span class="nf">digits</span> <span class="ow">=</span> <span class="s">&quot;123456789&quot;</span><span class="p">;</span>
<span class="nf">l</span> <span class="ow">=</span> <span class="n">digits</span> <span class="o">=~</span> <span class="s">&quot;...&quot;</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="c1">-- nb: in List context, calls matchAll</span>
<span class="c1">-- [&quot;123&quot;,&quot;456&quot;,&quot;789&quot;]</span>

<span class="c1">-- for overlapping matches, one must do it by hand:</span>
<span class="nf">allOverlappingMatches</span> <span class="n">re</span> <span class="n">s</span> <span class="ow">=</span> 
    <span class="kr">case</span> <span class="n">matchRegexAll</span> <span class="n">re</span> <span class="n">s</span> <span class="kr">of</span>
      <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="kt">[]</span>
      <span class="kt">Just</span> <span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">matched</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">matched</span> <span class="kt">:</span> <span class="n">allOverlappingMatches</span> <span class="n">re</span> <span class="p">(</span><span class="n">tail</span> <span class="n">matched</span> <span class="o">++</span> <span class="n">after</span><span class="p">)</span>

<span class="nf">l</span> <span class="ow">=</span> <span class="n">allOverlappingMatches</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;...&quot;</span><span class="p">)</span> <span class="n">digits</span>
<span class="c1">-- [&quot;123&quot;,&quot;234&quot;,&quot;345&quot;,&quot;456&quot;,&quot;567&quot;,&quot;678&quot;,&quot;789&quot;]</span>


<span class="nf">string</span> <span class="ow">=</span> <span class="s">&quot;And little lambs eat ivy&quot;</span>
<span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">matched</span><span class="p">,</span> <span class="n">after</span><span class="p">)</span> <span class="ow">=</span> <span class="n">string</span> <span class="o">=~</span> <span class="s">&quot;l[^s]*s&quot;</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">)</span>
<span class="nf">s</span> <span class="ow">=</span> <span class="n">printf</span> <span class="s">&quot;(%s) (%s) (%s)&quot;</span> <span class="n">before</span> <span class="n">matched</span> <span class="n">after</span> <span class="ow">::</span> <span class="kt">String</span>
<span class="c1">-- &quot;(And ) (little lambs) ( eat ivy)&quot;</span>

<span class="c1">-- @@PLEAC@@_6.1</span>
<span class="c1">-- copying is the default in pure languages :)</span>
<span class="kr">import</span> <span class="nn">Text.Regex</span>
<span class="kr">import</span> <span class="nn">System.Environment</span>
<span class="kr">import</span> <span class="nn">System.FilePath.Posix</span>

<span class="nf">prog_</span> <span class="ow">=</span> <span class="n">subRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;.*/&quot;</span><span class="p">)</span> <span class="s">&quot;/etc/foo&quot;</span> <span class="s">&quot;&quot;</span>
<span class="c1">-- &quot;foo&quot;</span>
<span class="c1">-- but it&#39;s much nicer to use takeFileName</span>
<span class="nf">prog__</span> <span class="ow">=</span> <span class="n">takeFileName</span> <span class="s">&quot;/etc/foo&quot;</span>
<span class="c1">-- &quot;foo&quot;</span>

<span class="c1">-- as for the program basename, it is:</span>
<span class="nf">prog</span> <span class="ow">=</span> <span class="n">getProgName</span>


<span class="nf">manpage</span> <span class="ow">=</span> <span class="s">&quot;/usr/man/man3/foo.1&quot;</span>
<span class="nf">catpage</span> <span class="ow">=</span> <span class="n">subRegexMatchesWith</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;man([0-9])&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nf">\</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="s">&quot;cat&quot;</span> <span class="o">++</span> <span class="n">n</span><span class="p">)</span> <span class="n">manpage</span>
<span class="c1">-- /usr/man/cat3/foo.1</span>

<span class="nf">subRegexMatchesWith</span> <span class="n">re</span> <span class="n">new</span> <span class="n">s</span> <span class="ow">=</span> 
    <span class="kr">case</span> <span class="n">matchRegexAll</span> <span class="n">re</span> <span class="n">s</span> <span class="kr">of</span>
      <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="n">s</span>
      <span class="kt">Just</span> <span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">matched</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">before</span> <span class="o">++</span> <span class="n">new</span> <span class="n">l</span> <span class="o">++</span> <span class="n">after</span>

<span class="nf">bindirs</span> <span class="ow">=</span> <span class="p">[</span> <span class="s">&quot;/usr/bin&quot;</span><span class="p">,</span> <span class="s">&quot;/bin&quot;</span><span class="p">,</span> <span class="s">&quot;/usr/local/bin&quot;</span> <span class="p">]</span>
<span class="nf">libdirs</span> <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">s</span> <span class="ow">-&gt;</span> <span class="n">subRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;bin$&quot;</span><span class="p">)</span> <span class="n">s</span> <span class="s">&quot;lib&quot;</span><span class="p">)</span> <span class="n">bindirs</span>

<span class="c1">-- @@PLEAC@@_6.2</span>
<span class="nf">is_pure_alphabetic</span> <span class="ow">=</span> <span class="n">isJust</span> <span class="o">.</span> <span class="n">matchRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;^[A-Za-z]+$&quot;</span><span class="p">)</span>
<span class="nf">is_pure_alphabetic_</span> <span class="ow">=</span> <span class="n">all</span> <span class="n">isLetter</span> <span class="c1">-- this handles unicode (accents...)</span>

<span class="nf">some_words</span> <span class="ow">=</span> <span class="p">[</span> <span class="s">&quot;silly&quot;</span><span class="p">,</span> <span class="s">&quot;random!stuff#here&quot;</span><span class="p">,</span> <span class="s">&quot;faÃ§ade&quot;</span><span class="p">,</span> <span class="s">&quot;tschÃŒÃ&quot;</span><span class="p">,</span> <span class="s">&quot;niÃ±o&quot;</span><span class="p">,</span> <span class="s">&quot;ÑÑÑÑÐºÐžÐ¹&quot;</span> <span class="p">]</span>
<span class="nf">l1</span> <span class="ow">=</span> <span class="n">filter</span> <span class="n">is_pure_alphabetic</span> <span class="n">some_words</span> <span class="c1">-- [&quot;silly&quot;]</span>
<span class="nf">l2</span> <span class="ow">=</span> <span class="n">filter</span> <span class="n">is_pure_alphabetic_</span> <span class="n">some_words</span> <span class="c1">-- all except &quot;random!stuff#here&quot;</span>

<span class="c1">-- @@PLEAC@@_6.3</span>
<span class="c1">-- &quot;\\S+&quot;         -- as many non-whitespace bytes as possible</span>
<span class="c1">-- &quot;[A-Za-z&#39;-]+&quot;  -- as many letters, apostrophes, and hyphens</span>
<span class="c1">-- </span>
<span class="c1">-- &quot;\\&lt;([A-Za-z]+)\\&gt;&quot; -- usually best</span>
<span class="c1">-- &quot;\\s([A-Za-z]+)\\s&quot; -- fails at ends or w/ punctuation</span>

<span class="c1">-- words is similar to splitting on &quot;\s+&quot;</span>
<span class="nf">l</span> <span class="ow">=</span> <span class="n">words</span> <span class="s">&quot;A text   with some</span><span class="se">\t</span><span class="s">separator</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="c1">-- [&quot;A&quot;,&quot;text&quot;,&quot;with&quot;,&quot;some&quot;,&quot;separator&quot;]</span>
<span class="c1">--</span>
<span class="c1">-- (nb: spaces at beginning or end do not change the result)</span>

<span class="c1">-- @@PLEAC@@_6.4</span>
<span class="c1">-- Commenting Regular Expressions</span>
<span class="c1">-- since regexps are simple strings, you can concatenate regexp pieces:</span>
<span class="nf">re</span> <span class="ow">=</span> <span class="s">&quot;#&quot;</span>          <span class="c1">-- a pound sign</span>
     <span class="o">++</span> <span class="s">&quot;(</span><span class="se">\\</span><span class="s">w+)&quot;</span>  <span class="c1">-- the variable name</span>
     <span class="o">++</span> <span class="s">&quot;#&quot;</span>       <span class="c1">-- another pound sign</span>
<span class="nf">expand_macro</span> <span class="n">vals</span> <span class="ow">=</span> <span class="n">subAllRegexMatchesWith</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="n">re</span><span class="p">)</span> <span class="n">get_val</span>
    <span class="kr">where</span> <span class="n">get_val</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="ow">=</span> <span class="n">fromJust</span> <span class="p">(</span><span class="n">lookup</span> <span class="n">s</span> <span class="n">vals</span><span class="p">)</span>
<span class="nf">s</span> <span class="ow">=</span> <span class="n">expand_macro</span> <span class="p">[</span> <span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;42&quot;</span><span class="p">)</span> <span class="p">]</span> <span class="s">&quot;blah #foo# blah&quot;</span>
<span class="c1">-- &quot;blah 42 blah&quot;</span>

<span class="nf">subAllRegexMatchesWith</span> <span class="n">re</span> <span class="n">new</span> <span class="n">s</span> <span class="ow">=</span> 
    <span class="kr">case</span> <span class="n">matchRegexAll</span> <span class="n">re</span> <span class="n">s</span> <span class="kr">of</span>
      <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="n">s</span>
      <span class="kt">Just</span> <span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">matched</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">before</span> <span class="o">++</span> <span class="n">new</span> <span class="n">l</span> <span class="o">++</span> <span class="p">(</span><span class="n">subAllRegexMatchesWith</span> <span class="n">re</span> <span class="n">new</span> <span class="n">after</span><span class="p">)</span>

<span class="c1">-- @@PLEAC@@_6.5</span>
<span class="nf">fishes</span> <span class="ow">=</span> <span class="s">&quot;One fish two fish red fish blue fish&quot;</span>

<span class="c1">-- first some very simple and useful functions:</span>
<span class="nf">ignoreCase</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">mkRegexWithOpts</span> <span class="n">s</span> <span class="kt">True</span> <span class="kt">False</span>
<span class="nf">allMatches</span> <span class="n">re</span> <span class="n">s</span> <span class="ow">=</span>
    <span class="kr">case</span> <span class="n">matchRegexAll</span> <span class="n">re</span> <span class="n">s</span> <span class="kr">of</span>
      <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="kt">[]</span>
      <span class="kt">Just</span> <span class="p">(</span><span class="n">_before</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">matches</span> <span class="kt">:</span> <span class="n">allMatches</span> <span class="n">re</span> <span class="n">after</span>

<span class="c1">-- here we go:</span>
<span class="nf">colors</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">head</span> <span class="o">$</span> <span class="n">allMatches</span> <span class="p">(</span><span class="n">ignoreCase</span> <span class="s">&quot;(</span><span class="se">\\</span><span class="s">w+)</span><span class="se">\\</span><span class="s">s+fish</span><span class="se">\\</span><span class="s">&gt;&quot;</span><span class="p">)</span> <span class="n">fishes</span>
<span class="c1">-- [&quot;One&quot;,&quot;two&quot;,&quot;red&quot;,&quot;blue&quot;]</span>
<span class="nf">s1</span> <span class="ow">=</span> <span class="n">printf</span> <span class="s">&quot;The third fish is a %s one.&quot;</span> <span class="p">(</span><span class="n">colors</span> <span class="o">!!</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">::</span> <span class="kt">String</span>
<span class="c1">-- The third fish is a red one.</span>

<span class="c1">-- another solution to skip the first 2 matches using an ad&#39;hoc regexp:</span>
<span class="nf">s2</span> <span class="ow">=</span> <span class="n">printf</span> <span class="s">&quot;The third fish is a %s one.&quot;</span> <span class="n">color</span> <span class="ow">::</span> <span class="kt">String</span>
    <span class="kr">where</span> <span class="kt">Just</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="p">[</span><span class="kr">_</span><span class="p">,</span> <span class="n">color</span><span class="p">])</span> <span class="ow">=</span> 
              <span class="n">matchRegexAll</span> <span class="p">(</span><span class="n">ignoreCase</span> <span class="s">&quot;(</span><span class="se">\\</span><span class="s">w+</span><span class="se">\\</span><span class="s">s+fish</span><span class="se">\\</span><span class="s">s+){2}(</span><span class="se">\\</span><span class="s">w+)</span><span class="se">\\</span><span class="s">s+fish&quot;</span><span class="p">)</span> <span class="n">fishes</span>
<span class="c1">-- The third fish is a red one.</span>

<span class="c1">-- a modified subRegex to be able to handle differently the 4th match</span>
<span class="nf">subRegexWithEnv</span> <span class="n">re</span> <span class="n">f</span> <span class="n">env</span> <span class="n">s</span> <span class="ow">=</span>
    <span class="kr">case</span> <span class="n">matchRegexAll</span> <span class="n">re</span> <span class="n">s</span> <span class="kr">of</span>
      <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="n">s</span>
      <span class="kt">Just</span> <span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">matched</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">before</span> <span class="o">++</span> <span class="n">matched&#39;</span> <span class="o">++</span> <span class="p">(</span><span class="n">subRegexWithEnv</span> <span class="n">re</span> <span class="n">f</span> <span class="n">env&#39;</span> <span class="n">after</span><span class="p">)</span>
          <span class="kr">where</span> <span class="p">(</span><span class="n">env&#39;</span><span class="p">,</span> <span class="n">matched&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">f</span> <span class="n">env</span> <span class="p">(</span><span class="n">matched</span><span class="kt">:</span><span class="n">matches</span><span class="p">)</span>

<span class="nf">s3</span> <span class="ow">=</span> <span class="n">subRegexWithEnv</span> <span class="p">(</span><span class="n">ignoreCase</span> <span class="s">&quot;(</span><span class="se">\\</span><span class="s">w+)(</span><span class="se">\\</span><span class="s">s+fish</span><span class="se">\\</span><span class="s">&gt;)&quot;</span><span class="p">)</span> <span class="n">f</span> <span class="mi">1</span> <span class="n">fishes</span>
    <span class="kr">where</span> <span class="n">f</span> <span class="n">n</span> <span class="p">[</span><span class="n">verbatim</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="n">fish</span><span class="p">]</span> <span class="ow">=</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="kr">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">4</span> <span class="kr">then</span> <span class="s">&quot;sushi&quot;</span> <span class="o">++</span> <span class="n">fish</span> <span class="kr">else</span> <span class="n">verbatim</span><span class="p">)</span>
<span class="c1">-- One fish two fish red fish sushi fish</span>

<span class="c1">-- note that we can easily specialize subRegexWithEnv into subRegexWithCount:</span>
<span class="nf">withCountEnv</span> <span class="n">f</span> <span class="n">g</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">f</span> <span class="p">(</span><span class="nf">\</span><span class="n">n</span> <span class="n">val</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">g</span> <span class="n">n</span> <span class="n">val</span><span class="p">))</span> <span class="mi">1</span> <span class="n">s</span>
<span class="nf">subRegexWithCount</span> <span class="n">re</span> <span class="ow">=</span> <span class="n">withCountEnv</span> <span class="p">(</span><span class="n">subRegexWithEnv</span> <span class="n">re</span><span class="p">)</span>

<span class="nf">s3&#39;</span> <span class="ow">=</span> <span class="n">subRegexWithCount</span> <span class="p">(</span><span class="n">ignoreCase</span> <span class="s">&quot;(</span><span class="se">\\</span><span class="s">w+)(</span><span class="se">\\</span><span class="s">s+fish</span><span class="se">\\</span><span class="s">&gt;)&quot;</span><span class="p">)</span> <span class="n">f</span> <span class="n">fishes</span>
    <span class="kr">where</span> <span class="n">f</span> <span class="n">n</span> <span class="p">[</span><span class="n">verbatim</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="n">fish</span><span class="p">]</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">4</span> <span class="kr">then</span> <span class="s">&quot;sushi&quot;</span> <span class="o">++</span> <span class="n">fish</span> <span class="kr">else</span> <span class="n">verbatim</span>
<span class="c1">-- One fish two fish red fish sushi fish</span>

<span class="c1">-- adding .* at beginning of the regexp will ensure we get the last hit.</span>
<span class="c1">-- but we must be carefull &quot;.*(\\w+)\\s+fish\\&gt;&quot; is wrong since .* will match</span>
<span class="c1">-- most the color, so \\&lt; is also needed</span>
<span class="nf">s4</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">matchRegex</span> <span class="p">(</span><span class="n">ignoreCase</span> <span class="s">&quot;.*</span><span class="se">\\</span><span class="s">&lt;(</span><span class="se">\\</span><span class="s">w+)</span><span class="se">\\</span><span class="s">s+fish</span><span class="se">\\</span><span class="s">&gt;&quot;</span><span class="p">)</span> <span class="n">fishes</span> <span class="kr">of</span>
     <span class="kt">Just</span> <span class="p">[</span><span class="n">last_fish_color</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="n">printf</span> <span class="s">&quot;Last fish is %s.&quot;</span> <span class="n">last_fish_color</span>
     <span class="kr">_</span> <span class="ow">-&gt;</span> <span class="s">&quot;Failed!&quot;</span>
<span class="c1">-- Last fish is blue.</span>

<span class="c1">-- @@PLEAC@@_6.6</span>
<span class="c1">-- for multi line regexps, use (mkRegexWithOpts _ False _)</span>
<span class="o">#!/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">runghc</span>

<span class="c1">-- killtags - very bad html tag killer</span>
<span class="kr">import</span> <span class="nn">System</span>
<span class="kr">import</span> <span class="nn">Text.Regex</span>

<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">s</span> <span class="ow">&lt;-</span> <span class="n">getArgs</span> <span class="o">&gt;&gt;=</span> <span class="n">any_input</span>
          <span class="n">putStr</span> <span class="p">(</span><span class="n">strip_tags</span> <span class="n">s</span><span class="p">)</span>

<span class="nf">any_input</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="n">getContents</span>
<span class="nf">any_input</span> <span class="p">(</span><span class="n">f</span><span class="kt">:</span><span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">readFile</span> <span class="n">f</span>

<span class="nf">strip_tags</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">subRegex</span> <span class="p">(</span><span class="n">mkRegexWithOpts</span> <span class="s">&quot;&lt;[^&gt;]*&gt;&quot;</span> <span class="kt">False</span> <span class="kt">True</span><span class="p">)</span> <span class="n">s</span> <span class="s">&quot;&quot;</span>

<span class="c1">-- testing it:</span>
<span class="nf">test</span> <span class="ow">=</span> <span class="s">&quot;&lt;a&gt;after a</span><span class="se">\n\</span>
<span class="se">       \</span><span class="s">&lt;bbb</span><span class="se">\n\</span>
<span class="se">       \</span><span class="s">bbb&gt;after b &lt;c&gt;after c</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="nf">s</span> <span class="ow">=</span> <span class="n">strip_tags</span> <span class="n">test</span>
<span class="c1">-- &quot;after a\n&lt;bbb\nbbb&gt;after b after c\n&quot;</span>

<span class="c1">-- @@PLEAC@@_6.7</span>
<span class="c1">-- Read the whole file and split</span>
<span class="nf">l1</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="n">lines</span> <span class="p">(</span><span class="n">readFile</span> <span class="n">filename</span><span class="p">)</span> <span class="c1">-- on line ends</span>
<span class="nf">l2</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="n">words</span> <span class="p">(</span><span class="n">readFile</span> <span class="n">filename</span><span class="p">)</span> <span class="c1">-- on whitespace</span>
<span class="nf">l3</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="p">(</span><span class="n">splitRegex</span> <span class="o">$</span> <span class="n">mkRegex</span> <span class="s">&quot;PATTERN&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">readFile</span> <span class="n">filename</span><span class="p">)</span> <span class="c1">-- on regexp</span>

<span class="c1">-- .Ch, .Se and .Ss divide chunks</span>
<span class="nf">f</span> <span class="ow">=</span> <span class="n">splitRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;^</span><span class="se">\\</span><span class="s">.(Ch|Se|Ss)$&quot;</span><span class="p">)</span>

<span class="c1">-- note that in the example above, you loose the matched line,</span>
<span class="c1">-- if you need it, you must create your own splitRegex:</span>
<span class="nf">splitRegex&#39;</span> <span class="ow">::</span> <span class="kt">Regex</span> <span class="ow">-&gt;</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="p">[(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">)]</span>
<span class="nf">splitRegex&#39;</span> <span class="n">re</span> <span class="n">s</span> <span class="ow">=</span> 
    <span class="kr">case</span> <span class="n">unfoldr&#39;</span> <span class="n">f</span> <span class="n">s</span> <span class="kr">of</span>
      <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">l</span>
      <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">l</span> <span class="o">++</span> <span class="p">[(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)]</span>
    <span class="kr">where</span> 
      <span class="c1">-- small helper functions which tranform matchRegexAll output</span>
      <span class="c1">-- to the one wanted by unfoldr&#39;</span>
      <span class="n">f</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="n">f&#39;</span> <span class="o">.</span> <span class="n">matchRegexAll</span> <span class="n">re</span>
      <span class="n">f&#39;</span> <span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">matched</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="p">((</span><span class="n">before</span><span class="p">,</span> <span class="n">matched</span><span class="p">),</span> <span class="n">after</span><span class="p">)</span>

<span class="c1">-- it uses this special unfoldr</span>
<span class="c1">-- (unfoldr only returns [b] whereas we also need the rest)</span>
<span class="c1">-- nb: with Control.Arrow.first which is \f (a,b) -&gt; (f a, b)</span>
<span class="c1">--     we could write:  Arrow.first (a :) (unfoldr&#39; f b&#39;)</span>
<span class="nf">unfoldr&#39;</span> <span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="p">([</span><span class="n">b</span><span class="p">],</span> <span class="n">a</span><span class="p">)</span>
<span class="nf">unfoldr&#39;</span> <span class="n">f</span> <span class="n">b</span>  <span class="ow">=</span>
  <span class="kr">case</span> <span class="n">f</span> <span class="n">b</span> <span class="kr">of</span>
   <span class="kt">Just</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b&#39;</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kr">let</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">b&#39;&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">unfoldr&#39;</span> <span class="n">f</span> <span class="n">b&#39;</span> <span class="kr">in</span> <span class="p">(</span><span class="n">a</span><span class="kt">:</span><span class="n">l</span><span class="p">,</span> <span class="n">b&#39;&#39;</span><span class="p">)</span>
   <span class="kt">Nothing</span>      <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">[]</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="nf">unwords_keeping_spaces</span> <span class="ow">=</span> <span class="n">splitRegex&#39;</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">s+&quot;</span><span class="p">)</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="n">unwords_keeping_spaces</span> <span class="s">&quot;a b  c </span><span class="se">\t</span><span class="s"> d&quot;</span>
<span class="c1">-- [(&quot;a&quot;,&quot; &quot;),(&quot;b&quot;,&quot;  &quot;),(&quot;c&quot;,&quot; \t &quot;),(&quot;d&quot;,&quot;&quot;)]</span>

<span class="c1">-- @@PLEAC@@_6.8</span>
<span class="kr">import</span> <span class="nn">Text.Regex</span>
<span class="kr">import</span> <span class="nn">Text.Regex.Posix</span>
<span class="kr">import</span> <span class="nn">Data.Maybe</span>
<span class="kr">import</span> <span class="nn">Text.Printf</span>
<span class="kr">import</span> <span class="nn">System</span>

<span class="nf">any_input</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="n">getContents</span>
<span class="nf">any_input</span> <span class="p">(</span><span class="n">f</span><span class="kt">:</span><span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">readFile</span> <span class="n">f</span>

<span class="c1">-- command-line to print lines 15 through 17 inclusive (see below)</span>
<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">s</span> <span class="ow">&lt;-</span> <span class="n">getArgs</span> <span class="o">&gt;&gt;=</span> <span class="n">any_input</span>
          <span class="n">putStr</span> <span class="p">(</span><span class="n">unlines</span> <span class="o">$</span> <span class="n">take</span> <span class="mi">3</span> <span class="o">$</span> <span class="n">drop</span> <span class="mi">14</span> <span class="o">$</span> <span class="n">lines</span> <span class="n">s</span><span class="p">)</span>

<span class="nf">filterByRange</span> <span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="p">[[</span><span class="n">a</span><span class="p">]]</span>
<span class="nf">filterByRange</span> <span class="kr">_</span> <span class="kr">_</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="kt">[]</span>
<span class="nf">filterByRange</span> <span class="n">f_beg</span> <span class="n">f_end</span> <span class="n">l</span> <span class="ow">=</span> 
    <span class="kr">let</span> <span class="n">l&#39;</span> <span class="ow">=</span> <span class="n">dropWhile</span> <span class="p">(</span><span class="n">not</span> <span class="o">.</span> <span class="n">f_beg</span><span class="p">)</span> <span class="n">l</span> <span class="kr">in</span>
    <span class="kr">case</span> <span class="n">break</span> <span class="n">f_end</span> <span class="n">l&#39;</span> <span class="kr">of</span>
      <span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">match</span> <span class="kt">:</span> <span class="n">l&#39;&#39;</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">before</span> <span class="o">++</span> <span class="p">[</span><span class="n">match</span><span class="p">])</span> <span class="kt">:</span> <span class="n">filterByRange</span> <span class="n">f_beg</span> <span class="n">f_end</span> <span class="n">l&#39;&#39;</span>
      <span class="kr">_</span> <span class="ow">-&gt;</span> <span class="kt">[]</span>

<span class="nf">extract_XMP</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="p">[[</span><span class="kt">String</span><span class="p">]]</span>
<span class="nf">extract_XMP</span> <span class="ow">=</span> <span class="n">filterByRange</span> <span class="p">(</span><span class="o">=~</span> <span class="s">&quot;&lt;XMP&gt;&quot;</span><span class="p">)</span> <span class="p">(</span><span class="o">=~</span> <span class="s">&quot;&lt;/XMP&gt;&quot;</span><span class="p">)</span>

<span class="nf">t1</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">s</span> <span class="ow">&lt;-</span> <span class="n">readFile</span> <span class="s">&quot;foo.html&quot;</span>
        <span class="n">return</span> <span class="o">$</span> <span class="n">extract_XMP</span> <span class="o">$</span> <span class="n">lines</span> <span class="n">s</span>

<span class="nf">ignoreCase</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">mkRegexWithOpts</span> <span class="n">s</span> <span class="kt">True</span> <span class="kt">False</span>
<span class="nf">extract_XMP&#39;</span> <span class="ow">=</span> <span class="n">filterByRange</span> <span class="p">(</span><span class="n">match</span> <span class="s">&quot;&lt;XMP&gt;&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">match</span> <span class="s">&quot;&lt;/XMP&gt;&quot;</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">match</span> <span class="n">re</span> <span class="ow">=</span> <span class="n">isJust</span> <span class="o">.</span> <span class="n">matchRegex</span> <span class="p">(</span><span class="n">ignoreCase</span> <span class="n">re</span><span class="p">)</span>

<span class="nf">t1&#39;</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">s</span> <span class="ow">&lt;-</span> <span class="n">readFile</span> <span class="s">&quot;foo.html&quot;</span>
         <span class="n">return</span> <span class="o">$</span> <span class="n">extract_XMP&#39;</span> <span class="o">$</span> <span class="n">lines</span> <span class="n">s</span>

<span class="nf">mbox_to_headers</span> <span class="ow">=</span> <span class="n">filterByRange</span> <span class="p">(</span><span class="n">match</span> <span class="s">&quot;^From:?</span><span class="se">\\</span><span class="s">s&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">match</span> <span class="s">&quot;^$&quot;</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">match</span> <span class="n">re</span> <span class="ow">=</span> <span class="n">isJust</span> <span class="o">.</span> <span class="n">matchRegex</span> <span class="p">(</span><span class="n">ignoreCase</span> <span class="n">re</span><span class="p">)</span>
<span class="nf">mail_adresses</span> <span class="ow">=</span> <span class="n">concatMap</span> <span class="n">search_in_line</span>
    <span class="kr">where</span> <span class="n">search_in_line</span> <span class="n">line</span> <span class="ow">=</span> <span class="p">(</span><span class="n">line</span> <span class="o">=~</span> <span class="s">&quot;[^&lt;&gt;(),;[:space:]]+@[^&lt;&gt;(),;[:space:]]+&quot;</span><span class="p">)</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span>
          <span class="c1">-- nb: in List context, calls matchAll.</span>
          <span class="c1">-- nb: \s can not be used, so instead of [^&lt;&gt;\s], one must do [^&lt;&gt;[:space:]]</span>

<span class="nf">t2</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">s</span> <span class="ow">&lt;-</span> <span class="n">readFile</span> <span class="s">&quot;mbox&quot;</span>
        <span class="n">return</span> <span class="o">$</span> <span class="n">mail_adresses</span> <span class="o">$</span> <span class="n">concat</span> <span class="o">$</span> <span class="n">mbox_to_headers</span> <span class="o">$</span> <span class="n">lines</span> <span class="n">s</span>

<span class="c1">-- @@PLEAC@@_6.9</span>
<span class="kr">import</span> <span class="nn">List</span>
<span class="kr">import</span> <span class="nn">Data.Maybe</span>

<span class="nf">special_chars</span> <span class="ow">=</span> <span class="s">&quot;.()+*?[]</span><span class="se">\\</span><span class="s">{}$^|&quot;</span>

<span class="nf">regex_escape_char</span> <span class="ow">::</span> <span class="kt">Char</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
<span class="nf">regex_escape_char</span> <span class="n">c</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">elem</span> <span class="n">c</span> <span class="n">special_chars</span> 
               <span class="kr">then</span> <span class="p">[</span><span class="sc">&#39;</span><span class="se">\\</span><span class="sc">&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> 
               <span class="kr">else</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span>
<span class="nf">regex_escape</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
<span class="nf">regex_escape</span> <span class="ow">=</span> <span class="n">concatMap</span> <span class="n">regex_escape_char</span>

<span class="nf">glob_list</span> <span class="ow">=</span> 
    <span class="p">[</span> <span class="p">(</span><span class="sc">&#39;*&#39;</span><span class="p">,</span> <span class="s">&quot;.*&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span><span class="sc">&#39;?&#39;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span><span class="sc">&#39;[&#39;</span><span class="p">,</span> <span class="s">&quot;[&quot;</span><span class="p">)</span>
    <span class="p">,</span> <span class="p">(</span><span class="sc">&#39;]&#39;</span><span class="p">,</span> <span class="s">&quot;]&quot;</span><span class="p">)</span> <span class="p">]</span>
<span class="nf">glob_char_to_regexp</span> <span class="n">c</span> <span class="ow">=</span> <span class="n">fromMaybe</span> <span class="p">(</span><span class="n">regex_escape_char</span> <span class="n">c</span><span class="p">)</span> <span class="p">(</span><span class="n">lookup</span> <span class="n">c</span> <span class="n">glob_list</span><span class="p">)</span>
<span class="c1">-- nb: fromMaybe will try (lookup ...) first, then fallback on (regex_escape_char c)</span>

<span class="nf">glob2pat</span> <span class="ow">=</span> <span class="n">concatMap</span> <span class="n">glob_char_to_regexp</span>

<span class="nf">pat</span> <span class="ow">=</span> <span class="n">glob2pat</span> <span class="s">&quot;*File.*&quot;</span>
<span class="c1">-- &quot;.*File\\..*&quot;</span>

<span class="c1">-- @@PLEAC@@_6.10</span>
<span class="kr">import</span> <span class="nn">Data.List</span>
<span class="kr">import</span> <span class="nn">Data.Maybe</span>
<span class="kr">import</span> <span class="nn">Text.Regex</span>

<span class="nf">popstates</span> <span class="ow">=</span> <span class="p">[</span><span class="s">&quot;CO&quot;</span><span class="p">,</span><span class="s">&quot;ON&quot;</span><span class="p">,</span><span class="s">&quot;MI&quot;</span><span class="p">,</span><span class="s">&quot;WI&quot;</span><span class="p">,</span><span class="s">&quot;MN&quot;</span><span class="p">]</span>

<span class="nf">is_state</span> <span class="ow">=</span> <span class="n">isJust</span> <span class="o">.</span> <span class="n">matchRegex</span> <span class="n">re</span>
    <span class="kr">where</span> <span class="n">re</span> <span class="ow">=</span> <span class="n">mkRegex</span> <span class="o">$</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&lt;(&quot;</span> <span class="o">++</span> <span class="n">intercalate</span> <span class="s">&quot;|&quot;</span> <span class="n">popstates</span> <span class="o">++</span> <span class="s">&quot;)</span><span class="se">\\</span><span class="s">&gt;&quot;</span>

<span class="nf">l</span> <span class="ow">=</span> <span class="n">filter</span> <span class="n">is_state</span> <span class="p">[</span> <span class="s">&quot;xxx&quot;</span><span class="p">,</span> <span class="s">&quot;xx CO xx&quot;</span><span class="p">,</span> <span class="s">&quot;WI&quot;</span><span class="p">,</span> <span class="s">&quot;WIxx&quot;</span> <span class="p">]</span>
<span class="c1">-- [&quot;xx CO xx&quot;,&quot;WI&quot;]</span>

<span class="c1">-- this is less efficient:</span>
<span class="nf">is_state&#39;</span> <span class="n">line</span> <span class="ow">=</span> <span class="n">any</span> <span class="p">(</span><span class="nf">\</span><span class="n">re</span> <span class="ow">-&gt;</span> <span class="n">isJust</span> <span class="o">$</span> <span class="n">matchRegex</span> <span class="n">re</span> <span class="n">line</span><span class="p">)</span> <span class="p">(</span><span class="n">map</span> <span class="n">to_regexp</span> <span class="n">popstates</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">to_regexp</span> <span class="n">c</span> <span class="ow">=</span> <span class="n">mkRegex</span> <span class="o">$</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&lt;&quot;</span> <span class="o">++</span> <span class="n">c</span> <span class="o">++</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&gt;&quot;</span>

<span class="c1">-- @@PLEAC@@_6.11</span>
<span class="kr">import</span> <span class="nn">Data.Maybe</span>
<span class="kr">import</span> <span class="nn">Data.List</span>
<span class="kr">import</span> <span class="nn">Text.Regex.Base</span>
<span class="kr">import</span> <span class="nn">Text.Regex.Posix</span>

<span class="c1">-- one can not catch invalid patterns using Text.Regex</span>

<span class="c1">-- recent versions of Text.Regex.Base have makeRegexM:</span>
<span class="nf">is_valid_pattern</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
<span class="nf">is_valid_pattern</span> <span class="n">re</span> <span class="ow">=</span> <span class="n">isJust</span> <span class="p">(</span><span class="n">makeRegexM</span> <span class="n">re</span> <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">Regex</span><span class="p">)</span>
<span class="c1">-- nb: the type Regex must be specified since matchRegexM uses abstract</span>
<span class="c1">--     classes and haskell can&#39;t guess which instance to use</span>

<span class="c1">-- or can use compile from Text.Regex.Posix.String:</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="kr">let</span> <span class="n">regexp</span> <span class="ow">=</span> <span class="s">&quot;(&quot;</span> <span class="kr">in</span>
    <span class="n">compile</span> <span class="n">defaultCompOpt</span> <span class="n">defaultExecOpt</span> <span class="n">regexp</span> <span class="o">&gt;&gt;=</span>
      <span class="p">(</span><span class="nf">\</span><span class="n">re</span> <span class="ow">-&gt;</span> <span class="kr">case</span> <span class="n">re</span> <span class="kr">of</span>
                <span class="kt">Left</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="ne">error</span> <span class="p">(</span><span class="s">&quot;bad regexp </span><span class="se">\&quot;</span><span class="s">&quot;</span> <span class="o">++</span> <span class="n">regexp</span> <span class="o">++</span> <span class="s">&quot;</span><span class="se">\&quot;</span><span class="s">: &quot;</span> <span class="o">++</span> <span class="n">err</span><span class="p">)</span>
                <span class="kt">Right</span> <span class="n">re</span> <span class="ow">-&gt;</span> <span class="n">return</span> <span class="n">re</span><span class="p">)</span>
<span class="c1">-- *** Exception: bad regexp &quot;(&quot;: Unmatched ( or \(</span>

<span class="c1">-- @@PLEAC@@_6.12</span>
<span class="c1">-- Text.Regex and Text.Regex.Posix do not handle unicode (accents...)</span>

<span class="c1">-- @@PLEAC@@_6.13</span>
<span class="kr">import</span> <span class="nn">Data.List</span>

<span class="c1">-- Calculates the Levenshtein, or edit distance, between two strings.</span>
<span class="c1">-- here is a basic/slow version:</span>
<span class="nf">levenshtein_basic</span> <span class="n">s</span> <span class="n">t</span> <span class="ow">=</span> <span class="n">distance</span> <span class="p">(</span><span class="n">length</span> <span class="n">s</span><span class="p">)</span> <span class="p">(</span><span class="n">length</span> <span class="n">t</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">distance</span> <span class="n">i</span> <span class="mi">0</span> <span class="ow">=</span> <span class="n">i</span>
          <span class="n">distance</span> <span class="mi">0</span> <span class="n">j</span> <span class="ow">=</span> <span class="n">j</span>
          <span class="n">distance</span> <span class="n">i</span> <span class="n">j</span> <span class="ow">=</span> <span class="n">minimum</span> <span class="p">[</span> <span class="n">distance</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                                 <span class="p">,</span> <span class="n">distance</span> <span class="n">i</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                                 <span class="p">,</span> <span class="n">distance</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="kr">if</span> <span class="n">s</span><span class="o">!!</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="n">t</span><span class="o">!!</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="kr">then</span> <span class="mi">0</span> <span class="kr">else</span> <span class="mi">1</span><span class="p">)</span> <span class="p">]</span>

<span class="c1">-- a fast version based on the previous one, adding memoization</span>
<span class="c1">-- (note the recursive use of &quot;d&quot;)</span>
<span class="nf">levenshtein</span> <span class="n">s</span> <span class="n">t</span> <span class="ow">=</span> <span class="n">d</span>
    <span class="kr">where</span> <span class="n">d</span> <span class="ow">=</span> <span class="p">[</span> <span class="p">[</span><span class="n">distance</span> <span class="n">m</span> <span class="n">n</span> <span class="o">|</span> <span class="n">n</span><span class="ow">&lt;-</span><span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="n">length</span> <span class="n">t</span><span class="p">]]</span> <span class="o">|</span> <span class="n">m</span><span class="ow">&lt;-</span><span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="n">length</span> <span class="n">s</span><span class="p">]</span> <span class="p">]</span>
          <span class="n">distance</span> <span class="n">i</span> <span class="mi">0</span> <span class="ow">=</span> <span class="n">i</span>
          <span class="n">distance</span> <span class="mi">0</span> <span class="n">j</span> <span class="ow">=</span> <span class="n">j</span>
          <span class="n">distance</span> <span class="n">i</span> <span class="n">j</span> <span class="ow">=</span> <span class="n">minimum</span> <span class="p">[</span> <span class="n">d</span><span class="o">!!</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">!!</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                                 <span class="p">,</span> <span class="n">d</span><span class="o">!!</span><span class="n">i</span><span class="o">!!</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                                 <span class="p">,</span> <span class="n">d</span><span class="o">!!</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">!!</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="kr">if</span> <span class="n">s</span><span class="o">!!</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="n">t</span><span class="o">!!</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="kr">then</span> <span class="mi">0</span> <span class="kr">else</span> <span class="mi">1</span><span class="p">)</span> <span class="p">]</span>

<span class="c1">-- a more efficient/cryptic version.</span>
<span class="c1">-- (it computes the &quot;distance&quot; figures for each &quot;sb&quot; chars,</span>
<span class="c1">--  ie it memoizes only what is needed)</span>
<span class="nf">levenshtein&#39;</span> <span class="n">sa</span> <span class="n">sb</span> <span class="ow">=</span> <span class="n">foldl</span> <span class="n">transform</span> <span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="n">length</span> <span class="n">sa</span><span class="p">]</span> <span class="n">sb</span> 
    <span class="kr">where</span> 
      <span class="n">transform</span> <span class="n">xs</span><span class="o">@</span><span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs&#39;</span><span class="p">)</span> <span class="n">c</span> <span class="ow">=</span> <span class="n">scanl</span> <span class="n">compute</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">zip3</span> <span class="n">sa</span> <span class="n">xs</span> <span class="n">xs&#39;</span><span class="p">)</span>
          <span class="kr">where</span>
            <span class="n">compute</span> <span class="n">z</span> <span class="p">(</span><span class="n">c&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">=</span> <span class="n">minimum</span> <span class="p">[</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">z</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="kr">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">c&#39;</span> <span class="kr">then</span> <span class="mi">0</span> <span class="kr">else</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1">-- Determines if two strings are an approximate match.</span>
<span class="nf">amatch</span> <span class="n">percentage</span> <span class="n">s</span> <span class="n">t</span> <span class="ow">=</span> <span class="n">levenshtein</span> <span class="n">s</span> <span class="n">t</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">&lt;=</span> <span class="n">percentage</span> <span class="o">*</span> <span class="n">length</span> <span class="n">s</span>

<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">s</span> <span class="ow">&lt;-</span> <span class="n">readFile</span> <span class="s">&quot;/usr/share/dict/words&quot;</span>
          <span class="n">print</span> <span class="o">$</span> <span class="n">filter</span> <span class="p">(</span><span class="n">amatch</span> <span class="mi">20</span> <span class="s">&quot;balast&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">lines</span> <span class="n">s</span><span class="p">)</span>
<span class="c1">-- [&quot;balant&quot;,&quot;balas&quot;,&quot;balat&quot;,&quot;ballast&quot;,&quot;belast&quot;,&quot;blast&quot;]</span>

<span class="c1">-- @@PLEAC@@_6.14</span>
<span class="kr">import</span> <span class="nn">List</span>
<span class="kr">import</span> <span class="nn">Text.Regex</span>
<span class="kr">import</span> <span class="nn">Text.Regex.Posix</span>
<span class="kr">import</span> <span class="nn">Text.Printf</span>

<span class="nf">allMatches</span> <span class="n">re</span> <span class="ow">=</span> <span class="n">unfoldr</span> <span class="p">(</span><span class="n">fmap</span> <span class="n">adjust</span> <span class="o">.</span> <span class="n">matchRegexAll</span> <span class="n">re</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">adjust</span> <span class="p">(</span><span class="n">_before</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="n">after</span><span class="p">)</span>

<span class="c1">-- special unfoldr (unfoldr only returns [b] whereas we also need the rest)</span>
<span class="nf">unfoldr&#39;</span> <span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="p">([</span><span class="n">b</span><span class="p">],</span> <span class="n">a</span><span class="p">)</span>
<span class="nf">unfoldr&#39;</span> <span class="n">f</span> <span class="n">b</span>  <span class="ow">=</span>
  <span class="kr">case</span> <span class="n">f</span> <span class="n">b</span> <span class="kr">of</span>
   <span class="kt">Just</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b&#39;</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kr">let</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">b&#39;&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">unfoldr&#39;</span> <span class="n">f</span> <span class="n">b&#39;</span> <span class="kr">in</span> <span class="p">(</span><span class="n">a</span><span class="kt">:</span><span class="n">l</span><span class="p">,</span> <span class="n">b&#39;&#39;</span><span class="p">)</span>
   <span class="kt">Nothing</span>      <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">[]</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="nf">allMatches&#39;</span> <span class="n">re</span> <span class="ow">=</span> <span class="n">unfoldr&#39;</span> <span class="p">(</span><span class="n">fmap</span> <span class="n">adjust</span> <span class="o">.</span> <span class="n">matchRegexAll</span> <span class="n">re</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">adjust</span> <span class="p">(</span><span class="n">_before</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="n">after</span><span class="p">)</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="n">allMatches</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;([0-9]+)&quot;</span><span class="p">)</span> <span class="s">&quot;3,4,5,9,120&quot;</span>
<span class="c1">-- [[&quot;3&quot;],[&quot;4&quot;],[&quot;5&quot;],[&quot;9&quot;],[&quot;120&quot;]]</span>
<span class="c1">-- (note that \d is not special, one must use [0-9] or [[:digit:]])</span>

<span class="nf">mystr</span> <span class="ow">=</span> <span class="s">&quot;The year 1752 lost 10 days on the 3rd of September&quot;</span>
<span class="nf">t2</span> <span class="ow">=</span> 
    <span class="kr">let</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">remain</span><span class="p">)</span> <span class="ow">=</span> <span class="n">allMatches&#39;</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;([0-9]+)&quot;</span><span class="p">)</span> <span class="n">mystr</span> <span class="kr">in</span>
    <span class="kr">let</span> <span class="n">after</span> <span class="ow">=</span> <span class="n">remain</span> <span class="o">=~</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">S+&quot;</span> <span class="ow">::</span> <span class="kt">String</span> <span class="kr">in</span>
    <span class="n">putStr</span> <span class="o">$</span> <span class="n">unlines</span> <span class="o">$</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="s">&quot;Found number &quot;</span> <span class="o">++</span> <span class="n">n</span><span class="p">)</span> <span class="n">l</span> <span class="o">++</span> 
                        <span class="p">[</span> <span class="n">printf</span> <span class="s">&quot;Found %s after the last number&quot;</span> <span class="n">after</span> <span class="p">]</span>
    
<span class="c1">-- Found number 1752</span>
<span class="c1">-- Found number 10</span>
<span class="c1">-- Found number 3</span>
<span class="c1">-- Found rd after the last number</span>


<span class="c1">-- @@PLEAC@@_APPENDIX</span>
<span class="kr">import</span> <span class="nn">List</span>
<span class="kr">import</span> <span class="nn">Data.Ord</span> <span class="p">(</span><span class="nf">comparing</span><span class="p">)</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Array</span> <span class="k">as</span> <span class="n">Array</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Map</span> <span class="k">as</span> <span class="n">Map</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Set</span> <span class="k">as</span> <span class="n">Set</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Control.Arrow</span> <span class="k">as</span> <span class="n">Arrow</span>

<span class="nf">listToArray</span> <span class="ow">::</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">Array</span> <span class="kt">Int</span> <span class="n">a</span>
<span class="nf">listToArray</span> <span class="n">l</span> <span class="ow">=</span> <span class="kt">Array</span><span class="o">.</span><span class="n">listArray</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="n">l</span>

<span class="nf">indexOf</span> <span class="n">subst</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">findIndex</span> <span class="p">(</span><span class="n">subst</span> <span class="p">`</span><span class="n">isPrefixOf</span><span class="p">`)</span> <span class="p">(</span><span class="n">tails</span> <span class="n">s</span><span class="p">)</span>

<span class="nf">groupNelem</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="p">[[</span><span class="n">a</span><span class="p">]]</span>
<span class="nf">groupNelem</span> <span class="n">n</span> <span class="ow">=</span> <span class="n">unfoldr</span> <span class="n">f</span>
    <span class="kr">where</span> <span class="n">f</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="kt">Nothing</span>
          <span class="n">f</span> <span class="n">s</span> <span class="ow">=</span> <span class="kt">Just</span> <span class="p">(</span><span class="n">splitAt</span> <span class="n">n</span> <span class="n">s</span><span class="p">)</span>

<span class="nf">sortByKey</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">snd</span> <span class="o">.</span> <span class="n">sortBy</span> <span class="p">(</span><span class="n">comparing</span> <span class="n">fst</span><span class="p">)</span> <span class="o">.</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">f</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="nf">sortByKeyRev</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">snd</span> <span class="o">.</span> <span class="n">sortBy</span> <span class="p">(</span><span class="n">flip</span> <span class="o">$</span> <span class="n">comparing</span> <span class="n">fst</span><span class="p">)</span> <span class="o">.</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">f</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

<span class="c1">-- alike python&#39;s fileinput.input() or perl&#39;s &lt;&gt;</span>
<span class="c1">-- typical usage: getArgs &gt;&gt;= any_input</span>
<span class="nf">any_input</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">FilePath</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">String</span>
<span class="nf">any_input</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="n">getContents</span>
<span class="nf">any_input</span> <span class="p">(</span><span class="n">f</span><span class="kt">:</span><span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">readFile</span> <span class="n">f</span>

<span class="c1">-- subRegex only allow a fixed string</span>
<span class="c1">-- subRegexWith below takes a (String -&gt; String) function to compute a result</span>
<span class="nf">subRegexWith</span> <span class="n">re</span> <span class="n">new</span> <span class="n">s</span> <span class="ow">=</span>
    <span class="kr">case</span> <span class="n">matchRegexAll</span> <span class="n">re</span> <span class="n">s</span> <span class="kr">of</span>
      <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="n">s</span>
      <span class="kt">Just</span> <span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">matched</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">before</span> <span class="o">++</span> <span class="n">new</span> <span class="n">matched</span> <span class="o">++</span> <span class="p">(</span><span class="n">subRegexWith</span> <span class="n">re</span> <span class="n">new</span> <span class="n">after</span><span class="p">)</span>

<span class="nf">subRegexOnceWith</span> <span class="n">re</span> <span class="n">new</span> <span class="n">s</span> <span class="ow">=</span> 
    <span class="kr">case</span> <span class="n">matchRegexAll</span> <span class="n">re</span> <span class="n">s</span> <span class="kr">of</span>
      <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="n">s</span>
      <span class="kt">Just</span> <span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">matched</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">before</span> <span class="o">++</span> <span class="n">new</span> <span class="n">matched</span> <span class="o">++</span> <span class="n">after</span>

<span class="nf">rand</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">Int</span>
<span class="nf">rand</span> <span class="n">low</span> <span class="n">high</span> <span class="ow">=</span> <span class="n">getStdRandom</span> <span class="p">(</span><span class="n">randomR</span> <span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">))</span>

<span class="nf">dirname_basename</span> <span class="n">file</span> <span class="ow">=</span> <span class="p">(</span><span class="kr">if</span> <span class="n">dir</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="kr">then</span> <span class="s">&quot;.&quot;</span> <span class="kr">else</span> <span class="p">(</span><span class="n">reverse</span> <span class="o">$</span> <span class="n">tail</span> <span class="n">dir</span><span class="p">),</span> <span class="n">reverse</span> <span class="n">base</span><span class="p">)</span>
    <span class="kr">where</span> <span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">dir</span><span class="p">)</span> <span class="ow">=</span> <span class="n">break</span> <span class="p">(</span><span class="o">==</span> <span class="sc">&#39;/&#39;</span><span class="p">)</span> <span class="o">$</span> <span class="n">reverse</span> <span class="n">file</span>

<span class="nf">dirname</span> <span class="ow">=</span> <span class="n">fst</span> <span class="o">.</span> <span class="n">dirname_basename</span>
<span class="nf">basename</span> <span class="ow">=</span> <span class="n">snd</span> <span class="o">.</span> <span class="n">dirname_basename</span>


<span class="c1">-- from http://www.cse.unsw.edu.au/~dons/code/newpopen</span>
<span class="c1">-- modified to handle stderr</span>
<span class="kr">import</span> <span class="nn">System.Process</span>
<span class="kr">import</span> <span class="nn">System.Exit</span>
<span class="kr">import</span> <span class="nn">System.IO</span>

<span class="kr">import</span> <span class="nn">Control.Monad</span>
<span class="kr">import</span> <span class="nn">Control.Concurrent</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Control.Exception</span> <span class="k">as</span> <span class="n">C</span>

<span class="nf">readProcess</span> <span class="ow">::</span> <span class="kt">FilePath</span>                     <span class="c1">-- ^ command to run</span>
            <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span>                     <span class="c1">-- ^ any arguments</span>
            <span class="ow">-&gt;</span> <span class="kt">String</span>                       <span class="c1">-- ^ standard input</span>
            <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="p">(</span><span class="kt">Either</span> <span class="kt">ExitCode</span> <span class="kt">String</span><span class="p">)</span>  <span class="c1">-- ^ either the stdout, or an exitcode</span>

<span class="nf">readProcess</span> <span class="n">cmd</span> <span class="n">args</span> <span class="n">input</span> <span class="ow">=</span> <span class="kt">C</span><span class="o">.</span><span class="n">handle</span> <span class="p">(</span><span class="n">return</span> <span class="o">.</span> <span class="n">handler</span><span class="p">)</span> <span class="o">$</span> <span class="kr">do</span>

    <span class="p">(</span><span class="n">inh</span><span class="p">,</span><span class="n">outh</span><span class="p">,</span><span class="n">errh</span><span class="p">,</span><span class="n">pid</span><span class="p">)</span> <span class="ow">&lt;-</span> <span class="n">runInteractiveProcess</span> <span class="n">cmd</span> <span class="n">args</span> <span class="kt">Nothing</span> <span class="kt">Nothing</span>

    <span class="c1">-- fork off a thread to start consuming the output</span>
    <span class="n">output</span>  <span class="ow">&lt;-</span> <span class="n">hGetContents</span> <span class="n">outh</span>
    <span class="n">outMVar</span> <span class="ow">&lt;-</span> <span class="n">newEmptyMVar</span>
    <span class="n">forkIO</span> <span class="o">$</span> <span class="kt">C</span><span class="o">.</span><span class="n">evaluate</span> <span class="p">(</span><span class="n">length</span> <span class="n">output</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">putMVar</span> <span class="n">outMVar</span> <span class="nb">()</span>

    <span class="c1">-- fork off a thread to start consuming the output</span>
    <span class="n">errput</span>  <span class="ow">&lt;-</span> <span class="n">hGetContents</span> <span class="n">errh</span>
    <span class="n">errMVar</span> <span class="ow">&lt;-</span> <span class="n">newEmptyMVar</span>
    <span class="n">forkIO</span> <span class="o">$</span> <span class="kt">C</span><span class="o">.</span><span class="n">evaluate</span> <span class="p">(</span><span class="n">length</span> <span class="n">errput</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">putMVar</span> <span class="n">errMVar</span> <span class="nb">()</span>

    <span class="c1">-- now write and flush any input</span>
    <span class="n">when</span> <span class="p">(</span><span class="n">not</span> <span class="p">(</span><span class="n">null</span> <span class="n">input</span><span class="p">))</span> <span class="o">$</span> <span class="n">hPutStr</span> <span class="n">inh</span> <span class="n">input</span>
    <span class="n">hClose</span> <span class="n">inh</span>          <span class="c1">-- done with stdin</span>

    <span class="c1">-- wait on the output</span>
    <span class="n">takeMVar</span> <span class="n">outMVar</span>
    <span class="n">hClose</span> <span class="n">outh</span>

    <span class="c1">-- wait on the errput</span>
    <span class="n">takeMVar</span> <span class="n">errMVar</span>
    <span class="n">hClose</span> <span class="n">errh</span>

    <span class="n">hPutStr</span> <span class="n">stderr</span> <span class="n">errput</span>

    <span class="c1">-- wait on the process</span>
    <span class="n">ex</span> <span class="ow">&lt;-</span> <span class="kt">C</span><span class="o">.</span><span class="n">catch</span> <span class="p">(</span><span class="n">waitForProcess</span> <span class="n">pid</span><span class="p">)</span> <span class="p">(</span><span class="nf">\</span><span class="kr">_</span> <span class="ow">-&gt;</span> <span class="n">return</span> <span class="kt">ExitSuccess</span><span class="p">)</span>

    <span class="n">return</span> <span class="o">$</span> <span class="kr">case</span> <span class="n">ex</span> <span class="kr">of</span>
        <span class="kt">ExitSuccess</span>   <span class="ow">-&gt;</span> <span class="kt">Right</span> <span class="n">output</span>
        <span class="kt">ExitFailure</span> <span class="kr">_</span> <span class="ow">-&gt;</span> <span class="kt">Left</span> <span class="n">ex</span>

  <span class="kr">where</span>
    <span class="n">handler</span> <span class="p">(</span><span class="kt">C</span><span class="o">.</span><span class="kt">ExitException</span> <span class="n">e</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">Left</span> <span class="n">e</span>
    <span class="n">handler</span> <span class="n">e</span>                   <span class="ow">=</span> <span class="kt">Left</span> <span class="p">(</span><span class="kt">ExitFailure</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</body>
</html>
