<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Numbers</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Ruby"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Strings"
HREF="strings.html"><LINK
REL="NEXT"
TITLE="Dates and Times"
HREF="datesandtimes.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Ruby</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="strings.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="datesandtimes.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="NUMBERS"
>2. Numbers</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN73"
>Checking Whether a String Is a Valid Number</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp"># Matz tells that you can use Integer() for strict checked conversion.</span>
<span class="cp">Integer(&quot;abc&quot;)</span>
<span class="cp">#=&gt; `Integer&#39;: invalid value for Integer: &quot;abc&quot; (ArgumentError)</span>
<span class="cp">Integer(&quot;567&quot;)</span>
<span class="cp">#=&gt; 567</span>

<span class="cp"># You may use Float() for floating point stuff</span>
<span class="cp">Integer(&quot;56.7&quot;)</span>
<span class="cp">#=&gt; `Integer&#39;: invalid value for Integer: &quot;56.7&quot; (ArgumentError)</span>
<span class="cp">Float(&quot;56.7&quot;)</span>
<span class="cp">#=&gt; 56.7</span>

<span class="cp"># You may also use a regexp for that</span>
<span class="cp">if string =~ /^[+-]?\d+$/</span>
<span class="cp">    p &#39;is an integer&#39;</span>
<span class="cp">else</span>
<span class="cp">    p &#39;is not&#39;</span>
<span class="cp">end</span>

<span class="cp">if string =~ /^-?(?:\d+(?:\.\d*)?|\.\d+)$/</span>
<span class="cp">    p &#39;is a decimal number&#39;</span>
<span class="cp">else</span>
<span class="cp">    p &#39;is not&#39;</span>
<span class="cp">end</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN76"
>Comparing Floating-Point Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp"># equal(num1, num2, accuracy) : returns true if num1 and num2 are</span>
<span class="cp">#   equal to accuracy number of decimal places</span>
<span class="cp">def equal(i, j, a)</span>
<span class="cp">    sprintf(&quot;%.#{a}g&quot;, i) == sprintf(&quot;%.#{a}g&quot;, j)</span>
<span class="cp">end</span>

<span class="cp">wage = 536                        # $5.36/hour</span>
<span class="cp">week = 40 * wage                  # $214.40</span>
<span class="cp">printf(&quot;One week&#39;s wage is: \$%.2f\n&quot;, week/100.0)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN79"
>Rounding Floating-Point Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">num.round                         # rounds to integer</span>

<span class="cp">a = 0.255</span>
<span class="cp">b = sprintf(&quot;%.2f&quot;, a)</span>
<span class="cp">print  &quot;Unrounded: #{a}\nRounded: #{b}\n&quot;</span>
<span class="cp">printf &quot;Unrounded: #{a}\nRounded: %.2f\n&quot;, a</span>

<span class="cp">print &quot;number\tint\tfloor\tceil\n&quot;</span>
<span class="cp">a = [ 3.3 , 3.5 , 3.7, -3.3 ]</span>
<span class="cp">for n in a</span>
<span class="cp">    printf(&quot;% .1f\t% .1f\t% .1f\t% .1f\n&quot;,  # at least I don&#39;t fake my output :)</span>
<span class="cp">           n, n.to_i, n.floor, n.ceil)</span>
<span class="cp">end</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN82"
>Converting Between Binary and Decimal</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">def dec2bin(n)</span>
<span class="cp">    [n].pack(&quot;N&quot;).unpack(&quot;B32&quot;)[0].sub(/^0+(?=\d)/, &#39;&#39;)</span>
<span class="cp">end</span>

<span class="cp">def bin2dec(n)</span>
<span class="cp">    [(&quot;0&quot;*32+n.to_s)[-32..-1]].pack(&quot;B32&quot;).unpack(&quot;N&quot;)[0]</span>
<span class="cp">end</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN85"
>Operating on a Series of Integers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">for i in x .. y</span>
<span class="cp">    # i is set to every integer from x to y, inclusive</span>
<span class="cp">end</span>

<span class="cp">x.step(y,7) { |i|</span>
<span class="cp">    # i is set to every integer from x to y, stepsize = 7</span>
<span class="cp">}</span>

<span class="cp">print &quot;Infancy is: &quot;</span>
<span class="cp">(0..2).each { |i|</span>
<span class="cp">    print i, &quot; &quot;</span>
<span class="cp">}</span>
<span class="cp">print &quot;\n&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN88"
>Working with Roman Numerals</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp"># We can add conversion methods to the Integer class,</span>
<span class="cp"># this makes a roman number just a representation for normal numbers.</span>
<span class="cp">class Integer</span>
<span class="cp">    </span>
<span class="cp">    @@romanlist = [[&quot;M&quot;, 1000],</span>
<span class="cp">                   [&quot;CM&quot;, 900],</span>
<span class="cp">                   [&quot;D&quot;,  500],</span>
<span class="cp">                   [&quot;CD&quot;, 400],</span>
<span class="cp">                   [&quot;C&quot;,  100],</span>
<span class="cp">                   [&quot;XC&quot;,  90],</span>
<span class="cp">                   [&quot;L&quot;,   50],</span>
<span class="cp">                   [&quot;XL&quot;,  40],</span>
<span class="cp">                   [&quot;X&quot;,   10],</span>
<span class="cp">                   [&quot;IX&quot;,   9],</span>
<span class="cp">                   [&quot;V&quot;,    5],</span>
<span class="cp">                   [&quot;IV&quot;,   4],</span>
<span class="cp">                   [&quot;I&quot;,    1]]</span>
<span class="cp">    </span>
<span class="cp">    def to_roman</span>
<span class="cp">        remains = self</span>
<span class="cp">        roman = &quot;&quot;</span>
<span class="cp">        for sym, num in @@romanlist</span>
<span class="cp">            while remains &gt;= num</span>
<span class="cp">                remains -= num</span>
<span class="cp">                roman &lt;&lt; sym</span>
<span class="cp">            end</span>
<span class="cp">        end</span>
<span class="cp">        roman</span>
<span class="cp">    end</span>
<span class="cp">    </span>
<span class="cp">    def Integer.from_roman(roman)</span>
<span class="cp">        ustr = roman.upcase</span>
<span class="cp">        sum = 0</span>
<span class="cp">        for entry in @@romanlist</span>
<span class="cp">            sym, num = entry[0], entry[1]</span>
<span class="cp">            while sym == ustr[0, sym.length]</span>
<span class="cp">                sum += num</span>
<span class="cp">                ustr.slice!(0, sym.length)</span>
<span class="cp">            end</span>
<span class="cp">        end</span>
<span class="cp">        sum</span>
<span class="cp">    end</span>
<span class="cp">    </span>
<span class="cp">end</span>


<span class="cp">roman_fifteen = 15.to_roman</span>
<span class="cp">puts &quot;Roman for fifteen is #{roman_fifteen}&quot;</span>
<span class="cp">i = Integer.from_roman(roman_fifteen)</span>
<span class="cp">puts &quot;Converted back, #{roman_fifteen} is #{i}&quot;</span>

<span class="cp"># check</span>
<span class="cp">for i in (1..3900)</span>
<span class="cp">    r = i.to_roman</span>
<span class="cp">    j = Integer.from_roman(r)</span>
<span class="cp">    if i != j</span>
<span class="cp">        puts &quot;error: #{i} : #{r} - #{j}&quot;</span>
<span class="cp">    end</span>
<span class="cp">end</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN91"
>Generating Random Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">random = rand(y-x+1)+x</span>

<span class="cp">chars = [&quot;A&quot;..&quot;Z&quot;,&quot;a&quot;..&quot;z&quot;,&quot;0&quot;..&quot;9&quot;].collect { |r| r.to_a }.join + %q(!@$%^&amp;*)</span>
<span class="cp">password = (1..8).collect { chars[rand(chars.size)] }.pack(&quot;C*&quot;)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN94"
>Generating Different Random Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">srand        # uses a combination of the time, the process id, and a sequence number</span>
<span class="cp">srand(val)   # for repeatable behaviour</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN97"
>Making Numbers Even More Random</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp"># from the randomr lib: </span>
<span class="cp"># http://raa.ruby-lang.org/project/randomr/</span>
<span class="cp">----&gt; http://raa.ruby-lang.org/project/randomr/</span>

<span class="cp">require &#39;random/mersenne_twister&#39;</span>
<span class="cp">mers = Random::MersenneTwister.new 123456789</span>
<span class="cp">puts mers.rand(0)    # 0.550321932544541</span>
<span class="cp">puts mers.rand(10)   # 2</span>

<span class="cp"># using online sources of random data via the realrand package:</span>
<span class="cp"># http://raa.ruby-lang.org/project/realrand/</span>
<span class="cp"># **Note**</span>
<span class="cp"># The following online services are used in this package:</span>
<span class="cp">#   http://www.random.org - source: atmospheric noise </span>
<span class="cp">#   http://www.fourmilab.ch/hotbits - source: radioactive decay timings</span>
<span class="cp">#   http://random.hd.org - source: entropy from local and network noise</span>
<span class="cp"># Please visit the sites and respect the rules of each service.</span>

<span class="cp">require &#39;random/online&#39;</span>

<span class="cp">generator1 = Random::RandomOrg.new</span>
<span class="cp">puts generator1.randbyte(5).join(&quot;,&quot;)</span>
<span class="cp">puts generator1.randnum(10, 1, 6).join(&quot;,&quot;)  # Roll dice 10 times.</span>

<span class="cp">generator2 = Random::FourmiLab.new</span>
<span class="cp">puts generator2.randbyte(5).join(&quot;,&quot;)</span>
<span class="cp"># randnum is not supported.</span>

<span class="cp">generator3 = Random::EntropyPool.new</span>
<span class="cp">puts generator3.randbyte(5).join(&quot;,&quot;)</span>
<span class="cp"># randnum is not supported.</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN100"
>Generating Biased Random Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">def gaussian_rand</span>
<span class="cp">    begin</span>
<span class="cp">        u1 = 2 * rand() - 1</span>
<span class="cp">        u2 = 2 * rand() - 1</span>
<span class="cp">        w = u1*u1 + u2*u2</span>
<span class="cp">    end while (w &gt;= 1)</span>
<span class="cp">    w = Math.sqrt((-2*Math.log(w))/w)</span>
<span class="cp">    [ u2*w, u1*w ]</span>
<span class="cp">end</span>

<span class="cp">mean = 25</span>
<span class="cp">sdev = 2</span>
<span class="cp">salary = gaussian_rand[0] * sdev + mean</span>
<span class="cp">printf(&quot;You have been hired at \$%.2f\n&quot;, salary)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN103"
>Doing Trigonometry in Degrees, not Radians</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">def deg2rad(d)</span>
<span class="cp">    (d/180.0)*Math::PI</span>
<span class="cp">end</span>

<span class="cp">def rad2deg(r)</span>
<span class="cp">    (r/Math::PI)*180</span>
<span class="cp">end</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN106"
>Calculating More Trigonometric Functions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">sin_val = Math.sin(angle)</span>
<span class="cp">cos_val = Math.cos(angle)</span>
<span class="cp">tan_val = Math.tan(angle)</span>

<span class="cp"># AFAIK Ruby&#39;s Math module doesn&#39;t provide acos/asin</span>
<span class="cp"># While we&#39;re at it, let&#39;s also define missing hyperbolic functions</span>
<span class="cp">module Math</span>
<span class="cp">    def Math.asin(x)</span>
<span class="cp">        atan2(x, sqrt(1 - x**2))</span>
<span class="cp">    end</span>
<span class="cp">    def Math.acos(x)</span>
<span class="cp">        atan2(sqrt(1 - x**2), x)</span>
<span class="cp">    end</span>
<span class="cp">    def Math.atan(x)</span>
<span class="cp">        atan2(x, 1)</span>
<span class="cp">    end</span>
<span class="cp">    def Math.sinh(x)</span>
<span class="cp">        (exp(x) - exp(-x)) / 2</span>
<span class="cp">    end</span>
<span class="cp">    def Math.cosh(x)</span>
<span class="cp">        (exp(x) + exp(-x)) / 2</span>
<span class="cp">    end</span>
<span class="cp">    def Math.tanh(x)</span>
<span class="cp">        sinh(x) / cosh(x)</span>
<span class="cp">    end</span>
<span class="cp">end</span>

<span class="cp"># The support for Complex numbers is not built-in</span>
<span class="cp">y = Math.acos(3.7)</span>
<span class="cp">#=&gt; in `sqrt&#39;: square root for negative number (ArgumentError)</span>

<span class="cp"># There is an implementation of Complex numbers in &#39;complex.rb&#39; in current</span>
<span class="cp"># Ruby distro, but it doesn&#39;t support atan2 with complex args, so it doesn&#39;t</span>
<span class="cp"># solve this problem.</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN109"
>Taking Logarithms</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">log_e = Math.log(val)</span>
<span class="cp">log_10 = Math.log10(val)</span>

<span class="cp">def log_base(base, val)</span>
<span class="cp">    Math.log(val)/Math.log(base)</span>
<span class="cp">end</span>

<span class="cp">answer = log_base(10, 10_000)</span>
<span class="cp">puts &quot;log10(10,000) = #{answer}&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN112"
>Multiplying Matrices</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">require &#39;matrix.rb&#39;</span>

<span class="cp">a = Matrix[[3, 2, 3], [5, 9, 8]]</span>
<span class="cp">b = Matrix[[4, 7], [9, 3], [8, 1]]</span>
<span class="cp">c = a * b</span>

<span class="cp">a.row_size</span>
<span class="cp">a.column_size</span>

<span class="cp">c.det</span>
<span class="cp">a.transpose</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN115"
>Using Complex Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">require &#39;complex.rb&#39;</span>
<span class="cp">require &#39;rational.rb&#39;</span>

<span class="cp">a = Complex(3, 5)              # 3 + 5i</span>
<span class="cp">b = Complex(2, -2)             # 2 - 2i</span>
<span class="cp">puts &quot;c = #{a*b}&quot;</span>

<span class="cp">c = a * b</span>
<span class="cp">d = 3 + 4*Complex::I</span>

<span class="cp">printf &quot;sqrt(#{d}) = %s\n&quot;, Math.sqrt(d)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN118"
>Converting Between Octal and Hexadecimal</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">number = hexadecimal.hex</span>
<span class="cp">number = octal.oct</span>

<span class="cp">print &quot;Gimme a number in decimal, octal, or hex: &quot;</span>
<span class="cp">num = gets.chomp</span>
<span class="cp">exit unless defined?(num)</span>
<span class="cp">num = num.oct if num =~ /^0/  # does both oct and hex  </span>
<span class="cp">printf &quot;%d %x %o\n&quot;, num, num, num</span>

<span class="cp">print &quot;Enter file permission in octal: &quot;</span>
<span class="cp">permissions = gets.chomp</span>
<span class="cp">raise &quot;Exiting ...\n&quot; unless defined?(permissions)</span>
<span class="cp">puts &quot;The decimal value is #{permissions.oct}&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN121"
>Putting Commas in Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">def commify(n)</span>
<span class="cp">    n.to_s =~ /([^\.]*)(\..*)?/</span>
<span class="cp">    int, dec = $1.reverse, $2 ? $2 : &quot;&quot;</span>
<span class="cp">    while int.gsub!(/(,|\.|^)(\d{3})(\d)/, &#39;\1\2,\3&#39;)</span>
<span class="cp">    end</span>
<span class="cp">    int.reverse + dec</span>
<span class="cp">end</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN124"
>Printing Correct Plurals</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">printf &quot;It took %d hour%s\n&quot;, time, time == 1 ? &quot;&quot; : &quot;s&quot;</span>

<span class="cp"># dunno if an equivalent to Lingua::EN::Inflect exists...</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN127"
>Program: Calculating Prime Factors</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">#!/usr/bin/ruby</span>
<span class="cp"># bigfact - calculating prime factors</span>
<span class="cp">def factorize(orig)</span>
<span class="cp">    factors = {}</span>
<span class="cp">    factors.default = 0     # return 0 instead nil if key not found in hash</span>
<span class="cp">    n = orig</span>
<span class="cp">    i = 2</span>
<span class="cp">    sqi = 4                 # square of i</span>
<span class="cp">    while sqi &lt;= n do</span>
<span class="cp">        while n.modulo(i) == 0 do</span>
<span class="cp">            n /= i</span>
<span class="cp">            factors[i] += 1</span>
<span class="cp">            # puts &quot;Found factor #{i}&quot;</span>
<span class="cp">        end</span>
<span class="cp">        # we take advantage of the fact that (i +1)**2 = i**2 + 2*i +1</span>
<span class="cp">        sqi += 2 * i + 1</span>
<span class="cp">        i += 1</span>
<span class="cp">    end</span>
<span class="cp">    </span>
<span class="cp">    if (n != 1) &amp;&amp; (n != orig)</span>
<span class="cp">        factors[n] += 1</span>
<span class="cp">    end</span>
<span class="cp">    factors</span>
<span class="cp">end</span>

<span class="cp">def printfactorhash(orig, factorcount)</span>
<span class="cp">    print format(&quot;%-10d &quot;, orig)</span>
<span class="cp">    if factorcount.length == 0</span>
<span class="cp">        print &quot;PRIME&quot;</span>
<span class="cp">    else</span>
<span class="cp">        # sorts after number, because the hash keys are numbers</span>
<span class="cp">        factorcount.sort.each { |factor,exponent|</span>
<span class="cp">            print factor</span>
<span class="cp">            if exponent &gt; 1</span>
<span class="cp">                print &quot;**&quot;, exponent</span>
<span class="cp">            end</span>
<span class="cp">            print &quot; &quot;</span>
<span class="cp">        }</span>
<span class="cp">    end</span>
<span class="cp">    puts</span>
<span class="cp">end</span>

<span class="cp">for arg in ARGV</span>
<span class="cp">    n = arg.to_i</span>
<span class="cp">    mfactors = factorize(n)</span>
<span class="cp">    printfactorhash(n, mfactors)</span>
<span class="cp">end</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="strings.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="datesandtimes.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Strings</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Dates and Times</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>