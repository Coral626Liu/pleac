<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>References and Records</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Ruby"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Subroutines"
HREF="subroutines.html"><LINK
REL="NEXT"
TITLE="Packages, Libraries, and Modules"
HREF="packagesetc.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Ruby</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="subroutines.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="packagesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="REFERENCESANDRECORDS"
>11. References and Records</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN592"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN595"
>Taking References to Arrays</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN598"
>Making Hashes of Arrays</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp"># In Ruby, everything is an object (i.e. reference), including arrays.</span>
<span class="cp"># Arrays are, thus, directly supported as values of a hash.</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># Assumes an array was already put into hash[&quot;KEYNAME&quot;], e.g.:</span>
<span class="cp"># hash = {}</span>
<span class="cp"># hash[&quot;KEYNAME&quot;] = [5, 10, 15]</span>
<span class="cp">hash[&quot;KEYNAME&quot;] &lt;&lt; &quot;new value&quot;</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># Join is used to separate elements of the array with commas.</span>
<span class="cp">hash.each { |key, value|</span>
<span class="cp">    puts &quot;#{key}: #{value.join(&#39;, &#39;)}&quot;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">hash[&quot;a key&quot;] = [3, 4, 5]</span>
<span class="cp">#-----------------------------</span>
<span class="cp">values = hash[&quot;a key&quot;]</span>
<span class="cp">#-----------------------------</span>
<span class="cp">hash[&quot;a key&quot;] &lt;&lt; value</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># Example hash:</span>
<span class="cp"># phone2name = { 123555888 =&gt; [&quot;Joe&quot;, &quot;Jenny&quot;], 888555444 =&gt; [&quot;Anne&quot;, &quot;Mark&quot;] }</span>
<span class="cp">residents = phone2name[number]</span>
<span class="cp">#-----------------------------</span>
<span class="cp">residents = phone2name.has_key?(number) ? phone2name[number] : []</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN601"
>Taking References to Hashes</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN604"
>Taking References to Functions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN607"
>Taking References to Scalars</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN610"
>Creating Arrays of Scalar References</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN613"
>Using Closures Instead of Objects</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">def mkcounter(count)</span>
<span class="cp">    start  = count </span>
<span class="cp">    bundle = { </span>
<span class="cp">        &quot;NEXT&quot;   =&gt; proc { count += 1 },</span>
<span class="cp">        &quot;PREV&quot;   =&gt; proc { count -= 1 },</span>
<span class="cp">        &quot;RESET&quot;  =&gt; proc { count = start }</span>
<span class="cp">    }</span>
<span class="cp">    bundle[&quot;LAST&quot;] = bundle[&quot;PREV&quot;]</span>
<span class="cp">    return bundle</span>
<span class="cp">end</span>

<span class="cp">c1 = mkcounter(20)</span>
<span class="cp">c2 = mkcounter(77)</span>

<span class="cp">puts &quot;next c1: #{c1[&quot;NEXT&quot;].call}&quot;  # 21 </span>
<span class="cp">puts &quot;next c2: #{c2[&quot;NEXT&quot;].call}&quot;  # 78 </span>
<span class="cp">puts &quot;next c1: #{c1[&quot;NEXT&quot;].call}&quot;  # 22 </span>
<span class="cp">puts &quot;last c1: #{c1[&quot;PREV&quot;].call}&quot;  # 21 </span>
<span class="cp">puts &quot;last c1: #{c1[&quot;LAST&quot;].call}&quot;  # 20 </span>
<span class="cp">puts &quot;old  c2: #{c2[&quot;RESET&quot;].call}&quot; # 77 </span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN616"
>Creating References to Methods</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN619"
>Constructing Records</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">record = {</span>
<span class="cp">    :NAME   =&gt; &quot;Jason&quot;,</span>
<span class="cp">    :EMPNO  =&gt; 132,</span>
<span class="cp">    :TITLE  =&gt; &quot;deputy peon&quot;,</span>
<span class="cp">    :AGE    =&gt; 23,</span>
<span class="cp">    :SALARY =&gt; 37.000,</span>
<span class="cp">    :PALS   =&gt; [ &quot;Norbert&quot;, &quot;Rhys&quot;, &quot;Phineas&quot;]</span>
<span class="cp">}</span>

<span class="cp">puts &quot;I am #{record[:NAME]}, and my pals are #{record[:PALS].join(&#39;, &#39;)}.&quot;</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># store record</span>
<span class="cp">byname = {}</span>
<span class="cp">byname[record[:NAME]] = record</span>

<span class="cp"># later on, look up by name</span>
<span class="cp">rp = byname[&quot;Aron&quot;]</span>
<span class="cp">puts &quot;Aron is employee #{rp[:EMPNO]}.&quot; if rp</span>

<span class="cp"># give jason a new pal</span>
<span class="cp">byname[&quot;Jason&quot;][:PALS] &lt;&lt; &quot;Theodore&quot;</span>
<span class="cp">puts &quot;Jason now has #{byname[&quot;Jason&quot;][:PALS].length} pals&quot;</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># Go through all records</span>
<span class="cp">byname.each do |name, record|</span>
<span class="cp">    puts &quot;#{name} is employee number #{record[:EMPNO]}&quot;</span>
<span class="cp">end    </span>
<span class="cp">#-----------------------------</span>
<span class="cp"># store record</span>
<span class="cp">employees = {}</span>
<span class="cp">employees[record[:EMPNO]] = record</span>

<span class="cp"># lookup by id</span>
<span class="cp">rp = employees[132]</span>
<span class="cp">puts &quot;employee number 132 is #{rp[:NAME]}&quot; if rp</span>
<span class="cp">#-----------------------------</span>
<span class="cp">byname[&quot;Jason&quot;][:SALARY] *= 1.035</span>
<span class="cp">#-----------------------------</span>
<span class="cp">peons = employees.values.select { |record| record[:TITLE] =~ /peon/i }</span>
<span class="cp">tsevens = employees.values.select { |record| record[:AGE] == 27 }</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># Go through all records</span>
<span class="cp">byname.values.sort { |a, b| a[:AGE] &lt;=&gt; b[:AGE] }.each do |rp|</span>
<span class="cp">        puts &quot;#{rp[:NAME]} is age #{rp[:AGE]}.&quot;</span>
<span class="cp">end</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># A little different then Perl: we can use hash in Ruby.</span>
<span class="cp"># use @byage, _a hash_ of arrays of records</span>
<span class="cp">byage = {}</span>
<span class="cp">byage[record[:AGE]] = [] if byage[record[:AGE]] == nil</span>
<span class="cp">byage[record[:AGE]] &lt;&lt; record</span>
<span class="cp">#-----------------------------</span>
<span class="cp">byage.each do |age, rps|</span>
<span class="cp">    print &quot;Age #{age}: &quot;</span>
<span class="cp">    rps.each do |rp|</span>
<span class="cp">        print rp[:NAME], &quot; &quot;</span>
<span class="cp">    end</span>
<span class="cp">    print &quot;\n&quot;</span>
<span class="cp">end</span>
<span class="cp">#-----------------------------</span>
<span class="cp">byage.each do |age, rps|</span>
<span class="cp">    puts &quot;Age #{age}: #{byage[age].collect { |e| e[:NAME] }.join(&#39;, &#39;)}&quot;</span>
<span class="cp">end</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN622"
>Reading and Writing Hash Records to Text Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN625"
>Printing Data Structures</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN628"
>Copying Data Structures</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN631"
>Storing Data Structures to Disk</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN634"
>Transparently Persistent Data Structures</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN637"
>Program: Binary Trees</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">class Binary_tree</span>
<span class="cp">    def initialize(val)</span>
<span class="cp">        @value = val</span>
<span class="cp">        @left = nil</span>
<span class="cp">        @right = nil</span>
<span class="cp">    end</span>
<span class="cp">    </span>
<span class="cp">    # insert given value into proper point of</span>
<span class="cp">    # provided tree.  If no tree provided, </span>
<span class="cp">    # use implicit pass by reference aspect of @_</span>
<span class="cp">    # to fill one in for our caller.</span>
<span class="cp">    def insert(val)</span>
<span class="cp">        if val &lt; @value then</span>
<span class="cp">            if @left then</span>
<span class="cp">                @left.insert(val)</span>
<span class="cp">            else</span>
<span class="cp">                @left = Binary_tree.new(val)</span>
<span class="cp">            end</span>
<span class="cp">        elsif val &gt; @value then</span>
<span class="cp">            if @right then</span>
<span class="cp">                @right.insert(val)</span>
<span class="cp">            else</span>
<span class="cp">                @right = Binary_tree.new(val)</span>
<span class="cp">            end</span>
<span class="cp">        else</span>
<span class="cp">            puts &quot;double&quot;</span>
<span class="cp">            # do nothing, no double values</span>
<span class="cp">        end</span>
<span class="cp">    end</span>

<span class="cp">    # recurse on left child, </span>
<span class="cp">    # then show current value, </span>
<span class="cp">    # then recurse on right child.  </span>
<span class="cp">    def in_order</span>
<span class="cp">        @left.in_order if @left</span>
<span class="cp">        print @value, &quot; &quot;</span>
<span class="cp">        @right.in_order if @right</span>
<span class="cp">    end</span>
<span class="cp">    </span>
<span class="cp">    # show current value, </span>
<span class="cp">    # then recurse on left child, </span>
<span class="cp">    # then recurse on right child.</span>
<span class="cp">    def pre_order</span>
<span class="cp">        print @value, &quot; &quot;</span>
<span class="cp">        @left.pre_order if @left</span>
<span class="cp">        @right.pre_order if @right</span>
<span class="cp">    end</span>

<span class="cp">    # recurse on left child, </span>
<span class="cp">    # then recurse on right child,</span>
<span class="cp">    # then show current value.</span>
<span class="cp">    def post_order</span>
<span class="cp">        @left.post_order if @left</span>
<span class="cp">        @right.post_order if @right</span>
<span class="cp">        print @value, &quot; &quot;</span>
<span class="cp">    end</span>

<span class="cp">    # find out whether provided value is in the tree.</span>
<span class="cp">    # if so, return the node at which the value was found.</span>
<span class="cp">    # cut down search time by only looking in the correct</span>
<span class="cp">    # branch, based on current value.</span>
<span class="cp">    def search(val)</span>
<span class="cp">        if val == @value then</span>
<span class="cp">            return self</span>
<span class="cp">        elsif val &lt; @value then</span>
<span class="cp">            return @left.search(val) if @left</span>
<span class="cp">            return nil</span>
<span class="cp">        else</span>
<span class="cp">            return @right.search(val) if @right</span>
<span class="cp">            return nil</span>
<span class="cp">        end</span>
<span class="cp">    end</span>
<span class="cp">end</span>

<span class="cp"># first generate 20 random inserts</span>
<span class="cp">test = Binary_tree.new(0)</span>
<span class="cp">for a in 0..20</span>
<span class="cp">    test.insert(rand(1000)) </span>
<span class="cp">end</span>

<span class="cp"># now dump out the tree all three ways</span>
<span class="cp">print &quot;Pre order:  &quot;;  test.pre_order;  puts &quot;&quot;</span>
<span class="cp">print &quot;In order:  &quot;;  test.in_order;  puts &quot;&quot;</span>
<span class="cp">print &quot;Post order:  &quot;;  test.post_order;  puts &quot;&quot;</span>

<span class="cp">print &quot;search?&quot;</span>
<span class="cp">while gets</span>
<span class="cp">    print test.search($_.to_i)</span>
<span class="cp">    print &quot;\nsearch?&quot;</span>
<span class="cp">end</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="subroutines.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="packagesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Subroutines</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Packages, Libraries, and Modules</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>