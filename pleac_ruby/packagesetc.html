<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Packages, Libraries, and Modules</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Ruby"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="References and Records"
HREF="referencesandrecords.html"><LINK
REL="NEXT"
TITLE="Classes, Objects, and Ties"
HREF="classesetc.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Ruby</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="referencesandrecords.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="classesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="PACKAGESETC"
>12. Packages, Libraries, and Modules</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN642"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp"># class and module names need to have the first letter capitalized</span>
<span class="cp">module Alpha</span>
<span class="cp">    NAME = &#39;first&#39;</span>
<span class="cp">end</span>
<span class="cp">module Omega</span>
<span class="cp">    NAME = &#39;last&#39;</span>
<span class="cp">end</span>
<span class="cp">puts &quot;Alpha is #{Alpha::NAME}, Omega is #{Omega::NAME}&quot;</span>

<span class="cp"># ruby doesn&#39;t differentiate beteen compile-time and run-time</span>
<span class="cp">require &#39;getoptlong.rb&#39;</span>
<span class="cp">require &#39;getoptlong&#39;     # assumes the .rb</span>
<span class="cp">require &#39;cards/poker.rb&#39;</span>
<span class="cp">require &#39;cards/poker&#39;    # assumes the .rb</span>
<span class="cp">load    &#39;cards/poker&#39;    # require only loads the file once</span>

<span class="cp">module Cards</span>
<span class="cp">    module Poker</span>
<span class="cp">        @card_deck = Array.new # or @card_deck = []</span>
<span class="cp">        def shuffle</span>
<span class="cp">        end</span>
<span class="cp">    end</span>
<span class="cp">end</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN645"
>Defining a Module's Interface</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp"># a module exports all of its functions</span>
<span class="cp">module Your_Module</span>
<span class="cp">    def self.function</span>
<span class="cp">        # this would be called as Your_Module.function</span>
<span class="cp">    end</span>
<span class="cp">    </span>
<span class="cp">    def Your_Module.another</span>
<span class="cp">        # this is the same as above, but more specific</span>
<span class="cp">    end</span>
<span class="cp">end</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN648"
>Trapping Errors in require or use</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">begin</span>
<span class="cp">    require &#39;nonexistent&#39;</span>
<span class="cp">rescue LoadError</span>
<span class="cp">    puts &quot;Couldn&#39;t load #{$!}&quot;  # $! contains the last error string</span>
<span class="cp">end</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN651"
>Delaying use Until Run Time</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN654"
>Making Variables Private to a Module</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp"># module variables are private unless access functions are defined</span>
<span class="cp">module Alpha</span>
<span class="cp">    @aa = 10</span>
<span class="cp">    @bb = 11</span>
<span class="cp">    </span>
<span class="cp">    def self.put_aa</span>
<span class="cp">        puts @aa</span>
<span class="cp">    end</span>
<span class="cp">    </span>
<span class="cp">    def self.bb=(val)</span>
<span class="cp">        @bb = val</span>
<span class="cp">    end</span>
<span class="cp">end</span>

<span class="cp">Alpha.bb = 12</span>
<span class="cp"># Alpha.aa = 10 # error, no aa=method</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN657"
>Determining the Caller's Package</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp"># caller provides a backtrace of the call stack</span>
<span class="cp">module MyModule</span>
<span class="cp">    def find_caller</span>
<span class="cp">        caller</span>
<span class="cp">    end</span>

<span class="cp">    def find_caller2(i)</span>
<span class="cp">        caller(i) # an argument limits the size of the stack returned</span>
<span class="cp">    end</span>
<span class="cp">end</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN660"
>Automating Module Clean-Up</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">BEGIN {</span>
<span class="cp">    $logfile = &#39;/tmp/mylog&#39; unless defined? $logfile</span>
<span class="cp">    $LF = File.open($logfile, &#39;a&#39;)</span>
<span class="cp">}</span>

<span class="cp">module Logger</span>
<span class="cp">    def self.logmsg(msg)</span>
<span class="cp">        $LF.puts msg</span>
<span class="cp">    end</span>

<span class="cp">    logmsg(&#39;startup&#39;)</span>
<span class="cp">end</span>

<span class="cp">END {</span>
<span class="cp">    Logger::logmsg(&#39;shutdown&#39;)</span>
<span class="cp">    $LF.close</span>
<span class="cp">}</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN663"
>Keeping Your Own Module Directory</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp"># results may be different on your system</span>
<span class="cp"># % ruby -e &quot;$LOAD_PATH.each_index { |i| printf(&quot;%d %s\n&quot;, i, $LOAD_PATH[i] }</span>
<span class="cp">#0 /usr/local/lib/site_ruby/1.6</span>
<span class="cp">#1 /usr/local/lib/site_ruby/1.6/i386-linux</span>
<span class="cp">#2 /usr/local/lib/site_ruby/</span>
<span class="cp">#3 /usr/lib/ruby/1.6</span>
<span class="cp">#4 /usr/lib/ruby/1.6/i136-linux</span>
<span class="cp">#5 .</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># syntax for sh, bash, ksh, or zsh</span>
<span class="cp">#$ export RUBYLIB=$HOME/rubylib</span>

<span class="cp"># syntax for csh or tcsh</span>
<span class="cp"># % setenv RUBYLIB ~/rubylib</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$LOAD_PATH.unshift &quot;/projects/spectre/lib&quot;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN666"
>Preparing a Module for Distribution</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp"># equivalents in ruby are mkmf, SWIG, or Ruby/DL depending on usage</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN669"
>Speeding Module Loading with SelfLoader</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp"># no equivalent in ruby</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN672"
>Speeding Up Module Loading with Autoloader</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp"># no equivalent in ruby</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN675"
>Overriding Built-In Functions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">module FineTime</span>
<span class="cp">    def self.time</span>
<span class="cp">        # to be defined later</span>
<span class="cp">    end</span>
<span class="cp">end</span>


<span class="cp">module FineTime</span>
<span class="cp">    def self.time</span>
<span class="cp">        &quot;its a fine time&quot;</span>
<span class="cp">    end</span>
<span class="cp">end</span>

<span class="cp">puts FineTime.time #=&gt; &quot;its a fine time&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN678"
>Reporting Errors and Warnings Like Built-Ins</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">def even_only(n)</span>
<span class="cp">    raise &quot;#{n} is not even&quot; if (n &amp; 1) != 0  # one way to test</span>
<span class="cp">    # ...</span>
<span class="cp">end</span>
<span class="cp">def even_only(n)</span>
<span class="cp">    $stderr.puts &quot;#{n} is not even&quot; if (n &amp; 1) != 0</span>
<span class="cp">    # ...</span>
<span class="cp">end</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN681"
>Referring to Packages Indirectly</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN684"
>Using h2ph to Translate C #include Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN687"
>Using h2xs to Make a Module with C Code</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN690"
>Documenting Your Module with Pod</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN693"
>Building and Installing a CPAN Module</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp"># The library archive for ruby is called Ruby Application archive,</span>
<span class="cp"># or shorter RAA, and can be found at http://raa.ruby-lang.org.</span>
<span class="cp"># A typical library is installed like this:</span>
<span class="cp"># % gunzip some-module-4.54.tar.gz</span>
<span class="cp"># % tar xf some-module-4.54.tar</span>
<span class="cp"># % cd some-module-4.54.tar</span>
<span class="cp"># % ruby install.rb config</span>
<span class="cp"># % ruby install.rb setup</span>
<span class="cp"># get superuser previleges here if needed for next step</span>
<span class="cp"># % ruby install.rb install</span>

<span class="cp"># Some modules use a different process,</span>
<span class="cp"># you should find details in the documentation</span>
<span class="cp"># Here is an example of such a different process</span>
<span class="cp"># % ruby extconf.rb</span>
<span class="cp"># % make</span>
<span class="cp"># % make install</span>

<span class="cp"># If you want the module installed in your own directory:</span>
<span class="cp"># For ruby version specific libraries</span>
<span class="cp"># % ruby install.rb config --site-ruby=~/lib</span>
<span class="cp"># For version independent libraries</span>
<span class="cp"># % ruby install.rb config --site-ruby-common=~/lib</span>

<span class="cp"># Information about possible options for config</span>
<span class="cp"># % ruby install.rb --help</span>

<span class="cp"># If you have your own complete distribution</span>
<span class="cp"># % ruby install.rb --prefix=path=~/ruby-private</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN696"
>Example: Module Template</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN699"
>Program: Finding Versions and Descriptions of Installed Modules</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="referencesandrecords.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="classesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>References and Records</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Classes, Objects, and Ties</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>