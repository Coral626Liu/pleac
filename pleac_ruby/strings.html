<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Strings</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Ruby"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="PLEAC-Ruby"
HREF="index.html"><LINK
REL="NEXT"
TITLE="Numbers"
HREF="numbers.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Ruby</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="index.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="numbers.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="STRINGS"
>1. Strings</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN14"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;\n&#39;</span>                     <span class="c1"># two characters, \ and an n</span>
<span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;Jon \&#39;Maddog\&#39; Orwant&#39;</span>  <span class="c1"># literal single quotes</span>

<span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>                     <span class="c1"># a &quot;newline&quot; character</span>
<span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;Jon </span><span class="se">\&quot;</span><span class="s2">Maddog</span><span class="se">\&quot;</span><span class="s2"> Orwant&quot;</span>  <span class="c1"># literal double quotes</span>

<span class="n">string</span> <span class="o">=</span> <span class="sx">%q/Jon &#39;Maddog&#39; Orwant/</span>  <span class="c1"># literal single quotes</span>

<span class="n">string</span> <span class="o">=</span> <span class="sx">%q[Jon &#39;Maddog&#39; Orwant]</span>  <span class="c1"># literal single quotes</span>
<span class="n">string</span> <span class="o">=</span> <span class="sx">%q{Jon &#39;Maddog&#39; Orwant}</span>  <span class="c1"># literal single quotes</span>
<span class="n">string</span> <span class="o">=</span> <span class="sx">%q(Jon &#39;Maddog&#39; Orwant)</span>  <span class="c1"># literal single quotes</span>
<span class="n">string</span> <span class="o">=</span> <span class="sx">%q&lt;Jon &#39;Maddog&#39; Orwant&gt;</span>  <span class="c1"># literal single quotes</span>

<span class="n">a</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="sh">&quot;</span><span class="no">EOF</span><span class="sh">&quot;</span>
<span class="sh">This is a multiline here document</span>
<span class="sh">terminated by EOF on a line by itself</span>
<span class="no">EOF</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN17"
>Accessing Substrings</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="n">value</span> <span class="o">=</span> <span class="n">string</span><span class="o">[</span><span class="n">offset</span><span class="p">,</span><span class="n">count</span><span class="o">]</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">string</span><span class="o">[</span><span class="n">offset</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span>

<span class="n">string</span><span class="o">[</span><span class="n">offset</span><span class="p">,</span><span class="n">count</span><span class="o">]</span> <span class="o">=</span> <span class="n">newstring</span>
<span class="n">string</span><span class="o">[</span><span class="n">offset</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span>   <span class="o">=</span> <span class="n">newtail</span>

<span class="c1"># in Ruby we can also specify intervals by their two offsets</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">string</span><span class="o">[</span><span class="n">offset</span><span class="o">.</span><span class="n">.offs2</span><span class="o">]</span>
<span class="n">string</span><span class="o">[</span><span class="n">offset</span><span class="o">.</span><span class="n">.offs2</span><span class="o">]</span> <span class="o">=</span> <span class="n">newstring</span>

<span class="n">leading</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">trailing</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;A5 x3 A8 A8 A*&quot;</span><span class="p">)</span>

<span class="n">fivers</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;A5&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">length</span><span class="o">/</span><span class="mi">5</span><span class="p">))</span>

<span class="n">chars</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;A1&quot;</span> <span class="o">*</span> <span class="n">string</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>

<span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;This is what you have&quot;</span>
<span class="c1">#        +012345678901234567890  Indexing forwards  (left to right)</span>
<span class="c1">#         109876543210987654321- Indexing backwards (right to left)</span>
<span class="c1">#          note that 0 means 10 or 20, etc. above</span>

<span class="n">first</span>  <span class="o">=</span> <span class="n">string</span><span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span>       <span class="c1"># &quot;T&quot;</span>
<span class="n">start</span>  <span class="o">=</span> <span class="n">string</span><span class="o">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="o">]</span>       <span class="c1"># &quot;is&quot;</span>
<span class="n">rest</span>   <span class="o">=</span> <span class="n">string</span><span class="o">[</span><span class="mi">13</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span>     <span class="c1"># &quot;you have&quot;</span>
<span class="n">last</span>   <span class="o">=</span> <span class="n">string</span><span class="o">[-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span>      <span class="c1"># &quot;e&quot;</span>
<span class="n">end_</span>   <span class="o">=</span> <span class="n">string</span><span class="o">[-</span><span class="mi">4</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span>     <span class="c1"># &quot;have&quot;</span>
<span class="n">piece</span>  <span class="o">=</span> <span class="n">string</span><span class="o">[-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span>      <span class="c1"># &quot;you&quot;</span>

<span class="n">string</span><span class="o">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;wasn&#39;t&quot;</span>     <span class="c1"># change &quot;is&quot; to &quot;wasn&#39;t&quot;</span>
<span class="n">string</span><span class="o">[-</span><span class="mi">12</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;ondrous&quot;</span> <span class="c1"># &quot;This wasn&#39;t wondrous&quot;</span>
<span class="n">string</span><span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>           <span class="c1"># delete first character</span>
<span class="n">string</span><span class="o">[-</span><span class="mi">10</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span>  <span class="o">=</span> <span class="s2">&quot;&quot;</span>       <span class="c1"># delete last 10 characters</span>

<span class="k">if</span> <span class="n">string</span><span class="o">[-</span><span class="mi">10</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span> <span class="o">=~</span> <span class="sr">/pattern/</span>
    <span class="nb">puts</span> <span class="s2">&quot;Pattern matches in last 10 characters&quot;</span>
<span class="k">end</span>

<span class="n">string</span><span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="o">].</span><span class="n">gsub!</span><span class="p">(</span><span class="sr">/is/</span><span class="p">,</span> <span class="s1">&#39;at&#39;</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="s2">&quot;make a hat&quot;</span>
<span class="n">a</span><span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span><span class="p">,</span> <span class="n">a</span><span class="o">[-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">[-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span><span class="p">,</span> <span class="n">a</span><span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span>

<span class="n">a</span> <span class="o">=</span> <span class="s2">&quot;To be or not to be&quot;</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;x6 A6&quot;</span><span class="p">)</span>

<span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;x6 A2 X5 A2&quot;</span><span class="p">)</span>
<span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">b</span><span class="si">}</span><span class="se">\n</span><span class="si">#{</span><span class="n">c</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="k">def</span> <span class="nf">cut2fmt</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">lastpos</span>  <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">place</span> <span class="k">in</span> <span class="n">args</span>
        <span class="n">template</span> <span class="o">+=</span> <span class="s2">&quot;A&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="n">place</span> <span class="o">-</span> <span class="n">lastpos</span><span class="p">)</span><span class="o">.</span><span class="n">to_s</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
        <span class="n">lastpos</span>   <span class="o">=</span> <span class="n">place</span>
    <span class="k">end</span>
    <span class="n">template</span> <span class="o">+=</span> <span class="s2">&quot;A*&quot;</span>
    <span class="k">return</span> <span class="n">template</span>
<span class="k">end</span>

<span class="n">fmt</span> <span class="o">=</span> <span class="n">cut2fmt</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN20"
>Establishing a Default Value</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1"># careful! &quot;b is true&quot; doesn&#39;t mean &quot;b != 0&quot; (0 is true in Ruby)</span>
<span class="c1"># thus no problem of &quot;defined&quot; later since only nil is false</span>
<span class="c1"># the following sets to `c&#39; if `b&#39; is nil or false</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">||</span> <span class="n">c</span>

<span class="c1"># if you need Perl&#39;s behaviour (setting to `c&#39; if `b&#39; is 0) the most</span>
<span class="c1"># effective way is to use Numeric#nonzero? (thanks to Dave Thomas!)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">nonzero?</span> <span class="o">||</span> <span class="n">c</span>

<span class="c1"># you will still want to use defined? in order to test</span>
<span class="c1"># for scope existence of a given object</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">defined?</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="p">?</span> <span class="n">b</span> <span class="p">:</span> <span class="n">c</span>

<span class="n">dir</span> <span class="o">=</span> <span class="no">ARGV</span><span class="o">.</span><span class="n">shift</span> <span class="o">||</span> <span class="s2">&quot;/tmp&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN23"
>Exchanging Values Without Using Temporary Variables</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v1</span>

<span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">production</span> <span class="o">=</span> <span class="sx">%w(January March August)</span>
<span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">production</span> <span class="o">=</span> <span class="n">beta</span><span class="p">,</span> <span class="n">production</span><span class="p">,</span> <span class="n">alpha</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN26"
>Converting Between ASCII Characters and Values</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="n">num</span> <span class="o">=</span> <span class="n">char</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
<span class="n">char</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">chr</span>

<span class="c1"># Ruby also supports having a char from character constant</span>
<span class="n">num</span> <span class="o">=</span> <span class="sc">?r</span>

<span class="n">char</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;%c&quot;</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Number %d is character %c</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>

<span class="n">ascii</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;C*&quot;</span><span class="p">)</span>
<span class="n">string</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;C*&quot;</span><span class="p">)</span>

<span class="n">hal</span> <span class="o">=</span> <span class="s2">&quot;HAL&quot;</span>
<span class="n">ascii</span> <span class="o">=</span> <span class="n">hal</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;C*&quot;</span><span class="p">)</span>
<span class="c1"># We can&#39;t use Array#each since we can&#39;t mutate a Fixnum</span>
<span class="n">ascii</span><span class="o">.</span><span class="n">collect!</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
    <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>                         <span class="c1"># add one to each ASCII value</span>
<span class="p">}</span>                
<span class="n">ibm</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;C*&quot;</span><span class="p">)</span>
<span class="nb">puts</span> <span class="n">ibm</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN29"
>Processing a String One Character at a Time</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="n">array</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">array</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;C*&quot;</span><span class="p">)</span>

<span class="n">string</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="sr">/./</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
    <span class="c1"># do something with b</span>
<span class="p">}</span>

<span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;an apple a day&quot;</span>
<span class="nb">print</span> <span class="s2">&quot;unique chars are: &quot;</span><span class="p">,</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">uniq</span><span class="o">.</span><span class="n">sort</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">ascval</span> <span class="k">in</span> <span class="n">string</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;C*&quot;</span><span class="p">)</span> <span class="c1"># or use Array#each for a pure OO style :)</span>
    <span class="n">sum</span> <span class="o">+=</span> <span class="n">ascval</span>
<span class="k">end</span>
<span class="nb">puts</span> <span class="s2">&quot;sum is </span><span class="si">#{</span><span class="n">sum</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># since Ruby will go Bignum if necessary</span>

<span class="c1"># <font size="-1"><a href="http://pleac.sourceforge.net/include/ruby/slowcat.rb</span>">download the following standalone program</a></font>
<span class="c1">#!/usr/bin/ruby</span>
<span class="c1"># slowcat - emulate a   s l o w   line printer</span>
<span class="c1"># usage: slowcat [-DELAY] [files ...]</span>
<span class="c1"># the following line with &quot;&amp;&amp;&quot; works because all strings are true</span>
<span class="n">delay</span> <span class="o">=</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=~</span> <span class="sr">/^-([.\d]+)/</span> <span class="p">?</span> <span class="no">ARGV</span><span class="o">.</span><span class="n">shift</span> <span class="o">&amp;&amp;</span> <span class="vg">$1</span><span class="o">.</span><span class="n">to_i</span> <span class="p">:</span> <span class="mi">1</span>
<span class="vg">$stdout</span><span class="o">.</span><span class="n">sync</span> <span class="o">=</span> <span class="kp">true</span>
<span class="k">while</span> <span class="nb">gets</span>
    <span class="k">for</span> <span class="n">b</span> <span class="k">in</span> <span class="nb">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="nb">print</span> <span class="n">b</span>
        <span class="nb">sleep</span><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mo">005</span> <span class="o">*</span> <span class="n">delay</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN32"
>Reversing a String by Word or Character</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="n">revbytes</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">reverse</span>

<span class="n">revwords</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

<span class="n">revwords</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/(\s+)/</span><span class="p">)</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">join</span>

<span class="c1"># using the fact that IO is Enumerable, you can directly &quot;select&quot; it</span>
<span class="n">long_palindromes</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/usr/share/dict/words&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="nb">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">w</span><span class="o">|</span> <span class="n">w</span><span class="o">.</span><span class="n">chomp!</span><span class="p">;</span> <span class="n">w</span><span class="o">.</span><span class="n">reverse</span> <span class="o">==</span> <span class="n">w</span> <span class="o">&amp;&amp;</span> <span class="n">w</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="p">}</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN35"
>Expanding and Compressing Tabs</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="k">while</span> <span class="n">string</span><span class="o">.</span><span class="n">sub!</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">+&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="vg">$&amp;</span><span class="o">.</span><span class="n">length</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">-</span> <span class="vg">$`</span><span class="o">.</span><span class="n">length</span> <span class="o">%</span> <span class="mi">8</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN38"
>Expanding Variables in User Input</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="s1">&#39;You owe #{debt} to me&#39;</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\</span><span class="si">#{</span><span class="p">(\</span><span class="n">w</span><span class="o">+</span><span class="p">)</span><span class="si">}</span><span class="sr">/</span><span class="p">)</span> <span class="p">{</span> <span class="nb">eval</span><span class="p">(</span><span class="vg">$1</span><span class="p">)</span> <span class="p">}</span>

<span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">80</span>
<span class="n">text</span> <span class="o">=</span> <span class="sx">%q(I am #{rows} high and #{cols} long)</span>
<span class="n">text</span><span class="o">.</span><span class="n">gsub!</span><span class="p">(</span><span class="sr">/\</span><span class="si">#{</span><span class="p">(\</span><span class="n">w</span><span class="o">+</span><span class="p">)</span><span class="si">}</span><span class="sr">/</span><span class="p">)</span> <span class="p">{</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="vg">$1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="p">}</span>
<span class="nb">puts</span> <span class="n">text</span>

<span class="s1">&#39;I am 17 years old&#39;</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\d+/</span><span class="p">)</span> <span class="p">{</span> <span class="mi">2</span> <span class="o">*</span> <span class="vg">$&amp;</span><span class="o">.</span><span class="n">to_i</span> <span class="p">}</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN41"
>Controlling Case</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="n">e</span> <span class="o">=</span> <span class="s2">&quot;bo peep&quot;</span><span class="o">.</span><span class="n">upcase</span>
<span class="n">e</span><span class="o">.</span><span class="n">downcase!</span>
<span class="n">e</span><span class="o">.</span><span class="n">capitalize!</span>

<span class="s2">&quot;thIS is a loNG liNE&quot;</span><span class="o">.</span><span class="n">gsub!</span><span class="p">(</span><span class="sr">/\w+/</span><span class="p">)</span> <span class="p">{</span> <span class="vg">$&amp;</span><span class="o">.</span><span class="n">capitalize</span> <span class="p">}</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN44"
>Interpolating Functions and Expressions Within Strings</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="s2">&quot;I have </span><span class="si">#{</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> guanacos.&quot;</span>
<span class="nb">print</span> <span class="s2">&quot;I have &quot;</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot; guanacos.&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN47"
>Indenting Here Documents</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="n">var</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="sh">&#39;</span><span class="no">EOF</span><span class="sh">&#39;</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/^\s+/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="sh">    your text</span>
<span class="sh">    goes here</span>
<span class="no">EOF</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN50"
>Reformatting Paragraphs</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;Folding and splicing is the work of an editor,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>
    <span class="s2">&quot;not a mere collection of silicon</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span> 
    <span class="s2">&quot;and</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>
    <span class="s2">&quot;mobile electrons!&quot;</span>

<span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">max_size</span><span class="p">)</span>
    <span class="n">all</span> <span class="o">=</span> <span class="o">[]</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">l</span> <span class="k">in</span> <span class="n">str</span><span class="o">.</span><span class="n">split</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="n">l</span><span class="p">)</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;=</span> <span class="n">max_size</span>
            <span class="n">all</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">end</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="p">?</span> <span class="n">l</span> <span class="p">:</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">l</span>
    <span class="k">end</span>
    <span class="n">all</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="nb">print</span> <span class="n">wrap</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="c1">#=&gt; Folding and </span>
<span class="c1">#=&gt; splicing is the </span>
<span class="c1">#=&gt; work of an editor, </span>
<span class="c1">#=&gt; not a mere </span>
<span class="c1">#=&gt; collection of </span>
<span class="c1">#=&gt; silicon and mobile </span>
<span class="c1">#=&gt; electrons!</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN53"
>Escaping Characters</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="n">string</span> <span class="o">=</span> <span class="sx">%q(Mom said, &quot;Don&#39;t do that.&quot;)</span>
<span class="n">string</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/[&#39;&quot;]/</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;\\&#39;</span><span class="o">+</span><span class="vg">$&amp;</span> <span class="p">}</span>
<span class="n">string</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/[&#39;&quot;]/</span><span class="p">,</span> <span class="s1">&#39;\&amp;\&amp;&#39;</span><span class="p">)</span>
<span class="n">string</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/[^A-Z]/</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;\\&#39;</span><span class="o">+</span><span class="vg">$&amp;</span> <span class="p">}</span>
<span class="s2">&quot;is a test!&quot;</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\W/</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;\\&#39;</span><span class="o">+</span><span class="vg">$&amp;</span> <span class="p">}</span>  <span class="c1"># no function like quotemeta?</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN56"
>Trimming Blanks from the Ends of a String</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="n">string</span><span class="o">.</span><span class="n">strip!</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN59"
>Parsing Comma-Separated Data</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="k">def</span> <span class="nf">parse_csv</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="kp">new</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="sr">/&quot;([^\&quot;\\]*(?:\\.[^\&quot;\\]*)*)&quot;,?|([^,]+),?|,/</span><span class="p">)</span>
    <span class="kp">new</span> <span class="o">&lt;&lt;</span> <span class="kp">nil</span> <span class="k">if</span> <span class="n">text</span><span class="o">[-</span><span class="mi">1</span><span class="o">]</span> <span class="o">==</span> <span class="sc">?,</span>
    <span class="kp">new</span><span class="o">.</span><span class="n">flatten</span><span class="o">.</span><span class="n">compact</span>
<span class="k">end</span>  

<span class="n">line</span> <span class="o">=</span> <span class="sx">%q&lt;XYZZY,&quot;&quot;,&quot;O&#39;Reilly, Inc&quot;,&quot;Wall, Larry&quot;,&quot;a \&quot;glug\&quot; bit,&quot;,5,&quot;Error, Core Dumped&quot;&gt;</span>
<span class="n">fields</span> <span class="o">=</span> <span class="n">parse_csv</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="n">fields</span><span class="o">.</span><span class="n">each_with_index</span> <span class="p">{</span> <span class="o">|</span><span class="n">v</span><span class="p">,</span><span class="n">i</span><span class="o">|</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2"> : </span><span class="si">#{</span><span class="n">v</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN62"
>Soundex Matching</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1"># Use the soundex.rb Library from Michael Neumann.</span>
<span class="c1"># http://www.s-direktnet.de/homepages/neumann/rb_prgs/Soundex.rb</span>
<span class="nb">require</span> <span class="s1">&#39;Soundex&#39;</span>

<span class="n">code</span> <span class="o">=</span> <span class="ss">Text</span><span class="p">:</span><span class="ss">:Soundex</span><span class="o">.</span><span class="n">soundex</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="n">codes</span> <span class="o">=</span> <span class="ss">Text</span><span class="p">:</span><span class="ss">:Soundex</span><span class="o">.</span><span class="n">soundex</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

<span class="c1"># substitution function for getpwent():</span>
<span class="c1"># returns an array of user entries,</span>
<span class="c1"># each entry contains the username and the full name</span>
<span class="k">def</span> <span class="nf">login_names</span>
    <span class="n">result</span> <span class="o">=</span> <span class="o">[]</span>
    <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/etc/passwd&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
        <span class="n">file</span><span class="o">.</span><span class="n">each_line</span> <span class="p">{</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
            <span class="k">next</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">/^#/</span><span class="p">)</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="o">[</span><span class="n">cols</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="n">cols</span><span class="o">[</span><span class="mi">4</span><span class="o">]]</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">result</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="s2">&quot;Lookup user: &quot;</span>
<span class="n">user</span> <span class="o">=</span> <span class="no">STDIN</span><span class="o">.</span><span class="n">gets</span>
<span class="n">user</span><span class="o">.</span><span class="n">chomp!</span>
<span class="nb">exit</span> <span class="k">unless</span> <span class="n">user</span>
<span class="n">name_code</span> <span class="o">=</span> <span class="ss">Text</span><span class="p">:</span><span class="ss">:Soundex</span><span class="o">.</span><span class="n">soundex</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

<span class="n">splitter</span> <span class="o">=</span> <span class="no">Regexp</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;(\w+)[^,]*\b(\w+)&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">username</span><span class="p">,</span> <span class="n">fullname</span> <span class="k">in</span> <span class="n">login_names</span> <span class="k">do</span>
    <span class="n">firstname</span><span class="p">,</span> <span class="n">lastname</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">]</span>
    <span class="k">if</span> <span class="n">name_code</span> <span class="o">==</span> <span class="ss">Text</span><span class="p">:</span><span class="ss">:Soundex</span><span class="o">.</span><span class="n">soundex</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
        <span class="o">||</span> <span class="n">name_code</span> <span class="o">==</span> <span class="ss">Text</span><span class="p">:</span><span class="ss">:Soundex</span><span class="o">.</span><span class="n">soundex</span><span class="p">(</span><span class="n">firstname</span><span class="p">)</span>
        <span class="o">||</span> <span class="n">name_code</span> <span class="o">==</span> <span class="ss">Text</span><span class="p">:</span><span class="ss">:Soundex</span><span class="o">.</span><span class="n">soundex</span><span class="p">(</span><span class="n">lastname</span><span class="p">)</span>
    <span class="k">then</span>
        <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">username</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">firstname</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">lastname</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">end</span>
<span class="k">end</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN65"
>Program: fixstyle</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1"># <font size="-1"><a href="http://pleac.sourceforge.net/include/ruby/fixstyle.rb</span>">download the following standalone program</a></font>
<span class="c1"># fixstyle - switch first set of &lt;DATA&gt; strings to second set</span>
<span class="c1">#   usage: $0 [-v] [files ...]</span>
<span class="c1">#   -v = verbose  prints &quot;a-&gt;b in file line N&quot; for every change.</span>
<span class="c1"># If no filenames are given, than the script runs as simple filter,</span>
<span class="c1"># else the files are edited in place, and a safety copy</span>
<span class="c1"># with the exentions &quot;.orig&quot; is created</span>

<span class="c1"># Regular expressions are objects in ruby, we have control</span>
<span class="c1"># when we compile them, so we don&#39;t need the eval hack</span>
<span class="c1"># from the perl solution.</span>
<span class="c1"># The changer class encapsulates the regular expression</span>
<span class="c1"># and its substitution string</span>
<span class="k">class</span> <span class="nc">Changer</span>
    
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">subst</span><span class="p">)</span>
        <span class="vi">@regex</span> <span class="o">=</span> <span class="no">Regexp</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
        <span class="vi">@subst</span> <span class="o">=</span> <span class="n">subst</span>
    <span class="k">end</span>
    
    <span class="k">def</span> <span class="nf">change</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">gsub!</span><span class="p">(</span><span class="vi">@regex</span><span class="p">,</span> <span class="vi">@subst</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">changed</span> <span class="o">&amp;&amp;</span> <span class="vg">$verbose</span>
            <span class="vg">$stderr</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="vi">@regex</span><span class="o">.</span><span class="n">source</span><span class="si">}</span><span class="s2"> changed to </span><span class="si">#{</span><span class="vi">@subst</span><span class="si">}</span><span class="s2"> at </span><span class="si">#{</span><span class="vg">$FILENAME</span><span class="si">}</span><span class="s2"> line </span><span class="si">#{</span><span class="vg">$.</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">end</span>
    <span class="k">end</span>
    
<span class="k">end</span>

<span class="c1"># get the lines from the Data section at the end of the file</span>
<span class="c1"># and put them in the list of Changer objects</span>
<span class="k">def</span> <span class="nf">get_subs_from_end</span><span class="p">()</span>
    <span class="n">changelist</span> <span class="o">=</span> <span class="o">[]</span>
    <span class="no">DATA</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
        <span class="n">line</span><span class="o">.</span><span class="n">chomp!</span>
        <span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">subst</span><span class="p">)</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/\s*=&gt;\s*/</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pat</span> <span class="o">&amp;&amp;</span> <span class="n">subst</span>
            <span class="n">changelist</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="no">Changer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">subst</span><span class="p">))</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="n">changelist</span>
<span class="k">end</span>

<span class="n">changelist</span> <span class="o">=</span> <span class="n">get_subs_from_end</span><span class="p">()</span>

<span class="k">if</span> <span class="no">ARGV</span> <span class="o">&amp;&amp;</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">==</span> <span class="s2">&quot;-v&quot;</span>
    <span class="no">ARGV</span><span class="o">.</span><span class="n">shift</span>
    <span class="vg">$verbose</span> <span class="o">=</span> <span class="kp">true</span>
<span class="k">else</span>
    <span class="vg">$verbose</span> <span class="o">=</span> <span class="kp">false</span>
<span class="k">end</span>

<span class="k">if</span> <span class="no">ARGV</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="vg">$-i</span> <span class="o">=</span> <span class="s2">&quot;.orig&quot;</span>     <span class="c1"># enables in-place edit mode</span>
<span class="k">elsif</span> <span class="nb">test</span><span class="p">(</span><span class="sc">?e</span><span class="p">,</span> <span class="vg">$stdin</span><span class="p">)</span>
    <span class="vg">$stderr</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="vg">$0</span><span class="si">}</span><span class="s2">:Reading from stdin&quot;</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">while</span> <span class="n">line</span> <span class="o">=</span> <span class="nb">gets</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">changer</span> <span class="k">in</span> <span class="n">changelist</span>
        <span class="n">changer</span><span class="o">.</span><span class="n">change</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="nb">puts</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="k">end</span>

<span class="cp">__END__</span>

<span class="cp"># analysed  =&gt; analyzed</span>
<span class="cp"># build-in  =&gt; builtin</span>
<span class="cp"># chastized =&gt; chatis</span>
<span class="cp"># commandline     =&gt; command-line</span>
<span class="cp"># de-allocate     =&gt; deallocate</span>
<span class="cp"># dropin          =&gt; drop-in</span>
<span class="cp"># hardcode        =&gt; hard-code</span>
<span class="cp"># meta-data       =&gt; metadata</span>
<span class="cp"># multicharacter  =&gt; multi-character</span>
<span class="cp"># multiway        =&gt; multi-way</span>
<span class="cp"># non-empty       =&gt; nonempty</span>
<span class="cp"># non-profit      =&gt; nonprofit</span>
<span class="cp"># non-trappable   =&gt; nontrappable</span>
<span class="cp"># pre-define      =&gt; predefine</span>
<span class="cp"># preextend       =&gt; pre-extend</span>
<span class="cp"># re-compiling    =&gt; recompiling</span>
<span class="cp"># reenter         =&gt; re-enter</span>
<span class="cp"># turnkey         =&gt; turn-key</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN68"
>Program: psgrep</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/ruby/psgrep.rb</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/ruby -w</span>
<span class="cp"># </span>
<span class="cp"># psgrep - print selected lines of ps output by</span>
<span class="cp">#          compiling user queries into code</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% psgrep &#39;~/sh\b/&#39;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% psgrep &#39;command =~ /sh$/&#39;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% psgrep &#39;uid &lt; 10&#39;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% psgrep &#39;command =~ /^-/&#39; &#39;tty ne &quot;?&quot;&#39;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% psgrep &#39;tty =~ /^[p-t]/&#39;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% psgrep &#39;uid &amp;&amp; tty eq &quot;?&quot;&#39;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% psgrep &#39;size &gt; 10 * 2**10&#39; &#39;uid != 0&#39;</span>
<span class="cp">#-----------------------------</span>

<span class="cp">class PS</span>
<span class="cp">    PS::Names = %w-flags uid pid ppid pri nice size</span>
<span class="cp">                   rss wchan stat tty time command-</span>
<span class="cp">    PS::Names.each {|sym| attr_accessor sym}</span>
<span class="cp">    attr_accessor :line</span>
<span class="cp">    def set_fields</span>
<span class="cp">        fields = line.split(&quot; &quot;,13)</span>
<span class="cp">        PS::Names.each_with_index do |sym,i|</span>
<span class="cp">            eval &quot;self.#{sym} = &quot; + </span>
<span class="cp">                ((0..7).include?(i) ? fields[i] : &quot;&#39;#{fields[i]}&#39;&quot;)</span>
<span class="cp">        end</span>
<span class="cp">    end</span>
<span class="cp">end</span>

<span class="cp">raise &lt;&lt;USAGE unless ARGV.size &gt; 0</span>
<span class="cp">    usage: $0 criterion ...</span>
<span class="cp">     #{PS::Names.join(&quot; &quot;)}</span>
<span class="cp">    All criteria must be met for a line to be printed</span>
<span class="cp">USAGE</span>

<span class="cp">PS.class_eval &lt;&lt;CRITERIA </span>
<span class="cp">    def is_desirable</span>
<span class="cp">        $_ = line</span>
<span class="cp">        #{ARGV.join(&quot; and &quot;)}</span>
<span class="cp">     end</span>
<span class="cp">CRITERIA</span>

<span class="cp">ps = PS.new</span>
<span class="cp">File.popen(&quot;ps wwaxl&quot;) do |f|</span>
<span class="cp">    puts f.gets</span>
<span class="cp">    f.each do |ps.line|</span>
<span class="cp">        ps.set_fields</span>
<span class="cp">        print ps.line if ps.is_desirable</span>
<span class="cp">    end</span>
<span class="cp">end</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="numbers.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>PLEAC-Ruby</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Numbers</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>