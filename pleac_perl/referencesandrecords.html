<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>References and Records</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Perl"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Subroutines"
HREF="subroutines.html"><LINK
REL="NEXT"
TITLE="Packages, Libraries, and Modules"
HREF="packagesetc.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Perl</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="subroutines.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="packagesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="REFERENCESANDRECORDS"
>11. References and Records</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN592"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">print $$sref;    # prints the scalar value that the reference $sref refers to</span>
<span class="cp">$$sref = 3;      # assigns to $sref&#39;s referent</span>
<span class="cp">#-----------------------------</span>
<span class="cp">print ${$sref};             # prints the scalar $sref refers to</span>
<span class="cp">${$sref} = 3;               # assigns to $sref&#39;s referent</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$aref = \@array;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$pi = \3.14159;</span>
<span class="cp">$$pi = 4;           # runtime error</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$aref = [ 3, 4, 5 ];                                # new anonymous array</span>
<span class="cp">$href = { &quot;How&quot; =&gt; &quot;Now&quot;, &quot;Brown&quot; =&gt; &quot;Cow&quot; };       # new anonymous hash</span>
<span class="cp">#-----------------------------</span>
<span class="cp">undef $aref;</span>
<span class="cp">@$aref = (1, 2, 3);</span>
<span class="cp">print $aref;</span>
<span class="cp">ARRAY(0x80c04f0)</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$a[4][23][53][21] = &quot;fred&quot;;</span>
<span class="cp">print $a[4][23][53][21];</span>
<span class="cp">fred</span>

<span class="cp">print $a[4][23][53];</span>
<span class="cp">ARRAY(0x81e2494)</span>

<span class="cp">print $a[4][23];</span>
<span class="cp">ARRAY(0x81e0748)</span>

<span class="cp">print $a[4];</span>
<span class="cp">ARRAY(0x822cd40)</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$op_cit = cite($ibid)       or die &quot;couldn&#39;t make a reference&quot;;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$Nat = { &quot;Name&quot;     =&gt; &quot;Leonhard Euler&quot;,</span>
<span class="cp">         &quot;Address&quot;  =&gt; &quot;1729 Ramanujan Lane\nMathworld, PI 31416&quot;,</span>
<span class="cp">         &quot;Birthday&quot; =&gt; 0x5bb5580,</span>
<span class="cp">       };</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN595"
>Taking References to Arrays</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">$aref               = \@array;</span>
<span class="cp">$anon_array         = [1, 3, 5, 7, 9];</span>
<span class="cp">$anon_copy          = [ @array ];</span>
<span class="cp">@$implicit_creation = (2, 4, 6, 8, 10);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">push(@$anon_array, 11);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$two = $implicit_creation-&gt;[0];</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$last_idx  = $#$aref;</span>
<span class="cp">$num_items = @$aref;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$last_idx  = $#{ $aref };</span>
<span class="cp">$num_items = scalar @{ $aref };</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># check whether $someref contains a simple array reference</span>
<span class="cp">if (ref($someref) ne &#39;ARRAY&#39;) {</span>
<span class="cp">    die &quot;Expected an array reference, not $someref\n&quot;;</span>
<span class="cp">}</span>

<span class="cp">print &quot;@{$array_ref}\n&quot;;        # print original data</span>

<span class="cp">@order = sort @{ $array_ref };  # sort it</span>

<span class="cp">push @{ $array_ref }, $item;    # append new element to orig array  </span>
<span class="cp">#-----------------------------</span>
<span class="cp">sub array_ref {</span>
<span class="cp">    my @array;</span>
<span class="cp">    return \@array;</span>
<span class="cp">}</span>

<span class="cp">$aref1 = array_ref();</span>
<span class="cp">$aref2 = array_ref();</span>
<span class="cp">#-----------------------------</span>
<span class="cp">print $array_ref-&gt;[$N];         # access item in position N (best)</span>
<span class="cp">print $$array_ref[$N];          # same, but confusing</span>
<span class="cp">print ${$array_ref}[$N];        # same, but still confusing, and ugly to boot</span>
<span class="cp">#-----------------------------</span>
<span class="cp">@$pie[3..5];                    # array slice, but a little confusing to read</span>
<span class="cp">@{$pie}[3..5];                  # array slice, easier (?) to read</span>
<span class="cp">#-----------------------------</span>
<span class="cp">@{$pie}[3..5] = (&quot;blackberry&quot;, &quot;blueberry&quot;, &quot;pumpkin&quot;);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$sliceref = \@{$pie}[3..5];     # WRONG!</span>
<span class="cp">#-----------------------------</span>
<span class="cp">foreach $item ( @{$array_ref} ) {   </span>
<span class="cp">    # $item has data</span>
<span class="cp">}</span>

<span class="cp">for ($idx = 0; $idx &lt;= $#{ $array_ref }; $idx++) {  </span>
<span class="cp">    # $array_ref-&gt;[$idx] has data</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN598"
>Making Hashes of Arrays</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">push(@{ $hash{&quot;KEYNAME&quot;} }, &quot;new value&quot;);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">foreach $string (keys %hash) {</span>
<span class="cp">    print &quot;$string: @{$hash{$string}}\n&quot;; </span>
<span class="cp">} </span>
<span class="cp">#-----------------------------</span>
<span class="cp">$hash{&quot;a key&quot;} = [ 3, 4, 5 ];       # anonymous array</span>
<span class="cp">#-----------------------------</span>
<span class="cp">@values = @{ $hash{&quot;a key&quot;} };</span>
<span class="cp">#-----------------------------</span>
<span class="cp">push @{ $hash{&quot;a key&quot;} }, $value;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">@residents = @{ $phone2name{$number} };</span>
<span class="cp">#-----------------------------</span>
<span class="cp">@residents = exists( $phone2name{$number} )</span>
<span class="cp">                ? @{ $phone2name{$number} }</span>
<span class="cp">                : ();</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN601"
>Taking References to Hashes</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">$href = \%hash;</span>
<span class="cp">$anon_hash = { &quot;key1&quot; =&gt; &quot;value1&quot;, &quot;key2&quot; =&gt; &quot;value2&quot;, ... };</span>
<span class="cp">$anon_hash_copy = { %hash };</span>
<span class="cp">#-----------------------------</span>
<span class="cp">%hash  = %$href;</span>
<span class="cp">$value = $href-&gt;{$key};</span>
<span class="cp">@slice = @$href{$key1, $key2, $key3};  # note: no arrow!</span>
<span class="cp">@keys  = keys %$href;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">if (ref($someref) ne &#39;HASH&#39;) {</span>
<span class="cp">    die &quot;Expected a hash reference, not $someref\n&quot;;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">foreach $href ( \%ENV, \%INC ) {       # OR: for $href ( \(%ENV,%INC) ) {</span>
<span class="cp">    foreach $key ( keys %$href ) {</span>
<span class="cp">        print &quot;$key =&gt; $href-&gt;{$key}\n&quot;;</span>
<span class="cp">    }</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">@values = @$hash_ref{&quot;key1&quot;, &quot;key2&quot;, &quot;key3&quot;};</span>

<span class="cp">for $val (@$hash_ref{&quot;key1&quot;, &quot;key2&quot;, &quot;key3&quot;}) {</span>
<span class="cp">    $val += 7;   # add 7 to each value in hash slice</span>
<span class="cp">} </span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN604"
>Taking References to Functions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">$cref = \&amp;func;</span>
<span class="cp">$cref = sub { ... };</span>
<span class="cp">#-----------------------------</span>
<span class="cp">@returned = $cref-&gt;(@arguments);</span>
<span class="cp">@returned = &amp;$cref(@arguments);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$funcname = &quot;thefunc&quot;;</span>
<span class="cp">&amp;$funcname();</span>
<span class="cp">#-----------------------------</span>
<span class="cp">my %commands = (</span>
<span class="cp">    &quot;happy&quot; =&gt; \&amp;joy,</span>
<span class="cp">    &quot;sad&quot;   =&gt; \&amp;sullen,</span>
<span class="cp">    &quot;done&quot;  =&gt; sub { die &quot;See ya!&quot; },</span>
<span class="cp">    &quot;mad&quot;   =&gt; \&amp;angry,</span>
<span class="cp">);</span>

<span class="cp">print &quot;How are you? &quot;;</span>
<span class="cp">chomp($string = &lt;STDIN&gt;);</span>
<span class="cp">if ($commands{$string}) {</span>
<span class="cp">    $commands{$string}-&gt;();</span>
<span class="cp">} else {</span>
<span class="cp">    print &quot;No such command: $string\n&quot;;</span>
<span class="cp">} </span>
<span class="cp">#-----------------------------</span>
<span class="cp">sub counter_maker {</span>
<span class="cp">    my $start = 0;</span>
<span class="cp">    return sub {                      # this is a closure</span>
<span class="cp">        return $start++;              # lexical from enclosing scope</span>
<span class="cp">    };</span>
<span class="cp">}</span>

<span class="cp">$counter = counter_maker();</span>

<span class="cp">for ($i = 0; $i &lt; 5; $i ++) {</span>
<span class="cp">    print &amp;$counter, &quot;\n&quot;;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$counter1 = counter_maker();</span>
<span class="cp">$counter2 = counter_maker();</span>

<span class="cp">for ($i = 0; $i &lt; 5; $i ++) {</span>
<span class="cp">    print &amp;$counter1, &quot;\n&quot;;</span>
<span class="cp">}</span>

<span class="cp">print &amp;$counter1, &quot; &quot;, &amp;$counter2, &quot;\n&quot;;</span>
<span class="cp">0</span>

<span class="cp">1</span>

<span class="cp">2</span>

<span class="cp">3</span>

<span class="cp">4</span>

<span class="cp">5 0</span>
<span class="cp">#-----------------------------</span>
<span class="cp">sub timestamp {</span>
<span class="cp">    my $start_time = time(); </span>
<span class="cp">    return sub { return time() - $start_time };</span>
<span class="cp">} </span>
<span class="cp">$early = timestamp(); </span>
<span class="cp">sleep 20; </span>
<span class="cp">$later = timestamp(); </span>
<span class="cp">sleep 10;</span>
<span class="cp">printf &quot;It&#39;s been %d seconds since early.\n&quot;, $early-&gt;();</span>
<span class="cp">printf &quot;It&#39;s been %d seconds since later.\n&quot;, $later-&gt;();</span>
<span class="cp">#It&#39;s been 30 seconds since early.</span>
<span class="cp">#</span>
<span class="cp">#It&#39;s been 10 seconds since later.</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN607"
>Taking References to Scalars</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">$scalar_ref = \$scalar;       # get reference to named scalar</span>
<span class="cp">#-----------------------------</span>
<span class="cp">undef $anon_scalar_ref;</span>
<span class="cp">$$anon_scalar_ref = 15;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$anon_scalar_ref = \15;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">print ${ $scalar_ref };       # dereference it</span>
<span class="cp">${ $scalar_ref } .= &quot;string&quot;; # alter referent&#39;s value</span>
<span class="cp">#-----------------------------</span>
<span class="cp">sub new_anon_scalar {</span>
<span class="cp">    my $temp;</span>
<span class="cp">    return \$temp;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$sref = new_anon_scalar();</span>
<span class="cp">$$sref = 3;</span>
<span class="cp">print &quot;Three = $$sref\n&quot;;</span>
<span class="cp">@array_of_srefs = ( new_anon_scalar(), new_anon_scalar() );</span>
<span class="cp">${ $array[0] } = 6.02e23;</span>
<span class="cp">${ $array[1] } = &quot;avocado&quot;;</span>
<span class="cp">print &quot;\@array contains: &quot;, join(&quot;, &quot;, map { $$_ } @array ), &quot;\n&quot;;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$var        = `uptime`;     # $var holds text</span>
<span class="cp">$vref       = \$var;        # $vref &quot;points to&quot; $var</span>
<span class="cp">if ($$vref =~ /load/) {}    # look at $var, indirectly</span>
<span class="cp">chomp $$vref;               # alter $var, indirectly</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># check whether $someref contains a simple scalar reference</span>
<span class="cp">if (ref($someref) ne &#39;SCALAR&#39;) {</span>
<span class="cp">    die &quot;Expected a scalar reference, not $someref\n&quot;;</span>

<span class="cp">}</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN610"
>Creating Arrays of Scalar References</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">@array_of_scalar_refs = ( \$a, \$b );</span>
<span class="cp">#-----------------------------</span>
<span class="cp">@array_of_scalar_refs = \( $a, $b );</span>
<span class="cp">#-----------------------------</span>
<span class="cp">${ $array_of_scalar_refs[1] } = 12;         # $b = 12</span>
<span class="cp">#-----------------------------</span>
<span class="cp">($a, $b, $c, $d) = (1 .. 4);        # initialize</span>
<span class="cp">@array =  (\$a, \$b, \$c, \$d);     # refs to each scalar</span>
<span class="cp">@array = \( $a,  $b,  $c,  $d);     # same thing!</span>
<span class="cp">@array = map { \my $anon } 0 .. 3;  # allocate 4 anon scalarresf</span>

<span class="cp">${ $array[2] } += 9;                # $c now 12</span>

<span class="cp">${ $array[ $#array ] } *= 5;        # $d now 20</span>
<span class="cp">${ $array[-1] }        *= 5;        # same; $d now 100</span>

<span class="cp">$tmp   = $array[-1];                # using temporary</span>
<span class="cp">$$tmp *= 5;                         # $d now 500</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Math::Trig qw(pi);              # load the constant pi</span>
<span class="cp">foreach $sref (@array) {            # prepare to change $a,$b,$c,$d</span>
<span class="cp">    ($$sref **= 3) *= (4/3 * pi);   # replace with spherical volumes</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN613"
>Using Closures Instead of Objects</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">$c1 = mkcounter(20); </span>
<span class="cp">$c2 = mkcounter(77);</span>

<span class="cp">printf &quot;next c1: %d\n&quot;, $c1-&gt;{NEXT}-&gt;();  # 21 </span>
<span class="cp">printf &quot;next c2: %d\n&quot;, $c2-&gt;{NEXT}-&gt;();  # 78 </span>
<span class="cp">printf &quot;next c1: %d\n&quot;, $c1-&gt;{NEXT}-&gt;();  # 22 </span>
<span class="cp">printf &quot;last c1: %d\n&quot;, $c1-&gt;{PREV}-&gt;();  # 21 </span>
<span class="cp">printf &quot;old  c2: %d\n&quot;, $c2-&gt;{RESET}-&gt;(); # 77</span>
<span class="cp">#-----------------------------</span>
<span class="cp">sub mkcounter {</span>
<span class="cp">    my $count  = shift; </span>
<span class="cp">    my $start  = $count; </span>
<span class="cp">    my $bundle = { </span>
<span class="cp">        &quot;NEXT&quot;   =&gt; sub { return ++$count  }, </span>
<span class="cp">        &quot;PREV&quot;   =&gt; sub { return --$count  }, </span>
<span class="cp">        &quot;GET&quot;    =&gt; sub { return $count    },</span>
<span class="cp">        &quot;SET&quot;    =&gt; sub { $count = shift   }, </span>
<span class="cp">        &quot;BUMP&quot;   =&gt; sub { $count += shift  }, </span>
<span class="cp">        &quot;RESET&quot;  =&gt; sub { $count = $start  },</span>
<span class="cp">    }; </span>
<span class="cp">    $bundle-&gt;{&quot;LAST&quot;} = $bundle-&gt;{&quot;PREV&quot;}; </span>
<span class="cp">    return $bundle;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN616"
>Creating References to Methods</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">$mref = sub { $obj-&gt;meth(@_) }; </span>
<span class="cp"># later...  </span>
<span class="cp">$mref-&gt;(&quot;args&quot;, &quot;go&quot;, &quot;here&quot;);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$sref = \$obj-&gt;meth;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$cref = $obj-&gt;can(&quot;meth&quot;);</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN619"
>Constructing Records</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">$record = {</span>
<span class="cp">    NAME   =&gt; &quot;Jason&quot;,</span>
<span class="cp">    EMPNO  =&gt; 132,</span>
<span class="cp">    TITLE  =&gt; &quot;deputy peon&quot;,</span>
<span class="cp">    AGE    =&gt; 23,</span>
<span class="cp">    SALARY =&gt; 37_000,</span>
<span class="cp">    PALS   =&gt; [ &quot;Norbert&quot;, &quot;Rhys&quot;, &quot;Phineas&quot;],</span>
<span class="cp">};</span>

<span class="cp">printf &quot;I am %s, and my pals are %s.\n&quot;,</span>
<span class="cp">    $record-&gt;{NAME},</span>
<span class="cp">    join(&quot;, &quot;, @{$record-&gt;{PALS}});</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># store record</span>
<span class="cp">$byname{ $record-&gt;{NAME} } = $record;</span>

<span class="cp"># later on, look up by name</span>
<span class="cp">if ($rp = $byname{&quot;Aron&quot;}) {        # false if missing</span>
<span class="cp">    printf &quot;Aron is employee %d.\n&quot;, $rp-&gt;{EMPNO};</span>
<span class="cp">}</span>

<span class="cp"># give jason a new pal</span>
<span class="cp">push @{$byname{&quot;Jason&quot;}-&gt;{PALS}}, &quot;Theodore&quot;;</span>
<span class="cp">printf &quot;Jason now has %d pals\n&quot;, scalar @{$byname{&quot;Jason&quot;}-&gt;{PALS}};</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># Go through all records</span>
<span class="cp">while (($name, $record) = each %byname) {</span>
<span class="cp">    printf &quot;%s is employee number %d\n&quot;, $name, $record-&gt;{EMPNO};</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># store record</span>
<span class="cp">$employees[ $record-&gt;{EMPNO} ] = $record;</span>

<span class="cp"># lookup by id</span>
<span class="cp">if ($rp = $employee[132]) {</span>
<span class="cp">    printf &quot;employee number 132 is %s\n&quot;, $rp-&gt;{NAME};</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$byname{&quot;Jason&quot;}-&gt;{SALARY} *= 1.035;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">@peons   = grep { $_-&gt;{TITLE} =~ /peon/i } @employees;</span>
<span class="cp">@tsevens = grep { $_-&gt;{AGE}   == 27 }      @employees;</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># Go through all records</span>
<span class="cp">foreach $rp (sort { $a-&gt;{AGE} &lt;=&gt; $b-&gt;{AGE} } values %byname) {</span>
<span class="cp">    printf &quot;%s is age %d.\n&quot;, $rp-&gt;{NAME}, $rp-&gt;{AGE};</span>
<span class="cp">    # or with a hash slice on the reference</span>
<span class="cp">    printf &quot;%s is employee number %d.\n&quot;, @$rp{&#39;NAME&#39;,&#39;EMPNO&#39;};</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># use @byage, an array of arrays of records</span>
<span class="cp">push @{ $byage[ $record-&gt;{AGE} ] }, $record;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">for ($age = 0; $age &lt;= $#byage; $age++) {</span>
<span class="cp">    next unless $byage[$age];</span>
<span class="cp">    print &quot;Age $age: &quot;;</span>
<span class="cp">    foreach $rp (@{$byage[$age]}) {</span>
<span class="cp">        print $rp-&gt;{NAME}, &quot; &quot;;</span>
<span class="cp">    }</span>
<span class="cp">    print &quot;\n&quot;;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">for ($age = 0; $age &lt;= $#byage; $age++) {</span>
<span class="cp">    next unless $byage[$age];</span>
<span class="cp">    printf &quot;Age %d: %s\n&quot;, $age,</span>
<span class="cp">        join(&quot;, &quot;, map {$_-&gt;{NAME}} @{$byage[$age]});</span>

<span class="cp">}</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN622"
>Reading and Writing Hash Records to Text Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">FieldName: Value</span>
<span class="cp">#-----------------------------</span>
<span class="cp">foreach $record (@Array_of_Records) { </span>
<span class="cp">    for $key (sort keys %$record) {</span>
<span class="cp">        print &quot;$key: $record-&gt;{$key}\n&quot;;</span>
<span class="cp">    } </span>
<span class="cp">    print &quot;\n&quot;;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$/ = &quot;&quot;;                # paragraph read mode</span>
<span class="cp">while (&lt;&gt;) {</span>
<span class="cp">    my @fields = split /^([^:]+):\s*/m;</span>
<span class="cp">    shift @fields;      # for leading null field</span>
<span class="cp">    push(@Array_of_Records, { map /(.*)/, @fields });</span>
<span class="cp">} </span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN625"
>Printing Data Structures</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">DB&lt;1&gt; $reference = [ { &quot;foo&quot; =&gt; &quot;bar&quot; }, 3, sub { print &quot;hello, world\n&quot; } ];</span>
<span class="cp">DB&lt;2&gt; x $reference</span>
<span class="cp">  0  ARRAY(0x1d033c)</span>

<span class="cp">    0  HASH(0x7b390)</span>

<span class="cp">       &#39;foo&#39; = &#39;bar&#39;&gt;</span>

<span class="cp">    1  3</span>

<span class="cp">    2  CODE(0x21e3e4)</span>

<span class="cp">       - &amp; in ???&gt;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Data::Dumper;</span>
<span class="cp">print Dumper($reference);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">D&lt;1&gt; x \@INC</span>
<span class="cp">  0  ARRAY(0x807d0a8)</span>

<span class="cp">     0  &#39;/home/tchrist/perllib&#39; </span>

<span class="cp">     1  &#39;/usr/lib/perl5/i686-linux/5.00403&#39;</span>

<span class="cp">     2  &#39;/usr/lib/perl5&#39; </span>

<span class="cp">     3  &#39;/usr/lib/perl5/site_perl/i686-linux&#39; </span>

<span class="cp">     4  &#39;/usr/lib/perl5/site_perl&#39; </span>

<span class="cp">     5  &#39;.&#39;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">{ package main; require &quot;dumpvar.pl&quot; } </span>
<span class="cp">*dumpvar = \&amp;main::dumpvar if __PACKAGE__ ne &#39;main&#39;;</span>
<span class="cp">dumpvar(&quot;main&quot;, &quot;INC&quot;);             # show both @INC and %INC</span>
<span class="cp">#-----------------------------</span>
<span class="cp">@INC = (</span>

<span class="cp">   0  &#39;/home/tchrist/perllib/i686-linux&#39;</span>

<span class="cp">   1  &#39;/home/tchrist/perllib&#39;</span>

<span class="cp">   2  &#39;/usr/lib/perl5/i686-linux/5.00404&#39;</span>

<span class="cp">   3  &#39;/usr/lib/perl5&#39;</span>

<span class="cp">   4  &#39;/usr/lib/perl5/site_perl/i686-linux&#39;</span>

<span class="cp">   5  &#39;/usr/lib/perl5/site_perl&#39;</span>

<span class="cp">   6  &#39;.&#39;</span>

<span class="cp">)</span>

<span class="cp">%INC = (</span>

<span class="cp">   &#39;dumpvar.pl&#39; = &#39;/usr/lib/perl5/i686-linux/5.00404/dumpvar.pl&#39;</span>

<span class="cp">   &#39;strict.pm&#39; = &#39;/usr/lib/perl5/i686-linux/5.00404/strict.pm&#39;</span>

<span class="cp">)</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Data::Dumper; </span>
<span class="cp">print Dumper(\@INC); </span>
<span class="cp">$VAR1 = [</span>

<span class="cp">      &#39;/home/tchrist/perllib&#39;, </span>

<span class="cp">      &#39;/usr/lib/perl5/i686-linux/5.00403&#39;,</span>

<span class="cp">      &#39;/usr/lib/perl5&#39;, </span>

<span class="cp">      &#39;/usr/lib/perl5/site_perl/i686-linux&#39;,</span>

<span class="cp">      &#39;/usr/lib/perl5/site_perl&#39;, </span>

<span class="cp">      &#39;.&#39;</span>

<span class="cp">];</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN628"
>Copying Data Structures</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use Storable;</span>

<span class="cp">$r2 = dclone($r1);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">@original = ( \@a, \@b, \@c );</span>
<span class="cp">@surface = @original;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">@deep = map { [ @$_ ] } @original;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Storable qw(dclone); </span>
<span class="cp">$r2 = dclone($r1);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">%newhash = %{ dclone(\%oldhash) };</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN631"
>Storing Data Structures to Disk</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use Storable; </span>
<span class="cp">store(\%hash, &quot;filename&quot;);</span>

<span class="cp"># later on...  </span>
<span class="cp">$href = retrieve(&quot;filename&quot;);        # by ref</span>
<span class="cp">%hash = %{ retrieve(&quot;filename&quot;) };   # direct to hash</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Storable qw(nstore); </span>
<span class="cp">nstore(\%hash, &quot;filename&quot;); </span>
<span class="cp"># later ...  </span>
<span class="cp">$href = retrieve(&quot;filename&quot;);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Storable qw(nstore_fd);</span>
<span class="cp">use Fcntl qw(:DEFAULT :flock);</span>
<span class="cp">sysopen(DF, &quot;/tmp/datafile&quot;, O_RDWR|O_CREAT, 0666) </span>
<span class="cp">    or die &quot;can&#39;t open /tmp/datafile: $!&quot;;</span>
<span class="cp">flock(DF, LOCK_EX)           or die &quot;can&#39;t lock /tmp/datafile: $!&quot;;</span>
<span class="cp">nstore_fd(\%hash, *DF)</span>
<span class="cp">    or die &quot;can&#39;t store hash\n&quot;;</span>
<span class="cp">truncate(DF, tell(DF));</span>
<span class="cp">close(DF);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Storable;</span>
<span class="cp">use Fcntl qw(:DEFAULT :flock);</span>
<span class="cp">open(DF, &quot;&lt; /tmp/datafile&quot;)      or die &quot;can&#39;t open /tmp/datafile: $!&quot;;</span>
<span class="cp">flock(DF, LOCK_SH)               or die &quot;can&#39;t lock /tmp/datafile: $!&quot;;</span>
<span class="cp">$href = retrieve(*DF);</span>
<span class="cp">close(DF);</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN634"
>Transparently Persistent Data Structures</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use MLDBM qw(DB_File);</span>
<span class="cp">use Fcntl;                            </span>

<span class="cp">tie(%hash, &#39;MLDBM&#39;, &#39;testfile.db&#39;, O_CREAT|O_RDWR, 0666)</span>
<span class="cp">    or die &quot;can&#39;t open tie to testfile.db: $!&quot;;</span>

<span class="cp"># ... act on %hash</span>

<span class="cp">untie %hash;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use MLDBM qw(DB_File);</span>
<span class="cp">use Fcntl;                            </span>
<span class="cp">tie(%hash, &#39;MLDBM&#39;, &#39;testfile.db&#39;, O_CREAT|O_RDWR, 0666)</span>
<span class="cp">    or die &quot;can&#39;t open tie to testfile.db: $!&quot;;</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># this doesn&#39;t work!</span>
<span class="cp">$hash{&quot;some key&quot;}[4] = &quot;fred&quot;;</span>

<span class="cp"># RIGHT</span>
<span class="cp">$aref = $hash{&quot;some key&quot;};</span>
<span class="cp">$aref-&gt;[4] = &quot;fred&quot;;</span>
<span class="cp">$hash{&quot;some key&quot;} = $aref;</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN637"
>Program: Binary Trees</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch11/bintree</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl -w</span>
<span class="cp"># bintree - binary tree demo program</span>
<span class="cp">use strict;</span>
<span class="cp">my($root, $n);</span>

<span class="cp"># first generate 20 random inserts</span>
<span class="cp">while ($n++ &lt; 20) { insert($root, int(rand(1000)) }</span>

<span class="cp"># now dump out the tree all three ways</span>
<span class="cp">print &quot;Pre order:  &quot;;  pre_order($root);  print &quot;\n&quot;;</span>
<span class="cp">print &quot;In order:   &quot;;  in_order($root);   print &quot;\n&quot;;</span>
<span class="cp">print &quot;Post order: &quot;;  post_order($root); print &quot;\n&quot;;</span>

<span class="cp"># prompt until EOF</span>
<span class="cp">for (print &quot;Search? &quot;; &lt;&gt;; print &quot;Search? &quot;) { </span>
<span class="cp">    chomp;</span>
<span class="cp">    my $found = search($root, $_);</span>
<span class="cp">    if ($found) { print &quot;Found $_ at $found, $found-&gt;{VALUE}\n&quot; }</span>
<span class="cp">    else        { print &quot;No $_ in tree\n&quot; }</span>
<span class="cp">}</span>

<span class="cp">exit;</span>

<span class="cp">#########################################</span>

<span class="cp"># insert given value into proper point of</span>
<span class="cp"># provided tree.  If no tree provided, </span>
<span class="cp"># use implicit pass by reference aspect of @_</span>
<span class="cp"># to fill one in for our caller.</span>
<span class="cp">sub insert {</span>
<span class="cp">    my($tree, $value) = @_;</span>
<span class="cp">    unless ($tree) {</span>
<span class="cp">        $tree = {};                         # allocate new node</span>
<span class="cp">        $tree-&gt;{VALUE}  = $value;</span>
<span class="cp">        $tree-&gt;{LEFT}   = undef;</span>
<span class="cp">        $tree-&gt;{RIGHT}  = undef;</span>
<span class="cp">        $_[0] = $tree;              # $_[0] is reference param!</span>
<span class="cp">        return;</span>
<span class="cp">    }</span>
<span class="cp">    if    ($tree-&gt;{VALUE} &gt; $value) { insert($tree-&gt;{LEFT},  $value) }</span>
<span class="cp">    elsif ($tree-&gt;{VALUE} &lt; $value) { insert($tree-&gt;{RIGHT}, $value) }</span>
<span class="cp">    else                            { warn &quot;dup insert of $value\n&quot;  }</span>
<span class="cp">                                    # XXX: no dups</span>
<span class="cp">}</span>

<span class="cp"># recurse on left child, </span>
<span class="cp"># then show current value, </span>
<span class="cp"># then recurse on right child.</span>
<span class="cp">sub in_order {</span>
<span class="cp">    my($tree) = @_;</span>
<span class="cp">    return unless $tree;</span>
<span class="cp">    in_order($tree-&gt;{LEFT});</span>
<span class="cp">    print $tree-&gt;{VALUE}, &quot; &quot;;</span>
<span class="cp">    in_order($tree-&gt;{RIGHT});</span>
<span class="cp">}</span>

<span class="cp"># show current value, </span>
<span class="cp"># then recurse on left child, </span>
<span class="cp"># then recurse on right child.</span>
<span class="cp">sub pre_order {</span>
<span class="cp">    my($tree) = @_;</span>
<span class="cp">    return unless $tree;</span>
<span class="cp">    print $tree-&gt;{VALUE}, &quot; &quot;;</span>
<span class="cp">    pre_order($tree-&gt;{LEFT});</span>
<span class="cp">    pre_order($tree-&gt;{RIGHT});</span>
<span class="cp">}</span>

<span class="cp"># recurse on left child, </span>
<span class="cp"># then recurse on right child,</span>
<span class="cp"># then show current value. </span>
<span class="cp">sub post_order {</span>
<span class="cp">    my($tree) = @_;</span>
<span class="cp">    return unless $tree;</span>
<span class="cp">    post_order($tree-&gt;{LEFT});</span>
<span class="cp">    post_order($tree-&gt;{RIGHT});</span>
<span class="cp">    print $tree-&gt;{VALUE}, &quot; &quot;;</span>
<span class="cp">}</span>

<span class="cp"># find out whether provided value is in the tree.</span>
<span class="cp"># if so, return the node at which the value was found.</span>
<span class="cp"># cut down search time by only looking in the correct</span>
<span class="cp"># branch, based on current value.</span>
<span class="cp">sub search {</span>
<span class="cp">    my($tree, $value) = @_;</span>
<span class="cp">    return unless $tree;</span>
<span class="cp">    if ($tree-&gt;{VALUE} == $value) {</span>
<span class="cp">        return $tree;</span>
<span class="cp">    }</span>
<span class="cp">    search($tree-&gt;{ ($value &lt; $tree-&gt;{VALUE}) ? &quot;LEFT&quot; : &quot;RIGHT&quot;}, $value)</span>
<span class="cp">}</span>

<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="subroutines.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="packagesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Subroutines</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Packages, Libraries, and Modules</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>