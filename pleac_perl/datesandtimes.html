<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Dates and Times</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Perl"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Numbers"
HREF="numbers.html"><LINK
REL="NEXT"
TITLE="Arrays"
HREF="arrays.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Perl</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="numbers.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="arrays.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DATESANDTIMES"
>3. Dates and Times</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN132"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">$sec</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$min</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$hours</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$mday</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$month</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$year</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$wday</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$yday</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$isdst</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#Fri Apr 11 09:27:08 1997</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># using arrays</span>
<span class="cp">print &quot;Today is day &quot;, (localtime)[7], &quot; of the current year.\n&quot;;</span>
<span class="cp"># Today is day 117 of the current year.</span>

<span class="cp"># using Time::tm objects</span>
<span class="cp">use Time::localtime;</span>
<span class="cp">$tm = localtime;</span>
<span class="cp">print &quot;Today is day &quot;, $tm-&gt;yday, &quot; of the current year.\n&quot;;</span>
<span class="cp"># Today is day 117 of the current year.</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN135"
>Finding Today's Date</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">($DAY, $MONTH, $YEAR) = (localtime)[3,4,5];</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Time::localtime;</span>
<span class="cp">$tm = localtime;</span>
<span class="cp">($DAY, $MONTH, $YEAR) = ($tm-&gt;mday, $tm-&gt;mon, $tm-&gt;year);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">($day, $month, $year) = (localtime)[3,4,5];</span>
<span class="cp">printf(&quot;The current date is %04d %02d %02d\n&quot;, $year+1900, $month+1, $day);</span>
<span class="cp"># The current date is 1998 04 28</span>
<span class="cp">#-----------------------------</span>
<span class="cp">($day, $month, $year) = (localtime)[3..5];</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Time::localtime;</span>
<span class="cp">$tm = localtime;</span>
<span class="cp">printf(&quot;The current date is %04d-%02d-%02d\n&quot;, $tm-&gt;year+1900, </span>
<span class="cp">    ($tm-&gt;mon)+1, $tm-&gt;mday);</span>
<span class="cp"># The current date is 1998-04-28</span>
<span class="cp">#-----------------------------</span>
<span class="cp">printf(&quot;The current date is %04d-%02d-%02d\n&quot;,</span>
<span class="cp">       sub {($_[5]+1900, $_[4]+1, $_[3])}-&gt;(localtime));</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use POSIX qw(strftime);</span>
<span class="cp">print strftime &quot;%Y-%m-%d\n&quot;, localtime;</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN138"
>Converting DMYHMS to Epoch Seconds</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use Time::Local;</span>
<span class="cp">$TIME = timelocal($sec, $min, $hours, $mday, $mon, $year);</span>
<span class="cp">$TIME = timegm($sec, $min, $hours, $mday, $mon, $year);</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># $hours, $minutes, and $seconds represent a time today,</span>
<span class="cp"># in the current time zone</span>
<span class="cp">use Time::Local;</span>
<span class="cp">$time = timelocal($seconds, $minutes, $hours, (localtime)[3,4,5]);</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># $day is day in month (1-31)</span>
<span class="cp"># $month is month in year (1-12)</span>
<span class="cp"># $year is four-digit year e.g., 1967</span>
<span class="cp"># $hours, $minutes and $seconds represent UTC time </span>
<span class="cp">use Time::Local;</span>
<span class="cp">$time = timegm($seconds, $minutes, $hours, $day, $month-1, $year-1900);</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN141"
>Converting Epoch Seconds to DMYHMS</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">($seconds, $minutes, $hours, $day_of_month, $month, $year,</span>
<span class="cp">    $wday, $yday, $isdst) = localtime($time);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Time::localtime;        # or Time::gmtime</span>
<span class="cp">$tm = localtime($TIME);     # or gmtime($TIME)</span>
<span class="cp">$seconds = $tm-&gt;sec;</span>
<span class="cp"># ...</span>
<span class="cp">#-----------------------------</span>
<span class="cp">($seconds, $minutes, $hours, $day_of_month, $month, $year,</span>
<span class="cp">    $wday, $yday, $isdst) = localtime($time);</span>
<span class="cp">printf(&quot;Dateline: %02d:%02d:%02d-%04d/%02d/%02d\n&quot;,</span>
<span class="cp">    $hours, $minutes, $seconds, $year+1900, $month+1,</span>
<span class="cp">    $day_of_month);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Time::localtime;</span>
<span class="cp">$tm = localtime($time);</span>
<span class="cp">printf(&quot;Dateline: %02d:%02d:%02d-%04d/%02d/%02d\n&quot;,</span>
<span class="cp">    $tm-&gt;hour, $tm-&gt;min, $tm-&gt;sec, $tm-&gt;year+1900,</span>
<span class="cp">    $tm-&gt;mon+1, $tm-&gt;mday);</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN144"
>Adding to or Subtracting from a Date</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">$when = $now + $difference;</span>
<span class="cp">$then = $now - $difference;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Date::Calc qw(Add_Delta_Days);</span>
<span class="cp">($y2, $m2, $d2) = Add_Delta_Days($y, $m, $d, $offset);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Date::Calc qw(Add_Delta_DHMS);</span>
<span class="cp">($year2, $month2, $day2, $h2, $m2, $s2) = </span>
<span class="cp">    Add_Delta_DHMS( $year, $month, $day, $hour, $minute, $second,</span>
<span class="cp">                $days_offset, $hour_offset, $minute_offset, $second_offset );</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$birthtime = 96176750;                  # 18/Jan/1973, 3:45:50 am</span>
<span class="cp">$interval = 5 +                         # 5 seconds</span>
<span class="cp">            17 * 60 +                   # 17 minutes</span>
<span class="cp">            2  * 60 * 60 +              # 2 hours</span>
<span class="cp">            55 * 60 * 60 * 24;          # and 55 days</span>
<span class="cp">$then = $birthtime + $interval;</span>
<span class="cp">print &quot;Then is &quot;, scalar(localtime($then)), &quot;\n&quot;;</span>
<span class="cp"># Then is Wed Mar 14 06:02:55 1973</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Date::Calc qw(Add_Delta_DHMS);</span>
<span class="cp">($year, $month, $day, $hh, $mm, $ss) = Add_Delta_DHMS(</span>
<span class="cp">    1973, 1, 18, 3, 45, 50, # 18/Jan/1973, 3:45:50 am</span>
<span class="cp">             55, 2, 17, 5); # 55 days, 2 hrs, 17 min, 5 sec</span>
<span class="cp">print &quot;To be precise: $hh:$mm:$ss, $month/$day/$year\n&quot;;</span>
<span class="cp"># To be precise: 6:2:55, 3/14/1973</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Date::Calc qw(Add_Delta_Days);</span>
<span class="cp">($year, $month, $day) = Add_Delta_Days(1973, 1, 18, 55);</span>
<span class="cp">print &quot;Nat was 55 days old on: $month/$day/$year\n&quot;;</span>
<span class="cp"># Nat was 55 days old on: 3/14/1973</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN147"
>Difference of Two Dates</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">$seconds = $recent - $earlier;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Date::Calc qw(Delta_Days);</span>
<span class="cp">$days = Delta_Days( $year1, $month1, $day1, $year2, $month2, $day2);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Date::Calc qw(Delta_DHMS);</span>
<span class="cp">($days, $hours, $minutes, $seconds) =</span>
<span class="cp">  Delta_DHMS( $year1, $month1, $day1, $hour1, $minute1, $seconds1,  # earlier</span>
<span class="cp">              $year2, $month2, $day2, $hour2, $minute2, $seconds2); # later</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$bree = 361535725;          # 16 Jun 1981, 4:35:25</span>
<span class="cp">$nat  =  96201950;          # 18 Jan 1973, 3:45:50</span>

<span class="cp">$difference = $bree - $nat;</span>
<span class="cp">print &quot;There were $difference seconds between Nat and Bree\n&quot;;</span>
<span class="cp"># There were 265333775 seconds between Nat and Bree</span>


<span class="cp">$seconds    =  $difference % 60;</span>
<span class="cp">$difference = ($difference - $seconds) / 60;</span>
<span class="cp">$minutes    =  $difference % 60;</span>
<span class="cp">$difference = ($difference - $minutes) / 60;</span>
<span class="cp">$hours      =  $difference % 24;</span>
<span class="cp">$difference = ($difference - $hours)   / 24;</span>
<span class="cp">$days       =  $difference % 7;</span>
<span class="cp">$weeks      = ($difference - $days)    /  7;</span>

<span class="cp">print &quot;($weeks weeks, $days days, $hours:$minutes:$seconds)\n&quot;;</span>
<span class="cp"># (438 weeks, 4 days, 23:49:35)</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Date::Calc qw(Delta_Days);</span>
<span class="cp">@bree = (1981, 6, 16);      # 16 Jun 1981</span>
<span class="cp">@nat  = (1973, 1, 18);      # 18 Jan 1973</span>
<span class="cp">$difference = Delta_Days(@nat, @bree);</span>
<span class="cp">print &quot;There were $difference days between Nat and Bree\n&quot;;</span>
<span class="cp"># There were 3071 days between Nat and Bree</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Date::Calc qw(Delta_DHMS);</span>
<span class="cp">@bree = (1981, 6, 16, 4, 35, 25);   # 16 Jun 1981, 4:35:25</span>
<span class="cp">@nat  = (1973, 1, 18, 3, 45, 50);   # 18 Jan 1973, 3:45:50</span>
<span class="cp">@diff = Delta_DHMS(@nat, @bree);</span>
<span class="cp">print &quot;Bree came $diff[0] days, $diff[1]:$diff[2]:$diff[3] after Nat\n&quot;;</span>
<span class="cp"># Bree came 3071 days, 0:49:35 after Nat</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN150"
>Day in a Week/Month/Year or Week Number</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">($MONTHDAY, $WEEKDAY, $YEARDAY) = (localtime $DATE)[3,6,7];</span>
<span class="cp">$WEEKNUM = int($YEARDAY / 7) + 1;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Date::Calc qw(Day_of_Week Week_Number Day_of_Year);</span>
<span class="cp"># you have $year, $month, and $day</span>
<span class="cp"># $day is day of month, by definition.</span>
<span class="cp">$wday = Day_of_Week($year, $month, $day);</span>
<span class="cp">$wnum = Week_Number($year, $month, $day);</span>
<span class="cp">$dnum = Day_of_Year($year, $month, $day);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Date::Calc qw(Day_of_Week Week_Number Day_of_Week_to_Text)</span>

<span class="cp">$year  = 1981;</span>
<span class="cp">$month = 6;         # (June)</span>
<span class="cp">$day   = 16;</span>

<span class="cp">$wday = Day_of_Week($year, $month, $day);</span>
<span class="cp">print &quot;$month/$day/$year was a &quot;, Day_of_Week_to_Text($wday), &quot;\n&quot;;</span>
<span class="cp">## see comment above</span>

<span class="cp">$wnum = Week_Number($year, $month, $day);</span>
<span class="cp">print &quot;in the $wnum week.\n&quot;;</span>
<span class="cp"># 6/16/1981 was a Tuesday</span>
<span class="cp"># </span>
<span class="cp"># in week number 25.</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN153"
>Parsing Dates and Times from Strings</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use Time::Local;</span>
<span class="cp"># $date is &quot;1998-06-03&quot; (YYYY-MM-DD form).</span>
<span class="cp">($yyyy, $mm, $dd) = $date =~ /(\d+)-(\d+)-(\d+)/;</span>
<span class="cp"># calculate epoch seconds at midnight on that day in this timezone</span>
<span class="cp">$epoch_seconds = timelocal(0, 0, 0, $dd, $mm, $yyyy);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Date::Manip qw(ParseDate UnixDate);</span>
<span class="cp">$date = ParseDate($string);</span>
<span class="cp">if (!$date) {</span>
<span class="cp">    # bad date</span>
<span class="cp">} else {</span>
<span class="cp">    @values = UnixDate($date, @formats);</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Date::Manip qw(ParseDate UnixDate);</span>

<span class="cp">while (&lt;&gt;) {</span>
<span class="cp">    $date = ParseDate($_);</span>
<span class="cp">    if (!$date) {</span>
<span class="cp">        warn &quot;Bad date string: $_\n&quot;;</span>
<span class="cp">        next;</span>
<span class="cp">    } else {</span>
<span class="cp">        ($year, $month, $day) = UnixDate($date, &quot;%Y&quot;, &quot;%m&quot;, &quot;%d&quot;);</span>
<span class="cp">        print &quot;Date was $month/$day/$year\n&quot;;</span>
<span class="cp">    }</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN156"
>Printing a Date</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">$STRING = localtime($EPOCH_SECONDS);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use POSIX qw(strftime);</span>
<span class="cp">$STRING = strftime($FORMAT, $SECONDS, $MINUTES, $HOUR,</span>
<span class="cp">                   $DAY_OF_MONTH, $MONTH, $YEAR, $WEEKDAY,</span>
<span class="cp">                   $YEARDAY, $DST);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Date::Manip qw(UnixDate);</span>
<span class="cp">$STRING = UnixDate($DATE, $FORMAT);</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># Sun Sep 21 15:33:36 1997</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Time::Local;</span>
<span class="cp">$time = timelocal(50, 45, 3, 18, 0, 73);</span>
<span class="cp">print &quot;Scalar localtime gives: &quot;, scalar(localtime($time)), &quot;\n&quot;;</span>
<span class="cp"># Scalar localtime gives: Thu Jan 18 03:45:50 1973</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use POSIX qw(strftime);</span>
<span class="cp">use Time::Local;</span>
<span class="cp">$time = timelocal(50, 45, 3, 18, 0, 73);</span>
<span class="cp">print &quot;strftime gives: &quot;, strftime(&quot;%A %D&quot;, localtime($time)), &quot;\n&quot;;</span>
<span class="cp"># strftime gives: Thursday 01/18/73</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Date::Manip qw(ParseDate UnixDate);</span>
<span class="cp">$date = ParseDate(&quot;18 Jan 1973, 3:45:50&quot;);</span>
<span class="cp">$datestr = UnixDate($date, &quot;%a %b %e %H:%M:%S %z %Y&quot;);    # as scalar</span>
<span class="cp">print &quot;Date::Manip gives: $datestr\n&quot;;</span>
<span class="cp"># Date::Manip gives: Thu Jan 18 03:45:50 GMT 1973</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN159"
>High-Resolution Timers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use Time::HiRes qw(gettimeofday);</span>
<span class="cp">$t0 = gettimeofday;</span>
<span class="cp">## do your operation here</span>
<span class="cp">$t1 = gettimeofday;</span>
<span class="cp">$elapsed = $t1 - $t0;</span>
<span class="cp"># $elapsed is a floating point value, representing number</span>
<span class="cp"># of seconds between $t0 and $t1</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Time::HiRes qw(gettimeofday);</span>
<span class="cp">print &quot;Press return when ready: &quot;;</span>
<span class="cp">$before = gettimeofday;</span>
<span class="cp">$line = &lt;&gt;;</span>
<span class="cp">$elapsed = gettimeofday-$before;</span>
<span class="cp">print &quot;You took $elapsed seconds.\n&quot;;</span>
<span class="cp"># Press return when ready: </span>
<span class="cp"># </span>
<span class="cp"># You took 0.228149 seconds.</span>
<span class="cp">#-----------------------------</span>
<span class="cp">require &#39;sys/syscall.ph&#39;;</span>

<span class="cp"># initialize the structures returned by gettimeofday</span>
<span class="cp">$TIMEVAL_T = &quot;LL&quot;;</span>
<span class="cp">$done = $start = pack($TIMEVAL_T, ());</span>

<span class="cp"># prompt</span>
<span class="cp">print &quot;Press return when ready: &quot;;</span>

<span class="cp"># read the time into $start</span>
<span class="cp">syscall(&amp;SYS_gettimeofday, $start, 0) != -1</span>
<span class="cp">           || die &quot;gettimeofday: $!&quot;;</span>

<span class="cp"># read a line</span>
<span class="cp">$line = &lt;&gt;;</span>

<span class="cp"># read the time into $done</span>
<span class="cp">syscall(&amp;SYS_gettimeofday, $done, 0) != -1</span>
<span class="cp">       || die &quot;gettimeofday: $!&quot;;</span>

<span class="cp"># expand the structure</span>
<span class="cp">@start = unpack($TIMEVAL_T, $start);</span>
<span class="cp">@done  = unpack($TIMEVAL_T, $done);</span>

<span class="cp"># fix microseconds</span>
<span class="cp">for ($done[1], $start[1]) { $_ /= 1_000_000 }</span>
<span class="cp">    </span>
<span class="cp"># calculate time difference</span>
<span class="cp">$delta_time = sprintf &quot;%.4f&quot;, ($done[0]  + $done[1]  )</span>
<span class="cp">                                         -</span>
<span class="cp">                              ($start[0] + $start[1] );</span>

<span class="cp">print &quot;That took $delta_time seconds\n&quot;;</span>
<span class="cp"># Press return when ready: </span>
<span class="cp"># </span>
<span class="cp"># That took 0.3037 seconds</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Time::HiRes qw(gettimeofday);</span>
<span class="cp"># take mean sorting time</span>
<span class="cp">$size = 500;</span>
<span class="cp">$number_of_times = 100;</span>
<span class="cp">$total_time = 0;</span>

<span class="cp">for ($i = 0; $i &lt; $number_of_times; $i++) {</span>
<span class="cp">    my (@array, $j, $begin, $time);</span>
<span class="cp">    # populate array</span>
<span class="cp">    @array = ();</span>
<span class="cp">    for ($j=0; $j&lt;$size; $j++) { push(@array, rand) }</span>

<span class="cp">    # sort it</span>
<span class="cp">    $begin = gettimeofday;</span>
<span class="cp">    @array = sort { $a &lt;=&gt; $b } @array;</span>
<span class="cp">    $time = gettimeofday-$begin;</span>
<span class="cp">    $total_time += $time;</span>
<span class="cp">}</span>

<span class="cp">printf &quot;On average, sorting %d random numbers takes %.5f seconds\n&quot;,</span>
<span class="cp">    $size, ($total_time/$number_of_times);</span>
<span class="cp"># On average, sorting 500 random numbers takes 0.02821 seconds</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN162"
>Short Sleeps</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">select(undef, undef, undef, $time_to_sleep);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Time::HiRes qw(sleep);</span>
<span class="cp">sleep($time_to_sleep);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">while (&lt;&gt;) {</span>
<span class="cp">    select(undef, undef, undef, 0.25);</span>
<span class="cp">    print;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Time::HiRes qw(sleep);</span>
<span class="cp">while (&lt;&gt;) {</span>
<span class="cp">    sleep(0.25);</span>
<span class="cp">    print;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN165"
>Program: hopdelta</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use Date::Manip qw(ParseDate DateCalc);</span>
<span class="cp">$d1 = ParseDate(&quot;Tue, 26 May 1998 23:57:38 -0400&quot;);</span>
<span class="cp">$d2 = ParseDate(&quot;Wed, 27 May 1998 05:04:03 +0100&quot;);</span>
<span class="cp">print DateCalc($d1, $d2);</span>
<span class="cp"># +0:0:0:0:0:6:25</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch03/hopdelta</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl</span>
<span class="cp"># hopdelta - feed mail header, produce lines</span>
<span class="cp">#            showing delay at each hop.</span>
<span class="cp">use strict;</span>
<span class="cp">use Date::Manip qw (ParseDate UnixDate);</span>

<span class="cp"># print header; this should really use format/write due to</span>
<span class="cp"># printf complexities</span>
<span class="cp">printf &quot;%-20.20s %-20.20s %-20.20s   %s\n&quot;, </span>
<span class="cp">        &quot;Sender&quot;, &quot;Recipient&quot;, &quot;Time&quot;, &quot;Delta&quot;;</span>
<span class="cp">$/ = &#39;&#39;;                # paragraph mode</span>
<span class="cp">$_ = &lt;&gt;;                # read header</span>
<span class="cp">s/\n\s+/ /g;            # join continuation lines</span>

<span class="cp"># calculate when and where this started</span>
<span class="cp">my($start_from) = /^From.*\@([^\s&gt;]*)/m;</span>
<span class="cp">my($start_date) = /^Date:\s+(.*)/m;</span>
<span class="cp">my $then = getdate($start_date);</span>
<span class="cp">printf &quot;%-20.20s %-20.20s %s\n&quot;, &#39;Start&#39;, $start_from, fmtdate($then);</span>

<span class="cp">my $prevfrom = $start_from;</span>

<span class="cp"># now process the headers lines from the bottom up</span>
<span class="cp">for (reverse split(/\n/)) {</span>
<span class="cp">    my ($delta, $now, $from, $by, $when);</span>
<span class="cp">    next unless /^Received:/;</span>
<span class="cp">    s/\bon (.*?) (id.*)/; $1/s;         # qmail header, I think</span>
<span class="cp">    unless (($when) = /;\s+(.*)$/) {    # where the date falls</span>
<span class="cp">        warn &quot;bad received line: $_&quot;;</span>
<span class="cp">        next;</span>
<span class="cp">    }</span>
<span class="cp">    ($from) = /from\s+(\S+)/;           </span>
<span class="cp">    ($from) = /\((.*?)\)/ unless $from; # some put it here</span>
<span class="cp">    $from =~ s/\)$//;                   # someone was too greedy</span>
<span class="cp">    ($by)   = /by\s+(\S+\.\S+)/;        # who sent it on this hop</span>

<span class="cp">    # now random mungings to get their string parsable</span>
<span class="cp">    for ($when) {</span>
<span class="cp">        s/ (for|via) .*$//;</span>
<span class="cp">        s/([+-]\d\d\d\d) \(\S+\)/$1/;</span>
<span class="cp">        s/id \S+;\s*//;</span>
<span class="cp">    }</span>
<span class="cp">    next unless $now = getdate($when);          # convert to Epoch</span>
<span class="cp">    $delta = $now - $then;</span>

<span class="cp">    printf &quot;%-20.20s %-20.20s %s  &quot;, $from, $by, fmtdate($now);</span>
<span class="cp">    $prevfrom = $by;</span>
<span class="cp">    puttime($delta);</span>
<span class="cp">    $then = $now;               </span>
<span class="cp">}</span>

<span class="cp">exit;</span>

<span class="cp"># convert random date strings into Epoch seconds</span>
<span class="cp">sub getdate {</span>
<span class="cp">    my $string     =  shift;</span>
<span class="cp">    $string        =~ s/\s+\(.*\)\s*$//;        # remove nonstd tz</span>
<span class="cp">    my $date       =  ParseDate($string);</span>
<span class="cp">    my $epoch_secs =  UnixDate($date,&quot;%s&quot;);</span>
<span class="cp">    return $epoch_secs;</span>
<span class="cp">}</span>

<span class="cp"># convert Epoch seconds into a particular date string</span>
<span class="cp">sub fmtdate {</span>
<span class="cp">    my $epoch = shift;</span>
<span class="cp">    my($sec,$min,$hour,$mday,$mon,$year) = localtime($epoch);</span>
<span class="cp">    return sprintf &quot;%02d:%02d:%02d %04d/%02d/%02d&quot;,</span>
<span class="cp">    		$hour, $min, $sec,</span>
<span class="cp">    		$year + 1900, $mon + 1, $mday,</span>
<span class="cp">}</span>

<span class="cp"># take seconds and print in pleasant-to-read format</span>
<span class="cp">sub puttime {</span>
<span class="cp">    my($seconds) = shift;</span>
<span class="cp">    my($days, $hours, $minutes);</span>
<span class="cp">    $days    = pull_count($seconds, 24 * 60 * 60);</span>
<span class="cp">    $hours   = pull_count($seconds, 60 * 60);</span>
<span class="cp">    $minutes = pull_count($seconds, 60);</span>
<span class="cp">    put_field(&#39;s&#39;, $seconds);</span>
<span class="cp">    put_field(&#39;m&#39;, $minutes);</span>
<span class="cp">    put_field(&#39;h&#39;, $hours);</span>
<span class="cp">    put_field(&#39;d&#39;, $days);</span>
<span class="cp">    print &quot;\n&quot;;</span>
<span class="cp">}</span>

<span class="cp"># usage: $count = pull_count(seconds, amount)</span>
<span class="cp"># remove from seconds the amount quantity, altering caller&#39;s version.</span>
<span class="cp"># return the integral number of those amounts so removed.</span>
<span class="cp">sub pull_count {</span>
<span class="cp">    my($answer) = int($_[0] / $_[1]);</span>
<span class="cp">    $_[0] -= $answer * $_[1];</span>
<span class="cp">    return $answer;</span>
<span class="cp">}</span>

<span class="cp"># usage: put_field(char, number)</span>
<span class="cp"># output number field in 3-place decimal format, with trailing char</span>
<span class="cp"># suppress output unless char is &#39;s&#39; for seconds</span>
<span class="cp">sub put_field {</span>
<span class="cp">    my ($char, $number) = @_;</span>
<span class="cp">    printf &quot; %3d%s&quot;, $number, $char if $number || $char eq &#39;s&#39;;</span>
<span class="cp">}</span>

<span class="cp">#-----------------------------</span>
<span class="cp"># Sender               Recipient            Time                   Delta</span>
<span class="cp"># </span>
<span class="cp"># Start                wall.org             09:17:12 1998/05/23</span>
<span class="cp"># </span>
<span class="cp"># wall.org             mail.brainstorm.net  09:20:56 1998/05/23    44s   3m</span>
<span class="cp"># </span>
<span class="cp"># mail.brainstorm.net  jhereg.perl.com      09:20:58 1998/05/23     2s</span>
<span class="cp">#  </span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="numbers.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="arrays.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Numbers</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Arrays</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>