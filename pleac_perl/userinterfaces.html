<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>User Interfaces</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Perl"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Database Access"
HREF="dbaccess.html"><LINK
REL="NEXT"
TITLE="Process Management and Communication"
HREF="processmanagementetc.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Perl</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="dbaccess.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="processmanagementetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="USERINTERFACES"
>15. User Interfaces</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN792"
>Parsing Program Arguments</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use Getopt::Std;</span>

<span class="cp"># -v ARG, -D ARG, -o ARG, sets $opt_v, $opt_D, $opt_o</span>
<span class="cp">getopt(&quot;vDo&quot;);              </span>
<span class="cp"># -v ARG, -D ARG, -o ARG, sets $args{v}, $args{D}, $args{o}</span>
<span class="cp">getopt(&quot;vDo&quot;, \%args);</span>

<span class="cp">getopts(&quot;vDo:&quot;);         # -v, -D, -o ARG, sets $opt_v, $opt_D, $opt_o</span>
<span class="cp">getopts(&quot;vDo:&quot;, \%args); # -v, -D, -o ARG, sets $args{v}, $args{D}, $args{o}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Getopt::Long;</span>

<span class="cp">GetOptions( &quot;verbose&quot;  =&gt; \$verbose,     # --verbose</span>
<span class="cp">            &quot;Debug&quot;    =&gt; \$debug,       # --Debug</span>
<span class="cp">            &quot;output=s&quot; =&gt; \$output );    # --output=string or --output=string</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% rm -r -f /tmp/testdir</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% rm -rf /tmp/testdir</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Getopt::Std;</span>
<span class="cp">getopts(&quot;o:&quot;);</span>
<span class="cp">if ($opt_o) {</span>
<span class="cp">    print &quot;Writing output to $opt_o&quot;;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Getopt::Std;</span>

<span class="cp">%option = ();</span>
<span class="cp">getopts(&quot;Do:&quot;, \%option);</span>

<span class="cp">if ($option{D}) {</span>
<span class="cp">    print &quot;Debugging mode enabled.\n&quot;;</span>
<span class="cp">}</span>

<span class="cp"> # if not set, set output to &quot;-&quot;.  opening &quot;-&quot; for writing</span>
<span class="cp"> # means STDOUT</span>
<span class="cp"> $option{o} = &quot;-&quot; unless defined $option{o};</span>
<span class="cp">                             </span>
<span class="cp">print &quot;Writing output to file $option{o}\n&quot; unless $option{o} eq &quot;-&quot;;</span>
<span class="cp">open(STDOUT, &quot;&gt; $option{o}&quot;)</span>
<span class="cp">     or die &quot;Can&#39;t open $option{o} for output: $!\n&quot;;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% gnutar --extract --file latest.tar</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% gnutar --extract --file=latest.tar</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Getopt::Long;</span>

<span class="cp">GetOptions( &quot;extract&quot; =&gt; \$extract,</span>
<span class="cp">            &quot;file=s&quot;  =&gt; \$file );</span>

<span class="cp">if ($extract) {</span>
<span class="cp">    print &quot;I&#39;m extracting.\n&quot;;</span>
<span class="cp">}</span>

<span class="cp">die &quot;I wish I had a file&quot; unless defined $file;</span>
<span class="cp">print &quot;Working on the file $file\n&quot;;</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN795"
>Testing Whether a Program Is Running Interactively</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">sub I_am_interactive {</span>
<span class="cp">    return -t STDIN &amp;&amp; -t STDOUT;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use POSIX qw/getpgrp tcgetpgrp/;</span>

<span class="cp">sub I_am_interactive {</span>
<span class="cp">    local *TTY;  # local file handle</span>
<span class="cp">    open(TTY, &quot;/dev/tty&quot;) or die &quot;can&#39;t open /dev/tty: $!&quot;;</span>
<span class="cp">    my $tpgrp = tcgetpgrp(fileno(TTY));</span>
<span class="cp">    my $pgrp  = getpgrp();</span>
<span class="cp">    close TTY;</span>
<span class="cp">    return ($tpgrp == $pgrp);</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">while (1) {</span>
<span class="cp">    if (I_am_interactive()) {</span>
<span class="cp">        print &quot;Prompt: &quot;;</span>
<span class="cp">    }</span>
<span class="cp">    $line = &lt;STDIN&gt;;</span>
<span class="cp">    last unless defined $line; </span>
<span class="cp">    # do something with the line</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">sub prompt { print &quot;Prompt: &quot; if I_am_interactive() }</span>
<span class="cp">for (prompt(); $line = &lt;STDIN&gt;; prompt()) {</span>
<span class="cp">    # do something with the line</span>
<span class="cp">} </span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN798"
>Clearing the Screen</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use Term::Cap;</span>

<span class="cp">$OSPEED = 9600;</span>
<span class="cp">eval {</span>
<span class="cp">    require POSIX;</span>
<span class="cp">    my $termios = POSIX::Termios-&gt;new();</span>
<span class="cp">    $termios-&gt;getattr;</span>
<span class="cp">    $OSPEED = $termios-&gt;getospeed;</span>
<span class="cp">};</span>

<span class="cp">$terminal = Term::Cap-&gt;Tgetent({OSPEED=&gt;$OSPEED});</span>
<span class="cp">$terminal-&gt;Tputs(&#39;cl&#39;, 1, STDOUT);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">system(&quot;clear&quot;);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$clear = $terminal-&gt;Tputs(&#39;cl&#39;);</span>
<span class="cp">$clear = `clear`;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">print $clear;</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN801"
>Determining Terminal or Window Size</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use Term::ReadKey;</span>

<span class="cp">($wchar, $hchar, $wpixels, $hpixels) = GetTerminalSize();</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Term::ReadKey;</span>

<span class="cp">($width) = GetTerminalSize();</span>
<span class="cp">die &quot;You must have at least 10 characters&quot; unless $width &gt;= 10;</span>

<span class="cp">$max = 0;</span>
<span class="cp">foreach (@values) {</span>
<span class="cp">    $max = $_ if $max &lt; $_;</span>
<span class="cp">}</span>

<span class="cp">$ratio = ($width-10)/$max;          # chars per unit</span>
<span class="cp">foreach (@values) {</span>
<span class="cp">    printf(&quot;%8.1f %s\n&quot;, $_, &quot;*&quot; x ($ratio*$_));</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN804"
>Changing Text Color</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use Term::ANSIColor;</span>

<span class="cp">print color(&quot;red&quot;), &quot;Danger, Will Robinson!\n&quot;, color(&quot;reset&quot;);</span>
<span class="cp">print &quot;This is just normal text.\n&quot;;</span>
<span class="cp">print colored(&quot;&lt;BLINK&gt;Do you hurt yet?&lt;/BLINK&gt;&quot;, &quot;blink&quot;);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Term::ANSIColor qw(:constants);</span>

<span class="cp">print RED, &quot;Danger, Will Robinson!\n&quot;, RESET;</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># rhyme for the deadly coral snake</span>
<span class="cp">print color(&quot;red on_black&quot;),  &quot;venom lack\n&quot;;</span>
<span class="cp">print color(&quot;red on_yellow&quot;), &quot;kill that fellow\n&quot;;</span>

<span class="cp">print color(&quot;green on_cyan blink&quot;), &quot;garish!\n&quot;;</span>
<span class="cp">print color(&quot;reset&quot;);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">print colored(&quot;venom lack\n&quot;, &quot;red&quot;, &quot;on_black&quot;);</span>
<span class="cp">print colored(&quot;kill that fellow\n&quot;, &quot;red&quot;, &quot;on_yellow&quot;);</span>

<span class="cp">print colored(&quot;garish!\n&quot;, &quot;green&quot;, &quot;on_cyan&quot;, &quot;blink&quot;);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Term::ANSIColor qw(:constants);</span>

<span class="cp">print BLACK, ON_WHITE, &quot;black on white\n&quot;;</span>
<span class="cp">print WHITE, ON_BLACK, &quot;white on black\n&quot;;</span>
<span class="cp">print GREEN, ON_CYAN, BLINK, &quot;garish!\n&quot;;</span>
<span class="cp">print RESET;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">END { print color(&quot;reset&quot;) }</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$Term::ANSIColor::EACHLINE = $/;</span>
<span class="cp">print colored(&lt;&lt;EOF, RED, ON_WHITE, BOLD, BLINK);</span>
<span class="cp">This way</span>
<span class="cp">each line</span>
<span class="cp">has its own</span>
<span class="cp">attribute set.</span>
<span class="cp">EOF</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN807"
>Reading from the Keyboard</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use Term::ReadKey;</span>

<span class="cp">ReadMode(&#39;cbreak&#39;);</span>
<span class="cp">$key = ReadKey(0);</span>
<span class="cp">ReadMode(&#39;normal&#39;);</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch15/sascii</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl -w</span>
<span class="cp"># sascii - Show ASCII values for keypresses</span>

<span class="cp">use Term::ReadKey;</span>
<span class="cp">ReadMode(&#39;cbreak&#39;);</span>
<span class="cp">print &quot;Press keys to see their ASCII values.  Use Ctrl-C to quit.\n&quot;;</span>

<span class="cp">while (1) {</span>
<span class="cp">    $char = ReadKey(0);</span>
<span class="cp">    last unless defined $char;</span>
<span class="cp">    printf(&quot; Decimal: %d\tHex: %x\n&quot;, ord($char), ord($char));</span>
<span class="cp">}</span>

<span class="cp">ReadMode(&#39;normal&#39;);</span>

<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN810"
>Ringing the Terminal Bell</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">print &quot;\aWake up!\n&quot;;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Term::Cap;</span>

<span class="cp">$OSPEED = 9600;</span>
<span class="cp">eval {</span>
<span class="cp">    require POSIX;</span>
<span class="cp">    my $termios = POSIX::Termios-&gt;new();</span>
<span class="cp">    $termios-&gt;getattr;</span>
<span class="cp">    $OSPEED = $termios-&gt;getospeed;</span>
<span class="cp">};</span>

<span class="cp">$terminal = Term::Cap-&gt;Tgetent({OSPEED=&gt;$OSPEED});</span>
<span class="cp">$vb = &quot;&quot;;</span>
<span class="cp">eval {</span>
<span class="cp">    $terminal-&gt;Trequire(&quot;vb&quot;);</span>
<span class="cp">    $vb = $terminal-&gt;Tputs(&#39;vb&#39;, 1);</span>
<span class="cp">};</span>

<span class="cp">print $vb;                                  # ring visual bell</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN813"
>Using POSIX termios</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch15/demo</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl -w</span>
<span class="cp"># demo POSIX termios</span>

<span class="cp">use POSIX qw(:termios_h);</span>

<span class="cp">$term = POSIX::Termios-&gt;new;</span>
<span class="cp">$term-&gt;getattr(fileno(STDIN));</span>

<span class="cp">$erase = $term-&gt;getcc(VERASE);</span>
<span class="cp">$kill = $term-&gt;getcc(VKILL);</span>
<span class="cp">printf &quot;Erase is character %d, %s\n&quot;, $erase, uncontrol(chr($erase));</span>
<span class="cp">printf &quot;Kill is character %d, %s\n&quot;, $kill, uncontrol(chr($kill));</span>

<span class="cp">$term-&gt;setcc(VERASE, ord(&#39;#&#39;));</span>
<span class="cp">$term-&gt;setcc(VKILL, ord(&#39;@&#39;));</span>
<span class="cp">$term-&gt;setattr(1, TCSANOW);</span>

<span class="cp">print(&quot;erase is #, kill is @; type something: &quot;);</span>
<span class="cp">$line = &lt;STDIN&gt;;</span>
<span class="cp">print &quot;You typed: $line&quot;;</span>

<span class="cp">$term-&gt;setcc(VERASE, $erase);</span>
<span class="cp">$term-&gt;setcc(VKILL, $kill);</span>
<span class="cp">$term-&gt;setattr(1, TCSANOW);</span>

<span class="cp">sub uncontrol {</span>
<span class="cp">    local $_ = shift;</span>
<span class="cp">    s/([\200-\377])/sprintf(&quot;M-%c&quot;,ord($1) &amp; 0177)/eg;</span>
<span class="cp">    s/([\0-\37\177])/sprintf(&quot;^%c&quot;,ord($1) ^ 0100)/eg;</span>
<span class="cp">    return $_;</span>
<span class="cp">} </span>

<span class="cp">#-----------------------------</span>
<span class="cp"># HotKey.pm</span>
<span class="cp">package HotKey;</span>

<span class="cp">@ISA = qw(Exporter);</span>
<span class="cp">@EXPORT = qw(cbreak cooked readkey);</span>

<span class="cp">use strict;</span>
<span class="cp">use POSIX qw(:termios_h);</span>
<span class="cp">my ($term, $oterm, $echo, $noecho, $fd_stdin);</span>

<span class="cp">$fd_stdin = fileno(STDIN);</span>
<span class="cp">$term     = POSIX::Termios-&gt;new();</span>
<span class="cp">$term-&gt;getattr($fd_stdin);</span>
<span class="cp">$oterm     = $term-&gt;getlflag();</span>

<span class="cp">$echo     = ECHO | ECHOK | ICANON;</span>
<span class="cp">$noecho   = $oterm &amp; ~$echo;</span>

<span class="cp">sub cbreak {</span>
<span class="cp">    $term-&gt;setlflag($noecho);  # ok, so i don&#39;t want echo either</span>
<span class="cp">    $term-&gt;setcc(VTIME, 1);</span>
<span class="cp">    $term-&gt;setattr($fd_stdin, TCSANOW);</span>
<span class="cp">}</span>

<span class="cp">sub cooked {</span>
<span class="cp">    $term-&gt;setlflag($oterm);</span>
<span class="cp">    $term-&gt;setcc(VTIME, 0);</span>
<span class="cp">    $term-&gt;setattr($fd_stdin, TCSANOW);</span>
<span class="cp">}</span>

<span class="cp">sub readkey {</span>
<span class="cp">    my $key = &#39;&#39;;</span>
<span class="cp">    cbreak();</span>
<span class="cp">    sysread(STDIN, $key, 1);</span>
<span class="cp">    cooked();</span>
<span class="cp">    return $key;</span>
<span class="cp">}</span>

<span class="cp">END { cooked() }</span>

<span class="cp">1;</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN816"
>Checking for Waiting Input</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use Term::ReadKey;</span>

<span class="cp">ReadMode (&#39;cbreak&#39;);</span>

<span class="cp">if (defined ($char = ReadKey(-1)) ) {</span>
<span class="cp">    # input was waiting and it was $char</span>
<span class="cp">} else {</span>
<span class="cp">    # no input was waiting</span>
<span class="cp">}</span>

<span class="cp">ReadMode (&#39;normal&#39;);                  # restore normal tty settings</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN819"
>Reading Passwords</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use Term::ReadKey;</span>

<span class="cp">ReadMode(&#39;noecho&#39;);</span>
<span class="cp">$password = ReadLine(0);</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch15/checkuser</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl -w</span>
<span class="cp"># checkuser - demonstrates reading and checking a user&#39;s password</span>

<span class="cp">use Term::ReadKey;</span>

<span class="cp">print &quot;Enter your password: &quot;;</span>
<span class="cp">ReadMode &#39;noecho&#39;;</span>
<span class="cp">$password = ReadLine 0;</span>
<span class="cp">chomp $password;</span>
<span class="cp">ReadMode &#39;normal&#39;;</span>

<span class="cp">print &quot;\n&quot;;</span>

<span class="cp">($username, $encrypted) = ( getpwuid $&lt; )[0,1];</span>

<span class="cp">if (crypt($password, $encrypted) ne $encrypted) {</span>
<span class="cp">    die &quot;You are not $username\n&quot;;</span>
<span class="cp">} else {</span>
<span class="cp">    print &quot;Welcome, $username\n&quot;;</span>
<span class="cp">}</span>

<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN822"
>Editing Input</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use Term::ReadLine;</span>

<span class="cp">$term = Term::ReadLine-&gt;new(&quot;APP DESCRIPTION&quot;);</span>
<span class="cp">$OUT = $term-&gt;OUT || *STDOUT;</span>

<span class="cp">$term-&gt;addhistory($fake_line);</span>
<span class="cp">$line = $term-&gt;readline(PROMPT);</span>

<span class="cp">print $OUT &quot;Any program output\n&quot;;</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch15/vbsh</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl -w</span>
<span class="cp"># vbsh -  very bad shell</span>
<span class="cp">use strict;</span>

<span class="cp">use Term::ReadLine;</span>
<span class="cp">use POSIX qw(:sys_wait_h);</span>

<span class="cp">my $term = Term::ReadLine-&gt;new(&quot;Simple Shell&quot;);</span>
<span class="cp">my $OUT = $term-&gt;OUT() || *STDOUT;</span>
<span class="cp">my $cmd;</span>

<span class="cp">while (defined ($cmd = $term-&gt;readline(&#39;$ &#39;) )) {</span>
<span class="cp">    my @output = `$cmd`;</span>
<span class="cp">    my $exit_value  = $? &gt;&gt; 8;</span>
<span class="cp">    my $signal_num  = $? &amp; 127;</span>
<span class="cp">    my $dumped_core = $? &amp; 128;</span>
<span class="cp">    printf $OUT &quot;Program terminated with status %d from signal %d%s\n&quot;,</span>
<span class="cp">           $exit_value, $signal_num, </span>
<span class="cp">           $dumped_core ? &quot; (core dumped)&quot; : &quot;&quot;;</span>
<span class="cp">    print @output;</span>
<span class="cp">    $term-&gt;addhistory($seed_line);</span>
<span class="cp">}</span>

<span class="cp">#-----------------------------</span>
<span class="cp">$term-&gt;addhistory($seed_line);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$term-&gt;remove_history($line_number);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">@history = $term-&gt;GetHistory;</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN825"
>Managing the Screen</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">#% rep ps aux</span>
<span class="cp">#% rep netstat</span>
<span class="cp">#% rep -2.5 lpq</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch15/rep</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl -w</span>
<span class="cp"># rep - screen repeat command</span>
<span class="cp">use strict;</span>
<span class="cp">use Curses;</span>

<span class="cp">my $timeout = 10;</span>
<span class="cp">if (@ARGV &amp;&amp; $ARGV[0] =~ /^-(\d+\.?\d*)$/) { </span>
<span class="cp">    $timeout = $1; </span>
<span class="cp">    shift; </span>
<span class="cp">} </span>

<span class="cp">die &quot;usage: $0 [ -timeout ] cmd args\n&quot; unless @ARGV;</span>
<span class="cp">    </span>
<span class="cp">initscr();          # start screen</span>
<span class="cp">noecho();           </span>
<span class="cp">cbreak(); </span>
<span class="cp">nodelay(1);         # so getch() is non-blocking</span>

<span class="cp">$SIG{INT} = sub { done(&quot;Ouch!&quot;) };</span>
<span class="cp">sub done { endwin(); print &quot;@_\n&quot;; exit; }</span>

<span class="cp">while (1) {</span>
<span class="cp">    while ((my $key = getch()) ne ERR) {    # maybe multiple keys</span>
<span class="cp">        done(&quot;See ya&quot;) if $key eq &#39;q&#39; </span>
<span class="cp">    }</span>
<span class="cp">    my @data = `(@ARGV) 2&gt;&amp;1`;              # gather output+errors</span>
<span class="cp">    for (my $i = 0; $i &lt; $LINES; $i++) {</span>
<span class="cp">        addstr($i, 0, $data[$i] || &#39; &#39; x $COLS);</span>
<span class="cp">    } </span>

<span class="cp">    standout();</span>
<span class="cp">    addstr($LINES-1, $COLS - 24, scalar localtime);</span>
<span class="cp">    standend();</span>

<span class="cp">    move(0,0); </span>
<span class="cp">    refresh();                              # flush new output to display</span>

<span class="cp">    my ($in, $out) = (&#39;&#39;, &#39;&#39;);</span>
<span class="cp">    vec($in,fileno(STDIN),1) = 1;           # look for key on stdin </span>
<span class="cp">    select($out = $in,undef,undef,$timeout);# wait up to this long</span>
<span class="cp">}</span>

<span class="cp">#-----------------------------</span>
<span class="cp">keypad(1);                  # enable keypad mode</span>
<span class="cp">$key = getch();</span>
<span class="cp">if ($key eq &#39;k&#39;     ||      # vi mode</span>
<span class="cp">    $key eq &quot;\cP&quot;   ||      # emacs mode</span>
<span class="cp">    $key eq KEY_UP)         # arrow mode</span>
<span class="cp">{</span>
<span class="cp">    # do something</span>
<span class="cp">} </span>
<span class="cp">#-----------------------------</span>
<span class="cp">#		       Template Entry Demonstration </span>
<span class="cp">#</span>
<span class="cp">#   Address Data Example                                     Record # ___</span>
<span class="cp">#</span>
<span class="cp">#   Name: [________________________________________________]</span>
<span class="cp">#   Addr: [________________________________________________]</span>
<span class="cp">#   City: [__________________]          State: [__]       Zip: [\\\\\] </span>
<span class="cp">#</span>
<span class="cp">#   Phone: (\\\) \\\-\\\\                            Password: [^^^^^^^^]</span>
<span class="cp">#</span>
<span class="cp">#   Enter all information available.</span>
<span class="cp">#   Edit fields with left/right arrow keys or &quot;delete&quot;.</span>
<span class="cp">#   Switch fields with &quot;Tab&quot; or up/down arrow keys.</span>
<span class="cp">#   Indicate completion by pressing &quot;Return&quot;.</span>
<span class="cp">#   Refresh screen with &quot;Control-L&quot;.</span>
<span class="cp">#   Abort this demo here with &quot;Control-X&quot;.</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN828"
>Controlling Another Program with Expect</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use Expect;</span>

<span class="cp">$command = Expect-&gt;spawn(&quot;program to run&quot;)</span>
<span class="cp">    or die &quot;Couldn&#39;t start program: $!\n&quot;;</span>

<span class="cp"># prevent the program&#39;s output from being shown on our STDOUT</span>
<span class="cp">$command-&gt;log_stdout(0);</span>

<span class="cp"># wait 10 seconds for &quot;Password:&quot; to appear</span>
<span class="cp">unless ($command-&gt;expect(10, &quot;Password&quot;)) {</span>
<span class="cp">    # timed out</span>
<span class="cp">}</span>

<span class="cp"># wait 20 seconds for something that matches /[lL]ogin: ?/</span>
<span class="cp">unless ($command-&gt;expect(20, -re =&gt; &#39;[lL]ogin: ?&#39;)) {</span>
<span class="cp">    # timed out</span>
<span class="cp">}</span>

<span class="cp"># wait forever for &quot;invalid&quot; to appear</span>
<span class="cp">unless ($command-&gt;expect(undef, &quot;invalid&quot;)) {</span>
<span class="cp">    # error occurred; the program probably went away</span>
<span class="cp">}</span>

<span class="cp"># send &quot;Hello, world&quot; and a carriage return to the program</span>
<span class="cp">print $command &quot;Hello, world\r&quot;;</span>

<span class="cp"># if the program will terminate by itself, finish up with</span>
<span class="cp">$command-&gt;soft_close();</span>
<span class="cp">    </span>
<span class="cp"># if the program must be explicitly killed, finish up with</span>
<span class="cp">$command-&gt;hard_close();</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$which = $command-&gt;expect(30, &quot;invalid&quot;, &quot;succes&quot;, &quot;error&quot;, &quot;boom&quot;);</span>
<span class="cp">if ($which) {</span>
<span class="cp">    # found one of those strings</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN831"
>Creating Menus with Tk</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use Tk;</span>

<span class="cp">$main = MainWindow-&gt;new();</span>

<span class="cp"># Create a horizontal space at the top of the window for the</span>
<span class="cp"># menu to live in.</span>
<span class="cp">$menubar = $main-&gt;Frame(-relief              =&gt; &quot;raised&quot;,</span>
<span class="cp">                        -borderwidth         =&gt; 2)</span>
<span class="cp">                -&gt;pack (-anchor              =&gt; &quot;nw&quot;,</span>
<span class="cp">                        -fill                =&gt; &quot;x&quot;);</span>

<span class="cp"># Create a button labeled &quot;File&quot; that brings up a menu</span>
<span class="cp">$file_menu = $menubar-&gt;Menubutton(-text      =&gt; &quot;File&quot;,</span>
<span class="cp">                                  -underline =&gt; 1)</span>
<span class="cp">                     -&gt;pack      (-side      =&gt; &quot;left&quot; );</span>
<span class="cp"># Create entries in the &quot;File&quot; menu</span>
<span class="cp">$file_menu-&gt;command(-label   =&gt; &quot;Print&quot;,</span>
<span class="cp">                    -command =&gt; \&amp;Print);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$file_menu = $menubar-&gt;Menubutton(-text     =&gt; &quot;File&quot;,</span>
<span class="cp">                                 -underline =&gt; 1,</span>
<span class="cp">                                 -menuitems =&gt; [</span>
<span class="cp">              [ Button =&gt; &quot;Print&quot;,-command  =&gt; \&amp;Print ],</span>
<span class="cp">               [ Button =&gt; &quot;Save&quot;,-command  =&gt; \&amp;Save  ] ])</span>
<span class="cp">                           -&gt;pack(-side     =&gt; &quot;left&quot;);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">    $file_menu-&gt;command(-label   =&gt; &quot;Quit Immediately&quot;,</span>
<span class="cp">                        -command =&gt; sub { exit } );</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$file_menu-&gt;separator();</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$options_menu-&gt;checkbutton(-label    =&gt; &quot;Create Debugging File&quot;,</span>
<span class="cp">                           -variable =&gt; \$debug,</span>
<span class="cp">                           -onvalue  =&gt; 1,</span>
<span class="cp">                           -offvalue =&gt; 0);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$debug_menu-&gt;radiobutton(-label    =&gt; &quot;Level 1&quot;,</span>
<span class="cp">                         -variable =&gt; \$log_level,</span>
<span class="cp">                         -value    =&gt; 1);</span>

<span class="cp">$debug_menu-&gt;radiobutton(-label    =&gt; &quot;Level 2&quot;,</span>
<span class="cp">                         -variable =&gt; \$log_level,</span>
<span class="cp">                         -value    =&gt; 2);</span>

<span class="cp">$debug_menu-&gt;radiobutton(-label    =&gt; &quot;Level 3&quot;,</span>
<span class="cp">                         -variable =&gt; \$log_level,</span>
<span class="cp">                         -value    =&gt; 3);</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># step 1: create the cascading menu entry</span>
<span class="cp">$format_menu-&gt;cascade          (-label    =&gt; &quot;Font&quot;);</span>

<span class="cp"># step 2: get the new Menu we just made</span>
<span class="cp">$font_menu = $format_menu-&gt;cget(&quot;-menu&quot;);</span>

<span class="cp"># step 3: populate that Menu</span>
<span class="cp">$font_menu-&gt;radiobutton        (-label    =&gt; &quot;Courier&quot;,</span>
<span class="cp">                                -variable =&gt; \$font_name,</span>
<span class="cp">                                -value    =&gt; &quot;courier&quot;);</span>
<span class="cp">$font_menu-&gt;radiobutton        (-label    =&gt; &quot;Times Roman&quot;,</span>
<span class="cp">                                -variable =&gt; \$font_name,</span>
<span class="cp">                                -value    =&gt; &quot;times&quot;);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$format_menu = $menubar-&gt;Menubutton(-text      =&gt; &quot;Format&quot;,</span>
<span class="cp">                                    -underline =&gt; 1</span>
<span class="cp">                                    -tearoff   =&gt; 0)</span>
<span class="cp">                       -&gt;pack;</span>

<span class="cp">$font_menu  = $format_menu-&gt;cascade(-label     =&gt; &quot;Font&quot;,</span>
<span class="cp">                                    -tearoff   =&gt; 0);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">my $f = $menubar-&gt;Menubutton(-text =&gt; &quot;Edit&quot;, -underline =&gt; 0,</span>
<span class="cp">                              -menuitems =&gt;</span>
<span class="cp">    [</span>
<span class="cp">     [Button =&gt; &#39;Copy&#39;,        -command =&gt; \&amp;edit_copy ],</span>
<span class="cp">     [Button =&gt; &#39;Cut&#39;,         -command =&gt; \&amp;edit_cut ],</span>
<span class="cp">     [Button =&gt; &#39;Paste&#39;,       -command =&gt; \&amp;edit_paste  ],</span>
<span class="cp">     [Button =&gt; &#39;Delete&#39;,      -command =&gt; \&amp;edit_delete ],</span>
<span class="cp">     [Separator =&gt; &#39;&#39;],</span>
<span class="cp">     [Cascade =&gt; &#39;Object ...&#39;, -tearoff =&gt; 0,</span>
<span class="cp">                               -menuitems =&gt; [</span>
<span class="cp">        [ Button =&gt; &quot;Circle&quot;,  -command =&gt; \&amp;edit_circle ],</span>
<span class="cp">        [ Button =&gt; &quot;Square&quot;,  -command =&gt; \&amp;edit_square ],</span>
<span class="cp">        [ Button =&gt; &quot;Point&quot;,   -command =&gt; \&amp;edit_point ] ] ],</span>
<span class="cp">    ])-&gt;grid(-row =&gt; 0, -column =&gt; 0, -sticky =&gt; &#39;w&#39;);</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN834"
>Creating Dialog Boxes with Tk</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use Tk::DialogBox;</span>

<span class="cp">$dialog = $main-&gt;DialogBox( -title   =&gt; &quot;Register This Program&quot;,</span>
<span class="cp">                            -buttons =&gt; [ &quot;Register&quot;, &quot;Cancel&quot; ] );</span>

<span class="cp"># add widgets to the dialog box with $dialog-&gt;Add()</span>

<span class="cp"># later, when you need to display the dialog box</span>
<span class="cp">$button = $dialog-&gt;Show();</span>
<span class="cp">if ($button eq &quot;Register&quot;) {</span>
<span class="cp">    # ...</span>
<span class="cp">} elsif ($button eq &quot;Cancel&quot;) {</span>
<span class="cp">    # ...</span>
<span class="cp">} else {</span>
<span class="cp">    # this shouldn&#39;t happen</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch15/tksample3</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl -w</span>
<span class="cp"># tksample3 - demonstrate dialog boxes</span>

<span class="cp">use Tk;</span>
<span class="cp">use Tk::DialogBox;</span>

<span class="cp">$main = MainWindow-&gt;new();</span>

<span class="cp">$dialog = $main-&gt;DialogBox( -title   =&gt; &quot;Register&quot;,</span>
<span class="cp">                            -buttons =&gt; [ &quot;Register&quot;, &quot;Cancel&quot; ],</span>
<span class="cp">                           );</span>

<span class="cp"># the top part of the dialog box will let people enter their names,</span>
<span class="cp"># with a Label as a prompt</span>

<span class="cp">$dialog-&gt;add(&quot;Label&quot;, -text =&gt; &quot;Name&quot;)-&gt;pack();</span>
<span class="cp">$entry = $dialog-&gt;add(&quot;Entry&quot;, -width =&gt; 35)-&gt;pack();</span>

<span class="cp"># we bring up the dialog box with a button</span>
<span class="cp">$main-&gt;Button( -text    =&gt; &quot;Click Here For Registration Form&quot;,</span>
<span class="cp">               -command =&gt; \&amp;register)    -&gt;pack(-side =&gt; &quot;left&quot;);</span>
<span class="cp">$main-&gt;Button( -text    =&gt; &quot;Quit&quot;,</span>
<span class="cp">               -command =&gt; sub { exit } ) -&gt;pack(-side =&gt; &quot;left&quot;);</span>

<span class="cp">MainLoop;</span>

<span class="cp">#</span>
<span class="cp"># register</span>
<span class="cp">#</span>
<span class="cp"># Called to pop up the registration dialog box</span>
<span class="cp">#</span>

<span class="cp">sub register {</span>
<span class="cp">    my $button;</span>
<span class="cp">    my $done = 0;</span>

<span class="cp">    do {    </span>
<span class="cp">        # show the dialog</span>
<span class="cp">        $button = $dialog-&gt;Show;</span>

<span class="cp">        # act based on what button they pushed</span>
<span class="cp">        if ($button eq &quot;Register&quot;) {</span>
<span class="cp">                my $name = $entry-&gt;get;</span>

<span class="cp">            if (defined($name) &amp;&amp; length($name)) {</span>
<span class="cp">                print &quot;Welcome to the fold, $name\n&quot;;</span>
<span class="cp">                $done = 1;</span>
<span class="cp">            } else {</span>
<span class="cp">                print &quot;You didn&#39;t give me your name!\n&quot;;</span>
<span class="cp">            }</span>
<span class="cp">        } else {</span>
<span class="cp">            print &quot;Sorry you decided not to register.\n&quot;;</span>
<span class="cp">            $done = 1;</span>
<span class="cp">        }</span>
<span class="cp">    } until $done;</span>
<span class="cp">}</span>

<span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch15/tksample4</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl -w</span>
<span class="cp"># tksample4 - popup dialog boxes for warnings</span>

<span class="cp">use Tk;</span>
<span class="cp">use Tk::DialogBox;</span>

<span class="cp">my $main;</span>

<span class="cp"># set up a warning handler that displays the warning in a Tk dialog box</span>

<span class="cp">BEGIN {</span>
<span class="cp">    $SIG{_     _WARN_     _} = sub {</span>
<span class="cp">        if (defined $main) {</span>
<span class="cp">            my $dialog = $main-&gt;DialogBox( -title   =&gt; &quot;Warning&quot;,</span>
<span class="cp">                                           -buttons =&gt; [ &quot;Acknowledge&quot; ]);</span>
<span class="cp">            $dialog-&gt;add(&quot;Label&quot;, -text =&gt; $_[0])-&gt;pack;</span>
<span class="cp">            $dialog-&gt;Show;</span>
<span class="cp">        } else {</span>
<span class="cp">            print STDOUT join(&quot;\n&quot;, @_), &quot;n&quot;;</span>
<span class="cp">        }</span>
<span class="cp">    };</span>
<span class="cp">}</span>

<span class="cp"># your program goes here</span>

<span class="cp">$main = MainWindow-&gt;new();</span>

<span class="cp">$main-&gt;Button( -text   =&gt; &quot;Make A Warning&quot;,</span>
<span class="cp">               -command =&gt; \&amp;make_warning) -&gt;pack(-side =&gt; &quot;left&quot;);</span>
<span class="cp">$main-&gt;Button( -text   =&gt; &quot;Quit&quot;,</span>
<span class="cp">               -command =&gt; sub { exit } )  -&gt;pack(-side =&gt; &quot;left&quot;);</span>

<span class="cp">MainLoop;</span>

<span class="cp"># dummy subroutine to generate a warning</span>
<span class="cp">    </span>
<span class="cp">sub make_warning {</span>
<span class="cp">    my $a;</span>
<span class="cp">    my $b = 2 * $a;</span>
<span class="cp">}</span>

<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN837"
>Responding to Tk Resize Events</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use Tk;</span>

<span class="cp">$main = MainWindow-&gt;new();</span>

<span class="cp">$main-&gt;bind(&#39;&lt;Configure&gt;&#39; =&gt; sub {</span>
<span class="cp">    $xe = $main-&gt;XEvent;</span>
<span class="cp">    $main-&gt;maxsize($xe-&gt;w, $xe-&gt;h);</span>
<span class="cp">    $main-&gt;minsize($xe-&gt;w, $xe-&gt;h);</span>
<span class="cp">});</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$widget-&gt;pack( -fill =&gt; &quot;both&quot;, -expand =&gt; 1 );</span>
<span class="cp">$widget-&gt;pack( -fill =&gt; &quot;x&quot;,    -expand =&gt; 1 );</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$mainarea-&gt;pack( -fill =&gt; &quot;both&quot;, -expand =&gt; 1);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$menubar-&gt;pack( -fill =&gt; &quot;x&quot;, -expand =&gt; 1 );</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$menubar-&gt;pack (-fill     =&gt; &quot;x&quot;,</span>
<span class="cp">                -expand   =&gt; 1,</span>
<span class="cp">                -anchor   =&gt; &quot;nw&quot; );</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN840"
>Removing the DOS Shell Window with Windows Perl/Tk</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch15/loader</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl -w</span>
<span class="cp"># loader - starts Perl scripts without the annoying DOS window</span>
<span class="cp">use strict;</span>
<span class="cp">use Win32;</span>
<span class="cp">use Win32::Process;</span>

<span class="cp"># Create the process object.</span>

<span class="cp">Win32::Process::Create($Win32::Process::Create::ProcessObj,</span>
<span class="cp">    &#39;C:/perl5/bin/perl.exe&#39;,            # Whereabouts of Perl</span>
<span class="cp">    &#39;perl realprogram&#39;,                 #</span>
<span class="cp">    0,                                  # Don&#39;t inherit.</span>
<span class="cp">    DETACHED_PROCESS,                   #</span>
<span class="cp">    &quot;.&quot;) or                             # current dir.</span>
<span class="cp">die print_error();</span>

<span class="cp">sub print_error() {</span>
<span class="cp">    return Win32::FormatMessage( Win32::GetLastError() );</span>
<span class="cp">}</span>

<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN843"
>Program: Small termcap program</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch15/tcapdemo</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl -w</span>
<span class="cp"># tcapdemo - show off direct cursor placement</span>

<span class="cp">use POSIX;</span>
<span class="cp">use Term::Cap;</span>
<span class="cp">    </span>
<span class="cp">init();                     # Initialize Term::Cap.</span>
<span class="cp">zip();                      # Bounce lines around the screen.</span>
<span class="cp">finish();                   # Clean up afterward.</span>
<span class="cp">exit();</span>

<span class="cp"># Two convenience functions.  clear_screen is obvious, and</span>
<span class="cp"># clear_end clears to the end of the screen.</span>
<span class="cp">sub clear_screen { $tcap-&gt;Tputs(&#39;cl&#39;, 1, *STDOUT) } </span>
<span class="cp">sub clear_end    { $tcap-&gt;Tputs(&#39;cd&#39;, 1, *STDOUT) } </span>

<span class="cp"># Move the cursor to a particular location.</span>
<span class="cp">sub gotoxy {</span>
<span class="cp">    my($x, $y) = @_;</span>
<span class="cp">    $tcap-&gt;Tgoto(&#39;cm&#39;, $x, $y, *STDOUT);</span>
<span class="cp">} </span>

<span class="cp"># Get the terminal speed through the POSIX module and use that</span>
<span class="cp"># to initialize Term::Cap.</span>
<span class="cp">sub init { </span>
<span class="cp">    $| = 1;</span>
<span class="cp">    $delay = (shift() || 0) * 0.005;</span>
<span class="cp">    my $termios = POSIX::Termios-&gt;new();</span>
<span class="cp">    $termios-&gt;getattr;</span>
<span class="cp">    my $ospeed = $termios-&gt;getospeed;</span>
<span class="cp">    $tcap = Term::Cap-&gt;Tgetent ({ TERM =&gt; undef, OSPEED =&gt; $ospeed });</span>
<span class="cp">    $tcap-&gt;Trequire(qw(cl cm cd));</span>
<span class="cp">}</span>

<span class="cp"># Bounce lines around the screen until the user interrupts with</span>
<span class="cp"># Ctrl-C.</span>
<span class="cp">sub zip { </span>
<span class="cp">    clear_screen();</span>
<span class="cp">    ($maxrow, $maxcol) = ($tcap-&gt;{_li} - 1, $tcap-&gt;{_co} - 1);</span>

<span class="cp">    @chars = qw(* - / | \ _ );</span>
<span class="cp">    sub circle { push(@chars, shift @chars); }</span>

<span class="cp">    $interrupted = 0;</span>
<span class="cp">    $SIG{INT} = sub { ++$interrupted };</span>

<span class="cp">    $col = $row = 0;</span>
<span class="cp">    ($row_sign, $col_sign) = (1,1);</span>

<span class="cp">    do {</span>
<span class="cp">        gotoxy($col, $row);</span>
<span class="cp">        print $chars[0];</span>
<span class="cp">        select(undef, undef, undef, $delay);</span>

<span class="cp">        $row += $row_sign;</span>
<span class="cp">        $col += $col_sign;</span>

<span class="cp">        if    ($row == $maxrow) { $row_sign = -1; circle; } </span>
<span class="cp">        elsif ($row == 0 )      { $row_sign = +1; circle; }</span>

<span class="cp">        if    ($col == $maxcol) { $col_sign = -1; circle; } </span>
<span class="cp">        elsif ($col == 0 )      { $col_sign = +1; circle; }</span>
<span class="cp">    </span>
<span class="cp">    } until $interrupted;</span>

<span class="cp">}</span>

<span class="cp"># Clean up the screen.</span>
<span class="cp">sub finish { </span>
<span class="cp">    gotoxy(0, $maxrow);</span>
<span class="cp">    clear_end();</span>
<span class="cp">}</span>

<span class="cp">#-----------------------------</span>
<span class="cp">#*     _                       /     |                       \     -</span>
<span class="cp"># *   _ \                     - /   | /                     | \   - *</span>
<span class="cp">#  * _   \                   -   / |   /                   |   \ -   *</span>
<span class="cp">#   *     \                 -     |     /                 |     -     *</span>
<span class="cp">#  _ *     \               -     | /     /               |     - \     *</span>
<span class="cp"># _   *     \             -     |   /     /             |     -   \     *</span>
<span class="cp">#*     *     \           -     |     /     /           |     -     \     *</span>
<span class="cp"># *     *     \         -     |       /     /         |     -       \     *</span>
<span class="cp">#  *     *     \       -     |         /     /       |     -         \     *</span>
<span class="cp">#   *     *     \     -     |           /     /     |     -           \     *</span>
<span class="cp">#    *     *     \   -     |             /     /   |     -             \     *</span>
<span class="cp">#     *     *     \ -     |               /     / |     -               \     </span>
<span class="cp">#      *     -     \     |                 /     /     -                 \    </span>
<span class="cp">#	*   - *   - \   |                   /   | /   -                   \   </span>
<span class="cp">#	 * -   * -   \ |                     / |   / -                     \ _</span>
<span class="cp">#	  -     -     \                       |     /                       _</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN846"
>Program: tkshufflepod</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">#% tkshufflepod chap15.pod</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch15/tkshufflepod</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl -w</span>
<span class="cp"># tkshufflepod - reorder =head1 sections in a pod file</span>

<span class="cp">use Tk;</span>
<span class="cp">use strict;</span>

<span class="cp"># declare variables</span>

<span class="cp">my $podfile;    		 # name of the file to open</span>
<span class="cp">my $m;    			     # main window</span>
<span class="cp">my $l;    			     # listbox</span>
<span class="cp">my ($up, $down);   # positions to move</span>
<span class="cp">my @sections;      # list of pod sections</span>
<span class="cp">my $all_pod;       # text of pod file (used when reading)</span>

<span class="cp"># read the pod file into memory, and split it into sections.</span>

<span class="cp">$podfile = shift || &quot;-&quot;;</span>

<span class="cp">undef $/;</span>
<span class="cp">open(F, &quot;&lt; $podfile&quot;)</span>
<span class="cp">  or die &quot;Can&#39;t open $podfile : $!\n&quot;;</span>
<span class="cp">$all_pod = &lt;F&gt;;</span>
<span class="cp">close(F);</span>
<span class="cp">@sections = split(/(?==head1)/, $all_pod);</span>

<span class="cp"># turn @sections into an array of anonymous arrays.  The first element</span>
<span class="cp"># in each of these arrays is the original text of the message, while</span>
<span class="cp"># the second element is the text following =head1 (the section title).</span>

<span class="cp">foreach (@sections) {</span>
<span class="cp">    /(.*)/;</span>
<span class="cp">    $_ = [ $_, $1 ];</span>
<span class="cp">}</span>

<span class="cp"># fire up Tk and display the list of sections.</span>

<span class="cp">$m = MainWindow-&gt;new();</span>
<span class="cp">$l = $m-&gt;Listbox(&#39;-width&#39; =&gt; 60)-&gt;pack(&#39;-expand&#39; =&gt; 1, &#39;-fill&#39; =&gt; &#39;both&#39;);</span>

<span class="cp">foreach my $section (@sections) {</span>
<span class="cp">    $l-&gt;insert(&quot;end&quot;, $section-&gt;[1]);</span>
<span class="cp">}</span>

<span class="cp"># permit dragging by binding to the Listbox widget.</span>
<span class="cp">$l-&gt;bind( &#39;&lt;Any-Button&gt;&#39;     =&gt; \&amp;down );</span>
<span class="cp">$l-&gt;bind( &#39;&lt;Any-ButtonRelease&gt;&#39; =&gt; \&amp;up );</span>

<span class="cp"># permit viewing by binding double-click</span>
<span class="cp">$l-&gt;bind( &#39;&lt;Double-Button&gt;&#39;     =&gt; \&amp;view );</span>

<span class="cp"># &#39;q&#39; quits and &#39;s&#39; saves</span>
<span class="cp">$m-&gt;bind( &#39;&lt;q&gt;&#39;     	=&gt; sub { exit } );</span>
<span class="cp">$m-&gt;bind( &#39;&lt;s&gt;&#39;    		=&gt; \&amp;save );</span>

<span class="cp">MainLoop;</span>

<span class="cp"># down(widget): called when the user clicks on an item in the Listbox.</span>

<span class="cp">sub down {</span>
<span class="cp">    my $self = shift;</span>
<span class="cp">    $down = $self-&gt;curselection;;</span>
<span class="cp">}</span>

<span class="cp"># up(widget): called when the user releases the mouse button in the</span>
<span class="cp"># Listbox.</span>

<span class="cp">sub up {</span>
<span class="cp">    my $self = shift;</span>
<span class="cp">    my $elt;</span>

<span class="cp">    $up = $self-&gt;curselection;;</span>

<span class="cp">    return if $down == $up;</span>

<span class="cp">    # change selection list</span>
<span class="cp">    $elt = $sections[$down];</span>
<span class="cp">    splice(@sections, $down, 1);</span>
<span class="cp">    splice(@sections, $up, 0, $elt);</span>
<span class="cp">    $self-&gt;delete($down);</span>
<span class="cp">    $self-&gt;insert($up, $sections[$up]-&gt;[1]);</span>
<span class="cp">}</span>

<span class="cp"># save(widget): called to save the list of sections.</span>

<span class="cp">sub save {</span>
<span class="cp">    my $self = shift;</span>

<span class="cp">    open(F, &quot;&gt; $podfile&quot;)</span>
<span class="cp">      or die &quot;Can&#39;t open $podfile for writing: $!&quot;;</span>
<span class="cp">    print F map { $_-&gt;[0] } @sections;</span>
<span class="cp">    close F;</span>

<span class="cp">    exit;</span>
<span class="cp">}</span>

<span class="cp"># view(widget): called to display the widget.  Uses the Pod widget.</span>

<span class="cp">sub view {</span>
<span class="cp">    my $self = shift;</span>
<span class="cp">    my $temporary = &quot;/tmp/$$-section.pod&quot;;</span>
<span class="cp">    my $popup;</span>

<span class="cp">    open(F, &quot;&gt; $temporary&quot;)</span>
<span class="cp">      or warn (&quot;Can&#39;t open $temporary : $!\n&quot;), return;</span>
<span class="cp">    print F $sections[$down]-&gt;[0];</span>
<span class="cp">    close(F);</span>
<span class="cp">    $popup = $m-&gt;Pod(&#39;-file&#39; =&gt; $temporary);</span>

<span class="cp">    $popup-&gt;bind(&#39;&lt;Destroy&gt;&#39; =&gt; sub { unlink $temporary } );</span>
<span class="cp">}</span>

<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="dbaccess.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="processmanagementetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Database Access</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Process Management and Communication</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>