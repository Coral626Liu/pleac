<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Directories</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Perl"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="File Contents"
HREF="filecontents.html"><LINK
REL="NEXT"
TITLE="Subroutines"
HREF="subroutines.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Perl</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="filecontents.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="subroutines.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DIRECTORIES"
>9. Directories</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN495"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">@entry = stat(&quot;/usr/bin/vi&quot;) or die &quot;Couldn&#39;t stat /usr/bin/vi : $!&quot;;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">@entry = stat(&quot;/usr/bin&quot;)    or die &quot;Couldn&#39;t stat /usr/bin : $!&quot;;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">@entry = stat(INFILE)        or die &quot;Couldn&#39;t stat INFILE : $!&quot;;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use File::stat;</span>

<span class="cp">$inode = stat(&quot;/usr/bin/vi&quot;);</span>
<span class="cp">$ctime = $inode-&gt;ctime;</span>
<span class="cp">$size  = $inode-&gt;size;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">open( F, &quot;&lt; $filename&quot; )</span>
<span class="cp">    or die &quot;Opening $filename: $!\n&quot;;</span>
<span class="cp">unless (-s F &amp;&amp; -T _) {</span>
<span class="cp">    die &quot;$filename doesn&#39;t have text in it.\n&quot;;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">opendir(DIRHANDLE, &quot;/usr/bin&quot;) or die &quot;couldn&#39;t open /usr/bin : $!&quot;;</span>
<span class="cp">while ( defined ($filename = readdir(DIRHANDLE)) ) {</span>
<span class="cp">    print &quot;Inside /usr/bin is something called $filename\n&quot;;</span>
<span class="cp">}</span>
<span class="cp">closedir(DIRHANDLE);</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN498"
>Getting and Setting Timestamps</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">($READTIME, $WRITETIME) = (stat($filename))[8,9];</span>

<span class="cp">utime($NEWREADTIME, $NEWWRITETIME, $filename);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$SECONDS_PER_DAY = 60 * 60 * 24;</span>
<span class="cp">($atime, $mtime) = (stat($file))[8,9];</span>
<span class="cp">$atime -= 7 * $SECONDS_PER_DAY;</span>
<span class="cp">$mtime -= 7 * $SECONDS_PER_DAY;</span>

<span class="cp">utime($atime, $mtime, $file)</span>
<span class="cp">    or die &quot;couldn&#39;t backdate $file by a week w/ utime: $!&quot;;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$mtime = (stat $file)[9];</span>
<span class="cp">utime(time, $mtime, $file);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use File::stat;</span>
<span class="cp">utime(time, stat($file)-&gt;mtime, $file);</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch09/uvi</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl -w</span>
<span class="cp"># uvi - vi a file without changing its access times</span>

<span class="cp">$file = shift or die &quot;usage: uvi filename\n&quot;;</span>
<span class="cp">($atime, $mtime) = (stat($file))[8,9];</span>
<span class="cp">system($ENV{EDITOR} || &quot;vi&quot;, $file);</span>
<span class="cp">utime($atime, $mtime, $file)</span>
<span class="cp">    or die &quot;couldn&#39;t restore $file to orig times: $!&quot;;</span>

<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN501"
>Deleting a File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">unlink($FILENAME)                 or die &quot;Can&#39;t delete $FILENAME: $!\n&quot;;</span>
<span class="cp">unlink(@FILENAMES) == @FILENAMES  or die &quot;Couldn&#39;t unlink all of @FILENAMES: $!\n&quot;;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">unlink($file) or die &quot;Can&#39;t unlink $file: $!&quot;;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">unless (($count = unlink(@filelist)) == @filelist) {</span>
<span class="cp">    warn &quot;could only delete $count of &quot;</span>
<span class="cp">            . (@filelist) . &quot; files&quot;;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN504"
>Copying or Moving a File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use File::Copy;</span>
<span class="cp">copy($oldfile, $newfile);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">open(IN,  &quot;&lt; $oldfile&quot;)                     or die &quot;can&#39;t open $oldfile: $!&quot;;</span>
<span class="cp">open(OUT, &quot;&gt; $newfile&quot;)                     or die &quot;can&#39;t open $newfile: $!&quot;;</span>

<span class="cp">$blksize = (stat IN)[11] || 16384;          # preferred block size?</span>
<span class="cp">while ($len = sysread IN, $buf, $blksize) {</span>
<span class="cp">    if (!defined $len) {</span>
<span class="cp">        next if $! =~ /^Interrupted/;       # ^Z and fg</span>
<span class="cp">        die &quot;System read error: $!\n&quot;;</span>
<span class="cp">    }</span>
<span class="cp">    $offset = 0;</span>
<span class="cp">    while ($len) {          # Handle partial writes.</span>
<span class="cp">        defined($written = syswrite OUT, $buf, $len, $offset)</span>
<span class="cp">            or die &quot;System write error: $!\n&quot;;</span>
<span class="cp">        $len    -= $written;</span>
<span class="cp">        $offset += $written;</span>
<span class="cp">    };</span>
<span class="cp">}</span>

<span class="cp">close(IN);</span>
<span class="cp">close(OUT);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">system(&quot;cp $oldfile $newfile&quot;);       # unix</span>
<span class="cp">system(&quot;copy $oldfile $newfile&quot;);     # dos, vms</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use File::Copy;</span>

<span class="cp">copy(&quot;datafile.dat&quot;, &quot;datafile.bak&quot;)</span>
<span class="cp">    or die &quot;copy failed: $!&quot;;</span>

<span class="cp">move(&quot;datafile.new&quot;, &quot;datafile.dat&quot;)</span>
<span class="cp">    or die &quot;move failed: $!&quot;;</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN507"
>Recognizing Two Names for the Same File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">%seen = ();</span>

<span class="cp">sub do_my_thing {</span>
<span class="cp">    my $filename = shift;</span>
<span class="cp">    my ($dev, $ino) = stat $filename;</span>

<span class="cp">    unless ($seen{$dev, $ino}++) {</span>
<span class="cp">        # do something with $filename because we haven&#39;t</span>
<span class="cp">        # seen it before</span>
<span class="cp">    }</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">foreach $filename (@files) {</span>
<span class="cp">    ($dev, $ino) = stat $filename;</span>
<span class="cp">    push( @{ $seen{$dev,$ino} }, $filename);</span>
<span class="cp">}</span>

<span class="cp">foreach $devino (sort keys %seen) {</span>
<span class="cp">    ($dev, $ino) = split(/$;/o, $devino);</span>
<span class="cp">    if (@{$seen{$devino}} &gt; 1) {</span>
<span class="cp">        # @{$seen{$devino}} is a list of filenames for the same file</span>
<span class="cp">    }</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN510"
>Processing All Files in a Directory</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">opendir(DIR, $dirname) or die &quot;can&#39;t opendir $dirname: $!&quot;;</span>
<span class="cp">while (defined($file = readdir(DIR))) {</span>
<span class="cp">    # do something with &quot;$dirname/$file&quot;</span>
<span class="cp">}</span>
<span class="cp">closedir(DIR);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$dir = &quot;/usr/local/bin&quot;;</span>
<span class="cp">print &quot;Text files in $dir are:\n&quot;;</span>
<span class="cp">opendir(BIN, $dir) or die &quot;Can&#39;t open $dir: $!&quot;;</span>
<span class="cp">while( defined ($file = readdir BIN) ) {</span>
<span class="cp">    print &quot;$file\n&quot; if -T &quot;$dir/$file&quot;;</span>
<span class="cp">}</span>
<span class="cp">closedir(BIN);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">while ( defined ($file = readdir BIN) ) {</span>
<span class="cp">    next if $file =~ /^\.\.?$/;     # skip . and ..</span>
<span class="cp">    # ...</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use DirHandle;</span>

<span class="cp">sub plainfiles {</span>
<span class="cp">   my $dir = shift;</span>
<span class="cp">   my $dh = DirHandle-&gt;new($dir)   or die &quot;can&#39;t opendir $dir: $!&quot;;</span>
<span class="cp">   return sort                     # sort pathnames</span>
<span class="cp">          grep {    -f     }       # choose only &quot;plain&quot; files</span>
<span class="cp">          map  { &quot;$dir/$_&quot; }       # create full paths</span>
<span class="cp">          grep {  !/^\./   }       # filter out dot files</span>
<span class="cp">          $dh-&gt;</span>
<span class="cp">read()</span>
<span class="cp">;             # read all entries</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN513"
>Globbing, or Getting a List of Filenames Matching a Pattern</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">@list = &lt;*.c&gt;;</span>
<span class="cp">@list = glob(&quot;*.c&quot;);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">opendir(DIR, $path);</span>
<span class="cp">@files = grep { /\.c$/ } readdir(DIR);</span>
<span class="cp">closedir(DIR);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use File::KGlob;</span>

<span class="cp">@files = glob(&quot;*.c&quot;);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">@files = grep { /\.[ch]$/i } readdir(DH);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use DirHandle;</span>

<span class="cp">$dh = DirHandle-&gt;new($path)   or die &quot;Can&#39;t open $path : $!\n&quot;;</span>
<span class="cp">@files = grep { /\.[ch]$/i } $dh-&gt;read();</span>
<span class="cp">#-----------------------------</span>
<span class="cp">opendir(DH, $dir)        or die &quot;Couldn&#39;t open $dir for reading: $!&quot;;</span>

<span class="cp">@files = ();</span>
<span class="cp">while( defined ($file = readdir(DH)) ) {</span>
<span class="cp">    next unless /\.[ch]$/i;</span>

<span class="cp">    my $filename = &quot;$dir/$file&quot;;</span>
<span class="cp">    push(@files, $filename) if -T $file;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">@dirs = map  { $_-&gt;[1] }                # extract pathnames</span>
<span class="cp">        sort { $a-&gt;[0] &lt;=&gt; $b-&gt;[0] }    # sort names numeric</span>
<span class="cp">        grep { -d $_-&gt;[1] }             # path is a dir</span>
<span class="cp">        map  { [ $_, &quot;$path/$_&quot; ] }     # form (name, path)</span>
<span class="cp">        grep { /^\d+$/ }                # just numerics</span>
<span class="cp">        readdir(DIR);                   # all files</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN516"
>Processing All Files in a Directory Recursively</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use File::Find;</span>
<span class="cp">sub process_file {</span>
<span class="cp">    # do whatever;</span>
<span class="cp">}</span>
<span class="cp">find(\&amp;process_file, @DIRLIST);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">@ARGV = qw(.) unless @ARGV;</span>
<span class="cp">use File::Find;</span>
<span class="cp">find sub { print $File::Find::name, -d &amp;&amp; &#39;/&#39;, &quot;\n&quot; }, @ARGV;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use File::Find;</span>
<span class="cp">@ARGV = (&#39;.&#39;) unless @ARGV;</span>
<span class="cp">my $sum = 0;</span>
<span class="cp">find sub { $sum += -s }, @ARGV;</span>
<span class="cp">print &quot;@ARGV contains $sum bytes\n&quot;;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use File::Find;</span>
<span class="cp">@ARGV = (&#39;.&#39;) unless @ARGV;</span>
<span class="cp">my ($saved_size, $saved_name) = (-1, &#39;&#39;);</span>
<span class="cp">sub biggest {</span>
<span class="cp">    return unless -f &amp;&amp; -s _ &gt; $saved_size;</span>
<span class="cp">    $saved_size = -s _;</span>
<span class="cp">    $saved_name = $File::Find::name;</span>
<span class="cp">}</span>
<span class="cp">find(\&amp;biggest, @ARGV);</span>
<span class="cp">print &quot;Biggest file $saved_name in @ARGV is $saved_size bytes long.\n&quot;;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use File::Find;</span>
<span class="cp">@ARGV = (&#39;.&#39;) unless @ARGV;</span>
<span class="cp">my ($age, $name);</span>
<span class="cp">sub youngest {</span>
<span class="cp">    return if defined $age &amp;&amp; $age &gt; (stat($_))[9];</span>
<span class="cp">    $age = (stat(_))[9];</span>
<span class="cp">    $name = $File::Find::name;</span>
<span class="cp">}</span>
<span class="cp">find(\&amp;youngest, @ARGV);</span>
<span class="cp">print &quot;$name &quot; . scalar(localtime($age)) . &quot;\n&quot;;</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch09/fdirs</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl -lw</span>
<span class="cp"># fdirs - find all directories</span>
<span class="cp">@ARGV = qw(.) unless @ARGV;</span>
<span class="cp">use File::Find ();</span>
<span class="cp">sub find(&amp;@) { &amp;File::Find::find }</span>
<span class="cp">*name = *File::Find::name;</span>
<span class="cp">find { print $name if -d } @ARGV;</span>

<span class="cp">#-----------------------------</span>
<span class="cp">find sub { print $File::Find::name if -d }, @ARGV;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">find { print $name if -d } @ARGV;</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN519"
>Removing a Directory and Its Contents</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch09/rmtree1</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl</span>
<span class="cp"># rmtree1 - remove whole directory trees like rm -r</span>
<span class="cp">use File::Find qw(finddepth);</span>
<span class="cp">die &quot;usage: $0 dir ..\n&quot; unless @ARGV;</span>
<span class="cp">*name = *File::Find::name;</span>
<span class="cp">finddepth \&amp;zap, @ARGV;</span>
<span class="cp">sub zap {</span>
<span class="cp">    if (!-l &amp;&amp; -d _) {</span>
<span class="cp">        print &quot;rmdir $name\n&quot;;</span>
<span class="cp">        rmdir($name)  or warn &quot;couldn&#39;t rmdir $name: $!&quot;;</span>
<span class="cp">    } else {</span>
<span class="cp">        print &quot;unlink $name&quot;;</span>
<span class="cp">        unlink($name) or warn &quot;couldn&#39;t unlink $name: $!&quot;;</span>
<span class="cp">    }</span>
<span class="cp">}</span>

<span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch09/rmtree2</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl</span>
<span class="cp"># rmtree2 - remove whole directory trees like rm -r</span>
<span class="cp">use File::Path;</span>
<span class="cp">die &quot;usage: $0 dir ..\n&quot; unless @ARGV;</span>
<span class="cp">    foreach $dir (@ARGV) {</span>
<span class="cp">    rmtree($dir);</span>
<span class="cp">}</span>

<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN522"
>Renaming Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">foreach $file (@NAMES) {</span>
<span class="cp">    my $newname = $file;</span>
<span class="cp">    # change $newname</span>
<span class="cp">    rename($file, $newname) or  </span>
<span class="cp">        warn &quot;Couldn&#39;t rename $file to $newname: $!\n&quot;;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch09/rename</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl -w</span>
<span class="cp"># rename - Larry&#39;s filename fixer</span>
<span class="cp">$op = shift or die &quot;Usage: rename expr [files]\n&quot;;</span>
<span class="cp">chomp(@ARGV = &lt;STDIN&gt;) unless @ARGV;</span>
<span class="cp">for (@ARGV) {</span>
<span class="cp">    $was = $_;</span>
<span class="cp">    eval $op;</span>
<span class="cp">    die $@ if $@;</span>
<span class="cp">    rename($was,$_) unless $was eq $_;</span>
<span class="cp">}</span>

<span class="cp">#-----------------------------</span>
<span class="cp">#% rename &#39;s/\.orig$//&#39;  *.orig</span>
<span class="cp">#% rename &#39;tr/A-Z/a-z/ unless /^Make/&#39;  *</span>
<span class="cp">#% rename &#39;$_ .= &quot;.bad&quot;&#39;  *.f</span>
<span class="cp">#% rename &#39;print &quot;$_: &quot;; s/foo/bar/ if &lt;STDIN&gt; =~ /^y/i&#39;  *</span>
<span class="cp">#% find /tmp -name &#39;*~&#39; -print | rename &#39;s/^(.+)~$/.#$1/&#39;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% rename &#39;use locale; $_ = lc($_) unless /^Make/&#39; *</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN525"
>Splitting a Filename into Its Component Parts</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">use File::Basename;</span>

<span class="cp">$base = basename($path);</span>
<span class="cp">$dir  = dirname($path);</span>
<span class="cp">($base, $dir, $ext) = fileparse($path);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$path = &#39;/usr/lib/libc.a&#39;;</span>
<span class="cp">$file = basename($path);    </span>
<span class="cp">$dir  = dirname($path);     </span>

<span class="cp">print &quot;dir is $dir, file is $file\n&quot;;</span>
<span class="cp"># dir is /usr/lib, file is libc.a</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$path = &#39;/usr/lib/libc.a&#39;;</span>
<span class="cp">($name,$dir,$ext) = fileparse($path,&#39;\..*&#39;);</span>

<span class="cp">print &quot;dir is $dir, name is $name, extension is $ext\n&quot;;</span>
<span class="cp"># dir is /usr/lib/, name is libc, extension is .a</span>
<span class="cp">#-----------------------------</span>
<span class="cp">fileparse_set_fstype(&quot;MacOS&quot;);</span>
<span class="cp">$path = &quot;Hard%20Drive:System%20Folder:README.txt&quot;;</span>
<span class="cp">($name,$dir,$ext) = fileparse($path,&#39;\..*&#39;);</span>

<span class="cp">print &quot;dir is $dir, name is $name, extension is $ext\n&quot;;</span>
<span class="cp"># dir is Hard%20Drive:System%20Folder, name is README, extension is .txt</span>
<span class="cp">#-----------------------------</span>
<span class="cp">sub extension {</span>
<span class="cp">    my $path = shift;</span>
<span class="cp">    my $ext = (fileparse($path,&#39;\..*&#39;))[2];</span>
<span class="cp">    $ext =~ s/^\.//;</span>
<span class="cp">    return $ext;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN528"
>Program: symirror</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch09/symirror</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl -w</span>
<span class="cp"># symirror - build spectral forest of symlinks</span>
<span class="cp">use strict;</span>
<span class="cp">use File::Find;</span>
<span class="cp">use Cwd;</span>

<span class="cp">my ($srcdir, $dstdir);</span>
<span class="cp">my $cwd = getcwd();</span>
<span class="cp">die &quot;usage: $0 realdir mirrordir&quot; unless @ARGV == 2;</span>

<span class="cp">for (($srcdir, $dstdir) = @ARGV) {</span>
<span class="cp">    my $is_dir = -d;</span>
<span class="cp">    next if $is_dir;                        # cool</span>
<span class="cp">    if (defined ($is_dir)) {</span>
<span class="cp">        die &quot;$0: $_ is not a directory\n&quot;;</span>
<span class="cp">    } else {                                # be forgiving</span>
<span class="cp">        mkdir($dstdir, 07777) or die &quot;can&#39;t mkdir $dstdir: $!&quot;;</span>
<span class="cp">    }</span>
<span class="cp">} continue {</span>
<span class="cp">    s#^(?!/)#$cwd/#;                        # fix relative paths</span>
<span class="cp">}</span>
<span class="cp">                    </span>
<span class="cp">chdir $srcdir;</span>
<span class="cp">find(\&amp;wanted, &#39;.&#39;);</span>

<span class="cp">sub wanted {</span>
<span class="cp">    my($dev, $ino, $mode) = lstat($_);</span>
<span class="cp">    my $name = $File::Find::name;</span>
<span class="cp">    $mode &amp;= 07777;                 # preserve directory permissions</span>
<span class="cp">    $name =~ s!^\./!!;              # correct name</span>
<span class="cp">    if (-d _) {                     # then make a real directory</span>
<span class="cp">        mkdir(&quot;$dstdir/$name&quot;, $mode)</span>
<span class="cp">            or die &quot;can&#39;t mkdir $dstdir/$name: $!&quot;;</span>
<span class="cp">    } else {                        # shadow everything else</span>
<span class="cp">        symlink(&quot;$srcdir/$name&quot;, &quot;$dstdir/$name&quot;)</span>
<span class="cp">            or die &quot;can&#39;t symlink $srcdir/$name to $dstdir/$name: $!&quot;;</span>
<span class="cp">    }</span>
<span class="cp">}</span>

<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN531"
>Program: lst</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">#% lst -l /etc</span>
<span class="cp">#12695 0600      1     root    wheel      512 Fri May 29 10:42:41 1998 </span>
<span class="cp">#</span>
<span class="cp">#    /etc/ssh_random_seed</span>
<span class="cp">#</span>
<span class="cp">#12640 0644      1     root    wheel    10104 Mon May 25  7:39:19 1998 </span>
<span class="cp">#</span>
<span class="cp">#    /etc/ld.so.cache</span>
<span class="cp">#</span>
<span class="cp">#12626 0664      1     root    wheel    12288 Sun May 24 19:23:08 1998 </span>
<span class="cp">#</span>
<span class="cp">#    /etc/psdevtab</span>
<span class="cp">#</span>
<span class="cp">#12304 0644      1     root     root      237 Sun May 24 13:59:33 1998 </span>
<span class="cp">#</span>
<span class="cp">#    /etc/exports</span>
<span class="cp">#</span>
<span class="cp">#12309 0644      1     root     root     3386 Sun May 24 13:24:33 1998 </span>
<span class="cp">#</span>
<span class="cp">#    /etc/inetd.conf</span>
<span class="cp">#</span>
<span class="cp">#12399 0644      1     root     root    30205 Sun May 24 10:08:37 1998 </span>
<span class="cp">#</span>
<span class="cp">#    /etc/sendmail.cf</span>
<span class="cp">#</span>
<span class="cp">#18774 0644      1     gnat  perldoc     2199 Sun May 24  9:35:57 1998 </span>
<span class="cp">#</span>
<span class="cp">#    /etc/X11/XMetroconfig</span>
<span class="cp">#</span>
<span class="cp">#12636 0644      1     root    wheel      290 Sun May 24  9:05:40 1998 </span>
<span class="cp">#</span>
<span class="cp">#    /etc/mtab</span>
<span class="cp">#</span>
<span class="cp">#12627 0640      1     root     root        0 Sun May 24  8:24:31 1998 </span>
<span class="cp">#</span>
<span class="cp">#    /etc/wtmplock</span>
<span class="cp">#</span>
<span class="cp">#12310 0644      1     root  tchrist       65 Sun May 24  8:23:04 1998 </span>
<span class="cp">#</span>
<span class="cp">#    /etc/issue</span>
<span class="cp">#</span>
<span class="cp">#....</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch09/lst</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl</span>
<span class="cp"># lst - list sorted directory contents (depth first)</span>

<span class="cp">use Getopt::Std;</span>
<span class="cp">use File::Find;</span>
<span class="cp">use File::stat;</span>
<span class="cp">use User::pwent;</span>
<span class="cp">use User::grent;</span>

<span class="cp">getopts(&#39;lusrcmi&#39;)    			or die &lt;&lt;DEATH;</span>
<span class="cp">Usage: $0 [-mucsril] [dirs ...]</span>
<span class="cp"> or    $0 -i [-mucsrl] &lt; filelist</span>

<span class="cp">Input format:</span>
<span class="cp">    -i  read pathnames from stdin</span>
<span class="cp">Output format:</span>
<span class="cp">    -l  long listing</span>
<span class="cp">Sort on:</span>
<span class="cp">    -m  use mtime (modify time) [DEFAULT]</span>
<span class="cp">    -u  use atime (access time)</span>
<span class="cp">    -c  use ctime (inode change time)</span>
<span class="cp">    -s  use size for sorting</span>
<span class="cp">Ordering:</span>
<span class="cp">    -r  reverse sort</span>
<span class="cp">NB: You may only use select one sorting option at a time.</span>
<span class="cp">DEATH</span>
<span class="cp">    </span>
<span class="cp">unless ($opt_i || @ARGV) { @ARGV = (&#39;.&#39;) }</span>

<span class="cp">if ($opt_c + $opt_u + $opt_s + $opt_m &gt; 1) {</span>
<span class="cp">    die &quot;can only sort on one time or size&quot;;</span>
<span class="cp">}</span>

<span class="cp">$IDX = &#39;mtime&#39;;</span>
<span class="cp">$IDX = &#39;atime&#39; if $opt_u;</span>
<span class="cp">$IDX = &#39;ctime&#39; if $opt_c;</span>
<span class="cp">$IDX = &#39;size&#39;  if $opt_s;</span>

<span class="cp">$TIME_IDX = $opt_s ? &#39;mtime&#39; : $IDX;</span>

<span class="cp">*name = *File::Find::name;  # forcibly import that variable</span>

<span class="cp"># the $opt_i flag tricks wanted into taking</span>
<span class="cp"># its filenames from ARGV instead of being</span>
<span class="cp"># called from find.</span>

<span class="cp">if ($opt_i) {</span>
<span class="cp">     *name = *_;  # $name now alias for $_</span>
<span class="cp">     while (&lt;&gt;) { chomp; &amp;wanted; }   # ok, not stdin really</span>
<span class="cp">}  else {</span>
<span class="cp">    find(\&amp;wanted, @ARGV);</span>
<span class="cp">}</span>

<span class="cp"># sort the files by their cached times, youngest first</span>
<span class="cp">@skeys = sort { $time{$b} &lt;=&gt; $time{$a} } keys %time;</span>

<span class="cp"># but flip the order if -r was supplied on command line</span>
<span class="cp">@skeys = reverse @skeys if $opt_r;</span>

<span class="cp">for (@skeys) {</span>
<span class="cp">    unless ($opt_l) {  # emulate ls -l, except for permissions</span>
<span class="cp">        print &quot;$_\n&quot;;</span>
<span class="cp">        next;</span>
<span class="cp">    }</span>
<span class="cp">    $now = localtime $stat{$_}-&gt;$TIME_IDX();</span>
<span class="cp">    printf &quot;%6d %04o %6d %8s %8s %8d %s %s\n&quot;,</span>
<span class="cp">    	$stat{$_}-&gt;ino(),</span>
<span class="cp">    	$stat{$_}-&gt;mode() &amp; 07777,</span>
<span class="cp">    	$stat{$_}-&gt;nlink(),</span>
<span class="cp">    	user($stat{$_}-&gt;uid()),</span>
<span class="cp">    	group($stat{$_}-&gt;gid()),</span>
<span class="cp">    	$stat{$_}-&gt;size(),</span>
<span class="cp">    	$now, $_;</span>
<span class="cp">}</span>

<span class="cp"># get stat info on the file, saving the desired</span>
<span class="cp"># sort criterion (mtime, atime, ctime, or size)</span>
<span class="cp"># in the %time hash indexed by filename.</span>
<span class="cp"># if they want a long list, we have to save the</span>
<span class="cp"># entire stat object in %stat.  yes, this is a</span>
<span class="cp"># hash of objects</span>
<span class="cp">sub wanted {</span>
<span class="cp">    my $sb = stat($_);  # XXX: should be stat or lstat?</span>
<span class="cp">    return unless $sb;</span>
<span class="cp">    $time{$name} = $sb-&gt;$IDX();  # indirect method call</span>
<span class="cp">    $stat{$name} = $sb if $opt_l;</span>
<span class="cp">}</span>

<span class="cp"># cache user number to name conversions</span>
<span class="cp">sub user {</span>
<span class="cp">    my $uid = shift;</span>
<span class="cp">    $user{$uid} = getpwuid($uid)-&gt;name || &quot;#$uid&quot;</span>
<span class="cp">        unless defined $user{$uid};</span>
<span class="cp">    return $user{$uid};</span>
<span class="cp">}</span>

<span class="cp"># cache group number to name conversions</span>
<span class="cp">sub group {</span>
<span class="cp">    my $gid = shift;</span>
<span class="cp">    $group{$gid} = getgrgid($gid)-&gt;name || &quot;#$gid&quot;</span>
<span class="cp">        unless defined $group{$gid};</span>
<span class="cp">    return $group{$gid};</span>
<span class="cp">}</span>

<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="filecontents.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="subroutines.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>File Contents</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Subroutines</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>