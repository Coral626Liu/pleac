<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Packages, Libraries, and Modules</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Perl"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="References and Records"
HREF="referencesandrecords.html"><LINK
REL="NEXT"
TITLE="Classes, Objects, and Ties"
HREF="classesetc.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Perl</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="referencesandrecords.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="classesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="PACKAGESETC"
>12. Packages, Libraries, and Modules</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN642"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">package Alpha;</span>
<span class="cp">$name = &quot;first&quot;;</span>

<span class="cp">package Omega;</span>
<span class="cp">$name = &quot;last&quot;;</span>

<span class="cp">package main;</span>
<span class="cp">print &quot;Alpha is $Alpha::name, Omega is $Omega::name.\n&quot;;</span>
<span class="cp">Alpha is first, Omega is last.</span>
<span class="cp">#-----------------------------</span>
<span class="cp">require &quot;FileHandle.pm&quot;;            # run-time load</span>
<span class="cp">require FileHandle;                 # &quot;.pm&quot; assumed; same as previous</span>
<span class="cp">use FileHandle;                     # compile-time load</span>

<span class="cp">require &quot;Cards/Poker.pm&quot;;           # run-time load</span>
<span class="cp">require Cards::Poker;               # &quot;.pm&quot; assumed; same as previous</span>
<span class="cp">use Cards::Poker;                   # compile-time load</span>
<span class="cp">#-----------------------------</span>
<span class="cp">1    package Cards::Poker;</span>
<span class="cp">2    use Exporter;</span>
<span class="cp">3    @ISA = (&#39;Exporter&#39;);</span>
<span class="cp">4    @EXPORT = qw(&amp;shuffle @card_deck);</span>
<span class="cp">5    @card_deck = ();                       # initialize package global</span>
<span class="cp">6    sub shuffle { }                        # fill-in definition later</span>
<span class="cp">7    1;                                     # don&#39;t forget this</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN645"
>Defining a Module's Interface</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">package YourModule;</span>
<span class="cp">use strict;</span>
<span class="cp">use vars qw(@ISA @EXPORT @EXPORT_OK %EXPORT_TAGS $VERSION);</span>

<span class="cp">use Exporter;</span>
<span class="cp">$VERSION = 1.00;              # Or higher</span>
<span class="cp">@ISA = qw(Exporter);</span>

<span class="cp">@EXPORT      = qw(...);       # Symbols to autoexport (:DEFAULT tag)</span>
<span class="cp">@EXPORT_OK   = qw(...);       # Symbols to export on request</span>
<span class="cp">%EXPORT_TAGS = (              # Define names for sets of symbols</span>
<span class="cp">    TAG1 =&gt; [...],</span>
<span class="cp">    TAG2 =&gt; [...],</span>
<span class="cp">    ...</span>
<span class="cp">);</span>

<span class="cp">########################</span>
<span class="cp"># your code goes here</span>
<span class="cp">########################</span>

<span class="cp">1;                            # this should be your last line</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use YourModule;               # Import default symbols into my package.</span>
<span class="cp">use YourModule qw(...);       # Import listed symbols into my package.</span>
<span class="cp">use YourModule ();            # Do not import any symbols</span>
<span class="cp">use YourModule qw(:TAG1);     # Import whole tag set</span>
<span class="cp">#-----------------------------</span>
<span class="cp">    @EXPORT = qw(&amp;F1 &amp;F2 @List);</span>
<span class="cp">    @EXPORT = qw( F1  F2 @List);        # same thing</span>
<span class="cp">#-----------------------------</span>
<span class="cp">    @EXPORT_OK = qw(Op_Func %Table);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">    use YourModule qw(Op_Func %Table F1);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">    use YourModule qw(:DEFAULT %Table);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">    %EXPORT_TAGS = (</span>
<span class="cp">        Functions =&gt; [ qw(F1 F2 Op_Func) ],</span>
<span class="cp">        Variables =&gt; [ qw(@List %Table)  ],</span>
<span class="cp">);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">    use YourModule qw(:Functions %Table);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">    @{</span>
<span class="cp"> </span>
<span class="cp">$YourModule::EXPORT_TAGS{Functions}</span>
<span class="cp"> </span>
<span class="cp">}</span>
<span class="cp">, </span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN648"
>Trapping Errors in require or use</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp"># no import</span>
<span class="cp">BEGIN {</span>
<span class="cp">    unless (eval &quot;require $mod&quot;) {</span>
<span class="cp">        warn &quot;couldn&#39;t load $mod: $@&quot;;</span>
<span class="cp">    }</span>
<span class="cp">}</span>

<span class="cp"># imports into current package</span>
<span class="cp">BEGIN {</span>
<span class="cp">    unless (eval &quot;use $mod&quot;) {</span>
<span class="cp">        warn &quot;couldn&#39;t load $mod: $@&quot;;</span>
<span class="cp">    }</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">BEGIN {</span>
<span class="cp">    my($found, @DBs, $mod);</span>
<span class="cp">    $found = 0;</span>
<span class="cp">    @DBs = qw(Giant::Eenie Giant::Meanie Mouse::Mynie Moe);</span>
<span class="cp">    for $mod (@DBs) {</span>
<span class="cp">        if (eval &quot;require $mod&quot;) {</span>
<span class="cp">            $mod-&gt;</span>
<span class="cp">import</span>
<span class="cp">();         # if needed</span>
<span class="cp">            $found = 1;</span>
<span class="cp">            last;</span>
<span class="cp">        }</span>
<span class="cp">    }</span>
<span class="cp">    die &quot;None of @DBs loaded&quot; unless $found;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN651"
>Delaying use Until Run Time</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">BEGIN {</span>
<span class="cp">    unless (@ARGV == 2 &amp;&amp; (2 == grep {/^\d+$/} @ARGV)) {</span>
<span class="cp">        die &quot;usage: $0 num1 num2\n&quot;;</span>
<span class="cp">    }</span>
<span class="cp">}</span>
<span class="cp">use Some::Module;</span>
<span class="cp">use More::Modules;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">if ($opt_b) {</span>
<span class="cp">    require Math::BigInt;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Fcntl qw(O_EXCL O_CREAT O_RDWR);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">require Fcntl;</span>
<span class="cp">Fcntl-&gt;import(qw(O_EXCL O_CREAT O_RDWR));</span>
<span class="cp">#-----------------------------</span>
<span class="cp">sub load_module {</span>
<span class="cp">    require $_[0];  #WRONG</span>
<span class="cp">    import  $_[0];  #WRONG</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">load_module(&#39;Fcntl&#39;, qw(O_EXCL O_CREAT O_RDWR));</span>

<span class="cp">sub load_module {</span>
<span class="cp">    eval &quot;require $_[0]&quot;;</span>
<span class="cp">    die if $@;</span>
<span class="cp">    $_[0]-&gt;import(@_[1 .. $#_]);</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use autouse Fcntl =&gt; qw( O_EXCL() O_CREAT() O_RDWR() );</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN654"
>Making Variables Private to a Module</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">package Alpha;</span>
<span class="cp">my $aa = 10;</span>
<span class="cp">   $x = &quot;azure&quot;;</span>

<span class="cp">package Beta;</span>
<span class="cp">my $bb = 20;</span>
<span class="cp">   $x = &quot;blue&quot;;</span>

<span class="cp">package main;</span>
<span class="cp">print &quot;$aa, $bb, $x, $Alpha::x, $Beta::x\n&quot;;</span>
<span class="cp">10, 20, , azure, blue</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># Flipper.pm</span>
<span class="cp">package Flipper;</span>
<span class="cp">use strict;</span>

<span class="cp">require Exporter;</span>
<span class="cp">use vars qw(@ISA @EXPORT $VERSION);</span>
<span class="cp">@ISA     = qw(Exporter);</span>
<span class="cp">@EXPORT  = qw(flip_words flip_boundary);</span>
<span class="cp">$VERSION = 1.0;</span>

<span class="cp">my $Separatrix = &#39; &#39;;  # default to blank; must precede functions</span>

<span class="cp">sub flip_boundary {</span>
<span class="cp">    my $prev_sep = $Separatrix;</span>
<span class="cp">    if (@_) { $Separatrix = $_[0] }</span>
<span class="cp">    return $prev_sep;</span>
<span class="cp">}</span>
<span class="cp">sub flip_words {</span>
<span class="cp">    my $line  = $_[0];</span>
<span class="cp">    my @words = split($Separatrix, $line);</span>
<span class="cp">    return join($Separatrix, reverse @words);</span>
<span class="cp">}</span>
<span class="cp">1;</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN657"
>Determining the Caller's Package</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">$this_pack = __PACKAGE__;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$that_pack = caller();</span>
<span class="cp">#-----------------------------</span>
<span class="cp">print &quot;I am in package __PACKAGE__\n&quot;;              # WRONG!</span>
<span class="cp">I am in package __PACKAGE__</span>
<span class="cp">#-----------------------------</span>
<span class="cp">package Alpha;</span>
<span class="cp">runit(&#39;$line = &lt;TEMP&gt;&#39;);</span>

<span class="cp">package Beta;</span>
<span class="cp">sub runit {</span>
<span class="cp">    my $codestr = shift;</span>
<span class="cp">    eval $codestr;</span>
<span class="cp">    die if $@;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">package Beta;</span>
<span class="cp">sub runit {</span>
<span class="cp">    my $codestr = shift;</span>
<span class="cp">    my $hispack = caller;</span>
<span class="cp">    eval &quot;package $hispack; $codestr&quot;;</span>
<span class="cp">    die if $@;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">package Alpha;</span>
<span class="cp">runit( sub { $line = &lt;TEMP&gt; } );</span>

<span class="cp">package Beta;</span>
<span class="cp">sub runit {</span>
<span class="cp">    my $coderef = shift;</span>
<span class="cp">    &amp;$coderef();</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">open (FH, &quot;&lt; /etc/termcap&quot;)</span>
<span class="cp">    or die &quot;can&#39;t open /etc/termcap: $!&quot;;</span>
<span class="cp">($a, $b, $c) = nreadline(3, &#39;FH&#39;);</span>

<span class="cp">use Symbol ();</span>
<span class="cp">use Carp;</span>
<span class="cp">sub nreadline {</span>
<span class="cp">    my ($count, $handle) = @_;</span>
<span class="cp">    my(@retlist,$line);</span>

<span class="cp">    croak &quot;count must be &gt; 0&quot; unless $count &gt; 0;</span>
<span class="cp">    $handle = Symbol::qualify($handle, (</span>
<span class="cp">caller()</span>
<span class="cp">)[0]);</span>
<span class="cp">    croak &quot;need open filehandle&quot; unless defined fileno($handle);</span>

<span class="cp">    push(@retlist, $line) while defined($line = &lt;$handle&gt;) &amp;&amp; $count--;</span>
<span class="cp">    return @retlist;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN660"
>Automating Module Clean-Up</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">$Logfile = &quot;/tmp/mylog&quot; unless defined $Logfile;</span>
<span class="cp">open(LF, &quot;&gt;&gt;$Logfile&quot;)</span>
<span class="cp">    or die &quot;can&#39;t append to $Logfile: $!&quot;;</span>
<span class="cp">select(((select(LF), $|=1))[0]);  # unbuffer LF</span>
<span class="cp">logmsg(&quot;startup&quot;);</span>

<span class="cp">sub logmsg {</span>
<span class="cp">    my $now = scalar gmtime;</span>
<span class="cp">    print LF &quot;$0 $$ $now: @_\n&quot;</span>
<span class="cp">        or die &quot;write to $Logfile failed: $!&quot;;</span>
<span class="cp">}</span>

<span class="cp">END {</span>
<span class="cp">    logmsg(&quot;shutdown&quot;);</span>
<span class="cp">    close(LF)                     </span>
<span class="cp">        or die &quot;close $Logfile failed: $!&quot;;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use sigtrap qw(die normal-signals error-signals);</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN663"
>Keeping Your Own Module Directory</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">#% perl -e &#39;for (@INC) { printf &quot;%d %s\n&quot;, $i++, $_ }&#39;</span>
<span class="cp">#0 /usr/local/perl/lib/i686-linux/5.004</span>
<span class="cp">#</span>
<span class="cp">#1 /usr/local/perl/lib</span>
<span class="cp">#</span>
<span class="cp">#2 /usr/local/perl/lib/site_perl/i686-linux</span>
<span class="cp">#</span>
<span class="cp">#3 /usr/local/perl/lib/site_perl</span>
<span class="cp">#</span>
<span class="cp">#4 .</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># syntax for sh, bash, ksh, or zsh</span>
<span class="cp">#$ export PERL5LIB=$HOME/perllib</span>

<span class="cp"># syntax for csh or tcsh</span>
<span class="cp">#% setenv PERL5LIB ~/perllib</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use lib &quot;/projects/spectre/lib&quot;;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use FindBin;</span>
<span class="cp">use lib $FindBin::Bin;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use FindBin qw($Bin);</span>
<span class="cp">use lib &quot;$Bin/../lib&quot;;</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN666"
>Preparing a Module for Distribution</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">#% h2xs -XA -n Planets</span>
<span class="cp">#% h2xs -XA -n Astronomy::Orbits</span>
<span class="cp">#-----------------------------</span>
<span class="cp">package Astronomy::Orbits;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">require Exporter;</span>
<span class="cp">require AutoLoader;</span>
<span class="cp">@ISA = qw(Exporter AutoLoader);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">require Exporter;</span>
<span class="cp">require DynaLoader;</span>
<span class="cp">@ISA = qw(Exporter DynaLoader);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% make dist</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN669"
>Speeding Module Loading with SelfLoader</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">require Exporter;</span>
<span class="cp">require SelfLoader;</span>
<span class="cp">@ISA = qw(Exporter SelfLoader);</span>
<span class="cp">#</span>
<span class="cp"># other initialization or declarations here</span>
<span class="cp">#</span>
<span class="cp">#__DATA__</span>
<span class="cp">#sub abc { .... }</span>
<span class="cp">#sub def { .... }</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN672"
>Speeding Up Module Loading with Autoloader</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">#% h2xs -Xn Sample</span>
<span class="cp">#% cd Sample</span>
<span class="cp">#% perl Makefile.PL LIB=~/perllib</span>
<span class="cp">#% (edit Sample.pm)</span>
<span class="cp">#% make install</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN675"
>Overriding Built-In Functions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">package FineTime;</span>
<span class="cp">use strict;</span>
<span class="cp">require Exporter;</span>
<span class="cp">use vars qw(@ISA @EXPORT_OK);</span>
<span class="cp">@ISA = qw(Exporter);</span>
<span class="cp">@EXPORT_OK = qw(time);</span>

<span class="cp">sub time() { ..... }  # TBA</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use FineTime qw(time);</span>
<span class="cp">$start = time();</span>
<span class="cp">1 while print time() - $start, &quot;\n&quot;;</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN678"
>Reporting Errors and Warnings Like Built-Ins</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">sub even_only {</span>
<span class="cp">    my $n = shift;</span>
<span class="cp">    die &quot;$n is not even&quot; if $n &amp; 1;  # one way to test</span>
<span class="cp">    #....</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Carp;</span>
<span class="cp">sub even_only {</span>
<span class="cp">    my $n = shift;</span>
<span class="cp">    croak &quot;$n is not even&quot; if $n % 2;  # here&#39;s another</span>
<span class="cp">    #....</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">use Carp;</span>
<span class="cp">sub even_only {</span>
<span class="cp">    my $n = shift;</span>
<span class="cp">    if ($n &amp; 1) {         # test whether odd number</span>
<span class="cp">        carp &quot;$n is not even, continuing&quot;;</span>
<span class="cp">        ++$n;</span>
<span class="cp">    }</span>
<span class="cp">    #....</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">carp &quot;$n is not even, continuing&quot; if $^W;</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN681"
>Referring to Packages Indirectly</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">{</span>
<span class="cp">    no strict &#39;refs&#39;;</span>
<span class="cp">    $val  = ${ $packname . &quot;::&quot; . $varname };</span>
<span class="cp">    @vals = @{ $packname . &quot;::&quot; . $aryname };</span>
<span class="cp">    &amp;{ $packname . &quot;::&quot; . $funcname }(&quot;args&quot;);</span>
<span class="cp">    ($packname . &quot;::&quot; . $funcname) -&gt; (&quot;args&quot;);</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">eval &quot;package $packname; \$&#39;$val = \$$varname&quot;; # set $main&#39;val</span>
<span class="cp">die if $@;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">printf &quot;log2  of 100 is %.2f\n&quot;, log2(100);</span>
<span class="cp">printf &quot;log10 of 100 is %.2f\n&quot;, log10(100);</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$packname = &#39;main&#39;;</span>
<span class="cp">for ($i = 2; $i &lt; 1000; $i++) {</span>
<span class="cp">    $logN = log($i);</span>
<span class="cp">    eval &quot;sub ${packname}::log$i { log(shift) / $logN }&quot;;</span>
<span class="cp">    die if $@;</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">$packname = &#39;main&#39;;</span>
<span class="cp">for ($i = 2; $i &lt; 1000; $i++) {</span>
<span class="cp">    my $logN = log($i);</span>
<span class="cp">    no strict &#39;refs&#39;;</span>
<span class="cp">    *{&quot;${packname}::log$i&quot;} = sub { log(shift) / $logN };</span>
<span class="cp">}</span>
<span class="cp">#-----------------------------</span>
<span class="cp">*blue       = \&amp;Colors::blue;</span>
<span class="cp">*main::blue = \&amp;Colors::azure;</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN684"
>Using h2ph to Translate C #include Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">#Can&#39;t locate sys/syscall.ph in @INC (did you run h2ph?)</span>
<span class="cp">#</span>
<span class="cp">#(@INC contains: /usr/lib/perl5/i686-linux/5.00404 /usr/lib/perl5</span>
<span class="cp">#</span>
<span class="cp">#/usr/lib/perl5/site_perl/i686-linux /usr/lib/perl5/site_perl .)</span>
<span class="cp">#</span>
<span class="cp">#at some_program line 7.</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% cd /usr/include; h2ph sys/syscall.h</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% cd /usr/include; h2ph *.h */*.h</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% cd /usr/include; find . -name &#39;*.h&#39; -print | xargs h2ph</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># file FineTime.pm</span>
<span class="cp">package main;</span>
<span class="cp">require &#39;sys/syscall.ph&#39;;</span>
<span class="cp">die &quot;No SYS_gettimeofday in sys/syscall.ph&quot;</span>
<span class="cp">    unless defined &amp;SYS_gettimeofday;</span>

<span class="cp">package FineTime;</span>
<span class="cp">    use strict;</span>
<span class="cp">require Exporter;</span>
<span class="cp">use vars qw(@ISA @EXPORT_OK);</span>
<span class="cp">@ISA = qw(Exporter);</span>
<span class="cp">@EXPORT_OK = qw(time);</span>

<span class="cp">sub time() {</span>
<span class="cp">    my $tv = pack(&quot;LL&quot;, ());  # presize buffer to two longs</span>
<span class="cp">    syscall(&amp;main::SYS_gettimeofday, $tv, undef) &gt;= 0</span>
<span class="cp">        or die &quot;gettimeofday: $!&quot;;</span>
<span class="cp">    my($seconds, $microseconds) = unpack(&quot;LL&quot;, $tv);</span>
<span class="cp">    return $seconds + ($microseconds / 1_000_000);</span>
<span class="cp">}</span>

<span class="cp">1;</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch12/jam</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl -w</span>
<span class="cp"># jam - stuff characters down STDIN&#39;s throat</span>
<span class="cp">require &#39;sys/ioctl.ph&#39;;</span>
<span class="cp">die &quot;no TIOCSTI&quot; unless defined &amp;TIOCSTI;</span>
<span class="cp">sub jam {</span>
<span class="cp">    local $SIG{TTOU} = &quot;IGNORE&quot;; # &quot;Stopped for tty output&quot;</span>
<span class="cp">    local *TTY;  # make local filehandle</span>
<span class="cp">    open(TTY, &quot;+&lt;/dev/tty&quot;)                 or die &quot;no tty: $!&quot;;</span>
<span class="cp">    for (split(//, $_[0])) {</span>
<span class="cp">        ioctl(TTY, &amp;TIOCSTI, $_)            or die &quot;bad TIOCSTI: $!&quot;;</span>
<span class="cp">    }</span>
<span class="cp">    close(TTY);</span>
<span class="cp">}</span>
<span class="cp">jam(&quot;@ARGV\n&quot;);</span>

<span class="cp">#-----------------------------</span>
<span class="cp">#% cat &gt; tio.c &lt;&lt;EOF &amp;&amp; cc tio.c &amp;&amp; a.out</span>
<span class="cp">##include &lt;sys/ioctl.h&gt;</span>
<span class="cp">#main() { printf(&quot;%#08x\n&quot;, TIOCSTI); }</span>
<span class="cp">#EOF</span>
<span class="cp">#0x005412</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch12/winsz</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl</span>
<span class="cp"># winsz - find x and y for chars and pixels</span>
<span class="cp">require &#39;sys/ioctl.ph&#39;;</span>
<span class="cp">die &quot;no TIOCGWINSZ &quot; unless defined &amp;TIOCGWINSZ;</span>
<span class="cp">open(TTY, &quot;+&lt;/dev/tty&quot;)                     or die &quot;No tty: $!&quot;;</span>
<span class="cp">unless (ioctl(TTY, &amp;TIOCGWINSZ, $winsize=&#39;&#39;)) {</span>
<span class="cp">    die sprintf &quot;$0: ioctl TIOCGWINSZ (%08x: $!)\n&quot;, &amp;TIOCGWINSZ;</span>
<span class="cp">}</span>
<span class="cp">($row, $col, $xpixel, $ypixel) = unpack(&#39;S4&#39;, $winsize);</span>
<span class="cp">print &quot;(row,col) = ($row,$col)&quot;;</span>
<span class="cp">print &quot;  (xpixel,ypixel) = ($xpixel,$ypixel)&quot; if $xpixel || $ypixel;</span>
<span class="cp">print &quot;\n&quot;;</span>

<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN687"
>Using h2xs to Make a Module with C Code</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">#% perl Makefile.PL</span>
<span class="cp">#% make</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% h2xs -cn FineTime</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% perl Makefile.PL</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#&#39;LIBS&#39;      =&gt; [&#39;&#39;],   # e.g., &#39;-lm&#39;</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#&#39;LIBS&#39;      =&gt; [&#39;-L/usr/redhat/lib -lrpm&#39;],</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% perl Makefile.PL LIB=~/perllib</span>
<span class="cp">#-----------------------------</span>
<span class="cp">package FineTime;</span>
<span class="cp">use strict;</span>
<span class="cp">use vars qw($VERSION @ISA @EXPORT_OK);</span>
<span class="cp">require Exporter;</span>
<span class="cp">require DynaLoader;</span>
<span class="cp">@ISA = qw(Exporter DynaLoader);</span>
<span class="cp">@EXPORT_OK = qw(time);</span>
<span class="cp">$VERSION = &#39;0.01&#39;;</span>
<span class="cp">bootstrap FineTime $VERSION;</span>
<span class="cp">1;</span>
<span class="cp">##-----------------------------</span>
<span class="cp">##include &lt;unistd.h&gt;</span>
<span class="cp">##include &lt;sys/time.h&gt;</span>
<span class="cp">##include &quot;EXTERN.h&quot;</span>
<span class="cp">##include &quot;perl.h&quot;</span>
<span class="cp">##include &quot;XSUB.h&quot;</span>
<span class="cp">#</span>
<span class="cp">#MODULE = FineTime           PACKAGE = FineTime</span>
<span class="cp">#</span>
<span class="cp">#double</span>
<span class="cp">#time()</span>
<span class="cp">#    CODE:</span>
<span class="cp">#        struct timeval tv;</span>
<span class="cp">#        gettimeofday(&amp;tv,0);</span>
<span class="cp">#        RETVAL = tv.tv_sec + ((double) tv.tv_usec) / 1000000;</span>
<span class="cp">#    OUTPUT:</span>
<span class="cp">#        RETVAL</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% make install</span>
<span class="cp">#mkdir ./blib/lib/auto/FineTime</span>
<span class="cp">#cp FineTime.pm ./blib/lib/FineTime.pm</span>
<span class="cp">#/usr/local/bin/perl -I/usr/lib/perl5/i686-linux/5.00403  -I/usr/lib/perl5</span>
<span class="cp">#/usr/lib/perl5/ExtUtils/xsubpp -typemap </span>
<span class="cp">#    /usr/lib/perl5/ExtUtils/typemap FineTime.xs</span>
<span class="cp">#FineTime.tc &amp;&amp; mv FineTime.tc FineTime.ccc -c -Dbool=char -DHAS_BOOL </span>
<span class="cp">#    -O2-DVERSION=\&quot;0.01\&quot; -DXS_VERSION=\&quot;0.01\&quot; -fpic </span>
<span class="cp">#    -I/usr/lib/perl5/i686-linux/5.00403/CORE  </span>
<span class="cp">#FineTime.cRunning Mkbootstrap for FineTime ()</span>
<span class="cp">#chmod 644 FineTime.bs</span>
<span class="cp">#LD_RUN_PATH=&quot;&quot; cc -o blib/arch/auto/FineTime/FineTime.so </span>
<span class="cp">#    -shared -L/usr/local/lib FineTime.o</span>
<span class="cp">#chmod 755 blib/arch/auto/FineTime/FineTime.so</span>
<span class="cp">#cp FineTime.bs ./blib/arch/auto/FineTime/FineTime.bs</span>
<span class="cp">#chmod 644 blib/arch/auto/FineTime/FineTime.bs</span>
<span class="cp">#Installing /home/tchrist/perllib/i686-linux/./auto/FineTime/FineTime.so</span>
<span class="cp">#Installing /home/tchrist/perllib/i686-linux/./auto/FineTime/FineTime.bs</span>
<span class="cp">#Installing /home/tchrist/perllib/./FineTime.pm</span>
<span class="cp">#Writing /home/tchrist/perllib/i686-linux/auto/FineTime/.packlist</span>
<span class="cp">#Appending installation info to /home/tchrist/perllib/i686-linux/perllocal.pod</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% perl -I ~/perllib -MFineTime=time -le &#39;1 while print time()&#39; | head</span>
<span class="cp">#888177070.090978</span>
<span class="cp">#</span>
<span class="cp">#888177070.09132</span>
<span class="cp">#</span>
<span class="cp">#888177070.091389</span>
<span class="cp">#</span>
<span class="cp">#888177070.091453</span>
<span class="cp">#</span>
<span class="cp">#888177070.091515</span>
<span class="cp">#</span>
<span class="cp">#888177070.091577</span>
<span class="cp">#</span>
<span class="cp">#888177070.091639</span>
<span class="cp">#</span>
<span class="cp">#888177070.0917</span>
<span class="cp">#</span>
<span class="cp">#888177070.091763</span>
<span class="cp">#</span>
<span class="cp">#888177070.091864</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN690"
>Documenting Your Module with Pod</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">#=head2 Discussion</span>
<span class="cp">#</span>
<span class="cp">#If we had a I&lt;.h&gt; file with function prototype declarations, we</span>
<span class="cp">#could include that, but since we&#39;re writing this one from scratch,</span>
<span class="cp">#we&#39;ll use the B&lt;-c&gt; flag to omit building code to translate any</span>
<span class="cp">#C&lt;#define&gt; symbols. The B&lt;-n&gt; flag says to create a module directory</span>
<span class="cp">#named I&lt;FineTime/&gt;, which will have the following files.</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#=for troff</span>
<span class="cp">#.EQ</span>
<span class="cp">#log sub n (x) = { {log sub e (x)} over {log sub e (n)} }</span>
<span class="cp">#.EN</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#=for later</span>
<span class="cp">#next if 1 .. ?^$?;</span>
<span class="cp">#s/^(.)/&gt;$1/;</span>
<span class="cp">#s/(.{73})........*/$1&lt;SNIP&gt;/;</span>
<span class="cp">#</span>
<span class="cp">#=cut back to perl</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#=begin comment</span>
<span class="cp">#</span>
<span class="cp">#if (!open(FILE, $file)) {</span>
<span class="cp">#    unless ($opt_q) {  #)</span>
<span class="cp">#        warn &quot;$me: $file: $!\n&quot;;</span>
<span class="cp">#        $Errors++;</span>
<span class="cp">#    }</span>
<span class="cp">#    next FILE;</span>
<span class="cp">#}</span>
<span class="cp">#</span>
<span class="cp">#$total = 0;</span>
<span class="cp">#$matches = 0;</span>
<span class="cp">#</span>
<span class="cp">#=end comment</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN693"
>Building and Installing a CPAN Module</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">#% gunzip Some-Module-4.54.tar.gz</span>
<span class="cp">#% tar xf Some-Module-4.54</span>
<span class="cp">#% cd Some-Module-4.54</span>
<span class="cp">#% perl Makefile.PL</span>
<span class="cp">#% make</span>
<span class="cp">#% make test</span>
<span class="cp">#% make install</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% gunzip MD5-1.7.tar.gz</span>
<span class="cp">#% tar xf MD5-1.7.tar</span>
<span class="cp">#% cd MD5-1.7</span>
<span class="cp">#% perl Makefile.PL </span>
<span class="cp">#Checking if your kit is complete...</span>
<span class="cp">#</span>
<span class="cp">#Looks good</span>
<span class="cp">#</span>
<span class="cp">#Writing Makefile for MD5</span>
<span class="cp">#</span>
<span class="cp">#% make</span>
<span class="cp">#mkdir ./blib</span>
<span class="cp">#</span>
<span class="cp">#mkdir ./blib/lib</span>
<span class="cp">#</span>
<span class="cp">#cp MD5.pm ./blib/lib/MD5.pm</span>
<span class="cp">#</span>
<span class="cp">#AutoSplitting MD5 (./blib/lib/auto/MD5)</span>
<span class="cp">#</span>
<span class="cp">#/usr/bin/perl -I/usr/local/lib/perl5/i386 ...</span>
<span class="cp">#</span>
<span class="cp">#...</span>
<span class="cp">#</span>
<span class="cp">#cp MD5.bs ./blib/arch/auto/MD5/MD5.bs</span>
<span class="cp">#</span>
<span class="cp">#chmod 644 ./blib/arch/auto/MD5/MD5.bsmkdir ./blib/man3</span>
<span class="cp">#</span>
<span class="cp">#Manifying ./blib/man3/MD5.3</span>
<span class="cp">#</span>
<span class="cp">#% make test</span>
<span class="cp">#PERL_DL_NONLAZY=1 /usr/bin/perl -I./blib/arch -I./blib/lib</span>
<span class="cp">#</span>
<span class="cp">#-I/usr/local/lib/perl5/i386-freebsd/5.00404 -I/usr/local/lib/perl5 test.pl</span>
<span class="cp">#</span>
<span class="cp">#1..14</span>
<span class="cp">#</span>
<span class="cp">#ok 1</span>
<span class="cp">#</span>
<span class="cp">#ok 2</span>
<span class="cp">#</span>
<span class="cp">#...</span>
<span class="cp">#</span>
<span class="cp">#ok 13</span>
<span class="cp">#</span>
<span class="cp">#ok 14</span>
<span class="cp">#</span>
<span class="cp">#% sudo make install</span>
<span class="cp">#Password:</span>
<span class="cp">#</span>
<span class="cp">#Installing /usr/local/lib/perl5/site_perl/i386-freebsd/./auto/MD5/</span>
<span class="cp">#</span>
<span class="cp">#    MD5.so</span>
<span class="cp">#</span>
<span class="cp">#Installing /usr/local/lib/perl5/site_perl/i386-freebsd/./auto/MD5/</span>
<span class="cp">#</span>
<span class="cp">#    MD5.bs</span>
<span class="cp">#</span>
<span class="cp">#Installing /usr/local/lib/perl5/site_perl/./auto/MD5/autosplit.ix</span>
<span class="cp">#</span>
<span class="cp">#Installing /usr/local/lib/perl5/site_perl/./MD5.pm</span>
<span class="cp">#</span>
<span class="cp">#Installing /usr/local/lib/perl5/man/man3/./MD5.3</span>
<span class="cp">#</span>
<span class="cp">#Writing /usr/local/lib/perl5/site_perl/i386-freebsd/auto/MD5/.packlist</span>
<span class="cp">#</span>
<span class="cp">#Appending installation info to /usr/local/lib/perl5/i386-freebsd/</span>
<span class="cp">#</span>
<span class="cp">#5.00404/perllocal.pod</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># if you just want the modules installed in your own directory</span>
<span class="cp">#% perl Makefile.PL LIB=~/lib</span>
<span class="cp">#</span>
<span class="cp"># if you have your own a complete distribution</span>
<span class="cp">#% perl Makefile.PL PREFIX=~/perl5-private</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN696"
>Example: Module Template</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">package Some::Module;  # must live in Some/Module.pm</span>

<span class="cp">use strict;</span>

<span class="cp">require Exporter;</span>
<span class="cp">use vars       qw($VERSION @ISA @EXPORT @EXPORT_OK %EXPORT_TAGS);</span>

<span class="cp"># set the version for version checking</span>
<span class="cp">$VERSION     = 0.01;</span>

<span class="cp">@ISA         = qw(Exporter);</span>
<span class="cp">@EXPORT      = qw(&amp;func1 &amp;func2 &amp;func4);</span>
<span class="cp">%EXPORT_TAGS = ( );     # eg: TAG =&gt; [ qw!name1 name2! ],</span>

<span class="cp"># your exported package globals go here,</span>
<span class="cp"># as well as any optionally exported functions</span>
<span class="cp">@EXPORT_OK   = qw($Var1 %Hashit &amp;func3);</span>

<span class="cp">use vars qw($Var1 %Hashit);</span>
<span class="cp"># non-exported package globals go here</span>
<span class="cp">use vars      qw(@more $stuff);</span>

<span class="cp"># initialize package globals, first exported ones</span>
<span class="cp">$Var1   = &#39;&#39;;</span>
<span class="cp">%Hashit = ();</span>

<span class="cp"># then the others (which are still accessible as $Some::Module::stuff)</span>
<span class="cp">$stuff  = &#39;&#39;;</span>
<span class="cp">@more   = ();</span>

<span class="cp"># all file-scoped lexicals must be created before</span>
<span class="cp"># the functions below that use them.</span>

<span class="cp"># file-private lexicals go here</span>
<span class="cp">my $priv_var    = &#39;&#39;;</span>
<span class="cp">my %secret_hash = ();</span>

<span class="cp"># here&#39;s a file-private function as a closure,</span>
<span class="cp"># callable as &amp;$priv_func.</span>
<span class="cp">my $priv_func = sub {</span>
<span class="cp">    # stuff goes here.</span>
<span class="cp">};</span>

<span class="cp"># make all your functions, whether exported or not;</span>
<span class="cp"># remember to put something interesting in the {} stubs</span>
<span class="cp">sub func1      { .... }    # no prototype</span>
<span class="cp">sub func2()    { .... }    # proto&#39;d void</span>
<span class="cp">sub func3($$)  { .... }    # proto&#39;d to 2 scalars</span>

<span class="cp"># this one isn&#39;t auto-exported, but could be called!</span>
<span class="cp">sub func4(\%)  { .... }    # proto&#39;d to 1 hash ref</span>

<span class="cp">END { }       # module clean-up code here (global destructor)</span>

<span class="cp">1;</span>
<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN699"
>Program: Finding Versions and Descriptions of Installed Modules</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="cp"></span><span class="cp">#-----------------------------</span>
<span class="cp">#% pmdesc</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#FileHandle (2.00) - supply object methods for filehandles</span>
<span class="cp">#</span>
<span class="cp">#IO::File (1.06021) - supply object methods for filehandles</span>
<span class="cp">#</span>
<span class="cp">#IO::Select (1.10) - OO interface to the select system call</span>
<span class="cp">#</span>
<span class="cp">#IO::Socket (1.1603) - Object interface to socket communications</span>
<span class="cp">#</span>
<span class="cp">#...</span>
<span class="cp">#-----------------------------</span>
<span class="cp">#% pmdesc -v</span>
<span class="cp">#</span>
<span class="cp">#&lt;&lt;&lt;Modules from /usr/lib/perl5/i686-linux/5.00404&gt;&gt;&gt;</span>
<span class="cp">#</span>
<span class="cp">#</span>
<span class="cp">#FileHandle (2.00) - supply object methods for filehandles</span>
<span class="cp">#</span>
<span class="cp">#    ...</span>
<span class="cp">#-----------------------------</span>
<span class="cp"># <font size="-1"><a href="http://pleac.sourceforge.net/include/perl/ch12/pmdesc</span>">download the following standalone program</a></font>
<span class="cp">#!/usr/bin/perl -w</span>
<span class="cp"># pmdesc - describe pm files</span>
<span class="cp"># tchrist@perl.com</span>

<span class="cp">use strict;</span>
<span class="cp">use File::Find      qw(find);</span>
<span class="cp">use Getopt::Std     qw(getopts);</span>
<span class="cp">use Carp;</span>

<span class="cp">use vars (</span>
<span class="cp">    q!$opt_v!,              # give debug info</span>
<span class="cp">    q!$opt_w!,              # warn about missing descs on modules</span>
<span class="cp">    q!$opt_a!,              # include relative paths</span>
<span class="cp">    q!$opt_s!,              # sort output within each directory</span>
<span class="cp">);</span>

<span class="cp">$| = 1;</span>

<span class="cp">getopts(&#39;wvas&#39;)             or die &quot;bad usage&quot;;</span>

<span class="cp">@ARGV = @INC unless @ARGV;</span>

<span class="cp"># Globals.  wish I didn&#39;t really have to do this.</span>
<span class="cp">use vars (</span>
<span class="cp">    q!$Start_Dir!,          # The top directory find was called with</span>
<span class="cp">    q!%Future!,             # topdirs find will handle later</span>
<span class="cp">);</span>

<span class="cp">my $Module;</span>

<span class="cp"># install an output filter to sort my module list, if wanted.</span>
<span class="cp">if ($opt_s) {</span>
<span class="cp">    if (open(ME, &quot;-|&quot;)) {</span>
<span class="cp">        $/ = &#39;&#39;;</span>
<span class="cp">        while (&lt;ME&gt;) {</span>
<span class="cp">            chomp;</span>
<span class="cp">            print join(&quot;\n&quot;, sort split /\n/), &quot;\n&quot;;</span>
<span class="cp">        }</span>
<span class="cp">        exit;</span>
<span class="cp">    }</span>
<span class="cp">}</span>

<span class="cp">MAIN: {</span>
<span class="cp">    my %visited;</span>
<span class="cp">    my ($dev,$ino);</span>

<span class="cp">    @Future{@ARGV} = (1) x @ARGV;</span>

<span class="cp">    foreach $Start_Dir (@ARGV) {</span>
<span class="cp">        delete $Future{$Start_Dir};</span>

<span class="cp">        print &quot;\n&lt;&lt;Modules from $Start_Dir&gt;&gt;\n\n&quot;</span>
<span class="cp">            if $opt_v;</span>

<span class="cp">        next unless ($dev,$ino) = stat($Start_Dir);</span>
<span class="cp">        next if $visited{$dev,$ino}++;</span>
<span class="cp">        next unless $opt_a || $Start_Dir =~ m!^/!;</span>

<span class="cp">        find(\&amp;wanted, $Start_Dir);</span>
<span class="cp">    }</span>
<span class="cp">    exit;</span>
<span class="cp">}</span>

<span class="cp"># calculate module name from file and directory</span>
<span class="cp">sub modname {</span>
<span class="cp">    local $_ = $File::Find::name;</span>

<span class="cp">    if (index($_, $Start_Dir . &#39;/&#39;) == 0) {</span>
<span class="cp">        substr($_, 0, 1+length($Start_Dir)) = &#39;&#39;;</span>
<span class="cp">    }</span>

<span class="cp">    s { /              }    {::}gx;</span>
<span class="cp">    s { \.p(m|od)$     }    {}x;</span>

<span class="cp">    return $_;</span>
<span class="cp">}</span>

<span class="cp"># decide if this is a module we want</span>
<span class="cp">sub wanted {</span>
<span class="cp">    if ( $Future{$File::Find::name} ) {</span>
<span class="cp">        warn &quot;\t(Skipping $File::Find::name, qui venit in futuro.)\n&quot;</span>
<span class="cp">            if 0 and $opt_v;</span>
<span class="cp">        $File::Find::prune = 1;</span>
<span class="cp">        return;</span>
<span class="cp">    }</span>
<span class="cp">    return unless /\.pm$/ &amp;&amp; -f;</span>
<span class="cp">    $Module = &amp;modname;</span>
<span class="cp">    # skip obnoxious modules</span>
<span class="cp">    if ($Module =~ /^CPAN(\Z|::)/) {</span>
<span class="cp">        warn(&quot;$Module -- skipping because it misbehaves\n&quot;);</span>
<span class="cp">        return;</span>
<span class="cp">    }</span>

<span class="cp">    my    $file = $_;</span>

<span class="cp">    unless (open(POD, &quot;&lt; $file&quot;)) {</span>
<span class="cp">        warn &quot;\tcannot open $file: $!&quot;;</span>
<span class="cp">            # if $opt_w;</span>
<span class="cp">        return 0;</span>
<span class="cp">    }</span>

<span class="cp">    $: = &quot; -:&quot;;</span>

<span class="cp">    local $/ = &#39;&#39;;</span>
<span class="cp">    local $_;</span>
<span class="cp">    while (&lt;POD&gt;) {</span>
<span class="cp">        if (/=head\d\s+NAME/) {</span>
<span class="cp">            chomp($_ = &lt;POD&gt;);</span>
<span class="cp">            s/^.*?-\s+//s;</span>
<span class="cp">            s/\n/ /g;</span>
<span class="cp">            #write;</span>
<span class="cp">            my $v;</span>
<span class="cp">            if (defined ($v = getversion($Module))) {</span>
<span class="cp">                print &quot;$Module ($v) &quot;;</span>
<span class="cp">            } else {</span>
<span class="cp">                print &quot;$Module &quot;;</span>
<span class="cp">            }</span>
<span class="cp">            print &quot;- $_\n&quot;;</span>
<span class="cp">            return 1;</span>
<span class="cp">        }</span>
<span class="cp">    }</span>

<span class="cp">    warn &quot;\t(MISSING DESC FOR $File::Find::name)\n&quot;</span>
<span class="cp">        if $opt_w;</span>

<span class="cp">    return 0;</span>
<span class="cp">}</span>

<span class="cp"># run Perl to load the module and print its verson number, redirecting</span>
<span class="cp"># errors to /dev/null</span>
<span class="cp">sub getversion {</span>
<span class="cp">    my $mod = shift;</span>

<span class="cp">    my $vers = `$^X -m$mod -e &#39;print \$${mod}::VERSION&#39; 2&gt;/dev/null`;</span>
<span class="cp">    $vers =~ s/^\s*(.*?)\s*$/$1/; # remove stray whitespace</span>
<span class="cp">    return ($vers || undef);</span>
<span class="cp">}</span>

<span class="cp">format  =</span>
<span class="cp">^&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;~~^&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>
<span class="cp">$Module,        $_</span>
<span class="cp">.</span>

<span class="cp">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="referencesandrecords.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="classesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>References and Records</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Classes, Objects, and Ties</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>