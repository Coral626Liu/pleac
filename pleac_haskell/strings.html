<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Strings</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Haskell"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="PLEAC-Haskell"
HREF="index.html"><LINK
REL="NEXT"
TITLE="Numbers"
HREF="numbers.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Haskell</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="index.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="numbers.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="STRINGS"
>1. Strings</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN14"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="nf">str</span>  <span class="ow">=</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">n&quot;</span>                             <span class="c1">-- two characters, \ and an n</span>
<span class="nf">str2</span> <span class="ow">=</span> <span class="s">&quot;Jon &#39;Maddog&#39; Orwant&quot;</span>             <span class="c1">-- in haskell we can do string only with &quot;, no single quote</span>
<span class="nf">str3</span> <span class="ow">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>                              <span class="c1">-- a &quot;newline&quot; character</span>
<span class="nf">str4</span> <span class="ow">=</span> <span class="s">&quot;Jon </span><span class="se">\&quot;</span><span class="s">Maddog</span><span class="se">\&quot;</span><span class="s"> Orwant&quot;</span>           <span class="c1">-- literal double quotes</span>
<span class="nf">str5</span> <span class="ow">=</span> <span class="s">&quot;Multiline string must use a backslash at end of line</span><span class="se">\n\</span>
<span class="se">\</span><span class="s">and a backslash at beginning of line</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="nf">str6</span> <span class="ow">=</span> <span class="s">&quot;It is a common practice</span><span class="se">\n\</span>
<span class="se">       \</span><span class="s">to indent lines</span><span class="se">\n\</span>
<span class="se">       \</span><span class="s">(the indentation doesn&#39;t change the value of the string)</span><span class="se">\n</span><span class="s">&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN17"
>Accessing Substrings</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="nf">groupNelem</span> <span class="n">n</span> <span class="ow">=</span> <span class="n">unfoldr</span> <span class="n">f</span>
    <span class="kr">where</span> <span class="n">f</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="kt">Nothing</span>
          <span class="n">f</span> <span class="n">s</span> <span class="ow">=</span> <span class="kt">Just</span> <span class="p">(</span><span class="n">splitAt</span> <span class="n">n</span> <span class="n">s</span><span class="p">)</span>

<span class="c1">-- split at five byte boundaries</span>
<span class="nf">fivers</span> <span class="ow">=</span> <span class="n">groupNelem</span> <span class="mi">5</span>

<span class="c1">-- chop string into individual characters:</span>
<span class="c1">-- nothing to do</span>

<span class="nf">s</span>     <span class="ow">=</span> <span class="s">&quot;This is what you have&quot;</span>
<span class="nf">first</span> <span class="ow">=</span> <span class="n">take</span> <span class="mi">1</span> <span class="n">s</span>                          <span class="c1">-- &quot;T&quot;</span>
<span class="nf">start</span> <span class="ow">=</span> <span class="n">take</span> <span class="mi">2</span> <span class="o">$</span> <span class="n">drop</span> <span class="mi">5</span> <span class="n">s</span>                 <span class="c1">-- &quot;is&quot;</span>
<span class="nf">rest</span>  <span class="ow">=</span> <span class="n">drop</span> <span class="mi">13</span> <span class="n">s</span>                         <span class="c1">-- &quot;you have&quot;</span>
<span class="nf">last&#39;</span> <span class="ow">=</span> <span class="n">last</span> <span class="n">s</span>                            <span class="c1">-- &#39;e&#39;</span>

<span class="kr">import</span> <span class="nn">Text.Regex</span>
<span class="nf">s</span> <span class="ow">=</span> <span class="s">&quot;This is what you have&quot;</span>

<span class="c1">-- strings are immutable</span>
<span class="nf">s2</span> <span class="ow">=</span> <span class="n">a</span> <span class="o">++</span> <span class="s">&quot;wasn&#39;t&quot;</span> <span class="o">++</span> <span class="n">drop</span> <span class="mi">2</span> <span class="n">b</span>
     <span class="kr">where</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">=</span> <span class="n">splitAt</span> <span class="mi">5</span> <span class="n">s</span>
<span class="nf">s3</span> <span class="ow">=</span> <span class="n">subRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot; is &quot;</span><span class="p">)</span> <span class="n">s</span> <span class="s">&quot; wasn&#39;t &quot;</span> <span class="c1">-- &quot;This wasn&#39;t what you have&quot;</span>

<span class="c1">-- substitute &quot;at&quot; for &quot;is&quot;, restricted to first five characters</span>
<span class="nf">s4</span> <span class="ow">=</span> <span class="n">a&#39;</span> <span class="o">++</span> <span class="n">b</span>
    <span class="kr">where</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">=</span> <span class="n">splitAt</span> <span class="mi">5</span> <span class="n">s</span>
          <span class="n">a&#39;</span> <span class="ow">=</span> <span class="n">subRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;is&quot;</span><span class="p">)</span> <span class="n">a</span> <span class="s">&quot;at&quot;</span>
<span class="c1">-- do it another way</span>
<span class="kr">import</span> <span class="nn">Text.Regex</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Control.Arrow</span> <span class="k">as</span> <span class="n">Arrow</span>
<span class="nf">f</span> <span class="ow">=</span> <span class="n">uncurry</span> <span class="p">(</span><span class="o">++</span><span class="p">)</span> <span class="o">.</span> <span class="kt">Arrow</span><span class="o">.</span><span class="n">first</span> <span class="n">subst</span> <span class="o">.</span> <span class="n">splitAt</span> <span class="mi">5</span>
    <span class="kr">where</span> <span class="n">subst</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">subRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;is&quot;</span><span class="p">)</span> <span class="n">s</span> <span class="s">&quot;at&quot;</span>

<span class="c1">-- unpack chars using parsec</span>
<span class="kr">import</span> <span class="nn">Text.ParserCombinators.Parsec</span>
<span class="nf">fromRight</span> <span class="p">(</span><span class="kt">Right</span> <span class="n">v</span><span class="p">)</span> <span class="ow">=</span> <span class="n">v</span>
<span class="nf">fromRight</span> <span class="n">v</span> <span class="ow">=</span> <span class="ne">error</span> <span class="p">(</span><span class="s">&quot;fromRight: &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">v</span><span class="p">)</span>
<span class="nf">parseStr</span> <span class="n">parser</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">fromRight</span> <span class="o">$</span> <span class="n">parse</span> <span class="n">parser</span> <span class="s">&quot;&quot;</span> <span class="n">s</span>
<span class="nf">nchars</span> <span class="n">n</span> <span class="ow">=</span> <span class="n">count</span> <span class="n">n</span> <span class="n">anyToken</span>

<span class="nf">a</span> <span class="ow">=</span> <span class="s">&quot;To be or not to be&quot;</span>
<span class="nf">b</span> <span class="ow">=</span> <span class="n">parseStr</span> <span class="p">(</span><span class="n">nchars</span> <span class="mi">6</span> <span class="o">&gt;&gt;</span> <span class="n">nchars</span> <span class="mi">6</span><span class="p">)</span> <span class="n">a</span> <span class="c1">-- &quot;or not&quot;</span>

<span class="c1">-- not same example as perl&#39;s unpack with &quot;X5&quot; which means &quot;back up a byte&quot;</span>
<span class="c1">-- here is an example using lookAhead where we start again at some point</span>
<span class="p">[</span><span class="n">b3</span><span class="p">,</span><span class="n">c3</span><span class="p">]</span> <span class="ow">=</span> <span class="n">parseStr</span> <span class="p">(</span><span class="n">sequence</span> <span class="p">[</span> <span class="n">lookAhead</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="p">])</span> <span class="n">a</span> <span class="c1">-- [&quot;or&quot;,&quot;be&quot;]</span>
          <span class="kr">where</span> <span class="n">p1</span> <span class="ow">=</span> <span class="n">nchars</span> <span class="mi">6</span> <span class="o">&gt;&gt;</span> <span class="n">nchars</span> <span class="mi">2</span>
                <span class="n">p2</span> <span class="ow">=</span> <span class="n">nchars</span> <span class="mi">3</span> <span class="o">&gt;&gt;</span> <span class="n">nchars</span> <span class="mi">2</span>


<span class="kr">import</span> <span class="nn">List</span>
<span class="nf">cut2fmt</span> <span class="n">l</span> <span class="ow">=</span> <span class="n">zipWith</span> <span class="p">(</span><span class="o">-</span><span class="p">)</span> <span class="n">l</span> <span class="p">(</span><span class="mi">1</span><span class="kt">:</span><span class="n">l</span><span class="p">)</span>
<span class="nf">applyfmt</span> <span class="n">fmt</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">l</span> <span class="o">++</span> <span class="p">[</span><span class="n">s&#39;</span><span class="p">]</span>
    <span class="kr">where</span> <span class="p">(</span><span class="n">s&#39;</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="ow">=</span> <span class="n">mapAccumL</span> <span class="n">f</span> <span class="n">s</span> <span class="n">fmt</span>
          <span class="n">f</span> <span class="n">s</span> <span class="n">n</span> <span class="ow">=</span> <span class="p">(</span><span class="n">s&#39;</span><span class="p">,</span><span class="n">subs</span><span class="p">)</span>
              <span class="kr">where</span> <span class="p">(</span><span class="n">subs</span><span class="p">,</span><span class="n">s&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">splitAt</span> <span class="n">n</span> <span class="n">s</span>

<span class="nf">fmt</span> <span class="ow">=</span> <span class="n">cut2fmt</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">30</span><span class="p">]</span> <span class="c1">-- [7,6,6,6,4]</span>
<span class="nf">l</span> <span class="ow">=</span> <span class="n">applyfmt</span> <span class="n">fmt</span> <span class="s">&quot;12345678912345678901234567890123456789&quot;</span> 
<span class="c1">-- 1234567 891234 567890 123456 7890 123456789</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN20"
>Establishing a Default Value</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">-- boolean operators only work on booleans</span>
<span class="nf">a</span> <span class="ow">=</span> <span class="n">b</span> <span class="o">||</span> <span class="n">c</span>

<span class="c1">-- if you have an optional value, use type Maybe</span>
<span class="kr">import</span> <span class="nn">Maybe</span>
<span class="nf">v1</span> <span class="ow">=</span> <span class="n">fromMaybe</span> <span class="s">&quot;b&quot;</span> <span class="o">$</span> <span class="kt">Just</span> <span class="s">&quot;a&quot;</span>   <span class="c1">-- &quot;a&quot;</span>
<span class="nf">v2</span> <span class="ow">=</span> <span class="n">fromMaybe</span> <span class="s">&quot;b&quot;</span> <span class="o">$</span> <span class="kt">Nothing</span>    <span class="c1">-- &quot;b&quot;</span>

<span class="c1">-- to combine Maybe values, you can use mplus</span>
<span class="kr">import</span> <span class="nn">Control.Monad</span> <span class="p">(</span><span class="nf">mplus</span><span class="p">)</span>

<span class="nf">v1&#39;</span> <span class="ow">=</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;a&quot;</span><span class="p">)</span> <span class="p">`</span><span class="n">mplus</span><span class="p">`</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;b&quot;</span><span class="p">)</span> <span class="c1">-- Just &quot;a&quot;</span>
<span class="nf">v2&#39;</span> <span class="ow">=</span> <span class="kt">Nothing</span> <span class="p">`</span><span class="n">mplus</span><span class="p">`</span> <span class="p">(</span><span class="kt">Just</span> <span class="s">&quot;b&quot;</span><span class="p">)</span>    <span class="c1">-- Just &quot;b&quot;</span>

<span class="c1">-- you could also define some perlish things:</span>
<span class="kr">class</span> <span class="kt">Default_val</span> <span class="n">a</span> <span class="kr">where</span>
    <span class="n">default_val</span> <span class="ow">::</span> <span class="n">a</span>
    <span class="n">is_default_val</span> <span class="ow">::</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>

<span class="kr">instance</span> <span class="kt">Default_val</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="kr">where</span> 
    <span class="n">default_val</span> <span class="ow">=</span> <span class="kt">[]</span>
    <span class="n">is_default_val</span> <span class="ow">=</span> <span class="n">null</span>
<span class="kr">instance</span> <span class="kt">Default_val</span> <span class="kt">Num</span> <span class="kr">where</span> 
    <span class="n">default_val</span> <span class="ow">=</span> <span class="mi">0</span>
    <span class="n">is_default_val</span> <span class="ow">=</span> <span class="p">(</span><span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

<span class="nf">a</span> <span class="o">&amp;&amp;&amp;</span> <span class="n">b</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">a</span><span class="o">.</span><span class="n">is_default_val</span> <span class="kr">then</span> <span class="n">default_val</span> <span class="kr">else</span> <span class="n">b</span>
<span class="nf">a</span> <span class="o">|||</span> <span class="n">b</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">a</span><span class="o">.</span><span class="n">is_default_val</span> <span class="kr">then</span> <span class="n">b</span> <span class="kr">else</span> <span class="n">a</span>

<span class="nf">foo</span> <span class="ow">=</span> <span class="n">bar</span> <span class="o">|||</span> <span class="s">&quot;DEFAULT VALUE&quot;</span>

<span class="c1">--</span>
<span class="kr">import</span> <span class="nn">Maybe</span>
<span class="kr">import</span> <span class="nn">System</span>
<span class="nf">argv0</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="n">listToMaybe</span> <span class="n">getArgs</span>
<span class="nf">dir</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="p">(</span><span class="n">fromMaybe</span> <span class="s">&quot;/tmp&quot;</span><span class="p">)</span> <span class="n">argv0</span>

<span class="c1">-- or</span>
<span class="nf">dir&#39;</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="p">(</span><span class="n">head</span> <span class="o">.</span> <span class="p">(</span><span class="o">++</span> <span class="p">[</span><span class="s">&quot;/tmp&quot;</span><span class="p">]))</span> <span class="n">getArgs</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN23"
>Exchanging Values Without Using Temporary Variables</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">-- no side effect in haskell =&gt; swap is a nonsense</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN26"
>Converting Between ASCII Characters and Values</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="kr">import</span> <span class="nn">Char</span>
<span class="nf">i</span> <span class="ow">=</span> <span class="n">ord</span> <span class="n">&#39;e&#39;</span>                     <span class="c1">-- 101</span>
<span class="nf">c</span> <span class="ow">=</span> <span class="n">chr</span> <span class="mi">101</span>                     <span class="c1">-- &#39;e&#39;</span>

<span class="kr">import</span> <span class="nn">Text.Printf</span>
<span class="nf">printf</span> <span class="s">&quot;Number %d is character %c</span><span class="se">\n</span><span class="s">&quot;</span> <span class="mi">101</span> <span class="mi">101</span>

<span class="nf">ascii_character_numbers</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">ord</span> <span class="s">&quot;sample&quot;</span> <span class="c1">-- [115,97,109,112,108,101]</span>
<span class="nf">word</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">chr</span> <span class="n">ascii_character_numbers</span>

<span class="nf">ibm</span> <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="n">chr</span> <span class="o">.</span> <span class="p">(</span><span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">.</span> <span class="n">ord</span><span class="p">)</span> <span class="s">&quot;HAL&quot;</span> <span class="c1">-- &quot;IBM&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN29"
>Processing a String One Character at a Time</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="nf">s</span> <span class="ow">=</span> <span class="s">&quot;an apple a day&quot;</span>
<span class="nf">msg1</span> <span class="ow">=</span> <span class="s">&quot;unique chars are: &quot;</span> <span class="o">++</span> <span class="n">sort</span> <span class="p">(</span><span class="n">nub</span> <span class="n">s</span><span class="p">)</span>
<span class="nf">msg2</span> <span class="ow">=</span> <span class="s">&quot;sum is &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">show</span> <span class="o">$</span> <span class="n">sum</span> <span class="o">$</span> <span class="n">map</span> <span class="n">ord</span> <span class="o">$</span> <span class="n">s</span><span class="p">)</span>


<span class="c1">-- slowcat -----------------------</span>
<span class="o">#!/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">runghc</span>
<span class="cm">{-# OPTIONS_GHC -fglasgow-exts #-}</span>

<span class="kr">import</span> <span class="nn">System</span>
<span class="kr">import</span> <span class="nn">System.IO</span>
<span class="kr">import</span> <span class="nn">System.Posix</span>
<span class="kr">import</span> <span class="nn">Text.Regex</span>

<span class="nf">any_input</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="n">getContents</span>
<span class="nf">any_input</span> <span class="p">(</span><span class="n">f</span><span class="kt">:</span><span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">readFile</span> <span class="n">f</span>

<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span> <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">args&#39;</span><span class="p">)</span> <span class="ow">&lt;-</span> <span class="n">fmap</span> <span class="n">get_time</span> <span class="n">getArgs</span>
          <span class="n">s</span> <span class="ow">&lt;-</span> <span class="n">any_input</span> <span class="n">args&#39;</span>
          <span class="n">hSetBuffering</span> <span class="n">stdout</span> <span class="kt">NoBuffering</span>
          <span class="n">mapM_</span> <span class="p">(</span><span class="nf">\</span><span class="n">c</span> <span class="ow">-&gt;</span> <span class="n">putChar</span> <span class="n">c</span> <span class="o">&gt;&gt;</span> <span class="n">usleep</span> <span class="p">(</span><span class="mi">5000</span> <span class="o">*</span> <span class="n">time</span><span class="p">))</span> <span class="n">s</span>
    <span class="kr">where</span> <span class="n">get_time</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">args</span><span class="p">)</span>
              <span class="o">|</span> <span class="p">(</span><span class="kt">Just</span> <span class="p">[</span><span class="n">d</span><span class="p">])</span> <span class="ow">&lt;-</span> <span class="n">matchRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;^-([0-9]+)&quot;</span><span class="p">)</span> <span class="n">x</span> <span class="ow">=</span> <span class="p">(</span><span class="n">read</span> <span class="n">d</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
          <span class="n">get_time</span> <span class="n">args</span> <span class="ow">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN32"
>Reversing a String by Word or Character</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="nf">string</span> <span class="ow">=</span> <span class="s">&quot;Yoda said, </span><span class="se">\&quot;</span><span class="s">can you see this?</span><span class="se">\&quot;</span><span class="s">&quot;</span>
<span class="nf">allwords</span> <span class="ow">=</span> <span class="n">words</span> <span class="n">string</span>
<span class="nf">revwords</span> <span class="ow">=</span> <span class="n">unwords</span> <span class="p">(</span><span class="n">reverse</span> <span class="n">allwords</span><span class="p">)</span>

<span class="nf">revwords</span> <span class="ow">=</span> <span class="p">(</span><span class="n">unwords</span> <span class="o">.</span> <span class="n">reverse</span> <span class="o">.</span> <span class="n">words</span><span class="p">)</span> <span class="n">string</span>

<span class="c1">-- another version of revwords which works for spaces</span>
<span class="nf">revwords&#39;</span> <span class="ow">=</span> <span class="p">(</span><span class="n">unwords</span> <span class="o">.</span> <span class="n">reverse</span> <span class="o">.</span> <span class="n">splitRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot; &quot;</span><span class="p">))</span> <span class="n">string</span>

<span class="c1">-- yet another version using a home made version of splitRegex&#39; which keeps the matched string</span>
<span class="kr">import</span> <span class="nn">List</span>
<span class="kr">import</span> <span class="nn">Text.Regex</span>

<span class="c1">-- special unfoldr (unfoldr only returns [b] whereas we also need the rest)</span>
<span class="c1">-- nb: we can use Control.Arrow.first which is \f (a,b) -&gt; (f a, b)</span>
<span class="c1">--     and write:  Arrow.first (a :) (unfoldr&#39; f b&#39;)</span>
<span class="nf">unfoldr&#39;</span> <span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="p">([</span><span class="n">b</span><span class="p">],</span> <span class="n">a</span><span class="p">)</span>
<span class="nf">unfoldr&#39;</span> <span class="n">f</span> <span class="n">b</span>  <span class="ow">=</span>
  <span class="kr">case</span> <span class="n">f</span> <span class="n">b</span> <span class="kr">of</span>
   <span class="kt">Just</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b&#39;</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kr">let</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">b&#39;&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">unfoldr&#39;</span> <span class="n">f</span> <span class="n">b&#39;</span> <span class="kr">in</span> <span class="p">(</span><span class="n">a</span><span class="kt">:</span><span class="n">l</span><span class="p">,</span> <span class="n">b&#39;&#39;</span><span class="p">)</span>
   <span class="kt">Nothing</span>      <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">[]</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="nf">splitRegex&#39;</span> <span class="ow">::</span> <span class="kt">Regex</span> <span class="ow">-&gt;</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="p">[(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">)]</span>
<span class="nf">splitRegex&#39;</span> <span class="n">re</span> <span class="n">s</span> <span class="ow">=</span> 
    <span class="kr">case</span> <span class="n">unfoldr&#39;</span> <span class="n">f</span> <span class="n">s</span> <span class="kr">of</span>
      <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">l</span>
      <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">l</span> <span class="o">++</span> <span class="p">[(</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)]</span>
    <span class="kr">where</span> 
      <span class="c1">-- small helper functions which tranform matchRegexAll output</span>
      <span class="c1">-- to the one wanted by unfoldr&#39;</span>
      <span class="n">f</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="n">f&#39;</span> <span class="o">.</span> <span class="n">matchRegexAll</span> <span class="n">re</span>
      <span class="n">f&#39;</span> <span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">matched</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="p">((</span><span class="n">before</span><span class="p">,</span> <span class="n">matched</span><span class="p">),</span> <span class="n">after</span><span class="p">)</span>

<span class="nf">words&#39;</span> <span class="ow">=</span> <span class="n">concatMap</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">])</span> <span class="o">.</span> <span class="n">splitRegex&#39;</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">s+&quot;</span><span class="p">)</span>

<span class="nf">revwords&#39;</span> <span class="ow">=</span> <span class="p">(</span><span class="n">concat</span> <span class="o">.</span> <span class="n">reverse</span> <span class="o">.</span> <span class="n">words&#39;</span><span class="p">)</span> <span class="n">string</span>

<span class="cm">{-</span>
<span class="cm">import Test.QuickCheck</span>
<span class="cm">import Char</span>

<span class="cm">instance Arbitrary Char where</span>
<span class="cm">    arbitrary     = fmap chr $ choose (32,255)</span>
<span class="cm">    coarbitrary n = variant (ord n)</span>

<span class="cm">property_words&#39; s = (concat . words&#39;) s == s</span>
<span class="cm">verif = quickCheck property_words&#39;</span>
<span class="cm">-}</span>
<span class="c1">--</span>

<span class="nf">word</span> <span class="ow">=</span> <span class="s">&quot;reviver&quot;</span><span class="p">;</span>
<span class="nf">is_palindrome</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">s</span> <span class="o">==</span> <span class="n">reverse</span> <span class="n">s</span>

<span class="nf">long_palindromes</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="p">(</span><span class="n">filter</span> <span class="p">(</span><span class="nf">\</span><span class="n">s</span> <span class="ow">-&gt;</span> <span class="n">s</span> <span class="o">==</span> <span class="n">reverse</span> <span class="n">s</span> <span class="o">&amp;&amp;</span> <span class="n">length</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">.</span> <span class="n">lines</span><span class="p">)</span> <span class="o">$</span>
                      <span class="n">readFile</span> <span class="s">&quot;/usr/share/dict/words&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN35"
>Expanding and Compressing Tabs</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span>
<span class="nf">expand_tabs</span> <span class="s">&quot;&quot;</span> <span class="ow">=</span> <span class="s">&quot;&quot;</span>
<span class="nf">expand_tabs</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">foldr1</span> <span class="p">((</span><span class="o">++</span><span class="p">)</span> <span class="o">.</span> <span class="n">adjust</span><span class="p">)</span> <span class="o">$</span> <span class="n">splitRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">)</span> <span class="n">s</span>
    <span class="kr">where</span> <span class="n">adjust</span> <span class="n">a</span> <span class="ow">=</span> <span class="n">a</span> <span class="o">++</span> <span class="n">replicate</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="p">(</span><span class="n">length</span> <span class="n">a</span><span class="p">)</span> <span class="p">`</span><span class="n">mod</span><span class="p">`</span> <span class="mi">8</span><span class="p">)</span> <span class="sc">&#39; &#39;</span>

<span class="c1">-- replace spaces with tab</span>
<span class="nf">unexpand</span> <span class="ow">=</span> <span class="n">concat</span> <span class="o">.</span> <span class="n">map</span> <span class="p">(</span><span class="n">reverse</span> <span class="o">.</span> <span class="n">unexp</span> <span class="o">.</span> <span class="n">reverse</span><span class="p">)</span> <span class="o">.</span> <span class="n">groupNelem</span> <span class="mi">8</span> <span class="kr">where</span>
    <span class="n">unexp</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">head</span> <span class="n">s</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span> <span class="o">&amp;&amp;</span> <span class="n">length</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">8</span> 
              <span class="kr">then</span> <span class="sc">&#39;</span><span class="se">\t</span><span class="sc">&#39;</span> <span class="kt">:</span> <span class="n">dropWhile</span> <span class="p">(</span><span class="o">==</span> <span class="sc">&#39; &#39;</span><span class="p">)</span> <span class="n">s</span>
              <span class="kr">else</span> <span class="n">s</span>
<span class="cm">{- </span>
<span class="cm">   Here is a property that can be given to quickCheck </span>
<span class="cm">   property_expand s = (expand_tabs . unexpand) s == s</span>
<span class="cm">-}</span>
			</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN38"
>Expanding Variables in User Input</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">-- can&#39;t do eval in haskell</span>

<span class="c1">-- subRegex only allow a fixed string</span>
<span class="c1">-- subRegexOnceWith below takes a (String -&gt; String) function to compute a result</span>
<span class="c1">-- (and do the substitution only once)</span>
<span class="nf">subRegexOnceWith</span> <span class="n">re</span> <span class="n">new</span> <span class="n">s</span> <span class="ow">=</span> 
    <span class="kr">case</span> <span class="n">matchRegexAll</span> <span class="n">re</span> <span class="n">s</span> <span class="kr">of</span>
      <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="n">s</span>
      <span class="kt">Just</span> <span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">matched</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">before</span> <span class="o">++</span> <span class="n">new</span> <span class="n">matched</span> <span class="o">++</span> <span class="n">after</span>
<span class="nf">s</span> <span class="ow">=</span> <span class="n">subRegexOnceWith</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;[0-9]+&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">show</span> <span class="o">.</span> <span class="p">(</span><span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">.</span> <span class="n">read</span><span class="p">)</span> <span class="s">&quot;I am 17 years old&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN41"
>Controlling Case</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="kr">import</span> <span class="nn">Char</span>
<span class="nf">s1</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">toUpper</span> <span class="s">&quot;dromedary&quot;</span>       <span class="c1">-- &quot;DROMEDARY&quot;</span>
<span class="nf">s2</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">toLower</span> <span class="n">s1</span>              <span class="c1">-- &quot;dromedary&quot;</span>
<span class="nf">s3</span> <span class="ow">=</span> <span class="n">toUpper</span> <span class="p">(</span><span class="n">head</span> <span class="n">s2</span><span class="p">)</span> <span class="kt">:</span> <span class="n">tail</span> <span class="n">s2</span>

<span class="nf">capitalize</span> <span class="s">&quot;&quot;</span> <span class="ow">=</span> <span class="s">&quot;&quot;</span>
<span class="nf">capitalize</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">toUpper</span> <span class="n">x</span> <span class="kt">:</span> <span class="n">map</span> <span class="n">toLower</span> <span class="n">xs</span>

<span class="c1">-- capitalize each word&#39;s first character, downcase the rest</span>
<span class="nf">s4</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">capitalize</span> <span class="o">$</span> <span class="n">words</span> <span class="s">&quot;thIS is a loNG liNE&quot;</span>

<span class="c1">-- randcap: filter to randomly capitalize 20% of the letters</span>
<span class="o">#!/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">runghc</span>
<span class="kr">import</span> <span class="nn">System</span>
<span class="kr">import</span> <span class="nn">System.IO</span>
<span class="kr">import</span> <span class="nn">Random</span>
<span class="kr">import</span> <span class="nn">Char</span>

<span class="nf">any_input</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="n">getContents</span>
<span class="nf">any_input</span> <span class="p">(</span><span class="n">f</span><span class="kt">:</span><span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">readFile</span> <span class="n">f</span>

<span class="nf">rand</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">Int</span>
<span class="nf">rand</span> <span class="n">low</span> <span class="n">high</span> <span class="ow">=</span> <span class="n">getStdRandom</span> <span class="p">(</span><span class="n">randomR</span> <span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">))</span>

<span class="nf">randcap</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">String</span>
<span class="nf">randcap</span> <span class="ow">=</span> <span class="n">sequence</span> <span class="o">.</span> <span class="n">map</span> <span class="n">f</span> <span class="kr">where</span>
      <span class="n">f</span> <span class="n">c</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="p">(</span><span class="n">modify_char</span> <span class="n">c</span><span class="p">)</span> <span class="o">$</span> <span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
      <span class="n">modify_char</span> <span class="n">c</span> <span class="n">n</span> <span class="ow">=</span> <span class="p">(</span><span class="kr">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span> <span class="n">toUpper</span> <span class="kr">else</span> <span class="n">toLower</span><span class="p">)</span> <span class="n">c</span>

<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">s</span> <span class="ow">&lt;-</span> <span class="n">getArgs</span> <span class="o">&gt;&gt;=</span> <span class="n">any_input</span>
          <span class="n">randcap</span> <span class="n">s</span> <span class="o">&gt;&gt;=</span> <span class="n">putStr</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN44"
>Interpolating Functions and Expressions Within Strings</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="nf">s</span> <span class="ow">=</span> <span class="s">&quot;I have &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">++</span> <span class="s">&quot; guanacos.&quot;</span>

<span class="c1">-- multiline strings are quite ugly in haskell</span>
<span class="c1">-- so skipping the send_mail example</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN47"
>Indenting Here Documents</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="nf">var</span> <span class="ow">=</span> <span class="s">&quot;your text</span><span class="se">\n\</span>
<span class="se">      \</span><span class="s">goes here</span><span class="se">\n</span><span class="s">&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN50"
>Reformatting Paragraphs</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="kr">import</span> <span class="nn">Data.List</span>

<span class="nf">input</span> <span class="ow">=</span> <span class="s">&quot;Folding and splicing is the work of an editor,</span><span class="se">\</span>
<span class="se">        \</span><span class="s"> not a mere collection of silicon and mobile electrons!&quot;</span>

<span class="nf">wrap</span> <span class="n">columns</span> <span class="n">first_indent</span> <span class="n">indent</span> <span class="n">s</span> <span class="ow">=</span>
	<span class="n">intercalate</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">$</span> <span class="n">wgroup</span> <span class="p">(</span><span class="n">tail</span> <span class="n">first_indent</span><span class="p">)</span> <span class="p">(</span><span class="n">words</span> <span class="n">s</span><span class="p">)</span>
	<span class="kr">where</span> <span class="n">wgroup</span> <span class="n">current</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="p">[</span><span class="n">current</span><span class="p">]</span>
	      <span class="n">wgroup</span> <span class="n">current</span> <span class="p">(</span><span class="n">w</span> <span class="kt">:</span> <span class="n">ws</span><span class="p">)</span> <span class="ow">=</span>
	        <span class="kr">if</span> <span class="n">length</span> <span class="n">current</span> <span class="o">+</span> <span class="n">length</span> <span class="n">w</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">columns</span> 
                <span class="kr">then</span> <span class="n">wgroup</span> <span class="p">(</span><span class="n">current</span> <span class="o">++</span> <span class="s">&quot; &quot;</span> <span class="o">++</span> <span class="n">w</span><span class="p">)</span> <span class="n">ws</span> 
                <span class="kr">else</span> <span class="n">current</span> <span class="kt">:</span> <span class="n">wgroup</span> <span class="p">(</span><span class="n">indent</span> <span class="o">++</span> <span class="n">w</span><span class="p">)</span> <span class="n">ws</span>


<span class="c1">-- another version</span>
<span class="nf">wrap_simple</span> <span class="n">columns</span> <span class="n">s</span> <span class="ow">=</span>
    <span class="n">intercalate</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">$</span> <span class="n">map</span> <span class="n">unwords</span> <span class="o">$</span> <span class="n">groupWhile</span> <span class="n">pred</span> <span class="o">$</span> <span class="n">words</span> <span class="n">s</span>
    <span class="kr">where</span> <span class="n">pred</span> <span class="ow">=</span> <span class="p">(</span><span class="o">&lt;=</span> <span class="n">columns</span><span class="p">)</span> <span class="o">.</span> <span class="n">sum</span> <span class="o">.</span> <span class="n">map</span> <span class="p">((</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">.</span> <span class="n">length</span><span class="p">)</span>

<span class="nf">wrap</span> <span class="n">columns</span> <span class="n">first_indent</span> <span class="n">indent</span> <span class="n">s</span> <span class="ow">=</span>
    <span class="n">first_indent</span> <span class="o">++</span> <span class="n">intercalate</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">++</span> <span class="n">indent</span><span class="p">)</span> <span class="p">(</span><span class="n">map</span> <span class="n">unwords</span> <span class="o">$</span> <span class="n">first</span> <span class="kt">:</span> <span class="n">next</span><span class="p">)</span>
    <span class="kr">where</span> <span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span> <span class="ow">=</span> <span class="n">spanWhile</span> <span class="p">(</span><span class="n">pred</span> <span class="o">$</span> <span class="n">columns</span> <span class="o">-</span> <span class="n">length</span> <span class="n">first_indent</span><span class="p">)</span> <span class="p">(</span><span class="n">words</span> <span class="n">s</span><span class="p">)</span>
          <span class="n">next</span> <span class="ow">=</span> <span class="n">groupWhile</span> <span class="p">(</span><span class="n">pred</span> <span class="o">$</span> <span class="n">columns</span> <span class="o">-</span> <span class="n">length</span> <span class="n">indent</span><span class="p">)</span> <span class="n">rest</span> 
          <span class="n">pred</span> <span class="n">width</span> <span class="ow">=</span> <span class="p">(</span><span class="o">&lt;=</span> <span class="n">width</span><span class="p">)</span> <span class="o">.</span> <span class="n">sum</span> <span class="o">.</span> <span class="n">map</span> <span class="p">((</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">.</span> <span class="n">length</span><span class="p">)</span>

<span class="nf">spanWhile</span> <span class="ow">::</span> <span class="p">([</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="p">([</span><span class="n">a</span><span class="p">],[</span><span class="n">a</span><span class="p">])</span>
<span class="nf">spanWhile</span> <span class="n">p</span> <span class="n">l</span> <span class="ow">=</span> <span class="n">spanWhile&#39;</span> <span class="kt">[]</span> <span class="n">l</span>              
    <span class="kr">where</span> <span class="n">spanWhile&#39;</span> <span class="n">seen</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="p">(</span><span class="n">seen</span><span class="p">,</span> <span class="kt">[]</span><span class="p">)</span>
          <span class="n">spanWhile&#39;</span> <span class="n">seen</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span>
              <span class="kr">let</span> <span class="n">seen&#39;</span> <span class="ow">=</span> <span class="n">seen</span> <span class="o">++</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="kr">in</span>
              <span class="kr">if</span> <span class="n">p</span> <span class="n">seen&#39;</span> <span class="kr">then</span> <span class="n">spanWhile&#39;</span> <span class="n">seen&#39;</span> <span class="n">xs</span> <span class="kr">else</span> <span class="p">(</span><span class="n">seen</span><span class="p">,</span> <span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span>

<span class="nf">groupWhile</span> <span class="ow">::</span> <span class="p">([</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="p">[[</span><span class="n">a</span><span class="p">]]</span>
<span class="nf">groupWhile</span> <span class="n">p</span> <span class="n">l</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">spanWhile</span> <span class="n">p</span> <span class="n">l</span> <span class="kr">of</span>
                   <span class="p">(</span><span class="kt">[]</span><span class="p">,</span> <span class="kt">[]</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">[]</span>
                   <span class="p">(</span><span class="n">l&#39;</span><span class="p">,</span> <span class="kt">[]</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">l&#39;</span><span class="p">]</span>
                   <span class="p">(</span><span class="n">l&#39;</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">l&#39;</span> <span class="kt">:</span> <span class="n">groupWhile</span> <span class="n">p</span> <span class="n">rest</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN53"
>Escaping Characters</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="kr">import</span> <span class="nn">Text.Regex</span>
<span class="kr">import</span> <span class="nn">Char</span>

<span class="nf">subRegexWith</span> <span class="n">re</span> <span class="n">new</span> <span class="n">s</span> <span class="ow">=</span>
    <span class="kr">case</span> <span class="n">matchRegexAll</span> <span class="n">re</span> <span class="n">s</span> <span class="kr">of</span>
      <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="n">s</span>
      <span class="kt">Just</span> <span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">matched</span><span class="p">,</span> <span class="n">after</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">before</span> <span class="o">++</span> <span class="n">new</span> <span class="n">matched</span> <span class="o">++</span> <span class="p">(</span><span class="n">subRegexWith</span> <span class="n">re</span> <span class="n">new</span> <span class="n">after</span><span class="p">)</span>

<span class="nf">quoteMeta</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
<span class="nf">quoteMeta</span> <span class="ow">=</span> <span class="n">concatMap</span> <span class="p">(</span><span class="nf">\</span><span class="n">c</span> <span class="ow">-&gt;</span> <span class="kr">if</span> <span class="p">(</span><span class="n">isAlphaNum</span> <span class="n">c</span><span class="p">)</span> <span class="kr">then</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="kr">else</span> <span class="p">[</span><span class="sc">&#39;</span><span class="se">\\</span><span class="sc">&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">])</span>

<span class="nf">t1</span> <span class="ow">=</span> <span class="n">subRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="o">$</span> <span class="n">quoteMeta</span> <span class="s">&quot;^&quot;</span><span class="p">)</span> <span class="s">&quot;foo^bar&quot;</span> <span class="s">&quot;+&quot;</span> <span class="c1">-- &quot;foo+bar&quot; (without the quoteMeta, it goes into a dead loop)</span>
<span class="nf">t2</span> <span class="ow">=</span> <span class="n">subRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="o">$</span> <span class="n">quoteMeta</span> <span class="s">&quot;${&quot;</span><span class="p">)</span> <span class="s">&quot;${foo}bar&quot;</span> <span class="s">&quot;{&quot;</span> <span class="c1">-- &quot;{foo}bar&quot;</span>
<span class="nf">t3</span> <span class="ow">=</span> <span class="n">subRegexWith</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">$</span><span class="se">\\</span><span class="s">{[^}]*</span><span class="se">\\</span><span class="s">}&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">map</span> <span class="n">toUpper</span><span class="p">)</span> <span class="s">&quot;${foo}bar}&quot;</span> <span class="c1">-- &quot;${FOO}bar}&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN56"
>Trimming Blanks from the Ends of a String</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="nf">trim_beg</span><span class="p">,</span> <span class="n">trim_end</span><span class="p">,</span> <span class="n">trim</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
<span class="nf">trim_beg</span> <span class="ow">=</span> <span class="n">snd</span> <span class="o">.</span> <span class="n">span</span> <span class="n">isSpace</span>
<span class="nf">trim_end</span> <span class="ow">=</span> <span class="n">reverse</span> <span class="o">.</span> <span class="n">trim_beg</span> <span class="o">.</span> <span class="n">reverse</span>
<span class="nf">trim</span> <span class="ow">=</span> <span class="n">trim_end</span> <span class="o">.</span> <span class="n">trim_beg</span>

<span class="nf">trimmed</span> <span class="ow">=</span> <span class="s">&quot;&gt;&quot;</span> <span class="o">++</span> <span class="n">trim</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">       `Here&#39; </span><span class="se">\t</span><span class="s"> </span><span class="se">\t</span><span class="s"> </span><span class="se">\n\n\n</span><span class="s">&quot;</span> <span class="o">++</span> <span class="s">&quot;&lt;&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN59"
>Parsing Comma-Separated Data</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="nf">parse_csv</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span>
<span class="nf">parse_csv</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">lex</span> <span class="n">s</span> <span class="kr">of</span>
	<span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
	<span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xs</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">x</span> <span class="kt">:</span> <span class="n">parse_csv</span> <span class="n">xs</span>
      <span class="kr">where</span>
	   <span class="n">lex</span> <span class="s">&quot;&quot;</span> <span class="ow">=</span> <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
	   <span class="n">lex</span> <span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">xs</span><span class="p">)</span>
	   <span class="n">lex</span> <span class="p">(</span><span class="sc">&#39;&quot;&#39;</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">x</span><span class="o">++</span><span class="n">x&#39;</span><span class="p">,</span><span class="n">xs&#39;&#39;</span><span class="p">)</span> <span class="kr">where</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">xs&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">lexString</span> <span class="n">xs</span>
		                             <span class="p">(</span><span class="n">x&#39;</span><span class="p">,</span><span class="n">xs&#39;&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">lex</span> <span class="n">xs&#39;</span>	 
	   <span class="n">lex</span> <span class="p">(</span><span class="n">other</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">other</span><span class="kt">:</span><span class="n">x</span><span class="p">,</span><span class="n">xs&#39;</span><span class="p">)</span> <span class="kr">where</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">xs&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">lex</span> <span class="n">xs</span>				       

           <span class="n">lexString</span> <span class="p">(</span><span class="sc">&#39;&quot;&#39;</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">xs</span><span class="p">)</span>
	   <span class="n">lexString</span> <span class="p">(</span><span class="sc">&#39;</span><span class="se">\\</span><span class="sc">&#39;</span><span class="kt">:</span><span class="n">c</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="sc">&#39;</span><span class="se">\\</span><span class="sc">&#39;</span><span class="kt">:</span><span class="n">c</span><span class="kt">:</span><span class="n">x</span> <span class="p">,</span> <span class="n">xs&#39;</span><span class="p">)</span> <span class="kr">where</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">xs&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">lexString</span> <span class="n">xs</span>
	   <span class="n">lexString</span> <span class="p">(</span><span class="n">c</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">c</span><span class="kt">:</span><span class="n">x</span><span class="p">,</span><span class="n">xs&#39;</span><span class="p">)</span> <span class="kr">where</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">xs&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">lexString</span> <span class="n">xs</span>

<span class="c1">-- the same using Parsec</span>
<span class="kr">import</span> <span class="nn">Text.ParserCombinators.Parsec</span>

<span class="nf">fromRight</span> <span class="p">(</span><span class="kt">Right</span> <span class="n">v</span><span class="p">)</span> <span class="ow">=</span> <span class="n">v</span>
<span class="nf">fromRight</span> <span class="n">v</span> <span class="ow">=</span> <span class="ne">error</span> <span class="p">(</span><span class="s">&quot;fromRight: &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">v</span><span class="p">)</span>
<span class="nf">parseStr</span> <span class="n">parser</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">fromRight</span> <span class="o">$</span> <span class="n">parse</span> <span class="n">parser</span> <span class="s">&quot;&quot;</span> <span class="n">s</span>
<span class="nf">toList</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="p">(</span><span class="nf">\</span><span class="n">c</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">c</span><span class="p">])</span>
<span class="nf">many_</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="n">concat</span> <span class="o">.</span> <span class="n">many</span>

<span class="nf">parse_csv&#39;</span> <span class="ow">=</span> <span class="n">parseStr</span> <span class="o">$</span> <span class="p">(</span><span class="n">quoted_string</span> <span class="o">&lt;|&gt;</span> <span class="n">raw_string</span><span class="p">)</span> <span class="p">`</span><span class="n">sepBy</span><span class="p">`</span> <span class="n">char</span> <span class="sc">&#39;,&#39;</span>
    <span class="kr">where</span> <span class="n">quoted_string</span> <span class="ow">=</span> <span class="n">between</span> <span class="p">(</span><span class="n">char</span> <span class="sc">&#39;&quot;&#39;</span><span class="p">)</span> <span class="p">(</span><span class="n">char</span> <span class="sc">&#39;&quot;&#39;</span><span class="p">)</span> <span class="p">(</span><span class="n">chars_until</span> <span class="sc">&#39;&quot;&#39;</span><span class="p">)</span>
          <span class="n">raw_string</span> <span class="ow">=</span> <span class="n">chars_until</span> <span class="sc">&#39;,&#39;</span>
          <span class="n">chars_until</span> <span class="n">c</span> <span class="ow">=</span> <span class="n">many_</span> <span class="p">(</span><span class="n">sequence</span> <span class="p">[</span> <span class="n">char</span> <span class="sc">&#39;</span><span class="se">\\</span><span class="sc">&#39;</span><span class="p">,</span> <span class="n">anyChar</span> <span class="p">]</span> <span class="o">&lt;|&gt;</span> <span class="n">toList</span> <span class="p">(</span><span class="n">noneOf</span> <span class="p">[</span><span class="n">c</span><span class="p">]))</span>

<span class="nf">test_string</span> <span class="ow">=</span> <span class="s">&quot;XYZZY,</span><span class="se">\&quot;\&quot;</span><span class="s">,</span><span class="se">\&quot;</span><span class="s">O&#39;Reilly, Inc</span><span class="se">\&quot;</span><span class="s">,</span><span class="se">\&quot;</span><span class="s">Wall, Larry</span><span class="se">\&quot;</span><span class="s">,</span><span class="se">\&quot;</span><span class="s">a </span><span class="se">\\\&quot;</span><span class="s">glub</span><span class="se">\\\&quot;</span><span class="s"> bit,</span><span class="se">\&quot;</span><span class="s">,5,</span><span class="se">\&quot;</span><span class="s">Error, Core Dumped</span><span class="se">\&quot;</span><span class="s">&quot;</span>

<span class="nf">output</span> <span class="ow">=</span> <span class="n">concatMap</span> <span class="n">format_it</span> <span class="o">$</span> <span class="n">zip</span> <span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="p">]</span> <span class="p">(</span><span class="n">parse_csv</span> <span class="n">test_string</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">format_it</span> <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">=</span> <span class="n">show</span> <span class="n">line</span> <span class="o">++</span> <span class="s">&quot; : &quot;</span> <span class="o">++</span> <span class="n">s</span> <span class="o">++</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN62"
>Soundex Matching</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="kr">import</span> <span class="nn">List</span>
<span class="kr">import</span> <span class="nn">Maybe</span>
<span class="kr">import</span> <span class="nn">Char</span>
<span class="kr">import</span> <span class="nn">System.Posix.User</span>

<span class="nf">soundex</span> <span class="n">name</span> <span class="ow">=</span> <span class="p">(</span><span class="n">chars</span><span class="o">!!</span><span class="mi">0</span><span class="p">)</span> <span class="kt">:</span> <span class="n">concatMap</span> <span class="n">show</span> <span class="n">codes&#39;</span>
    <span class="kr">where</span>
      <span class="n">chars</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">toUpper</span> <span class="p">(</span><span class="n">filter</span> <span class="n">isAlpha</span> <span class="n">name</span><span class="p">)</span>

      <span class="c1">-- duplicate consecutive soundex digits are skipped</span>
      <span class="n">codes</span> <span class="ow">=</span> <span class="n">map</span> <span class="n">head</span> <span class="o">$</span> <span class="n">group</span> <span class="o">$</span> <span class="n">map</span> <span class="n">letter_to_code</span> <span class="n">chars</span>

      <span class="c1">-- remove first, remove codes 0, add right-pad with 0</span>
      <span class="n">codes&#39;</span> <span class="ow">=</span> <span class="n">take</span> <span class="mi">3</span> <span class="p">(</span><span class="n">filter</span> <span class="p">(</span><span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="n">tail</span> <span class="n">codes</span><span class="p">)</span> <span class="o">++</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">..</span><span class="p">])</span>

<span class="nf">letter_to_code</span> <span class="ow">::</span> <span class="kt">Char</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
<span class="nf">letter_to_code</span> <span class="n">c</span> <span class="ow">=</span> <span class="n">snd</span> <span class="o">$</span> <span class="n">fromJust</span> <span class="o">$</span> <span class="n">find</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">letters</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">c</span> <span class="p">`</span><span class="n">elem</span><span class="p">`</span> <span class="n">letters</span><span class="p">)</span> <span class="n">letters_code</span>
<span class="nf">letters_code</span> <span class="ow">=</span>
    <span class="p">[</span> <span class="p">(</span><span class="s">&quot;AEIOUYHW&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">,</span> <span class="p">(</span><span class="s">&quot;BFPV&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">,</span> <span class="p">(</span><span class="s">&quot;CGJKQSXZ&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span> <span class="p">(</span><span class="s">&quot;DT&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="p">,</span> <span class="p">(</span><span class="s">&quot;L&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">,</span> <span class="p">(</span><span class="s">&quot;MN&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="p">,</span> <span class="p">(</span><span class="s">&quot;R&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="p">]</span>
	  
<span class="nf">errors</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="n">name</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">code</span> <span class="o">/=</span> <span class="n">soundex</span> <span class="n">name</span><span class="p">)</span>
            <span class="p">[</span> <span class="p">(</span><span class="s">&quot;H452&quot;</span><span class="p">,</span> <span class="s">&quot;holmes&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;A355&quot;</span><span class="p">,</span> <span class="s">&quot;adomomi&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;V536&quot;</span><span class="p">,</span> <span class="s">&quot;vonderlehr&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;B400&quot;</span><span class="p">,</span> <span class="s">&quot;ball&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;S000&quot;</span><span class="p">,</span> <span class="s">&quot;shaw&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;J250&quot;</span><span class="p">,</span> <span class="s">&quot;jackson&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;S545&quot;</span><span class="p">,</span> <span class="s">&quot;scanlon&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;S532&quot;</span><span class="p">,</span> <span class="s">&quot;saintjohn&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;K525&quot;</span><span class="p">,</span> <span class="s">&quot;kingsmith&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;B331&quot;</span><span class="p">,</span> <span class="s">&quot;booth-davis&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;K530&quot;</span><span class="p">,</span> <span class="s">&quot;Knuth&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;K530&quot;</span><span class="p">,</span> <span class="s">&quot;Kant&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;L300&quot;</span><span class="p">,</span> <span class="s">&quot;Lloyd&quot;</span><span class="p">)</span>
	    <span class="p">,</span> <span class="p">(</span><span class="s">&quot;L300&quot;</span><span class="p">,</span> <span class="s">&quot;Ladd&quot;</span><span class="p">)</span>
	    <span class="p">]</span>


<span class="c1">-- one need to flush between putStr and getLine,</span>
<span class="c1">--   it would not be needed if we had printer a newline</span>
<span class="c1">-- the other solution is to disable buffering with hSetBuffering</span>
<span class="nf">putStr_getLine</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">putStr</span> <span class="n">s</span>
                      <span class="n">hFlush</span> <span class="n">stdout</span>
                      <span class="n">getLine</span>

<span class="nf">msoundex</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">user</span> <span class="ow">&lt;-</span> <span class="n">putStr_getLine</span> <span class="s">&quot;Lookup user: &quot;</span>
              <span class="n">matching</span> <span class="ow">&lt;-</span> <span class="n">fmap</span> <span class="p">(</span><span class="n">filter</span> <span class="o">$</span> <span class="n">matches</span> <span class="n">user</span><span class="p">)</span> <span class="n">getAllUserEntries</span>
              <span class="n">mapM_</span> <span class="p">(</span><span class="n">putStrLn</span> <span class="o">.</span> <span class="n">format_user</span><span class="p">)</span> <span class="n">matching</span>
    <span class="kr">where</span> 
      <span class="n">matches</span> <span class="n">wanted</span> <span class="n">user</span> <span class="ow">=</span> <span class="n">soundex</span> <span class="n">wanted</span> <span class="p">`</span><span class="n">elem</span><span class="p">`</span> <span class="p">(</span><span class="n">map</span> <span class="n">soundex</span> <span class="o">$</span> <span class="n">userName</span> <span class="n">user</span> <span class="kt">:</span> <span class="n">words</span> <span class="p">(</span><span class="n">userGecos</span> <span class="n">user</span><span class="p">))</span>
      <span class="n">format_user</span> <span class="n">user</span> <span class="ow">=</span> <span class="n">userName</span> <span class="n">user</span> <span class="o">++</span> <span class="s">&quot;: &quot;</span> <span class="o">++</span> <span class="n">userGecos</span> <span class="n">user</span>
			 </PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN65"
>Program: fixstyle</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">-- <font size="-1"><a href="http://pleac.sourceforge.net/include/haskell/FixStyle.hs</span>">download the following standalone program</a></font>
<span class="kr">module</span> <span class="nn">Main</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Text.Regex.PCRE.String</span> <span class="k">as</span> <span class="n">PCRE</span>
<span class="kr">import</span> <span class="nn">Data.Char</span> <span class="p">(</span><span class="nf">toLower</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Data.List</span> <span class="p">(</span><span class="nf">intersperse</span><span class="p">)</span>

<span class="nf">transDict</span> <span class="ow">::</span> <span class="p">[(</span><span class="kt">String</span><span class="p">,</span><span class="kt">String</span><span class="p">)]</span>
<span class="nf">transDict</span> <span class="ow">=</span>
    <span class="p">[(</span><span class="s">&quot;analysed&quot;</span>      <span class="p">,</span><span class="s">&quot;analyzed&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;built-in&quot;</span>      <span class="p">,</span><span class="s">&quot;builtin&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;chastized&quot;</span>     <span class="p">,</span><span class="s">&quot;chastised&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;commandline&quot;</span>   <span class="p">,</span><span class="s">&quot;command-line&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;de-allocate&quot;</span>   <span class="p">,</span><span class="s">&quot;deallocate&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;dropin&quot;</span>        <span class="p">,</span><span class="s">&quot;drop-in&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;hardcode&quot;</span>      <span class="p">,</span><span class="s">&quot;hard-code&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;meta-data&quot;</span>     <span class="p">,</span><span class="s">&quot;metadata&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;multicharacter&quot;</span><span class="p">,</span><span class="s">&quot;multi-character&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;multiway&quot;</span>      <span class="p">,</span><span class="s">&quot;multi-way&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;non-empty&quot;</span>     <span class="p">,</span><span class="s">&quot;nonempty&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;non-profit&quot;</span>    <span class="p">,</span><span class="s">&quot;nonprofit&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;non-trappable&quot;</span> <span class="p">,</span><span class="s">&quot;nontrappable&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;pre-define&quot;</span>    <span class="p">,</span><span class="s">&quot;predefine&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;preextend&quot;</span>     <span class="p">,</span><span class="s">&quot;pre-extend&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;re-compiling&quot;</span>  <span class="p">,</span><span class="s">&quot;recompiling&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;reenter&quot;</span>       <span class="p">,</span><span class="s">&quot;re-enter&quot;</span><span class="p">)</span>
    <span class="p">,(</span><span class="s">&quot;turnkey&quot;</span>       <span class="p">,</span><span class="s">&quot;turn-key&quot;</span><span class="p">)]</span>

<span class="nf">transWord</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
<span class="nf">transWord</span> <span class="n">word</span> <span class="ow">=</span> <span class="kr">case</span> <span class="p">(</span><span class="n">lookup</span> <span class="p">(</span><span class="n">map</span> <span class="n">toLower</span> <span class="n">word</span><span class="p">)</span> <span class="n">transDict</span><span class="p">)</span> <span class="kr">of</span>
                   <span class="kt">Just</span> <span class="n">trans</span> <span class="ow">-&gt;</span> <span class="n">trans</span>
                   <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="n">word</span>

<span class="nf">transDictRegex</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="kt">PCRE</span><span class="o">.</span><span class="kt">Regex</span>
<span class="nf">transDictRegex</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="n">compres</span> <span class="ow">&lt;-</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">compile</span> <span class="n">compopt</span> <span class="n">execopt</span> <span class="n">pattern</span>
  <span class="kr">case</span> <span class="n">compres</span> <span class="kr">of</span>
    <span class="kt">Left</span> <span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
        <span class="ow">-&gt;</span> <span class="ne">error</span> <span class="o">$</span>
           <span class="s">&quot;Regex pattern error&quot;</span> <span class="o">++</span>
           <span class="s">&quot; at offset &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">offset</span> <span class="o">++</span>
           <span class="s">&quot; for string: &quot;</span> <span class="o">++</span> <span class="n">string</span>
    <span class="kt">Right</span> <span class="n">regex</span>
        <span class="ow">-&gt;</span> <span class="n">return</span> <span class="n">regex</span>
  <span class="kr">where</span> <span class="n">pattern</span> <span class="ow">=</span> <span class="s">&quot;(&quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">concat</span> <span class="o">$</span> <span class="n">intersperse</span> <span class="s">&quot;|&quot;</span> <span class="o">$</span> <span class="n">map</span> <span class="n">fst</span> <span class="n">transDict</span><span class="p">)</span> <span class="o">++</span> <span class="s">&quot;)&quot;</span>
        <span class="n">compopt</span> <span class="ow">=</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">compCaseless</span> <span class="o">+</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">compMultiline</span> <span class="o">+</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">compUTF8</span>
        <span class="n">execopt</span> <span class="ow">=</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">execBlank</span>

<span class="nf">matchRegex</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="p">(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">)</span>
<span class="nf">matchRegex</span> <span class="n">input</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="n">regex</span> <span class="ow">&lt;-</span> <span class="n">transDictRegex</span>
  <span class="n">execres</span> <span class="ow">&lt;-</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">regexec</span> <span class="n">regex</span> <span class="n">input</span>
  <span class="kr">case</span> <span class="n">execres</span> <span class="kr">of</span>
    <span class="kt">Left</span> <span class="n">err</span> <span class="ow">-&gt;</span> <span class="ne">error</span> <span class="o">$</span> <span class="s">&quot;regexec WrapError &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">err</span> <span class="o">++</span> <span class="s">&quot;for: &quot;</span> <span class="o">++</span> <span class="n">input</span>
    <span class="kt">Right</span> <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="n">return</span> <span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="kt">[]</span><span class="p">,</span> <span class="kt">[]</span><span class="p">)</span>
    <span class="kt">Right</span> <span class="p">(</span><span class="kt">Just</span> <span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">tail</span><span class="p">,</span> <span class="kr">_</span><span class="p">))</span> <span class="ow">-&gt;</span> <span class="n">return</span> <span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">tail</span><span class="p">)</span>

<span class="nf">translate</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">String</span>
<span class="nf">translate</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">return</span> <span class="kt">[]</span>
<span class="nf">translate</span> <span class="n">input</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">tail</span><span class="p">)</span> <span class="ow">&lt;-</span> <span class="n">matchRegex</span> <span class="n">input</span>
  <span class="n">tailTrans</span> <span class="ow">&lt;-</span> <span class="p">(</span><span class="n">translate</span> <span class="n">tail</span><span class="p">)</span>
  <span class="n">return</span> <span class="o">$</span> <span class="n">head</span> <span class="o">++</span> <span class="p">(</span><span class="n">transWord</span> <span class="n">word</span><span class="p">)</span> <span class="o">++</span> <span class="n">tailTrans</span>

<span class="nf">main</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">getContents</span> <span class="o">&gt;&gt;=</span> <span class="n">translate</span> <span class="o">&gt;&gt;=</span> <span class="n">putStr</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN68"
>Program: psgrep</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">-- <font size="-1"><a href="http://pleac.sourceforge.net/include/haskell/PSGrep.hs</span>">download the following standalone program</a></font>
<span class="kr">module</span> <span class="nn">Main</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="nn">Data.Char</span> <span class="p">(</span><span class="nf">isSpace</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">System.Time</span> <span class="p">(</span><span class="kt">ClockTime</span><span class="p">(</span><span class="o">..</span><span class="p">))</span>
<span class="kr">import</span> <span class="nn">System.Exit</span> <span class="p">(</span><span class="kt">ExitCode</span><span class="p">(</span><span class="o">..</span><span class="p">))</span>
<span class="kr">import</span> <span class="nn">System.Process</span> <span class="p">(</span><span class="nf">readProcessWithExitCode</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Data.List</span> <span class="p">(</span><span class="nf">elemIndex</span><span class="p">,</span> <span class="nf">foldl&#39;</span><span class="p">,</span> <span class="nf">intercalate</span><span class="p">,</span> <span class="nf">words</span><span class="p">)</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Text</span> <span class="k">as</span> <span class="n">T</span>

<span class="nf">psFields</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span>
<span class="nf">psFields</span> <span class="ow">=</span> <span class="p">[</span><span class="s">&quot;flags&quot;</span><span class="p">,</span><span class="s">&quot;uid&quot;</span><span class="p">,</span><span class="s">&quot;pid&quot;</span><span class="p">,</span><span class="s">&quot;ppid&quot;</span><span class="p">,</span><span class="s">&quot;pri&quot;</span><span class="p">,</span><span class="s">&quot;nice&quot;</span><span class="p">,</span><span class="s">&quot;size&quot;</span><span class="p">,</span><span class="s">&quot;rss&quot;</span><span class="p">,</span><span class="s">&quot;wchan&quot;</span><span class="p">,</span><span class="s">&quot;stat&quot;</span><span class="p">,</span>
            <span class="s">&quot;tty&quot;</span><span class="p">,</span><span class="s">&quot;time&quot;</span><span class="p">,</span><span class="s">&quot;command&quot;</span><span class="p">]</span>


<span class="c1">-- Accessors for ps output line fields -----------------------------------------</span>

<span class="nf">breakPSFields</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span>
<span class="nf">breakPSFields</span> <span class="n">line</span> <span class="ow">=</span>
    <span class="n">breakFields</span> <span class="n">line</span> <span class="n">nInitCols</span>
    <span class="kr">where</span> <span class="n">nInitCols</span>        <span class="ow">=</span> <span class="p">(</span><span class="n">length</span> <span class="n">psFields</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
          <span class="n">dropSpace</span>        <span class="ow">=</span> <span class="n">dropWhile</span> <span class="n">isSpace</span>
          <span class="n">breakFields</span> <span class="kt">[]</span> <span class="kr">_</span> <span class="ow">=</span> <span class="kt">[]</span>
          <span class="n">breakFields</span> <span class="n">cs</span> <span class="mi">0</span> <span class="ow">=</span> <span class="p">[</span><span class="kt">T</span><span class="o">.</span><span class="n">unpack</span> <span class="o">$</span> <span class="kt">T</span><span class="o">.</span><span class="n">strip</span> <span class="o">$</span> <span class="kt">T</span><span class="o">.</span><span class="n">pack</span> <span class="n">cs</span><span class="p">]</span>
          <span class="n">breakFields</span> <span class="n">cs</span> <span class="n">n</span> <span class="ow">=</span> <span class="kr">let</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> <span class="ow">=</span> <span class="n">break</span> <span class="n">isSpace</span> <span class="o">$</span> <span class="n">dropSpace</span> <span class="n">cs</span>
                                 <span class="n">t&#39;</span>    <span class="ow">=</span> <span class="p">(</span><span class="n">breakFields</span> <span class="n">t</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                             <span class="kr">in</span> <span class="n">h</span><span class="kt">:</span><span class="n">t&#39;</span>

<span class="kr">type</span> <span class="kt">PSField</span> <span class="ow">=</span> <span class="p">([</span><span class="kt">String</span><span class="p">],</span> <span class="kt">String</span><span class="p">)</span>

<span class="nf">getPSFields</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="p">[</span><span class="kt">PSField</span><span class="p">]</span>
<span class="nf">getPSFields</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="p">(</span><span class="n">ecode</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="ow">&lt;-</span> <span class="n">readProcessWithExitCode</span> <span class="s">&quot;ps&quot;</span> <span class="n">psargs</span> <span class="kt">[]</span>
  <span class="kr">case</span> <span class="n">ecode</span> <span class="kr">of</span>
    <span class="kt">ExitFailure</span> <span class="n">eno</span> <span class="ow">-&gt;</span> <span class="ne">error</span> <span class="o">$</span> <span class="s">&quot;ps failure: [&quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">eno</span> <span class="o">++</span> <span class="s">&quot;] &quot;</span> <span class="o">++</span> <span class="n">err</span>
    <span class="kt">ExitSuccess</span> <span class="ow">-&gt;</span> <span class="n">return</span> <span class="o">$</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">l</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">breakPSFields</span> <span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">))</span> <span class="o">$</span> <span class="n">tail</span> <span class="o">$</span> <span class="n">lines</span> <span class="n">out</span>
  <span class="kr">where</span> <span class="n">psargs</span> <span class="ow">=</span> <span class="p">[</span><span class="s">&quot;ax&quot;</span><span class="p">,</span> <span class="s">&quot;-o&quot;</span><span class="p">,</span> <span class="n">intercalate</span> <span class="s">&quot;,&quot;</span> <span class="n">psFields</span><span class="p">]</span>

<span class="nf">filterPSFields</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">PSField</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="p">[</span><span class="kt">PSField</span><span class="p">]</span>
<span class="nf">filterPSFields</span> <span class="n">p</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">getPSFields</span> <span class="o">&gt;&gt;=</span> <span class="p">(</span><span class="nf">\</span><span class="n">fs</span> <span class="ow">-&gt;</span> <span class="n">return</span> <span class="o">$</span> <span class="n">filter</span> <span class="n">p</span> <span class="n">fs</span><span class="p">)</span>

<span class="nf">printPSFields</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">PSField</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="nf">printPSFields</span> <span class="n">p</span> <span class="ow">=</span> <span class="n">filterPSFields</span> <span class="n">p</span> <span class="o">&gt;&gt;=</span> <span class="n">mapM_</span> <span class="p">(</span><span class="n">putStrLn</span> <span class="o">.</span> <span class="n">snd</span><span class="p">)</span>


<span class="c1">-- Query DSL -------------------------------------------------------------------</span>

<span class="nf">parseInt</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
<span class="nf">parseInt</span> <span class="n">cs</span> <span class="ow">=</span> <span class="n">read</span> <span class="n">cs</span> <span class="ow">::</span> <span class="kt">Int</span>

<span class="nf">parseClockTime</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">ClockTime</span>
<span class="nf">parseClockTime</span> <span class="n">cs</span> <span class="ow">=</span> <span class="kt">TOD</span> <span class="p">(</span><span class="n">toInteger</span> <span class="n">secs</span><span class="p">)</span> <span class="mi">0</span>
                    <span class="kr">where</span> <span class="n">secs</span> <span class="ow">=</span> <span class="n">foldl&#39;</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">s</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span> <span class="mi">0</span> <span class="o">$</span>
                                 <span class="n">map</span> <span class="p">(</span><span class="n">parseInt</span> <span class="o">.</span> <span class="kt">T</span><span class="o">.</span><span class="n">unpack</span><span class="p">)</span> <span class="o">$</span>
                                 <span class="kt">T</span><span class="o">.</span><span class="n">split</span> <span class="p">(</span><span class="kt">T</span><span class="o">.</span><span class="n">pack</span> <span class="s">&quot;:&quot;</span><span class="p">)</span> <span class="p">(</span><span class="kt">T</span><span class="o">.</span><span class="n">pack</span> <span class="n">cs</span><span class="p">)</span>

<span class="nf">liftAcP</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">String</span> <span class="ow">-&gt;</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">PSField</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
<span class="nf">liftAcP</span> <span class="n">a</span> <span class="n">p</span> <span class="n">f</span> <span class="n">v</span> <span class="n">s</span> <span class="ow">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">$</span> <span class="p">(</span><span class="n">fst</span> <span class="n">s</span><span class="p">)</span> <span class="o">!!</span> <span class="n">i</span><span class="p">)</span> <span class="p">`</span><span class="n">f</span><span class="p">`</span> <span class="n">v</span>
                    <span class="kr">where</span> <span class="n">i</span> <span class="ow">=</span> <span class="kr">case</span> <span class="p">(</span><span class="n">a</span> <span class="p">`</span><span class="n">elemIndex</span><span class="p">`</span> <span class="n">psFields</span><span class="p">)</span> <span class="kr">of</span>
                                <span class="kt">Just</span> <span class="n">n</span>  <span class="ow">-&gt;</span> <span class="n">n</span>
                                <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="ne">error</span> <span class="o">$</span> <span class="s">&quot;Wrong ps field: &quot;</span> <span class="o">++</span> <span class="n">a</span>

<span class="nf">flagsP</span>   <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;flags&quot;</span>   <span class="n">parseInt</span>
<span class="nf">uidP</span>     <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;uid&quot;</span>     <span class="n">parseInt</span>
<span class="nf">pidP</span>     <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;pid&quot;</span>     <span class="n">parseInt</span>
<span class="nf">ppidP</span>    <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;ppid&quot;</span>    <span class="n">parseInt</span>
<span class="nf">priP</span>     <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;pri&quot;</span>     <span class="n">parseInt</span>
<span class="nf">niceP</span>    <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;nice&quot;</span>    <span class="n">id</span>
<span class="nf">sizeP</span>    <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;size&quot;</span>    <span class="n">parseInt</span>
<span class="nf">rssP</span>     <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;rss&quot;</span>     <span class="n">parseInt</span>
<span class="nf">wchanP</span>   <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;wchan&quot;</span>   <span class="n">id</span>
<span class="nf">statP</span>    <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;stat&quot;</span>    <span class="n">id</span>
<span class="nf">ttyP</span>     <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;tty&quot;</span>     <span class="n">id</span>
<span class="nf">timeP</span>    <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;time&quot;</span>    <span class="n">parseClockTime</span>
<span class="nf">commandP</span> <span class="ow">=</span> <span class="n">liftAcP</span> <span class="s">&quot;command&quot;</span> <span class="n">id</span>

<span class="nf">liftOpP</span> <span class="n">o</span> <span class="n">x</span> <span class="n">y</span> <span class="n">s</span> <span class="ow">=</span> <span class="p">(</span><span class="n">x</span> <span class="n">s</span><span class="p">)</span> <span class="p">`</span><span class="n">o</span><span class="p">`</span> <span class="p">(</span><span class="n">y</span> <span class="n">s</span><span class="p">)</span>

<span class="p">(</span><span class="o">&amp;&amp;?</span><span class="p">)</span>    <span class="ow">=</span> <span class="n">liftOpP</span> <span class="p">(</span><span class="o">&amp;&amp;</span><span class="p">)</span>
<span class="kr">infixr</span> <span class="mi">3</span> <span class="o">&amp;&amp;?</span>

<span class="p">(</span><span class="o">||?</span><span class="p">)</span>    <span class="ow">=</span> <span class="n">liftOpP</span> <span class="p">(</span><span class="o">||</span><span class="p">)</span>
<span class="kr">infixr</span> <span class="mi">2</span> <span class="o">||?</span>


<span class="c1">-- Example Runs ----------------------------------------------------------------</span>

<span class="c1">-- You will need below ghc command line wrapper before using this script from</span>
<span class="c1">-- the command line.</span>

<span class="c1">--   $ cat PSGrep.sh</span>
<span class="c1">--   #!/bin/sh</span>
<span class="c1">--   ghc -e &quot;printPSFields \$ $@&quot; PSGrep.hs</span>

<span class="c1">-- Rest is trivial...</span>

<span class="c1">--   $ ./PSGrep.sh &#39;flagsP (==) 0 &amp;&amp;? sizeP (&lt;) 1024&#39;</span>
<span class="c1">--   0     0  3019     1  19   0   256   504 -      Ss+  tty2     00:00:00 /sbin/getty 38400 tty2</span>
<span class="c1">--   0     0  3020     1  19   0   256   508 -      Ss+  tty3     00:00:00 /sbin/getty 38400 tty3</span>
<span class="c1">--   0     0  3022     1  19   0   256   500 -      Ss+  tty4     00:00:00 /sbin/getty 38400 tty4</span>
<span class="c1">--   0     0  3023     1  19   0   256   504 -      Ss+  tty5     00:00:00 /sbin/getty 38400 tty5</span>
<span class="c1">--   0     0  3024     1  19   0   256   504 -      Ss+  tty6     00:00:00 /sbin/getty 38400 tty6</span>

			 
<span class="c1">----------------------------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="numbers.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>PLEAC-Haskell</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Numbers</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>