<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Dates and Times</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Haskell"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Numbers"
HREF="numbers.html"><LINK
REL="NEXT"
TITLE="Arrays"
HREF="arrays.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Haskell</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="numbers.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="arrays.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DATESANDTIMES"
>3. Dates and Times</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN132"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">-- you can use haskell-98 standard module:</span>
<span class="kr">import</span> <span class="nn">Time</span>

<span class="nf">date</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="n">show</span> <span class="n">getClockTime</span>   <span class="c1">-- &quot;Wed Apr 25 19:43:29 CEST 2007&quot;</span>
<span class="nf">localtime</span> <span class="ow">=</span> <span class="n">getClockTime</span> <span class="o">&gt;&gt;=</span> <span class="n">toCalendarTime</span>
<span class="c1">-- =&gt; CalendarTime {ctYear = 2007, ctMonth = April, ctDay = 25, ctHour = 19, ctMin = 46, ctSec = 41, ctPicosec = 214805000000, ctWDay = Wednesday, ctYDay = 114, ctTZName = &quot;CEST&quot;, ctTZ = 7200, ctIsDST = True}</span>

<span class="nf">utc_time</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="n">toUTCTime</span> <span class="n">getClockTime</span>
<span class="c1">-- =&gt; CalendarTime {ctYear = 2007, ctMonth = April, ctDay = 25, ctHour = 17, ctMin = 47, ctSec = 59, ctPicosec = 325921000000, ctWDay = Wednesday, ctYDay = 114, ctTZName = &quot;UTC&quot;, ctTZ = 0, ctIsDST = False}</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">tm</span> <span class="ow">&lt;-</span> <span class="n">localtime</span>
       <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;Today is day &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="p">(</span><span class="n">ctYDay</span> <span class="n">tm</span><span class="p">)</span> <span class="o">++</span> <span class="s">&quot; of the current year&quot;</span>
<span class="c1">-- =&gt; Today is day 114 of the current year</span>


<span class="c1">-- or you can use new &quot;time library&quot;:</span>
<span class="kr">import</span> <span class="nn">Data.Time</span>

<span class="nf">date</span> <span class="ow">=</span> <span class="n">getCurrentTime</span>
<span class="c1">-- &quot;2008-04-18 14:11:22.476894 UTC&quot;</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">today</span> <span class="ow">&lt;-</span> <span class="n">fmap</span> <span class="n">utctDay</span> <span class="n">getCurrentTime</span>      
       <span class="kr">let</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">toGregorian</span> <span class="n">today</span>
       <span class="kr">let</span> <span class="n">days</span> <span class="ow">=</span> <span class="n">diffDays</span> <span class="n">today</span> <span class="p">(</span><span class="n">fromGregorian</span> <span class="n">year</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span>
       <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;Today is day &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">days</span> <span class="o">++</span> <span class="s">&quot; of the current year&quot;</span>
<span class="c1">-- =&gt; Today is day 108 of the current year</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN135"
>Finding Today's Date</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="kr">import</span> <span class="nn">Data.Time</span>
<span class="kr">import</span> <span class="nn">System.Locale</span> <span class="p">(</span><span class="nf">defaultTimeLocale</span><span class="p">)</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">tm</span> <span class="ow">&lt;-</span> <span class="n">getCurrentTime</span>
       <span class="kr">let</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span> <span class="ow">=</span> <span class="n">toGregorian</span> <span class="p">(</span><span class="n">utctDay</span> <span class="n">tm</span><span class="p">)</span>
       <span class="n">printf</span> <span class="s">&quot;The current date is %04d %02d %02d</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">year</span> <span class="n">month</span> <span class="n">day</span>

<span class="nf">t2</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">tm</span> <span class="ow">&lt;-</span> <span class="n">getCurrentTime</span>
        <span class="n">return</span> <span class="o">$</span> <span class="s">&quot;The current date is &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="p">(</span><span class="n">utctDay</span> <span class="n">tm</span><span class="p">)</span>
<span class="c1">-- The current date is 2008-04-18</span>

<span class="nf">t3</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="p">(</span><span class="n">formatTime</span> <span class="n">defaultTimeLocale</span> <span class="s">&quot;%Y-%m-%d&quot;</span><span class="p">)</span> <span class="n">getCurrentTime</span>
<span class="c1">-- =&gt; 2008-04-18</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN138"
>Converting DMYHMS to Epoch Seconds</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="kr">import</span> <span class="nn">Data.Time</span>
<span class="kr">import</span> <span class="nn">Data.Time.Clock.POSIX</span>

<span class="c1">-- !! epoch is not the &quot;base&quot; value in Data.Time, so do not use it unless you !!</span>
<span class="c1">-- !! really need it !!</span>

<span class="c1">-- if you want epoch, use:</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="n">getPOSIXTime</span>                <span class="c1">-- 1208529250.856017s</span>

<span class="c1">-- if you want to get epoch from a time, use:</span>
<span class="nf">t2</span> <span class="ow">=</span> <span class="n">fmap</span> <span class="n">utcTimeToPOSIXSeconds</span> <span class="n">getCurrentTime</span> <span class="c1">-- 1208529250.856017s</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN141"
>Converting Epoch Seconds to DMYHMS</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="kr">import</span> <span class="nn">System.Time</span>
<span class="kr">import</span> <span class="nn">Data.Time</span>
<span class="kr">import</span> <span class="nn">Data.Time.Clock.POSIX</span>

<span class="nf">epoch</span> <span class="ow">=</span> <span class="mi">111111</span>
<span class="nf">t1</span> <span class="ow">=</span> <span class="n">posixSecondsToUTCTime</span> <span class="n">epoch</span>      <span class="c1">-- 1970-01-02 06:51:51 UTC</span>
<span class="nf">t2</span> <span class="ow">=</span> <span class="n">timeToTimeOfDay</span> <span class="p">(</span><span class="n">utctDayTime</span> <span class="n">t1</span><span class="p">)</span> <span class="c1">-- 06:51:51</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN144"
>Adding to or Subtracting from a Date</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="kr">import</span> <span class="nn">Data.Time</span>

<span class="nf">ten_seconds_before</span> <span class="ow">=</span> <span class="n">addUTCTime</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">now</span> <span class="ow">&lt;-</span> <span class="n">getCurrentTime</span>
       <span class="n">return</span> <span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="n">ten_seconds_before</span> <span class="n">now</span><span class="p">)</span>
<span class="c1">-- (2008-04-18 14:48:33.075113 UTC,</span>
<span class="c1">--  2008-04-18 14:48:23.075113 UTC)</span>

<span class="c1">-- ten_seconds_before can also be written:</span>
<span class="nf">ten_seconds_before</span> <span class="p">(</span><span class="kt">UTCTime</span> <span class="n">day</span> <span class="n">time</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">UTCTime</span> <span class="n">day</span> <span class="p">(</span><span class="n">time</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
<span class="nf">ten_seconds_before</span> <span class="n">t</span> <span class="ow">=</span> <span class="n">t</span> <span class="p">{</span> <span class="n">utctDayTime</span> <span class="ow">=</span> <span class="n">utctDayTime</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">10</span> <span class="p">}</span>


<span class="nf">birth_date</span> <span class="ow">=</span> <span class="n">fromGregorian</span> <span class="mi">1973</span> <span class="mi">1</span> <span class="mi">18</span>
<span class="nf">t</span>  <span class="ow">=</span> <span class="s">&quot;Nat was 55 days old on: &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="p">(</span><span class="n">addDays</span> <span class="mi">55</span> <span class="n">birth_date</span><span class="p">)</span>
<span class="c1">-- Nat was 55 days old on: 1973-03-14</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN147"
>Difference of Two Dates</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="kr">import</span> <span class="nn">Data.Time</span>
<span class="kr">import</span> <span class="nn">Data.Time.Clock.POSIX</span>

<span class="nf">bree</span> <span class="ow">=</span> <span class="kt">UTCTime</span> <span class="p">(</span><span class="n">fromGregorian</span> <span class="mi">1981</span> <span class="mi">6</span> <span class="mi">16</span><span class="p">)</span> <span class="p">(</span><span class="n">timeOfDayToTime</span> <span class="o">$</span> <span class="kt">TimeOfDay</span> <span class="mi">4</span> <span class="mi">35</span> <span class="mi">25</span><span class="p">)</span> <span class="c1">-- 1981-06-16 04:35:25 UTC</span>
<span class="nf">nat</span>  <span class="ow">=</span> <span class="kt">UTCTime</span> <span class="p">(</span><span class="n">fromGregorian</span> <span class="mi">1973</span> <span class="mi">1</span> <span class="mi">18</span><span class="p">)</span> <span class="p">(</span><span class="n">timeOfDayToTime</span> <span class="o">$</span> <span class="kt">TimeOfDay</span> <span class="mi">3</span> <span class="mi">45</span> <span class="mi">50</span><span class="p">)</span> <span class="c1">-- 1973-01-18 03:45:50 UTC</span>
<span class="c1">-- or simpler:</span>
<span class="nf">bree&#39;</span> <span class="ow">=</span> <span class="n">read</span> <span class="s">&quot;1981-06-16 04:35:25&quot;</span> <span class="ow">::</span> <span class="kt">UTCTime</span>
<span class="nf">nat&#39;</span>  <span class="ow">=</span> <span class="n">read</span> <span class="s">&quot;1973-01-18 03:45:50&quot;</span> <span class="ow">::</span> <span class="kt">UTCTime</span>

<span class="nf">difference</span> <span class="ow">=</span> <span class="n">diffUTCTime</span> <span class="n">bree</span> <span class="n">nat</span> <span class="o">/</span> <span class="n">posixDayLength</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="s">&quot;There were &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">show</span> <span class="o">$</span> <span class="n">round</span> <span class="n">difference</span><span class="p">)</span> <span class="o">++</span> <span class="s">&quot; days between Nat and Bree&quot;</span>
<span class="c1">-- There were 3071 days between Nat and Bree</span>

<span class="nf">toFloat</span> <span class="n">n</span> <span class="ow">=</span> <span class="n">realToFrac</span> <span class="n">n</span> <span class="ow">::</span> <span class="kt">Float</span>
<span class="nf">t2</span> <span class="ow">=</span> <span class="n">printf</span> <span class="s">&quot;There were %.2f days between Nat and Bree&quot;</span> <span class="p">(</span><span class="n">toFloat</span> <span class="n">difference</span><span class="p">)</span> <span class="ow">::</span> <span class="kt">String</span>
<span class="c1">-- There were 3071.03 days between Nat and Bree</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN150"
>Day in a Week/Month/Year or Week Number</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="kr">import</span> <span class="nn">Data.Time</span>
<span class="kr">import</span> <span class="nn">Data.Time.Calendar.MonthDay</span>
<span class="kr">import</span> <span class="nn">Data.Time.Calendar.OrdinalDate</span>
<span class="kr">import</span> <span class="nn">Locale</span>

<span class="p">(</span><span class="nf">year</span><span class="p">,</span> <span class="nf">month</span><span class="p">,</span> <span class="nf">day</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="mi">1981</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">printf</span> <span class="s">&quot;%d/%d/%d was a %s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">year</span> <span class="n">month</span> <span class="n">day</span> <span class="n">week_day_name</span>
       <span class="n">printf</span> <span class="s">&quot;%d/%d/%d was day %d of the week %d</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">year</span> <span class="n">month</span> <span class="n">day</span> <span class="n">week_day</span> <span class="n">week</span>
       <span class="n">printf</span> <span class="s">&quot;%d/%d/%d was day %d of month %d</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">year</span> <span class="n">month</span> <span class="n">day</span> <span class="n">month_day</span> <span class="n">month_</span>
       <span class="n">printf</span> <span class="s">&quot;%d/%d/%d was day %d of year %d</span><span class="se">\n</span><span class="s">&quot;</span> <span class="n">year</span> <span class="n">month</span> <span class="n">day</span> <span class="n">year_day</span> <span class="n">year_</span>
    <span class="kr">where</span> <span class="n">date</span> <span class="ow">=</span> <span class="p">(</span><span class="n">fromGregorian</span> <span class="n">year</span> <span class="n">month</span> <span class="n">day</span><span class="p">)</span>
          <span class="p">(</span><span class="n">week</span><span class="p">,</span> <span class="n">week_day</span><span class="p">)</span> <span class="ow">=</span> <span class="n">sundayStartWeek</span> <span class="n">date</span>
          <span class="p">(</span><span class="kr">_</span><span class="p">,</span> <span class="n">month_</span><span class="p">,</span> <span class="n">month_day</span><span class="p">)</span> <span class="ow">=</span> <span class="n">toGregorian</span> <span class="n">date</span>
          <span class="p">(</span><span class="n">year_</span><span class="p">,</span> <span class="n">year_day</span><span class="p">)</span> <span class="ow">=</span> <span class="n">toOrdinalDate</span> <span class="n">date</span>
          <span class="p">(</span><span class="n">week_day_name</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">wDays</span> <span class="n">defaultTimeLocale</span> <span class="o">!!</span> <span class="n">week_day</span>
<span class="c1">-- 1981/6/16 was a Tuesday</span>
<span class="c1">-- 1981/6/16 was day 2 of the week 24</span>
<span class="c1">-- 1981/6/16 was day 16 of month 6</span>
<span class="c1">-- 1981/6/16 was day 167 of year 1981</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN153"
>Parsing Dates and Times from Strings</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="kr">import</span> <span class="nn">Data.Time</span>
<span class="kr">import</span> <span class="nn">Data.Time.Format</span>
<span class="kr">import</span> <span class="nn">Data.Time.Clock.POSIX</span>
<span class="kr">import</span> <span class="nn">Locale</span>

<span class="nf">day</span> <span class="ow">::</span> <span class="kt">Day</span>
<span class="nf">day</span> <span class="ow">=</span> <span class="n">readTime</span> <span class="n">defaultTimeLocale</span> <span class="s">&quot;%F&quot;</span> <span class="s">&quot;1998-06-03&quot;</span>

<span class="c1">-- calculate epoch seconds at midnight on that day in UTC</span>
<span class="nf">epoch</span> <span class="ow">=</span> <span class="n">utcTimeToPOSIXSeconds</span> <span class="p">(</span><span class="kt">UTCTime</span> <span class="n">day</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1">-- 896832000s</span>

<span class="c1">-- readTime can return a UTCTime:</span>
<span class="nf">epoch_</span> <span class="ow">=</span> <span class="n">utcTimeToPOSIXSeconds</span> <span class="p">(</span><span class="n">readTime</span> <span class="n">defaultTimeLocale</span> <span class="s">&quot;%F&quot;</span> <span class="s">&quot;1998-06-03&quot;</span><span class="p">)</span>

<span class="c1">-- it seems readTime is not flexible, </span>
<span class="c1">-- for example &quot;%d/%m/%Y&quot; can&#39;t handle 16/6/1981, only 16/06/1981</span>
<span class="c1">--</span>
<span class="c1">-- here is an alternative solution, using regexp</span>
<span class="kr">import</span> <span class="nn">Data.Time</span>
<span class="kr">import</span> <span class="nn">Data.Time.Clock.POSIX</span>
<span class="kr">import</span> <span class="nn">Text.Regex</span>

<span class="nf">day</span> <span class="ow">=</span> <span class="n">fromGregorian</span> <span class="p">(</span><span class="n">read</span> <span class="n">year</span><span class="p">)</span> <span class="p">(</span><span class="n">read</span> <span class="n">month</span><span class="p">)</span> <span class="p">(</span><span class="n">read</span> <span class="n">day</span><span class="p">)</span>
      <span class="kr">where</span> <span class="kt">Just</span> <span class="p">[</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">]</span> <span class="ow">=</span> <span class="n">matchRegex</span> <span class="p">(</span><span class="n">mkRegex</span> <span class="s">&quot;(.*)-(.*)-(.*)&quot;</span><span class="p">)</span> <span class="s">&quot;1998-06-03&quot;</span>
<span class="c1">-- 1998-06-03</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN156"
>Printing a Date</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">-- formatTime from Data.Time.Format allow powerful time formatting:</span>
<span class="kr">import</span> <span class="nn">Data.Time</span>
<span class="kr">import</span> <span class="nn">Data.Time.Format</span>
<span class="kr">import</span> <span class="nn">Locale</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">now</span> <span class="ow">&lt;-</span> <span class="n">getCurrentTime</span>
       <span class="n">return</span> <span class="o">$</span> <span class="n">formatTime</span> <span class="n">defaultTimeLocale</span> <span class="s">&quot;The date is %A (%a) %d/%m/%Y&quot;</span> <span class="n">now</span>
<span class="c1">-- &quot;The date is Tuesday (Tue) 28/10/2008&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN159"
>High-Resolution Timers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">-- getCurrentTime/UTCTime has a precision of 1 picosecond, full precision is used by default</span>
<span class="kr">import</span> <span class="nn">Data.Time</span>
<span class="kr">import</span> <span class="nn">System.Posix.Unistd</span>

<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">t1</span> <span class="ow">&lt;-</span> <span class="n">getCurrentTime</span>
       <span class="n">usleep</span> <span class="mi">100000</span> <span class="c1">-- 100ms</span>
       <span class="n">t2</span> <span class="ow">&lt;-</span> <span class="n">getCurrentTime</span>
       <span class="n">return</span> <span class="p">(</span><span class="n">diffUTCTime</span> <span class="n">t2</span> <span class="n">t1</span><span class="p">)</span>
<span class="c1">-- 0.111262s</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN162"
>Short Sleeps</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">-- short sleeps:</span>
<span class="nf">t</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">usleep</span> <span class="mi">3100000</span>

<span class="c1">-- for even more precision, nanosleep is available</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN165"
>Program: hopdelta</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">-- <font size="-1"><a href="http://pleac.sourceforge.net/include/haskell/MailHop.hs</span>">download the following standalone program</a></font>
<span class="kr">module</span> <span class="nn">Main</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="nn">Data.Char</span> <span class="p">(</span><span class="nf">toLower</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Data.Fixed</span> <span class="p">(</span><span class="nf">divMod&#39;</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Data.List</span> <span class="p">(</span><span class="nf">intersperse</span><span class="p">,</span> <span class="nf">isInfixOf</span><span class="p">,</span> <span class="nf">foldl&#39;</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">System.Environment</span> <span class="p">(</span><span class="nf">getArgs</span><span class="p">)</span>

<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Codec.MIME.Parse</span>       <span class="k">as</span> <span class="n">MIME</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Time.Clock</span>        <span class="k">as</span> <span class="n">CLOCK</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Data.Time.Format</span>       <span class="k">as</span> <span class="n">TIME</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">System.Locale</span>          <span class="k">as</span> <span class="n">LOCALE</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Text.Regex.PCRE.String</span> <span class="k">as</span> <span class="n">PCRE</span>

<span class="kr">data</span> <span class="kt">ServerHeader</span> <span class="ow">=</span> <span class="kt">ServerHeader</span> <span class="p">{</span>
      <span class="n">receivedFrom</span> <span class="ow">::</span> <span class="kt">String</span>
    <span class="p">,</span> <span class="n">receivedBy</span>   <span class="ow">::</span> <span class="kt">String</span>
    <span class="p">,</span> <span class="n">receivedAt</span>   <span class="ow">::</span> <span class="kt">CLOCK</span><span class="o">.</span><span class="kt">UTCTime</span>
    <span class="p">}</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Show</span><span class="p">)</span>

<span class="nf">serverHeaderRegex</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="kt">PCRE</span><span class="o">.</span><span class="kt">Regex</span>
<span class="nf">serverHeaderRegex</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="kr">let</span> <span class="n">pattern</span> <span class="ow">=</span> <span class="s">&quot;from (.*) by (.*) with (.*); (.*)&quot;</span>
  <span class="n">compres</span> <span class="ow">&lt;-</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">compile</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">compBlank</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">execBlank</span> <span class="n">pattern</span>
  <span class="kr">case</span> <span class="n">compres</span> <span class="kr">of</span>
    <span class="kt">Left</span> <span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
        <span class="ow">-&gt;</span> <span class="ne">error</span> <span class="o">$</span>
           <span class="s">&quot;Regex pattern error&quot;</span> <span class="o">++</span>
           <span class="s">&quot; at offset &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">offset</span> <span class="o">++</span>
           <span class="s">&quot; for string: &quot;</span> <span class="o">++</span> <span class="n">string</span>
    <span class="kt">Right</span> <span class="n">regex</span>
        <span class="ow">-&gt;</span> <span class="n">return</span> <span class="n">regex</span>

<span class="nf">parseTime</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">CLOCK</span><span class="o">.</span><span class="kt">UTCTime</span>
<span class="nf">parseTime</span> <span class="n">time</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">parseres</span> <span class="kr">of</span>
                   <span class="kt">Just</span> <span class="n">utctime</span> <span class="ow">-&gt;</span> <span class="n">utctime</span>
                   <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="ne">error</span> <span class="o">$</span> <span class="s">&quot;Invalid data format: &quot;</span> <span class="o">++</span> <span class="n">time</span>
                 <span class="kr">where</span> <span class="n">parseres</span> <span class="ow">=</span> <span class="kt">TIME</span><span class="o">.</span><span class="n">parseTime</span>
                                  <span class="kt">LOCALE</span><span class="o">.</span><span class="n">defaultTimeLocale</span>
                                  <span class="s">&quot;%a, %e %b %Y %X %z (%Z)&quot;</span>
                                  <span class="n">time</span>
                                  <span class="ow">::</span> <span class="kt">Maybe</span> <span class="kt">CLOCK</span><span class="o">.</span><span class="kt">UTCTime</span>

<span class="nf">parseServerHeader</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">ServerHeader</span>
<span class="nf">parseServerHeader</span> <span class="n">input</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="kr">let</span> <span class="n">header</span> <span class="ow">=</span> <span class="n">concat</span> <span class="o">$</span> <span class="n">intersperse</span> <span class="s">&quot; &quot;</span> <span class="o">$</span> <span class="n">words</span> <span class="n">input</span>
      <span class="n">headerWithFrom</span>  <span class="ow">=</span> <span class="kr">if</span> <span class="s">&quot;from&quot;</span> <span class="p">`</span><span class="n">isInfixOf</span><span class="p">`</span> <span class="n">header</span>
                        <span class="kr">then</span> <span class="n">header</span>
                        <span class="kr">else</span> <span class="s">&quot;from - &quot;</span> <span class="o">++</span> <span class="n">header</span>
  <span class="n">regex</span> <span class="ow">&lt;-</span> <span class="n">serverHeaderRegex</span>
  <span class="n">execres</span> <span class="ow">&lt;-</span> <span class="kt">PCRE</span><span class="o">.</span><span class="n">regexec</span> <span class="n">regex</span> <span class="n">headerWithFrom</span>
  <span class="kr">case</span> <span class="n">execres</span> <span class="kr">of</span>
    <span class="kt">Left</span> <span class="n">err</span> <span class="ow">-&gt;</span> <span class="ne">error</span> <span class="o">$</span> <span class="s">&quot;regexec WrapError &quot;</span> <span class="o">++</span> <span class="n">show</span> <span class="n">err</span> <span class="o">++</span> <span class="s">&quot;for: &quot;</span> <span class="o">++</span> <span class="n">input</span>
    <span class="kt">Right</span> <span class="kt">Nothing</span> <span class="ow">-&gt;</span> <span class="ne">error</span> <span class="o">$</span> <span class="s">&quot;Invalid server header: &quot;</span> <span class="o">++</span> <span class="n">headerWithFrom</span>
    <span class="kt">Right</span> <span class="p">(</span><span class="kt">Just</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="p">[</span><span class="n">from</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="n">time</span><span class="p">]))</span>
        <span class="ow">-&gt;</span> <span class="n">return</span> <span class="o">$</span> <span class="kt">ServerHeader</span> <span class="n">from</span> <span class="n">by</span> <span class="p">(</span><span class="n">parseTime</span> <span class="n">time</span><span class="p">)</span>

<span class="nf">parseServerHeaders</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="p">[</span><span class="kt">ServerHeader</span><span class="p">]</span>
<span class="nf">parseServerHeaders</span> <span class="n">contents</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="n">mapM</span> <span class="p">(</span><span class="n">parseServerHeader</span> <span class="o">.</span> <span class="n">snd</span><span class="p">)</span> <span class="o">$</span> <span class="n">reverse</span> <span class="o">$</span> <span class="n">filter</span> <span class="n">match</span> <span class="n">headers</span>
  <span class="kr">where</span> <span class="n">match</span>   <span class="ow">=</span> <span class="p">(</span><span class="o">==</span> <span class="s">&quot;received&quot;</span><span class="p">)</span> <span class="o">.</span> <span class="p">(</span><span class="n">map</span> <span class="n">toLower</span><span class="p">)</span> <span class="o">.</span> <span class="n">fst</span>
        <span class="n">headers</span> <span class="ow">=</span> <span class="n">fst</span> <span class="o">$</span> <span class="kt">MIME</span><span class="o">.</span><span class="n">parseHeaders</span> <span class="n">contents</span>

<span class="nf">prettifyTimeDiff</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">Real</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
<span class="nf">prettifyTimeDiff</span> <span class="n">diff</span> <span class="ow">=</span>
  <span class="n">concat</span> <span class="o">$</span> <span class="n">intersperse</span> <span class="s">&quot; &quot;</span> <span class="o">$</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">show</span> <span class="n">n</span> <span class="o">++</span> <span class="n">t</span><span class="p">)</span>
         <span class="o">$</span> <span class="kr">if</span> <span class="n">null</span> <span class="n">diffs</span> <span class="kr">then</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;s&quot;</span><span class="p">)]</span> <span class="kr">else</span> <span class="n">diffs</span>
  <span class="kr">where</span> <span class="n">merge</span> <span class="p">(</span><span class="n">tot</span><span class="p">,</span><span class="n">acc</span><span class="p">)</span> <span class="p">(</span><span class="n">sec</span><span class="p">,</span><span class="n">typ</span><span class="p">)</span> <span class="ow">=</span> <span class="kr">let</span> <span class="p">(</span><span class="n">sec&#39;</span><span class="p">,</span><span class="n">tot&#39;</span><span class="p">)</span> <span class="ow">=</span> <span class="n">divMod&#39;</span> <span class="n">tot</span> <span class="n">sec</span>
                                    <span class="kr">in</span> <span class="p">(</span><span class="n">tot&#39;</span><span class="p">,(</span><span class="n">sec&#39;</span><span class="p">,</span><span class="n">typ</span><span class="p">)</span><span class="kt">:</span><span class="n">acc</span><span class="p">)</span>
        <span class="n">metrics</span> <span class="ow">=</span> <span class="p">[(</span><span class="mi">86400</span><span class="p">,</span><span class="s">&quot;d&quot;</span><span class="p">),(</span><span class="mi">3600</span><span class="p">,</span><span class="s">&quot;h&quot;</span><span class="p">),(</span><span class="mi">60</span><span class="p">,</span><span class="s">&quot;m&quot;</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;s&quot;</span><span class="p">)]</span>
        <span class="n">diffs</span> <span class="ow">=</span> <span class="n">filter</span> <span class="p">((</span><span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">.</span> <span class="n">fst</span><span class="p">)</span> <span class="o">$</span> <span class="n">reverse</span> <span class="o">$</span> <span class="n">snd</span> <span class="o">$</span> <span class="n">foldl&#39;</span> <span class="n">merge</span> <span class="p">(</span><span class="n">diff</span><span class="p">,</span><span class="kt">[]</span><span class="p">)</span> <span class="n">metrics</span>

<span class="nf">printServerHeaders</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="nf">printServerHeaders</span> <span class="n">contents</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="n">headers</span> <span class="ow">&lt;-</span> <span class="n">parseServerHeaders</span> <span class="n">contents</span>
  <span class="n">mapM_</span> <span class="n">printHeader</span> <span class="p">(</span><span class="n">zip</span> <span class="n">headers</span> <span class="o">$</span> <span class="p">(</span><span class="n">head</span> <span class="n">headers</span><span class="p">)</span> <span class="kt">:</span> <span class="n">headers</span><span class="p">)</span>
  <span class="kr">where</span> <span class="n">printHeader</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="ow">=</span> <span class="kr">do</span>
          <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;after &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">prettifyTimeDiff</span> <span class="o">$</span> <span class="kt">CLOCK</span><span class="o">.</span><span class="n">diffUTCTime</span> <span class="p">(</span><span class="n">receivedAt</span> <span class="n">c</span><span class="p">)</span> <span class="p">(</span><span class="n">receivedAt</span> <span class="n">p</span><span class="p">))</span>
          <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot; from &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">receivedFrom</span> <span class="n">c</span><span class="p">)</span>
          <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;   by &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">receivedBy</span> <span class="n">c</span><span class="p">)</span>
          <span class="n">putStrLn</span> <span class="o">$</span> <span class="s">&quot;   at &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">show</span> <span class="o">$</span> <span class="n">receivedAt</span> <span class="n">c</span><span class="p">)</span>

<span class="nf">main</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
  <span class="n">args</span> <span class="ow">&lt;-</span> <span class="n">getArgs</span>
  <span class="kr">case</span> <span class="n">args</span> <span class="kr">of</span>
    <span class="kt">[]</span>         <span class="ow">-&gt;</span> <span class="n">getContents</span> <span class="o">&gt;&gt;=</span> <span class="n">printServerHeaders</span>
    <span class="p">[</span><span class="n">pathname</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="n">readFile</span> <span class="n">pathname</span> <span class="o">&gt;&gt;=</span> <span class="n">printServerHeaders</span>
    <span class="kr">_</span>          <span class="ow">-&gt;</span> <span class="ne">error</span> <span class="s">&quot;Arguments: [&lt;PATHNAME&gt;]&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="numbers.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="arrays.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Numbers</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Arrays</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>