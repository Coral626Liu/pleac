<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Hashes</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-PicoLisp
"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Arrays"
HREF="arrays.html"><LINK
REL="NEXT"
TITLE="Pattern Matching"
HREF="patternmatching.html"></HEAD
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-PicoLisp
</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="arrays.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="patternmatching.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="HASHES"
>5. Hashes</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN232"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"># To associate keys with values, PicoLisp uses (besides the built-in database)
# 1. Symbol properties ('</FONT></B>put<B><FONT COLOR="#BC8F8F">', '</FONT></B>get<B><FONT COLOR="#BC8F8F">', '</FONT></B>:<B><FONT COLOR="#BC8F8F">' etc.)
# 2. Association lists ('</FONT></B>assoc<B><FONT COLOR="#BC8F8F">', '</FONT></B>asoq<B><FONT COLOR="#BC8F8F">', '</FONT></B>get<B><FONT COLOR="#BC8F8F">')
# 3. Binary trees ('</FONT></B>idx<B><FONT COLOR="#BC8F8F">', '</FONT></B>lup<B><FONT COLOR="#BC8F8F">')
# For the examples in this section we use association lists
#-----------------------------
(de Age
   (Nat . 24)
   (Jules . 25)
   (Josh . 17) )
#-----------------------------
(push '</FONT></B>Age
   (cons <B><FONT COLOR="#BC8F8F">'Nat 24)
   (cons '</FONT></B>Jules 25)
   (cons <B><FONT COLOR="#BC8F8F">'Josh 17) )
#-----------------------------
(de FoodColor
   (Apple . &quot;red&quot;)
   (Banana . &quot;yellow&quot;)
   (Lemon . &quot;yellow&quot;)
   (Carrot . &quot;orange&quot;) )
#-----------------------------</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN235"
>Adding an Element to a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1">#-----------------------------
# FoodColor defined per the introduction
(push '</FONT></B>FoodColor <B><FONT COLOR="#BC8F8F">'(Raspberry . &quot;pink&quot;))

: (prinl &quot;Known foods:&quot;) (for F FoodColor (println (car F)))
Known foods:
Raspberry
Apple
Banana
Lemon
Carrot
#-----------------------------</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN238"
>Testing for the Presence of a Key in a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1">#-----------------------------
# FoodColor per the introduction
: (for Name '</FONT></B>(<B><FONT COLOR="#BC8F8F">&quot;Banana&quot;</FONT></B>, <B><FONT COLOR="#BC8F8F">&quot;Martini&quot;</FONT></B>)
   (prinl Name (<B><FONT COLOR="#A020F0">if</FONT></B> (assoc Name FoodColor) <B><FONT COLOR="#BC8F8F">&quot; is a food.&quot;</FONT></B> <B><FONT COLOR="#BC8F8F">&quot; is a drink.&quot;</FONT></B>)) )
Banana is a food.
Martini is a drink.
<I><FONT COLOR="#B22222">#-----------------------------
</FONT></I></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN241"
>Deleting from a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><I><FONT COLOR="#B22222"></FONT></I><I><FONT COLOR="#B22222">#-----------------------------
</FONT></I>(del Key Var)
<I><FONT COLOR="#B22222">#-----------------------------
</FONT></I><I><FONT COLOR="#B22222"># FoodColor per the introduction
</FONT></I>(de printFoods ()
   (prin <B><FONT COLOR="#BC8F8F">&quot;Keys: &quot;</FONT></B>)
   (apply println (mapcar car FoodColor))
   (prin <B><FONT COLOR="#BC8F8F">&quot;Values: &quot;</FONT></B>)
   (apply println (mapcar cdr FoodColor)) )

(prinl <B><FONT COLOR="#BC8F8F">&quot;Initially:&quot;</FONT></B>)
(printFoods)
(prinl)
(prinl <B><FONT COLOR="#BC8F8F">&quot;With Banana undef:&quot;</FONT></B>)
(del (assoc <B><FONT COLOR="#BC8F8F">'Banana FoodColor) '</FONT></B>FoodColor)
(printFoods)
<I><FONT COLOR="#B22222">#-----------------------------
</FONT></I>Initially:
Keys: Raspberry Apple Banana Lemon Carrot
Values: <B><FONT COLOR="#BC8F8F">&quot;pink&quot;</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;red&quot;</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;yellow&quot;</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;yellow&quot;</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;orange&quot;</FONT></B>

With Banana <B><FONT COLOR="#A020F0">undef</FONT></B>:
Keys: Raspberry Apple Lemon Carrot
Values: <B><FONT COLOR="#BC8F8F">&quot;pink&quot;</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;red&quot;</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;yellow&quot;</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;orange&quot;</FONT></B>
<I><FONT COLOR="#B22222">#-----------------------------
</FONT></I></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN244"
>Traversing a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><I><FONT COLOR="#B22222"></FONT></I><I><FONT COLOR="#B22222">#-----------------------------
</FONT></I><I><FONT COLOR="#B22222"># FoodColor as per the introduction
</FONT></I>: (<B><FONT COLOR="#A020F0">for</FONT></B> F FoodColor
   (prinl (car F) <B><FONT COLOR="#BC8F8F">&quot; is &quot;</FONT></B> (cdr F)) )
Apple is red
Banana is yellow
Lemon is yellow
Carrot is orange

: (mapc
   <B><FONT COLOR="#BC8F8F">'((Food Color) (prinl Food &quot; is &quot; Color))
   (mapcar car FoodColor)
   (mapcar cdr FoodColor) )
Apple is red
Banana is yellow
Lemon is yellow
Carrot is orange
#-----------------------------
: (for F (sort FoodColor)
   (prinl (car F) &quot; is &quot; (cdr F)) )
Apple is red
Banana is yellow
Carrot is orange
Lemon is yellow
#-----------------------------
# <font size="-1"><a href="http://pleac.sourceforge.net/include/picolisp/ch05/countfrom">download the following standalone program</a></font>
#!/usr/bin/picolisp /usr/lib/picolisp/lib.l

(load &quot;@lib/misc.l&quot;)

(in (opt)
   (until (eof)
      (when (match '</FONT></B>(~(<B><FONT COLOR="#A020F0">chop</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;From: &quot;</FONT></B>) @From) (line))
         (accu <B><FONT COLOR="#BC8F8F">'From @From 1) ) ) )

(for Person (sort From)
   (prinl (car Person) &quot;: &quot; (cdr Person)) )

(bye)

#-----------------------------</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN247"
>Printing a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1">#-----------------------------
# FoodColor as per the introduction
: FoodColor
-&gt; ((Apple . &quot;red&quot;) (Banana . &quot;yellow&quot;) (Lemon . &quot;yellow&quot;) (Carrot . &quot;orange&quot;))

: (mapc println FoodColor)
(Apple . &quot;red&quot;)
(Banana . &quot;yellow&quot;)
(Lemon . &quot;yellow&quot;)
(Carrot . &quot;orange&quot;)

: (for X FoodColor
   (prinl (car X) &quot; =&gt; &quot; (cdr X)) )
Apple =&gt; red
Banana =&gt; yellow
Lemon =&gt; yellow
Carrot =&gt; orange
#-----------------------------</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN250"
>Retrieving from a Hash in Insertion Order</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1">#-----------------------------
(queue '</FONT></B>FoodColor (cons <B><FONT COLOR="#BC8F8F">'Banana &quot;Yellow&quot;))
(queue '</FONT></B>FoodColor (cons <B><FONT COLOR="#BC8F8F">'Apple &quot;Green&quot;))
(queue '</FONT></B>FoodColor (cons <B><FONT COLOR="#BC8F8F">'Lemon &quot;Yellow&quot;))

: FoodColor
-&gt; ((Banana . &quot;Yellow&quot;) (Apple . &quot;Green&quot;) (Lemon . &quot;Yellow&quot;))

# In insertion order, the foods are:
: (for Food FoodColor
   (prinl &quot;   &quot; (car Food)) )
In insertion order, the foods are:
   Banana
   Apple
   Lemon

# Still in insertion order, the foods'</FONT></B> colors are:
: (<B><FONT COLOR="#A020F0">for</FONT></B> Food FoodColor
   (prinl (car Food) <B><FONT COLOR="#BC8F8F">&quot; is colored &quot;</FONT></B> (cdr Food) <B><FONT COLOR="#BC8F8F">&quot;.&quot;</FONT></B>) )
Banana is colored Yellow.
Apple is colored Green.
Lemon is colored Yellow.
<I><FONT COLOR="#B22222">#-----------------------------
</FONT></I></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN253"
>Hashes with Multiple Values Per Key</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><I><FONT COLOR="#B22222"></FONT></I><I><FONT COLOR="#B22222">#-----------------------------
</FONT></I>: (setq Ttys
   (<B><FONT COLOR="#A020F0">sort</FONT></B>
      (group
         (in <B><FONT COLOR="#BC8F8F">'(who)
            (make
               (while (read)
                  (link (cons @ (read)))
                  (line) ) ) ) ) ) )
-&gt; ((abu tty1 pts/1 pts/3 pts/4 pts/5) (root tty2))

: (for U Ttys
   (prin (car U) &quot;: &quot;)
   (apply println (cdr U)) )
abu: tty1 pts/1 pts/3 pts/4 pts/5
root: tty2
#-----------------------------
(for U Ttys
   (prinl (car U) &quot;: &quot; (length (cdr U)) &quot; ttys.&quot;)
   (for Tty (sort (cdr U))
      (prinl &quot;^I&quot; Tty &quot; (owned by &quot; (car U) &quot;)&quot;) ) )
#-----------------------------
# Delete all pts/3 .. pts/5
(for U Ttys
   (con U (diff (cdr U) '</FONT></B>(pts/3 pts/4 pts/5))) )

: Ttys
-&gt; ((abu tty1 pts/1) (root tty2))
<I><FONT COLOR="#B22222">#-----------------------------
</FONT></I></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN256"
>Inverting a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><I><FONT COLOR="#B22222"></FONT></I><I><FONT COLOR="#B22222">#-----------------------------
</FONT></I>(setq
   Surname <B><FONT COLOR="#BC8F8F">'((Mickey . Mantle) (Babe . Ruth))
   FirstName (mapcar '</FONT></B>((X) (cons (cdr X) (car X))) Surname) )

: (get FirstName <B><FONT COLOR="#BC8F8F">'Mantle)
-&gt; Mickey
#-----------------------------
# <font size="-1"><a href="http://pleac.sourceforge.net/include/picolisp/ch05/foodfind">download the following standalone program</a></font>
#!/usr/bin/picolisp /usr/lib/picolisp/lib.l

(ifn (argv Given)
   (out 2 (prinl &quot;usage: foodfind food_or_color&quot;))

   (de Color
      (&quot;Apple&quot; . &quot;red&quot;)
      (&quot;Banana&quot; . &quot;yellow&quot;)
      (&quot;Lemon&quot; . &quot;yellow&quot;)
      (&quot;Carrot&quot; . &quot;orange&quot;) )

   (when (assoc Given Color)
      (prinl Given &quot; is a food with color &quot; (cdr @) &quot;.&quot;) )
   (when (find '</FONT></B>((X) (= Given (cdr X))) Color)
      (prinl (car @) <B><FONT COLOR="#BC8F8F">&quot;  is a food with color &quot;</FONT></B> Given <B><FONT COLOR="#BC8F8F">&quot;.&quot;</FONT></B>) ) )

(bye)

<I><FONT COLOR="#B22222">#-----------------------------
</FONT></I><I><FONT COLOR="#B22222"># FoodColor as per the introduction
</FONT></I>: (extract
   <B><FONT COLOR="#BC8F8F">'((F) (and (= &quot;yellow&quot; (cdr F)) (car F)))
   FoodColor )
-&gt; (Banana Lemon)
#-----------------------------</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN259"
>Sorting a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1">#-----------------------------
: (setq FoodColor (sort FoodColor))
-&gt; ((Apple . &quot;red&quot;) (Banana . &quot;yellow&quot;) (Carrot . &quot;orange&quot;) (Lemon . &quot;yellow&quot;))

: (setq FoodColor (by cdr sort FoodColor))
-&gt; ((Carrot . &quot;orange&quot;) (Apple . &quot;red&quot;) (Banana . &quot;yellow&quot;) (Lemon . &quot;yellow&quot;))
#-----------------------------</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN262"
>Merging Hashes</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1">#-----------------------------
# FoodColor per the introduction
(setq
   DrinkColor '</FONT></B>((Galliano . <B><FONT COLOR="#BC8F8F">&quot;yellow&quot;</FONT></B>) (<B><FONT COLOR="#BC8F8F">&quot;Mai Tai&quot;</FONT></B> . <B><FONT COLOR="#BC8F8F">&quot;blue&quot;</FONT></B>))
   IngestedColor (append FoodColor DrinkColor) )
<I><FONT COLOR="#B22222">#-----------------------------
</FONT></I>: (setq AllColors (uniq (mapcar cdr IngestedColor)))
-&gt; (<B><FONT COLOR="#BC8F8F">&quot;red&quot;</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;yellow&quot;</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;orange&quot;</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;blue&quot;</FONT></B>)
<I><FONT COLOR="#B22222">#-----------------------------
</FONT></I></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN265"
>Finding Common or Different Keys in Two Hashes</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><I><FONT COLOR="#B22222"></FONT></I><I><FONT COLOR="#B22222">#-----------------------------
</FONT></I><I><FONT COLOR="#B22222"># FoodColor per the introduction
</FONT></I><I><FONT COLOR="#B22222"># CitrusColor is a hash mapping citrus food name to its color.
</FONT></I>(de CitrusColor
   (Lemon . <B><FONT COLOR="#BC8F8F">&quot;yellow&quot;</FONT></B>)
   (Orange . <B><FONT COLOR="#BC8F8F">&quot;orange&quot;</FONT></B>)
   (Lime . <B><FONT COLOR="#BC8F8F">&quot;green&quot;</FONT></B>) )

<I><FONT COLOR="#B22222"># build up a list of non-citrus foods
</FONT></I>: (filter <B><FONT COLOR="#BC8F8F">'((F) (not (assoc (car F) CitrusColor))) FoodColor)
-&gt; ((Apple . &quot;red&quot;) (Banana . &quot;yellow&quot;) (Carrot . &quot;orange&quot;))
#-----------------------------</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN268"
>Hashing References</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1">#-----------------------------
(setq Files
   (extract
      '</FONT></B>((File) (<B><FONT COLOR="#A020F0">and</FONT></B> (info File) (cons File (car @))))
      <B><FONT COLOR="#BC8F8F">'(&quot;/etc/termcap&quot;, &quot;/vmunix&quot;, &quot;/bin/cat&quot;) ) )

(prinl &quot;open files &quot; (glue &quot;, &quot; (mapcar car Files)))
(for F Files
   (prinl (car F) &quot; is &quot; (cdr F) &quot; bytes long.&quot;) )
#-----------------------------</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN271"
>Presizing a Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1">#-----------------------------
# Has no meaning in PicoLisp. All data structures grow dynamically.
#-----------------------------</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN274"
>Finding the Most Common Anything</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1">#-----------------------------
: (off Count)
-&gt; NIL
: (for Element '</FONT></B>(a b c b c d)
   (accu <B><FONT COLOR="#BC8F8F">'Count Element 1) )
-&gt; (d . 1)
: Count
-&gt; ((d . 1) (c . 2) (b . 2) (a . 1))
#-----------------------------</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN277"
>Representing Relationships Between Data</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1">#-----------------------------
(de Father
   (Cain . Adam)
   (Abel . Adam)
   (Seth . Adam)
   (Enoch . Cain)
   (Irad . Enoch)
   (Mehujael . Irad)
   (Methusael . Mehujael)
   (Lamech . Methusael)
   (Jubal . Lamech)
   (Tubalcain . Lamech)
   (Enos . Seth) )

(de ancestor (Name)
   (while (assoc Name Father)
      (setq Name (cdr @)) )
   Name )  # Always '</FONT></B>Adam<B><FONT COLOR="#BC8F8F">'

(setq Children
   (mapcar
      '</FONT></B>((L) (cons (cdar L) (mapcar car L)))
      (by cdr group Father) ) )

(de children (Name)
   (prinl Name <B><FONT COLOR="#BC8F8F">&quot; begat &quot;</FONT></B>
      (<B><FONT COLOR="#A020F0">if</FONT></B> (get Children Name)
         (glue <B><FONT COLOR="#BC8F8F">&quot;, &quot;</FONT></B> @)
         <B><FONT COLOR="#BC8F8F">&quot;nobody&quot;</FONT></B> ) ) )
<I><FONT COLOR="#B22222">#-----------------------------
</FONT></I>: (children <B><FONT COLOR="#BC8F8F">'Adam)
Adam begat Cain, Abel, Seth

: (children '</FONT></B>Enos)
Enos begat nobody
<I><FONT COLOR="#B22222">#-----------------------------
</FONT></I></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN280"
>Program: dutree</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><I><FONT COLOR="#B22222"></FONT></I><I><FONT COLOR="#B22222">#-----------------------------
</FONT></I><I><FONT COLOR="#B22222"># <font size="-1"><a href="http://pleac.sourceforge.net/include/picolisp/ch05/dutree">download the following standalone program</a></font>
</FONT></I><I><FONT COLOR="#B22222">#!/usr/bin/picolisp /usr/lib/picolisp/lib.l
</FONT></I><I><FONT COLOR="#B22222"># dutree - print sorted indented rendition of du output
</FONT></I>
(load <B><FONT COLOR="#BC8F8F">&quot;@lib/misc.l&quot;</FONT></B>)

<I><FONT COLOR="#B22222"># Run du, read input, save directories and sizes
</FONT></I>(setq *Dirsize  <I><FONT COLOR="#B22222"># ((name size kids ..) ..)
</FONT></I>   (by <B><FONT COLOR="#A020F0">length</FONT></B> <B><FONT COLOR="#A020F0">sort</FONT></B>
      (in (list <B><FONT COLOR="#BC8F8F">'du (opt))
         (make
            (while (read)
               (skip)
               (link (list (split (line) &quot;/&quot;) @)) ) ) ) ) )

# Assign kids
(for D *Dirsize
   (when (assoc (head -1 (car D)) *Dirsize)
      (conc @ (cons (car D))) ) )

(let Root (car *Dirsize)
   # Figure out how much is taken up in each directory
   # that isn'</FONT></B>t stored in subdirectories.  add a <B><FONT COLOR="#A020F0">new</FONT></B>
   <I><FONT COLOR="#B22222"># fake kid called &quot;.&quot; containing that much
</FONT></I>   (recur (Root)
      (let (Size (cadr Root)  Cursize Size)
         (<B><FONT COLOR="#A020F0">for</FONT></B> Kid (cddr Root)
            (when (assoc Kid *Dirsize)
               (dec <B><FONT COLOR="#BC8F8F">'Cursize (cadr @))
               (recurse @) ) )
         (unless (= Size Cursize)
            (let Dot (append (car Root) '</FONT></B>((<B><FONT COLOR="#BC8F8F">&quot;.&quot;</FONT></B>)))
               (<B><FONT COLOR="#A020F0">push</FONT></B> <B><FONT COLOR="#BC8F8F">'*Dirsize (list Dot Cursize))
               (conc Root (cons Dot)) ) ) ) )
   # Recursively output everything
   (let (Prefix NIL  Width (length (cadr Root)))
      (recur (Root Prefix Width)
         (let Name (last (car Root))
            (prinl Prefix (align Width (cadr Root)) &quot; &quot; Name)
            (let? Kids
               (flip
                  (by cadr sort
                     (mapcar '</FONT></B>((K) (assoc K *Dirsize)) (cddr Root)) ) )
               (setq Prefix (<B><FONT COLOR="#A020F0">pack</FONT></B> Prefix (align Width <B><FONT COLOR="#BC8F8F">&quot;|&quot;</FONT></B>)))
               (setq Width (+ 1 (<B><FONT COLOR="#A020F0">length</FONT></B> Name) (<B><FONT COLOR="#A020F0">length</FONT></B> (cadar Kids))))
               (<B><FONT COLOR="#A020F0">for</FONT></B> Kid Kids
                  (recurse Kid Prefix Width) ) ) ) ) ) )

(bye)

<I><FONT COLOR="#B22222">#-----------------------------
</FONT></I></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="arrays.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="patternmatching.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Arrays</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Pattern Matching</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>