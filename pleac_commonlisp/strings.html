<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Strings</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Common Lisp"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="PLEAC-Common Lisp"
HREF="index.html"><LINK
REL="NEXT"
TITLE="Numbers"
HREF="numbers.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Common Lisp</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="index.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="numbers.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="STRINGS"
>1. Strings</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN14"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="s">&quot;\\n&quot;</span><span class="p">)</span>                     <span class="c1">; two characters, \ and an n</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="s">&quot;John &#39;Maddog&#39; Orwant&quot;</span><span class="p">)</span>    <span class="c1">; literal single quotes</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; newlines may be inserted literally</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="s">&quot;</span>
<span class="s">&quot;</span><span class="p">)</span>                                      <span class="c1">; a &quot;newline&quot; character</span>
<span class="c1">;; or by creating a string explicitly</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="p">(</span><span class="nb">make-string</span> <span class="mi">1</span> <span class="ss">:initial-element</span> <span class="sc">#\Newline</span><span class="p">))</span>
<span class="c1">;; or by using format with a nil output stream</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;~%&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="s">&quot;John \&quot;Maddog\&quot; Orwant&quot;</span><span class="p">)</span>  <span class="c1">; literal double quotes</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="s">&quot;John &#39;Maddog&#39; Orwant&quot;</span><span class="p">)</span>  <span class="c1">; literal single quotes</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="s">&quot;</span>
<span class="s">This is a multiline string, terminated by a</span>
<span class="s">double quotation mark.</span>
<span class="s">&quot;</span><span class="p">)</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; There are no CL equivalents to Perl&#39;s other ways of quoting</span>
<span class="c1">;; strings (q//, etc).</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN17"
>Accessing Substrings</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="c1">;; assign a substring to a variable</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">value</span> <span class="p">(</span><span class="nb">subseq</span> <span class="nb">string</span> <span class="nv">offset</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">offset</span> <span class="nb">count</span><span class="p">)))</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">value</span> <span class="p">(</span><span class="nb">subseq</span> <span class="nb">string</span> <span class="nv">offset</span><span class="p">))</span>

<span class="c1">;; edit a substring</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="p">(</span><span class="nb">concatenate</span> <span class="ss">&#39;string</span>
                          <span class="p">(</span><span class="nb">subseq</span> <span class="nb">string</span> <span class="mi">0</span> <span class="nv">offset</span><span class="p">)</span>
                          <span class="nv">newstring</span>
                          <span class="p">(</span><span class="nb">subseq</span> <span class="nb">string</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">offset</span> <span class="nb">count</span><span class="p">))))</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="p">(</span><span class="nb">concatenate</span> <span class="ss">&#39;string</span>
                          <span class="p">(</span><span class="nb">subseq</span> <span class="nb">string</span> <span class="mi">0</span> <span class="nv">offset</span><span class="p">)</span>
                          <span class="nv">newtail</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; get a 5-byte string, skip 3, then grab 2 8-byte strings, then the</span>
<span class="c1">;; rest</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">leading</span> <span class="p">(</span><span class="nb">subseq</span> <span class="nv">data</span> <span class="mi">5</span><span class="p">)</span>
      <span class="nv">s1</span> <span class="p">(</span><span class="nb">subseq</span> <span class="nv">data</span> <span class="mi">8</span> <span class="mi">8</span><span class="p">)</span>
      <span class="nv">s2</span> <span class="p">(</span><span class="nb">subseq</span> <span class="nv">data</span> <span class="mi">16</span> <span class="mi">8</span><span class="p">)</span>
      <span class="nv">trailing</span> <span class="p">(</span><span class="nb">subseq</span> <span class="nv">data</span> <span class="mi">24</span><span class="p">))</span>

<span class="c1">;; split at five byte boundries</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nb">length</span> <span class="p">(</span><span class="nb">length</span> <span class="nb">string</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">idx</span> <span class="nv">from</span> <span class="mi">0</span> <span class="nv">upto</span> <span class="nb">length</span> <span class="nv">by</span> <span class="mi">5</span>
     <span class="nv">collect</span> <span class="p">(</span><span class="nb">subseq</span> <span class="nb">string</span> <span class="nv">idx</span> <span class="p">(</span><span class="nb">min</span> <span class="nb">length</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">idx</span> <span class="mi">5</span><span class="p">)))))</span>

<span class="c1">;; chop string into individual characters</span>
<span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">idx</span> <span class="nv">from</span> <span class="mi">0</span> <span class="nv">upto</span> <span class="p">(</span><span class="nb">1-</span> <span class="p">(</span><span class="nb">length</span> <span class="nb">string</span><span class="p">))</span>
      <span class="nv">collect</span> <span class="p">(</span><span class="nb">char</span> <span class="nb">string</span> <span class="nv">idx</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defparameter</span> <span class="vg">*string*</span> <span class="s">&quot;This is what you have&quot;</span><span class="p">)</span>
<span class="c1">;;;             +012345678901234567890  Indexing forwards  (left to right)</span>
<span class="c1">;;;              109876543210987654321- Indexing backwards (right to left)</span>

<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nb">first</span> <span class="p">(</span><span class="nb">subseq</span> <span class="vg">*string*</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">))</span>                        <span class="c1">; &quot;T&quot;</span>
      <span class="p">(</span><span class="nv">start</span> <span class="p">(</span><span class="nb">subseq</span> <span class="vg">*string*</span> <span class="mi">5</span> <span class="mi">7</span><span class="p">))</span>                        <span class="c1">; &quot;is&quot;</span>
      <span class="p">(</span><span class="nb">rest</span> <span class="p">(</span><span class="nb">subseq</span> <span class="vg">*string*</span> <span class="mi">13</span><span class="p">))</span>                       <span class="c1">; &quot;you have&quot;</span>
      <span class="p">(</span><span class="nb">last</span> <span class="p">(</span><span class="nb">subseq</span> <span class="vg">*string*</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">length</span> <span class="vg">*string*</span><span class="p">)</span> <span class="mi">-1</span><span class="p">)))</span> <span class="c1">; &quot;e&quot;</span>
      <span class="p">(</span><span class="nv">end</span> <span class="p">(</span><span class="nb">subseq</span> <span class="vg">*string*</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">length</span> <span class="vg">*string*</span><span class="p">)</span> <span class="mi">-4</span><span class="p">)))</span>   <span class="c1">; &quot;have&quot;</span>
      <span class="p">(</span><span class="nv">piece</span> <span class="p">(</span><span class="nb">subseq</span> <span class="vg">*string*</span>
                     <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">length</span> <span class="vg">*string*</span><span class="p">)</span> <span class="mi">-8</span><span class="p">)</span>
                     <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">length</span> <span class="vg">*string*</span><span class="p">)</span> <span class="mi">-8</span> <span class="mi">3</span><span class="p">))))</span> <span class="c1">; &quot;you&quot;</span>
  <span class="p">(</span><span class="nb">list</span> <span class="nb">first</span> <span class="nv">start</span> <span class="nb">rest</span> <span class="nb">last</span> <span class="nv">end</span> <span class="nv">piece</span><span class="p">))</span>
<span class="c1">;; (&quot;T&quot; &quot;is&quot; &quot;you have&quot; &quot;e&quot; &quot;have&quot; &quot;you&quot;)</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defparameter</span> <span class="vg">*string*</span> <span class="s">&quot;This is what you have&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">print</span> <span class="vg">*string*</span><span class="p">)</span>
<span class="c1">;; This is what you have</span>

<span class="c1">;; Change &quot;is&quot; to &quot;wasn&#39;t&quot;</span>
<span class="p">(</span><span class="nb">setf</span> <span class="vg">*string*</span> <span class="p">(</span><span class="nb">concatenate</span> <span class="ss">&#39;string</span>
                            <span class="p">(</span><span class="nb">subseq</span> <span class="vg">*string*</span> <span class="mi">0</span> <span class="mi">5</span><span class="p">)</span>
                            <span class="s">&quot;wasn&#39;t&quot;</span>
                            <span class="p">(</span><span class="nb">subseq</span> <span class="vg">*string*</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">5</span> <span class="mi">2</span><span class="p">))))</span>
<span class="c1">;; This wasn&#39;t what you have</span>

<span class="c1">;; Replace last 12 characters</span>
<span class="p">(</span><span class="nb">setf</span> <span class="vg">*string*</span> <span class="p">(</span><span class="nb">concatenate</span> <span class="ss">&#39;string</span>
                            <span class="p">(</span><span class="nb">subseq</span> <span class="vg">*string*</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">length</span> <span class="vg">*string*</span><span class="p">)</span> <span class="mi">-12</span><span class="p">))</span>
                            <span class="s">&quot;ondrous&quot;</span><span class="p">))</span>
<span class="c1">;; This wasn&#39;t wondrous</span>

<span class="c1">;; Delete first character</span>
<span class="p">(</span><span class="nb">setf</span> <span class="vg">*string*</span> <span class="p">(</span><span class="nb">subseq</span> <span class="vg">*string*</span> <span class="mi">1</span><span class="p">))</span>
<span class="c1">;; his wasn&#39;t wondrous</span>

<span class="c1">;; Delete last 10 characters</span>
<span class="p">(</span><span class="nb">setf</span> <span class="vg">*string*</span> <span class="p">(</span><span class="nb">subseq</span> <span class="vg">*string*</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">length</span> <span class="vg">*string*</span><span class="p">)</span> <span class="mi">-10</span><span class="p">)))</span>
<span class="c1">;; his wasn&#39;</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; you can test substrings with the :start and :end keyword parameters</span>
<span class="c1">;; of CL-PPCRE:SCAN</span>
<span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">scan</span> <span class="s">&quot;pattern&quot;</span> <span class="vg">*string*</span> <span class="ss">:start</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nb">length</span> <span class="vg">*string*</span><span class="p">)</span> <span class="mi">10</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;Pattern matches in last 10 characters~%&quot;</span><span class="p">))</span>

<span class="c1">;; substitute &quot;at&quot; for &quot;is&quot;, restricted to first five characters</span>
<span class="p">(</span><span class="nb">concatenate</span> <span class="ss">&#39;string</span>
              <span class="p">(</span><span class="nv">regex-replace</span> <span class="s">&quot;is&quot;</span> <span class="vg">*string*</span> <span class="s">&quot;at&quot;</span>
                             <span class="ss">:start</span> <span class="mi">0</span>
                             <span class="ss">:end</span> <span class="p">(</span><span class="nb">min</span> <span class="p">(</span><span class="nb">length</span> <span class="vg">*string*</span><span class="p">)</span> <span class="mi">5</span><span class="p">))</span>
              <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">length</span> <span class="vg">*string*</span><span class="p">)</span> <span class="mi">5</span><span class="p">)</span>
                <span class="p">(</span><span class="nb">subseq</span> <span class="vg">*string*</span> <span class="mi">5</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; exchange the first and last letters in a string</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">a</span> <span class="s">&quot;make a hat&quot;</span><span class="p">))</span>
  <span class="c1">;; ROTATEF is CL&#39;s general-purpose swap macro</span>
  <span class="p">(</span><span class="nb">rotatef</span> <span class="p">(</span><span class="nb">char</span> <span class="nv">a</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">char</span> <span class="nv">a</span> <span class="p">(</span><span class="nb">1-</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">a</span><span class="p">))))</span>
  <span class="p">(</span><span class="nb">princ</span> <span class="nv">a</span><span class="p">))</span>
<span class="c1">;; take a ham</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; extract column with SUBSEQ</span>
<span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">a</span> <span class="s">&quot;To be or not to be&quot;</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">b</span> <span class="p">(</span><span class="nb">subseq</span> <span class="nv">a</span> <span class="mi">6</span> <span class="mi">12</span><span class="p">)))</span> <span class="c1">; skip 6, grab 6</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A~%&quot;</span> <span class="nv">b</span><span class="p">)</span>
<span class="c1">;; or not</span>

  <span class="c1">;; forward 6, grab 2; backward 5, grab 2</span>
  <span class="p">(</span><span class="nb">destructuring-bind</span> <span class="p">(</span><span class="nv">b</span> <span class="nv">c</span><span class="p">)</span> <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nb">subseq</span> <span class="nv">a</span> <span class="mi">6</span> <span class="mi">8</span><span class="p">)</span> <span class="o">,</span><span class="p">(</span><span class="nb">subseq</span> <span class="nv">a</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A~%~A~%&quot;</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)))</span>
<span class="c1">;; or</span>
<span class="c1">;; be</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">cut2fmt</span> <span class="p">(</span><span class="k">&amp;rest</span> <span class="nv">positions</span><span class="p">)</span>
  <span class="s">&quot;Useless in CL, which lacks Perl&#39;s unpack(); here for completeness.&quot;</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">template</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">lastpos</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">place</span> <span class="nv">positions</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">setf</span> <span class="nv">template</span> <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;~AA~D &quot;</span> <span class="nv">template</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">place</span> <span class="nv">lastpos</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">setf</span> <span class="nv">lastpos</span> <span class="nv">place</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">setf</span> <span class="nv">template</span> <span class="p">(</span><span class="nb">concatenate</span> <span class="ss">&#39;string</span> <span class="nv">template</span> <span class="s">&quot;A*&quot;</span><span class="p">))</span>
    <span class="nv">template</span><span class="p">))</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">fmt</span> <span class="p">(</span><span class="nv">cut2fmt</span> <span class="mi">8</span> <span class="mi">14</span> <span class="mi">20</span> <span class="mi">26</span> <span class="mi">30</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A~%&quot;</span> <span class="nv">fmt</span><span class="p">))</span>
<span class="c1">;; A7 A6 A6 A6 A4 A*</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN20"
>Establishing a Default Value</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="c1">;; use b if b is true, else c</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">a</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>

<span class="c1">;; set x to y unless x is already true</span>
<span class="p">(</span><span class="nb">unless</span> <span class="nv">x</span> <span class="p">(</span><span class="nb">setf</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; use B if B is defined, otherwise C</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">a</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">boundp</span> <span class="ss">&#39;b</span><span class="p">)</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">foo</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">bar</span> <span class="s">&quot;DEFAULT VALUE&quot;</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="o">#+</span><span class="nv">sbcl</span>
<span class="p">(</span><span class="nb">defparameter</span> <span class="nv">ARGV</span> <span class="p">(</span><span class="nb">copy-seq</span> <span class="p">(</span><span class="nb">cdr</span> <span class="vg">*posix-argv*</span><span class="p">))</span> <span class="s">&quot;Arguments from shell, Perl style&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nb">setf</span> <span class="nv">dir</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">pop</span> <span class="nv">ARGV</span><span class="p">)</span> <span class="s">&quot;/tmp&quot;</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">dir</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">nth</span> <span class="mi">0</span> <span class="nv">ARGV</span><span class="p">)</span> <span class="s">&quot;/tmp&quot;</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">dir</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">plusp</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">ARGV</span><span class="p">))</span> <span class="p">(</span><span class="nb">pop</span> <span class="nv">ARGV</span><span class="p">)</span> <span class="s">&quot;/tmp&quot;</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">dir</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">plusp</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">ARGV</span><span class="p">))</span> <span class="p">(</span><span class="nb">nth</span> <span class="mi">0</span> <span class="nv">ARGV</span><span class="p">)</span> <span class="s">&quot;/tmp&quot;</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">count</span> <span class="p">(</span><span class="nb">make-hash-table</span><span class="p">))</span>
<span class="p">(</span><span class="nb">incf</span> <span class="p">(</span><span class="nb">gethash</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">shell</span> <span class="s">&quot;/bin/sh&quot;</span><span class="p">)</span> <span class="nb">count</span> <span class="mi">0</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; find the user name on Unix systems</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">user</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">posix-getenv</span> <span class="s">&quot;USER&quot;</span><span class="p">)</span>
               <span class="p">(</span><span class="nv">posix-getenv</span> <span class="s">&quot;LOGNAME&quot;</span><span class="p">)</span>
               <span class="o">#+</span><span class="nv">sbcl</span>
               <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">uid</span> <span class="p">(</span><span class="nv">sb-posix:getuid</span><span class="p">)))</span>
                 <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">sb-posix:passwd-name</span> <span class="p">(</span><span class="nv">sb-posix:getpwuid</span> <span class="nv">uid</span><span class="p">))</span>
                     <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;Unknown uid number ~a&quot;</span> <span class="nv">uid</span><span class="p">)))</span>
               <span class="o">#-</span><span class="nv">sbcl</span>
               <span class="s">&quot;Unknown uid&quot;</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">starting-point</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">starting-point</span> <span class="s">&quot;Greenwich&quot;</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; Perl array-to-array assignment copies the array, hence the need for</span>
<span class="c1">;; COPY-SEQ below.</span>
<span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">plusp</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">a</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">setf</span> <span class="nv">a</span> <span class="p">(</span><span class="nb">copy-seq</span> <span class="nv">b</span><span class="p">)))</span>                <span class="c1">; copy only if empty</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">a</span> <span class="p">(</span><span class="nb">copy-seq</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">plusp</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">b</span><span class="p">))</span>
                      <span class="nv">b</span>
                      <span class="nv">c</span><span class="p">)))</span>              <span class="c1">; assign b if nonempty, else c</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN23"
>Exchanging Values Without Using Temporary Variables</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="c1">;; There are several ways to swap variables in CL.  ROTATEF is usually</span>
<span class="c1">;; the simplest choice.</span>
<span class="p">(</span><span class="nb">rotatef</span> <span class="nv">VAR1</span> <span class="nv">VAR2</span><span class="p">)</span>
<span class="p">(</span><span class="nb">psetq</span> <span class="nv">VAR1</span> <span class="nv">VAR2</span> <span class="nv">VAR2</span> <span class="nv">VAR1</span><span class="p">)</span>
<span class="p">(</span><span class="nb">multiple-value-setq</span> <span class="p">(</span><span class="nv">VAR1</span> <span class="nv">VAR2</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">values</span> <span class="nv">VAR2</span> <span class="nv">VAR1</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">temp</span> <span class="nv">a</span>
      <span class="nv">a</span> <span class="nv">b</span>
      <span class="nv">b</span> <span class="nv">temp</span><span class="p">)</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">a</span> <span class="s">&quot;alpha&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">b</span> <span class="s">&quot;omega&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">rotatef</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))</span>           <span class="c1">; the first shall be last -- and versa vice</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">destructuring-bind</span> <span class="p">(</span><span class="nv">alpha</span> <span class="nv">beta</span> <span class="nv">production</span><span class="p">)</span>
    <span class="c1">;; In CL one would normally use symbols here:</span>
    <span class="c1">;; &#39;(January March August)</span>
    <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;January&quot;</span> <span class="s">&quot;March&quot;</span> <span class="s">&quot;August&quot;</span><span class="p">)</span>
  <span class="c1">;; move beta       to alpha,</span>
  <span class="c1">;; move production to beta,</span>
  <span class="c1">;; move alpha      to production</span>
  <span class="p">(</span><span class="nb">rotatef</span> <span class="nv">alpha</span> <span class="nv">beta</span> <span class="nv">production</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN26"
>Converting Between ASCII Characters and Values</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;-----------------------------</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">num</span> <span class="p">(</span><span class="nb">char-code</span> <span class="nb">char</span><span class="p">))</span>
<span class="p">(</span><span class="k">setq</span> <span class="nb">char</span> <span class="p">(</span><span class="nb">code-char</span> <span class="nv">num</span><span class="p">))</span>
<span class="c1">;;-----------------------------</span>
<span class="p">(</span><span class="k">setq</span> <span class="nb">char</span> <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;~c&quot;</span> <span class="p">(</span><span class="nb">code-char</span> <span class="nv">num</span><span class="p">)))</span>
<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;Number ~d is character ~c~%&quot;</span> <span class="nv">num</span> <span class="p">(</span><span class="nb">code-char</span> <span class="nv">num</span><span class="p">))</span>
<span class="c1">;; Number 101 is character e</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">ASCII</span> <span class="p">(</span><span class="nb">map</span> <span class="ss">&#39;list</span> <span class="nf">#&#39;</span><span class="nb">char-code</span> <span class="nb">string</span><span class="p">))</span>
<span class="p">(</span><span class="k">setq</span> <span class="nb">string</span> <span class="p">(</span><span class="nb">map</span> <span class="ss">&#39;string</span> <span class="nf">#&#39;</span><span class="nb">code-char</span> <span class="nv">ASCII</span><span class="p">))</span>
<span class="c1">;;-----------------------------</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">ascii-value</span> <span class="p">(</span><span class="nb">char-code</span> <span class="sc">#\e</span><span class="p">))</span>             <span class="c1">; now 101</span>
<span class="p">(</span><span class="k">setq</span> <span class="nb">character</span> <span class="p">(</span><span class="nb">code-char</span> <span class="mi">101</span><span class="p">))</span>               <span class="c1">; now #\e</span>
<span class="c1">;;-----------------------------</span>
<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;Number ~D is character ~C~%&quot;</span> <span class="mi">101</span> <span class="p">(</span><span class="nb">code-char</span> <span class="mi">101</span><span class="p">))</span>
<span class="c1">;;-----------------------------</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">ascii-character-numbers</span> <span class="p">(</span><span class="nb">map</span> <span class="ss">&#39;list</span> <span class="nf">#&#39;</span><span class="nb">char-code</span> <span class="s">&quot;sample&quot;</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~{~A~^ ~}~%&quot;</span> <span class="nv">ascii-character-numbers</span><span class="p">)</span>
<span class="c1">;; 115 97 109 112 108 101</span>
  <span class="p">(</span><span class="nb">setf</span> <span class="nv">word</span> <span class="p">(</span><span class="nb">map</span> <span class="ss">&#39;string</span> <span class="nf">#&#39;</span><span class="nb">code-char</span> <span class="nv">ascii-character-numbers</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">setf</span> <span class="nv">word</span> <span class="p">(</span><span class="nb">map</span> <span class="ss">&#39;string</span> <span class="nf">#&#39;</span><span class="nb">code-char</span> <span class="o">#(</span><span class="mi">115</span> <span class="mi">97</span> <span class="mi">109</span> <span class="mi">112</span> <span class="mi">108</span> <span class="mi">101</span><span class="p">)))</span> <span class="c1">; same</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A~%&quot;</span> <span class="nv">word</span><span class="p">))</span>
<span class="c1">;; sample</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">hal</span> <span class="s">&quot;HAL&quot;</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">ibm</span> <span class="p">(</span><span class="nb">map</span> <span class="ss">&#39;string</span>
                 <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nb">char</span><span class="p">)</span>
                   <span class="p">(</span><span class="nb">code-char</span> <span class="p">(</span><span class="nb">1+</span> <span class="p">(</span><span class="nb">char-code</span> <span class="nb">char</span><span class="p">))))</span> <span class="c1">; add one to each ASCII value</span>
                 <span class="nv">hal</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A~%&quot;</span> <span class="nv">ibm</span><span class="p">))</span>                <span class="c1">; prints &quot;IBM&quot;</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN29"
>Processing a String One Character at a Time</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">setq</span> <span class="nc">array</span> <span class="p">(</span><span class="nb">map</span> <span class="ss">&#39;list</span> <span class="nf">#&#39;</span><span class="nb">string</span> <span class="nb">string</span><span class="p">))</span>

<span class="p">(</span><span class="k">setq</span> <span class="nc">array</span> <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nb">char</span> <span class="nv">across</span> <span class="nb">string</span>
               <span class="nv">collect</span> <span class="p">(</span><span class="nb">char-code</span> <span class="nb">char</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nv">do-matches-as-strings</span> <span class="p">(</span><span class="nv">match</span> <span class="s">&quot;(.)&quot;</span> <span class="nb">string</span><span class="p">)</span>
  <span class="c1">;; do something with MATCH</span>
  <span class="p">)</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">seen</span> <span class="p">(</span><span class="nb">make-hash-table</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">string</span> <span class="s">&quot;an apple a day&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nb">char</span> <span class="nv">across</span> <span class="nb">string</span> <span class="nb">do</span>
       <span class="p">(</span><span class="nb">incf</span> <span class="p">(</span><span class="nb">gethash</span> <span class="nb">char</span> <span class="nv">seen</span> <span class="mi">0</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">chars</span> <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nb">char</span> <span class="nv">being</span> <span class="nv">each</span> <span class="nv">hash-key</span> <span class="nv">of</span> <span class="nv">seen</span>
                  <span class="nv">collect</span> <span class="nb">char</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;unique chars are: ~{~C~}~%&quot;</span>
            <span class="p">(</span><span class="nb">sort</span> <span class="nv">chars</span> <span class="ss">&#39;&lt;</span> <span class="ss">:key</span> <span class="ss">&#39;char-code</span><span class="p">))))</span>
<span class="c1">;; unique chars are:  adelnpy</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nb">string</span> <span class="s">&quot;an apple a day&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;sum is ~D~%&quot;</span>
          <span class="p">(</span><span class="nb">reduce</span> <span class="nf">#&#39;</span><span class="nb">+</span> <span class="nb">string</span> <span class="ss">:key</span> <span class="nf">#&#39;</span><span class="nb">char-code</span><span class="p">)))</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nb">string</span> <span class="s">&quot;an apple a day&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;sum is ~D~%&quot;</span>
          <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nb">char</span> <span class="nv">across</span> <span class="nb">string</span>
                <span class="nv">summing</span> <span class="p">(</span><span class="nb">char-code</span> <span class="nb">char</span><span class="p">))))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nb">string</span> <span class="s">&quot;an apple a day&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;sum is ~D~%&quot;</span>
          <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nb">char</span> <span class="nv">across</span> <span class="nb">string</span>
             <span class="nv">sum</span> <span class="p">(</span><span class="nb">char-code</span> <span class="nb">char</span><span class="p">))))</span>
<span class="c1">;; prints &quot;1248&quot; if string was &quot;an apple a day&quot;</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; There&#39;s no equivalent to Perl&#39;s unpack(), this is about as close as</span>
<span class="c1">;; you can get.</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">sum</span> <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nb">char</span> <span class="nv">across</span> <span class="nb">string</span>
             <span class="nv">sum</span> <span class="p">(</span><span class="nb">char-code</span> <span class="nb">char</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; In CL it makes more sense to call this function from the REPL than</span>
<span class="c1">;; it does to put it into a separate script.  E.g.,</span>
<span class="c1">;;  &gt; (sum &quot;/tmp/xyz&quot; &quot;~/foo/bar.txt&quot;)</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">sum</span> <span class="p">(</span><span class="k">&amp;rest</span> <span class="nv">files</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">sum</span> <span class="mi">0</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">filename</span> <span class="nv">files</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">with-open-file</span> <span class="p">(</span><span class="nv">file</span> <span class="nv">filename</span> <span class="ss">:element-type</span> <span class="ss">&#39;unsigned-byte</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">do</span> <span class="p">((</span><span class="nv">b</span> <span class="p">(</span><span class="nb">read-byte</span> <span class="nv">file</span> <span class="no">nil</span> <span class="ss">:eof</span><span class="p">)</span>
                <span class="p">(</span><span class="nb">read-byte</span> <span class="nv">file</span> <span class="no">nil</span> <span class="ss">:eof</span><span class="p">)))</span>
            <span class="p">((</span><span class="nb">eql</span> <span class="nv">b</span> <span class="ss">:eof</span><span class="p">))</span>
          <span class="p">(</span><span class="nb">incf</span> <span class="nv">sum</span> <span class="nv">b</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">r</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">mod</span> <span class="nv">sum</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">2</span> <span class="mi">16</span><span class="p">))</span>
                <span class="p">(</span><span class="nb">truncate</span> <span class="p">(</span><span class="nb">/</span> <span class="p">(</span><span class="nb">mod</span> <span class="nv">sum</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">2</span> <span class="mi">32</span><span class="p">))</span>
                             <span class="p">(</span><span class="nb">expt</span> <span class="mi">2</span> <span class="mi">16</span><span class="p">))))))</span>
      <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">mod</span> <span class="nv">r</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">2</span> <span class="mi">16</span><span class="p">))</span>
         <span class="p">(</span><span class="nb">truncate</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">r</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">2</span> <span class="mi">16</span><span class="p">)))))))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;;CL-USER&gt; (sum &quot;/mach.sym&quot;)</span>
<span class="c1">;;24298</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;;%cksum -o 2 /mach.sym</span>
<span class="c1">;;24298 1203 /mach.sym</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">slowcat</span> <span class="p">(</span><span class="nv">number-or-filename</span> <span class="k">&amp;rest</span> <span class="nv">more-files</span><span class="p">)</span>
  <span class="s">&quot;The first argument can be a number of seconds to sleep between</span>
<span class="s">characters, otherwise it should be a file name.&quot;</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">delay</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">numberp</span> <span class="nv">number-or-filename</span><span class="p">)</span> <span class="nv">number-or-filename</span> <span class="mi">1</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">files</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">numberp</span> <span class="nv">number-or-filename</span><span class="p">)</span> <span class="nv">more-files</span> <span class="p">(</span><span class="nb">cons</span> <span class="nv">number-or-filename</span> <span class="nv">more-files</span><span class="p">))))</span>
    <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">filename</span> <span class="nv">files</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">with-open-file</span> <span class="p">(</span><span class="nv">file</span> <span class="nv">filename</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">do</span> <span class="p">((</span><span class="nv">c</span> <span class="p">(</span><span class="nb">read-char</span> <span class="nv">file</span> <span class="no">nil</span> <span class="ss">:eof</span><span class="p">)</span>
                <span class="p">(</span><span class="nb">read-char</span> <span class="nv">file</span> <span class="no">nil</span> <span class="ss">:eof</span><span class="p">)))</span>
            <span class="p">((</span><span class="nb">eql</span> <span class="nv">c</span> <span class="ss">:eof</span><span class="p">))</span>
          <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~C&quot;</span> <span class="nv">c</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">finish-output</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">sleep</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">delay</span> <span class="mf">0.005</span><span class="p">)))))))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN32"
>Reversing a String by Word or Character</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">revbytes</span> <span class="p">(</span><span class="nb">reverse</span> <span class="nb">string</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">revwords</span> <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;~{~A~^ ~}&quot;</span>
                       <span class="p">(</span><span class="nb">reverse</span> <span class="p">(</span><span class="nv">split</span> <span class="s">&quot; &quot;</span> <span class="nb">string</span><span class="p">))))</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">revwords</span> <span class="p">(</span><span class="nb">reverse</span>
                <span class="p">(</span><span class="nb">do*</span> <span class="p">((</span><span class="nv">stringstream</span> <span class="p">(</span><span class="nb">make-string-input-stream</span> <span class="nb">string</span><span class="p">))</span>
                      <span class="p">(</span><span class="nv">result</span> <span class="no">nil</span> <span class="p">(</span><span class="nb">cons</span> <span class="nv">next</span> <span class="nv">result</span><span class="p">))</span>
                      <span class="p">(</span><span class="nv">next</span> <span class="p">(</span><span class="nb">read</span> <span class="nv">stringstream</span> <span class="no">nil</span> <span class="ss">&#39;eos</span><span class="p">)</span>
                            <span class="p">(</span><span class="nb">read</span> <span class="nv">stringstream</span> <span class="no">nil</span> <span class="ss">&#39;eos</span><span class="p">)))</span>
                     <span class="p">((</span><span class="nb">equal</span> <span class="nv">next</span> <span class="ss">&#39;eos</span><span class="p">)</span>
                      <span class="p">(</span><span class="nb">reverse</span> <span class="nv">result</span><span class="p">)))))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">gnirts</span> <span class="p">(</span><span class="nb">reverse</span> <span class="nb">string</span><span class="p">))</span>          <span class="c1">; reverse letters in string</span>

<span class="p">(</span><span class="k">setq</span> <span class="nv">sdrow</span> <span class="p">(</span><span class="nb">reverse</span> <span class="nv">words</span><span class="p">))</span>            <span class="c1">; reverse elements in words</span>

<span class="p">(</span><span class="k">setq</span> <span class="nv">confused</span> <span class="p">(</span><span class="nb">reverse</span> <span class="p">(</span><span class="nb">apply</span> <span class="nf">#&#39;</span><span class="nb">concatenate</span> <span class="ss">&#39;string</span> <span class="nv">words</span><span class="p">)))</span> <span class="c1">; reverse letters in join(&quot;&quot;, @words)</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">setq</span> <span class="nb">string</span> <span class="s">&quot;Yoda said, \&quot;can you see this?\&quot;&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">allwords</span> <span class="p">(</span><span class="nv">split</span> <span class="s">&quot; &quot;</span> <span class="nb">string</span><span class="p">))</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">revwords</span> <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;~{~A~^ ~}&quot;</span> <span class="p">(</span><span class="nb">reverse</span> <span class="nv">allwords</span><span class="p">)))</span>
<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A~%&quot;</span> <span class="nv">revwords</span><span class="p">)</span>
<span class="c1">;this?&quot; see you &quot;can said, Yoda</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">revwords</span> <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;~{~A~^ ~}&quot;</span> <span class="p">(</span><span class="nb">reverse</span> <span class="p">(</span><span class="nv">split</span> <span class="s">&quot; &quot;</span> <span class="nb">string</span><span class="p">))))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">revwords</span> <span class="p">(</span><span class="nb">apply</span> <span class="nf">#&#39;</span><span class="nb">concatenate</span> <span class="ss">&#39;string</span>
                      <span class="p">(</span><span class="nv">split</span> <span class="s">&quot;(\\s+)&quot;</span> <span class="nb">string</span> <span class="ss">:with-registers-p</span> <span class="no">t</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">palindrome-p</span> <span class="p">(</span><span class="nv">word</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">string=</span> <span class="nv">word</span> <span class="p">(</span><span class="nb">reverse</span> <span class="nv">word</span><span class="p">)))</span>
<span class="p">(</span><span class="nv">palindrome-p</span> <span class="s">&quot;reviver&quot;</span><span class="p">)</span>
<span class="c1">;; T</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">with-open-file</span> <span class="p">(</span><span class="nv">inf</span> <span class="s">&quot;/usr/share/dict/words&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">word</span> <span class="nb">=</span> <span class="p">(</span><span class="nb">read-line</span> <span class="nv">inf</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">)</span>
        <span class="nv">while</span> <span class="nv">word</span>
        <span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">string=</span> <span class="nv">word</span> <span class="p">(</span><span class="nb">reverse</span> <span class="nv">word</span><span class="p">))</span>
                  <span class="p">(</span><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">word</span><span class="p">)</span> <span class="mi">5</span><span class="p">))</span>
        <span class="nb">do</span> <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~a~%&quot;</span> <span class="nv">word</span><span class="p">)))</span>
<span class="c1">;; deedeed</span>
<span class="c1">;; degged</span>
<span class="c1">;; hallah</span>
<span class="c1">;; kakkak</span>
<span class="c1">;; murdrum</span>
<span class="c1">;; redder</span>
<span class="c1">;; repaper</span>
<span class="c1">;; retter</span>
<span class="c1">;; reviver</span>
<span class="c1">;; rotator</span>
<span class="c1">;; sooloos</span>
<span class="c1">;; tebbet</span>
<span class="c1">;; terret</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN35"
>Expanding and Compressing Tabs</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>

<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">tab-expand</span> <span class="p">(</span><span class="nb">string</span> <span class="k">&amp;optional</span> <span class="p">(</span><span class="nv">tabstop</span> <span class="mi">8</span><span class="p">))</span>
  <span class="p">(</span><span class="k">flet</span> <span class="p">((</span><span class="nv">needed-spaces</span> <span class="p">(</span><span class="nv">target-string</span> <span class="nv">start</span> <span class="nv">end</span> <span class="nv">match-start</span> <span class="nv">match-end</span> <span class="nv">reg-starts</span> <span class="nv">reg-ends</span><span class="p">)</span>
           <span class="p">(</span><span class="k">declare</span> <span class="p">(</span><span class="k">ignore</span> <span class="nv">target-string</span> <span class="nv">start</span> <span class="nv">end</span> <span class="nv">reg-starts</span> <span class="nv">reg-ends</span><span class="p">))</span>
           <span class="p">(</span><span class="nb">make-string</span> <span class="p">(</span><span class="nb">-</span> <span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">match-end</span> <span class="nv">match-start</span><span class="p">)</span> <span class="nv">tabstop</span><span class="p">)</span>
                           <span class="p">(</span><span class="nb">mod</span> <span class="nv">match-start</span> <span class="nv">tabstop</span><span class="p">))</span>
                        <span class="ss">:initial-element</span> <span class="sc">#\Space</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">regex-replace-all</span> <span class="s">&quot;\\t+&quot;</span> <span class="nb">string</span> <span class="nf">#&#39;</span><span class="nv">needed-spaces</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">tab-unexpand</span> <span class="p">(</span><span class="nb">string</span> <span class="k">&amp;optional</span> <span class="p">(</span><span class="nv">tabstop</span> <span class="mi">8</span><span class="p">))</span>
  <span class="p">(</span><span class="k">flet</span> <span class="p">((</span><span class="nv">needed-tabs</span> <span class="p">(</span><span class="nv">target-string</span> <span class="nv">start</span> <span class="nv">end</span> <span class="nv">match-start</span> <span class="nv">match-end</span> <span class="nv">reg-starts</span> <span class="nv">reg-ends</span><span class="p">)</span>
           <span class="p">(</span><span class="k">declare</span> <span class="p">(</span><span class="k">ignore</span> <span class="nv">target-string</span> <span class="nv">start</span> <span class="nv">end</span> <span class="nv">reg-starts</span> <span class="nv">reg-ends</span><span class="p">))</span>
           <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">match-length</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">match-end</span> <span class="nv">match-start</span><span class="p">)))</span>
             <span class="p">(</span><span class="nb">concatenate</span> <span class="ss">&#39;string</span>
                          <span class="p">(</span><span class="nb">make-string</span> <span class="p">(</span><span class="nb">floor</span> <span class="nv">match-length</span> <span class="nv">tabstop</span><span class="p">)</span>
                                       <span class="ss">:initial-element</span> <span class="sc">#\Tab</span><span class="p">)</span>
                          <span class="p">(</span><span class="nb">make-string</span> <span class="p">(</span><span class="nb">mod</span> <span class="nv">match-length</span> <span class="nv">tabstop</span><span class="p">)</span>
                                       <span class="ss">:initial-element</span> <span class="sc">#\Space</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nv">regex-replace-all</span> <span class="s">&quot;  +&quot;</span> <span class="nb">string</span> <span class="nf">#&#39;</span><span class="nv">needed-tabs</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">line</span> <span class="nb">=</span> <span class="p">(</span><span class="nb">read-line</span> <span class="vg">*standard-input*</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">)</span>
      <span class="nv">while</span> <span class="nv">line</span> <span class="nb">do</span>
      <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A~%&quot;</span> <span class="p">(</span><span class="nv">tab-expand</span> <span class="nv">line</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">line</span> <span class="nb">=</span> <span class="p">(</span><span class="nb">read-line</span> <span class="vg">*standard-input*</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">)</span>
      <span class="nv">while</span> <span class="nv">line</span> <span class="nb">do</span>
      <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A~%&quot;</span> <span class="p">(</span><span class="nv">tab-unexpand</span> <span class="nv">line</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN38"
>Expanding Variables in User Input</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>

<span class="p">(</span><span class="nb">setf</span> <span class="nv">text</span> <span class="s">&quot;You owe $debt to me&quot;</span><span class="p">)</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">global-deref</span> <span class="p">(</span><span class="nv">match</span> <span class="nv">var-name</span><span class="p">)</span>
  <span class="s">&quot;Helper function to simulate Perl&#39;s string interpolation in</span>
<span class="s">regexps.&quot;</span>
  <span class="p">(</span><span class="nb">write-to-string</span> <span class="p">(</span><span class="nb">symbol-value</span> <span class="p">(</span><span class="nb">intern</span> <span class="p">(</span><span class="nb">string-upcase</span> <span class="nv">var-name</span><span class="p">)))))</span>

<span class="p">(</span><span class="nb">setf</span> <span class="nv">text</span> <span class="p">(</span><span class="nv">regex-replace-all</span> <span class="s">&quot;\\$(\\w+)&quot;</span> <span class="nv">text</span> <span class="nf">#&#39;</span><span class="nv">global-deref</span>
                                       <span class="ss">:simple-calls</span> <span class="no">t</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">rows</span> <span class="mi">24</span> <span class="nv">cols</span> <span class="mi">80</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">text</span> <span class="s">&quot;I am $rows high and $cols long&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">text</span> <span class="p">(</span><span class="nv">regex-replace-all</span> <span class="s">&quot;\\$(\\w+)&quot;</span> <span class="nv">text</span>
                                       <span class="nf">#&#39;</span><span class="nv">global-deref</span>
                                       <span class="ss">:simple-calls</span> <span class="no">t</span><span class="p">))</span>
<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A~%&quot;</span> <span class="nv">text</span><span class="p">)</span>
<span class="c1">;; I am 24 high and 80 long</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">text</span> <span class="s">&quot;I am 17 years old&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">text</span> <span class="p">(</span><span class="nv">regex-replace-all</span> <span class="s">&quot;(\\d+)&quot;</span> <span class="nv">text</span>
                                       <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">match</span> <span class="nv">num-str</span><span class="p">)</span>
                                         <span class="p">(</span><span class="k">declare</span> <span class="p">(</span><span class="k">ignore</span> <span class="nv">match</span><span class="p">))</span>
                                         <span class="p">(</span><span class="nb">write-to-string</span>
                                          <span class="p">(</span><span class="nb">*</span> <span class="mi">2</span> <span class="p">(</span><span class="nb">parse-integer</span> <span class="nv">num-str</span><span class="p">))))</span>
                                       <span class="ss">:simple-calls</span> <span class="no">t</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">*</span> <span class="mi">2</span> <span class="mi">17</span><span class="p">)</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; expand variables in text, but put an error message in</span>
<span class="c1">;; if the variable isn&#39;t defined</span>
<span class="p">(</span><span class="k">flet</span> <span class="p">((</span><span class="nv">deref-with-err</span> <span class="p">(</span><span class="nv">match</span> <span class="nv">word</span><span class="p">)</span>
         <span class="p">(</span><span class="k">declare</span> <span class="p">(</span><span class="k">ignore</span> <span class="nv">match</span><span class="p">))</span>
         <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">word-sym</span> <span class="p">(</span><span class="nb">intern</span> <span class="p">(</span><span class="nb">string-upcase</span> <span class="nv">word</span><span class="p">))))</span>
           <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">boundp</span> <span class="nv">word-sym</span><span class="p">)</span>
               <span class="p">(</span><span class="nb">write-to-string</span> <span class="p">(</span><span class="nb">symbol-value</span> <span class="nv">word-sym</span><span class="p">))</span>
               <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;[NO VARIABLE: $~a]&quot;</span> <span class="nv">word-sym</span><span class="p">)))))</span>
  <span class="p">(</span><span class="nb">setf</span> <span class="nv">text</span> <span class="p">(</span><span class="nv">regex-replace-all</span> <span class="s">&quot;\\$(\\w+)&quot;</span> <span class="nv">text</span>
                                         <span class="nf">#&#39;</span><span class="nv">deref-with-err</span>
                                         <span class="ss">:simple-calls</span> <span class="no">t</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN41"
>Controlling Case</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">big</span> <span class="p">(</span><span class="nb">string-upcase</span> <span class="nv">little</span><span class="p">))</span>       <span class="c1">; &quot;bo peep&quot; -&gt; &quot;BO PEEP&quot;</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">little</span> <span class="p">(</span><span class="nb">string-downcase</span> <span class="nv">big</span><span class="p">))</span>     <span class="c1">; &quot;JOHN&quot;    -&gt; &quot;john&quot;</span>
<span class="c1">;; Reminder: the following depends on CL-INTERPOL.</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">big</span> <span class="err">#</span><span class="nv">?</span><span class="s">&quot;\U$(little)&quot;</span><span class="p">)</span>              <span class="c1">; &quot;bo peep&quot; -&gt; &quot;BO PEEP&quot;</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">little</span> <span class="err">#</span><span class="nv">?</span><span class="s">&quot;\L$(big)&quot;</span><span class="p">)</span>              <span class="c1">; &quot;JOHN&quot; -&gt; &quot;john&quot;</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">big</span> <span class="p">(</span><span class="nb">string-upcase</span> <span class="nv">little</span> <span class="ss">:end</span> <span class="mi">1</span><span class="p">)</span>    <span class="c1">; &quot;bo&quot;      -&gt; &quot;Bo&quot;</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">little</span> <span class="p">(</span><span class="nb">string-downcase</span> <span class="nv">BIG</span> <span class="ss">:end</span> <span class="mi">1</span><span class="p">))</span> <span class="c1">; &quot;BoPeep&quot;    -&gt; &quot;boPeep&quot;</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">big</span> <span class="err">#</span><span class="nv">?</span><span class="s">&quot;\u$(little)&quot;</span><span class="p">)</span>                 <span class="c1">; &quot;bo&quot;      -&gt; &quot;Bo&quot;</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">little</span> <span class="err">#</span><span class="nv">?</span><span class="s">&quot;\l$(big)&quot;</span><span class="p">)</span>                 <span class="c1">; &quot;BoPeep&quot;    -&gt; &quot;boPeep&quot;</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">beast</span> <span class="s">&quot;dromedary&quot;</span><span class="p">)</span>
<span class="c1">;; Capitalize various parts of beast</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">capit</span> <span class="p">(</span><span class="nb">string-upcase</span> <span class="nv">beast</span> <span class="ss">:end</span> <span class="mi">1</span><span class="p">))</span>      <span class="c1">; Dromedary</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">capit</span> <span class="err">#</span><span class="nv">?</span><span class="s">&quot;\u\L$(beast)&quot;</span><span class="p">)</span>                  <span class="c1">; (same)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">capall</span> <span class="p">(</span><span class="nb">string-upcase</span> <span class="nv">beast</span><span class="p">))</span>            <span class="c1">; DROMEDARY</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">capall</span> <span class="err">#</span><span class="nv">?</span><span class="s">&quot;\U$(beast)&quot;</span><span class="p">)</span>                   <span class="c1">; (same)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">caprest</span> <span class="p">(</span><span class="nb">string-downcase</span> <span class="p">(</span><span class="nb">string-upcase</span> <span class="nv">beast</span><span class="p">)</span> <span class="ss">:end</span> <span class="mi">1</span><span class="p">))</span> <span class="c1">; dROMEDARY</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">caprest</span> <span class="err">#</span><span class="nv">?</span><span class="s">&quot;\l\U$(beast)&quot;</span><span class="p">)</span>                               <span class="c1">; (same)</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; capitalize each word&#39;s first character, downcase the rest</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">text</span> <span class="s">&quot;thIS is a loNG liNE&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A~%&quot;</span> <span class="p">(</span><span class="nb">string-capitalize</span> <span class="nv">text</span><span class="p">))</span>
<span class="c1">;; This Is A Long Line</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; string= is case-sensitive, string-equal is case-insensitive</span>
<span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">string-equal</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;a and b are the same~%&quot;</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; It&#39;s considered bad form to perform bitwise operations on character</span>
<span class="c1">;; types, and breaks unicode-aware lisps.  Trust the compiler to</span>
<span class="c1">;; optimize.</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">randcase</span> <span class="p">(</span><span class="nb">char</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="p">(</span><span class="nb">random</span> <span class="mi">100</span><span class="p">)</span> <span class="mi">20</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">char-upcase</span> <span class="nb">char</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">char-downcase</span> <span class="nb">char</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN44"
>Interpolating Functions and Expressions Within Strings</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">answer</span> <span class="p">(</span><span class="nb">concatenate</span> <span class="ss">&#39;string</span> <span class="nv">var1</span> <span class="p">(</span><span class="nv">func</span><span class="p">)</span> <span class="nv">var2</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">answer</span> <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;STRING ~{~A~} MORE STRING&quot;</span> <span class="nv">list-expr</span><span class="p">))</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">answer</span> <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;STRING ~A MORE STRING&quot;</span> <span class="nv">atomic-expr</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">phrase</span> <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;I have ~D guanacos.&quot;</span> <span class="p">(</span><span class="nb">1+</span> <span class="nv">n</span><span class="p">)))</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">phrase</span> <span class="err">#</span><span class="nv">?</span><span class="s">&quot;I have ${(1+ n)} guanacos.&quot;</span><span class="p">)</span> <span class="c1">; uses CL-INTERPOL</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;I have ~D guanacos.~%&quot;</span> <span class="p">(</span><span class="nb">1+</span> <span class="nv">n</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nv">some-func</span> <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;What you want is ~{~A~} items&quot;</span>
                   <span class="p">(</span><span class="nv">split</span> <span class="s">&quot;:&quot;</span> <span class="nv">rec</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">text</span> <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;~</span>
<span class="s">To: ~A</span>
<span class="s">From: Your Bank</span>
<span class="s">Cc: ~{~A~^, ~}</span>
<span class="s">Date: ~A (today)</span>

<span class="s">Dear ~A,</span>

<span class="s">Today, you bounced check number ~D to us.</span>
<span class="s">Your account is now closed.</span>

<span class="s">Sincerely,</span>
<span class="s">the management</span>
<span class="s">&quot;</span>
                    <span class="nv">naughty</span>
                    <span class="p">(</span><span class="nv">get-manager-list</span> <span class="nv">naughty</span><span class="p">)</span>
                    <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">date-str</span> <span class="p">(</span><span class="nb">with-output-to-string</span> <span class="p">(</span><span class="nv">str</span><span class="p">)</span>
                                     <span class="p">(</span><span class="nv">run-program</span> <span class="s">&quot;/bin/date&quot;</span> <span class="no">nil</span>
                                                  <span class="ss">:output</span> <span class="nv">str</span><span class="p">)))</span>
                      <span class="p">(</span><span class="nb">subseq</span> <span class="nv">date-str</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">1-</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">date-str</span><span class="p">))))</span>
                    <span class="nv">naughty</span>
                    <span class="p">(</span><span class="nb">+</span> <span class="mi">500</span> <span class="p">(</span><span class="nb">random</span> <span class="mi">100</span><span class="p">)))))</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">send-mail</span> <span class="nv">text</span> <span class="nv">target</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">error</span> <span class="s">&quot;Couldn&#39;t send mail&quot;</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN47"
>Indenting Here Documents</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="c1">;; all in one</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">var</span> <span class="p">(</span><span class="nv">regex-replace-all</span>
           <span class="p">(</span><span class="nv">create-scanner</span> <span class="err">#</span><span class="nv">?r</span><span class="s">&quot;^\s+&quot;</span> <span class="ss">:multi-line-mode</span> <span class="no">t</span><span class="p">)</span>
<span class="s">&quot;your text</span>
<span class="s">goes here</span>
<span class="s">&quot;</span> <span class="s">&quot;&quot;</span><span class="p">))</span>

<span class="c1">;; or with two steps</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">var</span> <span class="s">&quot;your text</span>
<span class="s">goes here</span>
<span class="s">&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">var</span> <span class="p">(</span><span class="nv">regex-replace-all</span>
           <span class="p">(</span><span class="nv">create-scanner</span> <span class="err">#</span><span class="nv">?r</span><span class="s">&quot;^\s+&quot;</span> <span class="ss">:multi-line-mode</span> <span class="no">t</span><span class="p">)</span>
           <span class="nv">var</span>
           <span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="c1">;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">var</span> <span class="p">(</span><span class="nv">regex-replace-all</span>
           <span class="p">(</span><span class="nv">create-scanner</span> <span class="err">#</span><span class="nv">?r</span><span class="s">&quot;^\s+&quot;</span> <span class="ss">:multi-line-mode</span> <span class="no">t</span><span class="p">)</span>
<span class="s">&quot;    The five varieties of camelids</span>
<span class="s">    are the familiar camel, his friends</span>
<span class="s">    the llama and the alpaca, and the</span>
<span class="s">    rather less well-known guanaco</span>
<span class="s">    and vicuсa.</span>
<span class="s">&quot;</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">fix</span> <span class="p">(</span><span class="nb">string</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">regex-replace-all</span>
   <span class="p">(</span><span class="nv">create-scanner</span> <span class="err">#</span><span class="nv">?r</span><span class="s">&quot;^\s+&quot;</span> <span class="ss">:multi-line-mode</span> <span class="no">t</span><span class="p">)</span>
   <span class="nb">string</span>
   <span class="s">&quot;&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A~%&quot;</span> <span class="p">(</span><span class="nv">fix</span> <span class="s">&quot;    My stuff goes here</span>
<span class="s">&quot;</span><span class="p">)</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="k">quote</span>
      <span class="p">(</span><span class="nv">regex-replace-all</span>
       <span class="p">(</span><span class="nv">create-scanner</span> <span class="err">#</span><span class="nv">?r</span><span class="s">&quot;\s+--&quot;</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">regex-replace-all</span>
        <span class="p">(</span><span class="nv">create-scanner</span> <span class="err">#</span><span class="nv">?r</span><span class="s">&quot;^\s+&quot;</span> <span class="ss">:multi-line-mode</span> <span class="no">t</span><span class="p">)</span>
<span class="s">&quot;        ...we will have peace, when you and all your works have</span>
<span class="s">        perished--and the works of your dark master to whom you would</span>
<span class="s">        deliver us. You are a liar, Saruman, and a corrupter of mens</span>
<span class="s">        hearts.  --Theoden in /usr/src/perl/taint.c</span>
<span class="s">&quot;</span>
       <span class="s">&quot;&quot;</span><span class="p">)</span>
       <span class="s">&quot;</span>
<span class="s">--&quot;</span><span class="p">))</span>
<span class="c1">;;-----------------------------</span>
<span class="p">(</span><span class="nb">when</span> <span class="vg">*remember-the-main*</span>
  <span class="p">(</span><span class="nb">setf</span> <span class="nv">perl-main-C</span> <span class="p">(</span><span class="nv">dequote</span>
<span class="s">&quot;        @@@ int</span>
<span class="s">         @@@ runops() {</span>
<span class="s">         @@@     SAVEI32(runlevel);</span>
<span class="s">         @@@     runlevel++;</span>
<span class="s">         @@@     while ( op = (*op-&gt;op_ppaddr)() ) ;</span>
<span class="s">         @@@     TAINT_NOT;</span>
<span class="s">         @@@     return 0;</span>
<span class="s">         @@@ }</span>
<span class="s">&quot;</span>
  <span class="c1">;; add more code here if you want</span>
   <span class="p">)))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defparameter</span> <span class="vg">*poem*</span> <span class="p">(</span><span class="nv">dequote</span>
<span class="s">&quot;       Now far ahead the Road has gone,</span>
<span class="s">          And I must follow, if I can,</span>
<span class="s">       Pursuing it with eager feet,</span>
<span class="s">          Until it joins some larger way</span>
<span class="s">       Where many paths and errands meet.</span>
<span class="s">          And whither then? I cannot say.</span>
<span class="s">                --Bilbo in /usr/src/perl/pp_ctl.c</span>
<span class="s">&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;Here&#39;s your poem:~%~%~A~%&quot;</span> <span class="vg">*poem*</span><span class="p">)</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">dequote</span> <span class="p">(</span><span class="nb">string</span><span class="p">)</span>
  <span class="c1">;; Can&#39;t get multiple values returned thru the OR, hence the use of</span>
  <span class="c1">;; DESTRUCTURING-BIND instead of MULTIPLE-VALUE-BIND</span>
  <span class="p">(</span><span class="nb">destructuring-bind</span> <span class="p">(</span><span class="nv">white</span> <span class="nv">leader</span><span class="p">)</span> <span class="c1">; common whitespace and common leading string</span>
      <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">register-groups-bind</span> <span class="p">(</span><span class="nv">$1</span> <span class="nv">$2</span><span class="p">)</span>
              <span class="p">(</span><span class="err">#</span><span class="nv">?r/^\s*</span><span class="p">(</span><span class="nv">?:</span><span class="p">(</span><span class="nv">[^\w\s]+</span><span class="p">)(</span><span class="nv">\s*</span><span class="p">)</span><span class="o">.</span><span class="nv">*\n</span><span class="p">)(</span><span class="nv">?:\s*\1\2?.*\n</span><span class="p">)</span><span class="nv">+$/</span> <span class="nb">string</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">list</span> <span class="nv">$2</span> <span class="p">(</span><span class="nv">quote-meta-chars</span> <span class="nv">$1</span><span class="p">)))</span>
          <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nv">scan-to-strings</span> <span class="err">#</span><span class="nv">?r</span><span class="s">&quot;^(\s+)&quot;</span> <span class="nb">string</span><span class="p">)</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">regex-replace-all</span>
     <span class="p">(</span><span class="nv">create-scanner</span> <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="err">#</span><span class="nv">?r</span><span class="s">&quot;^\s*?~a(?:~a)?&quot;</span> <span class="nv">leader</span> <span class="nv">white</span><span class="p">)</span> <span class="ss">:multi-line-mode</span> <span class="no">t</span><span class="p">)</span>
     <span class="nb">string</span>
     <span class="s">&quot;&quot;</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN50"
>Reformatting Paragraphs</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="nb">defvar</span> <span class="vg">*default-line-width*</span> <span class="mi">72</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">partition</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">max-part-len</span> <span class="nv">item-offset-len</span><span class="p">)</span>
  <span class="s">&quot;Partitions supplied `LIST&#39; into list of item lists where every sublist is of</span>
<span class="s">maximum `MAX-PART-LEN&#39; size. (`ITEM-OFFSET-LEN&#39; is added to every item while</span>
<span class="s">calculating item lengths.)&quot;</span>
  <span class="p">(</span><span class="nb">destructuring-bind</span> <span class="p">(</span><span class="nv">parts</span> <span class="nv">part</span> <span class="nv">part-len</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">reduce</span>
       <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">accum</span> <span class="nv">item</span><span class="p">)</span>
         <span class="p">(</span><span class="nb">destructuring-bind</span> <span class="p">(</span><span class="nv">parts</span> <span class="nv">part</span> <span class="nv">part-len</span><span class="p">)</span> <span class="nv">accum</span>
           <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">item-len</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">item</span><span class="p">)</span> <span class="nv">item-offset-len</span><span class="p">)))</span>
             <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="nv">max-part-len</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">part-len</span> <span class="nv">item-len</span><span class="p">))</span>
                 <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">nreverse</span> <span class="nv">part</span><span class="p">)</span> <span class="nv">parts</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">item</span><span class="p">)</span> <span class="nv">item-len</span><span class="p">)</span>
                 <span class="p">(</span><span class="nb">list</span> <span class="nv">parts</span> <span class="p">(</span><span class="nb">cons</span> <span class="nv">item</span> <span class="nv">part</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">part-len</span> <span class="nv">item-len</span><span class="p">))))))</span>
       <span class="nb">list</span> <span class="ss">:initial-value</span> <span class="p">(</span><span class="nb">list</span> <span class="no">nil</span> <span class="no">nil</span> <span class="mi">0</span><span class="p">))</span>
    <span class="p">(</span><span class="k">declare</span> <span class="p">(</span><span class="k">ignore</span> <span class="nv">part-len</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">nreverse</span> <span class="p">(</span><span class="k">if</span> <span class="nv">part</span> <span class="p">(</span><span class="nb">cons</span> <span class="nv">part</span> <span class="nv">parts</span><span class="p">)</span> <span class="nv">parts</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">wrap-paragraph</span> <span class="p">(</span><span class="nb">string</span> <span class="k">&amp;optional</span> <span class="nv">line-width</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">with-output-to-string</span> <span class="p">(</span><span class="nv">out</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">words</span>
              <span class="p">(</span><span class="nv">partition</span>
               <span class="p">(</span><span class="nv">ppcre:split</span> <span class="s">&quot;\\s+&quot;</span> <span class="nb">string</span><span class="p">)</span>
               <span class="p">(</span><span class="nb">1+</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">line-width</span> <span class="vg">*default-line-width*</span><span class="p">))</span>
               <span class="mi">1</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">format</span> <span class="nv">out</span> <span class="s">&quot;~&amp;~{~A~^ ~}&quot;</span> <span class="nv">words</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">wrap-paragraphs</span> <span class="p">(</span><span class="nb">string</span> <span class="k">&amp;optional</span> <span class="nv">line-width</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;~{~A~^~%~%~}&quot;</span>
          <span class="p">(</span><span class="nb">mapcar</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">paragraph</span><span class="p">)</span> <span class="p">(</span><span class="nv">wrap-paragraph</span> <span class="nv">paragraph</span> <span class="nv">line-width</span><span class="p">))</span>
                  <span class="p">(</span><span class="nv">ppcre:split</span> <span class="s">&quot;([\\r]?\\n){2,}&quot;</span> <span class="nb">string</span><span class="p">))))</span>

<span class="p">(</span><span class="nv">wrap-paragraphs</span> <span class="s">&quot;foo0 foo1 foo2 foo3 foo5 foo6 foo7 foo8</span>
<span class="s">foo9 bar0</span>

<span class="s">bar1 bar2</span>


<span class="s">bar3 bar4 bar5 bar6</span>
<span class="s">bar7</span>
<span class="s">bar8 bar9 baz0</span>

<span class="s">baz1 baz2 baz3 baz4 baz5 baz6 baz7 baz8 baz9&quot;</span> <span class="mi">14</span><span class="p">)</span>
<span class="c1">; =&gt; &quot;foo0 foo1 foo2</span>
<span class="c1">;     foo3 foo5 foo6</span>
<span class="c1">;     foo7 foo8 foo9</span>
<span class="c1">;     bar0</span>
<span class="c1">;</span>
<span class="c1">;     bar2 bar1</span>
<span class="c1">;</span>
<span class="c1">;     bar3 bar4 bar5</span>
<span class="c1">;     bar6 bar7 bar8</span>
<span class="c1">;     baz0 bar9</span>
<span class="c1">;</span>
<span class="c1">;     baz1 baz2 baz3</span>
<span class="c1">;     baz4 baz5 baz6</span>
<span class="c1">;     baz9 baz8 baz7&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN53"
>Escaping Characters</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; backslash</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">var</span> <span class="p">(</span><span class="nv">regex-replace-all</span> <span class="s">&quot;([CHARLIST])&quot;</span> <span class="nv">var</span> <span class="s">&quot;\\\1&quot;</span><span class="p">))</span>

<span class="c1">;; double</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">var</span> <span class="p">(</span><span class="nv">regex-replace-all</span> <span class="s">&quot;([CHARLIST])&quot;</span> <span class="nv">var</span> <span class="s">&quot;\\1\\1&quot;</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="p">(</span><span class="nv">regex-replace-all</span> <span class="s">&quot;%&quot;</span> <span class="nb">string</span> <span class="s">&quot;%%&quot;</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="s">&quot;Mom said, \&quot;Don&#39;t do that.\&quot;&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="p">(</span><span class="nv">regex-replace-all</span> <span class="s">&quot;([&#39;\&quot;])&quot;</span> <span class="nb">string</span> <span class="err">#</span><span class="nv">?r</span><span class="s">&quot;\\\1&quot;</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="s">&quot;Mom said, \&quot;Don&#39;t do that.\&quot;&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="p">(</span><span class="nv">regex-replace-all</span> <span class="s">&quot;([&#39;\&quot;])&quot;</span> <span class="nb">string</span> <span class="err">#</span><span class="nv">?r</span><span class="s">&quot;\1\1&quot;</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="p">(</span><span class="nv">regex-replace-all</span> <span class="err">#</span><span class="nv">?r</span><span class="s">&quot;([^A-Z])&quot;</span> <span class="nb">string</span> <span class="err">#</span><span class="nv">?r</span><span class="s">&quot;\\\1&quot;</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="err">#</span><span class="nv">?r</span><span class="s">&quot;this \Qis a test!\E&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="s">&quot;this is\\ a\\ test\\!&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="p">(</span><span class="nb">concatenate</span> <span class="ss">&#39;string</span> <span class="s">&quot;this &quot;</span> <span class="p">(</span><span class="nv">quote-meta-chars</span> <span class="s">&quot;is a test!&quot;</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN56"
>Trimming Blanks from the Ends of a String</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="p">(</span><span class="nv">regex-replace</span> <span class="err">#</span><span class="nv">?r/^\s+/</span> <span class="nb">string</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="p">(</span><span class="nv">regex-replace</span> <span class="err">#</span><span class="nv">?r/\s+$/</span> <span class="nb">string</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>

<span class="c1">;;; The closest thing to Perl&#39;s wantarray is CL&#39;s ability to return</span>
<span class="c1">;;; multiple values from a function.  Unless the caller uses</span>
<span class="c1">;;; MULTIPLE-VALUE-BIND (or, in this case, MULTIPLE-VALUE-LIST), they</span>
<span class="c1">;;; will only &quot;see&quot; the first value.  Note also that, normally, you&#39;d</span>
<span class="c1">;;; use CL&#39;s built-in STRING-TRIM function for this.</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">trim</span> <span class="p">(</span><span class="k">&amp;rest</span> <span class="nv">strings</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">values-list</span>
   <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nb">string</span> <span class="nv">in</span> <span class="nv">strings</span>
      <span class="nv">collect</span> <span class="p">(</span><span class="nv">regex-replace</span> <span class="err">#</span><span class="nv">?r/^\s+/</span>
                                      <span class="p">(</span><span class="nv">regex-replace</span> <span class="err">#</span><span class="nv">?r/\s+$/</span> <span class="nb">string</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
                                      <span class="s">&quot;&quot;</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">setf</span> <span class="nb">string</span> <span class="p">(</span><span class="nv">trim</span> <span class="nb">string</span><span class="p">))</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">many</span> <span class="p">(</span><span class="nb">multiple-value-list</span> <span class="p">(</span><span class="nb">apply</span> <span class="ss">&#39;trim</span> <span class="nv">many</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; print what&#39;s typed, but surrounded by &gt;&lt; symbols</span>
<span class="p">(</span><span class="nb">loop</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">line</span> <span class="p">(</span><span class="nb">read-line</span><span class="p">)))</span>
     <span class="p">(</span><span class="nv">chomp</span> <span class="nv">line</span><span class="p">)</span>
     <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="err">#</span><span class="nv">?</span><span class="s">&quot;&gt;$(line)&lt;~%&quot;</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN59"
>Parsing Comma-Separated Data</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">parse-csv</span> <span class="p">(</span><span class="nv">text</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">fields</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">cl-ppcre:do-register-groups</span> <span class="p">(</span><span class="nv">quoted</span> <span class="nv">unquoted</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&quot;\&quot;([^\&quot;\\\\]*(?:\\\\.[^\&quot;\\\\]*)*)\&quot;,?|([^,]+),?|,&quot;</span> <span class="nv">text</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">push</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">quoted</span> <span class="nv">unquoted</span><span class="p">)</span> <span class="nv">fields</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">nreverse</span> <span class="nv">fields</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; CL has no obvious equivalent to Text::ParseWords</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defparameter</span> <span class="vg">*line*</span> <span class="s">&quot;XYZZY,\&quot;\&quot;,\&quot;O&#39;Reilly, Inc\&quot;,\&quot;Wall, Larry\&quot;,\&quot;a \\\&quot;glug\\\&quot; bit,\&quot;,5,\&quot;Error, Core Dumped\&quot;&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">fields</span> <span class="p">(</span><span class="nv">parse-csv</span> <span class="vg">*line*</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">loop</span>
     <span class="nv">for</span> <span class="nv">i</span> <span class="nv">below</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">fields</span><span class="p">)</span>
     <span class="nb">do</span> <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~D : ~A~%&quot;</span> <span class="nv">i</span> <span class="p">(</span><span class="nb">elt</span> <span class="nv">fields</span> <span class="nv">i</span><span class="p">))))</span>
<span class="c1">;;0 : XYZZY</span>
<span class="c1">;;1 :</span>
<span class="c1">;;2 : O&#39;Reilly, Inc</span>
<span class="c1">;;3 : Wall, Larry</span>
<span class="c1">;;4 : a \&quot;glug\&quot; bit,</span>
<span class="c1">;;5 : 5</span>
<span class="c1">;;6 : Error, Core Dumped</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN62"
>Soundex Matching</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">system-users</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">with-open-file</span> <span class="p">(</span><span class="nv">in</span> <span class="s">&quot;/etc/passwd&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">line</span> <span class="nb">=</span> <span class="p">(</span><span class="nb">read-line</span> <span class="nv">in</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">)</span>
          <span class="nv">while</span> <span class="nv">line</span> <span class="nv">collect</span> <span class="p">(</span><span class="nv">ppcre:split</span> <span class="s">&quot;:&quot;</span> <span class="nv">line</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">soundex</span> <span class="p">(</span><span class="nb">string</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">soundex:soundex</span>
   <span class="p">(</span><span class="nb">with-output-to-string</span> <span class="p">(</span><span class="nv">out</span><span class="p">)</span>
     <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nb">char</span> <span class="nv">across</span> <span class="nb">string</span>
           <span class="nb">when</span> <span class="p">(</span><span class="nb">alphanumericp</span> <span class="nb">char</span><span class="p">)</span>
             <span class="nb">do</span> <span class="p">(</span><span class="nb">format</span> <span class="nv">out</span> <span class="s">&quot;~C&quot;</span> <span class="nb">char</span><span class="p">)))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">lookup-user</span> <span class="p">(</span><span class="nv">user</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">user-code</span> <span class="p">(</span><span class="nv">soundex</span> <span class="nv">user</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">user-spec</span> <span class="p">(</span><span class="nv">system-users</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">user-name</span> <span class="p">(</span><span class="nv">ppcre:split</span> <span class="s">&quot;\\s+&quot;</span> <span class="p">(</span><span class="nb">elt</span> <span class="nv">user-spec</span> <span class="mi">4</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">mismatch</span> <span class="nv">user-code</span> <span class="p">(</span><span class="nv">soundex</span> <span class="nv">user-name</span><span class="p">))</span>
        <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;User: ~S. (Matched Token: ~S.)~%&quot;</span>
                <span class="p">(</span><span class="nb">elt</span> <span class="nv">user-spec</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">user-name</span><span class="p">))))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">prompt-read</span> <span class="p">(</span><span class="nv">prompt</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">format</span> <span class="vg">*query-io*</span> <span class="s">&quot;~A: &quot;</span> <span class="nv">prompt</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">force-output</span> <span class="vg">*query-io*</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">read-line</span> <span class="vg">*query-io*</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">prompt-lookup-user</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">lookup-user</span> <span class="p">(</span><span class="nv">prompt-read</span> <span class="s">&quot;Lookup user&quot;</span><span class="p">)))</span>

<span class="c1">; TEST&gt; (prompt-lookup-user)</span>
<span class="c1">; Lookup user: volkan</span>
<span class="c1">; User: &quot;vy&quot;. (Matched Token: &quot;Volkan&quot;.)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN65"
>Program: fixstyle</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="nb">defvar</span> <span class="vg">*replacements*</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;analysed&quot;</span>        <span class="o">.</span> <span class="s">&quot;analyzed&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;built-in&quot;</span>        <span class="o">.</span> <span class="s">&quot;builtin&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;chastized&quot;</span>       <span class="o">.</span> <span class="s">&quot;chastised&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;commandline&quot;</span>     <span class="o">.</span> <span class="s">&quot;command-line&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;de-allocate&quot;</span>     <span class="o">.</span> <span class="s">&quot;deallocate&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;dropin&quot;</span>          <span class="o">.</span> <span class="s">&quot;drop-in&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;hardcode&quot;</span>        <span class="o">.</span> <span class="s">&quot;hard-code&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;meta-data&quot;</span>       <span class="o">.</span> <span class="s">&quot;metadata&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;multicharacter&quot;</span>  <span class="o">.</span> <span class="s">&quot;multi-character&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;multiway&quot;</span>        <span class="o">.</span> <span class="s">&quot;multi-way&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;non-empty&quot;</span>       <span class="o">.</span> <span class="s">&quot;nonempty&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;non-profit&quot;</span>      <span class="o">.</span> <span class="s">&quot;nonprofit&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;non-trappable&quot;</span>   <span class="o">.</span> <span class="s">&quot;nontrappable&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;pre-define&quot;</span>      <span class="o">.</span> <span class="s">&quot;predefine&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;preextend&quot;</span>       <span class="o">.</span> <span class="s">&quot;pre-extend&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;re-compiling&quot;</span>    <span class="o">.</span> <span class="s">&quot;recompiling&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;reenter&quot;</span>         <span class="o">.</span> <span class="s">&quot;re-enter&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;turnkey&quot;</span>         <span class="o">.</span> <span class="s">&quot;turn-key&quot;</span><span class="p">)))</span>

<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">scanner</span>
       <span class="p">(</span><span class="nv">ppcre:create-scanner</span>
        <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;(~{~A~^|~})&quot;</span> <span class="p">(</span><span class="nb">mapcar</span> <span class="nf">#&#39;</span><span class="nb">car</span> <span class="vg">*replacements*</span><span class="p">)))))</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">apply-replacements</span> <span class="p">(</span><span class="nb">string</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">ppcre:regex-replace-all</span>
     <span class="nv">scanner</span> <span class="nb">string</span>
     <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">target-string</span> <span class="nv">start</span> <span class="nv">end</span> <span class="nv">match-start</span> <span class="nv">match-end</span> <span class="nv">reg-starts</span> <span class="nv">reg-ends</span><span class="p">)</span>
       <span class="p">(</span><span class="k">declare</span> <span class="p">(</span><span class="k">ignore</span> <span class="nv">start</span> <span class="nv">end</span> <span class="nv">reg-starts</span> <span class="nv">reg-ends</span><span class="p">))</span>
       <span class="p">(</span><span class="nb">cdr</span> <span class="p">(</span><span class="nb">find</span> <span class="p">(</span><span class="nb">make-array</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">match-end</span> <span class="nv">match-start</span><span class="p">)</span>
                              <span class="ss">:element-type</span> <span class="p">(</span><span class="nb">array-element-type</span> <span class="nv">target-string</span><span class="p">)</span>
                              <span class="ss">:displaced-to</span> <span class="nv">target-string</span>
                              <span class="ss">:displaced-index-offset</span> <span class="nv">match-start</span><span class="p">)</span>
                  <span class="vg">*replacements*</span> <span class="ss">:test</span> <span class="nf">#&#39;</span><span class="nb">string-equal</span> <span class="ss">:key</span> <span class="nf">#&#39;</span><span class="nb">car</span><span class="p">))))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">replace-stream</span> <span class="p">(</span><span class="nv">in</span> <span class="nv">out</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">line</span> <span class="nb">=</span> <span class="p">(</span><span class="nb">read-line</span> <span class="nv">in</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">)</span>
        <span class="nv">while</span> <span class="nv">line</span> <span class="nb">do</span> <span class="p">(</span><span class="nb">format</span> <span class="nv">out</span> <span class="s">&quot;~&amp;~A&quot;</span> <span class="p">(</span><span class="nv">apply-replacements</span> <span class="nv">line</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">with-input-from-string</span>
    <span class="p">(</span><span class="nc">stream</span>
     <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;~{~&amp;~A~}&quot;</span>
             <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;If I have analysed these built-in&quot;</span>
               <span class="s">&quot;results correctly in a chastized manner&quot;</span>
               <span class="s">&quot;from commandline&quot;</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">with-output-to-string</span> <span class="p">(</span><span class="nv">out</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">replace-stream</span> <span class="nc">stream</span> <span class="nv">out</span><span class="p">)))</span>
<span class="c1">; =&gt; &quot;If I have analyzed these builtin</span>
<span class="c1">;     results correctly in a chastised manner</span>
<span class="c1">;     from command-line&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN68"
>Program: psgrep</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="nb">defvar</span> <span class="vg">*ps-fields*</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="nv">flags</span>   <span class="o">.</span> <span class="nc">integer</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">uid</span>     <span class="o">.</span> <span class="nc">integer</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">pid</span>     <span class="o">.</span> <span class="nc">integer</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">ppid</span>    <span class="o">.</span> <span class="nc">integer</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">pri</span>     <span class="o">.</span> <span class="nc">integer</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">nice</span>    <span class="o">.</span> <span class="nc">integer</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">size</span>    <span class="o">.</span> <span class="nc">integer</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">rss</span>     <span class="o">.</span> <span class="nc">integer</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">wchan</span>   <span class="o">.</span> <span class="nb">string</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">stat</span>    <span class="o">.</span> <span class="nb">string</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">tty</span>     <span class="o">.</span> <span class="nb">string</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">time</span>    <span class="o">.</span> <span class="nb">string</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">command</span> <span class="o">.</span> <span class="nb">string</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">format-ps-fields</span> <span class="p">(</span><span class="nv">fields</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">mapcar</span>
   <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">field-type</span> <span class="nv">field</span><span class="p">)</span>
     <span class="p">(</span><span class="nb">ecase</span> <span class="nv">field-type</span>
       <span class="p">(</span><span class="nc">integer</span> <span class="p">(</span><span class="nb">parse-integer</span> <span class="nv">field</span> <span class="ss">:junk-allowed</span> <span class="no">t</span><span class="p">))</span>
       <span class="p">(</span><span class="nb">string</span> <span class="nv">field</span><span class="p">)))</span>
   <span class="p">(</span><span class="nb">mapcar</span> <span class="nf">#&#39;</span><span class="nb">cdr</span> <span class="vg">*ps-fields*</span><span class="p">)</span>
   <span class="nv">fields</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">ps</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">with-input-from-string</span>
      <span class="p">(</span><span class="nv">in</span>
       <span class="p">(</span><span class="nv">trivial-shell:shell-command</span>
        <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;ps -o ~{~(~A~)~^,~}&quot;</span> <span class="p">(</span><span class="nb">mapcar</span> <span class="nf">#&#39;</span><span class="nb">car</span> <span class="vg">*ps-fields*</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">header</span> <span class="p">(</span><span class="nb">read-line</span> <span class="nv">in</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">))</span>
          <span class="p">(</span><span class="nv">lines</span> <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">line</span> <span class="nb">=</span> <span class="p">(</span><span class="nb">read-line</span> <span class="nv">in</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">)</span>
                       <span class="nv">while</span> <span class="nv">line</span> <span class="nv">collect</span> <span class="nv">line</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">values</span> <span class="p">(</span><span class="nb">mapcar</span> <span class="nf">#&#39;</span><span class="nv">format-ps-fields</span>
                      <span class="p">(</span><span class="nb">mapcar</span>
                       <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">limit</span> <span class="p">(</span><span class="nb">length</span> <span class="vg">*ps-fields*</span><span class="p">)))</span>
                         <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">line</span><span class="p">)</span> <span class="p">(</span><span class="nv">ppcre:split</span> <span class="s">&quot;\\s+&quot;</span> <span class="nv">line</span> <span class="ss">:limit</span> <span class="nv">limit</span><span class="p">)))</span>
                       <span class="nv">lines</span><span class="p">))</span>
              <span class="nv">header</span> <span class="nv">lines</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">defmacro</span> <span class="nv">ps-grep</span> <span class="p">(</span><span class="nv">expr</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">alexandria:with-unique-names</span> <span class="p">(</span><span class="nv">header-printed-p</span> <span class="nv">entries</span> <span class="nv">entry</span> <span class="nv">header</span> <span class="nv">lines</span> <span class="nv">line</span><span class="p">)</span>
    <span class="o">`</span><span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="o">,</span><span class="nv">header-printed-p</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">multiple-value-bind</span> <span class="p">(</span><span class="o">,</span><span class="nv">entries</span> <span class="o">,</span><span class="nv">header</span> <span class="o">,</span><span class="nv">lines</span><span class="p">)</span> <span class="p">(</span><span class="nv">ps</span><span class="p">)</span>
         <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="o">,</span><span class="nv">entry</span> <span class="nv">in</span> <span class="o">,</span><span class="nv">entries</span>
               <span class="nv">for</span> <span class="o">,</span><span class="nv">line</span> <span class="nv">in</span> <span class="o">,</span><span class="nv">lines</span>
               <span class="nb">when</span> <span class="p">(</span><span class="nb">destructuring-bind</span> <span class="o">,</span><span class="p">(</span><span class="nb">mapcar</span> <span class="nf">#&#39;</span><span class="nb">car</span> <span class="vg">*ps-fields*</span><span class="p">)</span> <span class="o">,</span><span class="nv">entry</span>
                      <span class="p">(</span><span class="k">declare</span> <span class="p">(</span><span class="k">ignorable</span> <span class="o">,@</span><span class="p">(</span><span class="nb">mapcar</span> <span class="nf">#&#39;</span><span class="nb">car</span> <span class="vg">*ps-fields*</span><span class="p">)))</span>
                      <span class="o">,</span><span class="nv">expr</span><span class="p">)</span>
                 <span class="nb">do</span> <span class="p">(</span><span class="nb">unless</span> <span class="o">,</span><span class="nv">header-printed-p</span>
                      <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A~%&quot;</span> <span class="o">,</span><span class="nv">header</span><span class="p">)</span>
                      <span class="p">(</span><span class="k">setq</span> <span class="o">,</span><span class="nv">header-printed-p</span> <span class="no">t</span><span class="p">))</span>
                    <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A~%&quot;</span> <span class="o">,</span><span class="nv">line</span><span class="p">))))))</span>

<span class="p">(</span><span class="nv">ps-grep</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="mi">2220</span> <span class="nv">rss</span><span class="p">)</span> <span class="p">(</span><span class="nb">=</span> <span class="nv">flags</span> <span class="mi">1</span><span class="p">)))</span>
<span class="c1">; =&gt; F   UID   PID  PPID PRI  NI    SZ   RSS WCHAN  STAT TT           TIME COMMAND</span>
<span class="c1">;    1  1000  2931     1  19   0   828  2644 -      Ss   ?        00:00:03 /usr/bin/fetchmail --daemon 600 --logfile /home/vy/.fetchmail.log</span>
<span class="c1">;    1  1000  3106  3104  19   0  1700  2360 -      Ss   ?        00:00:09 SCREEN -U</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="numbers.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>PLEAC-Common Lisp</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Numbers</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>