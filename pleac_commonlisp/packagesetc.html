<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Packages, Libraries, and Modules</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Common Lisp"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="References and Records"
HREF="referencesandrecords.html"><LINK
REL="NEXT"
TITLE="Classes, Objects, and Ties"
HREF="classesetc.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Common Lisp</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="referencesandrecords.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="classesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="PACKAGESETC"
>12. Packages, Libraries, and Modules</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN642"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defpackage</span> <span class="ss">:alpha</span> <span class="p">(</span><span class="ss">:use</span> <span class="ss">:cl</span><span class="p">))</span>
<span class="p">(</span><span class="nb">in-package</span> <span class="ss">:alpha</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">name</span> <span class="s">&quot;first&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defpackage</span> <span class="ss">:omega</span> <span class="p">(</span><span class="ss">:use</span> <span class="ss">:cl</span><span class="p">))</span>
<span class="p">(</span><span class="nb">in-package</span> <span class="ss">:omega</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">name</span> <span class="s">&quot;last&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nb">in-package</span> <span class="ss">:cl-user</span><span class="p">)</span> <span class="c1">; default package, kinda like Perl&#39;s &#39;main&#39; package</span>
<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;Alpha is ~A, omega is ~A.~%&quot;</span> <span class="nv">alpha::name</span> <span class="nv">omega::name</span><span class="p">)</span>
<span class="c1">;; Alpha is first, omega is last.</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">load</span> <span class="s">&quot;FileHandle.lisp&quot;</span><span class="p">)</span>                <span class="c1">; run-time load</span>
<span class="p">(</span><span class="nb">load</span> <span class="s">&quot;FileHandle.fasl&quot;</span><span class="p">)</span>        <span class="c1">; explicitly load pre-compiled version</span>
<span class="p">(</span><span class="nb">load</span> <span class="s">&quot;FileHandle&quot;</span><span class="p">)</span>          <span class="c1">; same as previous two, will prefer .fasl</span>
<span class="p">(</span><span class="nb">require</span> <span class="ss">:FileHandle</span><span class="p">)</span>                   <span class="c1">; similar, still run-time</span>

<span class="c1">;; Could use LOAD here instead of REQUIRE; it&#39;s the EVAL-WHEN that</span>
<span class="c1">;; makes this compile-time.  Note that it&#39;s fairly unusual to do this</span>
<span class="c1">;; explicitly with EVAL-WHEN.  Instead, one normally ensures that the</span>
<span class="c1">;; requisite packages have already been loaded before attempting to</span>
<span class="c1">;; compile a file, e.g., using a build system such as ASDF.</span>
<span class="p">(</span><span class="k">eval-when</span> <span class="p">(</span><span class="ss">:compile-toplevel</span> <span class="ss">:load-toplevel</span> <span class="ss">:execute</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">:FileHandle</span><span class="p">))</span>                <span class="c1">; compile-time</span>

<span class="c1">;; The Cards::Poker example is no different than the above in CL.  CL</span>
<span class="c1">;; has no in-built hierarchicalp package system, hence no translation</span>
<span class="c1">;; of &quot;::&quot; into a directory separator, etc.</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defpackage</span> <span class="ss">:cards.poker</span>
  <span class="p">(</span><span class="ss">:use</span> <span class="ss">:cl</span><span class="p">)</span>                            <span class="c1">; equivalent to Perl line 2</span>
  <span class="p">(</span><span class="ss">:export</span> <span class="ss">:shuffle</span> <span class="ss">:*card-deck*</span><span class="p">))</span>      <span class="c1">; line 4</span>
<span class="p">(</span><span class="nb">in-package</span> <span class="ss">:cards.poker</span><span class="p">)</span>               <span class="c1">; line 1</span>
<span class="p">(</span><span class="nb">defparameter</span> <span class="vg">*card-deck*</span> <span class="no">nil</span><span class="p">)</span>          <span class="c1">; line 5</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">shuffle</span> <span class="p">())</span>                      <span class="c1">; line 6</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN645"
>Defining a Module's Interface</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defpackage</span> <span class="ss">:your-module</span> <span class="p">(</span><span class="ss">:use</span> <span class="ss">:cl</span><span class="p">)</span>
            <span class="p">(</span><span class="ss">:export</span> <span class="o">...</span><span class="p">))</span>              <span class="c1">; one way to export</span>
<span class="p">(</span><span class="nb">in-package</span> <span class="ss">:your-module</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defparameter</span> <span class="vg">*version*</span> <span class="mf">1.00</span><span class="p">)</span> <span class="c1">; not standard CL, but one could ascribe meaning by convention</span>

<span class="p">(</span><span class="nb">export</span> <span class="o">&#39;</span><span class="p">(</span><span class="o">...</span><span class="p">))</span>                         <span class="c1">; another way to export</span>

<span class="c1">;; There is no built-in equivalent to EXPORT_OK.  EXPORT_TAGS also has</span>
<span class="c1">;; no standard CL counterpart, but something similar can easily be</span>
<span class="c1">;; implemented.  See IMPORT-TAGS, defined in the appendix.</span>
<span class="p">(</span><span class="nb">defparameter</span> <span class="vg">*export-tags*</span>
  <span class="o">&#39;</span><span class="p">(</span><span class="ss">:TAG1</span> <span class="p">(</span> <span class="o">...</span> <span class="p">)</span>
    <span class="ss">:TAG2</span> <span class="p">(</span> <span class="o">...</span> <span class="p">)))</span>

<span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="c1">;; your code goes here</span>
<span class="c1">;;;;;;;;;;;;;;;;;;;;;;;;</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defpackage</span> <span class="ss">:my-package</span> <span class="p">(</span><span class="ss">:use</span> <span class="nv">cl</span><span class="p">)</span>
            <span class="p">(</span><span class="ss">:use</span> <span class="ss">:your-module</span><span class="p">))</span> <span class="c1">; Import default symbols into my package.</span>
<span class="p">(</span><span class="nb">defpackage</span> <span class="ss">:my-package</span> <span class="p">(</span><span class="ss">:use</span> <span class="nv">cl</span><span class="p">)</span>
            <span class="p">(</span><span class="ss">:import-from</span> <span class="ss">:your-module</span> <span class="o">...</span><span class="p">))</span> <span class="c1">; Import listed symbols into my package.</span>
<span class="c1">;; Or at some point in my-package do this:</span>
<span class="p">(</span><span class="nb">in-package</span> <span class="ss">:my-package</span><span class="p">)</span>
<span class="p">(</span><span class="nb">import</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">your-module:symbol1</span> <span class="nv">your-module:symbol2</span> <span class="o">...</span><span class="p">))</span> <span class="c1">; Import listed symbols into my package.</span>
<span class="p">(</span><span class="nb">defpackage</span> <span class="ss">:my-package</span> <span class="p">(</span><span class="ss">:use</span> <span class="nv">cl</span><span class="p">)</span>
            <span class="p">(</span><span class="ss">:import-from</span> <span class="ss">:your-module</span><span class="p">))</span> <span class="c1">; Do not import any symbols</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">export</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f1</span> <span class="nv">f2</span> <span class="nv">my-list</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; No equivalent to EXPORT_OK</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">import</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">your-module:op-func</span> <span class="nv">your-module:your-table</span> <span class="nv">your-module:f1</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; From within the package you want to import into, do this</span>
<span class="c1">;; (IMPORT-TAGS defined in appendix, not standard CL).</span>
<span class="p">(</span><span class="nv">import-tags</span> <span class="ss">:your-module</span> <span class="ss">:DEFAULT</span><span class="p">)</span>
<span class="p">(</span><span class="nb">import</span> <span class="ss">&#39;your-module:your-table</span><span class="p">)</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defparameter</span> <span class="vg">*export-tags*</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="ss">:functions</span> <span class="p">(</span><span class="nv">f1</span> <span class="nv">f2</span> <span class="nv">op-func</span><span class="p">))</span>
    <span class="p">(</span><span class="ss">:variables</span> <span class="p">(</span><span class="nv">your-list</span> <span class="nv">your-table</span><span class="p">))))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nv">import-tags</span> <span class="ss">:your-module</span> <span class="ss">:functions</span><span class="p">)</span>
<span class="p">(</span><span class="nb">import</span> <span class="ss">&#39;your-module:your-table</span><span class="p">)</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN648"
>Trapping Errors in require or use</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="c1">;; In the following example, EVAL-WHEN is like the Perl example&#39;s</span>
<span class="c1">;; BEGIN.</span>
<span class="p">(</span><span class="k">eval-when</span> <span class="p">(</span><span class="ss">:compile-toplevel</span> <span class="ss">:load-toplevel</span> <span class="ss">:execute</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">multiple-value-bind</span> <span class="p">(</span><span class="nv">retval</span> <span class="nv">why-not</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">:mod</span><span class="p">))</span>    <span class="c1">; no import</span>
    <span class="p">(</span><span class="nb">when</span> <span class="nv">why-not</span>
      <span class="p">(</span><span class="nb">warn</span> <span class="s">&quot;couldn&#39;t load :mod: ~A&quot;</span> <span class="nv">why-not</span><span class="p">))))</span>

<span class="c1">;; Note that there is no &quot;use&quot; in CL, but you can REQUIRE and then</span>
<span class="c1">;; USE-PACKAGE if it was successful.</span>
<span class="p">(</span><span class="k">eval-when</span> <span class="p">(</span><span class="ss">:compile-toplevel</span> <span class="ss">:load-toplevel</span> <span class="ss">:execute</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">multiple-value-bind</span> <span class="p">(</span><span class="nv">retval</span> <span class="nv">why-not</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">:mod</span><span class="p">))</span>
    <span class="p">(</span><span class="k">if</span> <span class="nv">why-not</span>
      <span class="p">(</span><span class="nb">warn</span> <span class="s">&quot;couldn&#39;t load :mod: ~A&quot;</span> <span class="nv">why-not</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">use-package</span> <span class="ss">:mod</span><span class="p">))))</span>             <span class="c1">; imports into current package</span>
<span class="c1">;;;-----------------------------</span>

<span class="c1">;; This code is written in order to be as much like the Perl example</span>
<span class="c1">;; as possible, and likely isn&#39;t what you&#39;d use in practice.  Normally</span>
<span class="c1">;; you&#39;d just take advantage of the existing features of, for example,</span>
<span class="c1">;; ASDF.</span>
<span class="p">(</span><span class="k">eval-when</span> <span class="p">(</span><span class="ss">:compile-toplevel</span> <span class="ss">:load-toplevel</span> <span class="ss">:execute</span><span class="p">)</span>

  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">dbs</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">giant.eenie</span> <span class="nv">giant.meanie</span> <span class="nv">mouse.mynie</span> <span class="nv">moe</span><span class="p">))</span>
        <span class="nv">found</span><span class="p">)</span>

    <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">module</span> <span class="nv">dbs</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">multiple-value-bind</span> <span class="p">(</span><span class="nv">_</span> <span class="nv">why-not</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nb">require</span> <span class="nv">module</span><span class="p">))</span>
        <span class="p">(</span><span class="nb">unless</span> <span class="nv">why-not</span>
          <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">import-fn</span><span class="p">)</span>
            <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="vg">*package*</span> <span class="p">(</span><span class="nb">find-package</span> <span class="nv">module</span><span class="p">)))</span>
              <span class="c1">;; The following line assumes the module defines</span>
              <span class="c1">;; MY-IMPORT (note it can&#39;t be called IMPORT b/c that</span>
              <span class="c1">;; clashes with CL&#39;s built-in IMPORT).</span>
              <span class="p">(</span><span class="nb">setf</span> <span class="nv">import-fn</span> <span class="p">(</span><span class="nb">symbol-function</span> <span class="p">(</span><span class="nb">find-symbol</span> <span class="s">&quot;MY-IMPORT&quot;</span><span class="p">)))</span>
            <span class="p">(</span><span class="nb">funcall</span> <span class="nv">import-fn</span><span class="p">)))</span>
          <span class="p">(</span><span class="nb">setf</span> <span class="nv">found</span> <span class="no">t</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">return</span><span class="p">))))</span>

    <span class="p">(</span><span class="nb">unless</span> <span class="nv">found</span> <span class="p">(</span><span class="nb">error</span> <span class="s">&quot;None of ~{~A~^ ~} loaded&quot;</span> <span class="nv">dbs</span><span class="p">))))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN651"
>Delaying use Until Run Time</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">eval-when</span> <span class="p">(</span><span class="ss">:compile-toplevel</span> <span class="ss">:load-toplevel</span> <span class="ss">:execute</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">=</span> <span class="mi">3</span> <span class="p">(</span><span class="nb">length</span> <span class="vg">*posix-argv*</span><span class="p">))</span> <span class="c1">; Perl skips past executable</span>
               <span class="p">(</span><span class="nb">=</span> <span class="mi">2</span> <span class="p">(</span><span class="nb">length</span> <span class="p">(</span><span class="nv">perl-grep</span> <span class="vg">*posix-argv*</span> <span class="c1">; PERL-GREP defined in Appendix</span>
                              <span class="p">(</span><span class="nv">scan</span> <span class="s">&quot;^\\d+$&quot;</span> <span class="nv">it</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nb">error</span> <span class="s">&quot;usage: ~A num1 num2&quot;</span> <span class="p">(</span><span class="nb">car</span> <span class="vg">*posix-argv*</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">require</span> <span class="ss">:some.module</span><span class="p">)</span>
<span class="p">(</span><span class="nb">require</span> <span class="ss">:more.modules</span><span class="p">)</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; This would be silly since CL&#39;s numbers already are &quot;big&quot;.</span>
<span class="p">(</span><span class="nb">when</span> <span class="nv">opt-b</span> <span class="p">(</span><span class="nb">require</span> <span class="ss">:math.bigint</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; The following is just to make the examples work.</span>
<span class="p">(</span><span class="nb">defpackage</span> <span class="ss">:fcntl</span> <span class="p">(</span><span class="ss">:use</span> <span class="nv">cl</span><span class="p">))</span>
<span class="p">(</span><span class="nb">in-package</span> <span class="ss">:fcntl</span><span class="p">)</span>
<span class="p">(</span><span class="nb">defconstant</span> <span class="nv">+O-EXCL+</span> <span class="mh">#x800</span><span class="p">)</span>
<span class="p">(</span><span class="nb">defconstant</span> <span class="nv">+O-CREAT+</span> <span class="mh">#x200</span><span class="p">)</span>
<span class="p">(</span><span class="nb">defconstant</span> <span class="nv">+O-RDWR+</span> <span class="mh">#x2</span><span class="p">)</span>

<span class="p">(</span><span class="nb">export</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+O-EXCL+</span> <span class="nv">+O-CREAT+</span> <span class="nv">+O-RDWR+</span><span class="p">))</span>
<span class="p">(</span><span class="nb">provide</span> <span class="ss">&#39;fcntl</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defpackage</span> <span class="ss">:my-package</span>
  <span class="p">(</span><span class="ss">:use</span> <span class="nv">cl</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">:import-from</span> <span class="ss">:fcntl</span> <span class="nv">+O-EXCL+</span> <span class="nv">+O-CREAT+</span> <span class="nv">+O-RDWR+</span><span class="p">))</span>
<span class="p">(</span><span class="nb">in-package</span> <span class="ss">:my-package</span><span class="p">)</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">require</span> <span class="ss">:fcntl</span><span class="p">)</span>
<span class="p">(</span><span class="nb">import</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">fcntl:+O-EXCL+</span> <span class="nv">fcntl:+O-CREAT+</span> <span class="nv">fcntl:+O-RDWR+</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">in-package</span> <span class="nv">cl-user</span><span class="p">)</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">load-module</span> <span class="p">(</span><span class="nv">module</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">require</span> <span class="nv">module</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">import</span> <span class="nv">module</span><span class="p">))</span>                      <span class="c1">; WRONG</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nv">load-module</span> <span class="ss">:fcntl</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">fcntl:+O-EXCL+</span> <span class="nv">fcntl:+O-CREAT+</span> <span class="nv">fcntl:+O-RDWR+</span><span class="p">))</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">load-module</span> <span class="p">(</span><span class="nv">module</span> <span class="nv">symbols</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">require</span> <span class="nv">module</span><span class="p">)</span>
  <span class="c1">;; No need for die because REQUIRE will do it for us.</span>
  <span class="p">(</span><span class="nb">import</span> <span class="nv">symbols</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; CL doesn&#39;t have anything like Perl&#39;s autouse, as far as I can tell.</span>
<span class="c1">;; The following is a rough implementation of it.  Usage:</span>
<span class="c1">;;   (autouse &#39;my-package (xyz abc))</span>
<span class="c1">;; Where XYZ and ABC are functions defined within MY-PACKAGE.</span>
<span class="p">(</span><span class="nb">defmacro</span> <span class="nv">autouse</span> <span class="p">(</span><span class="nv">pack</span> <span class="nv">symbols</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">list*</span>
   <span class="ss">&#39;progn</span>
   <span class="p">(</span><span class="nb">loop</span>
      <span class="nv">for</span> <span class="nv">symb</span> <span class="nv">in</span> <span class="nv">symbols</span>
      <span class="nv">collect</span>
        <span class="o">`</span><span class="p">(</span><span class="nb">defun</span> <span class="o">,</span><span class="nv">symb</span> <span class="p">(</span><span class="k">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
           <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;,pack</span><span class="p">)</span>
           <span class="p">(</span><span class="nb">apply</span> <span class="p">(</span><span class="nb">find-symbol</span> <span class="o">,</span><span class="p">(</span><span class="nb">symbol-name</span> <span class="nv">symb</span><span class="p">)</span> <span class="ss">&#39;,pack</span><span class="p">)</span> <span class="nv">args</span><span class="p">)))))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN654"
>Making Variables Private to a Module</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defpackage</span> <span class="ss">:alpha</span> <span class="p">(</span><span class="ss">:use</span> <span class="ss">:cl</span><span class="p">))</span>
<span class="p">(</span><span class="nb">in-package</span> <span class="ss">:alpha</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defparameter</span> <span class="nv">aa</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">(</span><span class="nb">export</span> <span class="ss">&#39;aa</span><span class="p">)</span>
<span class="p">(</span><span class="nb">defparameter</span> <span class="nv">x</span> <span class="s">&quot;azure&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defpackage</span> <span class="ss">:beta</span> <span class="p">(</span><span class="ss">:use</span> <span class="ss">:cl</span><span class="p">))</span>
<span class="p">(</span><span class="nb">in-package</span> <span class="ss">:beta</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defparameter</span> <span class="nv">bb</span> <span class="mi">20</span><span class="p">)</span>
<span class="p">(</span><span class="nb">export</span> <span class="ss">&#39;bb</span><span class="p">)</span>
<span class="p">(</span><span class="nb">defparameter</span> <span class="nv">x</span> <span class="s">&quot;blue&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nb">in-package</span> <span class="ss">:cl-user</span><span class="p">)</span>         <span class="c1">; closest thing to Perl&#39;s &#39;main&#39; package</span>
<span class="c1">;; Unlike the Perl example, without the explict EXPORT and IMPORT the</span>
<span class="c1">;; symbols won&#39;t be visible in the CL-USER package.</span>
<span class="p">(</span><span class="nb">import</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">alpha:aa</span> <span class="nv">beta:bb</span><span class="p">))</span>
<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A, ~A, ~A, ~A, ~A~%&quot;</span> <span class="nv">aa</span> <span class="nv">bb</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">boundp</span> <span class="ss">&#39;x</span><span class="p">)</span> <span class="nv">x</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="nv">alpha::x</span> <span class="nv">beta::x</span><span class="p">)</span>
<span class="c1">;; 10, 20, , azure, blue</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; flipper.lisp</span>
<span class="p">(</span><span class="nb">defpackage</span> <span class="ss">:flipper</span>
  <span class="p">(</span><span class="ss">:use</span> <span class="nv">cl</span> <span class="nv">cl-ppcre</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">:export</span> <span class="nv">flip-words</span> <span class="nv">flip-boundary</span><span class="p">))</span>
<span class="p">(</span><span class="nb">in-package</span> <span class="ss">:flipper</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defvar</span> <span class="vg">*separatrix*</span> <span class="sc">#\Space</span><span class="p">)</span> <span class="c1">; default to blank; must precede functions</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">flip-boundary</span> <span class="p">(</span><span class="k">&amp;optional</span> <span class="nv">separatrix</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">prog1</span> <span class="vg">*separatrix*</span>
    <span class="p">(</span><span class="nb">when</span> <span class="nv">separatrix</span>
      <span class="p">(</span><span class="nb">setf</span> <span class="vg">*separatrix*</span> <span class="nv">separatrix</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">flip-words</span> <span class="p">(</span><span class="nv">line</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">words</span> <span class="p">(</span><span class="nv">split</span> <span class="vg">*separatrix*</span> <span class="nv">line</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;~~{~~A~~^~A~~}&quot;</span> <span class="vg">*separatrix*</span><span class="p">)</span> <span class="p">(</span><span class="nb">reverse</span> <span class="nv">words</span><span class="p">))))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN657"
>Determining the Caller's Package</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="c1">;; #. forces *PACKAGE* to be evaluated at compile-time, so that it</span>
<span class="c1">;; won&#39;t pick up the dynamic value of *PACKAGE* (i.e., the package of</span>
<span class="c1">;; the calling function, which may be different.)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">this-pack</span> <span class="o">#.</span><span class="vg">*package*</span><span class="p">)</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; As long as the following does not appear at the &quot;top level&quot; of the</span>
<span class="c1">;; file, it will contain the current package (i.e., the &quot;outermost&quot;</span>
<span class="c1">;; calling function&#39;s, assuming it hasn&#39;t been rebound explicitly.)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">that-pack</span> <span class="vg">*package*</span><span class="p">)</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;I am in package *package*~%&quot;</span><span class="p">)</span>        <span class="c1">; WRONG!</span>
<span class="c1">;; I am in package *package*</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defpackage</span> <span class="ss">:alpha</span> <span class="p">(</span><span class="ss">:use</span> <span class="nv">cl</span> <span class="nv">beta</span><span class="p">))</span>
<span class="p">(</span><span class="nb">in-package</span> <span class="ss">:alpha</span><span class="p">)</span>

<span class="c1">;; As (I think) the Perl example does, this presupposes that TEMP is</span>
<span class="c1">;; set to an already-open stream (in BETA), e.g.:</span>
<span class="c1">;;  (setf temp (open &quot;/usr/share/dict/words&quot;))</span>
<span class="p">(</span><span class="nv">runit</span> <span class="s">&quot;(setf line (read-line temp))&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defpackage</span> <span class="ss">:beta</span>
  <span class="p">(</span><span class="ss">:use</span> <span class="nv">cl</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">:export</span> <span class="nv">runit</span><span class="p">))</span>
<span class="p">(</span><span class="nb">in-package</span> <span class="ss">:beta</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">runit</span> <span class="p">(</span><span class="nv">codestr</span><span class="p">)</span>
  <span class="c1">;; The following is not a good idea, but is intended to make this</span>
  <span class="c1">;; example work the way the Perl one does, by causing the EVAL to</span>
  <span class="c1">;; occur in the context of this package (BETA) rather than the</span>
  <span class="c1">;; caller&#39;s (ALPHA&#39;s).</span>
  <span class="p">(</span><span class="nb">in-package</span> <span class="o">#.</span><span class="p">(</span><span class="nb">package-name</span> <span class="vg">*package*</span><span class="p">))</span>
  <span class="c1">;; EVAL will throw an error if there&#39;s any problems, no need to do</span>
  <span class="c1">;; it explicitly like the Perl does.</span>
  <span class="p">(</span><span class="nb">eval</span> <span class="p">(</span><span class="nb">read-from-string</span> <span class="nv">codestr</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defpackage</span> <span class="ss">:beta</span>
  <span class="p">(</span><span class="ss">:use</span> <span class="nv">cl</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">:export</span> <span class="nv">runit</span><span class="p">))</span>
<span class="p">(</span><span class="nb">in-package</span> <span class="ss">:beta</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">runit</span> <span class="p">(</span><span class="nv">codestr</span><span class="p">)</span>
  <span class="c1">;; CL is essentially the reverse of Perl in this regard, the default</span>
  <span class="c1">;; behavior already works the right way without the need to use</span>
  <span class="c1">;; something like Perl&#39;s &#39;caller&#39;.</span>
  <span class="p">(</span><span class="nb">eval</span> <span class="p">(</span><span class="nb">read-from-string</span> <span class="nv">codestr</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defpackage</span> <span class="ss">:alpha</span> <span class="p">(</span><span class="ss">:use</span> <span class="nv">cl</span> <span class="nv">beta</span><span class="p">))</span>
<span class="p">(</span><span class="nb">in-package</span> <span class="ss">:alpha</span><span class="p">)</span>

<span class="p">(</span><span class="nv">runit</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">setf</span> <span class="nv">line</span> <span class="p">(</span><span class="nb">read-line</span> <span class="nv">temp</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">defpackage</span> <span class="ss">:beta</span>
  <span class="p">(</span><span class="ss">:use</span> <span class="nv">cl</span><span class="p">)</span>
  <span class="p">(</span><span class="ss">:export</span> <span class="nv">runit</span><span class="p">))</span>
<span class="p">(</span><span class="nb">in-package</span> <span class="ss">:beta</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">runit</span> <span class="p">(</span><span class="nv">coderef</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">funcall</span> <span class="nv">coderef</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">in-package</span> <span class="nv">cl-user</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defparameter</span> <span class="vg">*fh*</span> <span class="p">(</span><span class="nb">open</span> <span class="s">&quot;/etc/services&quot;</span><span class="p">))</span> <span class="c1">; don&#39;t have /etc/termcap on my machine</span>
<span class="p">(</span><span class="nb">multiple-value-setq</span> <span class="p">(</span><span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nb">values-list</span> <span class="p">(</span><span class="nv">nreadline</span> <span class="mi">3</span> <span class="s">&quot;*fh*&quot;</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">nreadline</span> <span class="p">(</span><span class="nb">count</span> <span class="nv">handle</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">plusp</span> <span class="nb">count</span><span class="p">)</span> <span class="p">(</span><span class="nb">error</span> <span class="s">&quot;COUNT must be &gt; 0&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">handle</span> <span class="p">(</span><span class="nb">symbol-value</span> <span class="p">(</span><span class="nb">find-symbol</span> <span class="p">(</span><span class="nb">string-upcase</span> <span class="nv">handle</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">open-stream-p</span> <span class="nv">handle</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">error</span> <span class="s">&quot;need open filehandle&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">loop</span>
       <span class="nv">repeat</span> <span class="nb">count</span>
       <span class="nv">collect</span> <span class="p">(</span><span class="nb">read-line</span> <span class="nv">handle</span><span class="p">))))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN660"
>Automating Module Clean-Up</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN663"
>Keeping Your Own Module Directory</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="c1">;; In section 12.7 we assume the use of ASDF, which is the de facto</span>
<span class="c1">;; standard package mechanism.</span>
<span class="p">(</span><span class="nb">loop</span>
   <span class="nv">for</span> <span class="nv">path</span> <span class="nv">in</span> <span class="nv">asdf:*central-registry*</span>
   <span class="nv">for</span> <span class="nv">i</span> <span class="nv">from</span> <span class="mi">0</span>
   <span class="nb">do</span> <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~D ~A~%&quot;</span> <span class="nv">i</span> <span class="nv">path</span><span class="p">))</span>
<span class="c1">;;0 /Users/mongo/moogle-code/cl-fnord/</span>
<span class="c1">;;1 /Users/mongo/common-lisp.net/cl-zztop/trunk/</span>
<span class="c1">;;2 (MERGE-PATHNAMES .sbcl/systems/ (USER-HOMEDIR-PATHNAME))</span>
<span class="c1">;;3 (LET ((HOME (POSIX-GETENV SBCL_HOME)))</span>
<span class="c1">;;    (WHEN HOME (MERGE-PATHNAMES site-systems/ (TRUENAME HOME))))</span>
<span class="c1">;;4 *DEFAULT-PATHNAME-DEFAULTS*</span>

<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">pushnew</span> <span class="s">&quot;/projects/spectre/lib&quot;</span> <span class="nv">asdf:*central-registry*</span><span class="p">)</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">require</span> <span class="ss">:find-bin</span><span class="p">)</span>
<span class="p">(</span><span class="nb">pushnew</span> <span class="nv">find-bin::*bin*</span> <span class="nv">asdf:*central-registry*</span><span class="p">)</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">shadowing-import</span> <span class="nv">find-bin::*bin*</span><span class="p">)</span>
<span class="p">(</span><span class="nb">pushnew</span> <span class="p">(</span><span class="nb">concatenate</span> <span class="ss">&#39;string</span> <span class="vg">*bin*</span> <span class="s">&quot;/../lib&quot;</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN666"
>Preparing a Module for Distribution</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN669"
>Speeding Module Loading with SelfLoader</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN672"
>Speeding Up Module Loading with Autoloader</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN675"
>Overriding Built-In Functions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN678"
>Reporting Errors and Warnings Like Built-Ins</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN681"
>Referring to Packages Indirectly</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN684"
>Using h2ph to Translate C #include Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN687"
>Using h2xs to Make a Module with C Code</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN690"
>Documenting Your Module with Pod</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN693"
>Building and Installing a CPAN Module</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN696"
>Example: Module Template</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN699"
>Program: Finding Versions and Descriptions of Installed Modules</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="referencesandrecords.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="classesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>References and Records</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Classes, Objects, and Ties</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>