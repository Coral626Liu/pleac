<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Numbers</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Common Lisp"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Strings"
HREF="strings.html"><LINK
REL="NEXT"
TITLE="Dates and Times"
HREF="datesandtimes.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Common Lisp</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="strings.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="datesandtimes.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="NUMBERS"
>2. Numbers</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN73"
>Checking Whether a String Is a Valid Number</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">every</span> <span class="nf">#&#39;</span><span class="nb">digit-char-p</span> <span class="nb">string</span><span class="p">)</span>
    <span class="p">(</span><span class="k">progn</span>
      <span class="c1">;; is a number</span>
      <span class="p">)</span>
    <span class="p">(</span><span class="k">progn</span>
      <span class="c1">;; is not</span>
      <span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;;; Strings and numbers are separate data types in CL. These tests</span>
<span class="c1">;;; check whether a string represents a number</span>
<span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">every</span> <span class="nf">#&#39;</span><span class="nb">digit-char-p</span> <span class="nb">string</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">format</span> <span class="vg">*error-output*</span> <span class="s">&quot;string has nondigits&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">scan</span> <span class="s">&quot;^\\d+$&quot;</span> <span class="nb">string</span><span class="p">)</span> <span class="c1">; rejects -3</span>
  <span class="p">(</span><span class="nb">format</span> <span class="vg">*error-output*</span> <span class="s">&quot;not a natural number&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">scan</span> <span class="s">&quot;^-?\\d+$&quot;</span> <span class="nb">string</span><span class="p">)</span> <span class="c1">; rejects +3</span>
  <span class="p">(</span><span class="nb">format</span> <span class="vg">*error-output*</span> <span class="s">&quot;not an integer&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">scan</span> <span class="s">&quot;^[+-]?\\d+$&quot;</span> <span class="nb">string</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">format</span> <span class="vg">*error-output*</span> <span class="s">&quot;not an integer&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">scan</span> <span class="s">&quot;^-?(?:\\d+(?:\\.\\d*)?|\\.\\d+)$&quot;</span> <span class="nb">string</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">format</span> <span class="vg">*error-output*</span> <span class="s">&quot;not an integer&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">scan</span> <span class="s">&quot;^([+-]?)(?=\\d|\\.\\d)\\d*(\\.\\d*)?([Ee]([+-]?\\d+))?$&quot;</span>
                       <span class="nb">string</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">format</span> <span class="vg">*error-output*</span> <span class="s">&quot;not a C float&quot;</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">getnum</span> <span class="p">(</span><span class="nb">string</span><span class="p">)</span>
  <span class="s">&quot;This function is not safe to call on untrusted input.&quot;</span>
  <span class="p">(</span><span class="nb">with-input-from-string</span>
      <span class="p">(</span><span class="nv">is</span> <span class="p">(</span><span class="nv">regex-replace</span> <span class="err">#</span><span class="nv">?</span><span class="s">&quot;\s+$&quot;</span>
                                  <span class="p">(</span><span class="nv">regex-replace</span> <span class="err">#</span><span class="nv">?</span><span class="s">&quot;^\s+&quot;</span> <span class="nb">string</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">num</span> <span class="p">(</span><span class="nb">read</span> <span class="nv">is</span> <span class="no">nil</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">and</span>
       <span class="c1">;; Make sure there&#39;s no junk following the number</span>
       <span class="p">(</span><span class="nb">eql</span> <span class="p">(</span><span class="nb">read-char</span> <span class="nv">is</span> <span class="no">nil</span> <span class="ss">:eof</span> <span class="no">nil</span><span class="p">)</span> <span class="ss">:eof</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">numberp</span> <span class="nv">num</span><span class="p">)</span>
       <span class="nv">num</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">is-numeric</span> <span class="p">(</span><span class="nb">string</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">null</span> <span class="p">(</span><span class="nv">getnum</span> <span class="nb">string</span><span class="p">))))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN76"
>Comparing Floating-Point Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">equal-to-accuracy</span> <span class="p">(</span><span class="nv">number1</span> <span class="nv">number2</span> <span class="nv">dp</span><span class="p">)</span>
  <span class="s">&quot;Return non-nil if NUMBER1 and NUMBER2 are equal to DP number of</span>
<span class="s">decimal places.&quot;</span>
  <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">difference</span> <span class="p">(</span><span class="nb">abs</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">number1</span> <span class="nv">number2</span><span class="p">)))</span>
         <span class="p">(</span><span class="nv">delta</span> <span class="p">(</span><span class="nb">expt</span> <span class="mi">10</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">dp</span><span class="p">))))</span>
    <span class="p">(</span><span class="nb">&lt;</span> <span class="nv">difference</span> <span class="nv">delta</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">wage</span> <span class="mi">536</span><span class="p">)</span>                       <span class="c1">; $5.36/hour</span>
       <span class="p">(</span><span class="nv">week</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">40</span> <span class="nv">wage</span><span class="p">)))</span>              <span class="c1">; $214.40</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;One week&#39;s wage is: $~,2F~%&quot;</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">week</span> <span class="mi">100</span><span class="p">)))</span>
<span class="c1">;;One week&#39;s wage is: $214.40</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN79"
>Rounding Floating-Point Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">rounded</span> <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;~FORMATF&quot;</span> <span class="nv">unrounded</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">a</span> <span class="mf">0.255</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">b</span> <span class="p">(</span><span class="nb">/</span> <span class="p">(</span><span class="nb">fround</span> <span class="nv">a</span> <span class="mf">0.01</span><span class="p">)</span> <span class="mi">100</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;Unrounded: ~F~%Rounded: ~,2F~%&quot;</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))</span>
<span class="c1">;;Unrounded: 0.255</span>
<span class="c1">;;Rounded: 0.26</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="k">progn</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~&amp;number~Tint~Tfloor~Tceil~%&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">as</span> <span class="o">&#39;</span><span class="p">(</span><span class="mf">3.3</span> <span class="mf">3.5</span> <span class="mf">3.7</span> <span class="mf">-3.3</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">a</span> <span class="nv">as</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~@{~4,1F~^~T~}~%&quot;</span>
              <span class="nv">a</span>
              <span class="p">(</span><span class="nb">ftruncate</span> <span class="nv">a</span><span class="p">)</span>
              <span class="p">(</span><span class="nb">ffloor</span> <span class="nv">a</span><span class="p">)</span>
              <span class="p">(</span><span class="nb">fceiling</span> <span class="nv">a</span><span class="p">)))))</span>
<span class="c1">;;number int floor ceil</span>
<span class="c1">;; 3.3  3.0  3.0  4.0</span>
<span class="c1">;; 3.5  3.0  3.0  4.0</span>
<span class="c1">;; 3.7  3.0  3.0  4.0</span>
<span class="c1">;;-3.3 -3.0 -4.0 -3.0</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN82"
>Converting Between Binary and Decimal</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">dec2bin</span> <span class="p">(</span><span class="nv">dec</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;~2R&quot;</span> <span class="nv">dec</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">bin2dec</span> <span class="p">(</span><span class="nv">bin</span><span class="p">)</span>
  <span class="s">&quot;BIN is a string containing only #\1 and #\0 characters.  Returns</span>
<span class="s">its integer equivalent.&quot;</span>
  <span class="p">(</span><span class="nb">read</span> <span class="p">(</span><span class="nb">make-string-input-stream</span> <span class="p">(</span><span class="nb">concatenate</span> <span class="ss">&#39;string</span> <span class="s">&quot;#b&quot;</span> <span class="nv">bin</span><span class="p">))</span>
        <span class="no">t</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">num</span> <span class="p">(</span><span class="nv">bin2dec</span> <span class="s">&quot;0110110&quot;</span><span class="p">))</span>          <span class="c1">; $num is 54</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">binstr</span> <span class="p">(</span><span class="nv">dec2bin</span> <span class="mi">54</span><span class="p">))</span>              <span class="c1">; binstr is &quot;110110&quot;</span>
<span class="c1">;;;-----------------------------</span>

<span class="c1">;;; @PLEAC@@_2.5</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">seq</span> <span class="p">(</span><span class="nv">start</span> <span class="nv">end</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">i</span> <span class="nv">from</span> <span class="nv">start</span> <span class="nv">to</span> <span class="nv">end</span> <span class="nv">collect</span> <span class="nv">i</span><span class="p">))</span>

<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;Infancy is: ~{~A~^ ~}~%&quot;</span> <span class="p">(</span><span class="nv">seq</span> <span class="mi">0</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;Toddling is: ~{~A~^ ~}~%&quot;</span> <span class="p">(</span><span class="nv">seq</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))</span>
<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;Childhood is: ~{~A~^ ~}~%&quot;</span> <span class="p">(</span><span class="nv">seq</span> <span class="mi">5</span> <span class="mi">12</span><span class="p">))</span>
<span class="c1">; =&gt; Infancy is: 0 1 2</span>
<span class="c1">;    Toddling is: 3 4</span>
<span class="c1">;    Childhood is: 5 6 7 8 9 10 11 12</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN85"
>Operating on a Series of Integers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN88"
>Working with Roman Numerals</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;; CL has a built in FORMAT directive (used below) to print out</span>
<span class="c1">;;; numbers as roman numerals, but doesn&#39;t have a built-in mechanism</span>
<span class="c1">;;; to convert back.  Here are some rough CL equivalents of Perl&#39;s</span>
<span class="c1">;;; Roman package.</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">romanchar-&gt;num</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">case</span> <span class="p">(</span><span class="nb">char-downcase</span> <span class="nv">x</span><span class="p">)</span>
    <span class="p">(</span><span class="sc">#\m</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="p">(</span><span class="sc">#\d</span> <span class="mi">500</span><span class="p">)</span>
    <span class="p">(</span><span class="sc">#\c</span> <span class="mi">100</span><span class="p">)</span>
    <span class="p">(</span><span class="sc">#\l</span> <span class="mi">50</span><span class="p">)</span>
    <span class="p">(</span><span class="sc">#\x</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p">(</span><span class="sc">#\v</span> <span class="mi">5</span><span class="p">)</span>
    <span class="p">(</span><span class="sc">#\i</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">(</span><span class="no">t</span> <span class="mi">0</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">isroman</span> <span class="p">(</span><span class="nb">string</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">every</span> <span class="nf">#&#39;</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">c</span><span class="p">)</span>
             <span class="p">(</span><span class="nb">plusp</span> <span class="p">(</span><span class="nv">romanchar-&gt;num</span> <span class="nv">c</span><span class="p">)))</span>
         <span class="nb">string</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">arabic</span> <span class="p">(</span><span class="nb">string</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">digits</span> <span class="p">(</span><span class="nb">map</span> <span class="ss">&#39;list</span> <span class="nf">#&#39;</span><span class="nv">romanchar-&gt;num</span> <span class="nb">string</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">reduce</span> <span class="nf">#&#39;</span><span class="nb">+</span> <span class="p">(</span><span class="nb">mapcar</span> <span class="nf">#&#39;</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">digit</span> <span class="nv">next-digit</span><span class="p">)</span>
                            <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&lt;</span> <span class="nv">digit</span> <span class="nv">next-digit</span><span class="p">)</span>
                                <span class="p">(</span><span class="nb">-</span> <span class="nv">digit</span><span class="p">)</span>
                                <span class="nv">digit</span><span class="p">))</span>
                        <span class="nv">digits</span>
                        <span class="p">(</span><span class="nb">append</span> <span class="p">(</span><span class="nb">rest</span> <span class="nv">digits</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">0</span><span class="p">))))))</span>

<span class="p">(</span><span class="nb">setf</span> <span class="nv">roman</span> <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;~@R&quot;</span> <span class="nv">arabic</span><span class="p">))</span>  <span class="c1">; convert to roman numerals</span>
<span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">isroman</span> <span class="nv">roman</span><span class="p">)</span> <span class="p">(</span><span class="nb">setf</span> <span class="nv">arabic</span> <span class="p">(</span><span class="nv">arabic</span> <span class="nv">roman</span><span class="p">)))</span> <span class="c1">; convert from roman numerals</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">roman-fifteen</span> <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;~@R&quot;</span> <span class="mi">15</span><span class="p">))</span>
<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;Roman for fifteen is ~A~%&quot;</span> <span class="nv">roman-fifteen</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">arabic-fifteen</span> <span class="p">(</span><span class="nv">arabic</span> <span class="nv">roman-fifteen</span><span class="p">))</span>
<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;Converted back, ~A is ~A~%&quot;</span> <span class="nv">roman-fifteen</span> <span class="nv">arabic-fifteen</span><span class="p">)</span>
<span class="c1">;;Roman for fifteen is XV</span>
<span class="c1">;;Converted back, XV is 15</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN91"
>Generating Random Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">random</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">random</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">y</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">1</span><span class="p">))</span> <span class="nv">x</span><span class="p">)</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">random</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">random</span> <span class="mi">51</span><span class="p">)</span> <span class="mi">25</span><span class="p">))</span>
<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A~%&quot;</span> <span class="nb">random</span><span class="p">)</span>
<span class="c1">;; If you wanted to use floats...</span>
<span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">random</span> <span class="mf">51.0</span><span class="p">)</span> <span class="mf">25.0</span><span class="p">)</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">elt</span> <span class="p">(</span><span class="nb">aref</span> <span class="nc">array</span> <span class="p">(</span><span class="nb">random</span> <span class="p">(</span><span class="nb">length</span> <span class="nc">array</span><span class="p">))))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">chars</span> <span class="s">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz012345789!@$%^&amp;*&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">password</span> <span class="p">(</span><span class="nb">coerce</span> <span class="p">(</span><span class="nb">loop</span> <span class="nv">repeat</span> <span class="mi">8</span> <span class="nv">collect</span> <span class="p">(</span><span class="nb">aref</span> <span class="nv">chars</span> <span class="p">(</span><span class="nb">random</span> <span class="p">(</span><span class="nb">length</span> <span class="nv">chars</span><span class="p">))))</span> <span class="ss">&#39;string</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN94"
>Generating Different Random Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="c1">;; CL intentionally does not have an equivalent of Perl&#39;s srand(); you</span>
<span class="c1">;; can call MAKE-RANDOM-STATE but its inner workings are not exposed.</span>
<span class="p">(</span><span class="nb">setf</span> <span class="vg">*random-state*</span> <span class="p">(</span><span class="nb">make-random-state</span> <span class="no">t</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN97"
>Making Numbers Even More Random</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="c1">;; In CL, RANDOM is supposed to return a truly random,</span>
<span class="c1">;; uniformly-distributed value.</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nb">random</span> <span class="p">(</span><span class="nb">random</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN100"
>Generating Biased Random Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="c1">;; Note: (random 1.0) is the same as calling Perl&#39;s rand() with no</span>
<span class="c1">;; arguments.</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">gaussian-rand</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">do*</span> <span class="p">((</span><span class="nv">u1</span> <span class="p">(</span><span class="nb">1-</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">2</span> <span class="p">(</span><span class="nb">random</span> <span class="mf">1.0</span><span class="p">)))</span>
            <span class="p">(</span><span class="nb">1-</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">2</span> <span class="p">(</span><span class="nb">random</span> <span class="mf">1.0</span><span class="p">))))</span>
        <span class="p">(</span><span class="nv">u2</span> <span class="p">(</span><span class="nb">1-</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">2</span> <span class="p">(</span><span class="nb">random</span> <span class="mf">1.0</span><span class="p">)))</span>
            <span class="p">(</span><span class="nb">1-</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">2</span> <span class="p">(</span><span class="nb">random</span> <span class="mf">1.0</span><span class="p">))))</span>
        <span class="p">(</span><span class="nv">w</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">u1</span> <span class="nv">u1</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">u2</span> <span class="nv">u2</span><span class="p">))</span>
           <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">u1</span> <span class="nv">u1</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">u2</span> <span class="nv">u2</span><span class="p">))))</span>
       <span class="p">((</span><span class="nb">&lt;</span> <span class="nv">w</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">w2</span> <span class="p">(</span><span class="nb">sqrt</span> <span class="p">(</span><span class="nb">/</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">-2</span> <span class="p">(</span><span class="nb">log</span> <span class="nv">w</span><span class="p">))</span> <span class="nv">w</span><span class="p">)))</span>
               <span class="p">(</span><span class="nv">g2</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">u1</span> <span class="nv">w2</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">g1</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">u2</span> <span class="nv">w2</span><span class="p">)))</span>
          <span class="c1">;; No need for wantarray in CL because functions can return</span>
          <span class="c1">;; multiple values.</span>
          <span class="p">(</span><span class="nb">values</span> <span class="nv">g1</span> <span class="nv">g2</span><span class="p">)))))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">weight-to-dist</span> <span class="p">(</span><span class="nv">weights</span><span class="p">)</span>
  <span class="s">&quot;Takes a hash mapping key to weight and returns a hash mapping key</span>
<span class="s">to probability.  WEIGHTS is an alist.&quot;</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">dist</span> <span class="p">(</span><span class="nb">make-hash-table</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">total</span> <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="p">(</span><span class="nv">key</span> <span class="o">.</span> <span class="nv">ignored-value</span><span class="p">)</span> <span class="nv">in</span> <span class="nv">weights</span> <span class="nv">sum</span> <span class="nv">key</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="p">(</span><span class="nv">key</span> <span class="o">.</span> <span class="nv">weight</span><span class="p">)</span> <span class="nv">in</span> <span class="nv">weights</span>
         <span class="nb">do</span> <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nb">gethash</span> <span class="nv">key</span> <span class="nv">dist</span><span class="p">)</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">weight</span> <span class="nv">total</span><span class="p">)))</span>
    <span class="nv">dist</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">weighted-rand</span> <span class="p">(</span><span class="nv">dist</span><span class="p">)</span>
  <span class="s">&quot;Takes a hash mapping key to probability, and returns the</span>
<span class="s">corresponding element.&quot;</span>
  <span class="p">(</span><span class="nb">loop</span>
     <span class="nv">for</span> <span class="nv">rand</span> <span class="nb">=</span> <span class="p">(</span><span class="nb">random</span> <span class="mf">1.0</span><span class="p">)</span>
     <span class="nb">do</span>
     <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">key</span> <span class="nv">being</span> <span class="k">the</span> <span class="nv">hash-keys</span> <span class="nv">of</span> <span class="nv">dist</span> <span class="nv">using</span> <span class="p">(</span><span class="nv">hash-value</span> <span class="nv">weight</span><span class="p">)</span>
        <span class="nb">do</span>
        <span class="p">(</span><span class="nb">decf</span> <span class="nv">rand</span> <span class="nv">weight</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">minusp</span> <span class="nv">rand</span><span class="p">)</span>
          <span class="p">(</span><span class="k">return-from</span> <span class="nv">weighted-rand</span> <span class="nv">key</span><span class="p">)))))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; gaussian_rand as above</span>
<span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">mean</span> <span class="mi">25</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">sdev</span> <span class="mi">2</span><span class="p">)</span>
       <span class="p">(</span><span class="nv">salary</span> <span class="p">(</span><span class="nb">+</span> <span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nv">gaussian-rand</span><span class="p">)</span> <span class="nv">sdev</span><span class="p">)</span> <span class="nv">mean</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;You have been hired at $~,2F~%&quot;</span> <span class="nv">salary</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN103"
>Doing Trigonometry in Degrees, not Radians</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">deg2rad</span> <span class="p">(</span><span class="nv">degrees</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">degrees</span> <span class="mi">180</span><span class="p">)</span> <span class="nv">pi</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">rad2deg</span> <span class="p">(</span><span class="nv">radians</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">radians</span> <span class="nv">pi</span><span class="p">)</span> <span class="mi">180</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">radians</span> <span class="p">(</span><span class="nv">deg2rad</span> <span class="nv">degrees</span><span class="p">))</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">degrees</span> <span class="p">(</span><span class="nv">rad2deg</span> <span class="nv">radians</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; deg2rad and rad2deg defined either as above</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">degree-sine</span> <span class="p">(</span><span class="nv">degrees</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">radians</span> <span class="p">(</span><span class="nv">deg2rad</span> <span class="nv">degrees</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">sin</span> <span class="nv">radians</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN106"
>Calculating More Trigonometric Functions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="c1">;; tangent is built in to CL</span>
<span class="p">(</span><span class="nb">tan</span> <span class="nv">theta</span><span class="p">)</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">y</span> <span class="p">(</span><span class="nb">acos</span> <span class="mf">3.7</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">y</span> <span class="p">(</span><span class="nb">tan</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">pi</span> <span class="mi">2</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN109"
>Taking Logarithms</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">log-e</span> <span class="p">(</span><span class="nb">log</span> <span class="nv">value</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">log-10</span> <span class="p">(</span><span class="nb">log</span> <span class="nv">value</span> <span class="mi">10</span><span class="p">))</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">log-base-whatever</span> <span class="p">(</span><span class="nb">log</span> <span class="nv">value</span> <span class="nv">base</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; In CL, don&#39;t need custom log_base function as LOG already does it</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">answer</span> <span class="p">(</span><span class="nb">log</span> <span class="mi">10000</span> <span class="mi">10</span><span class="p">))</span>
<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;log10(10,000) = ~D~%&quot;</span> <span class="nv">answer</span><span class="p">)</span>
<span class="c1">;; log10(10,000) = 4.0</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;log2(1024) = ~A~%&quot;</span> <span class="p">(</span><span class="nb">log</span> <span class="mi">1024</span> <span class="mi">2</span><span class="p">))</span>
<span class="c1">;; log2(1024) = 10.0</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN112"
>Multiplying Matrices</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">mmult</span> <span class="p">(</span><span class="nv">m1</span> <span class="nv">m2</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">check-type</span> <span class="nv">m1</span> <span class="p">(</span><span class="nc">array</span> <span class="nb">*</span> <span class="p">(</span><span class="nb">*</span> <span class="nb">*</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">check-type</span> <span class="nv">m2</span> <span class="p">(</span><span class="nc">array</span> <span class="nb">*</span> <span class="p">(</span><span class="nb">*</span> <span class="nb">*</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">let*</span> <span class="p">((</span><span class="nv">m1-rows</span> <span class="p">(</span><span class="nb">array-dimension</span> <span class="nv">m1</span> <span class="mi">0</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">m1-columns</span> <span class="p">(</span><span class="nb">array-dimension</span> <span class="nv">m1</span> <span class="mi">1</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">m2-rows</span> <span class="p">(</span><span class="nb">array-dimension</span> <span class="nv">m2</span> <span class="mi">0</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">m2-columns</span> <span class="p">(</span><span class="nb">array-dimension</span> <span class="nv">m2</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">=</span> <span class="nv">m1-columns</span> <span class="nv">m2-rows</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">error</span> <span class="ss">&#39;simple-type-error</span>
             <span class="ss">:format-control</span> <span class="s">&quot;IndexError: matrices don&#39;t match: ~A != ~A&quot;</span>
             <span class="ss">:format-args</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">m1-columns</span> <span class="nv">m2-rows</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">result</span> <span class="p">(</span><span class="nb">make-array</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">m1-rows</span> <span class="nv">m2-columns</span><span class="p">))))</span>
      <span class="p">(</span><span class="nb">dotimes</span> <span class="p">(</span><span class="nv">i</span> <span class="nv">m1-rows</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">dotimes</span> <span class="p">(</span><span class="nv">j</span> <span class="nv">m2-columns</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nb">aref</span> <span class="nv">result</span> <span class="nv">i</span> <span class="nv">j</span><span class="p">)</span>
                <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">k</span> <span class="nv">from</span> <span class="mi">0</span> <span class="nv">below</span> <span class="nv">m1-columns</span>
                      <span class="nv">summing</span> <span class="p">(</span><span class="nb">*</span> <span class="p">(</span><span class="nb">aref</span> <span class="nv">m1</span> <span class="nv">i</span> <span class="nv">k</span><span class="p">)</span> <span class="p">(</span><span class="nb">aref</span> <span class="nv">m2</span> <span class="nv">k</span> <span class="nv">j</span><span class="p">))))))</span>
      <span class="nv">result</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">range</span> <span class="p">(</span><span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">i</span> <span class="nv">from</span> <span class="mi">0</span> <span class="nv">below</span> <span class="nv">n</span> <span class="nv">collect</span> <span class="nv">i</span><span class="p">))</span>

<span class="c1">;; This isn&#39;t really necessary in CL, but is here to match the Perl</span>
<span class="c1">;; function.</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">veclen</span> <span class="p">(</span><span class="nb">vector</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">check-type</span> <span class="nb">vector</span> <span class="kt">simple-vector</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">array-dimension</span> <span class="nb">vector</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1">;; This isn&#39;t really necessary in CL, but is here to match the Perl</span>
<span class="c1">;; function.</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">matdim</span> <span class="p">(</span><span class="nv">matrix</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">values</span> <span class="p">(</span><span class="nb">array-dimension</span> <span class="nv">matrix</span> <span class="mi">0</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">array-dimension</span> <span class="nv">matrix</span> <span class="mi">1</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; Can&#39;t find an obvious equivalent to PDL (yet)</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">x</span> <span class="l-Other">#2a</span><span class="p">((</span><span class="mi">3</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>
            <span class="p">(</span><span class="mi">5</span> <span class="mi">9</span> <span class="mi">8</span><span class="p">))</span>
      <span class="nv">y</span> <span class="l-Other">#2a</span><span class="p">((</span><span class="mi">4</span> <span class="mi">7</span><span class="p">)</span>
            <span class="p">(</span><span class="mi">9</span> <span class="mi">3</span><span class="p">)</span>
            <span class="p">(</span><span class="mi">8</span> <span class="mi">1</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">setf</span> <span class="nv">z</span> <span class="p">(</span><span class="nv">mmult</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN115"
>Using Complex Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="c1">;; Complex numbers are built in to CL so there is no need to compute</span>
<span class="c1">;; their product by hand.</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; c = a * b using built-in CL functionality</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">c</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="c1">;; Again, no need to do complex number stuff by hand.</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">a</span> <span class="m">#c</span><span class="p">(</span><span class="mi">3</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">b</span> <span class="m">#c</span><span class="p">(</span><span class="mi">2</span> <span class="mi">-2</span><span class="p">))</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">c</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))</span>
<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;c = ~D+~Di~%&quot;</span> <span class="p">(</span><span class="nb">realpart</span> <span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nb">imagpart</span> <span class="nv">c</span><span class="p">))</span>
<span class="c1">;; c = 16+4i</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">c</span> <span class="p">(</span><span class="nb">*</span> <span class="m">#c</span><span class="p">(</span><span class="mi">3</span> <span class="mi">5</span><span class="p">)</span> <span class="m">#c</span><span class="p">(</span><span class="mi">2</span> <span class="mi">-2</span><span class="p">)))</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">d</span> <span class="m">#c</span><span class="p">(</span><span class="mi">3</span> <span class="mi">4</span><span class="p">))</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">sqrt-d</span> <span class="p">(</span><span class="nb">sqrt</span> <span class="nv">d</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;sqrt(3+4i) = ~D+~Di~%&quot;</span> <span class="p">(</span><span class="nb">realpart</span> <span class="nv">sqrt-d</span><span class="p">)</span> <span class="p">(</span><span class="nb">imagpart</span> <span class="nv">sqrt-d</span><span class="p">)))</span>
<span class="c1">;; sqrt(3+4i) = 2.0+1.0i</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN118"
>Converting Between Octal and Hexadecimal</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">hex</span> <span class="p">(</span><span class="nb">string</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">parse-integer</span> <span class="nb">string</span>
                 <span class="ss">:radix</span> <span class="mi">16</span>
                 <span class="ss">:start</span> <span class="mi">2</span><span class="p">))</span>             <span class="c1">; PARSE-INTEGER dislikes &quot;0x&quot;</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">oct</span> <span class="p">(</span><span class="nb">string</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">parse-integer</span> <span class="nb">string</span> <span class="ss">:radix</span> <span class="mi">8</span><span class="p">))</span>

<span class="p">(</span><span class="nb">setf</span> <span class="nc">number</span> <span class="p">(</span><span class="nv">hex</span> <span class="nv">hexadecimal</span><span class="p">))</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nc">number</span> <span class="p">(</span><span class="nv">oct</span> <span class="nv">octal</span><span class="p">))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;Gimme a number in decimal, octal, or hex: &quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">num</span> <span class="p">(</span><span class="nb">read-line</span><span class="p">))</span>
<span class="p">(</span><span class="nb">when</span> <span class="nv">num</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">num</span> <span class="p">(</span><span class="nv">chomp</span> <span class="nv">num</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~D ~:*~8R ~:*~X&quot;</span>
            <span class="p">(</span><span class="nb">cond</span>
              <span class="p">((</span><span class="nv">scan</span> <span class="s">&quot;^0x&quot;</span> <span class="nv">num</span><span class="p">)</span> <span class="p">(</span><span class="nv">hex</span> <span class="nv">num</span><span class="p">))</span>
              <span class="p">((</span><span class="nv">scan</span> <span class="s">&quot;^0&quot;</span> <span class="nv">num</span><span class="p">)</span> <span class="p">(</span><span class="nv">oct</span> <span class="nv">num</span><span class="p">))</span>
              <span class="p">(</span><span class="no">t</span> <span class="p">(</span><span class="nb">parse-integer</span> <span class="nv">num</span><span class="p">))))))</span>
<span class="c1">;;;-----------------------------</span>
<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;Enter file permission in octal: &quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setf</span> <span class="nv">permissions</span> <span class="p">(</span><span class="nb">read-line</span><span class="p">))</span>
<span class="p">(</span><span class="nb">unless</span> <span class="nv">permissions</span> <span class="p">(</span><span class="nb">error</span> <span class="s">&quot;Exiting...&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">permissions</span> <span class="p">(</span><span class="nv">chomp</span> <span class="nv">permissions</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;The decimal value is ~A~%&quot;</span> <span class="p">(</span><span class="nv">oct</span> <span class="nv">permissions</span><span class="p">)))</span>
<span class="c1">;;;-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN121"
>Putting Commas in Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">comma-separated</span> <span class="p">(</span><span class="nv">input</span> <span class="k">&amp;optional</span> <span class="p">(</span><span class="nv">n-digits</span> <span class="mi">3</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">coerce</span>
   <span class="p">(</span><span class="nb">first</span>
    <span class="p">(</span><span class="nb">reduce</span>
     <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nb">char</span> <span class="nv">accum</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">format</span> <span class="vg">*trace-output*</span> <span class="s">&quot;~S, ~S~%&quot;</span> <span class="nv">accum</span> <span class="nb">char</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">destructuring-bind</span> <span class="p">(</span><span class="nv">chars</span> <span class="nv">pos</span><span class="p">)</span> <span class="nv">accum</span>
         <span class="p">(</span><span class="nb">list</span>
          <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">zerop</span> <span class="nv">pos</span><span class="p">))</span> <span class="p">(</span><span class="nb">zerop</span> <span class="p">(</span><span class="nb">mod</span> <span class="nv">pos</span> <span class="nv">n-digits</span><span class="p">)))</span>
              <span class="p">(</span><span class="nb">cons</span> <span class="nb">char</span> <span class="p">(</span><span class="nb">cons</span> <span class="sc">#\,</span> <span class="nv">chars</span><span class="p">))</span>
              <span class="p">(</span><span class="nb">cons</span> <span class="nb">char</span> <span class="nv">chars</span><span class="p">))</span>
          <span class="p">(</span><span class="nb">1+</span> <span class="nv">pos</span><span class="p">))))</span>
     <span class="p">(</span><span class="nb">coerce</span> <span class="p">(</span><span class="nb">format</span> <span class="no">nil</span> <span class="s">&quot;~A&quot;</span> <span class="nv">input</span><span class="p">)</span> <span class="ss">&#39;list</span><span class="p">)</span>
     <span class="ss">:initial-value</span> <span class="p">(</span><span class="nb">list</span> <span class="no">nil</span> <span class="mi">0</span><span class="p">)</span>
     <span class="ss">:from-end</span> <span class="no">t</span><span class="p">))</span>
   <span class="ss">&#39;string</span><span class="p">))</span>

<span class="c1">; (comma-separated 1234567890)   =&gt; &quot;1,234,567,890&quot;</span>
<span class="c1">; (comma-separated 1234567890 2) =&gt; &quot;12,34,56,78,90&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN124"
>Printing Correct Plurals</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;; There isn&#39;t a  Lingua::EN::Inflect like F/OSS Common Lisp  library I know of</span>
<span class="c1">;;; (as of date 2009-03-09). Below is a quick &amp; dirty implementation of its Perl</span>
<span class="c1">;;; equivalent.  On  the other hand, one  might be interested  in ~P (pluralize)</span>
<span class="c1">;;; directive of  the FORMAT  command and  its modifiers for  a quick  and cheap</span>
<span class="c1">;;; solution.</span>

<span class="p">(</span><span class="k">setq</span> <span class="vg">*pluralization-regexps*</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;ss$&quot;</span>       <span class="o">.</span> <span class="s">&quot;sses&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;([psc]h)$&quot;</span> <span class="o">.</span> <span class="s">&quot;\\1es&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;z$&quot;</span>        <span class="o">.</span> <span class="s">&quot;zes&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;ff$&quot;</span>       <span class="o">.</span> <span class="s">&quot;ffs&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;f$&quot;</span>        <span class="o">.</span> <span class="s">&quot;ves&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;ey$&quot;</span>       <span class="o">.</span> <span class="s">&quot;eys&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;y$&quot;</span>        <span class="o">.</span> <span class="s">&quot;ies&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;ix$&quot;</span>       <span class="o">.</span> <span class="s">&quot;ices&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;([sx])$&quot;</span>   <span class="o">.</span> <span class="s">&quot;\\1es&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;$&quot;</span>         <span class="o">.</span> <span class="s">&quot;s&quot;</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">pluralize</span> <span class="p">(</span><span class="nv">noun</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">regexp</span> <span class="vg">*pluralization-regexps*</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">multiple-value-bind</span> <span class="p">(</span><span class="nv">result</span> <span class="nv">foundp</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">ppcre:regex-replace</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">regexp</span><span class="p">)</span> <span class="nv">noun</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">regexp</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="nv">foundp</span> <span class="p">(</span><span class="nb">return</span> <span class="nv">result</span><span class="p">)))))</span>

<span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~{~{One ~A, two ~A.~}~%~}&quot;</span>
        <span class="p">(</span><span class="nb">mapcar</span>
         <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">noun</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">noun</span> <span class="p">(</span><span class="nv">pluralize</span> <span class="nv">noun</span><span class="p">)))</span>
         <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;fish&quot;</span> <span class="s">&quot;fly&quot;</span> <span class="s">&quot;ox&quot;</span> <span class="s">&quot;species&quot;</span> <span class="s">&quot;genus&quot;</span> <span class="s">&quot;phylum&quot;</span> <span class="s">&quot;cherub&quot;</span> <span class="s">&quot;radius&quot;</span>
           <span class="s">&quot;jockey&quot;</span> <span class="s">&quot;index&quot;</span> <span class="s">&quot;matrix&quot;</span> <span class="s">&quot;mythos&quot;</span> <span class="s">&quot;phenomenon&quot;</span> <span class="s">&quot;formula&quot;</span><span class="p">)))</span>
<span class="c1">; =&gt; One fish, two fishes.</span>
<span class="c1">;    One fly, two flies.</span>
<span class="c1">;    One ox, two oxes.</span>
<span class="c1">;    One species, two specieses.</span>
<span class="c1">;    One genus, two genuses.</span>
<span class="c1">;    One phylum, two phylums.</span>
<span class="c1">;    One cherub, two cherubs.</span>
<span class="c1">;    One radius, two radiuses.</span>
<span class="c1">;    One jockey, two jockeys.</span>
<span class="c1">;    One index, two indexes.</span>
<span class="c1">;    One matrix, two matrices.</span>
<span class="c1">;    One mythos, two mythoses.</span>
<span class="c1">;    One phenomenon, two phenomenons.</span>
<span class="c1">;    One formula, two formulas.</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN127"
>Program: Calculating Prime Factors</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">factorize</span> <span class="p">(</span><span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">factors</span> <span class="p">(</span><span class="nb">make-hash-table</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">m</span> <span class="nv">n</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">i</span> <span class="nv">from</span> <span class="mi">2</span>
          <span class="nv">while</span> <span class="p">(</span><span class="nb">&lt;=</span> <span class="p">(</span><span class="nb">1+</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">i</span> <span class="mi">2</span><span class="p">))</span> <span class="nv">m</span><span class="p">)</span>
          <span class="nb">do</span> <span class="p">(</span><span class="nb">loop</span> <span class="nv">while</span> <span class="p">(</span><span class="nb">zerop</span> <span class="p">(</span><span class="nb">mod</span> <span class="nv">m</span> <span class="nv">i</span><span class="p">))</span>
                   <span class="nb">do</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">m</span> <span class="p">(</span><span class="nb">/</span> <span class="nv">m</span> <span class="nv">i</span><span class="p">))</span>
                      <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nb">gethash</span> <span class="nv">i</span> <span class="nv">factors</span><span class="p">)</span>
                            <span class="p">(</span><span class="nb">1+</span> <span class="p">(</span><span class="nb">gethash</span> <span class="nv">i</span> <span class="nv">factors</span> <span class="mi">0</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">=</span> <span class="mi">1</span> <span class="nv">m</span><span class="p">)</span> <span class="p">(</span><span class="nb">=</span> <span class="nv">n</span> <span class="nv">m</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nb">gethash</span> <span class="nv">m</span> <span class="nv">factors</span><span class="p">)</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">format</span> <span class="no">t</span> <span class="s">&quot;~A = ~{~{~A^~A~}~^ * ~}~%&quot;</span>
            <span class="nv">n</span> <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">factor</span> <span class="nv">being</span> <span class="nv">each</span> <span class="nv">hash-key</span> <span class="nv">of</span> <span class="nv">factors</span>
                     <span class="nv">collect</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">factor</span> <span class="p">(</span><span class="nb">gethash</span> <span class="nv">factor</span> <span class="nv">factors</span><span class="p">))))))</span>

<span class="c1">; (factorize 49249597168049276)</span>
<span class="c1">; =&gt; 49249597168049276 = 2^2 * 29^1 * 179^1 * 103387^1 * 22941707^1</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="strings.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="datesandtimes.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Strings</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Dates and Times</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>