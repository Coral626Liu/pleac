<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Arrays</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Objective CAML "
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Dates and Times"
HREF="datesandtimes.html"><LINK
REL="NEXT"
TITLE="Hashes"
HREF="hashes.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Objective CAML </TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="datesandtimes.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="hashes.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="ARRAYS"
>4. Arrays</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN170"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="k">let</span> <span class="n">nested</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;this&quot;</span><span class="o">;</span> <span class="s2">&quot;that&quot;</span><span class="o">;</span> <span class="s2">&quot;the&quot;</span><span class="o">;</span> <span class="s2">&quot;other&quot;</span><span class="o">]</span> <span class="c">(* string list *)</span>

<span class="c">(* there is no such non-homogeneous list. You can do things with tuples: *)</span>
<span class="k">let</span> <span class="n">nested</span> <span class="o">=</span> <span class="o">(</span><span class="s2">&quot;this&quot;</span><span class="o">,</span> <span class="s2">&quot;that&quot;</span><span class="o">,</span> <span class="o">[</span><span class="s2">&quot;the&quot;</span><span class="o">;</span> <span class="s2">&quot;other&quot;</span><span class="o">])</span> <span class="c">(* string * string * string list *)</span>
<span class="c">(*-----------------------------*)</span>
<span class="k">let</span> <span class="n">tune</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;The&quot;</span><span class="o">;</span> <span class="s2">&quot;Star-Spangled&quot;</span><span class="o">;</span> <span class="s2">&quot;Banner&quot;</span><span class="o">]</span>
<span class="c">(*-----------------------------*)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN173"
>Specifying a List In Your Program</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">(* Note that Perl sort of munges OCaml lists and arrays into a single data</span>
<span class="c"> * structure.  In OCaml, they are two distinct data structures, and one needs to</span>
<span class="c"> * learn when it is best to use lists vs. arrays. *)</span>

<span class="c">(* To initialize a list *)</span>
<span class="k">let</span> <span class="n">l</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;quick&quot;</span><span class="o">;</span> <span class="s2">&quot;brown&quot;</span><span class="o">;</span> <span class="s2">&quot;fox&quot;</span><span class="o">];;</span>

<span class="c">(* To initialize an array *)</span>
<span class="k">let</span> <span class="n">a</span> <span class="o">=</span> <span class="o">[|</span><span class="s2">&quot;quick&quot;</span><span class="o">;</span> <span class="s2">&quot;brown&quot;</span><span class="o">;</span> <span class="s2">&quot;fox&quot;</span><span class="o">|];;</span>

<span class="c">(*-----------------------------*)</span>
<span class="k">let</span> <span class="n">words</span> <span class="n">s</span> <span class="o">=</span> <span class="nn">Str</span><span class="p">.</span><span class="n">split</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="s2">&quot;[ </span><span class="se">\t</span><span class="s2">]+&quot;</span><span class="o">)</span> <span class="n">s</span><span class="o">;;</span>
<span class="k">let</span> <span class="n">l</span> <span class="o">=</span> <span class="n">words</span> <span class="s2">&quot;Why are you teasing me?&quot;</span><span class="o">;;</span>
<span class="c">(*-----------------------------*)</span>
<span class="k">let</span> <span class="n">str</span> <span class="o">=</span> <span class="s2">&quot;  The boy stood on the burning deck,</span>
<span class="s2">  It was as hot as glass.</span>
<span class="s2">&quot;</span> <span class="k">in</span>
<span class="k">let</span> <span class="n">f</span> <span class="n">l</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">sep</span> <span class="o">=</span> <span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="s2">&quot;[ </span><span class="se">\t\n</span><span class="s2">]*</span><span class="se">\\</span><span class="s2">(.+</span><span class="se">\\</span><span class="s2">)&quot;</span> <span class="k">in</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="n">s</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">string_match</span> <span class="n">sep</span> <span class="n">s</span> <span class="mi">0</span><span class="o">)</span> <span class="k">then</span>
      <span class="nn">Str</span><span class="p">.</span><span class="n">matched_group</span> <span class="mi">1</span> <span class="n">s</span>
    <span class="k">else</span>
      <span class="s2">&quot;&quot;</span>
  <span class="o">)</span> <span class="n">l</span>
<span class="k">in</span>
<span class="n">f</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">split</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp_string</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">)</span> <span class="n">str</span><span class="o">);;</span>
<span class="c">(*</span>
<span class="c"> * - : string list =</span>
<span class="c"> * [&quot;The boy stood on the burning deck,&quot;; &quot;It was as hot as glass.&quot;]</span>
<span class="c"> *)</span>

<span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="n">open_in</span> <span class="s2">&quot;mydatafile&quot;</span> <span class="k">in</span>
<span class="k">let</span> <span class="n">bigarray</span> <span class="o">=</span> <span class="n">readlines</span> <span class="n">data</span> <span class="k">in</span>
<span class="n">bigarray</span><span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN176"
>Printing a List with Commas</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="k">let</span> <span class="n">commify_series</span> <span class="n">l</span> <span class="o">=</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">sepChar</span> <span class="n">l</span> <span class="o">=</span>
  <span class="k">match</span> <span class="n">l</span> <span class="k">with</span>
    <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="s2">&quot;, &quot;</span>
  <span class="o">|</span> <span class="n">h</span><span class="o">::</span><span class="n">t</span> <span class="o">-&gt;</span>
       <span class="k">if</span> <span class="nn">String</span><span class="p">.</span><span class="n">contains</span> <span class="n">h</span> <span class="sc">&#39;,&#39;</span> <span class="k">then</span> <span class="s2">&quot;; &quot;</span> <span class="k">else</span> <span class="n">sepChar</span> <span class="n">t</span> <span class="k">in</span>
  <span class="k">match</span> <span class="n">l</span> <span class="k">with</span>
    <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="s2">&quot;&quot;</span>
  <span class="o">|</span> <span class="n">h</span><span class="o">::</span><span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">h</span>
  <span class="o">|</span> <span class="n">h1</span><span class="o">::</span><span class="n">h2</span><span class="o">::</span><span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">h1</span> <span class="o">^</span> <span class="s2">&quot; and &quot;</span> <span class="o">^</span> <span class="n">h2</span>
  <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span>
     <span class="k">let</span> <span class="n">l&#39;</span> <span class="o">=</span>
        <span class="k">let</span> <span class="n">last</span><span class="o">::</span><span class="n">rest</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">rev</span> <span class="n">l</span> <span class="k">in</span>
        <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">rev</span> <span class="o">((</span><span class="s2">&quot;and &quot;</span> <span class="o">^</span> <span class="n">last</span><span class="o">)::</span><span class="n">rest</span><span class="o">))</span> <span class="k">in</span>
     <span class="nn">String</span><span class="p">.</span><span class="n">concat</span> <span class="o">(</span><span class="n">sepChar</span> <span class="n">l</span><span class="o">)</span> <span class="n">l&#39;</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">lists</span> <span class="o">=</span>
  <span class="o">[</span>
    <span class="o">[</span> <span class="s2">&quot;just one thing&quot;</span> <span class="o">];</span>
    <span class="o">[</span> <span class="s2">&quot;Mutt&quot;</span><span class="o">;</span> <span class="s2">&quot;Jeff&quot;</span> <span class="o">];</span>
    <span class="o">[</span> <span class="s2">&quot;Peter&quot;</span><span class="o">;</span> <span class="s2">&quot;Paul&quot;</span><span class="o">;</span> <span class="s2">&quot;Mary&quot;</span> <span class="o">];</span>
    <span class="o">[</span> <span class="s2">&quot;To our parents&quot;</span><span class="o">;</span> <span class="s2">&quot;Mother Theresa&quot;</span><span class="o">;</span> <span class="s2">&quot;God&quot;</span> <span class="o">];</span>
    <span class="o">[</span> <span class="s2">&quot;pastrami&quot;</span><span class="o">;</span> <span class="s2">&quot;ham and cheese&quot;</span><span class="o">;</span> <span class="s2">&quot;peanut butter and jelly&quot;</span><span class="o">;</span> <span class="s2">&quot;tuna&quot;</span> <span class="o">];</span>
    <span class="o">[</span> <span class="s2">&quot;recycle tired, old phrases&quot;</span><span class="o">;</span> <span class="s2">&quot;ponder big, happy thoughts&quot;</span> <span class="o">];</span>
    <span class="o">[</span> <span class="s2">&quot;recycle tired, old phrases&quot;</span><span class="o">;</span>
      <span class="s2">&quot;ponder big, happy thoughts&quot;</span><span class="o">;</span>
      <span class="s2">&quot;sleep and dream peacefully&quot;</span> <span class="o">]</span>
  <span class="o">];;</span>

<span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">printf</span> <span class="s2">&quot;The list is: %s.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">(</span><span class="n">commify_series</span> <span class="n">x</span><span class="o">))</span> <span class="n">lists</span><span class="o">;;</span>

<span class="c">(*</span>
<span class="c">The list is: just one thing.</span>
<span class="c">The list is: Mutt and Jeff.</span>
<span class="c">The list is: Peter, Paul, and Mary.</span>
<span class="c">The list is: To our parents, Mother Theresa, and God.</span>
<span class="c">The list is: pastrami, ham and cheese, peanut butter and jelly, and tuna.</span>
<span class="c">The list is: recycle tired, old phrases and ponder big, happy thoughts.</span>
<span class="c">The list is: recycle tired, old phrases; ponder big, happy thoughts; and sleep and dream peacefully.</span>
<span class="c">*)</span>

<span class="c">(* Note that if you are actually using arrays instead of lists, you can either</span>
<span class="c"> * reuse the above code by calling &quot;commify_series (Array.to_list a)&quot;, or you</span>
<span class="c"> * can use the following solution (which won&#39;t work with lists, but is probably</span>
<span class="c"> * more efficient).</span>
<span class="c">*)</span>

<span class="k">let</span> <span class="n">commify_array</span> <span class="n">a</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">len</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">a</span> <span class="k">in</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">sepChar</span> <span class="n">a</span> <span class="o">=</span>
    <span class="k">try</span>
      <span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span> <span class="k">to</span> <span class="n">len</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
        <span class="k">if</span> <span class="nn">String</span><span class="p">.</span><span class="n">contains</span> <span class="n">a</span><span class="o">.(</span><span class="n">i</span><span class="o">)</span> <span class="sc">&#39;,&#39;</span> <span class="k">then</span> <span class="k">raise</span> <span class="nc">Not_found</span>
      <span class="k">done</span><span class="o">;</span>
      <span class="s2">&quot;, &quot;</span>
    <span class="k">with</span> <span class="nc">Not_found</span> <span class="o">-&gt;</span> <span class="s2">&quot;; &quot;</span> <span class="k">in</span>
  <span class="k">match</span> <span class="n">len</span> <span class="k">with</span>
    <span class="mi">0</span> <span class="o">-&gt;</span> <span class="s2">&quot;&quot;</span>
  <span class="o">|</span> <span class="mi">1</span> <span class="o">-&gt;</span> <span class="n">a</span><span class="o">.(</span><span class="mi">0</span><span class="o">)</span>
  <span class="o">|</span> <span class="mi">2</span> <span class="o">-&gt;</span> <span class="n">a</span><span class="o">.(</span><span class="mi">0</span><span class="o">)</span> <span class="o">^</span> <span class="s2">&quot; and &quot;</span> <span class="o">^</span> <span class="n">a</span><span class="o">.(</span><span class="mi">1</span><span class="o">)</span>
  <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span>
      <span class="k">let</span> <span class="n">buf</span> <span class="o">=</span> <span class="nn">Buffer</span><span class="p">.</span><span class="n">create</span> <span class="mi">10</span>
      <span class="ow">and</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">sepChar</span> <span class="n">a</span> <span class="k">in</span>
      <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">to</span> <span class="n">len</span> <span class="o">-</span> <span class="mi">2</span> <span class="k">do</span>
        <span class="nn">Buffer</span><span class="p">.</span><span class="n">add_string</span> <span class="n">buf</span> <span class="n">a</span><span class="o">.(</span><span class="n">i</span><span class="o">);</span>
        <span class="nn">Buffer</span><span class="p">.</span><span class="n">add_string</span> <span class="n">buf</span> <span class="n">sep</span><span class="o">;</span>
      <span class="k">done</span><span class="o">;</span>
      <span class="nn">Buffer</span><span class="p">.</span><span class="n">add_string</span> <span class="n">buf</span> <span class="s2">&quot;and &quot;</span><span class="o">;</span>
      <span class="nn">Buffer</span><span class="p">.</span><span class="n">add_string</span> <span class="n">buf</span> <span class="n">a</span><span class="o">.(</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
      <span class="nn">Buffer</span><span class="p">.</span><span class="n">contents</span> <span class="n">buf</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">arrays</span> <span class="o">=</span>
  <span class="o">[|</span>
    <span class="o">[|</span> <span class="s2">&quot;just one thing&quot;</span> <span class="o">|];</span>
    <span class="o">[|</span> <span class="s2">&quot;Mutt&quot;</span><span class="o">;</span> <span class="s2">&quot;Jeff&quot;</span> <span class="o">|];</span>
    <span class="o">[|</span> <span class="s2">&quot;Peter&quot;</span><span class="o">;</span> <span class="s2">&quot;Paul&quot;</span><span class="o">;</span> <span class="s2">&quot;Mary&quot;</span> <span class="o">|];</span>
    <span class="o">[|</span> <span class="s2">&quot;To our parents&quot;</span><span class="o">;</span> <span class="s2">&quot;Mother Theresa&quot;</span><span class="o">;</span> <span class="s2">&quot;God&quot;</span> <span class="o">|];</span>
    <span class="o">[|</span> <span class="s2">&quot;pastrami&quot;</span><span class="o">;</span> <span class="s2">&quot;ham and cheese&quot;</span><span class="o">;</span> <span class="s2">&quot;peanut butter and jelly&quot;</span><span class="o">;</span> <span class="s2">&quot;tuna&quot;</span> <span class="o">|];</span>
    <span class="o">[|</span> <span class="s2">&quot;recycle tired, old phrases&quot;</span><span class="o">;</span> <span class="s2">&quot;ponder big, happy thoughts&quot;</span> <span class="o">|];</span>
    <span class="o">[|</span> <span class="s2">&quot;recycle tired, old phrases&quot;</span><span class="o">;</span>
      <span class="s2">&quot;ponder big, happy thoughts&quot;</span><span class="o">;</span>
      <span class="s2">&quot;sleep and dream peacefully&quot;</span> <span class="o">|]</span>
  <span class="o">|];;</span>

<span class="nn">Array</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">printf</span> <span class="s2">&quot;The list is: %s.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">(</span><span class="n">commify_array</span> <span class="n">x</span><span class="o">))</span> <span class="n">arrays</span><span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN179"
>Changing Array Size</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c">(*</span>
<span class="c">   OK, OCaml just doesn&#39;t work with arrays the same way tha Perl does.  In</span>
<span class="c">   Ocaml, Arrays are immutable in their shape, while containing mutable</span>
<span class="c">   contents.  You can simulate this example as shown below (which only works for</span>
<span class="c">   string arrays), or you can get resizeable arrays from a library such as</span>
<span class="c">   extlib &lt;http://ocaml-lib.sourceforge.net/&gt;</span>
<span class="c">*)</span>

<span class="k">let</span> <span class="n">what_about_that_array</span> <span class="n">a</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">len</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">a</span> <span class="k">in</span>
  <span class="n">printf</span> <span class="s2">&quot;The array now has %d elements.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">len</span><span class="o">;</span>
  <span class="n">printf</span> <span class="s2">&quot;The index of the last element is %d.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">(</span><span class="k">if</span> <span class="n">len</span><span class="o">=</span><span class="mi">0</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">len</span><span class="o">-</span><span class="mi">1</span><span class="o">);</span>
  <span class="n">printf</span> <span class="s2">&quot;Element 3 is </span><span class="se">\&quot;</span><span class="s2">%s</span><span class="se">\&quot;</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">a</span><span class="o">.(</span><span class="mi">3</span><span class="o">);;</span>

<span class="k">let</span> <span class="n">resizeArray</span> <span class="n">a</span> <span class="n">s</span> <span class="o">=</span>
  <span class="c">(* begin stupid hack to work like the Perl example *)</span>
  <span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">in</span>
  <span class="c">(* end stupid hack to work like the Perl example *)</span>
  <span class="k">assert</span> <span class="o">(</span><span class="n">s</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">);</span>
  <span class="k">let</span> <span class="n">len</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">a</span> <span class="k">in</span>
  <span class="k">if</span> <span class="n">s</span> <span class="o">=</span> <span class="n">len</span> <span class="k">then</span> <span class="n">a</span> <span class="k">else</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="n">len</span> <span class="k">then</span>
      <span class="nn">Array</span><span class="p">.</span><span class="n">sub</span> <span class="n">a</span> <span class="mi">0</span> <span class="n">s</span>
    <span class="k">else</span>
      <span class="nn">Array</span><span class="p">.</span><span class="n">append</span> <span class="n">a</span> <span class="o">(</span><span class="nn">Array</span><span class="p">.</span><span class="n">make</span> <span class="o">(</span><span class="n">s</span> <span class="o">-</span> <span class="n">len</span><span class="o">)</span> <span class="s2">&quot;&quot;</span><span class="o">);;</span>

<span class="k">let</span> <span class="n">people</span> <span class="o">=</span> <span class="o">[|</span><span class="s2">&quot;Crosby&quot;</span><span class="o">;</span> <span class="s2">&quot;Stills&quot;</span><span class="o">;</span> <span class="s2">&quot;Nash&quot;</span><span class="o">;</span> <span class="s2">&quot;Young&quot;</span><span class="o">|];;</span>
<span class="n">what_about_that_array</span> <span class="n">people</span><span class="o">;;</span>

<span class="c">(*</span>
<span class="c">The array now has 4 elements.</span>
<span class="c">The index of the last element is 3.</span>
<span class="c">Element 3 is &quot;Young&quot;.</span>
<span class="c">*)</span>

<span class="k">let</span> <span class="n">people</span> <span class="o">=</span> <span class="n">resizeArray</span> <span class="n">people</span> <span class="mi">2</span><span class="o">;;</span>
<span class="n">what_about_that_array</span> <span class="n">people</span><span class="o">;;</span>

<span class="c">(*</span>
<span class="c">The array now has 3 elements.</span>
<span class="c">The index of the last element is 2.</span>
<span class="c">Exception: Invalid_argument &quot;index out of bounds&quot;.</span>
<span class="c">*)</span>

<span class="k">let</span> <span class="n">people</span> <span class="o">=</span> <span class="n">resizeArray</span> <span class="n">people</span> <span class="mi">10000</span><span class="o">;;</span>
<span class="n">what_about_that_array</span> <span class="n">people</span><span class="o">;;</span>
<span class="c">(*</span>
<span class="c">The array now has 10001 elements.</span>
<span class="c">The index of the last element is 10000.</span>
<span class="c">Element 3 is &quot;&quot;.</span>
<span class="c">*)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN182"
>Doing Something with Every Element in a List</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="nn">Array</span><span class="p">.</span><span class="n">iter</span> <span class="n">complain</span> <span class="n">bad_users</span><span class="o">;;</span>
<span class="c">(* Or for lists *)</span>
<span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="n">complain</span> <span class="n">bad_users</span><span class="o">;;</span>

<span class="c">(* For the hashtable example, we&#39;d iterate over the table itself *)</span>

<span class="nn">Hashtbl</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">k</span> <span class="n">v</span> <span class="o">-&gt;</span> <span class="n">printf</span> <span class="s2">&quot;%s=%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">k</span> <span class="n">v</span><span class="o">)</span> <span class="n">h</span><span class="o">;;</span>

<span class="c">(* Of course if you want to iterate over the keys in lexicographic order, then</span>
<span class="c"> * you&#39;ll need to build a list of keys, sort it, then iterate over that *)</span>

<span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">printf</span> <span class="s2">&quot;%s=%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">x</span> <span class="o">(</span><span class="nn">Hashtbl</span><span class="p">.</span><span class="n">find</span> <span class="n">env</span> <span class="n">x</span><span class="o">))</span>
  <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">sort</span> <span class="n">compare</span> <span class="o">(</span><span class="nn">Hashtbl</span><span class="p">.</span><span class="n">fold</span> <span class="o">(</span><span class="k">fun</span> <span class="n">k</span> <span class="n">v</span> <span class="n">b</span> <span class="o">-&gt;</span> <span class="n">k</span><span class="o">::</span><span class="n">b</span><span class="o">)</span> <span class="n">env</span> <span class="bp">[]</span><span class="o">));;</span>

<span class="nn">Array</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="n">get_usage</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">max_quota</span> <span class="k">then</span> <span class="n">complain</span> <span class="n">x</span><span class="o">)</span> <span class="n">all_users</span><span class="o">;;</span>
<span class="c">(* or for lists of users *)</span>
<span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="n">get_usage</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">max_quota</span> <span class="k">then</span> <span class="n">complain</span> <span class="n">x</span><span class="o">)</span> <span class="n">all_users</span><span class="o">;;</span>

<span class="c">(* for this example, we&#39;re going to assume that the output of the who command is</span>
<span class="c"> * contained in the list named who, with one line of output per list element.</span>
<span class="c"> * This example requires the use of the Str module which is not loaded or linked</span>
<span class="c"> * by default (but is part of the standard library), at the toplevel, use the</span>
<span class="c"> * directive &quot;#load &quot;str.cma&quot;</span>
<span class="c">*)</span>

<span class="nn">List</span><span class="p">.</span><span class="n">iter</span>
  <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span>
    <span class="k">try</span>
      <span class="n">ignore</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">search_forward</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">quote</span> <span class="s2">&quot;tchrist&quot;</span><span class="o">)</span> <span class="n">x</span> <span class="mi">0</span><span class="o">);</span>
      <span class="n">print_endline</span> <span class="n">x</span><span class="o">;</span>
    <span class="k">with</span> <span class="nc">Not_found</span> <span class="o">-&gt;</span> <span class="bp">()</span><span class="o">)</span> <span class="n">who</span><span class="o">;;</span>

<span class="c">(* To iterate over all lines read in from some channel we would do the following *)</span>

<span class="k">let</span> <span class="n">iter_channel</span> <span class="n">f</span> <span class="n">ic</span> <span class="o">=</span>
  <span class="k">try</span>
    <span class="k">while</span> <span class="bp">true</span> <span class="k">do</span>
      <span class="n">f</span> <span class="o">(</span><span class="n">input_line</span> <span class="n">ic</span><span class="o">)</span>
    <span class="k">done</span>
  <span class="k">with</span> <span class="nc">Not_found</span> <span class="o">-&gt;</span> <span class="bp">()</span><span class="o">;;</span>

<span class="c">(* and the example would then be written as *)</span>
<span class="n">iter_channel</span>
  <span class="o">(</span><span class="k">fun</span>  <span class="n">s</span> <span class="o">-&gt;</span>
    <span class="k">let</span> <span class="n">reverse</span> <span class="n">s</span> <span class="o">=</span><span class="k">&#39;let</span> <span class="n">len</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">s</span> <span class="k">in</span>
      <span class="k">let</span> <span class="n">s&#39;</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">create</span> <span class="n">len</span> <span class="k">in</span>
      <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">to</span> <span class="n">len</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
        <span class="n">s&#39;</span><span class="o">.[</span><span class="n">len</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span> <span class="o">&lt;-</span> <span class="n">s</span><span class="o">.[</span><span class="n">i</span><span class="o">]</span>
      <span class="k">done</span><span class="o">;</span>
      <span class="n">s&#39;</span> <span class="k">in</span>
    <span class="c">(* assuming we have written a chomp workalike *)</span>
    <span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="n">chomp</span> <span class="n">s</span> <span class="k">in</span>
    <span class="nn">List</span><span class="p">.</span><span class="n">iter</span>
      <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">print_endline</span> <span class="o">(</span><span class="n">reverse</span> <span class="n">x</span><span class="o">))</span>
      <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">split</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="s2">&quot;[ </span><span class="se">\t</span><span class="s2">]+&quot;</span><span class="o">)</span> <span class="n">s</span><span class="o">))</span> <span class="n">fh</span><span class="o">;;</span>

<span class="c">(* In OCaml the iterator variable also is an alias for the current element,</span>
<span class="c"> * however, because of the functional nature of OCaml, unless the elements of</span>
<span class="c"> * the array are references, the only way to change them is by resetting the</span>
<span class="c"> * value of the array to something new -- this is best done using iteri *)</span>

<span class="k">let</span> <span class="n">a</span> <span class="o">=</span> <span class="o">[|</span><span class="mi">1</span><span class="o">;</span> <span class="mi">2</span><span class="o">;</span> <span class="mi">3</span><span class="o">|];;</span>
<span class="nn">Array</span><span class="p">.</span><span class="n">iteri</span> <span class="o">(</span><span class="k">fun</span> <span class="n">i</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">a</span><span class="o">.(</span><span class="n">i</span><span class="o">)</span> <span class="o">&lt;-</span> <span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="n">a</span><span class="o">;;</span>

<span class="c">(* or, with references *)</span>

<span class="k">let</span> <span class="n">a</span> <span class="o">=</span> <span class="o">[|</span> <span class="n">ref</span> <span class="mi">1</span><span class="o">;</span> <span class="n">ref</span> <span class="mi">2</span><span class="o">;</span> <span class="n">ref</span> <span class="mi">3</span> <span class="o">|];;</span>
<span class="nn">Array</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">:=</span> <span class="o">!</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="n">a</span><span class="o">;;</span>

<span class="c">(* You can, of course, use map to create a new array with the desired contents</span>
<span class="c"> * as well *)</span>
<span class="k">let</span> <span class="n">a</span> <span class="o">=</span> <span class="o">[|</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span><span class="o">;</span> <span class="mi">3</span><span class="o">.|];;</span>
<span class="k">let</span> <span class="n">b</span> <span class="o">=</span> <span class="o">[|</span><span class="mi">0</span><span class="o">.;</span> <span class="mi">1</span><span class="o">.|];;</span>
<span class="nn">Array</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="n">printf</span> <span class="s2">&quot;%f &quot;</span><span class="o">)</span> <span class="o">(</span><span class="nn">Array</span><span class="p">.</span><span class="n">map</span> <span class="o">((</span> <span class="o">*.</span> <span class="o">)</span> <span class="mi">7</span><span class="o">.)</span> <span class="o">(</span><span class="nn">Array</span><span class="p">.</span><span class="n">append</span> <span class="n">a</span> <span class="n">b</span><span class="o">));;</span>


<span class="k">let</span> <span class="n">strip</span> <span class="n">s</span> <span class="o">=</span>
  <span class="nn">Str</span><span class="p">.</span><span class="n">replace_first</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="s2">&quot;^[ </span><span class="se">\t\n</span><span class="s2">]&quot;</span><span class="o">)</span> <span class="s2">&quot;&quot;</span>
    <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">replace_first</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="s2">&quot;[ </span><span class="se">\t\n</span><span class="s2">$]&quot;</span><span class="o">)</span> <span class="s2">&quot;&quot;</span> <span class="n">s</span><span class="o">);;</span>


<span class="k">let</span> <span class="n">sc</span><span class="o">,</span><span class="n">ar</span><span class="o">,</span><span class="n">h</span> <span class="o">=</span>
  <span class="n">strip</span> <span class="n">sc</span><span class="o">,</span>
  <span class="nn">Array</span><span class="p">.</span><span class="n">map</span> <span class="n">strip</span> <span class="n">ar</span><span class="o">,</span>
  <span class="o">(</span><span class="nn">Hashtbl</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">k</span> <span class="n">v</span> <span class="o">-&gt;</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">replace</span> <span class="n">h</span> <span class="n">k</span> <span class="o">(</span><span class="n">strip</span> <span class="n">v</span><span class="o">))</span> <span class="n">h</span><span class="o">;</span> <span class="n">h</span><span class="o">);;</span>

<span class="c">(* of course, the Hashtbl.replace already destructively updates the old</span>
<span class="c"> * hashtable... *)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN185"
>Iterating Over an Array by Reference</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c">(* iterate over elements of array in arrayref *)</span>

<span class="nn">Array</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="c">(* do something with x *)</span><span class="o">)</span> <span class="o">!</span><span class="n">arrayref</span><span class="o">;;</span>

<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">to</span> <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="o">!</span><span class="n">arrayref</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
  <span class="c">(* do something with !arrayref.(i) *)</span>
<span class="k">done</span>

<span class="k">let</span> <span class="n">fruits</span> <span class="o">=</span> <span class="o">[|</span> <span class="s2">&quot;Apple&quot;</span><span class="o">;</span> <span class="s2">&quot;Blackberry&quot;</span> <span class="o">|];;</span>
<span class="k">let</span> <span class="n">fruit_ref</span> <span class="o">=</span> <span class="n">ref</span> <span class="n">fruits</span><span class="o">;;</span>
<span class="nn">Array</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="n">printf</span> <span class="s2">&quot;%s tastes good in a pie.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">)</span> <span class="o">!</span><span class="n">fruit_ref</span><span class="o">;;</span>

<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">to</span>  <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="o">!</span><span class="n">fruit_ref</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
  <span class="n">printf</span> <span class="s2">&quot;%s tastes good in a pie.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">!</span><span class="n">fruit_ref</span><span class="o">.(</span><span class="n">i</span><span class="o">)</span>
<span class="k">done</span><span class="o">;;</span>

<span class="nn">Hashtbl</span><span class="p">.</span><span class="n">add</span> <span class="n">namelist</span> <span class="s2">&quot;felines&quot;</span> <span class="o">(</span><span class="n">ref</span> <span class="n">rogue_cats</span><span class="o">);;</span>
<span class="nn">Array</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="n">printf</span> <span class="s2">&quot;%s purrs hypnotically.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">)</span> <span class="o">!(</span><span class="nn">Hashtbl</span><span class="p">.</span><span class="n">find</span> <span class="n">namelist</span>
<span class="s2">&quot;felines&quot;</span><span class="o">);;</span>
<span class="n">print_endline</span> <span class="s2">&quot;--More--</span><span class="se">\n</span><span class="s2">You are controlled.&quot;</span><span class="o">;;</span>

<span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span> <span class="k">to</span> <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="o">!(</span><span class="nn">Hashtbl</span><span class="p">.</span><span class="n">find</span> <span class="n">namelist</span> <span class="s2">&quot;felines&quot;</span><span class="o">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
  <span class="n">printf</span> <span class="s2">&quot;%s purrs hypnotically.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">!(</span><span class="nn">Hashtbl</span><span class="p">.</span><span class="n">find</span> <span class="n">namelist</span> <span class="s2">&quot;felines&quot;</span><span class="o">).(</span><span class="n">i</span><span class="o">)</span>
<span class="k">done</span><span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN188"
>Extracting Unique Elements from a List</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c">(* For lists, the most &quot;natural&quot; way to do this is by walking the list and</span>
<span class="c"> * looking for duplicates of each item *)</span>

<span class="k">let</span> <span class="k">rec</span> <span class="n">uniquesOnly</span> <span class="n">l</span> <span class="o">=</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">contains</span> <span class="n">x</span> <span class="n">l</span> <span class="o">=</span>
    <span class="k">match</span> <span class="n">l</span> <span class="k">with</span>
      <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="bp">false</span>
    <span class="o">|</span> <span class="n">h</span><span class="o">::</span><span class="n">t</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="n">x</span> <span class="o">=</span> <span class="n">h</span> <span class="k">then</span> <span class="bp">true</span> <span class="k">else</span> <span class="n">contains</span> <span class="n">x</span> <span class="n">t</span> <span class="k">in</span>
  <span class="k">match</span> <span class="n">l</span> <span class="k">with</span>
    <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="bp">[]</span>
  <span class="o">|</span> <span class="n">h</span><span class="o">::</span><span class="n">t</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="n">contains</span> <span class="n">h</span> <span class="n">t</span> <span class="k">then</span> <span class="n">uniquesOnly</span> <span class="n">t</span> <span class="k">else</span> <span class="n">h</span><span class="o">::(</span><span class="n">uniquesOnly</span> <span class="n">t</span><span class="o">);;</span>

<span class="c">(* if you have a lot of duplicates, it might be better to use List.filter *)</span>
<span class="k">let</span> <span class="k">rec</span> <span class="n">uniquesOnly</span> <span class="n">l</span> <span class="o">=</span>
  <span class="k">match</span> <span class="n">l</span> <span class="k">with</span>
    <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="bp">[]</span>
  <span class="o">|</span> <span class="n">h</span><span class="o">::</span><span class="n">t</span> <span class="o">-&gt;</span> <span class="n">h</span><span class="o">::(</span><span class="n">uniquesOnly</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">filter</span> <span class="o">((&lt;&gt;)</span> <span class="n">h</span><span class="o">)</span> <span class="n">t</span><span class="o">));;</span>

<span class="c">(* Or, for lists or arrays, you can use a hashtable *)</span>
<span class="c">(* Straightforward *)</span>
<span class="k">let</span> <span class="n">uniquesOnly</span> <span class="n">l</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">seen</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">create</span> <span class="mi">17</span>
  <span class="ow">and</span> <span class="n">uniq</span> <span class="o">=</span> <span class="n">ref</span> <span class="bp">[]</span> <span class="k">in</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">iter</span>
    <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span>
      <span class="k">if</span> <span class="n">not</span> <span class="o">(</span><span class="nn">Hashtbl</span><span class="p">.</span><span class="n">mem</span> <span class="n">seen</span> <span class="n">x</span><span class="o">)</span> <span class="k">then</span>
        <span class="o">(</span><span class="nn">Hashtbl</span><span class="p">.</span><span class="n">add</span> <span class="n">seen</span> <span class="n">x</span> <span class="mi">1</span><span class="o">;</span> <span class="n">uniq</span> <span class="o">:=</span> <span class="o">(</span><span class="n">x</span><span class="o">::!</span><span class="n">uniq</span><span class="o">)))</span>
    <span class="n">l</span><span class="o">;</span>
  <span class="o">!</span><span class="n">uniq</span><span class="o">;;</span>

<span class="c">(* Or more likely *)</span>
<span class="k">let</span> <span class="n">uniquesOnly</span> <span class="n">l</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">seen</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">create</span> <span class="mi">17</span> <span class="k">in</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">replace</span> <span class="n">seen</span> <span class="n">x</span> <span class="mi">1</span><span class="o">)</span> <span class="n">l</span><span class="o">;</span>
  <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">fold</span> <span class="o">(</span><span class="k">fun</span> <span class="n">k</span> <span class="n">v</span> <span class="n">b</span> <span class="o">-&gt;</span> <span class="n">k</span><span class="o">::</span><span class="n">b</span><span class="o">)</span> <span class="n">seen</span> <span class="bp">[]</span><span class="o">;;</span>

<span class="c">(* To apply a user function to each unique element of a list, one would likely</span>
<span class="c"> * do something like *)</span>

<span class="k">let</span> <span class="n">userUnique</span> <span class="n">f</span> <span class="n">l</span> <span class="o">=</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="n">f</span> <span class="o">(</span><span class="n">uniquesOnly</span> <span class="n">l</span><span class="o">);;</span>

<span class="c">(* Generate a list of users logged in, removing duplicates.  Note that this</span>
<span class="c"> * example requires linking with the Unix and Str libraries. *)</span>
<span class="k">let</span> <span class="n">who</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">w</span> <span class="o">=</span> <span class="nn">Unix</span><span class="p">.</span><span class="n">open_process_in</span> <span class="s2">&quot;who&quot;</span>
  <span class="ow">and</span> <span class="n">l</span> <span class="o">=</span> <span class="n">ref</span> <span class="bp">[]</span> <span class="k">in</span>
  <span class="k">try</span>
    <span class="k">while</span> <span class="bp">true</span> <span class="k">do</span>
      <span class="n">l</span> <span class="o">:=</span> <span class="o">(</span><span class="n">input_line</span> <span class="n">w</span><span class="o">)::!</span><span class="n">l</span>
	<span class="k">done</span><span class="o">;</span>
	<span class="o">!</span><span class="n">l</span>
  <span class="k">with</span> <span class="nc">End_of_file</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">l</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">ucnt</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">create</span> <span class="mi">17</span><span class="o">;;</span>
<span class="nn">List</span><span class="p">.</span><span class="n">iter</span>
  <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span>
    <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">replace</span> <span class="n">ucnt</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">replace_first</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="s2">&quot;[ </span><span class="se">\t</span><span class="s2">].*$&quot;</span><span class="o">)</span> <span class="s2">&quot;&quot;</span> <span class="n">x</span><span class="o">)</span> <span class="mi">1</span><span class="o">)</span>
  <span class="o">(</span><span class="n">who</span> <span class="bp">()</span><span class="o">);;</span>
<span class="k">let</span> <span class="n">users</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">fold</span> <span class="o">(</span><span class="k">fun</span> <span class="n">k</span> <span class="n">v</span> <span class="n">b</span> <span class="o">-&gt;</span> <span class="n">k</span><span class="o">::</span><span class="n">b</span><span class="o">)</span> <span class="n">ucnt</span> <span class="bp">[]</span><span class="o">;;</span>

<span class="n">printf</span> <span class="s2">&quot;users logged in: %s&quot;</span><span class="o">;;</span>
<span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="n">printf</span> <span class="s2">&quot;%s &quot;</span><span class="o">)</span> <span class="n">users</span><span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN191"
>Finding Elements in One Array but Not Another</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c">(* using hashtables, like the cookbook *)</span>
<span class="k">let</span> <span class="n">arrayDiff</span> <span class="n">a</span> <span class="n">b</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">seen</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">create</span> <span class="mi">17</span>
  <span class="ow">and</span> <span class="n">l</span> <span class="o">=</span> <span class="n">ref</span> <span class="bp">[]</span> <span class="k">in</span>
  <span class="nn">Array</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">add</span> <span class="n">seen</span> <span class="n">x</span> <span class="mi">1</span><span class="o">)</span> <span class="n">b</span><span class="o">;</span>
  <span class="nn">Array</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="n">not</span> <span class="o">(</span><span class="nn">Hashtbl</span><span class="p">.</span><span class="n">mem</span> <span class="n">seen</span> <span class="n">x</span><span class="o">)</span> <span class="k">then</span> <span class="n">l</span> <span class="o">:=</span> <span class="n">x</span><span class="o">::!</span><span class="n">l</span><span class="o">)</span> <span class="n">a</span><span class="o">;</span>
  <span class="nn">Array</span><span class="p">.</span><span class="n">of_list</span> <span class="o">!</span><span class="n">l</span><span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN194"
>Computing Union, Intersection, or Difference of Unique Lists</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="k">let</span> <span class="n">a</span> <span class="o">=</span> <span class="o">[</span> <span class="mi">1</span><span class="o">;</span><span class="mi">3</span><span class="o">;</span><span class="mi">5</span><span class="o">;</span><span class="mi">6</span><span class="o">;</span><span class="mi">7</span><span class="o">;</span><span class="mi">8</span> <span class="o">];;</span>
<span class="k">let</span> <span class="n">b</span> <span class="o">=</span> <span class="o">[</span> <span class="mi">2</span><span class="o">;</span><span class="mi">3</span><span class="o">;</span><span class="mi">5</span><span class="o">;</span><span class="mi">7</span><span class="o">;</span><span class="mi">9</span> <span class="o">];;</span>

<span class="k">let</span> <span class="n">union</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">create</span> <span class="mi">13</span>
<span class="ow">and</span> <span class="n">isect</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">create</span> <span class="mi">13</span>
<span class="ow">and</span> <span class="n">diff</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">create</span> <span class="mi">13</span><span class="o">;;</span>

<span class="c">(* simple solution for union and intersection *)</span>
<span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">add</span> <span class="n">union</span> <span class="n">x</span> <span class="mi">1</span><span class="o">)</span> <span class="n">a</span><span class="o">;;</span>
<span class="nn">List</span><span class="p">.</span><span class="n">iter</span>
  <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">hashtbl</span><span class="o">.</span><span class="n">add</span> <span class="o">(</span><span class="k">if</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">mem</span> <span class="n">union</span> <span class="n">x</span> <span class="k">then</span> <span class="n">isect</span> <span class="k">else</span> <span class="n">union</span><span class="o">)</span> <span class="n">x</span> <span class="mi">1</span><span class="o">)</span> <span class="n">b</span><span class="o">;;</span>
<span class="k">let</span> <span class="n">u</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">fold</span> <span class="o">(</span><span class="k">fun</span> <span class="n">k</span> <span class="n">v</span> <span class="n">b</span> <span class="o">-&gt;</span> <span class="n">k</span><span class="o">::</span><span class="n">b</span><span class="o">)</span> <span class="n">union</span> <span class="bp">[]</span>
<span class="ow">and</span> <span class="n">i</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">fold</span> <span class="o">(</span><span class="k">fun</span> <span class="n">k</span> <span class="n">v</span> <span class="n">b</span> <span class="o">-&gt;</span> <span class="n">k</span><span class="o">::</span><span class="n">b</span><span class="o">)</span> <span class="n">isect</span> <span class="bp">[]</span><span class="o">;;</span>

<span class="c">(* Union, intersection, and symmetric difference *)</span>
<span class="k">let</span> <span class="n">hincr</span> <span class="n">h</span> <span class="n">x</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">v</span> <span class="o">=</span> <span class="k">try</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">find</span> <span class="n">h</span> <span class="n">x</span> <span class="k">with</span> <span class="nc">Not_found</span> <span class="o">-&gt;</span> <span class="mi">0</span> <span class="k">in</span>
  <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">replace</span> <span class="n">h</span> <span class="n">x</span> <span class="o">(</span><span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="o">);;</span>

<span class="k">let</span> <span class="n">count</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">create</span> <span class="mi">13</span><span class="o">;;</span>
<span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">add</span> <span class="n">count</span> <span class="n">x</span> <span class="mi">1</span><span class="o">)</span> <span class="n">a</span><span class="o">;;</span>
<span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="n">hincr</span> <span class="n">count</span><span class="o">)</span> <span class="n">b</span><span class="o">;;</span>
<span class="k">let</span> <span class="n">u</span><span class="o">,</span><span class="n">i</span><span class="o">,</span><span class="n">d</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">u</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">fold</span> <span class="o">(</span><span class="k">fun</span> <span class="n">k</span> <span class="n">v</span> <span class="n">b</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span><span class="n">v</span><span class="o">)::</span><span class="n">b</span><span class="o">)</span> <span class="n">count</span> <span class="bp">[]</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">i</span><span class="o">,</span><span class="n">d</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">partition</span><span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">snd</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">)</span> <span class="n">u</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">vo</span> <span class="n">l</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="n">fst</span> <span class="n">l</span> <span class="k">in</span>
  <span class="o">(</span><span class="n">vo</span> <span class="n">u</span><span class="o">),(</span><span class="n">vo</span> <span class="n">i</span><span class="o">),(</span><span class="n">vo</span> <span class="n">d</span><span class="o">);;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN197"
>Appending One Array to Another</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c">(* For lists, use the @ operator for two lists, or List.concat for a list of</span>
<span class="c"> * lists, for arrays, use Array.append for two arrays, or Array.concat for a</span>
<span class="c"> * list of arrays*)</span>

<span class="k">let</span> <span class="n">list1</span> <span class="o">=</span> <span class="n">list1</span> <span class="o">@</span> <span class="n">list2</span><span class="o">;;</span>
<span class="k">let</span> <span class="n">array1</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">append</span> <span class="n">array1</span> <span class="n">array2</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">members</span> <span class="o">=</span> <span class="o">[|</span> <span class="s2">&quot;Time&quot;</span><span class="o">;</span> <span class="s2">&quot;Flies&quot;</span> <span class="o">|];;</span>
<span class="k">let</span> <span class="n">initiates</span> <span class="o">=</span> <span class="o">[|</span> <span class="s2">&quot;An&quot;</span><span class="o">;</span> <span class="s2">&quot;Arrow&quot;</span> <span class="o">|];;</span>
<span class="k">let</span> <span class="n">members</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">append</span> <span class="n">members</span> <span class="n">initiates</span><span class="o">;;</span>

<span class="c">(* It is easiest to write a splice workalike and then just use the new function</span>
<span class="c"> * much like in Perl *)</span>

<span class="k">let</span> <span class="n">splice</span> <span class="o">?</span><span class="n">length</span> <span class="o">?</span><span class="kt">list</span> <span class="n">arr</span> <span class="n">off</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">len</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">arr</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">off</span> <span class="o">=</span> <span class="k">if</span> <span class="n">off</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="n">len</span> <span class="o">+</span> <span class="n">off</span> <span class="k">else</span> <span class="n">off</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">l</span><span class="o">,</span><span class="n">back</span> <span class="o">=</span>
    <span class="k">match</span> <span class="n">length</span> <span class="k">with</span>
      <span class="nc">None</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="n">len</span> <span class="o">-</span> <span class="n">off</span><span class="o">),[||]</span>
    <span class="o">|</span> <span class="nc">Some</span> <span class="n">l</span> <span class="o">-&gt;</span>
        <span class="n">l</span><span class="o">,</span>
        <span class="o">(</span><span class="k">let</span> <span class="n">boff</span> <span class="o">=</span> <span class="n">off</span> <span class="o">+</span> <span class="n">l</span> <span class="k">in</span>
        <span class="k">try</span> <span class="nn">Array</span><span class="p">.</span><span class="n">sub</span> <span class="n">arr</span> <span class="n">boff</span> <span class="o">(</span><span class="n">len</span> <span class="o">-</span> <span class="n">boff</span><span class="o">)</span>  <span class="k">with</span> <span class="nc">Invalid_argument</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="o">[||])</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">front</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">sub</span> <span class="n">arr</span> <span class="mi">0</span> <span class="n">off</span>
  <span class="ow">and</span> <span class="n">mid</span> <span class="o">=</span>
    <span class="k">match</span> <span class="kt">list</span> <span class="k">with</span>
      <span class="nc">None</span> <span class="o">-&gt;</span> <span class="o">[||]</span>
    <span class="o">|</span> <span class="nc">Some</span> <span class="n">a</span> <span class="o">-&gt;</span> <span class="n">a</span>
  <span class="ow">and</span> <span class="n">sp</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">sub</span> <span class="n">arr</span> <span class="n">off</span> <span class="n">l</span> <span class="k">in</span>
  <span class="n">sp</span><span class="o">,</span><span class="nn">Array</span><span class="p">.</span><span class="n">concat</span> <span class="o">[</span><span class="n">front</span><span class="o">;</span><span class="n">mid</span><span class="o">;</span><span class="n">back</span><span class="o">];;</span>

<span class="k">let</span> <span class="o">_,</span><span class="n">members</span> <span class="o">=</span>
  <span class="n">splice</span> <span class="n">members</span> <span class="mi">2</span> <span class="o">~</span><span class="n">length</span><span class="o">:</span><span class="mi">0</span> <span class="o">~</span><span class="kt">list</span><span class="o">:(</span><span class="nn">Array</span><span class="p">.</span><span class="n">append</span> <span class="o">[|</span><span class="s2">&quot;Like&quot;</span><span class="o">|]</span> <span class="n">initiates</span><span class="o">);;</span>
<span class="nn">Array</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="n">printf</span> <span class="s2">&quot;%s &quot;</span><span class="o">)</span> <span class="n">members</span><span class="o">;</span> <span class="n">print_newline</span> <span class="bp">()</span><span class="o">;;</span>

<span class="k">let</span> <span class="o">_,</span><span class="n">members</span> <span class="o">=</span> <span class="n">splice</span> <span class="n">members</span> <span class="mi">0</span> <span class="o">~</span><span class="n">length</span><span class="o">:</span><span class="mi">1</span> <span class="o">~</span><span class="kt">list</span><span class="o">:[|</span><span class="s2">&quot;Fruit&quot;</span><span class="o">|];;</span>
<span class="k">let</span> <span class="o">_,</span><span class="n">members</span> <span class="o">=</span> <span class="n">splice</span> <span class="n">members</span> <span class="o">(-</span><span class="mi">2</span><span class="o">)</span> <span class="o">~</span><span class="n">length</span><span class="o">:</span><span class="mi">2</span> <span class="o">~</span><span class="kt">list</span><span class="o">:[|</span><span class="s2">&quot;A&quot;</span><span class="o">;</span> <span class="s2">&quot;Banana&quot;</span><span class="o">|];;</span>
<span class="nn">Array</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="n">printf</span> <span class="s2">&quot;%s &quot;</span><span class="o">)</span> <span class="n">members</span><span class="o">;</span> <span class="n">print_newline</span> <span class="bp">()</span><span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN200"
>Reversing an Array</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c">(* To reverse a list, use List.rev *)</span>
<span class="k">let</span> <span class="n">reversed</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">rev</span> <span class="n">l</span><span class="o">;;</span>

<span class="c">(* For an array, it is probably easiest to use Array.init *)</span>

<span class="k">let</span> <span class="n">revArray</span> <span class="n">a</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">len</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">a</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">in</span>
  <span class="nn">Array</span><span class="p">.</span><span class="n">init</span> <span class="n">len</span><span class="o">+</span><span class="mi">1</span> <span class="o">(</span><span class="k">fun</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">a</span><span class="o">.(</span><span class="n">len</span> <span class="o">-</span> <span class="n">i</span><span class="o">);;</span>

<span class="k">let</span> <span class="n">reversed</span> <span class="o">=</span> <span class="n">revArray</span> <span class="n">a</span><span class="o">;;</span>

<span class="c">(* Or one can use a for loop *)</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">a</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">downto</span> <span class="mi">0</span> <span class="k">do</span>
  <span class="c">(* Do something to a.(i) *)</span>
<span class="k">done</span><span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN203"
>Processing Multiple Elements of an Array</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c">(* To remove multiple elements from an array at once, one can use the splice</span>
<span class="c"> * function from section 4.9 *)</span>

<span class="c">(* Remove n elements from the front of arr *)</span>
<span class="n">front</span><span class="o">,</span><span class="n">arr</span> <span class="o">=</span> <span class="n">splice</span> <span class="n">arr</span> <span class="mi">0</span> <span class="o">~</span><span class="n">length</span><span class="o">:</span><span class="n">n</span><span class="o">;;</span>
<span class="n">rear</span><span class="o">,</span><span class="n">arr</span> <span class="o">=</span> <span class="n">splice</span> <span class="n">arr</span> <span class="o">(-</span><span class="n">n</span><span class="o">);;</span>

<span class="c">(* this can also be wrapped as an explicit function *)</span>

<span class="k">let</span> <span class="n">shift2</span> <span class="n">a</span> <span class="o">=</span> <span class="n">splice</span> <span class="n">a</span> <span class="mi">0</span> <span class="o">~</span><span class="n">length</span><span class="o">:</span><span class="mi">2</span><span class="o">;;</span>
<span class="k">let</span> <span class="n">pop2</span> <span class="n">a</span> <span class="o">=</span> <span class="n">splice</span> <span class="n">a</span> <span class="o">(-</span><span class="mi">2</span><span class="o">);;</span>

<span class="c">(* This lets you do something like Perl&#39;s hinkey pattern matching *)</span>
<span class="k">let</span> <span class="n">friends</span> <span class="o">=</span> <span class="o">[|</span><span class="s2">&quot;Peter&quot;</span><span class="o">;</span> <span class="s2">&quot;Paul&quot;</span><span class="o">;</span> <span class="s2">&quot;Mary&quot;</span><span class="o">;</span> <span class="s2">&quot;Jim&quot;</span><span class="o">;</span> <span class="s2">&quot;Tim&quot;</span> <span class="o">|];;</span>
<span class="k">let</span> <span class="o">[|</span><span class="n">this</span><span class="o">;</span> <span class="n">that</span><span class="o">|],</span><span class="n">friends</span> <span class="o">=</span> <span class="n">shift2</span> <span class="n">friends</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">beverages</span> <span class="o">=</span> <span class="o">[|</span><span class="s2">&quot;Dew&quot;</span><span class="o">;</span> <span class="s2">&quot;Jolt&quot;</span><span class="o">;</span> <span class="s2">&quot;Cola&quot;</span><span class="o">;</span> <span class="s2">&quot;Sprite&quot;</span><span class="o">;</span> <span class="s2">&quot;Fresca&quot;</span><span class="o">|];;;</span>
<span class="k">let</span> <span class="n">pair</span><span class="o">,</span><span class="n">beverages</span> <span class="o">=</span>  <span class="n">pop2</span> <span class="n">beverages</span><span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN206"
>Finding the First List Element That Passes a Test</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c">(* To find the first element in a list that satisfies some predicate, just use</span>
<span class="c"> * the List.find function to return an &#39;a option *)</span>

<span class="k">match</span>
  <span class="o">(</span><span class="k">try</span> <span class="nc">Some</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">find</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">)</span> <span class="n">l</span><span class="o">)</span>
  <span class="k">with</span> <span class="nc">Not_found</span> <span class="o">-&gt;</span> <span class="nc">None</span><span class="o">)</span>
<span class="k">with</span>
    <span class="nc">None</span> <span class="o">-&gt;</span> <span class="c">(* unfound *)</span>
  <span class="o">|</span> <span class="nc">Some</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="c">(* Do something with x *)</span><span class="o">;;</span>

<span class="c">(* Note that this is a very general form, and can be shortened in some cases *)</span>
<span class="k">let</span> <span class="n">pf</span> <span class="n">l</span> <span class="o">=</span>
  <span class="k">try</span>
    <span class="n">printf</span> <span class="s2">&quot;hah! Found %d!</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">find</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">)</span> <span class="n">l</span><span class="o">)</span>
  <span class="k">with</span>
    <span class="nc">Not_found</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sorry charly!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">;;</span>

<span class="c">(*</span>
<span class="c"># pf [1;2;3;4;5;6];;</span>
<span class="c">Sorry charly!</span>

<span class="c"># pf [1;2;3;50;100];;</span>
<span class="c">Hah!  Found 50!</span>
<span class="c">*)</span>

<span class="c">(* To return the index of a matching element in an array, we can use exceptions</span>
<span class="c"> * to short circuit the search *)</span>

<span class="k">exception</span> <span class="nc">Found</span> <span class="k">of</span> <span class="kt">int</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">findi</span> <span class="n">pred</span> <span class="n">arr</span> <span class="o">=</span>
  <span class="nn">Array</span><span class="p">.</span><span class="n">iteri</span> <span class="o">(</span><span class="k">fun</span> <span class="n">i</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="n">pred</span> <span class="n">x</span> <span class="k">then</span> <span class="k">raise</span> <span class="o">(</span><span class="nc">Found</span> <span class="n">i</span><span class="o">))</span> <span class="n">arr</span><span class="o">;</span>
  <span class="k">raise</span> <span class="nc">Not_found</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">f</span> <span class="n">arr</span> <span class="o">=</span>
<span class="k">try</span>
  <span class="n">findi</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">)</span> <span class="n">arr</span>
<span class="k">with</span>
  <span class="nc">Found</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">printf</span> <span class="s2">&quot;element %d is a big element - %d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">i</span> <span class="n">arr</span><span class="o">.(</span><span class="n">i</span><span class="o">)</span>
<span class="o">|</span> <span class="nc">Not_found</span> <span class="o">-&gt;</span> <span class="n">printf</span> <span class="s2">&quot;Only small values here!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">;;</span>

<span class="c">(*</span>
<span class="c"># f [|1; 2; 3; 4; 5; 6|];;</span>
<span class="c">Only small values here!</span>

<span class="c"># f [|1; 2; 3; 4; 5; 60; 8; 9; 100|];;</span>
<span class="c">element 5 is a big element - 60</span>
<span class="c">*)</span>

<span class="k">let</span> <span class="n">highest_engineer</span> <span class="o">=</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">find</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">#</span><span class="n">category</span> <span class="o">=</span> <span class="s2">&quot;engineer&quot;</span><span class="o">)</span> <span class="n">employees</span> <span class="k">in</span>
  <span class="n">printf</span> <span class="s2">&quot;Highest paid engineer is: %s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">highest_engineer</span><span class="o">#</span><span class="n">name</span><span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN209"
>Finding All Elements in an Array Matching Certain Criteria</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c">(* to find all elements of a list that satisfy a certain predicate, just use the</span>
<span class="c"> * List.find_all function *)</span>

<span class="k">let</span> <span class="n">matching</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">find_all</span> <span class="o">(</span> <span class="c">(* predicate *)</span> <span class="n">l</span><span class="o">;;</span>

<span class="c">(* for an array, it&#39;s likely easiest to convert the original array to a list,</span>
<span class="c"> * use List.find_all, and convert that list into an array *)</span>
<span class="k">let</span> <span class="n">matching</span> <span class="o">=</span>
  <span class="nn">Array</span><span class="p">.</span><span class="n">ofList</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">find_all</span> <span class="o">(</span> <span class="c">(*predicate *)</span> <span class="o">)</span> <span class="o">(</span><span class="nn">Array</span><span class="p">.</span><span class="n">to_list</span> <span class="n">a</span><span class="o">));;</span>

<span class="c">(* the next example requires use of the Str library, which must be linked in.</span>
<span class="c"> * In the toplevel environment use `#load &quot;str.cma&quot;&#39; *)</span>

<span class="k">let</span> <span class="n">bigs</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">find_all</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1000000</span><span class="o">)</span> <span class="n">nums</span><span class="o">;;</span>
<span class="k">let</span> <span class="n">pigs</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">find_all</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="nn">Hashtbl</span><span class="p">.</span><span class="n">find</span> <span class="n">users</span> <span class="n">x</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mf">1e7</span><span class="o">)</span>
            <span class="o">(</span><span class="nn">Hashtbl</span><span class="p">.</span><span class="n">fold</span> <span class="o">(</span><span class="k">fun</span> <span class="n">k</span> <span class="n">v</span> <span class="n">b</span> <span class="o">-&gt;</span> <span class="n">k</span><span class="o">::</span><span class="n">b</span><span class="o">)</span> <span class="n">users</span> <span class="bp">[]</span><span class="o">);;</span>

<span class="k">let</span> <span class="n">matching</span> <span class="o">=</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">find_all</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="nn">Str</span><span class="p">.</span><span class="n">string_match</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="s2">&quot;gnat&quot;</span><span class="o">)</span> <span class="n">x</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">who</span> <span class="bp">()</span><span class="o">);;</span>

<span class="k">let</span> <span class="n">engineers</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">find_all</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">#</span><span class="n">position</span> <span class="o">=</span> <span class="s2">&quot;Engineer&quot;</span><span class="o">)</span> <span class="n">employees</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">secondary_assistance</span> <span class="o">=</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">find_all</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">#</span><span class="n">income</span> <span class="o">&gt;=</span> <span class="mi">26000</span> <span class="o">&amp;&amp;</span> <span class="n">x</span><span class="o">#</span><span class="n">income</span> <span class="o">&lt;</span> <span class="mi">30000</span><span class="o">)</span> <span class="n">applicants</span><span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN212"
>Sorting an Array Numerically</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c">(* OCaml is smart enough to figure out if a list is full of numbers or</span>
<span class="c"> * non-numbers, so the polymorphic compare function works just fine *)</span>
<span class="k">let</span> <span class="n">sorted</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">sort</span> <span class="n">compare</span> <span class="n">unsorted</span><span class="o">;;</span>

<span class="c">(* note that Array.sort sorts the given array in place, so unexpected results</span>
<span class="c"> * can occur, e.g.</span>
<span class="c">let sorted = Array.sort compare unsorted;;</span>

<span class="c"> * results in unsorted referring to the now sorted array, and sorted referring</span>
<span class="c"> * to something of type unit *)</span>

<span class="c">(* pids is an unsorted list of process IDs *)</span>
<span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="n">printf</span> <span class="s2">&quot;%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">)</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">sort</span> <span class="n">compare</span> <span class="n">pids</span><span class="o">);;</span>
<span class="n">print_endline</span> <span class="s2">&quot;Select a process ID to kill:&quot;</span><span class="o">;;</span>
<span class="k">let</span> <span class="n">pid</span> <span class="o">=</span> <span class="n">read_int</span> <span class="bp">()</span> <span class="k">in</span>
  <span class="nn">Unix</span><span class="p">.</span><span class="n">kill</span> <span class="n">pid</span> <span class="nn">Sys</span><span class="p">.</span><span class="n">sigterm</span><span class="o">;</span>
  <span class="nn">Unix</span><span class="p">.</span><span class="n">sleep</span> <span class="mi">2</span><span class="o">;</span>
  <span class="nn">Unix</span><span class="p">.</span><span class="n">kill</span> <span class="n">pid</span> <span class="nn">Sys</span><span class="p">.</span><span class="n">sigterm</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">descending</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">sort</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="n">compare</span> <span class="n">y</span> <span class="n">x</span><span class="o">)</span> <span class="n">unsorted</span><span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN215"
>Sorting a List by Computable Field</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">(* since compare orders tuples by first comparing the first slot then, if they</span>
<span class="c"> * were equal, comparing the second slot, and so on, we can sort by computable</span>
<span class="c"> * fields as follows *)</span>

<span class="k">let</span> <span class="n">sorted</span> <span class="o">=</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="n">snd</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">sort</span> <span class="n">compare</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span><span class="o">-&gt;</span> <span class="o">(</span><span class="n">compute</span> <span class="n">x</span><span class="o">),</span><span class="n">x</span><span class="o">)</span> <span class="n">unsorted</span><span class="o">));;</span>

<span class="k">let</span> <span class="n">ordered</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">sort</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="n">compare</span> <span class="n">x</span><span class="o">#</span><span class="n">name</span> <span class="n">y</span><span class="o">#</span><span class="n">name</span><span class="o">)</span> <span class="n">employees</span><span class="o">;;</span>
<span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">printf</span> <span class="s2">&quot;%s earns $%2f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">x</span><span class="o">#</span><span class="n">name</span> <span class="n">x</span><span class="o">#</span><span class="n">salary</span><span class="o">)</span>
  <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">sort</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="n">compare</span> <span class="n">x</span><span class="o">#</span><span class="n">name</span> <span class="n">y</span><span class="o">#</span><span class="n">name</span><span class="o">)</span> <span class="n">employees</span><span class="o">);;</span>

<span class="k">let</span> <span class="n">sorted_employees</span> <span class="o">=</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="n">snd</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">sort</span> <span class="n">compare</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span><span class="o">-&gt;</span> <span class="o">(</span><span class="n">compute</span> <span class="n">x</span><span class="o">),</span><span class="n">x</span><span class="o">)</span> <span class="n">unsorted</span><span class="o">))</span> <span class="k">in</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">printf</span> <span class="s2">&quot;%s earns $%2f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">x</span><span class="o">#</span><span class="n">name</span> <span class="n">x</span><span class="o">#</span><span class="n">salary</span><span class="o">)</span> <span class="n">sorted_employees</span><span class="o">;</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">iter</span>
    <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">mem</span> <span class="n">bonus</span> <span class="n">x</span><span class="o">#</span><span class="n">ssn</span> <span class="k">then</span> <span class="n">printf</span> <span class="s2">&quot;%s got a bonus!</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">x</span><span class="o">#</span><span class="n">name</span><span class="o">)</span>
    <span class="n">sorted_employees</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">sorted</span> <span class="o">=</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">sort</span>
    <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">y</span> <span class="o">-&gt;</span>
      <span class="k">match</span> <span class="n">compare</span> <span class="n">x</span><span class="o">#</span><span class="n">name</span> <span class="n">y</span><span class="o">#</span><span class="n">name</span> <span class="k">with</span>
        <span class="mi">0</span> <span class="o">-&gt;</span> <span class="n">compare</span> <span class="n">x</span><span class="o">#</span><span class="n">age</span> <span class="n">y</span><span class="o">#</span><span class="n">age</span>
      <span class="o">|</span> <span class="n">c</span> <span class="o">-&gt;</span> <span class="n">c</span><span class="o">)</span>
    <span class="n">employees</span><span class="o">;;</span>

<span class="c">(* Assuming we have a getpwent function that returns a value of type users, or</span>
<span class="c"> * throws an End_of_file exception when done (not sure what getpwent is supposed</span>
<span class="c"> * to do), then we can write *)</span>

<span class="k">let</span> <span class="n">getUsers</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">l</span> <span class="o">=</span> <span class="n">ref</span> <span class="bp">[]</span> <span class="k">in</span>
  <span class="k">try</span>
    <span class="k">while</span> <span class="bp">true</span> <span class="k">do</span>
      <span class="n">l</span> <span class="o">:=</span> <span class="o">(</span><span class="n">getpwent</span> <span class="bp">()</span><span class="o">)::!</span><span class="n">l</span>
    <span class="k">done</span>
  <span class="k">with</span> <span class="nc">End_of_file</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">l</span><span class="o">;;</span>

<span class="nn">List</span><span class="p">.</span><span class="n">iter</span>
  <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">print_endline</span> <span class="n">x</span><span class="o">#</span><span class="n">name</span><span class="o">)</span>
  <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">sort</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="n">compare</span> <span class="n">x</span><span class="o">#</span><span class="n">name</span> <span class="n">y</span><span class="o">#</span><span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">getUsers</span> <span class="bp">()</span><span class="o">));;</span>

<span class="k">let</span> <span class="n">sorted</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">sort</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="n">compare</span> <span class="n">x</span><span class="o">.[</span><span class="mi">1</span><span class="o">]</span> <span class="n">y</span><span class="o">.[</span><span class="mi">1</span><span class="o">])</span> <span class="n">strings</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">sorted</span> <span class="o">=</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="n">snd</span>
    <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">sort</span> <span class="n">compare</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">x</span><span class="o">),</span><span class="n">x</span><span class="o">)</span> <span class="n">strings</span><span class="o">));;</span>

<span class="k">let</span> <span class="n">sorted_fields</span> <span class="o">=</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="n">snd</span>
    <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">sort</span> <span class="n">compare</span>
      <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">map</span>
        <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span>
          <span class="o">(</span><span class="k">try</span>
            <span class="n">ignore</span><span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">search_forward</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="s2">&quot;[0-9]+&quot;</span><span class="o">)</span> <span class="n">x</span> <span class="mi">0</span><span class="o">);</span>
            <span class="n">int_of_string</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">matched_string</span> <span class="n">x</span><span class="o">)</span>
          <span class="k">with</span> <span class="nc">Not_found</span> <span class="o">-&gt;</span> <span class="n">max_int</span><span class="o">),</span><span class="n">x</span><span class="o">)</span>
        <span class="n">strings</span><span class="o">));;</span>

<span class="k">let</span> <span class="n">passwd</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">w</span> <span class="o">=</span> <span class="nn">Unix</span><span class="p">.</span><span class="n">open_process_in</span> <span class="s2">&quot;cat /etc/passwd&quot;</span>
  <span class="ow">and</span> <span class="n">l</span> <span class="o">=</span> <span class="n">ref</span> <span class="bp">[]</span> <span class="k">in</span>
  <span class="k">try</span>
    <span class="k">while</span> <span class="bp">true</span> <span class="k">do</span>
      <span class="n">l</span> <span class="o">:=</span> <span class="o">(</span><span class="n">input_line</span> <span class="n">w</span><span class="o">)::!</span><span class="n">l</span>
	<span class="k">done</span><span class="o">;</span>
	<span class="o">!</span><span class="n">l</span>
  <span class="k">with</span> <span class="nc">End_of_file</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">l</span><span class="o">;;</span>

<span class="c">(* for illustration purposes, we provide a function to return the (non-comment)</span>
<span class="c"> * contents of /etc/passwd *)</span>
<span class="k">let</span> <span class="n">passwd</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">w</span> <span class="o">=</span> <span class="nn">Unix</span><span class="p">.</span><span class="n">open_process_in</span> <span class="s2">&quot;cat /etc/passwd&quot;</span>
  <span class="ow">and</span> <span class="n">l</span> <span class="o">=</span> <span class="n">ref</span> <span class="bp">[]</span> <span class="k">in</span>
  <span class="k">try</span>
    <span class="k">while</span> <span class="bp">true</span> <span class="k">do</span>
      <span class="n">l</span> <span class="o">:=</span> <span class="o">(</span><span class="n">input_line</span> <span class="n">w</span><span class="o">)::!</span><span class="n">l</span>
	<span class="k">done</span><span class="o">;</span>
	<span class="o">!</span><span class="n">l</span>
  <span class="k">with</span> <span class="nc">End_of_file</span> <span class="o">-&gt;</span>
    <span class="nn">List</span><span class="p">.</span><span class="n">filter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">.[</span><span class="mi">0</span><span class="o">]</span> <span class="o">&lt;&gt;</span> <span class="sc">&#39;#&#39;</span><span class="o">)</span> <span class="o">!</span><span class="n">l</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">sortedPasswd</span> <span class="o">=</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="nc">Some</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">snd</span> <span class="n">x</span><span class="o">)</span>
  <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">sort</span> <span class="n">compare</span>
   <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">filter</span> <span class="o">(</span><span class="k">function</span> <span class="nc">Some</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="bp">true</span> <span class="o">|</span> <span class="nc">None</span> <span class="o">-&gt;</span> <span class="bp">false</span><span class="o">)</span>
    <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">map</span>
      <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span>
        <span class="k">match</span> <span class="nn">Str</span><span class="p">.</span><span class="n">split</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="s2">&quot;:&quot;</span><span class="o">)</span> <span class="n">x</span> <span class="k">with</span>
          <span class="n">name</span><span class="o">::_::</span><span class="n">uid</span><span class="o">::</span><span class="n">gid</span><span class="o">::</span><span class="n">t</span> <span class="o">-&gt;</span> <span class="nc">Some</span> <span class="o">((</span><span class="n">gid</span><span class="o">,</span><span class="n">uid</span><span class="o">,</span><span class="n">name</span><span class="o">),</span><span class="n">x</span><span class="o">)</span>
        <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="nc">None</span><span class="o">)</span>
     <span class="o">(</span><span class="n">passwd</span> <span class="bp">()</span><span class="o">))));;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN218"
>Implementing a Circular List</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c">(* To get a true circular list, one can use the let rec construct *)</span>

<span class="k">let</span> <span class="k">rec</span> <span class="n">processes</span> <span class="o">=</span> <span class="mi">1</span><span class="o">::</span><span class="mi">2</span><span class="o">::</span><span class="mi">3</span><span class="o">::</span><span class="mi">4</span><span class="o">::</span><span class="mi">5</span><span class="o">::</span><span class="n">processes</span><span class="o">;;</span>
<span class="k">while</span> <span class="bp">true</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">process</span><span class="o">::</span><span class="n">processes</span> <span class="o">=</span> <span class="n">process</span> <span class="k">in</span>
  <span class="n">printf</span> <span class="s2">&quot;Handling process %d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">process</span><span class="o">;</span>
  <span class="nn">Unix</span><span class="p">.</span><span class="n">sleep</span> <span class="mi">2</span><span class="o">;</span>
<span class="k">done</span><span class="o">;;</span>

<span class="c">(* or one can use these somewhat inefficient functions to simulate the Perl</span>
<span class="c"> * examples *)</span>

<span class="k">let</span> <span class="n">popleft</span> <span class="n">l</span> <span class="o">=</span>
  <span class="k">match</span> <span class="n">l</span> <span class="k">with</span>
    <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="k">raise</span> <span class="nc">Not_found</span>
  <span class="o">|</span> <span class="n">h</span><span class="o">::</span><span class="n">t</span> <span class="o">-&gt;</span> <span class="n">h</span><span class="o">,(</span><span class="n">t</span> <span class="o">@</span> <span class="o">[</span><span class="n">h</span><span class="o">]);;</span>

<span class="k">let</span> <span class="n">popright</span> <span class="n">l</span> <span class="o">=</span>
  <span class="k">match</span> <span class="nn">List</span><span class="p">.</span><span class="n">rev</span> <span class="n">l</span> <span class="k">with</span>
    <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="k">raise</span> <span class="nc">Not_found</span>
  <span class="o">|</span> <span class="n">h</span><span class="o">::</span><span class="n">t</span> <span class="o">-&gt;</span> <span class="n">h</span><span class="o">,(</span><span class="n">h</span><span class="o">::(</span><span class="nn">List</span><span class="p">.</span><span class="n">rev</span> <span class="n">t</span><span class="o">));;</span>

<span class="k">let</span> <span class="n">processes</span> <span class="o">=</span> <span class="n">ref</span> <span class="o">[</span><span class="mi">1</span><span class="o">;</span><span class="mi">2</span><span class="o">;</span><span class="mi">3</span><span class="o">;</span><span class="mi">4</span><span class="o">;</span><span class="mi">5</span><span class="o">];;</span>
<span class="k">while</span> <span class="bp">true</span> <span class="k">do</span>
  <span class="k">let</span> <span class="n">process</span><span class="o">,</span><span class="n">np</span> <span class="o">=</span> <span class="n">popleft</span> <span class="o">!</span><span class="n">processes</span> <span class="k">in</span>
  <span class="n">processes</span> <span class="o">:=</span> <span class="n">np</span><span class="o">;</span>
  <span class="n">printf</span> <span class="s2">&quot;Handling process %d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">process</span><span class="o">;</span>
  <span class="n">flush_all</span> <span class="bp">()</span><span class="o">;</span>
  <span class="nn">Unix</span><span class="p">.</span><span class="n">sleep</span> <span class="mi">1</span><span class="o">;</span>
<span class="k">done</span><span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN221"
>Randomizing an Array</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="k">let</span> <span class="n">fisher_yates_shuffle</span> <span class="n">a</span> <span class="o">=</span>
  <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">a</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">downto</span> <span class="mi">1</span> <span class="k">do</span>
    <span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="o">.(</span><span class="n">i</span><span class="o">)</span>
    <span class="ow">and</span> <span class="n">r</span> <span class="o">=</span> <span class="nn">Random</span><span class="p">.</span><span class="n">int</span> <span class="o">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">)</span> <span class="k">in</span>
    <span class="n">a</span><span class="o">.(</span><span class="n">i</span><span class="o">)</span> <span class="o">&lt;-</span> <span class="n">a</span><span class="o">.(</span><span class="n">r</span><span class="o">);</span>
    <span class="n">a</span><span class="o">.(</span><span class="n">r</span><span class="o">)</span> <span class="o">&lt;-</span> <span class="n">x</span><span class="o">;</span>
  <span class="k">done</span><span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN224"
>Program: words</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c">(* Assuming we start with a list of all the data called data, and assuming we</span>
<span class="c"> * already have the curent number of screen columns in a variable cols *)</span>

<span class="k">let</span> <span class="n">words</span> <span class="n">data</span> <span class="n">cols</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">strippedData</span> <span class="o">=</span>
    <span class="nn">Array</span><span class="p">.</span><span class="n">of_list</span>
      <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">replace_first</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="s2">&quot;[ </span><span class="se">\t\n</span><span class="s2">]+$&quot;</span><span class="o">)</span> <span class="s2">&quot;&quot;</span><span class="o">)</span> <span class="n">data</span><span class="o">)</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">maxlen</span> <span class="o">=</span>
    <span class="o">(</span><span class="nn">Array</span><span class="p">.</span><span class="n">fold_left</span> <span class="o">(</span><span class="k">fun</span> <span class="n">m</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="n">max</span> <span class="n">m</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">s</span><span class="o">))</span> <span class="mi">0</span> <span class="n">strippedData</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">cols</span> <span class="o">=</span> <span class="k">if</span> <span class="n">cols</span> <span class="o">&lt;</span> <span class="n">maxlen</span> <span class="k">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">cols</span> <span class="o">/</span> <span class="n">maxlen</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">rows</span> <span class="o">=</span> <span class="o">((</span><span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">strippedData</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">+</span> <span class="n">cols</span><span class="o">)/</span><span class="n">cols</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">bufs</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">init</span> <span class="n">rows</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="nn">Buffer</span><span class="p">.</span><span class="n">create</span> <span class="o">(</span><span class="n">cols</span> <span class="o">*</span> <span class="n">maxlen</span><span class="o">))</span> <span class="k">in</span>
  <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">to</span> <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">strippedData</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
    <span class="k">let</span> <span class="n">dst</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">make</span> <span class="n">maxlen</span> <span class="sc">&#39; &#39;</span>
    <span class="ow">and</span> <span class="n">src</span> <span class="o">=</span> <span class="n">strippedData</span><span class="o">.(</span><span class="n">i</span><span class="o">)</span> <span class="k">in</span>
    <span class="nn">String</span><span class="p">.</span><span class="n">blit</span> <span class="n">src</span> <span class="mi">0</span> <span class="n">dst</span> <span class="mi">0</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">src</span><span class="o">);</span>
    <span class="nn">Buffer</span><span class="p">.</span><span class="n">add_string</span> <span class="n">bufs</span><span class="o">.(</span><span class="n">i</span> <span class="ow">mod</span> <span class="n">rows</span><span class="o">)</span> <span class="n">dst</span>
  <span class="k">done</span><span class="o">;</span>
  <span class="nn">Array</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">print_endline</span> <span class="o">(</span><span class="nn">Buffer</span><span class="p">.</span><span class="n">contents</span> <span class="n">x</span><span class="o">))</span> <span class="n">bufs</span><span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN227"
>Program: permute</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c">(* Note: This routine uses the splice routine written in section 4.9 *)</span>

<span class="k">let</span> <span class="n">tsc_permute</span> <span class="n">arr</span> <span class="o">=</span>
  <span class="k">if</span> <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">arr</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="n">print_endline</span> <span class="s2">&quot;Perms:&quot;</span><span class="o">;</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">permute</span> <span class="n">arr</span> <span class="n">perms</span> <span class="o">=</span>
    <span class="k">match</span> <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">arr</span> <span class="k">with</span>
      <span class="mi">0</span> <span class="o">-&gt;</span> <span class="nn">Array</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="n">printf</span> <span class="s2">&quot;%s &quot;</span><span class="o">)</span> <span class="n">perms</span><span class="o">;</span> <span class="n">print_newline</span> <span class="bp">()</span><span class="o">;</span>
    <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">to</span> <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">arr</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
          <span class="k">let</span> <span class="n">v</span><span class="o">,</span><span class="n">ni</span> <span class="o">=</span> <span class="n">splice</span> <span class="n">arr</span> <span class="n">i</span> <span class="o">~</span><span class="n">length</span><span class="o">:</span><span class="mi">1</span> <span class="k">in</span>
          <span class="n">permute</span> <span class="n">ni</span> <span class="o">(</span><span class="nn">Array</span><span class="p">.</span><span class="n">append</span> <span class="n">v</span> <span class="n">perms</span><span class="o">);</span>
        <span class="k">done</span> <span class="k">in</span>
  <span class="n">permute</span> <span class="n">arr</span> <span class="o">[||];;</span>

<span class="c">(* Note: This example is going to permute the words of a given string - also, I</span>
<span class="c"> * don&#39;t feel like bringing in the BigInt module, so we will trim any array</span>
<span class="c"> * longer than 12 elements down to 12 before permuting *)</span>

<span class="k">let</span> <span class="n">fact</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">append</span> <span class="o">[|</span><span class="nc">Some</span> <span class="mi">1</span><span class="o">|]</span> <span class="o">(</span><span class="nn">Array</span><span class="p">.</span><span class="n">make</span> <span class="mi">11</span> <span class="nc">None</span><span class="o">);;</span>
<span class="k">let</span> <span class="k">rec</span> <span class="n">factorial</span> <span class="n">n</span> <span class="o">=</span>
  <span class="k">match</span> <span class="n">fact</span><span class="o">.(</span><span class="n">n</span><span class="o">)</span> <span class="k">with</span>
    <span class="nc">Some</span> <span class="n">f</span> <span class="o">-&gt;</span> <span class="n">f</span>
  <span class="o">|</span> <span class="nc">None</span> <span class="o">-&gt;</span> <span class="k">let</span> <span class="n">f</span> <span class="o">=</span> <span class="n">n</span><span class="o">*(</span><span class="n">factorial</span> <span class="o">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="o">))</span> <span class="k">in</span> <span class="n">fact</span><span class="o">.(</span><span class="n">n</span><span class="o">)</span> <span class="o">&lt;-</span> <span class="nc">Some</span> <span class="n">f</span><span class="o">;</span> <span class="n">f</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">n2pat</span> <span class="n">n</span> <span class="n">len</span> <span class="o">=</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">nh</span> <span class="n">n</span> <span class="n">i</span> <span class="n">pat</span> <span class="o">=</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">len</span><span class="o">+</span><span class="mi">1</span> <span class="k">then</span> <span class="n">pat</span>
    <span class="k">else</span>
      <span class="n">nh</span> <span class="o">(</span><span class="n">n</span><span class="o">/</span><span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">((</span><span class="n">n</span> <span class="ow">mod</span> <span class="n">i</span><span class="o">)::</span><span class="n">pat</span><span class="o">)</span> <span class="k">in</span>
  <span class="n">nh</span> <span class="n">n</span> <span class="mi">1</span> <span class="bp">[]</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">pat2perm</span> <span class="n">pat</span> <span class="o">=</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">ph</span> <span class="n">source</span> <span class="n">pat</span> <span class="n">perm</span> <span class="o">=</span>
    <span class="k">match</span> <span class="n">pat</span> <span class="k">with</span>
      <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">perm</span>
    <span class="o">|</span> <span class="n">h</span><span class="o">::</span><span class="n">t</span> <span class="o">-&gt;</span>
        <span class="k">let</span> <span class="n">v</span><span class="o">,</span><span class="n">s</span> <span class="o">=</span> <span class="n">splice</span> <span class="n">source</span> <span class="n">h</span> <span class="o">~</span><span class="n">length</span><span class="o">:</span><span class="mi">1</span> <span class="k">in</span>
        <span class="n">ph</span> <span class="n">s</span> <span class="n">t</span> <span class="o">(</span><span class="n">v</span><span class="o">.(</span><span class="mi">0</span><span class="o">)::</span><span class="n">perm</span><span class="o">)</span> <span class="k">in</span>
  <span class="nn">Array</span><span class="p">.</span><span class="n">of_list</span> <span class="o">(</span><span class="n">ph</span> <span class="o">(</span><span class="nn">Array</span><span class="p">.</span><span class="n">init</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">length</span> <span class="n">pat</span><span class="o">)</span> <span class="o">(</span><span class="k">fun</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span><span class="o">))</span> <span class="n">pat</span> <span class="bp">[]</span><span class="o">);;</span>

<span class="k">let</span> <span class="n">n2perm</span> <span class="n">n</span> <span class="n">len</span> <span class="o">=</span>
  <span class="n">pat2perm</span> <span class="o">(</span><span class="n">n2pat</span> <span class="n">n</span> <span class="n">len</span><span class="o">);;</span>

<span class="k">let</span> <span class="n">mjd_permute</span> <span class="n">s</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">arr</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">arr</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">of_list</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">split</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="s2">&quot;[ </span><span class="se">\t</span><span class="s2">]+&quot;</span><span class="o">)</span> <span class="n">s</span><span class="o">)</span> <span class="k">in</span>
    <span class="k">try</span>
      <span class="nn">Array</span><span class="p">.</span><span class="n">sub</span> <span class="n">arr</span> <span class="mi">0</span> <span class="mi">12</span>
    <span class="k">with</span> <span class="nc">Invalid_argument</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">arr</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">len</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">arr</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">in</span>
  <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">to</span> <span class="n">factorial</span> <span class="o">(</span><span class="n">len</span><span class="o">+</span><span class="mi">1</span><span class="o">)</span> <span class="k">do</span>
    <span class="k">let</span> <span class="n">perm</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">arr</span><span class="o">.(</span><span class="n">i</span><span class="o">))</span> <span class="o">(</span><span class="n">n2perm</span> <span class="n">i</span> <span class="n">len</span><span class="o">)</span> <span class="k">in</span>
    <span class="nn">Array</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="n">printf</span> <span class="s2">&quot;%s &quot;</span><span class="o">)</span> <span class="n">perm</span><span class="o">;</span> <span class="n">print_newline</span> <span class="bp">()</span><span class="o">;</span>
  <span class="k">done</span><span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="datesandtimes.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="hashes.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Dates and Times</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Hashes</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>