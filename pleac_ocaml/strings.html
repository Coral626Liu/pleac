<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Strings</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Objective CAML "
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="PLEAC-Objective CAML "
HREF="index.html"><LINK
REL="NEXT"
TITLE="Numbers"
HREF="numbers.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Objective CAML </TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="index.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="numbers.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="STRINGS"
>1. Strings</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN14"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">(*---------------------------*)</span>
<span class="k">let</span> <span class="kt">string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span>                  <span class="c">(* two characters, \ and an n*)</span>
<span class="k">let</span> <span class="kt">string</span> <span class="o">=</span> <span class="s2">&quot;Jon &#39;Maddog&#39; Orwant&quot;</span>  <span class="c">(* literal single quotes*)</span>
<span class="c">(*---------------------------*)</span>
<span class="k">let</span> <span class="kt">string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>                     <span class="c">(* a &quot;newline&quot; character *)</span>
<span class="k">let</span> <span class="kt">string</span> <span class="o">=</span> <span class="s2">&quot;Jon </span><span class="se">\&quot;</span><span class="s2">Maddog</span><span class="se">\&quot;</span><span class="s2"> Orwant&quot;</span>  <span class="c">(* literal double quotes *)</span>

<span class="k">let</span> <span class="n">a</span> <span class="o">=</span> <span class="s2">&quot;</span>
<span class="s2">    This is a multiline here document</span>
<span class="s2">    terminated by one  double quote</span>
<span class="s2">    &quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN17"
>Accessing Substrings</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="k">let</span> <span class="k">value</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">sub</span> <span class="kt">string</span> <span class="n">offset</span> <span class="n">count</span>
<span class="k">let</span> <span class="k">value</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">sub</span> <span class="kt">string</span> <span class="n">offset</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="kt">string</span> <span class="o">-</span> <span class="n">offset</span><span class="o">)</span>
<span class="c">(* or *)</span>
<span class="k">let</span> <span class="k">value</span> <span class="o">=</span> <span class="n">sub_end</span> <span class="kt">string</span> <span class="n">offset</span>
<span class="c">(* using *)</span>
<span class="k">let</span> <span class="n">sub_end</span> <span class="kt">string</span> <span class="n">offset</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">sub</span> <span class="kt">string</span> <span class="n">offset</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="kt">string</span> <span class="o">-</span> <span class="n">offset</span><span class="o">)</span>

<span class="c">(*-----------------------------*)</span>
<span class="c">(* get a 5-byte string, skip 3, then grab 2 8-byte strings, then the rest*)</span>

<span class="c">(* split at &#39;sz&#39; byte boundaries *)</span>
<span class="k">let</span> <span class="k">rec</span> <span class="n">split_every_n_chars</span> <span class="n">sz</span> <span class="o">=</span> <span class="k">function</span>
  <span class="o">|</span> <span class="s2">&quot;&quot;</span> <span class="o">-&gt;</span> <span class="bp">[]</span>
  <span class="o">|</span> <span class="n">s</span> <span class="o">-&gt;</span>
      <span class="k">try</span>
	<span class="k">let</span> <span class="o">(</span><span class="n">beg</span><span class="o">,</span> <span class="n">rest</span><span class="o">)</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">sub</span> <span class="n">s</span> <span class="mi">0</span> <span class="n">sz</span><span class="o">,</span> <span class="n">sub_end</span> <span class="n">s</span> <span class="n">sz</span> <span class="k">in</span>
	<span class="n">beg</span> <span class="o">::</span> <span class="n">split_every_n_chars</span> <span class="n">sz</span> <span class="n">rest</span>
      <span class="k">with</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="o">[</span><span class="n">s</span><span class="o">]</span>

<span class="k">let</span> <span class="n">fivers</span> <span class="o">=</span> <span class="n">split_every_n_chars</span> <span class="mi">5</span> <span class="kt">string</span>

<span class="c">(* chop string into individual characters *)</span>
<span class="k">let</span> <span class="n">chars</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">.[</span><span class="mi">0</span><span class="o">])</span> <span class="o">(</span><span class="n">split_every_n_chars</span> <span class="mi">1</span> <span class="kt">string</span><span class="o">)</span>

<span class="c">(*-----------------------------*)</span>
<span class="k">let</span> <span class="kt">string</span> <span class="o">=</span> <span class="s2">&quot;This is what you have&quot;</span><span class="o">;;</span>
<span class="c">(* Indexes are left to right. There is no possibility to index *)</span>
<span class="c">(* directly from right to left *)</span>
<span class="c">(* &quot;T&quot; *)</span>
<span class="k">let</span> <span class="n">first</span>  <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">sub</span> <span class="kt">string</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="c">(* &quot;is&quot; *)</span>
<span class="k">let</span> <span class="n">start</span>  <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">sub</span> <span class="kt">string</span> <span class="mi">5</span> <span class="mi">2</span>
<span class="c">(* &quot;you have&quot; *)</span>
<span class="k">let</span> <span class="n">rest</span>   <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">sub</span> <span class="kt">string</span> <span class="mi">13</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="kt">string</span> <span class="o">-</span> <span class="mi">13</span><span class="o">)</span>
<span class="c">(* &quot;e&quot; *)</span>
<span class="k">let</span> <span class="n">last</span>   <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">sub</span> <span class="kt">string</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="kt">string</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="mi">1</span>
<span class="c">(* &quot;have&quot; *)</span>
<span class="k">let</span> <span class="n">theend</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">sub</span> <span class="kt">string</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="kt">string</span> <span class="o">-</span> <span class="mi">4</span><span class="o">)</span> <span class="mi">4</span>
<span class="c">(* &quot;you&quot; *)</span>
<span class="k">let</span> <span class="n">piece</span>  <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">sub</span> <span class="kt">string</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="kt">string</span> <span class="o">-</span> <span class="mi">8</span><span class="o">)</span> <span class="mi">3</span>
<span class="c">(*-----------------------------*)</span>
<span class="k">let</span> <span class="kt">string</span> <span class="o">=</span> <span class="s2">&quot;This is what you have&quot;</span><span class="o">;;</span>
<span class="nn">Printf</span><span class="p">.</span><span class="n">printf</span> <span class="s2">&quot;%s&quot;</span> <span class="kt">string</span> <span class="o">;</span>
<span class="c">(*This is what you have*)</span>

<span class="c">(* Change &quot;is&quot; to &quot;wasn&#39;t&quot;*)</span>
<span class="k">let</span> <span class="kt">string</span> <span class="o">=</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">sub</span> <span class="kt">string</span> <span class="mi">0</span> <span class="mi">5</span><span class="o">)</span> <span class="o">^</span> <span class="s2">&quot;wasn&#39;t&quot;</span> <span class="o">^</span> <span class="n">sub_end</span> <span class="kt">string</span> <span class="mi">7</span>
<span class="c">(*This wasn&#39;t what you have *)</span>

<span class="c">(*This wasn&#39;t wonderous *)</span>
<span class="k">let</span> <span class="kt">string</span> <span class="o">=</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">sub</span> <span class="kt">string</span> <span class="mi">0</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="kt">string</span> <span class="o">-</span><span class="mi">12</span><span class="o">))</span> <span class="o">^</span>
   <span class="s2">&quot;ondrous&quot;</span><span class="o">;;</span>

<span class="c">(* delete first character *)</span>
<span class="k">let</span> <span class="kt">string</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">sub</span> <span class="kt">string</span> <span class="mi">1</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="kt">string</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
<span class="c">(*his wasn&#39;t wondrous*)</span>

<span class="c">(* delete last 10 characters *)</span>
<span class="k">let</span> <span class="kt">string</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">sub</span> <span class="kt">string</span> <span class="mi">0</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="kt">string</span> <span class="o">-</span><span class="mi">10</span><span class="o">)</span>
<span class="c">(*his wasn&#39;*)</span>
<span class="c">(*-----------------------------*)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN20"
>Establishing a Default Value</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c">(* Because OCaml doesn&#39;t have the same notion of truth or definedness as Perl,</span>
<span class="c"> * most of these examples just can&#39;t be done as they are in Perl.  Some can be</span>
<span class="c"> * approximated via the use of options, but remember, unbound variables are not</span>
<span class="c"> * automatically assigned the value of None -- the variable has to have been</span>
<span class="c"> * explicitly bound to None (or Some x) beforehand.</span>
<span class="c">*)</span>

<span class="c">(* use b if b is not None, else use c *)</span>
<span class="k">let</span> <span class="n">a</span> <span class="o">=</span> <span class="k">match</span> <span class="n">b</span> <span class="k">with</span> <span class="nc">None</span> <span class="o">-&gt;</span> <span class="n">c</span> <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">b</span><span class="o">;;</span>

<span class="c">(* set x to y if x is currently None *)</span>
<span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="k">match</span> <span class="n">x</span> <span class="k">with</span> <span class="nc">None</span> <span class="o">-&gt;</span> <span class="n">y</span> <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">;;</span>

<span class="c">(* Note that these are much closer to Perls notion of definedness than truth *)</span>

<span class="c">(* We can set foo to either bar or &quot;DEFAULT VALUE&quot; in one of two ways *)</span>
<span class="c">(* keep foo as a string option *)</span>
<span class="k">let</span> <span class="n">foo</span> <span class="o">=</span> <span class="k">match</span> <span class="n">bar</span> <span class="k">with</span> <span class="nc">Some</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">bar</span> <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="nc">Some</span> <span class="s2">&quot;DEFAULT VALUE&quot;</span><span class="o">;;</span>

<span class="c">(* Use foo as a string *)</span>
<span class="k">let</span> <span class="n">foo</span> <span class="o">=</span> <span class="k">match</span> <span class="n">bar</span> <span class="k">with</span> <span class="nc">Some</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="s2">&quot;DEFAULT VALUE&quot;</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">dir</span> <span class="o">=</span> <span class="k">if</span> <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="nn">Sys</span><span class="p">.</span><span class="n">argv</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">then</span> <span class="n">argv</span><span class="o">.(</span><span class="mi">1</span><span class="o">)</span> <span class="k">else</span> <span class="s2">&quot;/tmp&quot;</span><span class="o">;;</span>

<span class="c">(* None of the other examples really make sense in OCaml terms... *)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN23"
>Exchanging Values Without Using Temporary Variables</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">(*-----------------------------*)</span>
<span class="k">let</span> <span class="n">var1</span><span class="o">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="n">var2</span><span class="o">,</span> <span class="n">var1</span>
<span class="c">(*-----------------------------*)</span>
<span class="k">let</span> <span class="n">temp</span>    <span class="o">=</span> <span class="n">a</span>
<span class="k">let</span> <span class="n">a</span>       <span class="o">=</span> <span class="n">b</span>
<span class="k">let</span> <span class="n">b</span>       <span class="o">=</span> <span class="n">temp</span>
<span class="c">(*-----------------------------*)</span>
<span class="k">let</span> <span class="n">a</span>       <span class="o">=</span> <span class="s2">&quot;alpha&quot;</span>
<span class="k">let</span> <span class="n">b</span>       <span class="o">=</span> <span class="s2">&quot;omega&quot;</span>
<span class="k">let</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">,</span> <span class="n">a</span>      <span class="c">(* the first shall be last -- and versa vice *)</span>
<span class="c">(*-----------------------------*)</span>
<span class="k">let</span> <span class="n">alpha</span><span class="o">,</span> <span class="n">beta</span><span class="o">,</span> <span class="n">production</span> <span class="o">=</span> <span class="s2">&quot;January&quot;</span><span class="o">,</span> <span class="s2">&quot;March&quot;</span><span class="o">,</span> <span class="s2">&quot;August&quot;</span>
<span class="c">(* move beta       to alpha,</span>
<span class="c"> * move production to beta,</span>
<span class="c"> * move alpha      to production *)</span>
<span class="k">let</span> <span class="n">alpha</span><span class="o">,</span> <span class="n">beta</span><span class="o">,</span> <span class="n">production</span> <span class="o">=</span> <span class="n">beta</span><span class="o">,</span> <span class="n">production</span><span class="o">,</span> <span class="n">alpha</span>
<span class="c">(*-----------------------------*)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN26"
>Converting Between ASCII Characters and Values</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">(*-----------------------------*)</span>
<span class="k">let</span> <span class="n">num</span>  <span class="o">=</span> <span class="nn">Char</span><span class="p">.</span><span class="n">code</span> <span class="kt">char</span>
<span class="k">let</span> <span class="kt">char</span> <span class="o">=</span> <span class="nn">Char</span><span class="p">.</span><span class="n">chr</span> <span class="n">num</span>
<span class="c">(*-----------------------------*)</span>
<span class="c">(* char and int are distinct datatypes in OCaml *)</span>
<span class="n">printf</span> <span class="s2">&quot;Number %d is character %c</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">num</span> <span class="o">(</span><span class="nn">Char</span><span class="p">.</span><span class="n">chr</span> <span class="n">num</span><span class="o">)</span>
<span class="c">(* Number 101 is character e *)</span>
<span class="c">(*-----------------------------*)</span>
<span class="c">(* convert string to list of chars *)</span>
<span class="k">let</span> <span class="n">explode</span> <span class="n">s</span> <span class="o">=</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">f</span> <span class="n">acc</span> <span class="o">=</span> <span class="k">function</span>
    <span class="o">|</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="n">acc</span>
    <span class="o">|</span> <span class="n">k</span> <span class="o">-&gt;</span> <span class="n">f</span> <span class="o">(</span><span class="n">s</span><span class="o">.[</span><span class="n">k</span><span class="o">]</span> <span class="o">::</span> <span class="n">acc</span><span class="o">)</span> <span class="o">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
  <span class="k">in</span> <span class="n">f</span> <span class="bp">[]</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>

<span class="c">(* convert list of chars to string *)</span>
<span class="k">let</span> <span class="n">implode</span> <span class="n">l</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">create</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">length</span> <span class="n">l</span><span class="o">)</span> <span class="k">in</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">f</span> <span class="n">n</span> <span class="o">=</span> <span class="k">function</span>
    <span class="o">|</span> <span class="n">x</span> <span class="o">::</span> <span class="n">xs</span> <span class="o">-&gt;</span> <span class="n">s</span><span class="o">.[</span><span class="n">n</span><span class="o">]</span> <span class="o">&lt;-</span> <span class="n">x</span><span class="o">;</span> <span class="n">f</span> <span class="o">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">xs</span>
    <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">s</span>
  <span class="k">in</span> <span class="n">f</span> <span class="mi">0</span> <span class="n">l</span>

<span class="c">(* ascii is list of ints. *)</span>
<span class="k">let</span> <span class="n">ascii</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="nn">Char</span><span class="p">.</span><span class="n">code</span> <span class="o">(</span><span class="n">explode</span> <span class="kt">string</span><span class="o">)</span>
<span class="k">let</span> <span class="kt">string</span> <span class="o">=</span> <span class="n">implode</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="nn">Char</span><span class="p">.</span><span class="n">ord</span> <span class="n">ascii</span><span class="o">)</span>
<span class="c">(*-----------------------------*)</span>
<span class="k">let</span> <span class="n">ascii_value</span> <span class="o">=</span> <span class="nn">Char</span><span class="p">.</span><span class="n">code</span> <span class="sc">&#39;e&#39;</span>    <span class="c">(* now 101 *)</span>
<span class="k">let</span> <span class="n">character</span>   <span class="o">=</span> <span class="nn">Char</span><span class="p">.</span><span class="n">chr</span> <span class="mi">101</span>     <span class="c">(* now &#39;e&#39; *)</span>
<span class="c">(*-----------------------------*)</span>
<span class="n">printf</span> <span class="s2">&quot;Number %d is character %c</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="mi">101</span> <span class="o">(</span><span class="nn">Char</span><span class="p">.</span><span class="n">chr</span> <span class="mi">101</span><span class="o">)</span>
<span class="c">(*-----------------------------*)</span>
<span class="k">let</span> <span class="n">ascii_character_numbers</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="nn">Char</span><span class="p">.</span><span class="n">code</span> <span class="o">(</span><span class="n">explode</span> <span class="s2">&quot;sample&quot;</span><span class="o">);;</span>
<span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="n">printf</span> <span class="s2">&quot;%d &quot;</span><span class="o">)</span> <span class="n">ascii_character_numbers</span><span class="o">;</span>
<span class="n">printf</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="mi">115</span> <span class="mi">97</span> <span class="mi">109</span> <span class="mi">112</span> <span class="mi">108</span> <span class="mi">101</span>

<span class="k">let</span> <span class="n">word</span> <span class="o">=</span> <span class="n">implode</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="nn">Char</span><span class="p">.</span><span class="n">chr</span> <span class="n">ascii_character_numbers</span><span class="o">)</span>
<span class="k">let</span> <span class="n">word</span> <span class="o">=</span> <span class="n">implode</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="nn">Char</span><span class="p">.</span><span class="n">chr</span> <span class="o">[</span><span class="mi">115</span><span class="o">;</span> <span class="mi">97</span><span class="o">;</span> <span class="mi">109</span><span class="o">;</span> <span class="mi">112</span><span class="o">;</span> <span class="mi">108</span><span class="o">;</span> <span class="mi">101</span><span class="o">]);;</span> <span class="c">(* same *)</span>
<span class="n">printf</span> <span class="s2">&quot;%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">word</span>
<span class="n">sample</span>
<span class="c">(*-----------------------------*)</span>
<span class="k">let</span> <span class="n">hal</span> <span class="o">=</span> <span class="s2">&quot;HAL&quot;</span>
<span class="k">let</span> <span class="n">ascii</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="nn">Char</span><span class="p">.</span><span class="n">code</span> <span class="o">(</span><span class="n">explode</span> <span class="n">hal</span><span class="o">)</span>
<span class="k">let</span> <span class="n">ascii</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="o">((</span> <span class="o">+</span> <span class="o">)</span> <span class="mi">1</span><span class="o">)</span> <span class="n">ascii</span>  <span class="c">(* add one to each ASCII value *)</span>
<span class="k">let</span> <span class="n">ibm</span> <span class="o">=</span> <span class="n">implode</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="nn">Char</span><span class="p">.</span><span class="n">chr</span> <span class="n">ascii</span><span class="o">);;</span>
<span class="n">printf</span> <span class="s2">&quot;%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">ibm</span>             <span class="c">(* prints &quot;IBM&quot; *)</span>
<span class="c">(*-----------------------------*)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN29"
>Processing a String One Character at a Time</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c">(* One can split a string into an array of character, or corresponding ASCII</span>
<span class="c"> * codes as follows, but this is not necessary to process the strings a</span>
<span class="c"> * character at a time: *)</span>

<span class="k">let</span> <span class="n">array_of_chars</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">init</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">s</span><span class="o">)</span> <span class="o">(</span><span class="k">fun</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">s</span><span class="o">.[</span><span class="n">i</span><span class="o">]);;</span>
<span class="k">let</span> <span class="n">array_of_codes</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">init</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">s</span><span class="o">)</span> <span class="o">(</span><span class="k">fun</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="nn">Char</span><span class="p">.</span><span class="n">code</span> <span class="n">s</span><span class="o">.[</span><span class="n">i</span><span class="o">]);;</span>

<span class="c">(* or one can just use String.iter *)</span>
<span class="nn">String</span><span class="p">.</span><span class="n">iter</span>
  <span class="o">(</span><span class="k">fun</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="c">(*do something with s.[i], the ith char of the string*)</span><span class="o">)</span> <span class="n">s</span><span class="o">;;</span>

<span class="c">(* The following function can be used to return a list of all unique keys in a</span>
<span class="c"> * hashtable *)</span>

<span class="k">let</span> <span class="n">keys</span> <span class="n">h</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">k</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">fold</span> <span class="o">(</span><span class="k">fun</span> <span class="n">k</span> <span class="n">v</span> <span class="n">b</span> <span class="o">-&gt;</span> <span class="n">k</span><span class="o">::</span><span class="n">b</span><span class="o">)</span> <span class="n">h</span> <span class="bp">[]</span> <span class="k">in</span>
  <span class="c">(* filter out duplicates *)</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">fold_left</span> <span class="o">(</span><span class="k">fun</span> <span class="n">b</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="nn">List</span><span class="p">.</span><span class="n">mem</span> <span class="n">x</span> <span class="n">b</span> <span class="k">then</span> <span class="n">b</span> <span class="k">else</span> <span class="n">x</span><span class="o">::</span><span class="n">b</span><span class="o">)</span> <span class="bp">[]</span> <span class="n">k</span><span class="o">;;</span>

<span class="c">(* and this function is a shorthand for adding a key,value pair to a hashtable</span>
<span class="c">*)</span>

<span class="k">let</span> <span class="o">(</span> <span class="o">&lt;&lt;+</span> <span class="o">)</span> <span class="n">h</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span><span class="n">v</span><span class="o">)</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">add</span> <span class="n">h</span> <span class="n">k</span> <span class="n">v</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">seen</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">create</span> <span class="mi">13</span><span class="o">;;</span>
<span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;an apple a day&quot;</span><span class="o">;;</span>
<span class="k">let</span> <span class="n">array_of_chars</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">init</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">s</span><span class="o">)</span> <span class="o">(</span><span class="k">fun</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">s</span><span class="o">.[</span><span class="n">i</span><span class="o">]);;</span>
<span class="nn">Array</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">seen</span> <span class="o">&lt;&lt;+</span> <span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="mi">1</span><span class="o">))</span> <span class="n">array_of_chars</span><span class="o">;</span>
<span class="n">print_string</span> <span class="s2">&quot;unique chars are:</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">;</span>
<span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="n">print_char</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">sort</span> <span class="n">compare</span> <span class="o">(</span><span class="n">keys</span> <span class="n">seen</span><span class="o">));</span>
<span class="n">print_newline</span> <span class="bp">()</span><span class="o">;;</span>

<span class="c">(* or, without the unnecessary and innefficient step of converting the string</span>
<span class="c"> * into an array of chars *)</span>
<span class="k">let</span> <span class="n">seen</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">create</span> <span class="mi">13</span><span class="o">;;</span>
<span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;an apple a day&quot;</span><span class="o">;;</span>
<span class="nn">String</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">seen</span> <span class="o">&lt;&lt;+</span> <span class="o">(</span><span class="n">x</span><span class="o">,</span><span class="mi">1</span><span class="o">))</span> <span class="n">s</span><span class="o">;</span>
<span class="n">print_string</span> <span class="s2">&quot;unique chars are:</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">;</span>
<span class="nn">List</span><span class="p">.</span><span class="n">iter</span> <span class="n">print_char</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">sort</span> <span class="n">compare</span> <span class="o">(</span><span class="n">keys</span> <span class="n">seen</span><span class="o">));</span>
<span class="n">print_newline</span> <span class="bp">()</span><span class="o">;;</span>

<span class="c">(* To compute the simple 31-bit checksum of a string *)</span>
<span class="k">let</span> <span class="n">cksum</span> <span class="n">s</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">ref</span> <span class="mi">0</span> <span class="k">in</span>
  <span class="nn">String</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">sum</span> <span class="o">:=</span> <span class="o">!</span><span class="n">sum</span> <span class="o">+</span> <span class="o">(</span><span class="nn">Char</span><span class="p">.</span><span class="n">code</span> <span class="n">x</span><span class="o">))</span> <span class="n">s</span><span class="o">;</span>
  <span class="o">!</span><span class="n">sum</span><span class="o">;;</span>
<span class="c">(*</span>
<span class="c"># cksum &quot;an apple a day&quot;;;</span>
<span class="c">- : int = 1248</span>
<span class="c">*)</span>

<span class="c">(* to emulate the SysV 16-bit checksum, we will first write two routines sort of</span>
<span class="c"> * similar to Perl&#39;s (&lt;&gt;), that will return the contents of a file either as a</span>
<span class="c"> * list of strings or as a single string - not that the list of strings version</span>
<span class="c"> * throws away the \n at the end of each line *)</span>

<span class="k">let</span> <span class="n">slurp_to_list</span> <span class="n">filename</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">ic</span> <span class="o">=</span> <span class="n">open_in</span> <span class="n">filename</span> <span class="ow">and</span>
  <span class="n">l</span> <span class="o">=</span> <span class="n">ref</span> <span class="bp">[]</span> <span class="k">in</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">loop</span> <span class="bp">()</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">line</span> <span class="o">=</span> <span class="n">input_line</span> <span class="n">ic</span> <span class="k">in</span>
    <span class="n">l</span> <span class="o">:=</span> <span class="n">line</span><span class="o">::!</span><span class="n">l</span><span class="o">;</span>
    <span class="n">loop</span> <span class="bp">()</span> <span class="k">in</span>
  <span class="k">try</span> <span class="n">loop</span> <span class="bp">()</span> <span class="k">with</span> <span class="nc">End_of_file</span> <span class="o">-&gt;</span> <span class="n">close_in</span> <span class="n">ic</span><span class="o">;</span> <span class="nn">List</span><span class="p">.</span><span class="n">rev</span> <span class="o">!</span><span class="n">l</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">slurp_to_string</span> <span class="n">filename</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">ic</span> <span class="o">=</span> <span class="n">open_in</span> <span class="n">filename</span> <span class="ow">and</span>
  <span class="n">buf</span> <span class="o">=</span> <span class="nn">Buffer</span><span class="p">.</span><span class="n">create</span> <span class="mi">4096</span> <span class="k">in</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">loop</span> <span class="bp">()</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">line</span> <span class="o">=</span> <span class="n">input_line</span> <span class="n">ic</span> <span class="k">in</span>
    <span class="nn">Buffer</span><span class="p">.</span><span class="n">add_string</span> <span class="n">buf</span> <span class="n">line</span><span class="o">;</span>
    <span class="nn">Buffer</span><span class="p">.</span><span class="n">add_string</span> <span class="n">buf</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">;</span>
    <span class="n">loop</span> <span class="bp">()</span> <span class="k">in</span>
  <span class="k">try</span> <span class="n">loop</span> <span class="bp">()</span> <span class="k">with</span> <span class="nc">End_of_file</span> <span class="o">-&gt;</span> <span class="n">close_in</span> <span class="n">ic</span><span class="o">;</span> <span class="nn">Buffer</span><span class="p">.</span><span class="n">contents</span> <span class="n">buf</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">cksum16</span> <span class="n">fn</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">addString</span> <span class="n">sum</span> <span class="n">s</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">sm</span> <span class="o">=</span> <span class="n">ref</span> <span class="n">sum</span> <span class="k">in</span>
    <span class="nn">String</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">c</span> <span class="o">-&gt;</span> <span class="n">sm</span> <span class="o">:=</span> <span class="o">!</span><span class="n">sm</span> <span class="o">+</span> <span class="o">(</span><span class="nn">Char</span><span class="p">.</span><span class="n">code</span> <span class="n">c</span><span class="o">))</span> <span class="o">(</span><span class="n">s</span> <span class="o">^</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">);</span>
    <span class="o">!</span><span class="n">sm</span> <span class="ow">mod</span> <span class="mi">65537</span> <span class="c">(* 2^16 - 1 *)</span><span class="k">in</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">fold_left</span> <span class="n">addString</span> <span class="mi">0</span> <span class="o">(</span><span class="n">slurp_to_list</span> <span class="n">fn</span><span class="o">);;</span>

<span class="c">(* or *)</span>
<span class="k">let</span> <span class="n">cksum16</span> <span class="n">fn</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">ref</span> <span class="mi">0</span>
  <span class="ow">and</span> <span class="n">s</span> <span class="o">=</span> <span class="n">slurp_to_string</span> <span class="n">fn</span> <span class="k">in</span>
  <span class="nn">String</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">c</span> <span class="o">-&gt;</span> <span class="n">sum</span> <span class="o">:=</span> <span class="o">(!</span><span class="n">sum</span> <span class="o">+</span> <span class="o">(</span><span class="nn">Char</span><span class="p">.</span><span class="n">code</span> <span class="n">c</span><span class="o">))</span> <span class="ow">mod</span> <span class="mi">65537</span><span class="o">)</span> <span class="n">s</span><span class="o">;</span>
  <span class="o">!</span><span class="n">sum</span><span class="o">;;</span>



<span class="c">(* Note: slowcat as written is meant to be run from the command line, not in the</span>
<span class="c"> * toplevel *)</span>

<span class="o">#!/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ocaml</span>
<span class="c">(* slowcat - emulate a   s l o w  line printer *)</span>
<span class="c">(* usage: slowcat [-DELAY] [files ...] *)</span>
<span class="o">#</span><span class="n">load</span> <span class="s2">&quot;unix.cma&quot;</span><span class="o">;;</span>

<span class="c">(* make sure you have the code for the slurp_to_string function in this file as</span>
<span class="c"> * well... *)</span>

<span class="k">let</span> <span class="o">_</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">delay</span><span class="o">,</span><span class="n">fs</span> <span class="o">=</span> <span class="k">try</span> <span class="o">(</span><span class="n">float_of_string</span> <span class="nn">Sys</span><span class="p">.</span><span class="n">argv</span><span class="o">.(</span><span class="mi">1</span><span class="o">)),</span><span class="mi">2</span> <span class="k">with</span> <span class="nc">Failure</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">.,</span><span class="mi">1</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">files</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">sub</span> <span class="nn">Sys</span><span class="p">.</span><span class="n">argv</span> <span class="n">fs</span> <span class="o">(</span><span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="nn">Sys</span><span class="p">.</span><span class="n">argv</span> <span class="o">-</span> <span class="n">fs</span><span class="o">)</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">print_file</span> <span class="n">f</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="n">slurp_to_string</span> <span class="n">f</span> <span class="k">in</span>
    <span class="nn">String</span><span class="p">.</span><span class="n">iter</span>
      <span class="o">(</span><span class="k">fun</span> <span class="n">c</span> <span class="o">-&gt;</span>
        <span class="n">print_char</span> <span class="n">c</span><span class="o">;</span>
        <span class="n">ignore</span><span class="o">(</span><span class="nn">Unix</span><span class="p">.</span><span class="n">select</span> <span class="bp">[]</span> <span class="bp">[]</span> <span class="bp">[]</span> <span class="o">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">005</span> <span class="o">*.</span> <span class="n">delay</span><span class="o">)))</span> <span class="n">s</span> <span class="k">in</span>
  <span class="nn">Array</span><span class="p">.</span><span class="n">iter</span> <span class="n">print_file</span> <span class="n">files</span><span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN32"
>Reversing a String by Word or Character</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c">(* To flip the characters of a string, we can use a for loop.</span>
<span class="c"> * Note that this version does not destructively update the string *)</span>

<span class="k">let</span> <span class="n">reverse</span> <span class="n">s</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">len</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">s</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">s&#39;</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">create</span> <span class="o">(</span><span class="n">len</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="k">in</span>
  <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">to</span> <span class="n">len</span> <span class="k">do</span>
    <span class="n">s&#39;</span><span class="o">.[</span><span class="n">i</span><span class="o">]</span> <span class="o">&lt;-</span> <span class="n">s</span><span class="o">.[</span><span class="n">len</span> <span class="o">-</span> <span class="n">i</span><span class="o">]</span>
  <span class="k">done</span><span class="o">;</span>
  <span class="n">s&#39;</span><span class="o">;;</span>

<span class="c">(* to modify the string in place, we can use the following function *)</span>
<span class="k">let</span> <span class="n">reverse_in_place</span> <span class="n">s</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">len</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">s</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">in</span>
  <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">to</span> <span class="o">(</span><span class="n">len</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
    <span class="k">let</span> <span class="n">t</span> <span class="o">=</span> <span class="n">s</span><span class="o">.[</span><span class="n">i</span><span class="o">]</span> <span class="k">in</span>
    <span class="n">s</span><span class="o">.[</span><span class="n">i</span><span class="o">]</span> <span class="o">&lt;-</span> <span class="n">s</span><span class="o">.[</span><span class="n">len</span> <span class="o">-</span> <span class="n">i</span><span class="o">];</span>
    <span class="n">s</span><span class="o">.[</span><span class="n">len</span> <span class="o">-</span> <span class="n">i</span><span class="o">]</span> <span class="o">&lt;-</span> <span class="n">t</span>
  <span class="k">done</span><span class="o">;;</span>

<span class="c">(* To reverse the words in a string, we can use String.concat, Str.split and</span>
<span class="c"> * List.rev.  Note that this requires us to load in the Str module --</span>
<span class="c"> * use `#load &quot;str.cma&quot;&#39; in* the toplevel, or be sure to include str.cma in the</span>
<span class="c"> * list of object files when compiling your code.  E.g.:</span>
<span class="c"> *      ocamlc other options str.cma other files   -or-</span>
<span class="c"> *      ocamlopt other options str.cmxa other files</span>
<span class="c">*)</span>

<span class="k">let</span> <span class="n">reverse_words</span> <span class="n">s</span> <span class="o">=</span>
  <span class="nn">String</span><span class="p">.</span><span class="n">concat</span> <span class="s2">&quot; &quot;</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">rev</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">split</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="s2">&quot; &quot;</span><span class="o">)</span> <span class="n">s</span><span class="o">));;</span>

<span class="k">let</span> <span class="n">is_palindrome</span> <span class="n">s</span> <span class="o">=</span>
  <span class="n">s</span> <span class="o">=</span> <span class="n">reverse</span> <span class="n">s</span><span class="o">;;</span>

<span class="c">(* We do need to do a bit more work that Perl to find the big palindromes in</span>
<span class="c"> * /usr/share/dict/words ... *)</span>

<span class="k">let</span> <span class="n">findBigPals</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">words</span> <span class="o">=</span> <span class="n">open_in</span> <span class="s2">&quot;/usr/share/dict/words&quot;</span> <span class="k">in</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">loop</span> <span class="bp">()</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">w</span> <span class="o">=</span> <span class="n">input_line</span> <span class="n">words</span> <span class="k">in</span>
    <span class="k">if</span> <span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">w</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="o">&amp;&amp;</span> <span class="n">w</span> <span class="o">=</span> <span class="n">reverse</span> <span class="n">w</span> <span class="k">then</span>
      <span class="n">print_endline</span> <span class="n">w</span><span class="o">;</span>
    <span class="n">loop</span> <span class="bp">()</span> <span class="k">in</span>
  <span class="k">try</span> <span class="n">loop</span> <span class="bp">()</span> <span class="k">with</span> <span class="nc">End_of_file</span> <span class="o">-&gt;</span> <span class="n">close_in</span> <span class="n">words</span><span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN35"
>Expanding and Compressing Tabs</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="k">let</span> <span class="n">expand_tabs</span> <span class="o">?(</span><span class="n">spaces</span> <span class="o">=</span> <span class="mi">8</span><span class="o">)</span> <span class="n">s</span> <span class="o">=</span>
  <span class="nn">Str</span><span class="p">.</span><span class="n">global_replace</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">)</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">make</span> <span class="n">spaces</span> <span class="sc">&#39; &#39;</span><span class="o">)</span> <span class="n">s</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">compress_tabs</span> <span class="o">?(</span><span class="n">spaces</span> <span class="o">=</span> <span class="mi">8</span><span class="o">)</span> <span class="n">s</span> <span class="o">=</span>
  <span class="nn">Str</span><span class="p">.</span><span class="n">global_replace</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">make</span> <span class="n">spaces</span> <span class="sc">&#39; &#39;</span><span class="o">))</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="n">s</span><span class="o">;;</span>

<span class="c">(*</span>
<span class="c"># let st = &quot;\tyo baby!\n\t\tWhat the shizzle?\t(Mack)&quot;;;</span>
<span class="c">val st : string = &quot;\tyo baby!\n\t\tWhat the shizzle?\t(Mack)&quot;</span>
<span class="c"># let etst = expand_tabs st;;</span>
<span class="c">val etst : string =</span>
<span class="c">  &quot;        yo baby!\n                What the shizzle?        (Mack)&quot;</span>
<span class="c"># let etst = expand_tabs ~spaces:4 st;;</span>
<span class="c">val etst : string = &quot;    yo baby!\n        What the shizzle?    (Mack)&quot;</span>
<span class="c"># let etst = expand_tabs ~spaces:8 st;;</span>
<span class="c">val etst : string =</span>
<span class="c">  &quot;        yo baby!\n                What the shizzle?        (Mack)&quot;</span>
<span class="c"># let rest = compress_tabs etst;;</span>
<span class="c">val rest : string = &quot;\tyo baby!\n\t\tWhat the shizzle?\t(Mack)&quot;</span>
<span class="c"># let rest = compress_tabs ~spaces:4 etst;;</span>
<span class="c">val rest : string = &quot;\t\tyo baby!\n\t\t\t\tWhat the shizzle?\t\t(Mack)&quot;</span>
<span class="c"># let rest = compress_tabs ~spaces:3 etst;;</span>
<span class="c">val rest : string =</span>
<span class="c">  &quot;\t\t  yo baby!\n\t\t\t\t\t What the shizzle?\t\t  (Mack)&quot;</span>
<span class="c">*)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN38"
>Expanding Variables in User Input</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">(* As far as I know there is no way to do this in OCaml due to</span>
<span class="c">   type-safety contraints built into the OCaml compiler -- it may be</span>
<span class="c">   feasible with *much* juju, but don&#39;t expect to see this anytime</span>
<span class="c">   soon...</span>

<span class="c">   If you don&#39;t mind supplying a data structure rather than capturing</span>
<span class="c">   local variables, you can use Buffer.add_substitute to get a similar</span>
<span class="c">   effect. *)</span>

<span class="k">let</span> <span class="n">buffer</span> <span class="o">=</span> <span class="nn">Buffer</span><span class="p">.</span><span class="n">create</span> <span class="mi">16</span>
<span class="k">let</span> <span class="n">vars</span> <span class="o">=</span> <span class="o">[(</span><span class="s2">&quot;debt&quot;</span><span class="o">,</span> <span class="s2">&quot;$700 billion&quot;</span><span class="o">)]</span>
<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="nn">Buffer</span><span class="p">.</span><span class="n">add_substitute</span> <span class="n">buffer</span>
    <span class="o">(</span><span class="k">fun</span> <span class="n">name</span> <span class="o">-&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">assoc</span> <span class="n">name</span> <span class="n">vars</span><span class="o">)</span>
    <span class="s2">&quot;You owe $debt to me.&quot;</span><span class="o">;</span>
  <span class="n">print_endline</span> <span class="o">(</span><span class="nn">Buffer</span><span class="p">.</span><span class="n">contents</span> <span class="n">buffer</span><span class="o">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN41"
>Controlling Case</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c">(* Just use the String module&#39;s uppercase, lowercase, capitalize and</span>
<span class="c"> * uncapitalize *)</span>

<span class="k">let</span> <span class="n">big</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">uppercase</span> <span class="n">little</span><span class="o">;;</span>    <span class="c">(* &quot;bo peep&quot; -&gt; &quot;BO PEEP&quot; *)</span>
<span class="k">let</span> <span class="n">little</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">lowercase</span> <span class="n">big</span><span class="o">;;</span>    <span class="c">(* &quot;JOHN&quot; -&gt; &quot;john&quot; *)</span>
<span class="k">let</span> <span class="n">big</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">capitalize</span> <span class="n">little</span><span class="o">;;</span>   <span class="c">(* &quot;bo&quot; -&gt; &quot;Bo&quot; *)</span>
<span class="k">let</span> <span class="n">little</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">uncapitalize</span> <span class="n">big</span><span class="o">;;</span> <span class="c">(* &quot;BoPeep&quot; -&gt; &quot;boPeep&quot; *)</span>

<span class="c">(* Capitalize each word&#39;s first character, downcase the rest *)</span>
<span class="k">let</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;thIS is a loNG liNE&quot;</span><span class="o">;;</span>
<span class="k">let</span> <span class="n">text</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">capitalize</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">lowercase</span> <span class="n">text</span><span class="o">);;</span>
<span class="n">print_endline</span> <span class="n">text</span><span class="o">;;</span>

<span class="c">(*</span>
<span class="c">This is a long line</span>
<span class="c">*)</span>

<span class="c">(* To do case insensitive comparisons *)</span>
<span class="k">if</span> <span class="nn">String</span><span class="p">.</span><span class="n">uppercase</span> <span class="n">a</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">uppercase</span> <span class="n">b</span> <span class="k">then</span>
  <span class="n">print_endline</span> <span class="s2">&quot;a and b are the same</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">randcap</span> <span class="n">fn</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="n">slurp_to_string</span> <span class="n">fn</span> <span class="k">in</span>
  <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">to</span> <span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">s</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">do</span>
    <span class="k">if</span> <span class="nn">Random</span><span class="p">.</span><span class="n">int</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="mi">20</span> <span class="k">then</span>
      <span class="nn">String</span><span class="p">.</span><span class="n">blit</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">capitalize</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">sub</span> <span class="n">s</span> <span class="n">i</span> <span class="mi">1</span><span class="o">))</span> <span class="mi">0</span> <span class="n">s</span>  <span class="n">i</span> <span class="mi">1</span>
  <span class="k">done</span><span class="o">;</span>
  <span class="n">print_string</span> <span class="n">s</span><span class="o">;;</span>


<span class="c">(*</span>
<span class="c"># randcap &quot;/etc/passwd&quot;;;</span>

<span class="c">##</span>
<span class="c"># User DatAbAse</span>
<span class="c">#</span>
<span class="c"># Note That this fIle is consuLTed wHen the sysTeM Is runninG In single-user</span>
<span class="c"># modE.  At other times this iNformAtion is handlEd by one or moRe oF:</span>
<span class="c"># lOokupD DIrectorYServicEs</span>
<span class="c"># By default, lOOkupd getS inFormaTion frOm NetInFo, so thiS fIle will</span>
<span class="c"># not be cOnsultEd unless you hAvE cHaNged LOokupd&#39;s COnfiguratiOn.</span>
<span class="c"># This fiLe is usEd while in siNgle UseR Mode.</span>
<span class="c">#</span>
<span class="c"># TO Use this file for noRmal aUthEnticatIon, you may eNable it With</span>
<span class="c"># /ApPlicatiOns/Utilities/DiRectory AccEss.</span>
<span class="c">##</span>

<span class="c">&lt; ... snip ... &gt;</span>
<span class="c">*)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN44"
>Interpolating Functions and Expressions Within Strings</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c">(* Again, because of OCaml&#39;s type-safe nature, actual interpolation cannot be</span>
<span class="c"> * done inside of strings -- one must use either string concatenation or sprintf</span>
<span class="c"> * to get the results we&#39;re looking for *)</span>

<span class="k">let</span> <span class="n">phrase</span> <span class="o">=</span> <span class="s2">&quot;I have &quot;</span> <span class="o">^</span> <span class="o">(</span><span class="n">string_of_int</span> <span class="o">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="o">))</span> <span class="o">^</span> <span class="s2">&quot; guanacos.&quot;</span><span class="o">;;</span>
<span class="k">let</span> <span class="n">prhase</span> <span class="o">=</span> <span class="n">sprintf</span> <span class="s2">&quot;I have %d guanacos.&quot;</span> <span class="o">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="o">);;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN47"
>Indenting Here Documents</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="o">#</span><span class="n">load</span> <span class="s2">&quot;str.cma&quot;</span><span class="o">;;</span>
<span class="k">let</span> <span class="n">var</span> <span class="o">=</span>  <span class="nn">Str</span><span class="p">.</span><span class="n">global_replace</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="s2">&quot;^[</span><span class="se">\t</span><span class="s2"> ]+&quot;</span><span class="o">)</span> <span class="s2">&quot;&quot;</span> <span class="s2">&quot;\</span>
<span class="s2">    your text</span>
<span class="s2">    goes here</span>
<span class="s2">&quot;</span><span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN50"
>Reformatting Paragraphs</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c">(* We can emulate the Perl wrap function with the following function *)</span>
<span class="k">let</span> <span class="n">wrap</span> <span class="n">width</span> <span class="n">s</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">l</span> <span class="o">=</span> <span class="nn">Str</span><span class="p">.</span><span class="n">split</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="s2">&quot; &quot;</span><span class="o">)</span> <span class="n">s</span> <span class="k">in</span>
  <span class="nn">Format</span><span class="p">.</span><span class="n">pp_set_margin</span> <span class="nn">Format</span><span class="p">.</span><span class="n">str_formatter</span> <span class="n">width</span><span class="o">;</span>
  <span class="nn">Format</span><span class="p">.</span><span class="n">pp_open_box</span> <span class="nn">Format</span><span class="p">.</span><span class="n">str_formatter</span> <span class="mi">0</span><span class="o">;</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">iter</span>
    <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span>
      <span class="nn">Format</span><span class="p">.</span><span class="n">pp_print_string</span> <span class="nn">Format</span><span class="p">.</span><span class="n">str_formatter</span> <span class="n">x</span><span class="o">;</span>
      <span class="nn">Format</span><span class="p">.</span><span class="n">pp_print_break</span> <span class="nn">Format</span><span class="p">.</span><span class="n">str_formatter</span> <span class="mi">1</span> <span class="mi">0</span><span class="o">;)</span> <span class="n">l</span><span class="o">;</span>
  <span class="nn">Format</span><span class="p">.</span><span class="n">flush_str_formatter</span> <span class="bp">()</span><span class="o">;;</span>

<span class="c">(*</span>
<span class="c"># let st = &quot;May I say how lovely you are looking today... this wrapping has done wonders for your figure!\n&quot;;;</span>
<span class="c">val st : string =</span>
<span class="c">  &quot;May I say how lovely you are looking today... this wrapping has done wonders for your figure!\n&quot;</span>

<span class="c"># print_string (wrap 50 st);;</span>
<span class="c">May I say how lovely you are looking today...</span>
<span class="c">this wrapping has done wonders for your figure!</span>

<span class="c"># print_string (wrap 30 st);;</span>
<span class="c">May I say how lovely you are</span>
<span class="c">looking today... this</span>
<span class="c">wrapping has done wonders for</span>
<span class="c">your figure!</span>
<span class="c">*)</span>

<span class="c">(* Note that this version doesn&#39;t allow you to specify an opening or standard</span>
<span class="c"> * indentation (I am having trouble getting the Format module to behave as I</span>
<span class="c"> * think it should...).  However, if one only wants to print spaces there</span>
<span class="c"> * instead of arbitrary line leaders, we can use the following version *)</span>

<span class="k">let</span> <span class="n">wrap</span> <span class="o">?(</span><span class="n">lead</span><span class="o">=</span><span class="mi">0</span><span class="o">)</span> <span class="o">?(</span><span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="o">)</span> <span class="n">width</span> <span class="n">s</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">l</span> <span class="o">=</span> <span class="nn">Str</span><span class="p">.</span><span class="n">split</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="s2">&quot; &quot;</span><span class="o">)</span> <span class="n">s</span> <span class="k">in</span>
  <span class="nn">Format</span><span class="p">.</span><span class="n">pp_set_margin</span> <span class="nn">Format</span><span class="p">.</span><span class="n">str_formatter</span> <span class="n">width</span><span class="o">;</span>
  <span class="nn">Format</span><span class="p">.</span><span class="n">pp_open_box</span> <span class="nn">Format</span><span class="p">.</span><span class="n">str_formatter</span> <span class="mi">0</span><span class="o">;</span>
  <span class="nn">Format</span><span class="p">.</span><span class="n">pp_print_break</span> <span class="nn">Format</span><span class="p">.</span><span class="n">str_formatter</span> <span class="n">lead</span> <span class="n">indent</span><span class="o">;</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">iter</span>
    <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="o">-&gt;</span>
      <span class="nn">Format</span><span class="p">.</span><span class="n">pp_print_string</span> <span class="nn">Format</span><span class="p">.</span><span class="n">str_formatter</span> <span class="n">x</span><span class="o">;</span>
      <span class="nn">Format</span><span class="p">.</span><span class="n">pp_print_break</span> <span class="nn">Format</span><span class="p">.</span><span class="n">str_formatter</span> <span class="mi">1</span> <span class="n">indent</span><span class="o">;)</span> <span class="n">l</span><span class="o">;</span>
  <span class="nn">Format</span><span class="p">.</span><span class="n">flush_str_formatter</span> <span class="bp">()</span><span class="o">;;</span>

<span class="c">(*</span>
<span class="c"># print_string (wrap 20 st);;</span>
<span class="c">May I say how</span>
<span class="c">lovely you are</span>
<span class="c">looking today...</span>
<span class="c">this wrapping has</span>
<span class="c">done wonders for</span>
<span class="c">your figure!</span>
<span class="c"> - : unit = ()</span>

<span class="c"># print_string (wrap ~lead:6 ~indent:2 20 st);;</span>
<span class="c">      May I say how</span>
<span class="c">  lovely you are</span>
<span class="c">  looking today...</span>
<span class="c">  this wrapping has</span>
<span class="c">  done wonders for</span>
<span class="c">  your figure!</span>

<span class="c"># print_string (wrap ~lead:2 20 st);;</span>
<span class="c">  May I say how</span>
<span class="c">lovely you are</span>
<span class="c">looking today...</span>
<span class="c">this wrapping has</span>
<span class="c">done wonders for</span>
<span class="c">your figure!</span>
<span class="c">*)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN53"
>Escaping Characters</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">(*</span>
<span class="c">** The Str module is deistributed with the standard Ocaml compiler</span>
<span class="c">** suit but it is not automatically pulled in by the command line</span>
<span class="c">** interpreter or the compilers.</span>
<span class="c">**</span>
<span class="c">** The &quot;#load&quot; line is only needed if you are running this in the</span>
<span class="c">** command interpretter.</span>
<span class="c">**</span>
<span class="c">** If you are using either of the ocaml compilers, you will need</span>
<span class="c">** to remove the &quot;#load&quot; line and link in str.cmxa in the final</span>
<span class="c">** compile command.</span>
<span class="c">*)</span>

<span class="o">#</span><span class="n">load</span> <span class="s2">&quot;str.cma&quot;</span> <span class="o">;;</span>

<span class="k">open</span> <span class="nc">Str</span>

<span class="k">let</span> <span class="n">escape</span> <span class="n">charlist</span> <span class="n">str</span> <span class="o">=</span>
	<span class="k">let</span> <span class="n">rx</span> <span class="o">=</span> <span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="o">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">([&quot;</span> <span class="o">^</span> <span class="n">charlist</span> <span class="o">^</span> <span class="s2">&quot;]</span><span class="se">\\</span><span class="s2">)&quot;</span><span class="o">)</span> <span class="k">in</span>
	<span class="nn">Str</span><span class="p">.</span><span class="n">global_replace</span> <span class="n">rx</span> <span class="s2">&quot;</span><span class="se">\\\\\\</span><span class="s2">1&quot;</span> <span class="n">str</span>

<span class="k">let</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Mom said, </span><span class="se">\&quot;</span><span class="s2">Don&#39;t do that.</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">;;</span>
<span class="n">print_endline</span> <span class="n">text</span> <span class="o">;;</span>

<span class="k">let</span> <span class="n">text</span> <span class="o">=</span> <span class="n">escape</span> <span class="s2">&quot;&#39;</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="n">text</span> <span class="o">;;</span>
<span class="n">print_endline</span> <span class="n">text</span> <span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN56"
>Trimming Blanks from the Ends of a String</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="k">let</span> <span class="n">trim</span> <span class="n">s</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">s&#39;</span> <span class="o">=</span> <span class="nn">Str</span><span class="p">.</span><span class="n">replace_first</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="s2">&quot;^[ </span><span class="se">\t\n</span><span class="s2">]+&quot;</span><span class="o">)</span> <span class="s2">&quot;&quot;</span> <span class="n">s</span> <span class="k">in</span>
  <span class="nn">Str</span><span class="p">.</span><span class="n">replace_first</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="s2">&quot;[ </span><span class="se">\t\n</span><span class="s2">]+$&quot;</span><span class="o">)</span> <span class="s2">&quot;&quot;</span> <span class="n">s&#39;</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">chop</span> <span class="n">s</span> <span class="o">=</span>
  <span class="k">if</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">then</span> <span class="n">s</span> <span class="k">else</span> <span class="nn">String</span><span class="p">.</span><span class="n">sub</span> <span class="n">s</span> <span class="mi">0</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);;</span>

<span class="k">let</span> <span class="n">chomp</span> <span class="o">?(</span><span class="n">c</span><span class="o">=</span><span class="sc">&#39;\n&#39;</span><span class="o">)</span> <span class="n">s</span> <span class="o">=</span>
  <span class="k">if</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">then</span> <span class="n">s</span> <span class="k">else</span>
    <span class="k">let</span> <span class="n">len</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">s</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">in</span>
    <span class="k">if</span> <span class="n">s</span><span class="o">.[</span><span class="n">len</span><span class="o">]</span> <span class="o">=</span> <span class="n">c</span> <span class="k">then</span> <span class="nn">String</span><span class="p">.</span><span class="n">sub</span> <span class="n">s</span> <span class="mi">0</span> <span class="n">len</span> <span class="k">else</span> <span class="n">s</span><span class="o">;;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN59"
>Parsing Comma-Separated Data</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="k">let</span> <span class="n">parse_csv</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">regexp</span> <span class="o">=</span> <span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">concat</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">|&quot;</span> <span class="o">[</span>
                             <span class="s2">&quot;</span><span class="se">\&quot;\\</span><span class="s2">([^</span><span class="se">\&quot;\\\\</span><span class="s2">]*</span><span class="se">\\</span><span class="s2">(</span><span class="se">\\\\</span><span class="s2">.[^</span><span class="se">\&quot;\\\\</span><span class="s2">]*</span><span class="se">\\</span><span class="s2">)*</span><span class="se">\\</span><span class="s2">)</span><span class="se">\&quot;</span><span class="s2">,?&quot;</span><span class="o">;</span>
                             <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">([^,]+</span><span class="se">\\</span><span class="s2">),?&quot;</span><span class="o">;</span>
                             <span class="s2">&quot;,&quot;</span><span class="o">;</span>
                           <span class="o">])</span> <span class="k">in</span>
  <span class="k">fun</span> <span class="n">text</span> <span class="o">-&gt;</span>
    <span class="k">let</span> <span class="k">rec</span> <span class="n">loop</span> <span class="n">start</span> <span class="n">result</span> <span class="o">=</span>
      <span class="k">if</span> <span class="nn">Str</span><span class="p">.</span><span class="n">string_match</span> <span class="n">regexp</span> <span class="n">text</span> <span class="n">start</span> <span class="k">then</span>
        <span class="k">let</span> <span class="n">result</span> <span class="o">=</span>
          <span class="o">(</span><span class="k">try</span> <span class="nn">Str</span><span class="p">.</span><span class="n">matched_group</span> <span class="mi">1</span> <span class="n">text</span> <span class="k">with</span> <span class="nc">Not_found</span> <span class="o">-&gt;</span>
             <span class="k">try</span> <span class="nn">Str</span><span class="p">.</span><span class="n">matched_group</span> <span class="mi">3</span> <span class="n">text</span> <span class="k">with</span> <span class="nc">Not_found</span> <span class="o">-&gt;</span>
               <span class="s2">&quot;&quot;</span><span class="o">)</span> <span class="o">::</span> <span class="n">result</span> <span class="k">in</span>
        <span class="n">loop</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">match_end</span> <span class="bp">()</span><span class="o">)</span> <span class="n">result</span>
      <span class="k">else</span>
        <span class="n">result</span> <span class="k">in</span>
    <span class="nn">List</span><span class="p">.</span><span class="n">rev</span> <span class="o">((</span><span class="k">if</span>
                 <span class="k">try</span> <span class="nn">String</span><span class="p">.</span><span class="n">rindex</span> <span class="n">text</span> <span class="sc">&#39;,&#39;</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">text</span> <span class="o">-</span> <span class="mi">1</span>
                 <span class="k">with</span> <span class="nc">Not_found</span> <span class="o">-&gt;</span> <span class="bp">false</span>
               <span class="k">then</span> <span class="o">[</span><span class="s2">&quot;&quot;</span><span class="o">]</span> <span class="k">else</span> <span class="bp">[]</span><span class="o">)</span>
              <span class="o">@</span> <span class="n">loop</span> <span class="mi">0</span> <span class="bp">[]</span><span class="o">)</span>

<span class="k">let</span> <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;XYZZY,</span><span class="se">\&quot;\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">O&#39;Reilly, Inc</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">Wall, Larry</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">a </span><span class="se">\\\&quot;</span><span class="s2">glug</span><span class="se">\\\&quot;</span><span class="s2"> bit,</span><span class="se">\&quot;</span><span class="s2">,5,</span><span class="se">\&quot;</span><span class="s2">Error, Core Dumped</span><span class="se">\&quot;</span><span class="s2">&quot;</span>
<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="nn">Array</span><span class="p">.</span><span class="n">iteri</span>
    <span class="o">(</span><span class="k">fun</span> <span class="n">i</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="nn">Printf</span><span class="p">.</span><span class="n">printf</span> <span class="s2">&quot;%d : %s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">i</span> <span class="n">x</span><span class="o">)</span>
    <span class="o">(</span><span class="nn">Array</span><span class="p">.</span><span class="n">of_list</span> <span class="o">(</span><span class="n">parse_csv</span> <span class="n">line</span><span class="o">))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN62"
>Soundex Matching</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="k">let</span> <span class="n">soundex</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">code_1</span> <span class="o">=</span> <span class="nn">Char</span><span class="p">.</span><span class="n">code</span> <span class="sc">&#39;1&#39;</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">code_A</span> <span class="o">=</span> <span class="nn">Char</span><span class="p">.</span><span class="n">code</span> <span class="sc">&#39;A&#39;</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">code_Z</span> <span class="o">=</span> <span class="nn">Char</span><span class="p">.</span><span class="n">code</span> <span class="sc">&#39;Z&#39;</span> <span class="k">in</span>

  <span class="k">let</span> <span class="n">trans</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">make</span> <span class="o">(</span><span class="n">code_Z</span> <span class="o">-</span> <span class="n">code_A</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="mi">0</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">add_letters</span> <span class="n">number</span> <span class="n">letters</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">add</span> <span class="n">letter</span> <span class="o">=</span>
      <span class="n">trans</span><span class="o">.(</span><span class="nn">Char</span><span class="p">.</span><span class="n">code</span> <span class="n">letter</span> <span class="o">-</span> <span class="n">code_A</span><span class="o">)</span> <span class="o">&lt;-</span> <span class="o">(</span><span class="n">number</span> <span class="o">+</span> <span class="n">code_1</span><span class="o">)</span> <span class="k">in</span>
    <span class="nn">String</span><span class="p">.</span><span class="n">iter</span> <span class="n">add</span> <span class="n">letters</span> <span class="k">in</span>
  <span class="nn">Array</span><span class="p">.</span><span class="n">iteri</span> <span class="n">add_letters</span> <span class="o">[|</span> <span class="s2">&quot;BFPV&quot;</span><span class="o">;</span> <span class="s2">&quot;CGJKQSXZ&quot;</span><span class="o">;</span> <span class="s2">&quot;DT&quot;</span><span class="o">;</span> <span class="s2">&quot;L&quot;</span><span class="o">;</span> <span class="s2">&quot;MN&quot;</span><span class="o">;</span> <span class="s2">&quot;R&quot;</span> <span class="o">|];</span>

  <span class="k">fun</span> <span class="o">?(</span><span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="o">)</span> <span class="n">s</span> <span class="o">-&gt;</span>
    <span class="k">let</span> <span class="n">slength</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">length</span> <span class="n">s</span> <span class="k">in</span>
    <span class="k">let</span> <span class="n">soundex</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">make</span> <span class="n">length</span> <span class="sc">&#39;0&#39;</span> <span class="k">in</span>
    <span class="k">let</span> <span class="k">rec</span> <span class="n">loop</span> <span class="n">i</span> <span class="n">j</span> <span class="n">last</span> <span class="o">=</span>
      <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">slength</span> <span class="o">&amp;&amp;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">length</span> <span class="k">then</span> <span class="k">begin</span>
        <span class="k">let</span> <span class="n">code</span> <span class="o">=</span> <span class="nn">Char</span><span class="p">.</span><span class="n">code</span> <span class="o">(</span><span class="nn">Char</span><span class="p">.</span><span class="n">uppercase</span> <span class="n">s</span><span class="o">.[</span><span class="n">i</span><span class="o">])</span> <span class="k">in</span>
        <span class="k">if</span> <span class="n">code</span> <span class="o">&gt;=</span> <span class="n">code_A</span> <span class="o">&amp;&amp;</span> <span class="n">code</span> <span class="o">&lt;=</span> <span class="n">code_Z</span>
        <span class="k">then</span> <span class="o">(</span><span class="k">if</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
              <span class="k">then</span> <span class="o">(</span><span class="n">soundex</span><span class="o">.[</span><span class="n">j</span><span class="o">]</span> <span class="o">&lt;-</span> <span class="nn">Char</span><span class="p">.</span><span class="n">chr</span> <span class="n">code</span><span class="o">;</span>
                    <span class="n">loop</span> <span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">trans</span><span class="o">.(</span><span class="n">code</span> <span class="o">-</span> <span class="n">code_A</span><span class="o">))</span>
              <span class="k">else</span> <span class="o">(</span><span class="k">match</span> <span class="n">trans</span><span class="o">.(</span><span class="n">code</span> <span class="o">-</span> <span class="n">code_A</span><span class="o">)</span> <span class="k">with</span>
                      <span class="o">|</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="n">loop</span> <span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">j</span> <span class="mi">0</span>
                      <span class="o">|</span> <span class="n">code</span> <span class="k">when</span> <span class="n">code</span> <span class="o">&lt;&gt;</span> <span class="n">last</span> <span class="o">-&gt;</span>
                          <span class="n">soundex</span><span class="o">.[</span><span class="n">j</span><span class="o">]</span> <span class="o">&lt;-</span> <span class="nn">Char</span><span class="p">.</span><span class="n">chr</span> <span class="n">code</span><span class="o">;</span>
                          <span class="n">loop</span> <span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">code</span>
                      <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">loop</span> <span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">j</span> <span class="n">last</span><span class="o">))</span>
        <span class="k">else</span> <span class="n">loop</span> <span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">j</span> <span class="n">last</span>
      <span class="k">end</span> <span class="k">in</span>
    <span class="n">loop</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="o">;</span>
    <span class="n">soundex</span>

<span class="c">(*-----------------------------*)</span>

<span class="k">let</span> <span class="n">code</span> <span class="o">=</span> <span class="n">soundex</span> <span class="kt">string</span><span class="o">;;</span>
<span class="k">let</span> <span class="n">codes</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="n">soundex</span> <span class="kt">list</span><span class="o">;;</span>

<span class="c">(*-----------------------------*)</span>

<span class="o">#</span><span class="n">load</span> <span class="s2">&quot;str.cma&quot;</span>
<span class="o">#</span><span class="n">load</span> <span class="s2">&quot;unix.cma&quot;</span>

<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="n">print_string</span> <span class="s2">&quot;Lookup user: &quot;</span><span class="o">;</span>
  <span class="k">let</span> <span class="n">user</span> <span class="o">=</span> <span class="n">read_line</span> <span class="bp">()</span> <span class="k">in</span>
  <span class="k">if</span> <span class="n">user</span> <span class="o">&lt;&gt;</span> <span class="s2">&quot;&quot;</span> <span class="k">then</span> <span class="k">begin</span>
    <span class="k">let</span> <span class="n">name_code</span> <span class="o">=</span> <span class="n">soundex</span> <span class="n">user</span> <span class="k">in</span>
    <span class="k">let</span> <span class="n">regexp</span> <span class="o">=</span> <span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="o">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">([a-zA-Z_0-9]+</span><span class="se">\\</span><span class="s2">)[^,]*[^a-zA-Z_0-9]+&quot;</span>
                             <span class="o">^</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">([a-zA-Z_0-9]+</span><span class="se">\\</span><span class="s2">)&quot;</span><span class="o">)</span> <span class="k">in</span>
    <span class="k">let</span> <span class="n">passwd</span> <span class="o">=</span> <span class="n">open_in</span> <span class="s2">&quot;/etc/passwd&quot;</span> <span class="k">in</span>
    <span class="k">try</span>
      <span class="k">while</span> <span class="bp">true</span> <span class="k">do</span>
        <span class="k">let</span> <span class="n">line</span> <span class="o">=</span> <span class="n">input_line</span> <span class="n">passwd</span> <span class="k">in</span>
        <span class="k">let</span> <span class="n">name</span> <span class="o">=</span> <span class="nn">String</span><span class="p">.</span><span class="n">sub</span> <span class="n">line</span> <span class="mi">0</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">index</span> <span class="n">line</span> <span class="sc">&#39;:&#39;</span><span class="o">)</span> <span class="k">in</span>
        <span class="k">let</span> <span class="o">{</span><span class="nn">Unix</span><span class="p">.</span><span class="n">pw_gecos</span><span class="o">=</span><span class="n">gecos</span><span class="o">}</span> <span class="o">=</span> <span class="nn">Unix</span><span class="p">.</span><span class="n">getpwnam</span> <span class="n">name</span> <span class="k">in</span>
        <span class="k">let</span> <span class="o">(</span><span class="n">firstname</span><span class="o">,</span> <span class="n">lastname</span><span class="o">)</span> <span class="o">=</span>
          <span class="k">if</span> <span class="nn">Str</span><span class="p">.</span><span class="n">string_match</span> <span class="n">regexp</span> <span class="n">gecos</span> <span class="mi">0</span>
          <span class="k">then</span> <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">matched_group</span> <span class="mi">1</span> <span class="n">gecos</span><span class="o">,</span> <span class="nn">Str</span><span class="p">.</span><span class="n">matched_group</span> <span class="mi">2</span> <span class="n">gecos</span><span class="o">)</span>
          <span class="k">else</span> <span class="o">(</span><span class="s2">&quot;&quot;</span><span class="o">,</span> <span class="s2">&quot;&quot;</span><span class="o">)</span> <span class="k">in</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">name_code</span> <span class="o">=</span> <span class="n">soundex</span> <span class="n">name</span>
            <span class="o">||</span> <span class="n">name_code</span> <span class="o">=</span> <span class="n">soundex</span> <span class="n">lastname</span>
            <span class="o">||</span> <span class="n">name_code</span> <span class="o">=</span> <span class="n">soundex</span> <span class="n">firstname</span><span class="o">)</span>
        <span class="k">then</span> <span class="nn">Printf</span><span class="p">.</span><span class="n">printf</span> <span class="s2">&quot;%s: %s %s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="n">name</span> <span class="n">firstname</span> <span class="n">lastname</span>
      <span class="k">done</span>
    <span class="k">with</span> <span class="nc">End_of_file</span> <span class="o">-&gt;</span>
      <span class="n">close_in</span> <span class="n">passwd</span>
  <span class="k">end</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN65"
>Program: fixstyle</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">(* fixstyle - switch first set of data strings to second set *)</span>
<span class="o">#</span><span class="n">load</span> <span class="s2">&quot;str.cma&quot;</span><span class="o">;;</span>

<span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">create</span> <span class="mi">0</span>
<span class="k">let</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">ref</span> <span class="bp">[]</span>
<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="o">(</span> <span class="o">=&gt;</span> <span class="o">)</span> <span class="n">key</span> <span class="k">value</span> <span class="o">=</span>
    <span class="n">keys</span> <span class="o">:=</span> <span class="n">key</span> <span class="o">::</span> <span class="o">!</span><span class="n">keys</span><span class="o">;</span>
    <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">replace</span> <span class="n">data</span> <span class="n">key</span> <span class="k">value</span> <span class="k">in</span>
  <span class="o">(</span>
    <span class="s2">&quot;analysed&quot;</span>       <span class="o">=&gt;</span> <span class="s2">&quot;analyzed&quot;</span><span class="o">;</span>
    <span class="s2">&quot;built-in&quot;</span>       <span class="o">=&gt;</span> <span class="s2">&quot;builtin&quot;</span><span class="o">;</span>
    <span class="s2">&quot;chastized&quot;</span>      <span class="o">=&gt;</span> <span class="s2">&quot;chastised&quot;</span><span class="o">;</span>
    <span class="s2">&quot;commandline&quot;</span>    <span class="o">=&gt;</span> <span class="s2">&quot;command-line&quot;</span><span class="o">;</span>
    <span class="s2">&quot;de-allocate&quot;</span>    <span class="o">=&gt;</span> <span class="s2">&quot;deallocate&quot;</span><span class="o">;</span>
    <span class="s2">&quot;dropin&quot;</span>         <span class="o">=&gt;</span> <span class="s2">&quot;drop-in&quot;</span><span class="o">;</span>
    <span class="s2">&quot;hardcode&quot;</span>       <span class="o">=&gt;</span> <span class="s2">&quot;hard-code&quot;</span><span class="o">;</span>
    <span class="s2">&quot;meta-data&quot;</span>      <span class="o">=&gt;</span> <span class="s2">&quot;metadata&quot;</span><span class="o">;</span>
    <span class="s2">&quot;multicharacter&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;multi-character&quot;</span><span class="o">;</span>
    <span class="s2">&quot;multiway&quot;</span>       <span class="o">=&gt;</span> <span class="s2">&quot;multi-way&quot;</span><span class="o">;</span>
    <span class="s2">&quot;non-empty&quot;</span>      <span class="o">=&gt;</span> <span class="s2">&quot;nonempty&quot;</span><span class="o">;</span>
    <span class="s2">&quot;non-profit&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;nonprofit&quot;</span><span class="o">;</span>
    <span class="s2">&quot;non-trappable&quot;</span>  <span class="o">=&gt;</span> <span class="s2">&quot;nontrappable&quot;</span><span class="o">;</span>
    <span class="s2">&quot;pre-define&quot;</span>     <span class="o">=&gt;</span> <span class="s2">&quot;predefine&quot;</span><span class="o">;</span>
    <span class="s2">&quot;preextend&quot;</span>      <span class="o">=&gt;</span> <span class="s2">&quot;pre-extend&quot;</span><span class="o">;</span>
    <span class="s2">&quot;re-compiling&quot;</span>   <span class="o">=&gt;</span> <span class="s2">&quot;recompiling&quot;</span><span class="o">;</span>
    <span class="s2">&quot;reenter&quot;</span>        <span class="o">=&gt;</span> <span class="s2">&quot;re-enter&quot;</span><span class="o">;</span>
    <span class="s2">&quot;turnkey&quot;</span>        <span class="o">=&gt;</span> <span class="s2">&quot;turn-key&quot;</span><span class="o">;</span>
  <span class="o">)</span>

<span class="k">let</span> <span class="n">pattern_text</span> <span class="o">=</span>
  <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">(&quot;</span> <span class="o">^</span> <span class="o">(</span><span class="nn">String</span><span class="p">.</span><span class="n">concat</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">|&quot;</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="nn">Str</span><span class="p">.</span><span class="n">quote</span> <span class="o">!</span><span class="n">keys</span><span class="o">))</span> <span class="o">^</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">)&quot;</span>
<span class="k">let</span> <span class="n">pattern</span> <span class="o">=</span> <span class="nn">Str</span><span class="p">.</span><span class="n">regexp</span> <span class="n">pattern_text</span>

<span class="k">let</span> <span class="n">args</span> <span class="o">=</span> <span class="n">ref</span> <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">tl</span> <span class="o">(</span><span class="nn">Array</span><span class="p">.</span><span class="n">to_list</span> <span class="nn">Sys</span><span class="p">.</span><span class="n">argv</span><span class="o">))</span>

<span class="k">let</span> <span class="n">verbose</span> <span class="o">=</span>
  <span class="k">match</span> <span class="o">!</span><span class="n">args</span> <span class="k">with</span>
    <span class="o">|</span> <span class="s2">&quot;-v&quot;</span> <span class="o">::</span> <span class="n">rest</span> <span class="o">-&gt;</span> <span class="n">args</span> <span class="o">:=</span> <span class="n">rest</span><span class="o">;</span> <span class="bp">true</span>
    <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="bp">false</span>

<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">if</span> <span class="o">!</span><span class="n">args</span> <span class="o">=</span> <span class="bp">[]</span>
  <span class="k">then</span> <span class="o">(</span><span class="nn">Printf</span><span class="p">.</span><span class="n">eprintf</span> <span class="s2">&quot;%s: reading from stdin</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="nn">Sys</span><span class="p">.</span><span class="n">argv</span><span class="o">.(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">args</span> <span class="o">:=</span> <span class="o">[</span><span class="s2">&quot;-&quot;</span><span class="o">])</span>

<span class="k">let</span> <span class="n">replace_all</span> <span class="n">text</span> <span class="n">line</span> <span class="n">file</span> <span class="o">=</span>
  <span class="nn">String</span><span class="p">.</span><span class="n">concat</span> <span class="s2">&quot;&quot;</span>
    <span class="o">(</span><span class="nn">List</span><span class="p">.</span><span class="n">map</span>
       <span class="o">(</span><span class="k">function</span>
          <span class="o">|</span> <span class="nn">Str</span><span class="p">.</span><span class="nc">Text</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="n">s</span>
          <span class="o">|</span> <span class="nn">Str</span><span class="p">.</span><span class="nc">Delim</span> <span class="n">s</span> <span class="o">-&gt;</span>
              <span class="k">if</span> <span class="n">verbose</span>
              <span class="k">then</span> <span class="nn">Printf</span><span class="p">.</span><span class="n">eprintf</span> <span class="s2">&quot;%s =&gt; %s at %s line %d.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">s</span> <span class="o">(</span><span class="nn">Hashtbl</span><span class="p">.</span><span class="n">find</span> <span class="n">data</span> <span class="n">s</span><span class="o">)</span> <span class="n">file</span> <span class="n">line</span><span class="o">;</span>
              <span class="nn">Hashtbl</span><span class="p">.</span><span class="n">find</span> <span class="n">data</span> <span class="n">s</span><span class="o">)</span>
       <span class="o">(</span><span class="nn">Str</span><span class="p">.</span><span class="n">full_split</span> <span class="n">pattern</span> <span class="n">text</span><span class="o">))</span>

<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="nn">List</span><span class="p">.</span><span class="n">iter</span>
    <span class="o">(</span><span class="k">fun</span> <span class="n">file</span> <span class="o">-&gt;</span>
       <span class="k">let</span> <span class="n">in_channel</span> <span class="o">=</span>
         <span class="k">if</span> <span class="n">file</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
         <span class="k">then</span> <span class="n">stdin</span>
         <span class="k">else</span> <span class="n">open_in</span> <span class="n">file</span> <span class="k">in</span>
       <span class="k">let</span> <span class="n">line</span> <span class="o">=</span> <span class="n">ref</span> <span class="mi">0</span> <span class="k">in</span>
       <span class="k">try</span>
         <span class="k">while</span> <span class="bp">true</span> <span class="k">do</span>
           <span class="k">let</span> <span class="n">text</span> <span class="o">=</span> <span class="n">input_line</span> <span class="n">in_channel</span> <span class="k">in</span>
           <span class="n">incr</span> <span class="n">line</span><span class="o">;</span>
           <span class="n">print_endline</span> <span class="o">(</span><span class="n">replace_all</span> <span class="n">text</span> <span class="o">!</span><span class="n">line</span> <span class="n">file</span><span class="o">)</span>
         <span class="k">done</span>
       <span class="k">with</span> <span class="nc">End_of_file</span> <span class="o">-&gt;</span>
         <span class="n">close_in</span> <span class="n">in_channel</span><span class="o">)</span>
    <span class="o">!</span><span class="n">args</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN68"
>Program: psgrep</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="o">#!/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ocaml</span>
<span class="c">(* psgrep - print selected lines of ps output by</span>
<span class="c">            compiling user queries into code *)</span>
<span class="o">#</span><span class="n">load</span> <span class="s2">&quot;unix.cma&quot;</span><span class="o">;;</span>

<span class="c">(* Warning: In order to closely approximate the original recipe, this</span>
<span class="c">   example performs dynamic evaluation using the toplevel. This mechanism</span>
<span class="c">   is undocumented and not type-safe. Use at your own risk.</span>

<span class="c">   The &quot;psgrep&quot; utility, defined below, can be used to filter the results</span>
<span class="c">   of the command-line &quot;ps&quot; program. Here are some examples:</span>

<span class="c">   Processes whose command names start with &quot;sh&quot;:</span>

<span class="c">   % psgrep &#39;String.sub command 0 2 = &quot;sh&quot;&#39;</span>

<span class="c">   Processes running with a user ID below 10:</span>

<span class="c">   % psgrep &#39;uid &lt; 10&#39;</span>

<span class="c">   Login shells with active ttys:</span>

<span class="c">   % psgrep &quot;command.[0] = &#39;-&#39;&quot; &#39;tty &lt;&gt; &quot;?&quot;&#39;</span>

<span class="c">   Processes running on pseudo-ttys:</span>

<span class="c">   % psgrep &#39;String.contains &quot;pqrst&quot; tty.[0]&#39;</span>

<span class="c">   Non-superuser processes running detached:</span>

<span class="c">   % psgrep &#39;uid &gt; 0 &amp;&amp; tty = &quot;?&quot;&#39;</span>

<span class="c">   Huge processes that aren&#39;t owned by the superuser:</span>

<span class="c">   % psgrep &#39;vsz &gt; 50000&#39; &#39;uid &lt;&gt; 0&#39;</span>
<span class="c">*)</span>

<span class="c">(* Eval recipe thanks to Clément Capel. *)</span>
<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Toploop</span><span class="p">.</span><span class="n">initialize_toplevel_env</span> <span class="bp">()</span>
<span class="k">let</span> <span class="n">eval</span> <span class="n">text</span> <span class="o">=</span> <span class="k">let</span> <span class="n">lexbuf</span> <span class="o">=</span> <span class="o">(</span><span class="nn">Lexing</span><span class="p">.</span><span class="n">from_string</span> <span class="n">text</span><span class="o">)</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">phrase</span> <span class="o">=</span> <span class="o">!</span><span class="nn">Toploop</span><span class="p">.</span><span class="n">parse_toplevel_phrase</span> <span class="n">lexbuf</span> <span class="k">in</span>
  <span class="n">ignore</span> <span class="o">(</span><span class="nn">Toploop</span><span class="p">.</span><span class="n">execute_phrase</span> <span class="bp">false</span> <span class="nn">Format</span><span class="p">.</span><span class="n">std_formatter</span> <span class="n">phrase</span><span class="o">)</span>
<span class="k">let</span> <span class="n">get</span> <span class="n">name</span> <span class="o">=</span> <span class="nn">Obj</span><span class="p">.</span><span class="n">obj</span> <span class="o">(</span><span class="nn">Toploop</span><span class="p">.</span><span class="n">getvalue</span> <span class="n">name</span><span class="o">)</span>
<span class="k">let</span> <span class="n">set</span> <span class="n">name</span> <span class="k">value</span> <span class="o">=</span> <span class="nn">Toploop</span><span class="p">.</span><span class="n">setvalue</span> <span class="n">name</span> <span class="o">(</span><span class="nn">Obj</span><span class="p">.</span><span class="n">repr</span> <span class="k">value</span><span class="o">)</span>

<span class="c">(* Type for &quot;ps&quot; results. *)</span>
<span class="k">type</span> <span class="n">ps</span> <span class="o">=</span>
    <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="kt">int</span><span class="o">;</span> <span class="n">uid</span> <span class="o">:</span> <span class="kt">int</span><span class="o">;</span> <span class="n">pid</span> <span class="o">:</span> <span class="kt">int</span><span class="o">;</span> <span class="n">ppid</span> <span class="o">:</span> <span class="kt">int</span><span class="o">;</span> <span class="n">pri</span> <span class="o">:</span> <span class="kt">int</span><span class="o">;</span> <span class="n">ni</span> <span class="o">:</span> <span class="kt">string</span><span class="o">;</span>
     <span class="n">vsz</span> <span class="o">:</span> <span class="kt">int</span><span class="o">;</span> <span class="n">rss</span> <span class="o">:</span> <span class="kt">int</span><span class="o">;</span> <span class="n">wchan</span> <span class="o">:</span> <span class="kt">string</span><span class="o">;</span> <span class="n">stat</span> <span class="o">:</span> <span class="kt">string</span><span class="o">;</span> <span class="n">tty</span> <span class="o">:</span> <span class="kt">string</span><span class="o">;</span>
     <span class="n">time</span> <span class="o">:</span> <span class="kt">string</span><span class="o">;</span> <span class="n">command</span> <span class="o">:</span> <span class="kt">string</span><span class="o">}</span>

<span class="c">(* Based on the GNU ps from Debian Linux. Other OSs will most likely</span>
<span class="c">   require changes to this format. *)</span>
<span class="k">let</span> <span class="n">parse_ps_line</span> <span class="n">line</span> <span class="o">=</span>
  <span class="nn">Scanf</span><span class="p">.</span><span class="n">sscanf</span> <span class="n">line</span> <span class="s2">&quot;%d %d %d %d %d %s %d %d %6s %4s %10s %4s %s@</span><span class="se">\000</span><span class="s2">&quot;</span>
    <span class="o">(</span><span class="k">fun</span> <span class="n">f</span> <span class="n">uid</span> <span class="n">pid</span> <span class="n">ppid</span> <span class="n">pri</span> <span class="n">ni</span> <span class="n">vsz</span> <span class="n">rss</span> <span class="n">wchan</span> <span class="n">stat</span> <span class="n">tty</span> <span class="n">time</span> <span class="n">command</span> <span class="o">-&gt;</span>
       <span class="o">{</span><span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="o">;</span> <span class="n">uid</span><span class="o">=</span><span class="n">uid</span><span class="o">;</span> <span class="n">pid</span><span class="o">=</span><span class="n">pid</span><span class="o">;</span> <span class="n">ppid</span><span class="o">=</span><span class="n">ppid</span><span class="o">;</span> <span class="n">pri</span><span class="o">=</span><span class="n">pri</span><span class="o">;</span> <span class="n">ni</span><span class="o">=</span><span class="n">ni</span><span class="o">;</span>
        <span class="n">vsz</span><span class="o">=</span><span class="n">vsz</span><span class="o">;</span> <span class="n">rss</span><span class="o">=</span><span class="n">rss</span><span class="o">;</span> <span class="n">wchan</span><span class="o">=</span><span class="n">wchan</span><span class="o">;</span> <span class="n">stat</span><span class="o">=</span><span class="n">stat</span><span class="o">;</span> <span class="n">tty</span><span class="o">=</span><span class="n">tty</span><span class="o">;</span>
        <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="o">;</span> <span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="o">})</span>

<span class="k">let</span> <span class="n">eval_predicate</span> <span class="n">ps</span> <span class="n">pred</span> <span class="o">=</span>
  <span class="c">(* Use &quot;eval&quot; to initialize each variable&#39;s name and type,</span>
<span class="c">     then use &quot;set&quot; to set a value. *)</span>
  <span class="n">eval</span> <span class="s2">&quot;let f = 0;;&quot;</span><span class="o">;</span>          <span class="n">set</span> <span class="s2">&quot;f&quot;</span> <span class="n">ps</span><span class="o">.</span><span class="n">f</span><span class="o">;</span>
  <span class="n">eval</span> <span class="s2">&quot;let uid = 0;;&quot;</span><span class="o">;</span>        <span class="n">set</span> <span class="s2">&quot;uid&quot;</span> <span class="n">ps</span><span class="o">.</span><span class="n">uid</span><span class="o">;</span>
  <span class="n">eval</span> <span class="s2">&quot;let pid = 0;;&quot;</span><span class="o">;</span>        <span class="n">set</span> <span class="s2">&quot;pid&quot;</span> <span class="n">ps</span><span class="o">.</span><span class="n">pid</span><span class="o">;</span>
  <span class="n">eval</span> <span class="s2">&quot;let ppid = 0;;&quot;</span><span class="o">;</span>       <span class="n">set</span> <span class="s2">&quot;ppid&quot;</span> <span class="n">ps</span><span class="o">.</span><span class="n">ppid</span><span class="o">;</span>
  <span class="n">eval</span> <span class="s2">&quot;let pri = 0;;&quot;</span><span class="o">;</span>        <span class="n">set</span> <span class="s2">&quot;pri&quot;</span> <span class="n">ps</span><span class="o">.</span><span class="n">pri</span><span class="o">;</span>
  <span class="n">eval</span> <span class="s2">&quot;let ni = </span><span class="se">\&quot;\&quot;</span><span class="s2">;;&quot;</span><span class="o">;</span>      <span class="n">set</span> <span class="s2">&quot;ni&quot;</span> <span class="n">ps</span><span class="o">.</span><span class="n">ni</span><span class="o">;</span>
  <span class="n">eval</span> <span class="s2">&quot;let vsz = 0;;&quot;</span><span class="o">;</span>        <span class="n">set</span> <span class="s2">&quot;vsz&quot;</span> <span class="n">ps</span><span class="o">.</span><span class="n">vsz</span><span class="o">;</span>
  <span class="n">eval</span> <span class="s2">&quot;let rss = 0;;&quot;</span><span class="o">;</span>        <span class="n">set</span> <span class="s2">&quot;rss&quot;</span> <span class="n">ps</span><span class="o">.</span><span class="n">rss</span><span class="o">;</span>
  <span class="n">eval</span> <span class="s2">&quot;let wchan = </span><span class="se">\&quot;\&quot;</span><span class="s2">;;&quot;</span><span class="o">;</span>   <span class="n">set</span> <span class="s2">&quot;wchan&quot;</span> <span class="n">ps</span><span class="o">.</span><span class="n">wchan</span><span class="o">;</span>
  <span class="n">eval</span> <span class="s2">&quot;let stat = </span><span class="se">\&quot;\&quot;</span><span class="s2">;;&quot;</span><span class="o">;</span>    <span class="n">set</span> <span class="s2">&quot;stat&quot;</span> <span class="n">ps</span><span class="o">.</span><span class="n">stat</span><span class="o">;</span>
  <span class="n">eval</span> <span class="s2">&quot;let tty = </span><span class="se">\&quot;\&quot;</span><span class="s2">;;&quot;</span><span class="o">;</span>     <span class="n">set</span> <span class="s2">&quot;tty&quot;</span> <span class="n">ps</span><span class="o">.</span><span class="n">tty</span><span class="o">;</span>
  <span class="n">eval</span> <span class="s2">&quot;let time = </span><span class="se">\&quot;\&quot;</span><span class="s2">;;&quot;</span><span class="o">;</span>    <span class="n">set</span> <span class="s2">&quot;time&quot;</span> <span class="n">ps</span><span class="o">.</span><span class="n">time</span><span class="o">;</span>
  <span class="n">eval</span> <span class="s2">&quot;let command = </span><span class="se">\&quot;\&quot;</span><span class="s2">;;&quot;</span><span class="o">;</span> <span class="n">set</span> <span class="s2">&quot;command&quot;</span> <span class="n">ps</span><span class="o">.</span><span class="n">command</span><span class="o">;</span>
  <span class="c">(* Evaluate expression and return result as boolean. *)</span>
  <span class="n">eval</span> <span class="o">(</span><span class="s2">&quot;let result = (&quot;</span> <span class="o">^</span> <span class="n">pred</span> <span class="o">^</span> <span class="s2">&quot;);;&quot;</span><span class="o">);</span>
  <span class="o">(</span><span class="n">get</span> <span class="s2">&quot;result&quot;</span> <span class="o">:</span> <span class="kt">bool</span><span class="o">)</span>

<span class="k">exception</span> <span class="nc">TypeError</span> <span class="k">of</span> <span class="kt">string</span>
<span class="k">exception</span> <span class="nc">SyntaxError</span> <span class="k">of</span> <span class="kt">string</span>

<span class="k">let</span> <span class="n">preds</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">tl</span> <span class="o">(</span><span class="nn">Array</span><span class="p">.</span><span class="n">to_list</span> <span class="nn">Sys</span><span class="p">.</span><span class="n">argv</span><span class="o">)</span>
<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">if</span> <span class="n">preds</span> <span class="o">=</span> <span class="bp">[]</span>
  <span class="k">then</span> <span class="o">(</span><span class="nn">Printf</span><span class="p">.</span><span class="n">eprintf</span> <span class="s2">&quot;usage: %s criterion ...</span>
<span class="s2">    Each criterion is an OCaml expression involving:</span>
<span class="s2">     f uid pid ppid pri ni vsz rss wchan stat tty time command</span>
<span class="s2">    All criteria must be met for a line to be printed.</span>
<span class="s2">&quot;</span> <span class="nn">Sys</span><span class="p">.</span><span class="n">argv</span><span class="o">.(</span><span class="mi">0</span><span class="o">);</span> <span class="n">exit</span> <span class="mi">0</span><span class="o">)</span>

<span class="k">let</span> <span class="bp">()</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">proc</span> <span class="o">=</span> <span class="nn">Unix</span><span class="p">.</span><span class="n">open_process_in</span> <span class="s2">&quot;ps wwaxl&quot;</span> <span class="k">in</span>
  <span class="k">try</span>
    <span class="n">print_endline</span> <span class="o">(</span><span class="n">input_line</span> <span class="n">proc</span><span class="o">);</span>
    <span class="k">while</span> <span class="bp">true</span> <span class="k">do</span>
      <span class="k">let</span> <span class="n">line</span> <span class="o">=</span> <span class="n">input_line</span> <span class="n">proc</span> <span class="k">in</span>
      <span class="k">let</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">parse_ps_line</span> <span class="n">line</span> <span class="k">in</span>
      <span class="k">if</span> <span class="nn">List</span><span class="p">.</span><span class="n">for_all</span>
        <span class="o">(</span><span class="k">fun</span> <span class="n">pred</span> <span class="o">-&gt;</span>
           <span class="k">try</span> <span class="n">eval_predicate</span> <span class="n">ps</span> <span class="n">pred</span>
           <span class="k">with</span> <span class="n">e</span> <span class="o">-&gt;</span>
             <span class="c">(* Convert exceptions to strings to avoid depending on</span>
<span class="c">                additional toplevel libraries. *)</span>
             <span class="k">match</span> <span class="nn">Printexc</span><span class="p">.</span><span class="n">to_string</span> <span class="n">e</span> <span class="k">with</span>
               <span class="o">|</span> <span class="s2">&quot;Typecore.Error(_, _)&quot;</span> <span class="o">-&gt;</span> <span class="k">raise</span> <span class="o">(</span><span class="nc">TypeError</span> <span class="n">pred</span><span class="o">)</span>
               <span class="o">|</span> <span class="s2">&quot;Syntaxerr.Error(_)&quot;</span>
               <span class="o">|</span> <span class="s2">&quot;Lexer.Error(1, _)&quot;</span>
               <span class="o">|</span> <span class="s2">&quot;Lexer.Error(_, _)&quot;</span> <span class="o">-&gt;</span> <span class="k">raise</span> <span class="o">(</span><span class="nc">SyntaxError</span> <span class="n">pred</span><span class="o">)</span>
               <span class="o">|</span> <span class="s2">&quot;Misc.Fatal_error&quot;</span> <span class="o">-&gt;</span> <span class="n">failwith</span> <span class="n">pred</span>
               <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="k">raise</span> <span class="n">e</span><span class="o">)</span>
        <span class="n">preds</span>
      <span class="k">then</span> <span class="n">print_endline</span> <span class="n">line</span>
    <span class="k">done</span>
  <span class="k">with</span>
    <span class="o">|</span> <span class="nc">End_of_file</span> <span class="o">-&gt;</span>
        <span class="n">ignore</span> <span class="o">(</span><span class="nn">Unix</span><span class="p">.</span><span class="n">close_process_in</span> <span class="n">proc</span><span class="o">)</span>
    <span class="o">|</span> <span class="n">e</span> <span class="o">-&gt;</span>
        <span class="n">ignore</span> <span class="o">(</span><span class="nn">Unix</span><span class="p">.</span><span class="n">close_process_in</span> <span class="n">proc</span><span class="o">);</span>
        <span class="k">raise</span> <span class="n">e</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="numbers.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>PLEAC-Objective CAML </TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Numbers</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>