<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Numbers</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Clojure"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Strings"
HREF="strings.html"><LINK
REL="NEXT"
TITLE="Dates and Times"
HREF="datesandtimes.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Clojure</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="strings.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="datesandtimes.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="NUMBERS"
>2. Numbers</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN73"
>Checking Whether a String Is a Valid Number</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span>
<span class="p">(</span><span class="nb">import </span><span class="o">&#39;</span><span class="p">(</span><span class="nf">java.text</span> <span class="nv">NumberFormat</span> <span class="nv">ParseException</span><span class="p">)</span>
        <span class="o">&#39;</span><span class="p">(</span><span class="nf">java.util</span> <span class="nv">Locale</span><span class="p">))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">locale</span> <span class="nv">Locale/US</span><span class="p">)</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">nb</span> <span class="p">[</span><span class="nv">s</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">nf</span> <span class="p">(</span><span class="nf">NumberFormat/getInstance</span> <span class="nv">locale</span><span class="p">)]</span>
    <span class="p">(</span><span class="nf">.parse</span> <span class="nv">nf</span> <span class="nv">s</span><span class="p">)))</span>

<span class="c1">;; user=&gt; (nb &quot;100&quot;)</span>
<span class="c1">;; 100</span>
<span class="c1">;; user=&gt; (nb &quot;not a number&quot;)</span>
<span class="c1">;; java.text.ParseException: Unparseable number: &quot;not a number&quot;</span>

<span class="c1">;; (def s1 &quot;100&quot;)</span>
<span class="c1">;; (def s1 &quot;not a number&quot;)</span>
<span class="p">(</span><span class="nf">try</span>
  <span class="p">(</span><span class="nf">Integer/parseInt</span> <span class="nv">s1</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">catch</span> <span class="nv">NumberFormatException</span> <span class="nv">_ex</span>
    <span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nb">str </span><span class="nv">s1</span> <span class="s">&quot; is not an integer&quot;</span><span class="p">))))</span>

<span class="c1">;; (def s2 3.14)</span>
<span class="c1">;; (def s2 &quot;foo&quot;)</span>
<span class="p">(</span><span class="nf">try</span>
  <span class="p">(</span><span class="nf">Float/parseFloat</span> <span class="nv">s2</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">catch</span> <span class="nv">NumberFormatException</span> <span class="nv">_ex</span>
    <span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nb">str </span><span class="nv">s2</span> <span class="s">&quot; is not a float&quot;</span><span class="p">))))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">isNumeric</span> <span class="p">[</span><span class="nv">s</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">nf</span> <span class="p">(</span><span class="nf">NumberFormat/getInstance</span> <span class="nv">locale</span><span class="p">)]</span>
    <span class="p">(</span><span class="nf">try</span>
      <span class="p">(</span><span class="nf">do</span>
        <span class="p">(</span><span class="nf">.parse</span> <span class="nv">nf</span> <span class="nv">s</span><span class="p">)</span>
        <span class="nv">true</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">catch</span> <span class="nv">ParseException</span> <span class="nv">_ex</span> <span class="nv">false</span><span class="p">))))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN76"
>Comparing Floating-Point Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;----------------------------------------------------------------------------------</span>
<span class="c1">;; (equal NUM1 NUM2 ACCURACY) returns true if NUM1 and NUM2 are</span>
<span class="c1">;; equal to ACCURACY number of decimal places</span>
<span class="c1">;; jli for mbac: not sure if you can use with-precision for this:</span>
<span class="c1">;; http://clojure.github.com/clojure/clojure.core-api.html#clojure.core/with-precision</span>
<span class="p">(</span><span class="kd">defn </span><span class="nv">equal</span> <span class="p">[</span><span class="nv">num1</span> <span class="nv">num2</span> <span class="nv">accuracy</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">letfn</span> <span class="p">[(</span><span class="nf">bignum</span> <span class="p">[</span><span class="nv">num</span><span class="p">]</span>
            <span class="p">(</span><span class="nf">.setScale</span> <span class="p">(</span><span class="nf">BigDecimal.</span> <span class="nv">num</span><span class="p">)</span>
                       <span class="nv">accuracy</span>
                       <span class="nv">BigDecimal/ROUND_DOWN</span><span class="p">))]</span>
    <span class="p">(</span><span class="nb">= </span><span class="mi">0</span> <span class="p">(</span><span class="nf">.compareTo</span> <span class="p">(</span><span class="nf">bignum</span> <span class="nv">num1</span><span class="p">)</span> <span class="p">(</span><span class="nf">bignum</span> <span class="nv">num2</span><span class="p">)))))</span>

<span class="c1">;;----------------------------------------------------------------------------------</span>
<span class="c1">;; with a scaling factor</span>
<span class="c1">;; use &quot;M&quot; suffix for BigDecimal literals</span>
<span class="p">(</span><span class="k">def </span><span class="nv">wage</span> <span class="mf">5.36</span><span class="nv">M</span><span class="p">)</span>
<span class="p">(</span><span class="k">def </span><span class="nv">hours</span> <span class="mi">40</span><span class="nv">M</span><span class="p">)</span>
<span class="p">(</span><span class="k">def </span><span class="nv">week</span> <span class="p">(</span><span class="nf">.multiply</span> <span class="nv">wage</span> <span class="nv">hours</span><span class="p">))</span>

<span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nb">str </span><span class="s">&quot;One week&#39;s wage is: $&quot;</span> <span class="nv">week</span><span class="p">))</span>
<span class="c1">;; One week&#39;s wage is: $214.40</span>
<span class="c1">;;----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN79"
>Rounding Floating-Point Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;----------------------------------------------------------------------------------</span>
<span class="c1">;; (def unrounded ...)</span>
<span class="c1">;; (def scale ...)</span>
<span class="c1">;; (def roundingMode ...)</span>
<span class="p">(</span><span class="k">def </span><span class="nv">rounded</span> <span class="p">(</span><span class="nf">.setScale</span> <span class="nv">unrounded</span> <span class="nv">scale</span> <span class="nv">roundingMode</span><span class="p">))</span>
<span class="c1">;;----------------------------------------------------------------------------------</span>
<span class="p">(</span><span class="k">def </span><span class="nv">a</span> <span class="mf">0.255</span><span class="nv">M</span><span class="p">)</span>
<span class="p">(</span><span class="k">def </span><span class="nv">b</span> <span class="p">(</span><span class="nf">.setScale</span> <span class="nv">a</span> <span class="mi">2</span> <span class="nv">BigDecimal/ROUND_HALF_UP</span><span class="p">))</span>
<span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nb">str </span><span class="s">&quot;Unrounded: &quot;</span> <span class="nv">a</span><span class="p">))</span>
<span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nb">str </span><span class="s">&quot;Rounded: &quot;</span> <span class="nv">b</span><span class="p">))</span>
<span class="c1">;=&gt; Unrounded: 0.255</span>
<span class="c1">;=&gt; Rounded: 0.26</span>
<span class="c1">;;----------------------------------------------------------------------------------</span>
<span class="c1">;; caution, Math.rint() rounds to the nearest integer!</span>
<span class="p">(</span><span class="k">def </span><span class="nv">a</span> <span class="p">[</span><span class="mf">3.3</span> <span class="mf">3.5</span> <span class="mf">3.7</span> <span class="mf">-3.3</span><span class="p">])</span>
<span class="p">(</span><span class="nb">println </span><span class="s">&quot;number\tint\tfloor\ceil&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">x</span><span class="p">]</span> <span class="p">(</span><span class="nb">println </span><span class="p">(</span><span class="nb">str </span><span class="p">(</span><span class="nf">Math/rint</span> <span class="nv">x</span><span class="p">)</span> <span class="s">&quot;\t&quot;</span> <span class="p">(</span><span class="nf">Math/floor</span> <span class="nv">x</span><span class="p">)</span> <span class="s">&quot;\t&quot;</span> <span class="p">(</span><span class="nf">Math/ceil</span> <span class="nv">x</span><span class="p">))))</span> <span class="nv">a</span><span class="p">)</span>
<span class="c1">;;  3.0     3.0     4.0</span>
<span class="c1">;;  4.0     3.0     4.0</span>
<span class="c1">;;  4.0     3.0     4.0</span>
<span class="c1">;; -3.0    -4.0    -3.0</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN82"
>Converting Between Binary and Decimal</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;----------------------------------------------------------------------------------</span>
<span class="p">(</span><span class="k">def </span><span class="nv">i</span> <span class="p">(</span><span class="nf">Integer/parseInt</span> <span class="nv">s</span> <span class="mi">2</span><span class="p">))</span>
<span class="c1">;;----------------------------------------------------------------------------------</span>
<span class="p">(</span><span class="k">def </span><span class="nv">s</span> <span class="p">(</span><span class="nf">Integer/toString</span> <span class="nv">i</span> <span class="mi">2</span><span class="p">))</span>
<span class="c1">;;----------------------------------------------------------------------------------</span>
<span class="c1">;; reader supports &quot;&lt;radix&gt;r&lt;number&gt;&quot;</span>
<span class="p">(</span><span class="k">def </span><span class="nv">i</span> <span class="mi">2</span><span class="nv">r0110110</span><span class="p">)</span> <span class="c1">; i = 54</span>
<span class="c1">;;----------------------------------------------------------------------------------</span>
<span class="p">(</span><span class="k">def </span><span class="nv">s</span> <span class="p">(</span><span class="nf">Integer/toString</span> <span class="mi">54</span> <span class="mi">2</span><span class="p">))</span> <span class="c1">; s = 110110</span>
<span class="c1">;;----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN85"
>Operating on a Series of Integers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;----------------------------------------------------------------------------------</span>
<span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">x</span> <span class="mi">1</span> <span class="nv">y</span> <span class="mi">10</span><span class="p">]</span>
  <span class="p">(</span><span class="nb">doseq </span><span class="p">[</span><span class="nv">i</span> <span class="p">(</span><span class="nb">range </span><span class="nv">x</span> <span class="p">(</span><span class="nb">inc </span><span class="nv">y</span><span class="p">))]</span>
    <span class="c1">;; i is set to every integer from X to Y inclusive</span>
    <span class="p">))</span>

<span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">x</span> <span class="mi">1</span> <span class="nv">y</span> <span class="mi">10</span><span class="p">]</span>
  <span class="p">(</span><span class="nb">doseq </span><span class="p">[</span><span class="nv">i</span> <span class="p">(</span><span class="nb">range </span><span class="nv">x</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">y</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">7</span><span class="p">)]</span>
    <span class="c1">;; i is set to every integer from X to Y, stepsize = 7</span>
    <span class="p">))</span>

<span class="c1">;;----------------------------------------------------------------------------------</span>
<span class="p">(</span><span class="nb">apply println </span><span class="p">(</span><span class="nb">cons </span><span class="s">&quot;Infancy is:&quot;</span> <span class="p">(</span><span class="nb">range </span><span class="mi">0</span> <span class="mi">3</span><span class="p">)))</span>
<span class="p">(</span><span class="nb">apply println </span><span class="p">(</span><span class="nb">cons </span><span class="s">&quot;Toddling is:&quot;</span> <span class="p">(</span><span class="nb">range </span><span class="mi">3</span> <span class="mi">5</span><span class="p">)))</span>
<span class="p">(</span><span class="nb">apply println </span><span class="p">(</span><span class="nb">cons </span><span class="s">&quot;Childhood is:&quot;</span> <span class="p">(</span><span class="nb">range </span><span class="mi">5</span> <span class="mi">13</span><span class="p">)))</span>
<span class="c1">;; Infancy is: 0 1 2</span>
<span class="c1">;; Toddling is: 3 4</span>
<span class="c1">;; Childhood is: 5 6 7 8 9 10 11 12</span>
<span class="c1">;;----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN88"
>Working with Roman Numerals</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;----------------------------------------------------------------------------------</span>
<span class="c1">;; no roman module available</span>
<span class="c1">;;----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN91"
>Generating Random Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;----------------------------------------------------------------------------------</span>
<span class="p">(</span><span class="nb">import </span><span class="o">&#39;</span><span class="p">(</span><span class="nf">java.util</span> <span class="nv">Random</span><span class="p">))</span>
<span class="p">(</span><span class="k">def </span><span class="nv">random</span> <span class="p">(</span><span class="nf">Random.</span> <span class="p">))</span>
<span class="p">(</span><span class="k">def </span><span class="nv">i</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">.nextInt</span> <span class="nv">random</span> <span class="p">(</span><span class="nb">- </span><span class="nv">y</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="mi">1</span><span class="p">)))</span> <span class="nv">x</span><span class="p">))</span>
<span class="c1">;;----------------------------------------------------------------------------------</span>
<span class="p">(</span><span class="k">def </span><span class="nv">i</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">.nextInt</span> <span class="nv">random</span> <span class="mi">51</span><span class="p">)</span> <span class="mi">25</span><span class="p">))</span>
<span class="p">(</span><span class="nb">println </span><span class="nv">i</span><span class="p">)</span>
<span class="c1">;;----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN94"
>Generating Different Random Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;;----------------------------------------------------------------------------------</span>
<span class="c1">;; Seed the generator with an integer</span>
<span class="p">(</span><span class="nf">Random.</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1">;; Use SecureRandom instead to seed with bytes from stdin</span>
<span class="p">(</span><span class="nb">import </span><span class="o">&#39;</span><span class="p">(</span><span class="nf">java.security</span> <span class="nv">SecureRandom</span><span class="p">))</span>
<span class="c1">;; jli for mbac: unqualified &quot;use&quot; is almost always ungood. use :only</span>
<span class="c1">;; or :rename.</span>
<span class="c1">;; mbac: fixed!</span>
<span class="p">(</span><span class="nf">use</span> <span class="o">&#39;</span><span class="p">[</span><span class="nv">clojure.contrib.io</span> <span class="ss">:only</span> <span class="p">(</span><span class="nf">to-byte-array</span><span class="p">)])</span>
<span class="p">(</span><span class="nf">SecureRandom.</span> <span class="p">(</span><span class="nf">to-byte-array</span> <span class="nv">System/in</span><span class="p">))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN97"
>Making Numbers Even More Random</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">srng</span> <span class="p">(</span><span class="nf">SecureRandom.</span><span class="p">)</span>
      <span class="nv">buf</span> <span class="p">(</span><span class="nf">byte-array</span> <span class="mi">10</span><span class="p">)]</span>
  <span class="p">(</span><span class="nf">do</span>
    <span class="p">(</span><span class="nf">.nextBytes</span> <span class="nv">srng</span> <span class="nv">buf</span><span class="p">)</span>
    <span class="nv">buf</span><span class="p">))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN100"
>Generating Biased Random Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="k">def </span><span class="nv">prng</span> <span class="p">(</span><span class="nf">Random.</span><span class="p">))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">gaussian-rand</span> <span class="p">[]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[[</span><span class="nv">w</span> <span class="nv">u1</span> <span class="nv">u2</span><span class="p">]</span> <span class="p">(</span><span class="k">loop </span><span class="p">[]</span>
                    <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">u1</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">* </span><span class="mi">2</span> <span class="p">(</span><span class="nf">.nextDouble</span> <span class="nv">prng</span><span class="p">))</span> <span class="mi">1</span><span class="p">)</span>
                          <span class="nv">u2</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">* </span><span class="mi">2</span> <span class="p">(</span><span class="nf">.nextDouble</span> <span class="nv">prng</span><span class="p">))</span> <span class="mi">1</span><span class="p">)</span>
                          <span class="nv">w</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nb">* </span><span class="nv">u1</span> <span class="nv">u1</span><span class="p">)</span> <span class="p">(</span><span class="nb">* </span><span class="nv">u2</span> <span class="nv">u2</span><span class="p">))]</span>
                      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt;= </span><span class="nv">w</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="p">(</span><span class="nf">recur</span><span class="p">)</span>
                        <span class="p">[</span><span class="nv">w</span> <span class="nv">u1</span> <span class="nv">u2</span><span class="p">])))</span>
        <span class="nv">w</span> <span class="p">(</span><span class="nf">Math/sqrt</span> <span class="p">(</span><span class="nb">* </span><span class="mi">-2</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">Math/log</span> <span class="nv">w</span><span class="p">)</span> <span class="nv">w</span><span class="p">)))</span>
        <span class="nv">g2</span> <span class="p">(</span><span class="nb">* </span><span class="nv">u1</span> <span class="nv">w</span><span class="p">)</span>
        <span class="nv">g1</span> <span class="p">(</span><span class="nb">* </span><span class="nv">u2</span> <span class="nv">w</span><span class="p">)]</span>
    <span class="nv">g1</span><span class="p">))</span>

<span class="c1">;; -----------------------------</span>
<span class="c1">;; weight-to-dist: takes a list of pairs mapping key to weight and</span>
<span class="c1">;; returns a list of pairs mapping key to probability</span>
<span class="p">(</span><span class="kd">defn </span><span class="nv">weight-to-dist</span> <span class="p">[</span><span class="nv">weights</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">total</span> <span class="p">(</span><span class="nb">apply + </span><span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nv">_key</span> <span class="nv">weight</span><span class="p">]]</span> <span class="nv">weight</span><span class="p">)</span> <span class="nv">weights</span><span class="p">))]</span>
    <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nb">key </span><span class="nv">weight</span><span class="p">]]</span> <span class="p">[</span><span class="nb">key </span><span class="p">(</span><span class="nb">/ </span><span class="nv">weight</span> <span class="nv">total</span><span class="p">)])</span>
         <span class="nv">weights</span><span class="p">)))</span>

<span class="c1">;; weighted-rand: takes a list of pairs mapping key to probability</span>
<span class="c1">;; and returns the corresponding key</span>
<span class="p">(</span><span class="kd">defn </span><span class="nv">weighted-rand</span> <span class="p">[</span><span class="nv">dist</span><span class="p">]</span>
  <span class="c1">;; accumulate without mutation</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">go</span> <span class="p">(</span><span class="k">fn </span><span class="nv">cont</span> <span class="p">[</span><span class="nv">p</span> <span class="nv">lst</span><span class="p">]</span>
             <span class="p">(</span><span class="nb">if-let </span><span class="p">[[</span><span class="nb">key </span><span class="nv">weight</span><span class="p">]</span> <span class="p">(</span><span class="nb">first </span><span class="nv">lst</span><span class="p">)]</span>
               <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">pp</span> <span class="p">(</span><span class="nb">- </span><span class="nv">p</span> <span class="nv">weight</span><span class="p">)]</span>
                 <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">pp</span> <span class="mi">0</span><span class="p">)</span>
                   <span class="p">[</span><span class="nv">pp</span> <span class="nv">key</span><span class="p">]</span>
                   <span class="p">(</span><span class="nf">recur</span> <span class="nv">pp</span> <span class="p">(</span><span class="nb">rest </span><span class="nv">lst</span><span class="p">))))))</span>
        <span class="nv">result</span> <span class="p">(</span><span class="nf">go</span> <span class="p">(</span><span class="nf">.nextDouble</span> <span class="p">(</span><span class="nf">Random.</span><span class="p">))</span> <span class="nv">dist</span><span class="p">)]</span>
    <span class="c1">;; to avoid floating point inaccuracies</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">nil? </span><span class="nv">result</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">recur</span> <span class="nv">dist</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let </span><span class="p">[[</span><span class="nv">_p</span> <span class="nv">key</span><span class="p">]</span> <span class="nv">result</span><span class="p">]</span>
        <span class="nv">key</span><span class="p">))))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">mean</span> <span class="mi">25</span><span class="p">)</span>
<span class="p">(</span><span class="k">def </span><span class="nv">stddev</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">(</span><span class="k">def </span><span class="nv">salary</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">gaussian-rand</span><span class="p">)</span> <span class="nv">stddev</span><span class="p">)</span> <span class="nv">mean</span><span class="p">))</span>
<span class="p">(</span><span class="nf">printf</span> <span class="s">&quot;You have been hired at $%.2f\n&quot;</span> <span class="nv">salary</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN103"
>Doing Trigonometry in Degrees, not Radians</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="kd">defn </span><span class="nv">radians</span> <span class="p">[</span><span class="nv">deg</span><span class="p">]</span> <span class="p">(</span><span class="nf">Math/toRadians</span> <span class="nv">deg</span><span class="p">))</span>
<span class="p">(</span><span class="kd">defn </span><span class="nv">degrees</span> <span class="p">[</span><span class="nv">rad</span><span class="p">]</span> <span class="p">(</span><span class="nf">Math/toDegrees</span> <span class="nv">rad</span><span class="p">))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">sin-deg</span> <span class="p">[</span><span class="nv">deg</span><span class="p">]</span> <span class="p">(</span><span class="nf">Math/sin</span> <span class="p">(</span><span class="nf">radians</span> <span class="nv">deg</span><span class="p">)))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN106"
>Calculating More Trigonometric Functions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="kd">defn </span><span class="nv">tan</span> <span class="p">[</span><span class="nv">theta</span><span class="p">]</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">Math/sin</span> <span class="nv">theta</span><span class="p">)</span> <span class="p">(</span><span class="nf">Math/cos</span> <span class="nv">theta</span><span class="p">)))</span>
<span class="c1">;; or use Math/tan</span>

<span class="p">(</span><span class="k">def </span><span class="nv">y</span>
  <span class="p">(</span><span class="nf">try</span>
    <span class="p">(</span><span class="nf">tan</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">Math/PI</span> <span class="mi">2</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">catch</span> <span class="nv">Exception</span> <span class="nv">e</span> <span class="nv">nil</span><span class="p">)))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN109"
>Taking Logarithms</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="kd">defn </span><span class="nv">log_e</span> <span class="p">[</span><span class="nv">x</span><span class="p">]</span> <span class="p">(</span><span class="nf">Math/log</span> <span class="nv">x</span><span class="p">))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">log_10</span> <span class="p">[</span><span class="nv">x</span><span class="p">]</span> <span class="p">(</span><span class="nf">Math/log10</span> <span class="nv">x</span><span class="p">))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">log-base</span> <span class="p">[</span><span class="nv">base</span> <span class="nv">value</span><span class="p">]</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">log_e</span> <span class="nv">value</span><span class="p">)</span> <span class="p">(</span><span class="nf">log_e</span> <span class="nv">base</span><span class="p">)))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">answer</span> <span class="p">(</span><span class="nf">log-base</span> <span class="mi">10</span> <span class="mi">10000</span><span class="p">))</span>
<span class="p">(</span><span class="nf">printf</span> <span class="s">&quot;log10(10,000) = %f&quot;</span> <span class="nv">answer</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN112"
>Multiplying Matrices</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; This is a very academic, purely functional implementation of</span>
<span class="c1">;; multiply-matrix.  A performance critical implementation would</span>
<span class="c1">;; likely not use Clojure&#39;s immutable vectors.</span>
<span class="p">(</span><span class="kd">defn </span><span class="nv">multiply-matrix</span> <span class="p">[</span><span class="nv">m1</span> <span class="nv">m2</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">dim</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">m</span><span class="p">]</span> <span class="p">[(</span><span class="nb">count </span><span class="nv">m</span><span class="p">)</span> <span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">first </span><span class="nv">m</span><span class="p">))])</span>
        <span class="p">[</span><span class="nv">r1</span> <span class="nv">c1</span><span class="p">]</span> <span class="p">(</span><span class="nf">dim</span> <span class="nv">m1</span><span class="p">)</span>
        <span class="p">[</span><span class="nv">r2</span> <span class="nv">c2</span><span class="p">]</span> <span class="p">(</span><span class="nf">dim</span> <span class="nv">m2</span><span class="p">)]</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">= </span><span class="nv">c1</span> <span class="nv">r2</span><span class="p">))</span>
      <span class="nv">nil</span> <span class="c1">; matrix dimensions don&#39;t match</span>
      <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">dot-product</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">v1</span> <span class="nv">v2</span><span class="p">]</span>
                          <span class="p">(</span><span class="nb">reduce </span><span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">a</span> <span class="nv">i</span><span class="p">]</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">a</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nb">nth </span><span class="nv">v1</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nb">nth </span><span class="nv">v2</span> <span class="nv">i</span><span class="p">))))</span>
                                  <span class="mi">0</span>
                                  <span class="p">(</span><span class="nb">range </span><span class="mi">0</span> <span class="p">(</span><span class="nb">count </span><span class="nv">v1</span><span class="p">))))</span>
            <span class="nv">row</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">m</span> <span class="nv">i</span><span class="p">]</span> <span class="p">(</span><span class="nb">nth </span><span class="nv">m</span> <span class="nv">i</span><span class="p">))</span>
            <span class="nv">col</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">m</span> <span class="nv">i</span><span class="p">]</span> <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">r</span><span class="p">]</span> <span class="p">(</span><span class="nb">nth </span><span class="p">(</span><span class="nb">nth </span><span class="nv">m</span> <span class="nv">r</span><span class="p">)</span> <span class="nv">i</span><span class="p">))</span>
                               <span class="p">(</span><span class="nb">range </span><span class="p">(</span><span class="nb">count </span><span class="nv">m</span><span class="p">))))]</span>
        <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">r</span><span class="p">]</span>
               <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">c</span><span class="p">]</span> <span class="p">(</span><span class="nf">dot-product</span> <span class="p">(</span><span class="nf">row</span> <span class="nv">m1</span> <span class="nv">r</span><span class="p">)</span> <span class="p">(</span><span class="nf">col</span> <span class="nv">m2</span> <span class="nv">c</span><span class="p">)))</span>
                    <span class="p">(</span><span class="nb">range </span><span class="mi">0</span> <span class="nv">c2</span><span class="p">)))</span>
             <span class="p">(</span><span class="nb">range </span><span class="mi">0</span> <span class="nv">r1</span><span class="p">))))))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN115"
>Using Complex Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; c = a * b manually</span>
<span class="p">(</span><span class="kd">defrecord </span><span class="nv">Complex</span> <span class="p">[</span><span class="nv">real</span> <span class="nv">imag</span><span class="p">])</span>
<span class="p">(</span><span class="kd">defn </span><span class="nv">mul</span> <span class="p">[</span><span class="nv">a</span> <span class="nv">b</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">Complex.</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">.real</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">.real</span> <span class="nv">b</span><span class="p">))</span>
            <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">.imag</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">.imag</span> <span class="nv">b</span><span class="p">))))</span>

<span class="c1">;; c = a * b using the complex-numbers module</span>
<span class="p">(</span><span class="nf">use</span> <span class="o">&#39;</span><span class="p">(</span><span class="nf">clojure.contrib</span> <span class="nv">complex-numbers</span><span class="p">)</span>
     <span class="o">&#39;</span><span class="p">(</span><span class="nf">clojure.contrib.generic</span> <span class="p">[</span><span class="nv">arithmetic</span> <span class="ss">:only</span> <span class="p">[</span><span class="nb">+ </span><span class="nv">*</span><span class="p">]]</span>
                               <span class="p">[</span><span class="nv">math-functions</span> <span class="ss">:only</span> <span class="p">[</span><span class="nv">sqrt</span><span class="p">]]))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">a</span> <span class="p">(</span><span class="nf">complex</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">(</span><span class="k">def </span><span class="nv">b</span> <span class="p">(</span><span class="nf">complex</span> <span class="mi">2</span> <span class="mi">-2</span><span class="p">))</span>
<span class="p">(</span><span class="k">def </span><span class="nv">c</span> <span class="p">(</span><span class="nb">* </span><span class="nv">a</span> <span class="nv">b</span><span class="p">))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">c</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">complex</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="nf">complex</span> <span class="mi">2</span> <span class="mi">-2</span><span class="p">)))</span> <span class="c1">; or on one line</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">print-complex-sqrt</span> <span class="p">[</span><span class="nv">x</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">as-string</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">c</span><span class="p">]</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;%s+%si&quot;</span>
                                  <span class="p">(</span><span class="nf">real</span> <span class="nv">c</span><span class="p">)</span>
                                  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nf">imag</span> <span class="nv">c</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span> <span class="s">&quot;&quot;</span> <span class="p">(</span><span class="nf">imag</span> <span class="nv">c</span><span class="p">))))]</span>
    <span class="p">(</span><span class="nf">printf</span> <span class="s">&quot;sqrt(%s) = %s\n&quot;</span>
           <span class="p">(</span><span class="nf">as-string</span> <span class="nv">x</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">as-string</span> <span class="p">(</span><span class="nf">sqrt</span> <span class="nv">x</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">def </span><span class="nv">d</span> <span class="p">(</span><span class="nf">complex</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))</span>
<span class="p">(</span><span class="nf">print-complex-sqrt</span> <span class="nv">d</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN118"
>Converting Between Octal and Hexadecimal</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; hex and octal should not have leading 0x or 0 characters</span>
<span class="p">(</span><span class="kd">defn </span><span class="nv">hex-and-oct-as-decs</span> <span class="p">[</span><span class="nv">hex</span> <span class="nv">octal</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">dec-of-hex</span> <span class="p">(</span><span class="nf">Integer/parseInt</span> <span class="nv">hex</span> <span class="mi">16</span><span class="p">)</span>
        <span class="nv">dec-of-oct</span> <span class="p">(</span><span class="nf">Integer/parseInt</span> <span class="nv">octal</span> <span class="mi">8</span><span class="p">)]</span>
    <span class="c1">;; use dec-of-hex and dec-of-oct here</span>
    <span class="p">))</span>

<span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">num</span> <span class="p">(</span><span class="nf">-&gt;</span>
           <span class="p">(</span><span class="nf">do</span>
             <span class="p">(</span><span class="nb">print </span><span class="s">&quot;Gimme a number in decimal, octal, or hex: &quot;</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">read-line</span><span class="p">))</span>
           <span class="nv">.trim</span>
           <span class="nv">Integer/parseInt</span><span class="p">)]</span>
  <span class="p">(</span><span class="nf">printf</span> <span class="s">&quot;%s %s %s\n&quot;</span>
          <span class="p">(</span><span class="nf">Integer/toString</span> <span class="nv">num</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">Integer/toOctalString</span> <span class="nv">num</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">Integer/toHexString</span> <span class="nv">num</span><span class="p">)))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN121"
>Putting Commas in Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="nb">import </span><span class="o">&#39;</span><span class="p">(</span><span class="nf">java.text</span> <span class="nv">NumberFormat</span><span class="p">)</span>
        <span class="o">&#39;</span><span class="p">(</span><span class="nf">java.util</span> <span class="nv">Locale</span><span class="p">))</span>
<span class="p">(</span><span class="k">def </span><span class="nv">locale</span> <span class="nv">Locale/US</span><span class="p">)</span>
<span class="p">(</span><span class="kd">defn </span><span class="nv">commify-localized</span> <span class="p">[</span><span class="nv">num</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">nf</span> <span class="p">(</span><span class="nf">NumberFormat/getInstance</span> <span class="nv">locale</span><span class="p">)]</span>
    <span class="p">(</span><span class="nf">.format</span> <span class="nv">nf</span> <span class="nv">num</span><span class="p">)))</span>

<span class="c1">;; deck version</span>
<span class="p">(</span><span class="kd">defn </span><span class="nv">commify-hipster</span> <span class="p">[</span><span class="nv">numstr</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">-&gt;&gt;</span> <span class="p">(</span><span class="nf">.toString</span> <span class="nv">numstr</span><span class="p">)</span>
       <span class="nv">reverse</span>
       <span class="p">(</span><span class="nf">partition-all</span> <span class="mi">3</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">interpose</span> <span class="sc">\,</span><span class="p">)</span>
       <span class="nv">flatten</span>
       <span class="nv">reverse</span>
       <span class="p">(</span><span class="nb">apply </span><span class="nv">str</span><span class="p">)))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN124"
>Printing Correct Plurals</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="kd">defn </span><span class="nv">print-plurals</span> <span class="p">[</span><span class="nv">hours</span> <span class="nv">centuries</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">do</span>
    <span class="p">(</span><span class="nf">printf</span> <span class="s">&quot;It took %d hour%s\n&quot;</span> <span class="nv">hours</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">hours</span> <span class="mi">1</span><span class="p">)</span> <span class="s">&quot;&quot;</span> <span class="s">&quot;s&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">printf</span> <span class="s">&quot;%d hour%s %s enough.\n&quot;</span>
            <span class="nv">hours</span>
            <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">hours</span> <span class="mi">1</span><span class="p">)</span> <span class="s">&quot;&quot;</span> <span class="s">&quot;s&quot;</span><span class="p">)</span>
            <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">hours</span> <span class="mi">1</span><span class="p">)</span> <span class="s">&quot;is&quot;</span> <span class="s">&quot;are&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">printf</span> <span class="s">&quot;It took %d centur%s\n&quot;</span> <span class="nv">centuries</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">centuries</span> <span class="mi">1</span><span class="p">)</span> <span class="s">&quot;y&quot;</span> <span class="s">&quot;ies&quot;</span><span class="p">))))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">noun-rules</span>
  <span class="p">[[</span><span class="o">#</span><span class="s">&quot;ss$&quot;</span> <span class="s">&quot;sses&quot;</span><span class="p">]</span>
   <span class="p">[</span><span class="o">#</span><span class="s">&quot;ph$&quot;</span> <span class="s">&quot;phes&quot;</span><span class="p">]</span>
   <span class="p">[</span><span class="o">#</span><span class="s">&quot;sh$&quot;</span> <span class="s">&quot;shes&quot;</span><span class="p">]</span>
   <span class="p">[</span><span class="o">#</span><span class="s">&quot;ch$&quot;</span> <span class="s">&quot;ches&quot;</span><span class="p">]</span>
   <span class="p">[</span><span class="o">#</span><span class="s">&quot;z$&quot;</span>  <span class="s">&quot;zes&quot;</span><span class="p">]</span>
   <span class="p">[</span><span class="o">#</span><span class="s">&quot;ff$&quot;</span> <span class="s">&quot;ffs&quot;</span><span class="p">]</span>
   <span class="p">[</span><span class="o">#</span><span class="s">&quot;f$&quot;</span>  <span class="s">&quot;ves&quot;</span><span class="p">]</span>
   <span class="p">[</span><span class="o">#</span><span class="s">&quot;ey$&quot;</span> <span class="s">&quot;eys&quot;</span><span class="p">]</span>
   <span class="p">[</span><span class="o">#</span><span class="s">&quot;y$&quot;</span>  <span class="s">&quot;ies&quot;</span><span class="p">]</span>
   <span class="p">[</span><span class="o">#</span><span class="s">&quot;ix$&quot;</span> <span class="s">&quot;ices&quot;</span><span class="p">]</span>
   <span class="p">[</span><span class="o">#</span><span class="s">&quot;s$&quot;</span>  <span class="s">&quot;ses&quot;</span><span class="p">]</span>
   <span class="p">[</span><span class="o">#</span><span class="s">&quot;x$&quot;</span>  <span class="s">&quot;xes&quot;</span><span class="p">]</span>
   <span class="p">[</span><span class="o">#</span><span class="s">&quot;$&quot;</span>   <span class="s">&quot;s&quot;</span><span class="p">]])</span>

<span class="p">(</span><span class="nf">require</span> <span class="o">&#39;</span><span class="p">(</span><span class="nf">clojure.contrib</span> <span class="p">[</span><span class="nv">str-utils2</span> <span class="ss">:as</span> <span class="nv">s</span><span class="p">]))</span>
<span class="p">(</span><span class="kd">defn </span><span class="nv">noun_plural</span> <span class="p">[</span><span class="nv">word</span><span class="p">]</span>
  <span class="p">(</span><span class="nb">some </span><span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nv">re</span> <span class="nv">ending</span><span class="p">]]</span>
          <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">re-find </span><span class="nv">re</span> <span class="nv">word</span><span class="p">)</span> <span class="p">(</span><span class="nf">s/replace</span> <span class="nv">word</span> <span class="nv">re</span> <span class="nv">ending</span><span class="p">)))</span>
        <span class="nv">noun-rules</span><span class="p">))</span>
<span class="p">(</span><span class="k">def </span><span class="nv">verb_singular</span> <span class="nv">noun_plural</span><span class="p">)</span> <span class="c1">; make function alias</span>

<span class="c1">;; Note: there&#39;s no perl Lingua::EN::Inflect equivalent module</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN127"
>Program: Calculating Prime Factors</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; jli for mbac: shouldn&#39;t this return {orig 1} for prime numbers?</span>
<span class="c1">;; mbac for jli: maybe, but the perl version doesn&#39;t do this either</span>
<span class="p">(</span><span class="kd">defn </span><span class="nv">get-factors</span> <span class="p">[</span><span class="nv">orig</span><span class="p">]</span>
  <span class="p">(</span><span class="nf">letfn</span> <span class="p">[(</span><span class="nf">factor-out</span> <span class="p">[</span><span class="nv">n</span> <span class="nv">factors</span> <span class="nv">i</span><span class="p">]</span>
            <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">zero? </span><span class="p">(</span><span class="nf">mod</span> <span class="nv">n</span> <span class="nv">i</span><span class="p">))</span>
              <span class="p">(</span><span class="nf">recur</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">n</span> <span class="nv">i</span><span class="p">)</span>
                     <span class="p">(</span><span class="nb">assoc </span><span class="nv">factors</span> <span class="nv">i</span> <span class="p">(</span><span class="nb">inc </span><span class="p">(</span><span class="nf">factors</span> <span class="nv">i</span> <span class="mi">0</span><span class="p">)))</span>
                     <span class="nv">i</span><span class="p">)</span>
              <span class="p">[</span><span class="nv">n</span> <span class="nv">factors</span><span class="p">]))]</span>
    <span class="p">(</span><span class="k">loop </span><span class="p">[</span><span class="nv">i</span> <span class="mi">2</span>
           <span class="nv">sqi</span> <span class="mi">4</span>
           <span class="p">[</span><span class="nv">n</span> <span class="nv">factors</span><span class="p">]</span> <span class="p">[</span><span class="nv">orig</span> <span class="p">{}]]</span>
      <span class="p">(</span><span class="nf">cond</span>
       <span class="p">(</span><span class="nb">&lt;= </span><span class="nv">sqi</span> <span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nf">recur</span> <span class="p">(</span><span class="nb">inc </span><span class="nv">i</span><span class="p">)</span>
                         <span class="p">(</span><span class="nb">+ </span><span class="nv">sqi</span> <span class="p">(</span><span class="nb">* </span><span class="mi">2</span> <span class="nv">i</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
                         <span class="p">(</span><span class="nf">factor-out</span> <span class="nv">n</span> <span class="nv">factors</span> <span class="nv">i</span><span class="p">))</span>
       <span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">not= </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">not= </span><span class="nv">n</span> <span class="nv">orig</span><span class="p">))</span> <span class="p">(</span><span class="nb">assoc </span><span class="nv">factors</span> <span class="nv">n</span> <span class="p">(</span><span class="nb">inc </span><span class="p">(</span><span class="nf">factors</span> <span class="nv">n</span> <span class="mi">0</span><span class="p">)))</span>
       <span class="ss">:default</span> <span class="nv">factors</span><span class="p">))))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">print-factors</span> <span class="p">[</span><span class="nv">orig</span> <span class="nv">factors</span><span class="p">]</span>
  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">head</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;%-10d&quot;</span> <span class="nv">orig</span><span class="p">)</span>
        <span class="nv">lines</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">zero? </span><span class="p">(</span><span class="nb">count </span><span class="nv">factors</span><span class="p">))</span>
                <span class="p">[</span><span class="s">&quot;PRIME&quot;</span><span class="p">]</span>
                <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">fn </span><span class="p">[[</span><span class="nv">f</span> <span class="nv">e</span><span class="p">]]</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;%d^%d&quot;</span> <span class="nv">f</span> <span class="nv">e</span><span class="p">))</span> <span class="nv">factors</span><span class="p">))</span>
        <span class="nv">s</span> <span class="p">(</span><span class="nb">apply str </span><span class="p">(</span><span class="nf">interpose</span> <span class="s">&quot;\n&quot;</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">head</span> <span class="nv">lines</span><span class="p">)))]</span>
    <span class="p">(</span><span class="nb">println </span><span class="nv">s</span><span class="p">)))</span>

<span class="p">(</span><span class="k">loop </span><span class="p">[</span><span class="nv">i</span> <span class="mi">0</span><span class="p">]</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">i</span> <span class="p">(</span><span class="nb">count </span><span class="nv">*command-line-args*</span><span class="p">))</span>
    <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">n</span> <span class="p">(</span><span class="nf">Integer/parseInt</span> <span class="p">(</span><span class="nf">.get</span> <span class="nv">argv</span> <span class="nv">i</span><span class="p">))]</span>
      <span class="p">(</span><span class="nf">do</span>
        <span class="p">(</span><span class="nf">print-factors</span> <span class="nv">n</span> <span class="p">(</span><span class="nf">factorize</span> <span class="nv">n</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">recur</span> <span class="p">(</span><span class="nb">inc </span><span class="nv">i</span><span class="p">))))))</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="strings.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="datesandtimes.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Strings</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Dates and Times</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>