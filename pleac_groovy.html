<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=latin1">
  <style type="text/css">
td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }
body .hll { background-color: #ffffcc }
body  { background: #f8f8f8; }
body .c { color: #408080; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #008000; font-weight: bold } /* Keyword */
body .o { color: #666666 } /* Operator */
body .cm { color: #408080; font-style: italic } /* Comment.Multiline */
body .cp { color: #BC7A00 } /* Comment.Preproc */
body .c1 { color: #408080; font-style: italic } /* Comment.Single */
body .cs { color: #408080; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #FF0000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #00A000 } /* Generic.Inserted */
body .go { color: #888888 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #008000 } /* Keyword.Pseudo */
body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #BA2121 } /* Literal.String */
body .na { color: #7D9029 } /* Name.Attribute */
body .nb { color: #008000 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #999999; font-weight: bold } /* Name.Entity */
body .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #A0A000 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #19177C } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sb { color: #BA2121 } /* Literal.String.Backtick */
body .sc { color: #BA2121 } /* Literal.String.Char */
body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #BA2121 } /* Literal.String.Double */
body .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #BA2121 } /* Literal.String.Heredoc */
body .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #BB6688 } /* Literal.String.Regex */
body .s1 { color: #BA2121 } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #008000 } /* Name.Builtin.Pseudo */
body .vc { color: #19177C } /* Name.Variable.Class */
body .vg { color: #19177C } /* Name.Variable.Global */
body .vi { color: #19177C } /* Name.Variable.Instance */
body .il { color: #666666 } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><pre><span class="c1">// -*- groovy -*-</span>
<span class="c1">// The examples make use of Groovy&#39;s built-in assert</span>
<span class="c1">// command so that the script is self-checking</span>

<span class="c1">// @@PLEAC@@_NAME</span>
<span class="c1">// @@SKIP@@ Groovy</span>

<span class="c1">// @@PLEAC@@_WEB</span>
<span class="c1">// @@SKIP@@ http://groovy.codehaus.org</span>

<span class="c1">// @@PLEAC@@_1.0</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;\\n&#39;</span>                    <span class="c1">// two characters, \ and an n</span>
<span class="k">assert</span> <span class="n">string</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">2</span>
<span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;\n&quot;</span>                     <span class="c1">// a &quot;newline&quot; character</span>
<span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;\n&#39;</span>                     <span class="c1">// a &quot;newline&quot; character</span>

<span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;Jon &#39;Maddog&#39; Orwant&quot;</span>    <span class="c1">// literal single quote inside double quotes</span>
<span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;Jon \&#39;Maddog\&#39; Orwant&#39;</span>  <span class="c1">// escaped single quotes</span>

<span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;Jon &quot;Maddog&quot; Orwant&#39;</span>    <span class="c1">// literal double quotes inside single quotes</span>
<span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;Jon \&quot;Maddog\&quot; Orwant&quot;</span>  <span class="c1">// escaped double quotes</span>

<span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">This is a multiline string declaration</span>
<span class="s1">using single quotes (you can use double quotes)</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_1.1</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// accessing substrings</span>
<span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;hippopotamus&#39;</span>
<span class="n">start</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span> <span class="n">end</span> <span class="o">=</span> <span class="mi">7</span><span class="o">;</span> <span class="n">endplus1</span> <span class="o">=</span> <span class="mi">8</span>
<span class="k">assert</span> <span class="n">string</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">endplus1</span><span class="o">)</span> <span class="o">==</span> <span class="s1">&#39;pot&#39;</span>
<span class="k">assert</span> <span class="n">string</span><span class="o">[</span><span class="n">start</span><span class="o">..</span><span class="na">end</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;pot&#39;</span>

<span class="k">assert</span> <span class="n">string</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">start</span><span class="o">)</span> <span class="o">==</span> <span class="s1">&#39;potamus&#39;</span>
<span class="k">assert</span> <span class="n">string</span><span class="o">[</span><span class="n">start</span><span class="o">..-</span><span class="mi">1</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;potamus&#39;</span>

<span class="c1">// String is immutable but new strings can be created in various ways</span>
<span class="k">assert</span> <span class="n">string</span> <span class="o">-</span> <span class="s1">&#39;hippo&#39;</span> <span class="o">-</span> <span class="s1">&#39;mus&#39;</span> <span class="o">+</span> <span class="s1">&#39;to&#39;</span> <span class="o">==</span> <span class="s1">&#39;potato&#39;</span>
<span class="k">assert</span> <span class="n">string</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="s1">&#39;ppopotam&#39;</span><span class="o">,</span><span class="s1">&#39;bisc&#39;</span><span class="o">)</span> <span class="o">==</span> <span class="s1">&#39;hibiscus&#39;</span>
<span class="k">assert</span> <span class="n">string</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span> <span class="o">+</span> <span class="s1">&#39;bisc&#39;</span> <span class="o">+</span> <span class="n">string</span><span class="o">[-</span><span class="mi">2</span><span class="o">..-</span><span class="mi">1</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;hibiscus&#39;</span>
<span class="c1">// StringBuffer is mutable</span>
<span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">(</span><span class="n">string</span><span class="o">)</span>
<span class="n">sb</span><span class="o">[</span><span class="mi">2</span><span class="o">..-</span><span class="mi">3</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;bisc&#39;</span>
<span class="k">assert</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span> <span class="o">==</span> <span class="s1">&#39;hibiscus&#39;</span>

<span class="c1">// No exact pack/unpack equivalents exist in Groovy. Examples here use a custom</span>
<span class="c1">// implementation to split an original string into chunks of specified length</span>
<span class="c1">// the method is a modified version of the Java PLEAC version</span>

<span class="c1">// get a 5-character string, skip 8, then grab 2 5-character strings</span>
<span class="c1">// skipping the trailing spaces, then grab the rest</span>
<span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;hippopotamus means river horse&#39;</span>
<span class="kt">def</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">unpack</span><span class="o">(</span><span class="s1">&#39;A5 x8 A5 x1 A5 x1 A*&#39;</span><span class="o">,</span> <span class="n">data</span><span class="o">)</span>
<span class="k">assert</span> <span class="n">fields</span> <span class="o">==</span> <span class="o">[</span><span class="s1">&#39;hippo&#39;</span><span class="o">,</span> <span class="s1">&#39;means&#39;</span><span class="o">,</span> <span class="s1">&#39;river&#39;</span><span class="o">,</span> <span class="s1">&#39;horse&#39;</span><span class="o">]</span>

<span class="c1">// On a Java 5 or 6 JVM, Groovy can also make use of Scanners:</span>
<span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scanner</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
<span class="n">s</span><span class="o">.</span><span class="na">findInLine</span><span class="o">(</span><span class="s">/(.{5}).{8}(.{5}) (.{5}) (.*)/</span><span class="o">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">match</span><span class="o">()</span>
<span class="n">fields</span> <span class="o">=</span> <span class="o">[]</span>
<span class="o">(</span><span class="mi">1</span><span class="o">..</span><span class="na">m</span><span class="o">.</span><span class="na">groupCount</span><span class="o">()).</span><span class="na">each</span><span class="o">{</span> <span class="n">fields</span> <span class="o">&lt;&lt;</span> <span class="n">m</span><span class="o">.</span><span class="na">group</span><span class="o">(</span><span class="n">it</span><span class="o">)</span> <span class="o">}</span>
<span class="k">assert</span> <span class="n">fields</span> <span class="o">==</span> <span class="o">[</span><span class="s1">&#39;hippo&#39;</span><span class="o">,</span> <span class="s1">&#39;means&#39;</span><span class="o">,</span> <span class="s1">&#39;river&#39;</span><span class="o">,</span> <span class="s1">&#39;horse&#39;</span><span class="o">]</span>

<span class="c1">// another scanner example similar to the javadoc example</span>
<span class="n">input</span> <span class="o">=</span> <span class="s1">&#39;1 fish 2 fish red fish blue fish&#39;</span>
<span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scanner</span><span class="o">(</span><span class="n">input</span><span class="o">).</span><span class="na">useDelimiter</span><span class="o">(</span><span class="s">/\s*fish\s*/</span><span class="o">)</span>
<span class="n">fields</span> <span class="o">=</span> <span class="o">[]</span>
<span class="mi">2</span><span class="o">.</span><span class="na">times</span><span class="o">{</span> <span class="n">fields</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="o">.</span><span class="na">nextInt</span><span class="o">()</span> <span class="o">}</span>
<span class="mi">2</span><span class="o">.</span><span class="na">times</span><span class="o">{</span> <span class="n">fields</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="o">.</span><span class="na">next</span><span class="o">()</span> <span class="o">}</span>
<span class="k">assert</span> <span class="n">fields</span> <span class="o">==</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="s1">&#39;red&#39;</span><span class="o">,</span> <span class="s1">&#39;blue&#39;</span><span class="o">]</span>

<span class="c1">// split at five characters boundaries</span>
<span class="n">String</span><span class="o">[]</span> <span class="n">fivers</span> <span class="o">=</span> <span class="n">unpack</span><span class="o">(</span><span class="s1">&#39;A5 &#39;</span> <span class="o">*</span> <span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="s">/ 5), data)</span>
<span class="s">assert fivers == [&quot;hippo&quot;, &quot;potam&quot;, &quot;us me&quot;, &quot;ans r&quot;, &quot;iver &quot;, &quot;horse&quot;]</span>

<span class="s">// chop string into individual characters</span>
<span class="s">assert &#39;abcd&#39; as String[] == [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>

<span class="s">string = &quot;This is what you have&quot;</span>
<span class="s">// Indexing forwards  (left to right)</span>
<span class="s">// tens   000000000011111111112</span>
<span class="s">// units +012345678901234567890</span>
<span class="s">// Indexing backwards (right to left)</span>
<span class="s">// tens   221111111111000000000</span>
<span class="s">// units  109876543210987654321-</span>

<span class="s">assert string[0]          == &#39;T&#39;</span>
<span class="s">assert string[5..6]       == &#39;is&#39;</span>
<span class="s">assert string[13..-1]     == &#39;you have&#39;</span>
<span class="s">assert string[-1]         == &#39;e&#39;</span>
<span class="s">assert string[-4..-1]     == &#39;have&#39;</span>
<span class="s">assert string[-8, -7, -6] == &#39;you&#39;</span>

<span class="s">data = new StringBuffer(string)</span>
<span class="s">data[5..6] = &quot;wasn&#39;t&quot;       ; assert data.toString() == &quot;This wasn&#39;t what you have&quot;</span>
<span class="s">data[-12..-1] = &quot;ondrous&quot;   ; assert data.toString() == &quot;This wasn&#39;t wondrous&quot;</span>
<span class="s">data[0..0] = &quot;&quot;             ; assert data.toString() == &quot;his wasn&#39;t wondrous&quot;</span>
<span class="s">data[-10..-1]  = &quot;&quot;         ; assert data.toString() == &quot;his wasn&#39;&quot;</span>

<span class="s">string = &quot;This wasn&#39;t wondrous&quot;</span>
<span class="s">// check last ten characters match some pattern</span>
<span class="s">assert string[-10..-1] =~ /</span><span class="o">^</span><span class="n">t</span><span class="err">\</span><span class="n">sw</span><span class="o">.*</span><span class="n">s</span><span class="s">$/</span>

<span class="s">string = &#39;This is a test&#39;</span>
<span class="s">assert string[0..4].replaceAll(&#39;is&#39;, &#39;at&#39;) + string[5..-1] == &#39;That is a test&#39;</span>

<span class="s">// exchange the first and last letters in a string</span>
<span class="s">string = &#39;make a hat&#39;</span>
<span class="s">string = string[-1] + string[1..-2] + string[0]</span>
<span class="s">assert string == &#39;take a ham&#39;</span>

<span class="s">// extract column with unpack</span>
<span class="s">string = &#39;To be or not to be&#39;</span>

<span class="s">// skip 6, grab 6</span>
<span class="s">assert unpack(&quot;x6 A6&quot;, string) == [&#39;or not&#39;]</span>

<span class="s">// forward 6, grab 2, backward 5, grab 2</span>
<span class="s">assert unpack(&quot;x6 A2 X5 A2&quot;, string) == [&#39;or&#39;, &#39;be&#39;]</span>

<span class="s">assert cut2fmt([8, 14, 20, 26, 30]) == &#39;A7 A6 A6 A6 A4 A*&#39;</span>

<span class="s">// utility method (derived from Java PLEAC version)</span>
<span class="s">def unpack(String format, String data) {</span>
<span class="s">    def result = []</span>
<span class="s">    int formatOffset = 0, dataOffset = 0</span>
<span class="s">    int minDataOffset = 0, maxDataOffset = data.size()</span>

<span class="s">    new StringTokenizer(format).each{ token -&gt;</span>
<span class="s">        int tokenLen = token.length()</span>

<span class="s">        // count determination</span>
<span class="s">        int count = 0</span>
<span class="s">        if (tokenLen == 1) count = 1</span>
<span class="s">        else if (token.charAt(1) == &#39;*&#39;) count = -1</span>
<span class="s">        else count = token[1..-1].toInteger()</span>

<span class="s">        // action determination</span>
<span class="s">        char action = token.charAt(0)</span>
<span class="s">        switch (action) {</span>
<span class="s">            case &#39;A&#39;:</span>
<span class="s">                if (count == -1) {</span>
<span class="s">                    start = [dataOffset, maxDataOffset].min()</span>
<span class="s">                    result.add(data[start..-1])</span>
<span class="s">                    dataOffset = maxDataOffset</span>
<span class="s">                } else {</span>
<span class="s">                    start = [dataOffset, maxDataOffset].min()</span>
<span class="s">                    end = [dataOffset + count, maxDataOffset].min()</span>
<span class="s">                    result.add(data[start..&lt;end])</span>
<span class="s">                    dataOffset += count</span>
<span class="s">                }</span>
<span class="s">                break</span>
<span class="s">            case &#39;x&#39;:</span>
<span class="s">                if (count == -1) dataOffset = maxDataOffset</span>
<span class="s">                else dataOffset += count</span>
<span class="s">                break</span>
<span class="s">            case &#39;X&#39;:</span>
<span class="s">                if (count == -1) dataOffset = minDataOffset</span>
<span class="s">                else dataOffset -= count</span>
<span class="s">                break</span>
<span class="s">            default:</span>
<span class="s">                throw new RuntimeException(&#39;Unknown action token&#39;, formatOffset)</span>
<span class="s">        }</span>
<span class="s">        formatOffset += tokenLen + 1</span>
<span class="s">    }</span>
<span class="s">    return result as String[]</span>
<span class="s">}</span>

<span class="s">// utility method</span>
<span class="s">def cut2fmt(positions) {</span>
<span class="s">    template = &#39;&#39;</span>
<span class="s">    lastpos = 1</span>
<span class="s">    for (pos in positions) {</span>
<span class="s">        template += &#39;A&#39; + (pos - lastpos) + &#39; &#39;</span>
<span class="s">        lastpos = pos</span>
<span class="s">    }</span>
<span class="s">    return template + &#39;A*&#39;</span>
<span class="s">}</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_1.2</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// use b if b is true, else c</span>
<span class="s">b = false; c = &#39;cat&#39;</span>
<span class="s">assert (b ? b : c) == &#39;cat&#39;</span>
<span class="s">b = true</span>
<span class="s">assert (b ? b : c)</span>
<span class="s">// can be simplified to &#39;b || c&#39; if c is a boolean</span>
<span class="s">// strictly speaking, b doesn&#39;t have to be a boolean,</span>
<span class="s">// e.g. an empty list is coerced to boolean false</span>
<span class="s">b = []</span>
<span class="s">assert (b ? b : c) == &#39;cat&#39;</span>

<span class="s">// set x to y unless x is already true</span>
<span class="s">x = false; y = &#39;dog&#39;</span>
<span class="s">if (!x) x = y</span>
<span class="s">assert x == &#39;dog&#39;</span>
<span class="s">// can be simplified to &#39;x ||= y&#39; if y is a boolean</span>
<span class="s">// x doesn&#39;t need to be a boolean, e.g. a non-empty</span>
<span class="s">// string is coerced to boolean true</span>
<span class="s">x = &#39;cat&#39;</span>
<span class="s">if (!x) x = y</span>
<span class="s">assert x == &#39;cat&#39;</span>

<span class="s">// JVM supplies user name</span>
<span class="s">// otherwise could use exec or built-in Ant features for reading environment vars</span>
<span class="s">assert System.getProperty(&#39;user.name&#39;)</span>

<span class="s">// test for nullity then for emptyness</span>
<span class="s">def setDefaultIfNullOrEmpty(startingPoint) {</span>
<span class="s">    (!startingPoint || startingPoint.length() == 0) ? &#39;Greenwich&#39; : startingPoint</span>
<span class="s">}</span>
<span class="s">assert setDefaultIfNullOrEmpty(null) == &#39;Greenwich&#39;</span>
<span class="s">assert setDefaultIfNullOrEmpty(&#39;&#39;) == &#39;Greenwich&#39;</span>
<span class="s">assert setDefaultIfNullOrEmpty(&#39;Something else&#39;) == &#39;Something else&#39;</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_1.3</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">v1 = &#39;alpha&#39;; v2 = &#39;omega&#39;</span>
<span class="s">// this can done with explicit swapping via a temp variable</span>
<span class="s">// or in a slightly more interesting way with a closure</span>
<span class="s">swap = { temp = v1; v1 = v2; v2 = temp }</span>
<span class="s">swap()</span>
<span class="s">assert v1 == &#39;omega&#39; &amp;&amp; v2 == &#39;alpha&#39;</span>
<span class="s">// a more generic swap() is also possible using Groovy&#39;s metaclass mechanisms</span>
<span class="s">// but is not idiomatic of Groovy usage</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_1.4</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// char and int are interchangable, apart from precision difference</span>
<span class="s">// char use 16 bits while int use 32, requiring a cast from int to char</span>
<span class="s">char ch = &#39;e&#39;</span>
<span class="s">int num = ch         // no problem</span>
<span class="s">ch = (char) num  // needs an explicit cast</span>

<span class="s">s1 = &quot;Number &quot; + num + &quot; is character &quot; + (char) num</span>
<span class="s">assert s1 == &#39;Number 101 is character e&#39;</span>
<span class="s">s2 = &quot;Character &quot; + ch + &quot; is number &quot; + (int) ch</span>
<span class="s">assert s2 == &#39;Character e is number 101&#39;</span>

<span class="s">// easy conversion between char arrays, char lists and Strings</span>
<span class="s">char[] ascii = &quot;sample&quot;.toCharArray() // {115, 97, 109, 112, 108, 101}</span>
<span class="s">assert new String(ascii) == &quot;sample&quot;</span>
<span class="s">assert new String([115, 97, 109, 112, 108, 101] as char[]) == &quot;sample&quot;</span>

<span class="s">// convert &#39;HAL&#39; to &#39;IBM&#39; (in increasing order of Grooviness)</span>
<span class="s">assert &quot;HAL&quot;.toCharArray().collect{new String(it+1 as char[])}.join() == &#39;IBM&#39;</span>
<span class="s">assert (&quot;HAL&quot; as String[]).collect{it.next()}.join() == &#39;IBM&#39;</span>
<span class="s">assert &quot;HAL&quot;.replaceAll(&#39;.&#39;, {it.next()}) == &#39;IBM&#39;</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_1.5</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">string = &quot;an apple a day&quot;</span>
<span class="s">assert string[3..7].split(&#39;&#39;)[1..5] == [&#39;a&#39;, &#39;p&#39;, &#39;p&#39;, &#39;l&#39;, &#39;e&#39;]</span>
<span class="s">assert string.split(&#39;&#39;).toList().unique().sort().join() == &#39; adelnpy&#39;</span>

<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// CheckSum.groovy: Compute 16-bit checksum of input file</span>
<span class="s">// Usage: groovy CheckSum &lt;file&gt;</span>
<span class="s">// script:</span>
<span class="s">checksum = 0</span>
<span class="s">new File(args[0]).eachByte{ checksum += it }</span>
<span class="s">checksum %= (int) Math.pow(2, 16) - 1</span>
<span class="s">println checksum</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// to run on its own source code:</span>
<span class="s">//=&gt; % groovy CheckSum CheckSum.groovy</span>
<span class="s">//=&gt; 9349</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Slowcat.groovy: Emulate a  s l o w  line printer</span>
<span class="s">// Usage: groovy Slowcat &lt;file&gt; &lt;delay_millis_between_each_char&gt;</span>
<span class="s">// script:</span>
<span class="s">delay = args[1].toInteger()</span>
<span class="s">new File(args[0]).eachByte{ print ((char) it); Thread.sleep(delay) }</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_1.6</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">assert &#39;string&#39;.reverse() == &#39;gnirts&#39;</span>

<span class="s">string = &#39;Yoda said, &quot;can you see this?&quot;&#39;</span>
<span class="s">revwords = string.split(&#39; &#39;).toList().reverse().join(&#39; &#39;)</span>
<span class="s">assert revwords == &#39;this?&quot; see you &quot;can said, Yoda&#39;</span>

<span class="s">words = [&#39;bob&#39;, &#39;alpha&#39;, &#39;rotator&#39;, &#39;omega&#39;, &#39;reviver&#39;]</span>
<span class="s">long_palindromes = words.findAll{ w -&gt; w == w.reverse() &amp;&amp; w.size() &gt; 5 }</span>
<span class="s">assert long_palindromes == [&#39;rotator&#39;, &#39;reviver&#39;]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_1.7</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">s1 = &#39;abc\t def\tghi \n\tx&#39;</span>
<span class="s">s2 = &#39;abc      def    ghi \n        x&#39;</span>
<span class="s">def expand(s) {</span>
<span class="s">    s.split(&#39;\n&#39;).toList().collect{</span>
<span class="s">        line = it</span>
<span class="s">        while (line.contains(&#39;\t&#39;)) {</span>
<span class="s">            line = line.replaceAll(/([^\t]*)(\t)(.*)/){</span>
<span class="s">                all,pre,tab,suf -&gt; pre + &#39; &#39; * (8 - pre.size() % 8) + suf</span>
<span class="s">            }</span>
<span class="s">        }</span>
<span class="s">        return line</span>
<span class="s">    }.join(&#39;\n&#39;)</span>
<span class="s">}</span>
<span class="s">def unexpand(s) {</span>
<span class="s">    s.split(&#39;\n&#39;).toList().collect{</span>
<span class="s">        line = it</span>
<span class="s">        for (i in line.size()-1..1) {</span>
<span class="s">            if (i % 8 == 0) {</span>
<span class="s">                prefix = line[0..&lt;i]</span>
<span class="s">                if (prefix.trim().size() != prefix.size()) {</span>
<span class="s">                    line = prefix.trim() + &#39;\t&#39; + line[i..-1]</span>
<span class="s">                }</span>
<span class="s">            }</span>
<span class="s">        }</span>
<span class="s">        return line</span>
<span class="s">    }.join(&#39;\n&#39;)</span>
<span class="s">}</span>
<span class="s">assert expand(s1) == s2</span>
<span class="s">assert unexpand(s2) == s1</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_1.8</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">debt = 150</span>
<span class="s">assert &quot;You owe $debt to me&quot; == &#39;You owe 150 to me&#39;</span>

<span class="s">rows = 24; cols = 80</span>
<span class="s">assert &quot;I am $rows high and $cols wide&quot; == &#39;I am 24 high and 80 wide&#39;</span>

<span class="s">assert &#39;I am 17 years old&#39;.replaceAll(/\d+/, {2*it.toInteger()}) == &#39;I am 34 years old&#39;</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_1.9</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">assert &quot;bo peep&quot;.toUpperCase() == &#39;BO PEEP&#39;</span>
<span class="s">assert &#39;JOHN&#39;.toLowerCase() == &#39;john&#39;</span>
<span class="s">def capitalize(s) {s[0].toUpperCase() + (s.size()&lt;2 ? &#39;&#39; : s[1..-1]?.toLowerCase())}</span>
<span class="s">assert capitalize(&#39;joHn&#39;) == &#39;John&#39;</span>

<span class="s">s = &quot;thIS is a loNG liNE&quot;.replaceAll(/\w+/){capitalize(it)}</span>
<span class="s">assert s == &#39;This Is A Long Line&#39;</span>

<span class="s">s1 = &#39;JOhn&#39;; s2 = &#39;joHN&#39;</span>
<span class="s">assert s1.equalsIgnoreCase(s2)</span>

<span class="s">private Random rand</span>
<span class="s">def randomCase(char ch) {</span>
<span class="s">    (rand.nextInt(100) &lt; 20) ? Character.toLowerCase(ch) : ch</span>
<span class="s">}</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_1.10</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">n = 10</span>
<span class="s">assert &quot;I have ${n+1} guanacos.&quot; == &#39;I have 11 guanacos.&#39;</span>
<span class="s">assert &quot;I have &quot; + (n+1) + &quot; guanacos.&quot; == &#39;I have 11 guanacos.&#39;</span>

<span class="s">// sending templated email is solved in two parts: templating and sending</span>
<span class="s">// Part 1: creating an email template</span>
<span class="s">naughty = &#39;Mr Bad Credit&#39;</span>
<span class="s">def get_manager_list(s) { &#39;The Big Boss&#39; }</span>
<span class="s">msg = &quot;&quot;&quot;</span>
<span class="s">To: $naughty</span>
<span class="s">From: Your Bank</span>
<span class="s">Cc: ${ get_manager_list(naughty) }</span>
<span class="s">Date: ${ new Date() }</span>

<span class="s">Dear $naughty,</span>

<span class="s">Today, you bounced check number ${ 500 + new Random().nextInt(100) } to us.</span>
<span class="s">Your account is now closed.</span>

<span class="s">Sincerely,</span>
<span class="s">the management</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="s">expected = &#39;&#39;&#39;</span>
<span class="s">To: Mr Bad Credit</span>
<span class="s">From: Your Bank</span>
<span class="s">Cc: The Big Boss</span>
<span class="s">Date: XXX</span>

<span class="s">Dear Mr Bad Credit,</span>

<span class="s">Today, you bounced check number XXX to us.</span>
<span class="s">Your account is now closed.</span>

<span class="s">Sincerely,</span>
<span class="s">the management</span>
<span class="s">&#39;&#39;&#39;</span>
<span class="s">sanitized = msg.replaceAll(&#39;(?m)^Date: (.*)$&#39;,&#39;Date: XXX&#39;)</span>
<span class="s">sanitized = sanitized.replaceAll(/(?m)check number (\d+) to/,&#39;check number XXX to&#39;)</span>
<span class="s">assert sanitized == expected</span>
<span class="s">// note: Groovy also has several additional built-in templating facilities</span>
<span class="s">// Part 2: sending email</span>
<span class="s">// SendMail.groovy: Send email</span>
<span class="s">// Usage: groovy SendEmail &lt;msgfile&gt;</span>
<span class="s">// script:</span>
<span class="s">ant = new AntBuilder()</span>
<span class="s">ant.mail(from:&#39;manager@grumpybank.com&#39;, tolist:&#39;innocent@poorhouse.com&#39;,</span>
<span class="s">    encoding:&#39;plain&#39;, mailhost:&#39;mail.someserver.com&#39;,</span>
<span class="s">    subject:&#39;Friendly Letter&#39;, message:&#39;this is a test message&#39;)</span>
<span class="s">// Ant has many options for setting encoding, security, attachments, etc., see:</span>
<span class="s">// http://ant.apache.org/manual/CoreTasks/mail.html</span>
<span class="s">// Groovy could also use the Java Mail Api directly if required</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_1.11</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">def raw = &#39;&#39;&#39;</span>
<span class="s">    your text</span>
<span class="s">    goes here</span>
<span class="s">&#39;&#39;&#39;</span>

<span class="s">def expected = &#39;&#39;&#39;</span>
<span class="s">your text</span>
<span class="s">goes here</span>
<span class="s">&#39;&#39;&#39;</span>

<span class="s">assert raw.split(&#39;\n&#39;).toList().collect{</span>
<span class="s">    it.replaceAll(/^\s+/,&#39;&#39;)</span>
<span class="s">}.join(&#39;\n&#39;) + &#39;\n&#39; == expected</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_1.12</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">input = &#39;&#39;&#39;Folding and splicing is the work of an editor,</span>
<span class="s"> not a mere collection of silicon</span>
<span class="s"> and</span>
<span class="s"> mobile electrons!&#39;&#39;&#39;</span>

<span class="s">expected = &#39;&#39;&#39;Folding and splicing</span>
<span class="s">is the work of an</span>
<span class="s">editor, not a mere</span>
<span class="s">collection of</span>
<span class="s">silicon and mobile</span>
<span class="s">electrons!&#39;&#39;&#39;</span>

<span class="s">def wrap(text, maxSize) {</span>
<span class="s">    all = []</span>
<span class="s">    line = &#39;&#39;</span>
<span class="s">    text.eachMatch(/\S+/) {</span>
<span class="s">        word = it[0]</span>
<span class="s">        if (line.size() + 1 + word.size() &gt; maxSize) {</span>
<span class="s">            all += line</span>
<span class="s">            line = word</span>
<span class="s">        } else {</span>
<span class="s">            line += (line == &#39;&#39; ? word : &#39; &#39; + word)</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">    all += line</span>
<span class="s">    return all.join(&#39;\n&#39;)</span>
<span class="s">}</span>
<span class="s">assert wrap(input, 20) == expected</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_1.13</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">string = /Mom said, &quot;Don&#39;t do that.&quot;/</span>
<span class="s">// backslash special chars</span>
<span class="s">assert string.replaceAll(/[&#39;&quot;]/){/\\/+it[0]} == /Mom said, \&quot;Don\&#39;t do that.\&quot;/   //&#39;</span>
<span class="s">// double special chars</span>
<span class="s">assert string.replaceAll(/[&#39;&quot;]/){it[0]+it[0]} == /Mom said, &quot;&quot;Don&#39;&#39;t do that.&quot;&quot;/  //&#39;</span>
<span class="s">//backslash quote all non-capital letters</span>
<span class="s">assert &quot;DIR /?&quot;.replaceAll(/[^A-Z]/){/\\/+it[0]} == /DIR\ \/\?/</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_1.14</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">assert &#39;     x     &#39;.trim() == &#39;x&#39;</span>
<span class="s">// print what&#39;s typed, but surrounded by &gt;&lt; symbols</span>
<span class="s">// script:</span>
<span class="s">new BufferedReader(new InputStreamReader(System.in)).eachLine{</span>
<span class="s">    println(&quot;&gt;&quot; + it.trim() + &quot;&lt;&quot;);</span>
<span class="s">}</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_1.15</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">pattern = /&quot;([^\&quot;\\]*(?:\\.[^\&quot;\\]*)*)&quot;,?|([^,]+),?|,/</span>
<span class="s">line = /XYZZY,&quot;&quot;,&quot;O&#39;Reilly, Inc&quot;,&quot;Wall, Larry&quot;,&quot;a \&quot;glug\&quot; bit,&quot;,5,&quot;Error, Core Dumped&quot;/</span>
<span class="s">m = line =~ pattern</span>
<span class="s">expected = [/XYZZY/, &#39;&#39;, /O&#39;Reilly, Inc/, /Wall, Larry/,     //&#39;</span>
<span class="s">            /a \&quot;glug\&quot; bit,/, /5/, /Error, Core Dumped/]</span>
<span class="s">for (i in 0..&lt;m.size().toInteger())</span>
<span class="s">    assert expected[i] == (m[i][2] ? m[i][2] : m[i][1])</span>

<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_1.16</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// A quick google search found several Java implementations.</span>
<span class="s">// As an example, how to use commons codec is shown below.</span>
<span class="s">// Just place the respective jar in your classpath.</span>
<span class="s">// Further details: http://jakarta.apache.org/commons/codec</span>
<span class="s">// require(groupId:&#39;commons-codec&#39;, artifactId:&#39;commons-codec&#39;, version:&#39;1.3&#39;)</span>
<span class="s">soundex = new org.apache.commons.codec.language.Soundex()</span>
<span class="s">assert soundex.soundex(&#39;Smith&#39;) == soundex.soundex(&#39;Smyth&#39;)</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_1.17</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">input = &#39;&#39;&#39;I have analysed the new part. As long as you</span>
<span class="s">aren&#39;t worried about the colour, it is a dropin replacement.&#39;&#39;&#39;        //&#39;</span>

<span class="s">expected = &#39;&#39;&#39;I have analyzed the new part. As long as you</span>
<span class="s">aren&#39;t worried about the color, it is a drop-in replacement.&#39;&#39;&#39;        //&#39;</span>

<span class="s">translations = [colour:&#39;color&#39;, analysed:&#39;analyzed&#39;, dropin:&#39;drop-in&#39;]</span>

<span class="s">def fixstyle(s) {</span>
<span class="s">    s.split(&#39;\n&#39;).toList().collect{</span>
<span class="s">        line = it</span>
<span class="s">        translations.each{ key, value -&gt;</span>
<span class="s">            line = line.replaceAll(/(?&lt;=\W)/ + key + /(?=\W)/, value)</span>
<span class="s">        }</span>
<span class="s">        return line</span>
<span class="s">    }.join(&#39;\n&#39;)</span>
<span class="s">}</span>
<span class="s">assert fixstyle(input) == expected</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_1.18</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Solved in two parts: &#39;screenscrape&#39; text stream and return stream from process</span>
<span class="s">// Part 1: text scraping</span>
<span class="s">input = &#39;&#39;&#39;</span>
<span class="s">      PID    PPID    PGID     WINPID  TTY  UID    STIME COMMAND</span>
<span class="s">     4636       1    4636       4636  con 1005 08:24:50 /usr/bin/bash</span>
<span class="s">      676    4636     676        788  con 1005 13:53:32 /usr/bin/ps</span>
<span class="s">&#39;&#39;&#39;</span>
<span class="s">select1 = &#39;&#39;&#39;</span>
<span class="s">      PID    PPID    PGID     WINPID  TTY  UID    STIME COMMAND</span>
<span class="s">      676    4636     676        788  con 1005 13:53:32 /usr/bin/ps</span>
<span class="s">&#39;&#39;&#39;</span>
<span class="s">select2 = &#39;&#39;&#39;</span>
<span class="s">      PID    PPID    PGID     WINPID  TTY  UID    STIME COMMAND</span>
<span class="s">     4636       1    4636       4636  con 1005 08:24:50 /usr/bin/bash</span>
<span class="s">&#39;&#39;&#39;</span>

<span class="s">// line below must be configured for your unix - this one&#39;s cygwin</span>
<span class="s">format = cut2fmt([10, 18, 26, 37, 42, 47, 56])</span>
<span class="s">def psgrep(s) {</span>
<span class="s">    out = []</span>
<span class="s">    lines = input.split(&#39;\n&#39;).findAll{ it.size() }</span>
<span class="s">    vars = unpack(format, lines[0]).toList().collect{ it.toLowerCase().trim() }</span>
<span class="s">    out += lines[0]</span>
<span class="s">    lines[1..-1].each{</span>
<span class="s">        values = unpack(format, it).toList().collect{</span>
<span class="s">            try {</span>
<span class="s">                return it.toInteger()</span>
<span class="s">            } catch(NumberFormatException e) {</span>
<span class="s">                return it.trim()</span>
<span class="s">            }</span>
<span class="s">        }</span>
<span class="s">        vars.eachWithIndex{ var, i -&gt;</span>
<span class="s">            binding.setVariable(var, values[i])</span>
<span class="s">        }</span>
<span class="s">        if (new GroovyShell(binding).evaluate(s)) out += it</span>
<span class="s">    }</span>
<span class="s">    return &#39;\n&#39; + out.join(&#39;\n&#39;) + &#39;\n&#39;</span>
<span class="s">}</span>
<span class="s">assert psgrep(&#39;winpid &lt; 800&#39;) == select1</span>
<span class="s">assert psgrep(&#39;uid % 5 == 0 &amp;&amp; command =~ /sh$/&#39;) == select2</span>
<span class="s">// Part 2: obtaining text stream from process</span>
<span class="s">// unixScript:</span>
<span class="s">input = &#39;ps&#39;.execute().text</span>
<span class="s">// cygwinScript:</span>
<span class="s">input = &#39;path_to_cygwin/bin/ps.exe&#39;.execute().text</span>
<span class="s">// windowsScript:</span>
<span class="s">// can use something like sysinternal.com s pslist (with minor script tweaks)</span>
<span class="s">input = &#39;pslist.exe&#39;.execute().text</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_2.1</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// four approaches possible (shown for Integers, similar for floats, double etc.):</span>
<span class="s">// (1) NumberFormat.getInstance().parse(s)    // getInstance() can take locale</span>
<span class="s">// (2) Integer.parseInt(s)</span>
<span class="s">// (3) new Integer(s)</span>
<span class="s">// (4) regex</span>
<span class="s">import java.text.*</span>
<span class="s">int nb = 0</span>
<span class="s">try {</span>
<span class="s">    nb = NumberFormat.getInstance().parse(&#39;33.5&#39;) // &#39;.5&#39; will be ignored</span>
<span class="s">    nb = NumberFormat.getInstance().parse(&#39;abc&#39;)</span>
<span class="s">} catch (ParseException ex) {</span>
<span class="s">    assert ex.getMessage().contains(&#39;abc&#39;)</span>
<span class="s">}</span>
<span class="s">assert nb == 33</span>

<span class="s">try {</span>
<span class="s">    nb = Integer.parseInt(&#39;34&#39;)</span>
<span class="s">    assert nb == 34</span>
<span class="s">    nb = new Integer(&#39;35&#39;)</span>
<span class="s">    nb = Integer.parseInt(&#39;abc&#39;)</span>
<span class="s">} catch (NumberFormatException ex) {</span>
<span class="s">    assert ex.getMessage().contains(&#39;abc&#39;)</span>
<span class="s">}</span>
<span class="s">assert nb == 35</span>

<span class="s">integerPattern = /^[+-]?\d+$/</span>
<span class="s">assert &#39;-36&#39; =~ integerPattern</span>
<span class="s">assert !(&#39;abc&#39; =~ integerPattern)</span>
<span class="s">decimalPattern = /^-?(?:\d+(?:\.\d*)?|\.\d+)$/</span>
<span class="s">assert &#39;37.5&#39; =~ decimalPattern</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_2.2</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Groovy defaults to BigDecimal if you don&#39;t use an explicit float or double</span>
<span class="s">wage = 5.36</span>
<span class="s">week = 40 * wage</span>
<span class="s">assert &quot;One week&#39;s wage is: \$$week&quot; == /One week&#39;s wage is: $214.40/</span>
<span class="s">// if you want to use explicit doubles and floats you can still use</span>
<span class="s">// printf in version 5, 6 or 7 JVMs</span>
<span class="s">// printf(&#39;%5.2f&#39;, week as double)</span>
<span class="s">// =&gt; 214.40</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_2.3</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">a = 0.255</span>
<span class="s">b = a.setScale(2, BigDecimal.ROUND_HALF_UP);</span>
<span class="s">assert a.toString() == &#39;0.255&#39;</span>
<span class="s">assert b.toString() == &#39;0.26&#39;</span>

<span class="s">a = [3.3 , 3.5 , 3.7, -3.3] as double[]</span>
<span class="s">// warning rint() rounds to nearest integer - slightly different to Perl&#39;s int()</span>
<span class="s">rintExpected = [3.0, 4.0, 4.0, -3.0] as double[]</span>
<span class="s">floorExpected = [3.0, 3.0, 3.0, -4.0] as double[]</span>
<span class="s">ceilExpected = [4.0, 4.0, 4.0, -3.0] as double[]</span>
<span class="s">a.eachWithIndex{ val, i -&gt;</span>
<span class="s">    assert Math.rint(val) == rintExpected[i]</span>
<span class="s">    assert Math.floor(val) == floorExpected[i]</span>
<span class="s">    assert Math.ceil(val) == ceilExpected[i]</span>
<span class="s">}</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_2.4</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">assert Integer.parseInt(&#39;0110110&#39;, 2) == 54</span>
<span class="s">assert Integer.toString(54, 2) == &#39;110110&#39;</span>
<span class="s">// also works for other radix values, e.g. hex</span>
<span class="s">assert Integer.toString(60, 16) == &#39;3c&#39;</span>

<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_2.5</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">x = 3; y = 20</span>
<span class="s">for (i in x..y) {</span>
<span class="s">    //i is set to every integer from x to y, inclusive</span>
<span class="s">}</span>

<span class="s">(x..&lt;y).each {</span>
<span class="s">    //implicit closure variable it is set to every integer from x up to but excluding y</span>
<span class="s">}</span>

<span class="s">assert (x..y).step(7) == [3, 10, 17]</span>

<span class="s">years = []</span>
<span class="s">(5..&lt;13).each{ age -&gt; years += age }</span>
<span class="s">assert years == [5, 6, 7, 8, 9, 10, 11, 12]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_2.6</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// We can add additional methods to the Integer class</span>
<span class="s">class IntegerCategory {</span>
<span class="s">    static def romanMap = [1000:&#39;M&#39;, 900:&#39;CM&#39;, 500:&#39;D&#39;, 400:&#39;CD&#39;, 100:&#39;C&#39;, 90:&#39;XC&#39;,</span>
<span class="s">                           50:&#39;L&#39;, 40:&#39;XL&#39;, 10:&#39;X&#39;, 9:&#39;IX&#39;, 5:&#39;V&#39;, 4:&#39;IV&#39;, 1:&#39;I&#39;]</span>

<span class="s">    static getRoman(Integer self) {</span>
<span class="s">        def remains = self</span>
<span class="s">        def text = &#39;&#39;</span>
<span class="s">        romanMap.keySet().sort().reverse().each{ key -&gt;</span>
<span class="s">            while (remains &gt;= key) {</span>
<span class="s">                remains -= key</span>
<span class="s">                text += romanMap[key]</span>
<span class="s">            }</span>
<span class="s">        }</span>
<span class="s">        return text</span>
<span class="s">    }</span>

<span class="s">    static int parseRoman(Object self, String input) {</span>
<span class="s">        def ustr = input.toUpperCase()</span>
<span class="s">        int sum = 0</span>
<span class="s">        romanMap.keySet().sort().reverse().each{ key -&gt;</span>
<span class="s">            while (ustr.startsWith(romanMap[key])) {</span>
<span class="s">                sum += key</span>
<span class="s">                ustr -= romanMap[key]</span>
<span class="s">            }</span>
<span class="s">        }</span>
<span class="s">        return sum</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">use(IntegerCategory) {</span>
<span class="s">    int fifteen = 15</span>
<span class="s">    assert fifteen.roman == &#39;XV&#39;</span>
<span class="s">    assert parseRoman(&#39;XXVI&#39;) == 26</span>
<span class="s">    for (i in 1..3900) {</span>
<span class="s">        assert i == parseRoman(i.roman)</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_2.7</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">random = new Random()</span>
<span class="s">100.times{</span>
<span class="s">    next = random.nextInt(50) + 25</span>
<span class="s">    assert next &gt; 24</span>
<span class="s">    assert next &lt; 76</span>
<span class="s">}</span>
<span class="s">chars = []</span>
<span class="s">[&#39;A&#39;..&#39;Z&#39;,&#39;a&#39;..&#39;z&#39;,&#39;0&#39;..&#39;9&#39;,(&#39;!@$%^&amp;*&#39; as String[]).toList()].each{chars += it}</span>
<span class="s">password = (1..8).collect{ chars[random.nextInt(chars.size())] }.join()</span>
<span class="s">assert password.size() == 8</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_2.8</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// By default Groovy uses Java&#39;s Random facilities which use the current time</span>
<span class="s">// as the initial seed. This always changes but does so slowly over time.</span>
<span class="s">// You are free to select a better seed if you want greater randomness or</span>
<span class="s">// use the same one each time if you need repeatability.</span>
<span class="s">long seed = System.currentTimeMillis()</span>
<span class="s">random1 = new Random(seed)</span>
<span class="s">random2 = new Random(seed)</span>
<span class="s">assert random1.nextInt() == random2.nextInt()</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_2.9</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// java.util.Random which Groovy uses already uses a 48-bit seed</span>
<span class="s">// You can make use 64 not 48 bits (and make better use of the 48 bits) see here:</span>
<span class="s">// http://alife.co.uk/nonrandom/</span>
<span class="s">// You can choose a better seed, e.g. Ant uses:</span>
<span class="s">seed = System.currentTimeMillis() + Runtime.runtime.freeMemory()</span>
<span class="s">// You can accept input from the user, e.g.</span>
<span class="s">// http://examples.oreilly.com/javacrypt/files/oreilly/jonathan/util/Seeder.java</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_2.10</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// use Java&#39;s Random.nextGaussian() method</span>
<span class="s">random = new Random()</span>
<span class="s">mean = 25</span>
<span class="s">sdev = 2</span>
<span class="s">salary = random.nextGaussian() * sdev + mean</span>
<span class="s">// script:</span>
<span class="s">printf &#39;You have been hired at \$%.2f&#39;, salary</span>
<span class="s">// =&gt; You have been hired at $25.05</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_2.11</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// radians = Math.toRadians(degrees)</span>
<span class="s">assert Math.toRadians(90) == Math.PI / 2</span>
<span class="s">// degrees = Math.toDegrees(radians)</span>
<span class="s">assert Math.toDegrees(Math.PI) == 180</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_2.12</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// use Java&#39;s trigonometry methods in java.lang.Math</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">t = Math.tan(1.5)</span>
<span class="s">assert t &gt; 14.1 &amp;&amp; t &lt; 14.11</span>
<span class="s">ac = Math.acos(0.1)</span>
<span class="s">assert ac &gt; 1.47 &amp;&amp; ac &lt; 1.48</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_2.13</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">assert Math.log(Math.E) == 1</span>
<span class="s">assert Math.log10(10000) == 4</span>
<span class="s">def logn(base, val) { Math.log(val)/Math.log(base) }</span>
<span class="s">assert logn(2, 1024) == 10</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_2.14</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// there are several Java Matrix packages available, e.g.</span>
<span class="s">// http://math.nist.gov/javanumerics/jama</span>
<span class="s">import Jama.Matrix</span>
<span class="s">matrix1 = new Matrix([</span>
<span class="s">   [3, 2, 3],</span>
<span class="s">   [5, 9, 8]</span>
<span class="s">] as double[][])</span>

<span class="s">matrix2 = new Matrix([</span>
<span class="s">   [4, 7],</span>
<span class="s">   [9, 3],</span>
<span class="s">   [8, 1]</span>
<span class="s">] as double[][])</span>

<span class="s">expectedArray = [[54.0, 30.0], [165.0, 70.0]] as double[][]</span>
<span class="s">productArray = matrix1.times(matrix2).array</span>

<span class="s">for (i in 0..&lt;productArray.size()) {</span>
<span class="s">    assert productArray[i] == expectedArray[i]</span>
<span class="s">}</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_2.15</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// there are several Java Complex number packages, e.g.:</span>
<span class="s">// http://jakarta.apache.org/commons/math/userguide/complex.html</span>
<span class="s">import org.apache.commons.math.complex.Complex</span>
<span class="s">a = new Complex(3, 5)  // 3 + 5i</span>
<span class="s">b = new Complex(2, -2) // 2 - 2i</span>
<span class="s">expected = new Complex (16, 4) // 16 + 4i</span>
<span class="s">assert expected == a * b</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_2.16</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">assert Integer.parseInt(&#39;101&#39;, 16) == 257</span>
<span class="s">assert Integer.parseInt(&#39;077&#39;, 8) == 63</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// conversionScript:</span>
<span class="s">print &#39;Gimme a number in decimal, octal, or hex: &#39;</span>
<span class="s">reader = new BufferedReader(new InputStreamReader(System.in))</span>
<span class="s">input = reader.readLine().trim()</span>
<span class="s">switch(input) {</span>
<span class="s">    case ~&#39;^0x\\d+&#39;:</span>
<span class="s">        number = Integer.parseInt(input.substring(2), 16); break</span>
<span class="s">    case ~&#39;^0\\d+&#39;:</span>
<span class="s">        number = Integer.parseInt(input.substring(1), 8); break</span>
<span class="s">    default:</span>
<span class="s">        number = Integer.parseInt(input)</span>
<span class="s">}</span>
<span class="s">println &#39;Decimal value: &#39; + number</span>

<span class="s">// permissionScript:</span>
<span class="s">print &#39;Enter file permission in octal: &#39;</span>
<span class="s">input = new BufferedReader(new InputStreamReader(System.in))</span>
<span class="s">num = input.readLine().trim()</span>
<span class="s">permission = Integer.parseInt(num, 8)</span>
<span class="s">println &#39;Decimal value: &#39; + permission</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_2.17</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">nf = NumberFormat.getInstance()</span>
<span class="s">assert nf.format(-1740525205) == &#39;-1,740,525,205&#39;</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// @@PLEAC@@_2.18</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">def timeMessage(hour) { &#39;It took &#39; + hour + &#39; hour&#39; + (hour == 1 ? &#39;&#39; : &#39;s&#39;) }</span>
<span class="s">assert &#39;It took 1 hour&#39; == timeMessage(1)</span>
<span class="s">assert &#39;It took 2 hours&#39; == timeMessage(2)</span>

<span class="s">// you can also use Java&#39;s ChoiceFormat</span>
<span class="s">// overkill for this example but extensible and compatible with MessageFormat</span>
<span class="s">limits = [1, ChoiceFormat.nextDouble(1)] as double[]</span>
<span class="s">names = [&#39;century&#39;, &#39;centuries&#39;] as String[]</span>
<span class="s">choice = new ChoiceFormat(limits, names)</span>
<span class="s">numCenturies = 1</span>
<span class="s">expected = &#39;It took 1 century&#39;</span>
<span class="s">assert expected == &quot;It took $numCenturies &quot; + choice.format(numCenturies)</span>
<span class="s">// an alternate constructor syntax</span>
<span class="s">choice = new ChoiceFormat(&#39;0#are no files|1#is one file|2#are multiple files&#39;)</span>
<span class="s">assert choice.format(3) == &#39;are multiple files&#39;</span>

<span class="s">// more complex pluralization can be done with Java libraries, e.g.:</span>
<span class="s">// http://www.elvis.ac.nz/brain?PluralizationMapping</span>
<span class="s">// org.springframework.util.Pluralizer within the Spring Framework (springframework.org)</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_2.19</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// calculating prime factors</span>
<span class="s">def factorize(BigInteger orig) {</span>
<span class="s">    factors = [:]</span>
<span class="s">    def addFactor = { x -&gt; if (factors[x]) factors[x] += 1 else factors[x] = 1 }</span>
<span class="s">    n = orig</span>
<span class="s">    i = 2</span>
<span class="s">    sqi = 4               // square of i</span>
<span class="s">    while (sqi &lt;= n) {</span>
<span class="s">        while (n.remainder(i) == 0) {</span>
<span class="s">            n /= i</span>
<span class="s">            addFactor i</span>
<span class="s">        }</span>
<span class="s">        // we take advantage of the fact that (i+1)**2 = i**2 + 2*i + 1</span>
<span class="s">        sqi += 2 * i + 1</span>
<span class="s">        i += 1</span>
<span class="s">    }</span>
<span class="s">    if ((n != 1) &amp;&amp; (n != orig)) addFactor n</span>
<span class="s">    return factors</span>
<span class="s">}</span>

<span class="s">def pretty(factors) {</span>
<span class="s">    if (!factors) return &quot;PRIME&quot;</span>
<span class="s">    sb = new StringBuffer()</span>
<span class="s">    factors.keySet().sort().each { key -&gt;</span>
<span class="s">        sb &lt;&lt; key</span>
<span class="s">        if (factors[key] &gt; 1) sb &lt;&lt; &quot;**&quot; + factors[key]</span>
<span class="s">        sb &lt;&lt; &quot; &quot;</span>
<span class="s">    }</span>
<span class="s">    return sb.toString().trim()</span>
<span class="s">}</span>

<span class="s">assert pretty(factorize(2178)) == &#39;2 3**2 11**2&#39;</span>
<span class="s">assert pretty(factorize(39887)) == &#39;PRIME&#39;</span>
<span class="s">assert pretty(factorize(239322000000000000000000)) == &#39;2**19 3 5**18 39887&#39;</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_3.0</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// use Date to get the current time</span>
<span class="s">println new Date()</span>
<span class="s">// =&gt; Mon Jan 01 07:12:32 EST 2007</span>
<span class="s">// use Calendar to compute year, month, day, hour, minute, and second values</span>
<span class="s">cal = Calendar.instance</span>
<span class="s">println &#39;Today is day &#39; + cal.get(Calendar.DAY_OF_YEAR) + &#39; of the current year.&#39;</span>
<span class="s">// =&gt; Today is day 1 of the current year.</span>
<span class="s">// there are other Java Date/Time packages with extended capabilities, e.g.:</span>
<span class="s">//     http://joda-time.sourceforge.net/</span>
<span class="s">// there is a special Grails (grails.codehaus.org) time DSL (see below)</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_3.1</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">cal = Calendar.instance</span>
<span class="s">Y = cal.get(Calendar.YEAR)</span>
<span class="s">M = cal.get(Calendar.MONTH) + 1</span>
<span class="s">D = cal.get(Calendar.DATE)</span>
<span class="s">println &quot;The current date is $Y $M $D&quot;</span>
<span class="s">// =&gt; The current date is 2006 04 28</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_3.2</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// create a calendar with current time and time zone</span>
<span class="s">cal = Calendar.instance</span>
<span class="s">// set time zone using long or short timezone values</span>
<span class="s">cal.timeZone = TimeZone.getTimeZone(&quot;America/Los_Angeles&quot;)</span>
<span class="s">cal.timeZone = TimeZone.getTimeZone(&quot;UTC&quot;)</span>
<span class="s">// set date fields one at a time</span>
<span class="s">cal.set(Calendar.MONTH, Calendar.DECEMBER)</span>
<span class="s">// or several together</span>
<span class="s">//calendar.set(year, month - 1, day, hour, minute, second)</span>
<span class="s">// get time in seconds since EPOCH</span>
<span class="s">long time = cal.time.time / 1000</span>
<span class="s">println time</span>
<span class="s">// =&gt; 1196522682</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_3.3</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// create a calendar with current time and time zone</span>
<span class="s">cal = Calendar.instance</span>
<span class="s">// set time</span>
<span class="s">cal.time = new Date(time * 1000)</span>
<span class="s">// get date fields</span>
<span class="s">println(&#39;Dateline: &#39;</span>
<span class="s">    + cal.get(Calendar.HOUR_OF_DAY) + &#39;:&#39;</span>
<span class="s">    + cal.get(Calendar.MINUTE) + &#39;:&#39;</span>
<span class="s">    + cal.get(Calendar.SECOND) + &#39;-&#39;</span>
<span class="s">    + cal.get(Calendar.YEAR) + &#39;/&#39;</span>
<span class="s">    + (cal.get(Calendar.MONTH) + 1) + &#39;/&#39;</span>
<span class="s">    + cal.get(Calendar.DATE))</span>
<span class="s">// =&gt; Dateline: 7:33:16-2007/1/1</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_3.4</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">import java.text.SimpleDateFormat</span>
<span class="s">long difference = 100</span>
<span class="s">long after = time + difference</span>
<span class="s">long before = time - difference</span>

<span class="s">// any field of a calendar is incrementable via add() and roll() methods</span>
<span class="s">cal = Calendar.instance</span>
<span class="s">df = new SimpleDateFormat()</span>
<span class="s">printCal = {cal -&gt; df.format(cal.time)}</span>
<span class="s">cal.set(2000, 0, 1, 00, 01, 0)</span>
<span class="s">assert printCal(cal) == &#39;1/01/00 00:01&#39;</span>
<span class="s">// roll minute back by 2 but don&#39;t adjust other fields</span>
<span class="s">cal.roll(Calendar.MINUTE, -2)</span>
<span class="s">assert printCal(cal) == &#39;1/01/00 00:59&#39;</span>
<span class="s">// adjust hour back 1 and adjust other fields if needed</span>
<span class="s">cal.add(Calendar.HOUR, -1)</span>
<span class="s">assert printCal(cal) == &#39;31/12/99 23:59&#39;</span>

<span class="s">// larger example</span>
<span class="s">cal.timeZone = TimeZone.getTimeZone(&quot;UTC&quot;)</span>
<span class="s">cal.set(1973, 0, 18, 3, 45, 50)</span>
<span class="s">cal.add(Calendar.DATE, 55)</span>
<span class="s">cal.add(Calendar.HOUR_OF_DAY, 2)</span>
<span class="s">cal.add(Calendar.MINUTE, 17)</span>
<span class="s">cal.add(Calendar.SECOND, 5)</span>
<span class="s">assert printCal(cal) == &#39;14/03/73 16:02&#39;</span>

<span class="s">// alternatively, work with epoch times</span>
<span class="s">long birthTime = 96176750359       // 18/Jan/1973, 3:45:50 am</span>
<span class="s">long interval = 5 +                // 5 second</span>
<span class="s">                17 * 60 +          // 17 minute</span>
<span class="s">                2  * 60 * 60 +     // 2 hour</span>
<span class="s">                55 * 60 * 60 * 24  // and 55 day</span>
<span class="s">then = new Date(birthTime + interval * 1000)</span>
<span class="s">assert df.format(then) == &#39;14/03/73 16:02&#39;</span>

<span class="s">// Alternatively, the Google Data module has a category with DSL-like time support:</span>
<span class="s">// http://docs.codehaus.org/display/GROOVY/Google+Data+Support</span>
<span class="s">// which supports the following syntax</span>
<span class="s">// def interval = 5.seconds + 17.minutes + 2.hours + 55.days</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_3.5</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">bree = 361535725  // 16 Jun 1981, 4:35:25</span>
<span class="s">nat  =  96201950  // 18 Jan 1973, 3:45:50</span>
<span class="s">difference = bree - nat</span>
<span class="s">println &quot;There were $difference seconds between Nat and Bree&quot;</span>
<span class="s">// =&gt; There were 265333775 seconds between Nat and Bree</span>
<span class="s">seconds    =  difference % 60</span>
<span class="s">difference = (difference - seconds) / 60</span>
<span class="s">minutes    =  difference % 60</span>
<span class="s">difference = (difference - minutes) / 60</span>
<span class="s">hours      =  difference % 24</span>
<span class="s">difference = (difference - hours)   / 24</span>
<span class="s">days       =  difference % 7</span>
<span class="s">weeks      = (difference - days)    /  7</span>
<span class="s">println &quot;($weeks weeks, $days days, $hours:$minutes:$seconds)&quot;</span>
<span class="s">// =&gt; (438 weeks, 4 days, 23:49:35)</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">cal = Calendar.getInstance(TimeZone.getTimeZone(&quot;UTC&quot;))</span>
<span class="s">cal.set(1981, 5, 16)  // 16 Jun 1981</span>
<span class="s">date1 = cal.time</span>
<span class="s">cal.set(1973, 0, 18)  // 18 Jan 1973</span>
<span class="s">date2 = cal.time</span>
<span class="s">difference = Math.abs(date2.time - date1.time)</span>
<span class="s">days = difference / (1000 * 60 * 60 * 24)</span>
<span class="s">assert days == 3071</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_3.6</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// create a calendar with current time and time zone</span>
<span class="s">cal = Calendar.instance</span>
<span class="s">cal.set(1981, 5, 16)</span>
<span class="s">yearDay = cal.get(Calendar.DAY_OF_YEAR);</span>
<span class="s">year = cal.get(Calendar.YEAR);</span>
<span class="s">yearWeek = cal.get(Calendar.WEEK_OF_YEAR);</span>
<span class="s">df1 = new SimpleDateFormat(&quot;dd/MMM/yy&quot;)</span>
<span class="s">df2 = new SimpleDateFormat(&quot;EEEE&quot;)</span>
<span class="s">print(df1.format(cal.time) + &#39; was a &#39; + df2.format(cal.time))</span>
<span class="s">println &quot; and was day number $yearDay and week number $yearWeek of $year&quot;</span>
<span class="s">// =&gt; 16/Jun/81 was a Tuesday and was day number 167 and week number 25 of 1981</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_3.7</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">input = &quot;1998-06-03&quot;</span>
<span class="s">df1 = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;)</span>
<span class="s">date = df1.parse(input)</span>
<span class="s">df2 = new SimpleDateFormat(&quot;MMM/dd/yyyy&quot;)</span>
<span class="s">println &#39;Date was &#39; + df2.format(date)</span>
<span class="s">// =&gt; Date was Jun/03/1998</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_3.8</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">import java.text.DateFormat</span>
<span class="s">df = new SimpleDateFormat(&#39;E M d hh:mm:ss z yyyy&#39;)</span>
<span class="s">cal.set(2007, 0, 1)</span>
<span class="s">println &#39;Customized format gives: &#39; + df.format(cal.time)</span>
<span class="s">// =&gt; Mon 1 1 09:02:29 EST 2007 (differs depending on your timezone)</span>
<span class="s">df = DateFormat.getDateInstance(DateFormat.FULL, Locale.FRANCE)</span>
<span class="s">println &#39;Customized format gives: &#39; + df.format(cal.time)</span>
<span class="s">// =&gt; lundi 1 janvier 2007</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_3.9</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// script:</span>
<span class="s">println &#39;Press return when ready&#39;</span>
<span class="s">before = System.currentTimeMillis()</span>
<span class="s">input = new BufferedReader(new InputStreamReader(System.in)).readLine()</span>
<span class="s">after = System.currentTimeMillis()</span>
<span class="s">elapsed = (after - before) / 1000</span>
<span class="s">println &quot;You took $elapsed seconds.&quot;</span>
<span class="s">// =&gt; You took2.313 seconds.</span>

<span class="s">// take mean sorting time</span>
<span class="s">size = 500; number = 100; total = 0</span>
<span class="s">for (i in 0..&lt;number) {</span>
<span class="s">    array = []</span>
<span class="s">    size.times{ array &lt;&lt; Math.random() }</span>
<span class="s">    doubles = array as double[]</span>
<span class="s">    // sort it</span>
<span class="s">    long t0 = System.currentTimeMillis()</span>
<span class="s">    Arrays.sort(doubles)</span>
<span class="s">    long t1 = System.currentTimeMillis()</span>
<span class="s">    total += (t1 - t0)</span>
<span class="s">}</span>
<span class="s">println &quot;On average, sorting $size random numbers takes ${total / number} milliseconds&quot;</span>
<span class="s">// =&gt; On average, sorting 500 random numbers takes 0.32 milliseconds</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_3.10</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">delayMillis = 50</span>
<span class="s">Thread.sleep(delayMillis)</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_3.11</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// this could be done more simply using JavaMail&#39;s getAllHeaderLines() but is shown</span>
<span class="s">// in long hand for illustrative purposes</span>
<span class="s">sampleMessage = &#39;&#39;&#39;Delivered-To: alias-someone@somewhere.com.au</span>
<span class="s">Received: (qmail 27284 invoked from network); 30 Dec 2006 15:16:26 -0000</span>
<span class="s">Received: from unknown (HELO lists-outbound.sourceforge.net) (66.35.250.225)</span>
<span class="s">  by bne012m.server-web.com with SMTP; 30 Dec 2006 15:16:25 -0000</span>
<span class="s">Received: from sc8-sf-list2-new.sourceforge.net (sc8-sf-list2-new-b.sourceforge.net [10.3.1.94])</span>
<span class="s">    by sc8-sf-spam2.sourceforge.net (Postfix) with ESMTP</span>
<span class="s">    id D8CCBFDE3; Sat, 30 Dec 2006 07:16:24 -0800 (PST)</span>
<span class="s">Received: from sc8-sf-mx1-b.sourceforge.net ([10.3.1.91]</span>
<span class="s">    helo=mail.sourceforge.net)</span>
<span class="s">    by sc8-sf-list2-new.sourceforge.net with esmtp (Exim 4.43)</span>
<span class="s">    id 1H0fwX-0003c0-GA</span>
<span class="s">    for pleac-discuss@lists.sourceforge.net; Sat, 30 Dec 2006 07:16:20 -0800</span>
<span class="s">Received: from omta05ps.mx.bigpond.com ([144.140.83.195])</span>
<span class="s">    by mail.sourceforge.net with esmtp (Exim 4.44) id 1H0fwY-0005D4-DD</span>
<span class="s">    for pleac-discuss@lists.sourceforge.net; Sat, 30 Dec 2006 07:16:19 -0800</span>
<span class="s">Received: from win2K001 ([138.130.127.127]) by omta05ps.mx.bigpond.com</span>
<span class="s">    with SMTP</span>
<span class="s">    id &lt;20061230151611.XVWL19269.omta05ps.mx.bigpond.com@win2K001&gt;;</span>
<span class="s">    Sat, 30 Dec 2006 15:16:11 +0000</span>
<span class="s">From: someone@somewhere.com</span>
<span class="s">To: &lt;pleac-discuss@lists.sourceforge.net&gt;</span>
<span class="s">Date: Sun, 31 Dec 2006 02:14:57 +1100</span>
<span class="s">Subject: Re: [Pleac-discuss] C/Posix/GNU - @@pleac@@_10x</span>
<span class="s">Content-Type: text/plain; charset=&quot;us-ascii&quot;</span>
<span class="s">Content-Transfer-Encoding: 7bit</span>
<span class="s">Sender: pleac-discuss-bounces@lists.sourceforge.net</span>
<span class="s">Errors-To: pleac-discuss-bounces@lists.sourceforge.net</span>

<span class="s">----- Original Message -----</span>
<span class="s">From: someone@somewhere.com</span>
<span class="s">To: otherperson@somewhereelse.com</span>
<span class="s">Cc: &lt;pleac-discuss@lists.sourceforge.net&gt;</span>
<span class="s">Sent: Wednesday, December 27, 2006 9:18 AM</span>
<span class="s">Subject: Re: [Pleac-discuss] C/Posix/GNU - @@pleac@@_10x</span>

<span class="s">I really like that description of PLEAC.</span>
<span class="s">&#39;&#39;&#39;</span>
<span class="s">expected = &#39;&#39;&#39;</span>
<span class="s">Sender                    Recipient                 Time              Delta</span>
<span class="s">&lt;origin&gt;                  somewhere.com             01:14:57 06/12/31 </span>
<span class="s">win2K001                  omta05ps.mx.bigpond.com   01:14:57 06/12/31 1m 14s</span>
<span class="s">omta05ps.mx.bigpond.com   mail.sourceforge.net      01:16:11 06/12/31 8s</span>
<span class="s">sc8-sf-mx1-b.sourceforge. sc8-sf-list2-new.sourcefo 01:16:19 06/12/31 1s</span>
<span class="s">sc8-sf-list2-new.sourcefo sc8-sf-spam2.sourceforge. 01:16:20 06/12/31 4s</span>
<span class="s">unknown                   bne012m.server-web.com    01:16:24 06/12/31 1s</span>
<span class="s">&#39;&#39;&#39;</span>

<span class="s">class MailHopDelta {</span>
<span class="s">    def headers, firstSender, firstDate, out</span>

<span class="s">    MailHopDelta(mail) {</span>
<span class="s">        extractHeaders(mail)</span>
<span class="s">        out = new StringBuffer()</span>
<span class="s">        def m = (mail =~ /(?m)^Date:\s+(.*)/)</span>
<span class="s">        firstDate = parseDate(m[0][1])</span>
<span class="s">        firstSender = (mail =~ /(?m)^From.*\@([^\s&gt;]*)/)[0][1]</span>
<span class="s">        out(&#39;Sender Recipient Time Delta&#39;.split(&#39; &#39;))</span>
<span class="s">    }</span>

<span class="s">    def parseDate(date) {</span>
<span class="s">        try {</span>
<span class="s">            return new SimpleDateFormat(&#39;EEE, dd MMM yyyy hh:mm:ss Z&#39;).parse(date)</span>
<span class="s">        } catch(java.text.ParseException ex) {}</span>
<span class="s">        try {</span>
<span class="s">            return new SimpleDateFormat(&#39;dd MMM yyyy hh:mm:ss Z&#39;).parse(date)</span>
<span class="s">        } catch(java.text.ParseException ex) {}</span>
<span class="s">        try {</span>
<span class="s">            return DateFormat.getDateInstance(DateFormat.FULL).parse(date)</span>
<span class="s">        } catch(java.text.ParseException ex) {}</span>
<span class="s">        DateFormat.getDateInstance(DateFormat.LONG).parse(date)</span>
<span class="s">    }</span>

<span class="s">    def extractHeaders(mail) {</span>
<span class="s">        headers = []</span>
<span class="s">        def isHeader = true</span>
<span class="s">        def currentHeader = &#39;&#39;</span>
<span class="s">        mail.split(&#39;\n&#39;).each{ line -&gt;</span>
<span class="s">            if (!isHeader) return</span>
<span class="s">            switch(line) {</span>
<span class="s">                case ~/^\s*$/:</span>
<span class="s">                    isHeader = false</span>
<span class="s">                    if (currentHeader) headers &lt;&lt; currentHeader</span>
<span class="s">                    break</span>
<span class="s">                case ~/^\s+.*/:</span>
<span class="s">                    currentHeader += line; break</span>
<span class="s">                default:</span>
<span class="s">                    if (currentHeader) headers &lt;&lt; currentHeader</span>
<span class="s">                    currentHeader = line</span>
<span class="s">            }</span>
<span class="s">        }</span>
<span class="s">    }</span>

<span class="s">    def out(line) {</span>
<span class="s">        out &lt;&lt; line[0][0..&lt;[25,line[0].size()].min()].padRight(26)</span>
<span class="s">        out &lt;&lt; line[1][0..&lt;[25,line[1].size()].min()].padRight(26)</span>
<span class="s">        out &lt;&lt; line[2].padRight(17) + &#39; &#39;</span>
<span class="s">        out &lt;&lt; line[3] + &#39;\n&#39;</span>
<span class="s">    }</span>

<span class="s">    def prettyDate(date) {</span>
<span class="s">        new SimpleDateFormat(&#39;hh:mm:ss yy/MM/dd&#39;).format(date)</span>
<span class="s">    }</span>

<span class="s">    def process() {</span>
<span class="s">        out([&#39;&lt;origin&gt;&#39;, firstSender, prettyDate(firstDate), &#39;&#39;])</span>
<span class="s">        def prevDate = firstDate</span>
<span class="s">        headers.grep(~/^Received:\sfrom.*/).reverseEach{ hop -&gt;</span>
<span class="s">            def from = (hop =~ /from\s+(\S+)|\((.*?)\)/)[0][1]</span>
<span class="s">            def by   = (hop =~ /by\s+(\S+\.\S+)/)[0][1]</span>
<span class="s">            def hopDate = parseDate(hop[hop.lastIndexOf(&#39;;&#39;)+2..-1])</span>
<span class="s">            out([from, by, prettyDate(prevDate), prettyDelta(hopDate.time - prevDate.time)])</span>
<span class="s">            prevDate = hopDate</span>
<span class="s">        }</span>
<span class="s">        return out.toString()</span>
<span class="s">    }</span>

<span class="s">    def prettyField(secs, sign, ch, multiplier, sb) {</span>
<span class="s">        def whole = (int)(secs / multiplier)</span>
<span class="s">        if (!whole) return 0</span>
<span class="s">        sb &lt;&lt; &#39;&#39; + (sign * whole) + ch + &#39; &#39;</span>
<span class="s">        return whole * multiplier</span>
<span class="s">    }</span>

<span class="s">    def prettyDelta(millis) {</span>
<span class="s">        def sign = millis &lt; 0 ? -1 : 1</span>
<span class="s">        def secs = (int)Math.abs(millis/1000)</span>
<span class="s">        def sb = new StringBuffer()</span>
<span class="s">        secs -= prettyField(secs, sign, &#39;d&#39;, 60 * 60 * 24, sb)</span>
<span class="s">        secs -= prettyField(secs, sign, &#39;h&#39;, 60 * 60, sb)</span>
<span class="s">        secs -= prettyField(secs, sign, &#39;m&#39;, 60, sb)</span>
<span class="s">        prettyField(secs, sign, &#39;s&#39;, 1, sb)</span>
<span class="s">        return sb.toString().trim()</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">assert &#39;\n&#39; + new MailHopDelta(sampleMessage).process() == expected</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_4.0</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">simple = [ &quot;this&quot;, &quot;that&quot;, &quot;the&quot;, &quot;other&quot; ]</span>
<span class="s">nested = [ &quot;this&quot;, &quot;that&quot;, [ &quot;the&quot;, &quot;other&quot; ] ]</span>
<span class="s">assert nested.size() == 3</span>
<span class="s">assert nested[2].size() == 2</span>

<span class="s">flattenNestedToSimple = [ &quot;this&quot;, &quot;that&quot;, [ &quot;the&quot;, &quot;other&quot; ] ].flatten()</span>
<span class="s">assert flattenNestedToSimple.size() == 4</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_4.1</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">a = [ &quot;quick&quot;, &quot;brown&quot;, &quot;fox&quot; ]</span>
<span class="s">assert a.size() == 3</span>
<span class="s">a = &#39;Why are you teasing me?&#39;.split(&#39; &#39;)</span>
<span class="s">assert a == [&quot;Why&quot;, &quot;are&quot;, &quot;you&quot;, &quot;teasing&quot;, &quot;me?&quot;]</span>

<span class="s">removeLeadingSpaces = { it.trim() }</span>
<span class="s">nonBlankLines = { it }</span>
<span class="s">lines = &#39;&#39;&#39;</span>
<span class="s">    The boy stood on the burning deck,</span>
<span class="s">    It was as hot as glass.</span>
<span class="s">&#39;&#39;&#39;.split(&#39;\n&#39;).collect(removeLeadingSpaces).findAll(nonBlankLines)</span>

<span class="s">assert lines == [&quot;The boy stood on the burning deck,&quot;,</span>
<span class="s">                 &quot;It was as hot as glass.&quot;]</span>

<span class="s">// initialiseListFromFileScript:</span>
<span class="s">lines = new File(&#39;mydata.txt&#39;).readLines()</span>

<span class="s">// processFileScript:</span>
<span class="s">new File(&#39;mydata.txt&#39;).eachLine{</span>
<span class="s">    // dosomething</span>
<span class="s">}</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_4.2</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">marbleColors = [&#39;red&#39;, &#39;green&#39;, &#39;yellow&#39;]</span>
<span class="s">assert marbleColors.join(&#39;, &#39;) == &#39;red, green, yellow&#39;</span>

<span class="s">def commify(items) {</span>
<span class="s">    if (!items) return items</span>
<span class="s">    def sepchar = items.find{ it =~ /,/ } ? &#39;; &#39; : &#39;, &#39;</span>
<span class="s">    switch (items.size()) {</span>
<span class="s">        case 1: return items[0]</span>
<span class="s">        case 2: return items.join(&#39; and &#39;)</span>
<span class="s">    }</span>
<span class="s">    items[0..-2].join(sepchar) + sepchar + &#39;and &#39; + items[-1]</span>
<span class="s">}</span>

<span class="s">assert commify(marbleColors) == &#39;red, green, and yellow&#39;</span>

<span class="s">lists = [</span>
<span class="s">    [ &#39;just one thing&#39; ],</span>
<span class="s">    [ &#39;Mutt&#39;, &#39;Jeff&#39; ],</span>
<span class="s">    &#39;Peter Paul Mary&#39;.split(&#39; &#39;),</span>
<span class="s">    [ &#39;To our parents&#39;, &#39;Mother Theresa&#39;, &#39;God&#39; ],</span>
<span class="s">    [ &#39;pastrami&#39;, &#39;ham and cheese&#39;, &#39;peanut butter and jelly&#39;, &#39;tuna&#39; ],</span>
<span class="s">    [ &#39;recycle tired, old phrases&#39;, &#39;ponder big, happy thoughts&#39; ],</span>
<span class="s">    [ &#39;recycle tired, old phrases&#39;,</span>
<span class="s">      &#39;ponder big, happy thoughts&#39;,</span>
<span class="s">      &#39;sleep and dream peacefully&#39; ],</span>
<span class="s">]</span>

<span class="s">expected = &#39;&#39;&#39;</span>
<span class="s">just one thing</span>
<span class="s">Mutt and Jeff</span>
<span class="s">Peter, Paul, and Mary</span>
<span class="s">To our parents, Mother Theresa, and God</span>
<span class="s">pastrami, ham and cheese, peanut butter and jelly, and tuna</span>
<span class="s">recycle tired, old phrases and ponder big, happy thoughts</span>
<span class="s">recycle tired, old phrases; ponder big, happy thoughts; and sleep and dream peacefully</span>
<span class="s">&#39;&#39;&#39;</span>

<span class="s">assert expected == &#39;\n&#39; + lists.collect{commify(it)}.join(&#39;\n&#39;) + &#39;\n&#39;</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_4.3</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// In Groovy, lists and arrays are more or less interchangeable</span>
<span class="s">// here is the example using lists</span>
<span class="s">people = [&#39;Crosby&#39;, &#39;Stills&#39;, &#39;Nash&#39;]</span>
<span class="s">assert people.size() == 3</span>
<span class="s">people[3] = &#39;Young&#39;</span>
<span class="s">assert people.size() == 4</span>
<span class="s">assert people == [&#39;Crosby&#39;, &#39;Stills&#39;, &#39;Nash&#39;, &#39;Young&#39;]</span>
<span class="s">// to use arrays simply do &#39;people = peopleArray.toList()&#39; at the start</span>
<span class="s">// and &#39;peopleArray = people as String[]&#39; at the end</span>
<span class="s">// if you attempt to do extension on a Java array you will get an</span>
<span class="s">// ArrayIndexOutOfBoundsException - which is why Java has ArrayList et al</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_4.4</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// list to process</span>
<span class="s">people == [&#39;Crosby&#39;, &#39;Stills&#39;, &#39;Nash&#39;, &#39;Young&#39;]</span>
<span class="s">// helper</span>
<span class="s">startsWithCapital = { word -&gt; word[0] in &#39;A&#39;..&#39;Z&#39; }</span>

<span class="s">// various styles are possible for processing lists</span>
<span class="s">// closure style</span>
<span class="s">people.each { person -&gt; assert startsWithCapital(person) }</span>
<span class="s">// for loop style</span>
<span class="s">for (person in people) { assert startsWithCapital(person) }</span>

<span class="s">// unixScriptToFindAllUsersStartingWithLetterA:</span>
<span class="s">all = &#39;who&#39;.execute().text.replaceAll(&#39;\r&#39;, &#39;&#39;).split(&#39;\n&#39;)</span>
<span class="s">all.grep(~/^a.*/).each{ println it }</span>

<span class="s">// printFileWithWordsReversedScript:</span>
<span class="s">new File(&#39;Pleac/src/SlowCat.groovy&#39;).eachLine{ line -&gt;</span>
<span class="s">     line.split(&#39; &#39;).each{ print it.reverse() }</span>
<span class="s">}</span>

<span class="s">a = [0.5, 3]; b = [0, 1]</span>
<span class="s">assert [a, b].flatten().collect{ it * 7 } == [3.5, 21, 0, 7]</span>
<span class="s">// above doesn&#39;t modify original arrays</span>
<span class="s">// instead use a = a.collect{ ... }</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_4.5</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// not relevant in Groovy since we have always references</span>
<span class="s">items = []</span>
<span class="s">for (item in items) {</span>
<span class="s">    // do something with item</span>
<span class="s">}</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_4.6</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">assert [ 1, 1, 2, 2, 3, 3, 3, 5 ].unique() == [ 1, 2, 3, 5 ]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_4.7</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">assert [ 1, 1, 2, 2, 3, 3, 3, 4, 5 ] - [ 1, 2, 4 ]  ==  [3, 3, 3, 5]</span>
<span class="s">assert [ 1, 1, 2, 2, 3, 3, 3, 4, 5 ].unique() - [ 1, 2, 4 ]  ==  [3, 5]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_4.8</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">a = [1, 3, 5, 6, 7, 8]</span>
<span class="s">b = [2, 3, 5, 7, 9]</span>
<span class="s">// intersection</span>
<span class="s">assert a.intersect(b) == [3, 5, 7]</span>
<span class="s">// union</span>
<span class="s">assert (a + b).unique().sort() == [1, 2, 3, 5, 6, 7, 8, 9]</span>
<span class="s">// difference</span>
<span class="s">assert (a - b) == [1, 6, 8]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_4.9</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">members = [ &quot;Time&quot;, &quot;Flies&quot; ]</span>
<span class="s">initiates =  [ &quot;An&quot;, &quot;Arrow&quot; ]</span>
<span class="s">members += initiates</span>
<span class="s">assert members == [&quot;Time&quot;, &quot;Flies&quot;, &quot;An&quot;, &quot;Arrow&quot;]</span>

<span class="s">members.add(2, &quot;Like&quot;)</span>
<span class="s">assert members == [&quot;Time&quot;, &quot;Flies&quot;, &quot;Like&quot;, &quot;An&quot;, &quot;Arrow&quot;]</span>

<span class="s">members[0] = &quot;Fruit&quot;</span>
<span class="s">members[3..4] = [&quot;A&quot;, &quot;Banana&quot;]</span>
<span class="s">assert members == [&quot;Fruit&quot;, &quot;Flies&quot;, &quot;Like&quot;, &quot;A&quot;, &quot;Banana&quot;]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_4.10</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">items = [&quot;the&quot;, &quot;quick&quot;, &quot;brown&quot;, &quot;fox&quot;]</span>
<span class="s">assert items.reverse() == [&quot;fox&quot;, &quot;brown&quot;, &quot;quick&quot;, &quot;the&quot;]</span>

<span class="s">firstLetters = []</span>
<span class="s">items.reverseEach{ firstLetters += it[0] }</span>
<span class="s">assert firstLetters.join() == &#39;fbqt&#39;</span>

<span class="s">descending = items.sort().reverse()</span>
<span class="s">assert descending == [&quot;the&quot;, &quot;quick&quot;, &quot;fox&quot;, &quot;brown&quot;]</span>
<span class="s">descendingBySecondLastLetter = items.sort { a,b -&gt; b[-2] &lt;=&gt; a[-2] }</span>
<span class="s">assert descendingBySecondLastLetter == [&quot;brown&quot;, &quot;fox&quot;, &quot;the&quot;, &quot;quick&quot;]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_4.11</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// warning: not an exact equivalent, idiomatic use would return copies</span>
<span class="s">def shift2 = {one = friends[0]; two = friends[1]; 2.times{friends.remove(0)}}</span>
<span class="s">friends = &#39;Peter Paul Mary Jim Tim&#39;.split(&#39; &#39;).toList()</span>
<span class="s">shift2()</span>
<span class="s">assert one == &#39;Peter&#39;</span>
<span class="s">assert two == &#39;Paul&#39;</span>
<span class="s">assert friends == [&quot;Mary&quot;, &quot;Jim&quot;, &quot;Tim&quot;]</span>

<span class="s">def pop2(items) { items[0..1] }</span>
<span class="s">beverages = &#39;Dew Jolt Cola Sprite Fresca&#39;.split(&#39; &#39;).toList()</span>
<span class="s">pair = pop2(beverages)</span>
<span class="s">assert pair == [&quot;Dew&quot;, &quot;Jolt&quot;]</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_4.12</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">class Employee {</span>
<span class="s">    def name</span>
<span class="s">    def position</span>
<span class="s">    def salary</span>
<span class="s">}</span>
<span class="s">staff = [new Employee(name:&#39;Jim&#39;,position:&#39;Manager&#39;,salary:26000),</span>
<span class="s">         new Employee(name:&#39;Jill&#39;,position:&#39;Engineer&#39;,salary:24000),</span>
<span class="s">         new Employee(name:&#39;Jack&#39;,position:&#39;Engineer&#39;,salary:22000)]</span>
<span class="s">highestEngineer = staff.find { emp -&gt; emp.position == &#39;Engineer&#39; }</span>
<span class="s">assert highestEngineer.salary == 24000</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_4.13</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">engineers = staff.findAll { e -&gt; e.position == &#39;Engineer&#39; }</span>
<span class="s">assert engineers.size() == 2</span>

<span class="s">highPaid = staff.findAll { e -&gt; e.salary &gt; 23000 }</span>
<span class="s">assert highPaid*.name == [&quot;Jim&quot;, &quot;Jill&quot;]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_4.14</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// sort works for numbers</span>
<span class="s">assert [100, 3, 20].sort() == [3, 20, 100]</span>
<span class="s">// strings representing numbers will be sorted alphabetically</span>
<span class="s">assert [&#39;100&#39;, &#39;3&#39;, &#39;20&#39;].sort() == [&quot;100&quot;, &quot;20&quot;, &quot;3&quot;]</span>
<span class="s">// closure style sorting allows arbitrary expressions for the comparison</span>
<span class="s">assert [&#39;100&#39;, &#39;3&#39;, &#39;20&#39;].sort{ a,b -&gt; a.toLong() &lt;=&gt; b.toLong()} == [&quot;3&quot;, &quot;20&quot;, &quot;100&quot;]</span>

<span class="s">// obtain the following on unix systems using: &#39;ps ux&#39;.execute().text</span>
<span class="s">processInput = &#39;&#39;&#39;</span>
<span class="s">      PID    PPID    PGID     WINPID  TTY  UID    STIME COMMAND</span>
<span class="s">     3868       1    3868       3868  con 1005 06:23:34 /usr/bin/bash</span>
<span class="s">     3456    3868    3456       3528  con 1005 06:23:39 /usr/bin/ps</span>
<span class="s">&#39;&#39;&#39;</span>
<span class="s">nonEmptyLines = {it.trim()}</span>
<span class="s">lines = processInput.split(&quot;\n&quot;).findAll(nonEmptyLines)[1..-1]</span>
<span class="s">def col(n, s) { s.tokenize()[n] }</span>
<span class="s">commandIdx = 7</span>
<span class="s">pidIdx = 0</span>
<span class="s">ppidIdx = 1</span>
<span class="s">linesByPid = lines.sort{ col(pidIdx,it).toLong() }</span>
<span class="s">assert col(commandIdx, linesByPid[0]) == &#39;/usr/bin/ps&#39;</span>
<span class="s">linesByPpid = lines.sort{ col(ppidIdx,it).toLong() }</span>
<span class="s">assert col(commandIdx, linesByPpid[0]) == &#39;/usr/bin/bash&#39;</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_4.15</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// sort staff from 4.12 by name</span>
<span class="s">assert staff.sort { a,b -&gt; a.name &lt;=&gt; b.name }*.name == [&quot;Jack&quot;, &quot;Jill&quot;, &quot;Jim&quot;]</span>
<span class="s">// sort by first two characters of name and if equal by descending salary</span>
<span class="s">assert staff.sort { a,b -&gt;</span>
<span class="s">    astart = a.name[0..1]</span>
<span class="s">    bstart = b.name[0..1]</span>
<span class="s">    if (astart == bstart) return b.salary &lt;=&gt; a.salary</span>
<span class="s">    return astart &lt;=&gt; bstart</span>
<span class="s">}*.name == [&quot;Jack&quot;, &quot;Jim&quot;, &quot;Jill&quot;]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_4.16</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">items = [1, 2, 3, 4, 5]</span>
<span class="s">processed = []</span>
<span class="s">10.times{</span>
<span class="s">    processed &lt;&lt; items[0]</span>
<span class="s">    items = items[1..-1] + items[0]</span>
<span class="s">}</span>
<span class="s">assert processed == [1, 2, 3, 4, 5, 1, 2, 3, 4, 5]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_4.17</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">import java.text.DateFormatSymbols as Symbols</span>
<span class="s">items = new Symbols().shortWeekdays.toList()[1..7]</span>
<span class="s">assert items == [&quot;Sun&quot;, &quot;Mon&quot;, &quot;Tue&quot;, &quot;Wed&quot;, &quot;Thu&quot;, &quot;Fri&quot;, &quot;Sat&quot;]</span>
<span class="s">// not as random as you might expect</span>
<span class="s">println items.sort{ Math.random() }</span>
<span class="s">// =&gt; [&quot;Sat&quot;, &quot;Tue&quot;, &quot;Sun&quot;, &quot;Wed&quot;, &quot;Mon&quot;, &quot;Thu&quot;, &quot;Fri&quot;]</span>
<span class="s">// better to use the built-in method for this purpose</span>
<span class="s">Collections.shuffle(items)</span>
<span class="s">println items</span>
<span class="s">// =&gt; [&quot;Wed&quot;, &quot;Tue&quot;, &quot;Fri&quot;, &quot;Sun&quot;, &quot;Sat&quot;, &quot;Thu&quot;, &quot;Mon&quot;]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_4.18</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">symbols = new Symbols()</span>
<span class="s">words = symbols.weekdays.toList()[1..7] +</span>
<span class="s">    symbols.months.toList()[0..11] +</span>
<span class="s">    symbols.eras.toList() +</span>
<span class="s">    symbols.amPmStrings.toList()</span>

<span class="s">expected = //</span>
<span class="s">&#39;AD        August    February  July      May       October   September Tuesday   \n&#39; +</span>
<span class="s">&#39;AM        BC        Friday    June      Monday    PM        Sunday    Wednesday \n&#39; +</span>
<span class="s">&#39;April     December  January   March     November  Saturday  Thursday  \n&#39;</span>

<span class="s">class WordFormatter {</span>
<span class="s">    def cols</span>

<span class="s">    def process(list) {</span>
<span class="s">        def sb = new StringBuffer()</span>
<span class="s">        def colWidth = list.max{it.size()}.size() + 1</span>
<span class="s">        int columns = [cols/colWidth, 1].max()</span>
<span class="s">        def numWords = list.size()</span>
<span class="s">        int rows = (numWords + columns - 1) / columns</span>
<span class="s">        for (row in 0..&lt;rows) {</span>
<span class="s">            for (col in 0..&lt;columns) {</span>
<span class="s">                def target = row + col * rows</span>
<span class="s">                if (target &lt; numWords)</span>
<span class="s">                    sb &lt;&lt; list[target].padRight(colWidth)</span>
<span class="s">            }</span>
<span class="s">            sb &lt;&lt; &#39;\n&#39;</span>
<span class="s">        }</span>
<span class="s">        return sb.toString()</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">// get nr of chars that fit in window or console, see PLEAC 15.4</span>
<span class="s">// hard-coded here but several packages are available, e.g. in JLine</span>
<span class="s">// use a concrete implementation of Terminal.getTerminalWidth()</span>
<span class="s">def getWinCharWidth() { 80 }</span>

<span class="s">// main script</span>
<span class="s">actual = new WordFormatter(cols:getWinCharWidth()).process(words.sort())</span>
<span class="s">assert actual == expected</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_4.19</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// recursive version is simplest but can be inefficient</span>
<span class="s">def fact(n) { (n == 1) ? 1 : n * fact(n-1)}</span>
<span class="s">assert fact(10) == 3628800</span>
<span class="s">// unwrapped version: note use of BigInteger</span>
<span class="s">def factorial(n) {</span>
<span class="s">    def result = 1G // 1 as BigInteger</span>
<span class="s">    while (n &gt; 0) {</span>
<span class="s">        result *= n</span>
<span class="s">        n -= 1</span>
<span class="s">    }</span>
<span class="s">    return result</span>
<span class="s">}</span>
<span class="s">expected = 93326215443944152681699238856266700490715968264381621468592963895217599993229915608941463976156518286253697920827223758251185210916864000000000000000000000000</span>
<span class="s">assert expected == factorial(100)</span>
<span class="s">// println factorial(10000)</span>
<span class="s">// =&gt; 284625... (greater than 35,000 digits)</span>

<span class="s">// simple version but less efficient</span>
<span class="s">def simplePermute(items, perms) {</span>
<span class="s">    if (items.size() == 0)</span>
<span class="s">        println perms.join(&#39; &#39;)</span>
<span class="s">    else</span>
<span class="s">        for (i in items) {</span>
<span class="s">            newitems = items.clone()</span>
<span class="s">            newperms = perms.clone()</span>
<span class="s">            newperms.add(i)</span>
<span class="s">            newitems.remove(i)</span>
<span class="s">            simplePermute(newitems, newperms)</span>
<span class="s">        }</span>
<span class="s">}</span>
<span class="s">simplePermute([&#39;dog&#39;, &#39;bites&#39;, &#39;man&#39;], [])</span>
<span class="s">// =&gt;</span>
<span class="s">//dog bites man</span>
<span class="s">//dog man bites</span>
<span class="s">//bites dog man</span>
<span class="s">//bites man dog</span>
<span class="s">//man dog bites</span>
<span class="s">//man bites dog</span>

<span class="s">// optimised version below</span>
<span class="s">expected = &#39;&#39;&#39;</span>
<span class="s">man bites dog</span>
<span class="s">man dog bites</span>
<span class="s">bites man dog</span>
<span class="s">bites dog man</span>
<span class="s">dog man bites</span>
<span class="s">dog bites man</span>
<span class="s">&#39;&#39;&#39;</span>

<span class="s">// n2pat(n, len): produce the N-th pattern of length len</span>
<span class="s">def n2pat(n, length) {</span>
<span class="s">    def pat = []</span>
<span class="s">    int i = 1</span>
<span class="s">    while (i &lt;= length) {</span>
<span class="s">        pat &lt;&lt; (n % i)</span>
<span class="s">        n = n.intdiv(i)</span>
<span class="s">        i += 1</span>
<span class="s">    }</span>
<span class="s">    pat</span>
<span class="s">}</span>

<span class="s">// pat2perm(pat): turn pattern returned by n2pat() into</span>
<span class="s">// permutation of integers.</span>
<span class="s">def pat2perm(pat) {</span>
<span class="s">    def source = (0 ..&lt; pat.size()).collect{ it/*.toString()*/ }</span>
<span class="s">    def perm = []</span>
<span class="s">    while (pat.size() &gt; 0) {</span>
<span class="s">        def next = pat.remove(pat.size()-1)</span>
<span class="s">        perm &lt;&lt; source[next]</span>
<span class="s">        source.remove(next)</span>
<span class="s">    }</span>
<span class="s">    perm</span>
<span class="s">}</span>

<span class="s">def n2perm(n, len) {</span>
<span class="s">    pat2perm(n2pat((int)n,len))</span>
<span class="s">}</span>

<span class="s">data = [&#39;man&#39;, &#39;bites&#39;, &#39;dog&#39;]</span>
<span class="s">sb = new StringBuffer()</span>
<span class="s">numPermutations = fact(data.size())</span>
<span class="s">for (j in 0..&lt;numPermutations) {</span>
<span class="s">    def permutation = n2perm(j, data.size()).collect { k -&gt; data[k] }</span>
<span class="s">    sb &lt;&lt; permutation.join(&#39; &#39;) + &#39;\n&#39;</span>
<span class="s">}</span>
<span class="s">assert &#39;\n&#39; + sb.toString() == expected</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_5.0</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// quotes are optional around the key</span>
<span class="s">age = [ Nat:24, Jules:25, Josh:17 ]</span>

<span class="s">assert age[&#39;Nat&#39;]  == 24</span>
<span class="s">// alternate syntax</span>
<span class="s">assert age.&quot;Jules&quot; == 25</span>

<span class="s">foodColor = [</span>
<span class="s">    Apple:  &#39;red&#39;,</span>
<span class="s">    Banana: &#39;yellow&#39;,</span>
<span class="s">    Lemon:  &#39;yellow&#39;,</span>
<span class="s">    Carrot: &#39;orange&#39;</span>
<span class="s">]</span>
<span class="s">assert foodColor.size() == 4</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_5.1</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">foodColor[&#39;Lemon&#39;] = &#39;green&#39;</span>
<span class="s">assert foodColor.size() == 4</span>
<span class="s">assert foodColor[&#39;Lemon&#39;] == &#39;green&#39;</span>
<span class="s">foodColor[&#39;Raspberry&#39;] = &#39;pink&#39;</span>
<span class="s">assert foodColor.size() == 5</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_5.2</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">assert [&#39;Banana&#39;, &#39;Martini&#39;].collect{ foodColor.containsKey(it)?&#39;food&#39;:&#39;drink&#39; } == [ &#39;food&#39;, &#39;drink&#39; ]</span>

<span class="s">age = [Toddler:3, Unborn:0, Phantasm:null]</span>
<span class="s">[&#39;Toddler&#39;, &#39;Unborn&#39;, &#39;Phantasm&#39;, &#39;Relic&#39;].each{ key -&gt;</span>
<span class="s">    print &quot;$key: &quot;</span>
<span class="s">    if (age.containsKey(key)) print &#39;has key &#39;</span>
<span class="s">    if (age.containsKey(key) &amp;&amp; age[key]!=null) print &#39;non-null &#39;</span>
<span class="s">    if (age.containsKey(key) &amp;&amp; age[key]) print &#39;true &#39;</span>
<span class="s">    println &#39;&#39;</span>
<span class="s">}</span>
<span class="s">// =&gt;</span>
<span class="s">// Toddler: has key non-null true</span>
<span class="s">// Unborn: has key non-null</span>
<span class="s">// Phantasm: has key</span>
<span class="s">// Relic:</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_5.3</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">assert foodColor.size() == 5</span>
<span class="s">foodColor.remove(&#39;Banana&#39;)</span>
<span class="s">assert foodColor.size() == 4</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_5.4</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">hash = [:]</span>
<span class="s">hash.each { key, value -&gt;</span>
<span class="s">    // do something with key and value</span>
<span class="s">}</span>

<span class="s">hash.each { entry -&gt;</span>
<span class="s">    // do something with entry</span>
<span class="s">}</span>

<span class="s">hash.keySet().each { key -&gt;</span>
<span class="s">    // do something with key</span>
<span class="s">}</span>

<span class="s">sb = new StringBuffer()</span>
<span class="s">foodColor.each { food, color -&gt;</span>
<span class="s">    sb &lt;&lt; &quot;$food is $color\n&quot;</span>
<span class="s">}</span>
<span class="s">assert &#39;\n&#39; + sb.toString() == &#39;&#39;&#39;</span>
<span class="s">Lemon is green</span>
<span class="s">Carrot is orange</span>
<span class="s">Apple is red</span>
<span class="s">Raspberry is pink</span>
<span class="s">&#39;&#39;&#39;</span>

<span class="s">foodColor.each { entry -&gt;</span>
<span class="s">    assert entry.key.size() &gt; 4 &amp;&amp; entry.value.size() &gt; 2</span>
<span class="s">}</span>

<span class="s">foodColorsSortedByFood = []</span>
<span class="s">foodColor.keySet().sort().each { k -&gt; foodColorsSortedByFood &lt;&lt; foodColor[k] }</span>
<span class="s">assert foodColorsSortedByFood == [&quot;red&quot;, &quot;orange&quot;, &quot;green&quot;, &quot;pink&quot;]</span>

<span class="s">fakedInput = &#39;&#39;&#39;</span>
<span class="s">From: someone@somewhere.com</span>
<span class="s">From: someone@spam.com</span>
<span class="s">From: someone@somewhere.com</span>
<span class="s">&#39;&#39;&#39;</span>

<span class="s">from = [:]</span>
<span class="s">fakedInput.split(&#39;\n&#39;).each{</span>
<span class="s">    matcher = (it =~ /^From:\s+([^\s&gt;]*)/)</span>
<span class="s">    if (matcher.matches()) {</span>
<span class="s">        sender = matcher[0][1]</span>
<span class="s">        if (from.containsKey(sender)) from[sender] += 1</span>
<span class="s">        else from[sender] = 1</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">// More useful to sort by number of received mail by person</span>
<span class="s">from.entrySet().sort { a,b -&gt; b.value&lt;=&gt;a.value}.each { e-&gt;</span>
<span class="s">    println &quot;${e.key}: ${e.value}&quot;</span>
<span class="s">}</span>
<span class="s">// =&gt;</span>
<span class="s">// someone@somewhere.com: 2</span>
<span class="s">// someone@spam.com: 1</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_5.5</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">hash = [a:1, b:2, c:3]</span>
<span class="s">// Map#toString already produce a pretty decent output:</span>
<span class="s">println hash</span>
<span class="s">// =&gt; [&quot;b&quot;:2, &quot;a&quot;:1, &quot;c&quot;:3]</span>

<span class="s">// Or do it by longhand for customised formatting</span>
<span class="s">hash.each { k,v -&gt; println &quot;$k =&gt; $v&quot; }</span>
<span class="s">// =&gt;</span>
<span class="s">// b =&gt; 2</span>
<span class="s">// a =&gt; 1</span>
<span class="s">// c =&gt; 3</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_5.6</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// java.util.LinkedHashMap &quot;maintains a doubly-linked list running through all of its entries.</span>
<span class="s">// This linked list defines the iteration ordering, which is normally the order in which keys</span>
<span class="s">// were inserted into the map (insertion-order)&quot;.</span>
<span class="s">foodColor = new LinkedHashMap()</span>
<span class="s">foodColor[&#39;Banana&#39;] = &#39;Yellow&#39;</span>
<span class="s">foodColor[&#39;Apple&#39;] = &#39;Green&#39;</span>
<span class="s">foodColor[&#39;Lemon&#39;] = &#39;Yellow&#39;</span>

<span class="s">foodColor.keySet().each{ key -&gt; println key }</span>
<span class="s">// =&gt;</span>
<span class="s">// Banana</span>
<span class="s">// Apple</span>
<span class="s">// Lemon</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_5.7</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">foodsOfColor = [ Yellow:[&#39;Banana&#39;, &#39;Lemon&#39;], Green:[&#39;Apple&#39;] ]</span>
<span class="s">foodsOfColor[&#39;Green&#39;] += &#39;Melon&#39;</span>
<span class="s">assert foodsOfColor == [&quot;Green&quot;:[&quot;Apple&quot;, &quot;Melon&quot;], &quot;Yellow&quot;:[&quot;Banana&quot;, &quot;Lemon&quot;]]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_5.8</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">surname = [Mickey: &#39;Mantle&#39;, Babe: &#39;Ruth&#39;]</span>
<span class="s">assert surname.findAll{ it.value == &#39;Mantle&#39; }.collect{ it.key } == [&quot;Mickey&quot;]</span>

<span class="s">firstname = [:]</span>
<span class="s">surname.each{ entry -&gt; firstname[entry.value] = entry.key }</span>
<span class="s">assert firstname == [&quot;Ruth&quot;:&quot;Babe&quot;, &quot;Mantle&quot;:&quot;Mickey&quot;]</span>

<span class="s">// foodfindScript:</span>
<span class="s">#!/usr/bin/groovy</span>
<span class="s">// usage: foodfind food_or_color&quot;</span>
<span class="s">color = [Apple:&#39;red&#39;, Banana:&#39;yellow&#39;, Lemon:&#39;yellow&#39;, Carrot:&#39;orange&#39;]</span>
<span class="s">given = args[0]</span>
<span class="s">if (color.containsKey(given))</span>
<span class="s">    println &quot;$given is a food with color ${color[given]}.&quot;</span>
<span class="s">if (color.containsValue(given)) {</span>
<span class="s">    // could use commify() here - see 4.2</span>
<span class="s">    foods = color.findAll{it.value == given}.collect{it.key}</span>
<span class="s">    join = foods.size() == 1 ? &#39;is a food&#39; : &#39;are foods&#39;</span>
<span class="s">    println &quot;${foods.join(&#39;, &#39;)} $join with color ${given}.&quot;</span>
<span class="s">}</span>
<span class="s">// foodfind red</span>
<span class="s">// =&gt; Apple is a food with color red.</span>
<span class="s">// foodfind yellow</span>
<span class="s">// =&gt; Lemon, Banana are foods with color yellow.</span>
<span class="s">// foodfind Carrot</span>
<span class="s">// =&gt; Carrot is a food with color orange.</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_5.9</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">foodColor = [Apple:&#39;red&#39;, Carrot:&#39;orange&#39;, Banana:&#39;yellow&#39;, Cherry:&#39;black&#39;]</span>

<span class="s">// Sorted by keys</span>
<span class="s">assert foodColor.keySet().sort() == [&quot;Apple&quot;, &quot;Banana&quot;, &quot;Carrot&quot;, &quot;Cherry&quot;]</span>
<span class="s">// you could now iterate through the hash with the sorted keys</span>
<span class="s">assert foodColor.values().sort() == [&quot;black&quot;, &quot;orange&quot;, &quot;red&quot;, &quot;yellow&quot;]</span>
<span class="s">assert foodColor.values().sort{it.size()} == [&quot;red&quot;, &quot;black&quot;, &quot;orange&quot;, &quot;yellow&quot;]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_5.10</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">//merged = a.clone.update(b)        # because Hash#update changes object in place</span>

<span class="s">drinkColor = [Galliano:&#39;yellow&#39;, &#39;Mai Tai&#39;:&#39;blue&#39;]</span>
<span class="s">ingestedColor = [:]</span>
<span class="s">ingestedColor.putAll(drinkColor)</span>
<span class="s">// overrides any common keys</span>
<span class="s">ingestedColor.putAll(foodColor)</span>

<span class="s">totalColors = ingestedColor.values().sort().unique()</span>
<span class="s">assert totalColors == [&quot;black&quot;, &quot;blue&quot;, &quot;orange&quot;, &quot;red&quot;, &quot;yellow&quot;]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_5.11</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">foodColor[&#39;Lemon&#39;]=&#39;yellow&#39;</span>
<span class="s">citrusColor = [Lemon:&#39;yellow&#39;, Orange:&#39;orange&#39;, Lime:&#39;green&#39;]</span>
<span class="s">println foodColor</span>
<span class="s">println citrusColor</span>
<span class="s">common = foodColor.keySet().intersect(citrusColor.keySet())</span>
<span class="s">assert common == [&quot;Lemon&quot;]</span>

<span class="s">foodButNotCitrus = foodColor.keySet().toList() - citrusColor.keySet().toList()</span>
<span class="s">assert foodButNotCitrus == [&quot;Carrot&quot;, &quot;Apple&quot;, &quot;Banana&quot;, &quot;Cherry&quot;]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_5.12</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// no problem here, Groovy handles any kind of object for key-ing</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_5.13</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Groovy uses Java implementations for storing hashes and these</span>
<span class="s">// support setting an initial capacity and load factor (which determines</span>
<span class="s">// at what point the hash will be resized if needed)</span>
<span class="s">hash = [:]                              // Groovy shorthand gets defaults</span>
<span class="s">hash = new HashMap()                    // default capacity and load factor</span>
<span class="s">println hash.capacity()</span>
<span class="s">// =&gt; 16</span>
<span class="s">(&#39;A&#39;..&#39;Z&#39;).each{ hash[it] = it }</span>
<span class="s">println hash.capacity()</span>
<span class="s">// =&gt; 64</span>
<span class="s">hash = new HashMap(100)                 // initial capacity of 100 and default load factor</span>
<span class="s">hash = new HashMap(100, 0.8f)    // initial capacity of 100 and 0.8 load factor</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_5.14</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">count = [:]</span>
<span class="s">letters = []</span>
<span class="s">foodColor.values().each{ letters.addAll((it as String[]).toList()) }</span>
<span class="s">letters.each{ if (count.containsKey(it)) count[it] += 1 else count[it] = 1 }</span>
<span class="s">assert count == [&quot;o&quot;:3, &quot;d&quot;:1, &quot;k&quot;:1, &quot;w&quot;:2, &quot;r&quot;:2, &quot;c&quot;:1, &quot;l&quot;:5, &quot;g&quot;:1, &quot;b&quot;:1, &quot;a&quot;:2, &quot;y&quot;:2, &quot;n&quot;:1, &quot;e&quot;:4]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_5.15</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">father = [</span>
<span class="s">    Cain:&#39;Adam&#39;,</span>
<span class="s">    Abel:&#39;Adam&#39;,</span>
<span class="s">    Seth:&#39;Adam&#39;,</span>
<span class="s">    Enoch:&#39;Cain&#39;,</span>
<span class="s">    Irad:&#39;Enoch&#39;,</span>
<span class="s">    Mehujael:&#39;Irad&#39;,</span>
<span class="s">    Methusael:&#39;Mehujael&#39;,</span>
<span class="s">    Lamech:&#39;Methusael&#39;,</span>
<span class="s">    Jabal:&#39;Lamech&#39;,</span>
<span class="s">    Jubal:&#39;Lamech&#39;,</span>
<span class="s">    Tubalcain:&#39;Lamech&#39;,</span>
<span class="s">    Enos:&#39;Seth&#39;</span>
<span class="s">]</span>

<span class="s">def upline(person) {</span>
<span class="s">    while (father.containsKey(person)) {</span>
<span class="s">        print person + &#39; &#39;</span>
<span class="s">        person = father[person]</span>
<span class="s">    }</span>
<span class="s">    println person</span>
<span class="s">}</span>

<span class="s">upline(&#39;Irad&#39;)</span>
<span class="s">// =&gt; Irad Enoch Cain Adam</span>

<span class="s">children = [:]</span>
<span class="s">father.each { k,v -&gt;</span>
<span class="s">    if (!children.containsKey(v)) children[v] = []</span>
<span class="s">    children[v] += k</span>
<span class="s">}</span>
<span class="s">def downline(person) {</span>
<span class="s">    println &quot;$person begat ${children.containsKey(person)?children[person].join(&#39;, &#39;):&#39;Nobody&#39;}.\n&quot;</span>
<span class="s">}</span>
<span class="s">downline(&#39;Tubalcain&#39;)</span>
<span class="s">// =&gt; Tubalcain begat Nobody.</span>
<span class="s">downline(&#39;Adam&#39;)</span>
<span class="s">// =&gt; Adam begat Abel, Seth, Cain.</span>

<span class="s">// This one doesn&#39;t recurse through subdirectories (as a simplification)</span>
<span class="s">// scriptToFindIncludeFilesWhichContainNoIncludesScript:</span>
<span class="s">dir = &#39;&lt;path_to_usr/include&gt;&#39;</span>
<span class="s">includes = [:]</span>
<span class="s">new File(dir).eachFile{ file -&gt;</span>
<span class="s">    if (file.directory) return</span>
<span class="s">    file.eachLine{ line -&gt;</span>
<span class="s">        matcher = (line =~ &#39;^\\s*#\\s*include\\s*&lt;([^&gt;]+)&gt;&#39;)</span>
<span class="s">        if (matcher.matches()) {</span>
<span class="s">            if (!includes.containsKey(file.name)) includes[file.name] = []</span>
<span class="s">            includes[file.name] += matcher[0][1]</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">// find referenced files which have no includes; assumes all files</span>
<span class="s">// were processed and none are missing</span>
<span class="s">println includes.values().sort().flatten().unique() - includes.keySet()</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_5.16</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// dutree - print sorted indented rendition of du output</span>
<span class="s">// obtaining this input is not shown, it is similar to other examples</span>
<span class="s">// on some unix systems it will be: duProcessFakedInput = &quot;du options&quot;.process().text</span>
<span class="s">duProcessFakedInput = &#39;&#39;&#39;</span>
<span class="s">11732   groovysoap/lib</span>
<span class="s">68      groovysoap/src/main/groovy/net/soap</span>
<span class="s">71      groovysoap/src/main/groovy/net</span>
<span class="s">74      groovysoap/src/main/groovy</span>
<span class="s">77      groovysoap/src/main</span>
<span class="s">9       groovysoap/src/examples</span>
<span class="s">8       groovysoap/src/examples/groovy</span>
<span class="s">102     groovysoap/src/test</span>
<span class="s">202     groovysoap/src</span>
<span class="s">11966   groovysoap</span>
<span class="s">&#39;&#39;&#39;</span>

<span class="s">// The DuNode class collects all information about a directory,</span>
<span class="s">class DuNode {</span>
<span class="s">    def name</span>
<span class="s">    def size</span>
<span class="s">    def kids = []</span>

<span class="s">    // support for sorting nodes with side</span>
<span class="s">    def compareTo(node2) { size &lt;=&gt; node2.size }</span>

<span class="s">    def getBasename() {</span>
<span class="s">        name.replaceAll(/.*\//, &#39;&#39;)</span>
<span class="s">    }</span>

<span class="s">    // returns substring before last &quot;/&quot;, otherwise null</span>
<span class="s">    def getParent() {</span>
<span class="s">        def p = name.replaceAll(/\/[^\/]+$/,&#39;&#39;)</span>
<span class="s">        return (p == name) ? null : p</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">// The DuTree does the actual work of</span>
<span class="s">// getting the input, parsing it, building up a tree</span>
<span class="s">// and formatting it for output</span>
<span class="s">class DuTree {</span>
<span class="s">    def input</span>
<span class="s">    def topdir</span>
<span class="s">    def nodes = [:]</span>
<span class="s">    def dirsizes = [:]</span>
<span class="s">    def kids = [:]</span>

<span class="s">    // get a node by name, create it if it does not exist yet</span>
<span class="s">    def getOrCreateNode(name) {</span>
<span class="s">        if (!nodes.containsKey(name))</span>
<span class="s">            nodes[name] = new DuNode(name:name)</span>
<span class="s">        return nodes[name]</span>
<span class="s">    }</span>

<span class="s">    // figure out how much is taken in each directory</span>
<span class="s">    // that isn&#39;t stored in the subdirectories. Add a new</span>
<span class="s">    // fake kid called &quot;.&quot; containing that much.</span>
<span class="s">    def getDots(node) {</span>
<span class="s">        def cursize = node.size</span>
<span class="s">        for (kid in node.kids) {</span>
<span class="s">            cursize -=  kid.size</span>
<span class="s">            getDots(kid)</span>
<span class="s">        }</span>
<span class="s">        if (node.size != cursize) {</span>
<span class="s">            def newnode = getOrCreateNode(node.name + &quot;/.&quot;)</span>
<span class="s">            newnode.size = cursize</span>
<span class="s">            node.kids += newnode</span>
<span class="s">        }</span>
<span class="s">    }</span>

<span class="s">    def processInput() {</span>
<span class="s">        def name = &#39;&#39;</span>
<span class="s">        input.split(&#39;\n&#39;).findAll{it.trim()}.each{ line -&gt;</span>
<span class="s">            def tokens = line.tokenize()</span>
<span class="s">            def size = tokens[0]</span>
<span class="s">            name = tokens[1]</span>
<span class="s">            def node = getOrCreateNode(name)</span>
<span class="s">            node.size = size.toInteger()</span>
<span class="s">            nodes[name] = node</span>
<span class="s">            def parent = node.parent</span>
<span class="s">            if (parent)</span>
<span class="s">                getOrCreateNode(parent).kids &lt;&lt; node</span>
<span class="s">        }</span>
<span class="s">        topdir = nodes[name]</span>
<span class="s">    }</span>

<span class="s">    // recursively output everything</span>
<span class="s">    // passing padding and number width as well</span>
<span class="s">    // on recursive calls</span>
<span class="s">    def output(node, prefix=&#39;&#39;, width=0) {</span>
<span class="s">        def line = node.size.toString().padRight(width) + &#39; &#39; + node.basename</span>
<span class="s">        println (prefix + line)</span>
<span class="s">        prefix += line.replaceAll(/\d /, &#39;| &#39;)</span>
<span class="s">        prefix = prefix.replaceAll(/[^|]/, &#39; &#39;)</span>
<span class="s">        if (node.kids.size() &gt; 0) {    // not a bachelor node</span>
<span class="s">            kids = node.kids</span>
<span class="s">            kids.sort{ a,b -&gt; b.compareTo(a) }</span>
<span class="s">            width = kids[0].size.toString().size()</span>
<span class="s">            for (kid in kids) output(kid, prefix, width)</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">tree = new DuTree(input:duProcessFakedInput)</span>
<span class="s">tree.processInput()</span>
<span class="s">tree.getDots(tree.topdir)</span>
<span class="s">tree.output(tree.topdir)</span>
<span class="s">// =&gt;</span>
<span class="s">// 11966 groovysoap</span>
<span class="s">//     |           11732 lib</span>
<span class="s">//     |           202   src</span>
<span class="s">//     |             |      102 test</span>
<span class="s">//     |             |      77  main</span>
<span class="s">//     |             |       |      74 groovy</span>
<span class="s">//     |             |       |       |       71 net</span>
<span class="s">//     |             |       |       |        |    68 soap</span>
<span class="s">//     |             |       |       |        |    3  .</span>
<span class="s">//     |             |       |       |       3  .</span>
<span class="s">//     |             |       |      3  .</span>
<span class="s">//     |             |      14  .</span>
<span class="s">//     |             |      9   examples</span>
<span class="s">//     |             |      |           8 groovy</span>
<span class="s">//     |             |      |           1 .</span>
<span class="s">//     |           32    .</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_6.0</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Groovy has built-in language support for Regular Expressions:</span>
<span class="s">// *  Strings quoted with &#39;/&#39; characters have special escaping</span>
<span class="s">//    rules for backslashes and the like.</span>
<span class="s">// *  ~string (regex pattern operator)</span>
<span class="s">// *  m =~ /pattern/ (regex find operator)</span>
<span class="s">// *  m ==~/pattern/ (regex match operator)</span>
<span class="s">// *  patterns can be used in case expressions in a switch statement</span>
<span class="s">// *  string.replaceAll can take a closure expression as the second argument</span>
<span class="s">// In addition, Groovy can make use of Java&#39;s Pattern, Matcher and Scanner classes</span>
<span class="s">// directly. (The sugar coating metnioed above sits on top of these anyway).</span>
<span class="s">// There are also additional open source Java regex libraries which can be used.</span>

<span class="s">meadow1 = &#39;cow grass butterflies Ovine&#39;</span>
<span class="s">meadow2 = &#39;goat sheep flowers dog&#39;</span>
<span class="s">// pattern strings can benefit from &#39;slashy&#39; quotes</span>
<span class="s">partial = /sheep/</span>
<span class="s">full = /.*sheep.*/</span>

<span class="s">// find operator</span>
<span class="s">assert !(meadow1 =~ partial)</span>
<span class="s">assert meadow2 =~ partial</span>
<span class="s">finder = (meadow2 =~ partial)</span>
<span class="s">// underneath Groovy sugar coating is Java implementation</span>
<span class="s">assert finder instanceof java.util.regex.Matcher</span>

<span class="s">// match operator</span>
<span class="s">assert !(meadow1 ==~ full)</span>
<span class="s">assert meadow2 ==~ full</span>
<span class="s">matcher = (meadow2 ==~ full)</span>
<span class="s">// under the covers is just a boolean</span>
<span class="s">assert matcher instanceof Boolean</span>

<span class="s">assert meadow1 =~ /(?i)\bovines?\b/ // (?i) == case flag</span>

<span class="s">string = &#39;good food&#39;</span>
<span class="s">println string.replaceFirst(/o*/, &#39;e&#39;)</span>
<span class="s">// =&gt; egood food</span>
<span class="s">println string.replaceAll(/o*/, &#39;e&#39;)</span>
<span class="s">// =&gt; egeede efeede (global)</span>
<span class="s">// beware this one is just textual replacement</span>
<span class="s">println string.replace(/o*/, &#39;e&#39;)</span>
<span class="s">// =&gt; good food</span>
<span class="s">println &#39;o*o*&#39;.replace(/o*/, &#39;e&#39;)</span>
<span class="s">// =&gt; ee</span>

<span class="s">// groovy -e &quot;m = args[0] =~ /(a|ba|b)+(a|ac)+/; if (m.matches()) println m[0][0]&quot; ababacaca</span>
<span class="s">// =&gt; ababa</span>

<span class="s">digits = &quot;123456789&quot;</span>
<span class="s">nonlap = digits =~ /\d\d\d/</span>
<span class="s">assert nonlap.count == 3</span>
<span class="s">print &#39;Non-overlapping:  &#39;</span>
<span class="s">(0..&lt;nonlap.count).each{ print nonlap[it] + &#39; &#39; }; print &#39;\n&#39;</span>
<span class="s">print &#39;Overlapping:      &#39;</span>
<span class="s">yeslap = (digits =~ /(?=(\d\d\d))/)</span>
<span class="s">assert yeslap.count == 7</span>
<span class="s">(0..&lt;yeslap.count).each{ print yeslap[it][1] + &#39; &#39; }; print &#39;\n&#39;</span>
<span class="s">// Non-overlapping:  123 456 789</span>
<span class="s">// Overlapping:      123 234 345 456 567 678 789</span>

<span class="s">string = &#39;And little lambs eat ivy&#39;</span>
<span class="s">// Greedy version</span>
<span class="s">parts = string =~ /(.*)(l[^s]*s)(.*)/</span>
<span class="s">(1..parts.groupCount()).each{ print &quot;(${parts[0][it]}) &quot; }; print &#39;\n&#39;</span>
<span class="s">// (And little ) (lambs) ( eat ivy)</span>

<span class="s">// Reluctant version</span>
<span class="s">parts = string =~ /(.*?)(l[^s]*s)(.*)/</span>
<span class="s">(1..parts.groupCount()).each{ print &quot;(${parts[0][it]}) &quot; }; print &#39;\n&#39;</span>
<span class="s">// (And ) (little lambs) ( eat ivy)</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_6.1</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Groovy splits src and dest to avoid this problem</span>
<span class="s">src = &#39;Go this way&#39;</span>
<span class="s">dst = src.replaceFirst(&#39;this&#39;, &#39;that&#39;)</span>
<span class="s">assert dst == &#39;Go that way&#39;</span>

<span class="s">// extract basename</span>
<span class="s">src = &#39;c:/some/path/file.ext&#39;</span>
<span class="s">dst = src.replaceFirst(&#39;^.*/&#39;, &#39;&#39;)</span>
<span class="s">assert dst == &#39;file.ext&#39;</span>

<span class="s">// Make All Words Title-Cased (not that you would do it this way)</span>
<span class="s">//  The preprocessing operations \X where X is one of l, u, L, and U are not supported</span>
<span class="s">// in the sun regex library but other Java regex libraries may support this. Instead:</span>
<span class="s">src = &#39;make all words title-cased&#39;</span>
<span class="s">dst = src</span>
<span class="s">(&#39;a&#39;..&#39;z&#39;).each{ dst = dst.replaceAll(/([^a-zA-Z])/+it+/|\A/+it, /$</span><span class="mi">1</span><span class="s">/+it.toUpperCase()) }</span>
<span class="s">assert dst == &#39;Make All Words Title-Cased&#39;</span>

<span class="s">// rename list of dirs</span>
<span class="s">bindirs = &#39;/</span><span class="n">usr</span><span class="s">/bin /</span><span class="n">bin</span> <span class="s">/usr/</span><span class="n">local</span><span class="s">/bin&#39;.split(&#39; &#39;).toList()</span>
<span class="s">expected = &#39;/</span><span class="n">usr</span><span class="s">/lib /</span><span class="n">lib</span> <span class="s">/usr/</span><span class="n">local</span><span class="s">/lib&#39;.split(&#39; &#39;).toList()</span>
<span class="s">libdirs = bindirs.collect { dir -&gt; dir.replaceFirst(&#39;bin&#39;, &#39;lib&#39;) }</span>
<span class="s">assert libdirs == expected</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_6.2</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Groovy uses Java regex (other Java regex packages would also be possible)</span>
<span class="s">// It doesn&#39;t support Locale-based settings but you can roll your own to some</span>
<span class="s">// extent, you can use any Unicode characters as per below and you can use</span>
<span class="s">// \p{Punct}    Punctuation: One of !&quot;#$%&amp;&#39;()*+,-./</span><span class="o">:;&lt;=&gt;?</span><span class="err">@</span><span class="o">[</span><span class="err">\</span><span class="o">]^</span><span class="n">_</span><span class="err">`</span><span class="o">{|}~</span>
<span class="c1">// or the other special character classes</span>
<span class="n">words</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">silly</span>
<span class="s1">faade</span>
<span class="s1">coperate</span>
<span class="s1">nio</span>
<span class="s1">Rene</span>
<span class="s1">Molire</span>
<span class="s1">hmoglobin</span>
<span class="s1">nave</span>
<span class="s1">tsch</span>
<span class="s1">random!stuff#here\u0948</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">greekAlpha</span> <span class="o">=</span> <span class="s1">&#39;\u0391&#39;</span>
<span class="n">special</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span> <span class="o">+</span> <span class="n">greekAlpha</span>
<span class="c1">// flag as either Y (alphabetic) or N (not)</span>
<span class="n">words</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s1">&#39;\n&#39;</span><span class="o">).</span><span class="na">findAll</span><span class="o">{</span><span class="n">it</span><span class="o">.</span><span class="na">trim</span><span class="o">()}.</span><span class="na">each</span><span class="o">{</span> <span class="n">results</span> <span class="o">+=</span> <span class="n">it</span> <span class="o">==~</span> <span class="s">/^[\w/</span><span class="o">+</span><span class="n">special</span><span class="o">+</span><span class="s">/]+$/</span> <span class="o">?</span><span class="s1">&#39;Y&#39;</span><span class="o">:</span><span class="s1">&#39;N&#39;</span> <span class="o">}</span>
<span class="k">assert</span> <span class="n">results</span> <span class="o">==</span> <span class="s1">&#39;YYYYYYYYYN&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">words</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s1">&#39;\n&#39;</span><span class="o">).</span><span class="na">findAll</span><span class="o">{</span><span class="n">it</span><span class="o">.</span><span class="na">trim</span><span class="o">()}.</span><span class="na">each</span><span class="o">{</span> <span class="n">results</span> <span class="o">+=</span> <span class="n">it</span> <span class="o">==~</span> <span class="s">/^[^\p{Punct}]+$/</span> <span class="o">?</span><span class="s1">&#39;Y&#39;</span><span class="o">:</span><span class="s1">&#39;N&#39;</span> <span class="o">}</span>
<span class="k">assert</span> <span class="n">results</span> <span class="o">==</span> <span class="s1">&#39;YYYYYYYYYN&#39;</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_6.3</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// as many non-whitespace bytes as possible</span>
<span class="n">finder</span> <span class="o">=</span> <span class="s1">&#39;abczqz z&#39;</span> <span class="o">=~</span> <span class="s">/a\S+z/</span>
<span class="k">assert</span> <span class="n">finder</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;abczqz&#39;</span>

<span class="c1">// as many letters, apostrophes, and hyphens</span>
<span class="n">finder</span> <span class="o">=</span> <span class="s2">&quot;aAzZ&#39;z-z0z&quot;</span> <span class="o">=~</span> <span class="s">/a[A-Za-z&#39;-]+z/</span>          <span class="c1">//&#39;</span>
<span class="k">assert</span> <span class="n">finder</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">==</span> <span class="s2">&quot;aAzZ&#39;z-z&quot;</span>

<span class="c1">// selecting words</span>
<span class="n">finder</span> <span class="o">=</span> <span class="s1">&#39;23rd Psalm&#39;</span> <span class="o">=~</span> <span class="s">/\b([A-Za-z]+)\b/</span>   <span class="c1">// usually best</span>
<span class="n">println</span> <span class="n">finder</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">0</span><span class="o">]</span>
<span class="c1">// =&gt; Psalm (23rd is not matched)</span>
<span class="n">finder</span> <span class="o">=</span> <span class="s1">&#39;23rd Psalm&#39;</span> <span class="o">=~</span> <span class="s">/\s([A-Za-z]+)\s/</span>   <span class="c1">// fails at ends or w/ punctuation</span>
<span class="n">println</span> <span class="n">finder</span><span class="o">.</span><span class="na">matches</span><span class="o">()</span>
<span class="c1">// =&gt; false (no whitespaces at ends)</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_6.4</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">str</span> <span class="o">=</span> <span class="s1">&#39;groovy.codehaus.org and www.aboutgroovy.com&#39;</span>
<span class="n">re</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;(?x)          # to enable whitespace and comments</span>
<span class="s1">      (               # capture the hostname in $1</span>
<span class="s1">        (?:           # these parens for grouping only</span>
<span class="s1">          (?! [-_] )  # lookahead for neither underscore nor dash</span>
<span class="s1">          [\\w-] +    # hostname component</span>
<span class="s1">          \\.         # and the domain dot</span>
<span class="s1">        ) +           # now repeat that whole thing a bunch of times</span>
<span class="s1">        [A-Za-z]      # next must be a letter</span>
<span class="s1">        [\\w-] +      # now trailing domain part</span>
<span class="s1">      )               # end of $1 capture</span>
<span class="s1">     &#39;&#39;&#39;</span>

<span class="n">finder</span> <span class="o">=</span> <span class="n">str</span> <span class="o">=~</span> <span class="n">re</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">str</span>
<span class="o">(</span><span class="mi">0</span><span class="o">..&lt;</span><span class="n">finder</span><span class="o">.</span><span class="na">count</span><span class="o">).</span><span class="na">each</span><span class="o">{</span>
    <span class="n">adr</span> <span class="o">=</span> <span class="n">finder</span><span class="o">[</span><span class="n">it</span><span class="o">][</span><span class="mi">0</span><span class="o">]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="n">adr</span><span class="o">,</span> <span class="s2">&quot;$adr [${InetAddress.getByName(adr).hostAddress}]&quot;</span><span class="o">)</span>
<span class="o">}</span>
<span class="n">println</span> <span class="n">out</span>
<span class="c1">// =&gt; groovy.codehaus.org [63.246.7.187] and www.aboutgroovy.com [63.246.7.76]</span>

<span class="c1">// to match whitespace or #-characters in an extended re you need to escape them.</span>
<span class="n">foo</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">str</span> <span class="o">=</span> <span class="s1">&#39;blah #foo# blah&#39;</span>
<span class="n">re</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;(?x)         # to enable whitespace and comments</span>
<span class="s1">              \\#    # a pound sign</span>
<span class="s1">              (\\w+) # the variable name</span>
<span class="s1">              \\#    # another pound sign</span>
<span class="s1">     &#39;&#39;&#39;</span>
<span class="n">finder</span> <span class="o">=</span> <span class="n">str</span> <span class="o">=~</span> <span class="n">re</span>
<span class="n">found</span> <span class="o">=</span> <span class="n">finder</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">str</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="n">found</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">evaluate</span><span class="o">(</span><span class="n">found</span><span class="o">[</span><span class="mi">1</span><span class="o">]).</span><span class="na">toString</span><span class="o">())</span>
<span class="k">assert</span> <span class="n">out</span> <span class="o">==</span> <span class="s1">&#39;blah 42 blah&#39;</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_6.5</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">fish</span> <span class="o">=</span> <span class="s1">&#39;One fish two fish red fish blue fish&#39;</span>
<span class="n">expected</span> <span class="o">=</span> <span class="s1">&#39;The third fish is a red one.&#39;</span>
<span class="n">thirdFish</span> <span class="o">=</span> <span class="s">/(?:\w+\s+fish\s+){2}(\w+)\s+fish.*/</span>
<span class="k">assert</span> <span class="n">expected</span> <span class="o">==</span> <span class="o">(</span><span class="n">fish</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="n">thirdFish</span><span class="o">,</span> <span class="s1">&#39;The third fish is a $1 one.&#39;</span><span class="o">))</span>

<span class="n">anyFish</span> <span class="o">=</span> <span class="s">/(\w+)\s+fish\b/</span>
<span class="n">finder</span> <span class="o">=</span> <span class="n">fish</span> <span class="o">=~</span> <span class="n">anyFish</span>
<span class="c1">// finder contains an array of matched groups</span>
<span class="c1">// 2 = third one (index start at 0), 1 = matched word in group</span>
<span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;The third fish is a ${finder[2][1]} one.&quot;</span>
<span class="k">assert</span> <span class="n">out</span> <span class="o">==</span> <span class="n">expected</span>

<span class="n">evens</span> <span class="o">=</span> <span class="o">[]</span>
<span class="o">(</span><span class="mi">0</span><span class="o">..&lt;</span><span class="n">finder</span><span class="o">.</span><span class="na">count</span><span class="o">).</span><span class="na">findAll</span><span class="o">{</span><span class="n">it</span><span class="o">%</span><span class="mi">2</span><span class="o">!=</span><span class="mi">0</span><span class="o">}.</span><span class="na">each</span><span class="o">{</span> <span class="n">evens</span> <span class="o">+=</span> <span class="n">finder</span><span class="o">[</span><span class="n">it</span><span class="o">][</span><span class="mi">1</span><span class="o">]</span> <span class="o">}</span>
<span class="n">println</span> <span class="s2">&quot;Even numbered fish are ${evens.join(&#39; &#39;)}.&quot;</span>
<span class="c1">// =&gt; Even numbered fish are two blue.</span>

<span class="c1">// one of several ways to do this</span>
<span class="n">pond</span> <span class="o">=</span> <span class="n">fish</span> <span class="o">+</span> <span class="s1">&#39; in the pond&#39;</span>
<span class="n">fishInPond</span> <span class="o">=</span> <span class="o">(</span><span class="s">/(\w+)(\s+fish\b\s*)/</span><span class="o">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="s">/(.*)/</span>
<span class="n">found</span> <span class="o">=</span> <span class="o">(</span><span class="n">pond</span> <span class="o">=~</span> <span class="n">fishInPond</span><span class="o">)[</span><span class="mi">0</span><span class="o">]</span>
<span class="n">println</span> <span class="o">((</span><span class="n">found</span><span class="o">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">6</span><span class="o">]</span> <span class="o">+</span> <span class="s1">&#39;sushi&#39;</span> <span class="o">+</span> <span class="n">found</span><span class="o">[</span><span class="mi">8</span><span class="o">..</span><span class="mi">9</span><span class="o">]).</span><span class="na">join</span><span class="o">())</span>
<span class="c1">// =&gt; One fish two fish red fish sushi fish in the pond</span>

<span class="c1">// find last fish</span>
<span class="n">expected</span> <span class="o">=</span> <span class="s1">&#39;Last fish is blue&#39;</span>
<span class="n">pond</span> <span class="o">=</span> <span class="s1">&#39;One fish two fish red fish blue fish swim here.&#39;</span>
<span class="n">finder</span> <span class="o">=</span> <span class="o">(</span><span class="n">pond</span> <span class="o">=~</span> <span class="n">anyFish</span><span class="o">)</span>
<span class="k">assert</span> <span class="n">expected</span> <span class="o">==</span> <span class="s2">&quot;Last fish is ${finder[finder.count-1][1]}&quot;</span>
<span class="c1">// =&gt; Last fish is blue</span>

<span class="c1">// greedy match version of above</span>
<span class="n">finder</span> <span class="o">=</span> <span class="o">(</span><span class="n">pond</span> <span class="o">=~</span> <span class="s">/.*\b/</span> <span class="o">+</span> <span class="n">anyFish</span><span class="o">)</span>
<span class="k">assert</span> <span class="n">expected</span> <span class="o">==</span> <span class="s2">&quot;Last fish is ${finder[0][1]}&quot;</span>

<span class="c1">// last fish match version of above</span>
<span class="n">finder</span> <span class="o">=</span> <span class="o">(</span><span class="n">pond</span> <span class="o">=~</span> <span class="s">/\b(\w+)\s+fish\b(?!.*\bfish\b)/</span><span class="o">)</span>
<span class="k">assert</span> <span class="n">expected</span> <span class="o">==</span> <span class="s2">&quot;Last fish is ${finder[0][1]}&quot;</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_6.6</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Html Stripper</span>
<span class="c1">// get this using: fakedfile = new File(&#39;path_to_file.htm&#39;).text</span>
<span class="n">fakedFile</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;html&gt;</span>
<span class="s1">&lt;head&gt;&lt;title&gt;Chapter 1 Title&lt;/title&gt;&lt;/head&gt;</span>
<span class="s1">&lt;body&gt;</span>
<span class="s1">&lt;h1&gt;Chapter 1: Some Heading&lt;/h1&gt;</span>
<span class="s1">A paragraph.</span>
<span class="s1">&lt;/body&gt;</span>
<span class="s1">&lt;/html&gt;</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">stripExpectations</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Chapter 1 Title</span>

<span class="s1">Chapter 1: Some Heading</span>
<span class="s1">A paragraph.</span>
<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="na">trim</span><span class="o">()</span>

<span class="n">stripped</span> <span class="o">=</span> <span class="n">fakedFile</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">/(?m)&lt;.*?&gt;/</span><span class="o">,</span><span class="s1">&#39;&#39;</span><span class="o">).</span><span class="na">trim</span><span class="o">()</span>
<span class="k">assert</span> <span class="n">stripExpectations</span> <span class="o">==</span> <span class="n">stripped</span>

<span class="n">pattern</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;(?x)</span>
<span class="s1">      (                    # capture in $1</span>
<span class="s1">          Chapter          # text string</span>
<span class="s1">          \\s+             # mandatory whitespace</span>
<span class="s1">          \\d+             # decimal number</span>
<span class="s1">          \\s*             # optional whitespace</span>
<span class="s1">          :                # a real colon</span>
<span class="s1">          . *              # anything not a newline till end of line</span>
<span class="s1">      )</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">headerfyExpectations</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Chapter 1 Title</span>

<span class="s1">&lt;H1&gt;Chapter 1: Some Heading&lt;/H1&gt;</span>
<span class="s1">A paragraph.</span>
<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="na">trim</span><span class="o">()</span>

<span class="n">headerfied</span> <span class="o">=</span> <span class="n">stripped</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="n">pattern</span><span class="o">,</span> <span class="s1">&#39;&lt;H1&gt;$1&lt;/H1&gt;&#39;</span><span class="o">)</span>
<span class="k">assert</span> <span class="n">headerfyExpectations</span> <span class="o">==</span> <span class="n">headerfied</span>

<span class="c1">// one liner equivalent which prints to stdout</span>
<span class="c1">//% groovy -p -e &quot;line.replaceAll(/^(Chapter\s+\d+\s*:.*)/,&#39;&lt;H1&gt;$1&lt;/H1&gt;&#39;)&quot;</span>

<span class="c1">// one liner equivalent which modifies file in place and creates *.bak original file</span>
<span class="c1">//% groovy -pi .bak -e &quot;line.replaceAll(/^(Chapter\s+\d+\s*:.*)/,&#39;&lt;H1&gt;$1&lt;/H1&gt;&#39;)&quot;</span>

<span class="c1">// use: realFileInput = new File(path_to_file).text</span>
<span class="n">fakeFileInput</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">0</span>
<span class="s1">START</span>
<span class="s1">1</span>
<span class="s1">2</span>
<span class="s1">END</span>
<span class="s1">3</span>
<span class="s1">4</span>
<span class="s1">5</span>
<span class="s1">START</span>
<span class="s1">6</span>
<span class="s1">END</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">chunkyPattern</span> <span class="o">=</span> <span class="s">/(?ms)^START(.*?)^END/</span>
<span class="n">finder</span> <span class="o">=</span> <span class="n">fakeFileInput</span> <span class="o">=~</span> <span class="n">chunkyPattern</span>
<span class="o">(</span><span class="mi">0</span><span class="o">..&lt;</span><span class="n">finder</span><span class="o">.</span><span class="na">count</span><span class="o">).</span><span class="na">each</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s2">&quot;Chunk #$it contains ${new StringTokenizer(finder[it][1],&#39;\n&#39;).countTokens()} lines.&quot;</span>
<span class="o">}</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Chunk #0 contains 2 lines.</span>
<span class="c1">// Chunk #1 contains 1 lines.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_6.7</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// general pattern is:</span>
<span class="c1">//file = new File(&quot;datafile&quot;).text.split(/pattern/)</span>
<span class="c1">// .Ch, .Se and .Ss divide chunks of input text</span>
<span class="n">fakedFiletext</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">.Ch</span>
<span class="s1">abc</span>
<span class="s1">.Se</span>
<span class="s1">def</span>
<span class="s1">.Ss</span>
<span class="s1">ghi</span>
<span class="s1">.Se</span>
<span class="s1">jkl</span>
<span class="s1">.Se</span>
<span class="s1">mno</span>
<span class="s1">.Ss</span>
<span class="s1">pqr</span>
<span class="s1">.Ch</span>
<span class="s1">stu</span>
<span class="s1">.Ch</span>
<span class="s1">vwx</span>
<span class="s1">.Se</span>
<span class="s1">yz!</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">fakedFiletext</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">/(?m)^\.(Ch|Se|Ss)$/</span><span class="o">)</span>
<span class="n">println</span> <span class="s2">&quot;I read ${chunks.size()} chunks.&quot;</span>
<span class="c1">// =&gt; I read 10 chunks.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_6.8</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy doesn&#39;t support the ~/BEGIN/ .. ~/END/ notation</span>
<span class="c1">// you have to emulate it as shown in the example below</span>
<span class="c1">// The from line number to line number processing is supported</span>
<span class="c1">// from the command line but not within a script, e.g.</span>
<span class="c1">// command-line to print lines 15 through 17 inclusive (see below)</span>
<span class="c1">// &gt; groovy -p -e &quot;if (count in 15..17) return line&quot; datafile</span>
<span class="c1">// Within a script itself, you emulate the count by keeping state</span>

<span class="n">htmlContent</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;h1&gt;A Heading&lt;/h1&gt;</span>
<span class="s1">Here is &lt;XMP&gt;inline AAA&lt;/XMP&gt;.</span>
<span class="s1">And the bigger Example 2:</span>
<span class="s1">&lt;XMP&gt;</span>
<span class="s1">line BBB</span>
<span class="s1">line CCC</span>
<span class="s1">&lt;/XMP&gt;</span>
<span class="s1">Done.</span>
<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="na">trim</span><span class="o">()</span>

<span class="n">examplePattern</span> <span class="o">=</span> <span class="s">/(?ms)&lt;XMP&gt;(.*?)&lt;\/</span><span class="n">XMP</span><span class="o">&gt;</span><span class="s">/</span>
<span class="s">finder = htmlContent =~ examplePattern</span>
<span class="s">(0..&lt;finder.count).each {</span>
<span class="s">    println &quot;Example ${it+1}:&quot;</span>
<span class="s">    println finder[it][1]</span>
<span class="s">}</span>
<span class="s">// =&gt;</span>
<span class="s">// Example 1:</span>
<span class="s">// inline AAA</span>
<span class="s">// Example 2:</span>
<span class="s">//</span>
<span class="s">// line BBB</span>
<span class="s">// line CCC</span>
<span class="s">//</span>

<span class="s">htmlContent.split(&#39;\n&#39;).eachWithIndex{ line, count -&gt;</span>
<span class="s">    if (count in 4..5) println line</span>
<span class="s">}</span>
<span class="s">// =&gt;</span>
<span class="s">// line BBB</span>
<span class="s">// line CCC</span>

<span class="s">// You would probably use a mail Api for this in Groovy</span>
<span class="s">fakedMailInput = &#39;&#39;&#39;</span>
<span class="s">From: A Person &lt;someone@somewhere.com&gt;</span>
<span class="s">To: &lt;pleac-discuss@lists.sourceforge.net&gt;</span>
<span class="s">Date: Sun, 31 Dec 2006 02:14:57 +1100</span>

<span class="s">From: noone@nowhere.com</span>
<span class="s">To: &lt;pleac-discuss@lists.sourceforge.net&gt;</span>
<span class="s">Date: Sun, 31 Dec 2006 02:14:58 +1100</span>

<span class="s">From: someone@somewhere.com</span>
<span class="s">To: &lt;pleac-discuss@lists.sourceforge.net&gt;</span>
<span class="s">Date: Sun, 31 Dec 2006 02:14:59 +1100</span>
<span class="s">&#39;&#39;&#39;.trim()+&#39;\n&#39;</span>

<span class="s">seen = [:]</span>
<span class="s">fakedMailInput.split(&#39;\n&#39;).each{ line -&gt;</span>
<span class="s">    m = (line =~ /</span><span class="o">^</span><span class="nl">From:</span><span class="o">?</span><span class="err">\</span><span class="n">s</span><span class="o">(.*)</span><span class="s">/)</span>
<span class="s">    if (m) {</span>
<span class="s">        addr = m[0][1] =~ /</span><span class="o">([^&lt;&gt;(),;</span><span class="err">\</span><span class="n">s</span><span class="o">]+</span><span class="err">\@</span><span class="o">[^&lt;&gt;(),;</span><span class="err">\</span><span class="n">s</span><span class="o">]+)</span><span class="s">/</span>
<span class="s">        x = addr[0][1]</span>
<span class="s">        if (seen.containsKey(x)) seen[x] += 1 else seen[x] = 1</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">seen.each{ k,v -&gt; println &quot;Address $k seen $v time${v==1?&#39;&#39;:&#39;s&#39;}.&quot; }</span>
<span class="s">// =&gt;</span>
<span class="s">// Address noone@nowhere.com seen 1 time.</span>
<span class="s">// Address someone@somewhere.com seen 2 times.</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_6.9</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">import java.util.regex.Pattern</span>

<span class="s">names = &#39;&#39;&#39;</span>
<span class="s">myFile.txt</span>
<span class="s">oldFile.tex</span>
<span class="s">myPicture.jpg</span>
<span class="s">&#39;&#39;&#39;</span>

<span class="s">def glob2pat(globstr) {</span>
<span class="s">    def patmap = [ &#39;*&#39;:&#39;.*&#39;, &#39;?&#39;:&#39;.&#39;, &#39;[&#39;:&#39;[&#39;, &#39;]&#39;:&#39;]&#39; ]</span>
<span class="s">    def result = &#39;(?m)^&#39;</span>
<span class="s">    &#39;^&#39; + globstr.replaceAll(/</span><span class="o">(.)</span><span class="s">/) { all, c -&gt;</span>
<span class="s">        result += (patmap.containsKey(c) ? patmap[c] : Pattern.quote(c))</span>
<span class="s">    }</span>
<span class="s">     result + &#39;$&#39;</span>
<span class="s">}</span>

<span class="s">def checkNumMatches(pat, count) {</span>
<span class="s">    assert (names =~ glob2pat(pat)).count == count</span>
<span class="s">}</span>

<span class="s">checkNumMatches(&#39;*.*&#39;, 3)</span>
<span class="s">checkNumMatches(&#39;my*.*&#39;, 2)</span>
<span class="s">checkNumMatches(&#39;*.t*&#39;, 2)</span>
<span class="s">checkNumMatches(&#39;*File.*&#39;, 2)</span>
<span class="s">checkNumMatches(&#39;*Rabbit*.*&#39;, 0)</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_6.10</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// version 1: simple obvious way</span>
<span class="s">states = &#39;CO ON MI WI MN&#39;.split(&#39; &#39;).toList()</span>

<span class="s">def popgrep1(file) {</span>
<span class="s">    file.eachLine{ line -&gt;</span>
<span class="s">        if (states.any{ line =~ /</span><span class="err">\</span><span class="n">b$it</span><span class="err">\</span><span class="n">b</span><span class="s">/ }) println line</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">// popgrep1(new File(&#39;path_to_file&#39;))</span>

<span class="s">// version 2: eval strings; fast but hard to quote (SLOW)</span>
<span class="s">def popgrep2(file) {</span>
<span class="s">    def code = &#39;def found = false\n&#39;</span>
<span class="s">    states.each{</span>
<span class="s">        code += &quot;if (!found &amp;&amp; line =~ /</span><span class="err">\\</span><span class="n">b$it</span><span class="err">\\</span><span class="n">b</span><span class="s">/) found = true\n&quot;</span>
<span class="s">    }</span>
<span class="s">    code += &quot;if (found) println line\n&quot;</span>
<span class="s">    file.eachLine{ line = it; evaluate(code) }</span>
<span class="s">}</span>
<span class="s">// popgrep2(new File(&#39;path_to_file&#39;))</span>

<span class="s">// version 2b: eval using switch/</span><span class="k">case</span> <span class="o">(</span><span class="n">not</span> <span class="k">in</span> <span class="n">Perl</span> <span class="n">cookbook</span><span class="o">)</span> <span class="o">(</span><span class="n">SLOW</span><span class="o">)</span>
<span class="kt">def</span> <span class="nf">popgrep2b</span><span class="o">(</span><span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;switch(line) {\n&#39;</span>
    <span class="n">states</span><span class="o">.</span><span class="na">each</span><span class="o">{</span>
        <span class="n">code</span> <span class="o">+=</span> <span class="s2">&quot;case ~/.*\\b$it\\b.*/:\nprintln line;break\n&quot;</span>
    <span class="o">}</span>
    <span class="n">code</span> <span class="o">+=</span> <span class="s2">&quot;default:break\n}\n&quot;</span>
    <span class="n">file</span><span class="o">.</span><span class="na">eachLine</span><span class="o">{</span> <span class="n">line</span> <span class="o">=</span> <span class="n">it</span><span class="o">;</span> <span class="n">evaluate</span><span class="o">(</span><span class="n">code</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// popgrep2b(new File(&#39;path_to_file&#39;))</span>

<span class="c1">// version3: build a match_any function as a GString</span>
<span class="kt">def</span> <span class="nf">popgrep3</span><span class="o">(</span><span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">code</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="na">collect</span><span class="o">{</span> <span class="s2">&quot;line =~ /\\b$it\\b/&quot;</span> <span class="o">}.</span><span class="na">join</span><span class="o">(</span><span class="s1">&#39;||&#39;</span><span class="o">)</span>
    <span class="n">file</span><span class="o">.</span><span class="na">eachLine</span><span class="o">{</span> <span class="n">line</span> <span class="o">=</span> <span class="n">it</span><span class="o">;</span> <span class="k">if</span> <span class="o">(</span><span class="n">evaluate</span><span class="o">(</span><span class="n">code</span><span class="o">))</span> <span class="n">println</span> <span class="n">line</span> <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// popgrep3(new File(&#39;path_to_file&#39;))</span>

<span class="c1">// version4: pretty fast, but simple: compile all re&#39;s first:</span>
<span class="n">patterns</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="na">collect</span><span class="o">{</span> <span class="o">~</span><span class="s">/\b$it\b/</span> <span class="o">}</span>
<span class="kt">def</span> <span class="nf">popgrep4</span><span class="o">(</span><span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">file</span><span class="o">.</span><span class="na">eachLine</span><span class="o">{</span> <span class="n">line</span> <span class="o">-&gt;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">patterns</span><span class="o">.</span><span class="na">any</span><span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">line</span><span class="o">)})</span> <span class="n">println</span> <span class="n">line</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// popgrep4(new File(&#39;path_to_file&#39;))</span>

<span class="c1">// version5: faster</span>
<span class="n">str</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="na">collect</span><span class="o">{</span> <span class="s">/\b$it\b/</span> <span class="o">}.</span><span class="na">join</span><span class="o">(</span><span class="s1">&#39;|&#39;</span><span class="o">)</span>
<span class="kt">def</span> <span class="nf">popgrep5</span><span class="o">(</span><span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">file</span><span class="o">.</span><span class="na">eachLine</span><span class="o">{</span> <span class="n">line</span> <span class="o">-&gt;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">line</span> <span class="o">=~</span> <span class="n">str</span><span class="o">)</span> <span class="n">println</span> <span class="n">line</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// popgrep5(new File(&#39;path_to_file&#39;))</span>

<span class="c1">// version5b: faster (like 5 but compiled outside loop)</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="o">~</span><span class="n">states</span><span class="o">.</span><span class="na">collect</span><span class="o">{</span> <span class="s">/\b$it\b/</span> <span class="o">}.</span><span class="na">join</span><span class="o">(</span><span class="s1">&#39;|&#39;</span><span class="o">)</span>
<span class="kt">def</span> <span class="nf">popgrep5b</span><span class="o">(</span><span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">file</span><span class="o">.</span><span class="na">eachLine</span><span class="o">{</span> <span class="n">line</span> <span class="o">-&gt;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">pattern</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">line</span><span class="o">))</span> <span class="n">println</span> <span class="n">line</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// popgrep5b(new File(&#39;path_to_file&#39;))</span>

<span class="c1">// speeds trials ON the current source file (~1200 lines)</span>
<span class="c1">// popgrep1   =&gt;  0.39s</span>
<span class="c1">// popgrep2   =&gt; 25.08s</span>
<span class="c1">// popgrep2b  =&gt; 23.86s</span>
<span class="c1">// popgrep3   =&gt; 22.42s</span>
<span class="c1">// popgrep4   =&gt;  0.12s</span>
<span class="c1">// popgrep5   =&gt;  0.05s</span>
<span class="c1">// popgrep5b  =&gt;  0.05s</span>
<span class="c1">// Groovy&#39;s built-in support is the way to go in terms of</span>
<span class="c1">// both speed and simplicity of understanding. Avoid using</span>
<span class="c1">// evaluate() unless you absolutely need it</span>

<span class="c1">// generic matching functions</span>
<span class="n">input</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">both cat and dog</span>
<span class="s1">neither</span>
<span class="s1">just a cat</span>
<span class="s1">just a dog</span>
<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s1">&#39;\n&#39;</span><span class="o">).</span><span class="na">findAll</span><span class="o">{</span><span class="n">it</span><span class="o">.</span><span class="na">trim</span><span class="o">()}</span>

<span class="kt">def</span> <span class="nf">matchAny</span><span class="o">(</span><span class="n">line</span><span class="o">,</span> <span class="n">patterns</span><span class="o">)</span> <span class="o">{</span> <span class="n">patterns</span><span class="o">.</span><span class="na">any</span><span class="o">{</span> <span class="n">line</span> <span class="o">=~</span> <span class="n">it</span> <span class="o">}</span> <span class="o">}</span>
<span class="kt">def</span> <span class="nf">matchAll</span><span class="o">(</span><span class="n">line</span><span class="o">,</span> <span class="n">patterns</span><span class="o">)</span> <span class="o">{</span> <span class="n">patterns</span><span class="o">.</span><span class="na">every</span><span class="o">{</span> <span class="n">line</span> <span class="o">=~</span> <span class="n">it</span> <span class="o">}</span> <span class="o">}</span>

<span class="k">assert</span> <span class="n">input</span><span class="o">.</span><span class="na">findAll</span><span class="o">{</span> <span class="n">matchAny</span><span class="o">(</span><span class="n">it</span><span class="o">,</span> <span class="o">[</span><span class="s1">&#39;cat&#39;</span><span class="o">,</span><span class="s1">&#39;dog&#39;</span><span class="o">])</span> <span class="o">}.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">3</span>
<span class="k">assert</span> <span class="n">input</span><span class="o">.</span><span class="na">findAll</span><span class="o">{</span> <span class="n">matchAny</span><span class="o">(</span><span class="n">it</span><span class="o">,</span> <span class="o">[</span><span class="s1">&#39;cat$&#39;</span><span class="o">,</span><span class="s1">&#39;^n.*&#39;</span><span class="o">])</span> <span class="o">}.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">2</span>
<span class="k">assert</span> <span class="n">input</span><span class="o">.</span><span class="na">findAll</span><span class="o">{</span> <span class="n">matchAll</span><span class="o">(</span><span class="n">it</span><span class="o">,</span> <span class="o">[</span><span class="s1">&#39;cat&#39;</span><span class="o">,</span><span class="s1">&#39;dog&#39;</span><span class="o">])</span> <span class="o">}.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="n">input</span><span class="o">.</span><span class="na">findAll</span><span class="o">{</span> <span class="n">matchAll</span><span class="o">(</span><span class="n">it</span><span class="o">,</span> <span class="o">[</span><span class="s1">&#39;cat$&#39;</span><span class="o">,</span><span class="s1">&#39;^n.*&#39;</span><span class="o">])</span> <span class="o">}.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_6.11</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// patternCheckingScript:</span>
<span class="n">prompt</span> <span class="o">=</span> <span class="s1">&#39;\n&gt; &#39;</span>
<span class="n">print</span> <span class="s1">&#39;Enter patterns to check:&#39;</span> <span class="o">+</span> <span class="n">prompt</span>
<span class="k">new</span> <span class="nf">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">)).</span><span class="na">eachLine</span><span class="o">{</span> <span class="n">line</span> <span class="o">-&gt;</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="n">line</span><span class="o">)</span>
        <span class="n">print</span> <span class="s1">&#39;Valid&#39;</span> <span class="o">+</span> <span class="n">prompt</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">regex</span><span class="o">.</span><span class="na">PatternSyntaxException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">print</span> <span class="s1">&#39;Invalid pattern: &#39;</span> <span class="o">+</span> <span class="n">ex</span><span class="o">.</span><span class="na">message</span> <span class="o">+</span> <span class="n">prompt</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Enter patterns to check:</span>
<span class="c1">// &gt; ab*.c</span>
<span class="c1">// Valid</span>
<span class="c1">// &gt; ^\s+[^a-z]*$</span>
<span class="c1">// Valid</span>
<span class="c1">// &gt; **</span>
<span class="c1">// Invalid pattern: Dangling meta character &#39;*&#39; near index 0</span>
<span class="c1">// **</span>
<span class="c1">// ^</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_6.12</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">src</span> <span class="o">=</span> <span class="s1">&#39;dierk knig&#39;</span>
<span class="c1">// simplistic with locale issue</span>
<span class="n">dst</span> <span class="o">=</span> <span class="n">src</span>
<span class="o">(</span><span class="s1">&#39;a&#39;</span><span class="o">..</span><span class="s1">&#39;z&#39;</span><span class="o">).</span><span class="na">each</span><span class="o">{</span> <span class="n">dst</span> <span class="o">=</span> <span class="n">dst</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">/(?&lt;=[^a-zA-Z])/</span><span class="o">+</span><span class="n">it</span><span class="o">+</span><span class="s">/|\A/</span><span class="o">+</span><span class="n">it</span><span class="o">,</span> <span class="n">it</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">())</span> <span class="o">}</span>
<span class="n">println</span> <span class="n">dst</span>
<span class="c1">// =&gt; Dierk KNig</span>
<span class="c1">// locale avoidance</span>
<span class="n">dst</span> <span class="o">=</span> <span class="n">src</span>
<span class="o">(</span><span class="s1">&#39;a&#39;</span><span class="o">..</span><span class="s1">&#39;z&#39;</span><span class="o">).</span><span class="na">each</span><span class="o">{</span> <span class="n">dst</span> <span class="o">=</span> <span class="n">dst</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">/(?&lt;=\A|\b)/</span><span class="o">+</span><span class="n">it</span><span class="o">,</span> <span class="n">it</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">())</span> <span class="o">}</span>
<span class="n">println</span> <span class="n">dst</span>
<span class="c1">// =&gt; Dierk Knig</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_6.13</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Several libraries exist, e.g.</span>
<span class="c1">// http://secondstring.sourceforge.net/</span>
<span class="c1">// http://sourceforge.net/projects/simmetrics/</span>
<span class="c1">// both support numerous algorithms. Using the second as an example:</span>
<span class="kn">import</span> <span class="nn">uk.ac.shef.wit.simmetrics.similaritymetrics.*</span>
<span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;balast&#39;</span>
<span class="n">candidates</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">quick</span>
<span class="s1">brown</span>
<span class="s1">fox</span>
<span class="s1">jumped</span>
<span class="s1">over</span>
<span class="s1">the</span>
<span class="s1">lazy</span>
<span class="s1">dog</span>
<span class="s1">ballast</span>
<span class="s1">ballasts</span>
<span class="s1">balustrade</span>
<span class="s1">balustrades</span>
<span class="s1">blast</span>
<span class="s1">blasted</span>
<span class="s1">blaster</span>
<span class="s1">blasters</span>
<span class="s1">blasting</span>
<span class="s1">blasts</span>
<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s1">&#39;\n&#39;</span><span class="o">).</span><span class="na">findAll</span><span class="o">{</span><span class="n">it</span><span class="o">.</span><span class="na">trim</span><span class="o">()}</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="o">[</span><span class="k">new</span> <span class="n">Levenshtein</span><span class="o">(),</span> <span class="k">new</span> <span class="n">MongeElkan</span><span class="o">(),</span> <span class="k">new</span> <span class="n">JaroWinkler</span><span class="o">(),</span> <span class="k">new</span> <span class="n">Soundex</span><span class="o">()]</span>
<span class="kt">def</span> <span class="nf">out</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">results</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">print</span> <span class="n">name</span><span class="o">.</span><span class="na">padLeft</span><span class="o">(</span><span class="mi">14</span><span class="o">)</span> <span class="o">+</span> <span class="s1">&#39;  &#39;</span><span class="o">;</span> <span class="n">results</span><span class="o">.</span><span class="na">each</span><span class="o">{</span><span class="n">print</span><span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">padRight</span><span class="o">(</span><span class="mi">16</span><span class="o">))};</span> <span class="n">println</span><span class="o">()</span>
<span class="o">}</span>
<span class="kt">def</span> <span class="nf">outr</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">results</span><span class="o">){</span><span class="n">out</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">results</span><span class="o">.</span><span class="na">collect</span><span class="o">{</span><span class="s1">&#39;&#39;</span><span class="o">+((</span><span class="kt">int</span><span class="o">)(</span><span class="n">it</span><span class="o">*</span><span class="mi">100</span><span class="o">))</span><span class="s">/100})}</span>
<span class="s">out (&#39;Word/</span><span class="n">Metric</span><span class="s1">&#39;, metrics.collect{it.shortDescriptionString} )</span>
<span class="s1">candidates.each{ w -&gt; outr(w, metrics.collect{ m -&gt; m.getSimilarity(target, w)} )}</span>
<span class="s1">// =&gt;</span>
<span class="s1">//   Word/Metric  Levenshtein     MongeElkan      JaroWinkler     Soundex</span>
<span class="s1">//         quick  0               0.11            0               0.66</span>
<span class="s1">//         brown  0.16            0.23            0.5             0.73</span>
<span class="s1">//           fox  0               0.2             0               0.66</span>
<span class="s1">//        jumped  0               0.2             0               0.66</span>
<span class="s1">//          over  0               0.44            0               0.55</span>
<span class="s1">//           the  0               0.33            0               0.55</span>
<span class="s1">//          lazy  0.33            0.5             0.44            0.66</span>
<span class="s1">//           dog  0               0.2             0               0.66</span>
<span class="s1">//       ballast  0.85            0.83            0.96            1</span>
<span class="s1">//      ballasts  0.75            0.83            0.94            0.94</span>
<span class="s1">//    balustrade  0.5             0.93            0.3             0.94</span>
<span class="s1">//   balustrades  0.45            0.93            0.3             0.94</span>
<span class="s1">//         blast  0.83            0.8             0.88            1</span>
<span class="s1">//       blasted  0.57            0.66            0.8             0.94</span>
<span class="s1">//       blaster  0.57            0.66            0.8             0.94</span>
<span class="s1">//      blasters  0.5             0.66            0.77            0.94</span>
<span class="s1">//      blasting  0.5             0.66            0.77            0.94</span>
<span class="s1">//        blasts  0.66            0.66            0.84            0.94</span>
<span class="s1">// to implement the example, iterate through /usr/dict/words selecting words</span>
<span class="s1">// where one or a combination of metrics are greater than some threshold</span>
<span class="s1">//----------------------------------------------------------------------------------</span>

<span class="s1">// @@PLEAC@@_6.14</span>
<span class="s1">//----------------------------------------------------------------------------------</span>
<span class="s1">n = &quot;   49 here&quot;</span>
<span class="s1">println n.replaceAll(/\G /,&#39;</span><span class="mi">0</span><span class="s1">&#39;)</span>
<span class="s1">// =&gt; 00049 here</span>

<span class="s1">str = &quot;3,4,5,9,120&quot;</span>
<span class="s1">print &#39;</span><span class="n">Found</span> <span class="nl">numbers:</span><span class="s1">&#39;</span>
<span class="s1">str.eachMatch(/\G,?(\d+)/){ print &#39;</span> <span class="s1">&#39; + it[1] }</span>
<span class="s1">println()</span>
<span class="s1">// =&gt; Found numbers: 3 4 5 9 120</span>

<span class="s1">// Groovy doesn&#39;</span><span class="n">t</span> <span class="n">have</span> <span class="n">the</span> <span class="n">String</span><span class="o">.</span><span class="na">pos</span> <span class="n">or</span> <span class="n">a</span> <span class="s">/c re modifier like Perl</span>
<span class="s">// But it does have similar functionality. Matcher has start() and</span>
<span class="s">// end() for find the position and Matcher&#39;s usePattern() allows</span>
<span class="s">// you to swap patterns without changing the buffer position</span>
<span class="s">text = &#39;the year 1752 lost 10 days on the 3rd of September&#39;</span>
<span class="s">p = ~/</span><span class="o">(?&lt;=</span><span class="err">\</span><span class="n">D</span><span class="o">)(</span><span class="err">\</span><span class="n">d</span><span class="o">+)</span><span class="s">/</span>
<span class="s">m = p.matcher(text)</span>
<span class="s">while (m.find()) {</span>
<span class="s">    println &#39;Found &#39; + m.group() + &#39; starting at pos &#39; + m.start() +</span>
<span class="s">            &#39; and ending at pos &#39; + m.end()</span>
<span class="s">}</span>
<span class="s">// now reset pos back to between 1st and 2nd numbers</span>
<span class="s">if (m.find(16)) { println &#39;Found &#39; + m.group() }</span>
<span class="s">// =&gt;</span>
<span class="s">// Found 1752 starting at pos 9 and ending at pos 13</span>
<span class="s">// Found 10 starting at pos 19 and ending at pos 21</span>
<span class="s">// Found 3 starting at pos 34 and ending at pos 35</span>
<span class="s">// Found 10</span>

<span class="s">// Alternatively you can use Scanner in Java 5-7+:</span>
<span class="s">p1 = ~/</span><span class="o">(?&lt;=</span><span class="err">\</span><span class="n">D</span><span class="o">)(</span><span class="err">\</span><span class="n">d</span><span class="o">+)</span><span class="s">/</span>
<span class="s">p2 = ~/</span><span class="err">\</span><span class="n">S</span><span class="o">+</span><span class="s">/</span>
<span class="s">s = new Scanner(text)</span>
<span class="s">while ((f = s.findInLine(p1))) { println &#39;Found: &#39; + f }</span>
<span class="s">if ((f = s.findInLine(p2))) { println &quot;Found $f after the last number.&quot; }</span>
<span class="s">// =&gt;</span>
<span class="s">// Found: 1752</span>
<span class="s">// Found: 10</span>
<span class="s">// Found: 3</span>
<span class="s">// Found rd after the last number.</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_6.15</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">html = &#39;&lt;b&gt;&lt;i&gt;this&lt;/</span><span class="n">i</span><span class="o">&gt;</span> <span class="n">and</span> <span class="o">&lt;</span><span class="n">i</span><span class="o">&gt;</span><span class="n">that</span><span class="o">&lt;</span><span class="s">/i&gt; are important&lt;/</span><span class="n">b</span><span class="o">&gt;</span> <span class="n">Oh</span><span class="o">,</span> <span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;&lt;</span><span class="n">i</span><span class="o">&gt;</span><span class="n">me</span> <span class="n">too</span><span class="o">!&lt;</span><span class="s">/i&gt;&lt;/</span><span class="n">b</span><span class="o">&gt;</span><span class="s1">&#39;</span>

<span class="s1">greedyHtmlStripPattern = ~/(?m)&lt;.*&gt;/       // not good</span>
<span class="s1">nonGreedyHtmlStripPattern = ~/(?m)&lt;.*?&gt;/   // not great</span>
<span class="s1">simpleNested = ~/(?mx)&lt;b&gt;&lt;i&gt;(.*?)&lt;\/i&gt;&lt;\/b&gt;/</span>
<span class="s1">// match BEGIN, then not BEGIN, then END</span>
<span class="s1">generalPattern = ~/BEGIN((?:(?!BEGIN).)*)END/</span>
<span class="s1">betterButInefficient1 = ~/(?mx)&lt;b&gt;&lt;i&gt;(  (?: (?!&lt;\/b&gt;|&lt;\/i&gt;). )*  ) &lt;\/i&gt;&lt;\/b&gt;/</span>
<span class="s1">betterButInefficient2 = ~/(?mx)&lt;b&gt;&lt;i&gt;(  (?: (?!&lt;\/[ib]&gt;). )*  ) &lt;\/i&gt;&lt;\/b&gt;/</span>

<span class="s1">efficientPattern = &#39;&#39;&#39;</span><span class="o">(?</span><span class="n">mx</span><span class="o">)</span>
    <span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;&lt;</span><span class="n">i</span><span class="o">&gt;</span>
    <span class="o">[^&lt;]*</span>  <span class="err">#</span> <span class="n">stuff</span> <span class="n">not</span> <span class="n">possibly</span> <span class="n">bad</span><span class="o">,</span> <span class="n">and</span> <span class="n">not</span> <span class="n">possibly</span> <span class="n">the</span> <span class="n">end</span><span class="o">.</span>
    <span class="o">(?:</span>
 <span class="err">#</span> <span class="n">at</span> <span class="k">this</span> <span class="n">point</span><span class="o">,</span> <span class="n">we</span> <span class="n">can</span> <span class="n">have</span> <span class="s1">&#39;&lt;&#39;</span> <span class="k">if</span> <span class="n">not</span> <span class="n">part</span> <span class="n">of</span> <span class="n">something</span> <span class="n">bad</span>
     <span class="o">(?!</span>  <span class="o">&lt;</span><span class="s">/?[ib]&gt;  )   # what we can&#39;t have</span>
<span class="s">     &lt;                  # okay, so match the &#39;&lt;&#39;</span>
<span class="s">     [^&lt;]*              # and continue with more safe stuff</span>
<span class="s">    ) *</span>
<span class="s">    &lt;/</span><span class="n">i</span><span class="o">&gt;&lt;</span><span class="s">/b&gt;</span>
<span class="s">&#39;&#39;&#39;                   //&#39;</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_6.16</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">input = &#39;This is a test\nTest of the duplicate word finder.\n&#39;</span>
<span class="s">dupWordPattern = &#39;&#39;&#39;(?ix)</span>
<span class="s">       \\b    # start at word boundary</span>
<span class="s">      (\\S+)  # find chunk of non-whitespace</span>
<span class="s">       \\b    # until a word boundary</span>
<span class="s">      (</span>
<span class="s">       \\s+   # followed by whitespace</span>
<span class="s">       \\1    # and that same chunk again</span>
<span class="s">       \\b    # and a word boundary</span>
<span class="s">      ) +     # one or more times</span>
<span class="s">&#39;&#39;&#39;</span>
<span class="s">finder = input =~ dupWordPattern</span>
<span class="s">println &#39;Found duplicate word: &#39; + finder[0][1]</span>
<span class="s">// =&gt; Found duplicate word: test</span>

<span class="s">astr = &#39;nobody&#39;</span>
<span class="s">bstr = &#39;bodysnatcher&#39;</span>
<span class="s">m = &quot;$astr $bstr&quot; =~ /</span><span class="o">^(</span><span class="err">\</span><span class="n">w</span><span class="o">+)(</span><span class="err">\</span><span class="n">w</span><span class="o">+)</span> <span class="err">\</span><span class="mi">2</span><span class="o">(</span><span class="err">\</span><span class="n">w</span><span class="o">+)</span><span class="s">$/</span>
<span class="s">actual = &quot;${m[0][2]} overlaps in ${m[0][1]}-${m[0][2]}-${m[0][3]}&quot;</span>
<span class="s">assert actual == &#39;body overlaps in no-body-snatcher&#39;</span>

<span class="s">cap = &#39;o&#39; * 180</span>
<span class="s">while (m = (cap =~ /^(oo+?)\1+$/)) {</span>
<span class="s">    p1 = m[0][1]</span>
<span class="s">    print p1.size() + &#39; &#39;</span>
<span class="s">    cap = cap.replaceAll(p1,&#39;o&#39;)</span>
<span class="s">}</span>
<span class="s">println cap.size()</span>
<span class="s">// =&gt; 2 2 3 3 5</span>

<span class="s">// diophantine</span>
<span class="s">// solve for 12x + 15y + 16z = 281, maximizing x</span>
<span class="s">if ((m = (&#39;o&#39; * 281) =~ /^(o*)\1{11}(o*)\2{14}(o*)\3{15}$/)) {</span>
<span class="s">    x=m[0][1].size(); y=m[0][2].size(); z=m[0][3].size()</span>
<span class="s">    println &quot;One solution is: x=$x; y=$y; z=$z&quot;</span>
<span class="s">} else println &quot;No solution.&quot;</span>
<span class="s">// =&gt; One solution is: x=17; y=3; z=2</span>

<span class="s">// using different quantifiers:</span>
<span class="s">// /^(o+)\1{11}(o+)\2{14}(o+)\3{15}$/</span>
<span class="s">// =&gt; One solution is: x=17; y=3; z=2</span>

<span class="s">// /^(o*?)\1{11}(o*)\2{14}(o*)\3{15}$/</span>
<span class="s">// =&gt; One solution is: x=0; y=7; z=11</span>

<span class="s">// /^(o+?)\1{11}(o*)\2{14}(o*)\3{15}$/</span>
<span class="s">// =&gt; One solution is: x=1; y=3; z=14</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_6.17</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Groovy doesn&#39;t currently support x!~y so you must use the !(x=~y) style</span>

<span class="s">// alpha OR beta</span>
<span class="s">assert &#39;alpha&#39; ==~ /alpha|beta/</span>
<span class="s">assert &#39;beta&#39; ==~ /alpha|beta/</span>
<span class="s">assert &#39;betalpha&#39; =~ /alpha/ || &#39;betalpha&#39; =~ /beta/</span>

<span class="s">// alpha AND beta</span>
<span class="s">assert !(&#39;alpha&#39; =~ /(?=.*alpha)(?=.*beta)/)</span>
<span class="s">assert &#39;alphabeta&#39; =~ /(?=.*alpha)(?=.*beta)/</span>
<span class="s">assert &#39;betalpha&#39; =~ /(?=.*alpha)(?=.*beta)/</span>
<span class="s">assert &#39;betalpha&#39; =~ /alpha/ &amp;&amp; &#39;betalpha&#39; =~ /beta/</span>

<span class="s">// alpha AND beta,  no overlap</span>
<span class="s">assert &#39;alphabeta&#39; =~ /alpha.*beta|beta.*alpha/</span>
<span class="s">assert !(&#39;betalpha&#39; =~ /alpha.*beta|beta.*alpha/)</span>

<span class="s">// NOT beta</span>
<span class="s">assert &#39;alpha gamma&#39; =~ /^(?:(?!beta).)*$/</span>
<span class="s">assert !(&#39;alpha beta gamma&#39; =~ /^(?:(?!beta).)*$/)</span>

<span class="s">// NOT bad BUT good</span>
<span class="s">assert !(&#39;GOOD and BAD&#39; =~ /(?=(?:(?!BAD).)*$)GOOD/)</span>
<span class="s">assert !(&#39;BAD&#39; =~ /(?=(?:(?!BAD).)*$)GOOD/)</span>
<span class="s">assert !(&#39;WORSE&#39; =~ /(?=(?:(?!BAD).)*$)GOOD/)</span>
<span class="s">assert &#39;GOOD&#39; =~ /(?=(?:(?!BAD).)*$)GOOD/</span>

<span class="s">// minigrep could be done as a one-liner as follows</span>
<span class="s">// groovy -p -e &quot;if (line =~ /pat/) return line&quot; datafile</span>

<span class="s">string = &#39;labelled&#39;</span>
<span class="s">assert string =~ /^(?=.*bell)(?=.*lab)/</span>
<span class="s">assert string =~ /bell/ &amp;&amp; string =~ &#39;lab&#39;</span>
<span class="s">fakeAddress = &quot;blah bell blah &quot;</span>
<span class="s">murrayHillRegex = &#39;&#39;&#39;(?x)</span>
<span class="s">             ^              # start of string</span>
<span class="s">            (?=             # zero-width lookahead</span>
<span class="s">                .*          # any amount of intervening stuff</span>
<span class="s">                bell        # the desired bell string</span>
<span class="s">            )               # rewind, since we were only looking</span>
<span class="s">            (?=             # and do the same thing</span>
<span class="s">                .*          # any amount of intervening stuff</span>
<span class="s">                lab         # and the lab part</span>
<span class="s">            )</span>
<span class="s">&#39;&#39;&#39;</span>
<span class="s">assert string =~ murrayHillRegex</span>
<span class="s">assert !(fakeAddress =~ murrayHillRegex)</span>

<span class="s">// eliminate overlapping</span>
<span class="s">assert !(string =~ /(?:^.*bell.*lab)|(?:^.*lab.*bell)/)</span>

<span class="s">brandRegex = &#39;&#39;&#39;(?x)</span>
<span class="s">            (?:                 # non-capturing grouper</span>
<span class="s">                ^ .*?           # any amount of stuff at the front</span>
<span class="s">                  bell          # look for a bell</span>
<span class="s">                  .*?           # followed by any amount of anything</span>
<span class="s">                  lab           # look for a lab</span>
<span class="s">              )                 # end grouper</span>
<span class="s">        |                       # otherwise, try the other direction</span>
<span class="s">            (?:                 # non-capturing grouper</span>
<span class="s">                ^ .*?           # any amount of stuff at the front</span>
<span class="s">                  lab           # look for a lab</span>
<span class="s">                  .*?           # followed by any amount of anything</span>
<span class="s">                  bell          # followed by a bell</span>
<span class="s">              )                 # end grouper</span>
<span class="s">&#39;&#39;&#39;</span>
<span class="s">assert !(string =~ brandRegex)</span>

<span class="s">map = &#39;the great baldo&#39;</span>

<span class="s">assert map =~ /^(?:(?!waldo).)*$/</span>
<span class="s">noWaldoRegex = &#39;&#39;&#39;(?x)</span>
<span class="s">        ^                   # start of string</span>
<span class="s">        (?:                 # non-capturing grouper</span>
<span class="s">            (?!             # look ahead negation</span>
<span class="s">                waldo       # is he ahead of us now?</span>
<span class="s">            )               # is so, the negation failed</span>
<span class="s">            .               # any character (cuzza /s)</span>
<span class="s">        ) *                 # repeat that grouping 0 or more</span>
<span class="s">        $                   # through the end of the string</span>
<span class="s">&#39;&#39;&#39;</span>
<span class="s">assert map =~ noWaldoRegex</span>

<span class="s">// on unix systems use: realFakedInput = &#39;w&#39;.process().text</span>
<span class="s">fakedInput = &#39;&#39;&#39;</span>
<span class="s"> 7:15am  up 206 days, 13:30,  4 users,  load average: 1.04, 1.07, 1.04</span>
<span class="s">USER     TTY      FROM              LOGIN@  IDLE   JCPU   PCPU  WHAT</span>
<span class="s">tchrist  tty1                       5:16pm 36days 24:43   0.03s  xinit</span>
<span class="s">tchrist  tty2                       5:19pm  6days  0.43s  0.43s  -tcsh</span>
<span class="s">tchrist  ttyp0    chthon            7:58am  3days 23.44s  0.44s  -tcsh</span>
<span class="s">gnat     ttyS4    coprolith         2:01pm 13:36m  0.30s  0.30s  -tcsh</span>
<span class="s">&#39;&#39;&#39;.trim() + &#39;\n&#39;</span>

<span class="s">def miniGrepMethod(input) {</span>
<span class="s">    input.split(&#39;\n&#39;).findAll{it =~ &#39;^(?!.*ttyp).*tchrist&#39;}</span>
<span class="s">}</span>
<span class="s">assert miniGrepMethod(fakedInput).size() == 2</span>

<span class="s">findUserRegex = &#39;&#39;&#39;(?xm)</span>
<span class="s">    ^                       # anchored to the start</span>
<span class="s">    (?!                     # zero-width look-ahead assertion</span>
<span class="s">        .*                  # any amount of anything (faster than .*?)</span>
<span class="s">        ttyp                # the string you don&#39;t want to find</span>
<span class="s">    )                       # end look-ahead negation; rewind to start</span>
<span class="s">    .*                      # any amount of anything (faster than .*?)</span>
<span class="s">    tchrist                 # now try to find Tom</span>
<span class="s">&#39;&#39;&#39;</span>
<span class="s">assert (fakedInput =~ findUserRegex).count == 2</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_6.18</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Groovy uses Unicode character encoding</span>
<span class="s">// special care needs to be taken when using unicode because of the different</span>
<span class="s">// byte lengths, e.g.  can be encoded as two bytes \u0061\u0300 and is also</span>
<span class="s">// supported in legacy character sets by a single character \u00E0.  To Match</span>
<span class="s">// this character, you can&#39;t use any of /./, /../, /a/, /\u00E0/, /\u0061/\u0300</span>
<span class="s">// or /\pL/. The correct way is to use /X (not currently supported) or one</span>
<span class="s">// of /\pL/\pM*/ to ensure that it is a letter or /\PM\pM*/ when you just want</span>
<span class="s">// to combine multicharacter sequences and don&#39;t care whether it is a letter</span>
<span class="s">def checkUnicode(s) {</span>
<span class="s">    println s + &#39; is of size &#39; + s.size()</span>
<span class="s">    println &#39;Exactly matches /./   &#39; + (s ==~ /./)</span>
<span class="s">    println &#39;Exactly matches /../  &#39; + (s ==~ /../)</span>
<span class="s">    println &#39;Exactly matches /a/   &#39; + (s ==~ /a/)</span>
<span class="s">    println &#39;Exactly matches /\\u00E0/       &#39;  + (s ==~ /\u00E0/)</span>
<span class="s">    println &#39;Exactly matches /\\u0061\\u0300/ &#39; + (s ==~ /\u0061\u0300/)</span>
<span class="s">    println &#39;Exactly matches /\\pL/          &#39;  + (s ==~ /\pL/)</span>
<span class="s">    println &#39;Exactly matches /\\pL\\pM*/      &#39; + (s ==~ /\pL\pM*/)</span>
<span class="s">    println &#39;Exactly matches /\\PM\\pM*/      &#39; + (s ==~ /\PM\pM*/)</span>
<span class="s">}</span>
<span class="s">checkUnicode(&#39;&#39;)</span>
<span class="s">checkUnicode(&#39;\u0061\u0300&#39;)</span>
<span class="s">checkUnicode(&#39;\u00E0&#39;)</span>
<span class="s">// =&gt;</span>
<span class="s">//  is of size 1</span>
<span class="s">// Exactly matches /./   true</span>
<span class="s">// Exactly matches /../  false</span>
<span class="s">// Exactly matches /a/   false</span>
<span class="s">// Exactly matches /\u00E0/       true</span>
<span class="s">// Exactly matches /\u0061\u0300/ false</span>
<span class="s">// Exactly matches /\pL/          true</span>
<span class="s">// Exactly matches /\pL\pM*/      true</span>
<span class="s">// Exactly matches /\PM\pM*/      true</span>
<span class="s">// a? is of size 2</span>
<span class="s">// Exactly matches /./   false</span>
<span class="s">// Exactly matches /../  true</span>
<span class="s">// Exactly matches /a/   false</span>
<span class="s">// Exactly matches /\u00E0/       false</span>
<span class="s">// Exactly matches /\u0061\u0300/ true</span>
<span class="s">// Exactly matches /\pL/          false</span>
<span class="s">// Exactly matches /\pL\pM*/      true</span>
<span class="s">// Exactly matches /\PM\pM*/      true</span>
<span class="s">//  is of size 1</span>
<span class="s">// Exactly matches /./   true</span>
<span class="s">// Exactly matches /../  false</span>
<span class="s">// Exactly matches /a/   false</span>
<span class="s">// Exactly matches /\u00E0/       true</span>
<span class="s">// Exactly matches /\u0061\u0300/ false</span>
<span class="s">// Exactly matches /\pL/          true</span>
<span class="s">// Exactly matches /\pL\pM*/      true</span>
<span class="s">// Exactly matches /\PM\pM*/      true</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_6.19</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// The Perl Cookbook categorizes this as a hard problem ... mostly for</span>
<span class="s">// reasons not related to the actual regex - but with a 60-line regex</span>
<span class="s">// perhaps there are some issues with that too. Further details:</span>
<span class="s">// http://www.perl.com/CPAN/authors/Tom_Christiansen/scripts/ckaddr.gz</span>

<span class="s">simpleCommentStripper = /\([^()]*\)/</span>
<span class="s">println &#39;Book Publishing &lt;marketing@books.com&gt; (We will spam you)&#39;.replaceAll(simpleCommentStripper, &#39;&#39;)</span>
<span class="s">// =&gt; Book Publishing &lt;marketing@books.com&gt;</span>

<span class="s">// inspired by the fact that domain names can contain any foreign character these days</span>
<span class="s">modern = /^.+@[^\.].*\.[a-z]{2,}&gt;?$/</span>

<span class="s">// .Net </span>
<span class="s">lenient = /\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/</span>

<span class="s">// a little more checking</span>
<span class="s">strict = /^[_a-zA-Z0-9- &lt;]+(\.[_a-zA-Z0-9- &lt;]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\./ +</span>
<span class="s">         /(([0-9]{1,3})|([a-zA-Z]{2,3})|(aero|coop|info|museum|name))&gt;?$/</span>

<span class="s">addresses = [&#39;someuser@somehost.com&#39;,</span>
<span class="s">             &#39;Book Publishing &lt;marketing@books.com&gt;&#39;]</span>
<span class="s">addresses.each{</span>
<span class="s">    assert it =~ lenient</span>
<span class="s">    assert it =~ strict</span>
<span class="s">    assert it =~ modern</span>
<span class="s">}</span>

<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_6.20</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">def findAction(ans) {</span>
<span class="s">    def re = &#39;(?i)^&#39; + Pattern.quote(ans)</span>
<span class="s">    if      (&quot;SEND&quot;  =~ re) println &quot;Action is send&quot;</span>
<span class="s">    else if (&quot;STOP&quot;  =~ re) println &quot;Action is stop&quot;</span>
<span class="s">    else if (&quot;ABORT&quot; =~ re) println &quot;Action is abort&quot;</span>
<span class="s">    else if (&quot;EDIT&quot;  =~ re) println &quot;Action is edit&quot;</span>
<span class="s">    else println &#39;No Match&#39;</span>
<span class="s">}</span>
<span class="s">findAction(&#39;edit something&#39;)</span>
<span class="s">// =&gt; No Match</span>
<span class="s">findAction(&#39;edit&#39;)</span>
<span class="s">// =&gt; Action is edit</span>
<span class="s">findAction(&#39;se&#39;)</span>
<span class="s">// =&gt; Action is send</span>
<span class="s">findAction(&#39;e&#39;)</span>
<span class="s">// =&gt; Action is edit</span>

<span class="s">def buildAbbrev(words) {</span>
<span class="s">    def table = new TreeMap()</span>
<span class="s">    words.each{ w -&gt;</span>
<span class="s">        (0..&lt;w.size()).each { n -&gt;</span>
<span class="s">            if (!(words - w).any{</span>
<span class="s">                it.size() &gt;= n+1 &amp;&amp; it[0..n] == w[0..n]</span>
<span class="s">            }) table[w[0..n]] = w</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">    table</span>
<span class="s">}</span>
<span class="s">println buildAbbrev(&#39;send stop abort edit&#39;.split(&#39; &#39;).toList())</span>
<span class="s">// =&gt; [&quot;a&quot;:&quot;abort&quot;, &quot;ab&quot;:&quot;abort&quot;, &quot;abo&quot;:&quot;abort&quot;, &quot;abor&quot;:&quot;abort&quot;, &quot;abort&quot;:&quot;abort&quot;,</span>
<span class="s">//     &quot;e&quot;:&quot;edit&quot;, &quot;ed&quot;:&quot;edit&quot;, &quot;edi&quot;:&quot;edit&quot;, &quot;edit&quot;:&quot;edit&quot;, &quot;se&quot;:&quot;send&quot;, &quot;sen&quot;:&quot;send&quot;,</span>
<span class="s">//     &quot;send&quot;:&quot;send&quot;, &quot;st&quot;:&quot;stop&quot;, &quot;sto&quot;:&quot;stop&quot;, &quot;stop&quot;:&quot;stop&quot;]</span>

<span class="s">// miniShellScript:</span>
<span class="s">// dummy methods</span>
<span class="s">def invokeEditor() { println &quot;invoking editor&quot; }</span>
<span class="s">def deliverMessage() { println &quot;delivering message at &quot; + new Date() }</span>
<span class="s">actions = [</span>
<span class="s">    edit:    this.&amp;invokeEditor,</span>
<span class="s">    send:    this.&amp;deliverMessage,</span>
<span class="s">    list:    { println Runtime.runtime.freeMemory() },</span>
<span class="s">    abort:   { System.exit(0) },</span>
<span class="s">    unknown: { println &quot;Unknown Command&quot;}</span>
<span class="s">]</span>

<span class="s">table = buildAbbrev(actions.keySet().toList())</span>
<span class="s">prompt = &#39;\n&gt; &#39;</span>
<span class="s">print &#39;Enter Commands: edit send list abort&#39; + prompt</span>
<span class="s">new BufferedReader(new InputStreamReader(System.in)).eachLine{ line -&gt;</span>
<span class="s">    def idx = (table.containsKey(line)) ? table[line] : &#39;unknown&#39;</span>
<span class="s">    actions[idx]()</span>
<span class="s">    print prompt</span>
<span class="s">}</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_6.21</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">//% gunzip -c ~/mail/archive.gz | urlify &gt; archive.urlified</span>
<span class="s">//% urlify ~/mail/*.inbox &gt; ~/allmail.urlified</span>

<span class="s">urls = &#39;(https?|telnet|gopher|file|wais|ftp|mail)&#39;</span>
<span class="s">ltrs = /\w/</span>
<span class="s">gunk = /\#\/~:.?+=&amp;%@!\-/</span>
<span class="s">punc = /.:?\-/</span>
<span class="s">doll = /$/</span>
<span class="s">all  = /</span><span class="n">$ltrs$gunk$punc</span><span class="s">/</span>

<span class="s">findUrls = &quot;&quot;&quot;(?ix)</span>
<span class="s">        \\b                   # start at word boundary</span>
<span class="s">        (                     # begin group 1  {</span>
<span class="s">         $urls   :            # need resource and a colon</span>
<span class="s">         [$all] +?            # followed by on or more of any valid</span>
<span class="s">                              #  character, but be conservative and</span>
<span class="s">                              #  take only what you need to...</span>
<span class="s">        )                     # end   group 1  }</span>
<span class="s">        (?=                   # look-ahead non-consumptive assertion</span>
<span class="s">         [$punc]*             # either 0 or more punctuation</span>
<span class="s">         [^$all]              #   followed by a non-url character</span>
<span class="s">         |                    # or else</span>
<span class="s">         $doll                #   then end of the string</span>
<span class="s">        )</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="s">input = &#39;&#39;&#39;</span>
<span class="s">If you find a typo on http://groovy.codehaus.org please</span>
<span class="s">send an email to mail:spelling.pedant@codehaus.org</span>
<span class="s">&#39;&#39;&#39;</span>

<span class="s">println input.replaceAll(findUrls,&#39;&lt;a href=&quot;$1&quot;&gt;$1&lt;/</span><span class="n">a</span><span class="o">&gt;</span><span class="s1">&#39;)</span>
<span class="s1">// =&gt;</span>
<span class="s1">// If you find a typo on &lt;a href=&quot;http://groovy.codehaus.org&quot;&gt;http://groovy.codehaus.org&lt;/a&gt; please</span>
<span class="s1">// send an email to &lt;a href=&quot;mail:spelling.pedant@codehaus.org&quot;&gt;mail:spelling.pedant@codehaus.org&lt;/a&gt;</span>

<span class="s1">// urlifyScript:</span>
<span class="s1">#!/usr/bin/groovy</span>
<span class="s1">// urlify - wrap HTML links around URL-like constructs</span>
<span class="s1">// definitions from above</span>
<span class="s1">args.each{ file -&gt;</span>
<span class="s1">    new File(file).eachLine{ line -&gt;</span>
<span class="s1">        println line.replaceAll(findUrls,&#39;</span><span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;$1&quot;</span><span class="o">&gt;</span><span class="n">$1</span><span class="o">&lt;</span><span class="s">/a&gt;&#39;)</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_6.22</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// @@INCOMPLETE@@</span>
<span class="s">// @@INCOMPLETE@@</span>

<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_6.23</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">romans = /</span><span class="o">(?</span><span class="n">i</span><span class="o">)^</span><span class="n">m</span><span class="o">*(</span><span class="n">d</span><span class="o">?</span><span class="n">c</span><span class="o">{</span><span class="mi">0</span><span class="o">,</span><span class="mi">3</span><span class="o">}|</span><span class="n">c</span><span class="o">[</span><span class="n">dm</span><span class="o">])(</span><span class="n">l</span><span class="o">?</span><span class="n">x</span><span class="o">{</span><span class="mi">0</span><span class="o">,</span><span class="mi">3</span><span class="o">}|</span><span class="n">x</span><span class="o">[</span><span class="n">lc</span><span class="o">])(</span><span class="n">v</span><span class="o">?</span><span class="n">i</span><span class="o">{</span><span class="mi">0</span><span class="o">,</span><span class="mi">3</span><span class="o">}|</span><span class="n">i</span><span class="o">[</span><span class="n">vx</span><span class="o">])</span><span class="s">$/</span>
<span class="s">assert &#39;cmxvi&#39; =~ romans</span>
<span class="s">// can&#39;t have tens before 1000s (M) or 100s (C) after 5s (V)</span>
<span class="s">assert !(&#39;xmvci&#39; =~ romans)</span>

<span class="s">// swap first two words</span>
<span class="s">assert &#39;the words&#39;.replaceAll(/(\S+)(\s+)(\S+)/, &#39;$3$2$1&#39;) == &#39;words the&#39;</span>

<span class="s">// extract keyword and value</span>
<span class="s">m = &#39;k=v&#39; =~ /(\w+)\s*=\s*(.*)\s*$/</span>
<span class="s">assert m.matches()</span>
<span class="s">assert m[0][1] == &#39;k&#39;</span>
<span class="s">assert m[0][2] == &#39;v&#39;</span>

<span class="s">hasAtLeastSize = { n -&gt; /.{$n,}/ }</span>
<span class="s">assert &#39;abcdefghijklmnopqrstuvwxyz&#39; =~ hasAtLeastSize(20)</span>

<span class="s">// MM/DD/YY HH:MM:SS (lenient - doesn&#39;t check HH &gt; 23 etc)</span>
<span class="s">d = /\d+/</span>
<span class="s">datetime = &quot;($d)/($d)/($d) ($d):($d):($d)&quot;</span>
<span class="s">assert &#39;04/05/2006 10:26:59&#39; =~ datetime</span>

<span class="s">orig = &#39;/usr/bin/vi&#39;</span>
<span class="s">expected = &#39;/usr/local/bin/vi&#39;</span>
<span class="s">orig.replaceAll(&#39;/usr/bin&#39;,&#39;/usr/local/bin&#39;) == expected</span>

<span class="s">escapeSequenceRegex = /%([0-9A-Fa-f][0-9A-Fa-f])/</span>
<span class="s">convertEscapeToChar = { Object[] ch -&gt; new Character((char)Integer.parseInt(ch[1],16)) }</span>
<span class="s">assert &#39;abc%3cdef&#39;.replaceAll(escapeSequenceRegex, convertEscapeToChar) == &#39;abc&lt;def&#39;</span>

<span class="s">commentStripper = &#39;&#39;&#39;(?xms)</span>
<span class="s">    /\\*        # Match the opening delimiter</span>
<span class="s">    .*          # Match a minimal number of characters */</span>
<span class="s">    \\*/        # Match the closing delimiter</span>
<span class="s">&#39;&#39;&#39;</span>

<span class="s">input = &#39;&#39;&#39;</span>
<span class="s">a line</span>
<span class="s">/*</span>
<span class="s">some comment</span>
<span class="s">*/</span>
<span class="s">another line</span>
<span class="s">&#39;&#39;&#39;</span>
<span class="s">expected = &#39;&#39;&#39;</span>
<span class="s">a line</span>

<span class="s">another line</span>
<span class="s">&#39;&#39;&#39;</span>

<span class="s">assert input.replaceAll(commentStripper,&#39;&#39;) == expected</span>

<span class="s">// emulate s.trim()</span>
<span class="s">assert &#39;  x  y  &#39;.replaceAll(/^\s+/, &#39;&#39;).replaceAll(/\s+$/, &#39;&#39;) == &#39;x  y&#39;</span>

<span class="s">// convert \\n into \n</span>
<span class="s">assert (/a\nb/.replaceAll(/\\n/,&quot;\n&quot;) == &#39;a\nb&#39;)</span>

<span class="s">// remove package symbol (Groovy/Java doesn&#39;t use this as package symbol)</span>
<span class="s">assert &#39;A::B&#39;.replaceAll(/^.*::/, &#39;&#39;) == &#39;B&#39;</span>

<span class="s">// match IP Address (requires leading 0&#39;s)</span>
<span class="s">ipregex = /^([01]?\d\d|2[0-4]\d|25[0-5])\.([01]?\d\d|2[0-4]\d|25[0-5])\./ +</span>
<span class="s">    /([01]?\d\d|2[0-4]\d|25[0-5])\.([01]?\d\d|2[0-4]\d|25[0-5])$/</span>
<span class="s">assert !(&#39;123.456.789&#39; =~ ipregex)</span>
<span class="s">assert &#39;192.168.000.001&#39; =~ ipregex</span>

<span class="s">// extract basename</span>
<span class="s">assert &#39;c:/usr/temp.txt&#39;.replaceAll(/^.*\/{1}/, &#39;&#39;) == &#39;temp.txt&#39;</span>

<span class="s">termcap = &#39;:co#80:li#24:&#39;</span>
<span class="s">m = (termcap =~ /:co\#(\d+):/)</span>
<span class="s">assert m.count == 1</span>
<span class="s">assert m[0][1] == &#39;80&#39;</span>

<span class="s">assert &#39;cmd c:/tmp/junk.txt&#39;.replaceAll(/ \S+\/{1}/, &#39; &#39;) == &#39;cmd junk.txt&#39;</span>

<span class="s">os = System.getProperty(&#39;os.name&#39;)</span>
<span class="s">println &#39;Is Linux? &#39; + (os ==~ /(?i)linux.*/)</span>
<span class="s">println &#39;Is Windows? &#39; + (os ==~ /(?i)windows.*/)</span>
<span class="s">println &#39;Is Mac? &#39; + (os ==~ /(?i)mac.*/)</span>

<span class="s">// join multiline sting</span>
<span class="s">multi = &#39;&#39;&#39;</span>
<span class="s">This is</span>
<span class="s">    a test</span>
<span class="s">&#39;&#39;&#39;.trim()</span>
<span class="s">assert multi.replaceAll(/(?m)\n\s+/, &#39; &#39;) == &#39;This is a test&#39;</span>

<span class="s">// nums in string</span>
<span class="s">string = &#39;The 5th test was won today by 10 wickets after 10.5 overs&#39;</span>
<span class="s">nums = string =~ /(\d+\.?\d*|\.\d+)/</span>
<span class="s">assert (0..&lt;nums.count).collect{ nums[it][1] }.join(&#39; &#39;) == &#39;5 10 10.5&#39;</span>

<span class="s">// capitalize words</span>
<span class="s">words = &#39;the Capital words ARE hiding&#39;</span>
<span class="s">capwords = words =~ /(\b\p{Upper}+\b)/</span>
<span class="s">assert (0..&lt;capwords.count).collect{ capwords[it][1] }.join(&#39; &#39;) == &#39;ARE&#39;</span>

<span class="s">lowords = words =~ /(\b\p{Lower}+\b)/</span>
<span class="s">assert (0..&lt;lowords.count).collect{ lowords[it][1] }.join(&#39; &#39;) == &#39;the words hiding&#39;</span>

<span class="s">capWords = words =~ /(\b\p{Upper}\p{Lower}*\b)/</span>
<span class="s">assert (0..&lt;capWords.count).collect{ capWords[it][1] }.join(&#39; &#39;) == &#39;Capital&#39;</span>

<span class="s">input = &#39;&#39;&#39;</span>
<span class="s">If you find a typo on &lt;a href=&quot;http://groovy.codehaus.org&quot;&gt;http://groovy.codehaus.org&lt;/a&gt; please</span>
<span class="s">send an email to &lt;a href=&quot;mail:spelling.pedant@codehaus.org&quot;&gt;mail:spelling.pedant@codehaus.org&lt;/a&gt;</span>
<span class="s">&#39;&#39;&#39;</span>

<span class="s">linkRegex = /(?im)&lt;A[^&gt;]+?HREF\s*=\s*[&quot;&#39;]?([^&#39;&quot; &gt;]+?)[ &#39;&quot;]?&gt;/          //&#39;</span>
<span class="s">links = input =~ linkRegex</span>
<span class="s">(0..&lt;links.count).each{ println links[it][1] }</span>
<span class="s">// =&gt;</span>
<span class="s">// http://groovy.codehaus.org</span>
<span class="s">// mail:spelling.pedant@codehaus.org</span>

<span class="s">// find middle initial if any</span>
<span class="s">m = &#39;Lee Harvey Oswald&#39; =~ /^\S+\s+(\S)\S*\s+\S/</span>
<span class="s">initial = m.count ? m[0][1] : &quot;&quot;</span>
<span class="s">assert initial == &#39;H&#39;</span>

<span class="s">// inch marks to quotes</span>
<span class="s">println &#39;I said &quot;Hello&quot; to you.&#39;.replaceAll(/&quot;([^&quot;]*)&quot;/, /``$1&#39;&#39;/)     //&quot;</span>
<span class="s">// =&gt; I said ``Hello&#39;&#39; to you.</span>

<span class="s">// extract sentences (2 spaces or newline after punctuation)</span>
<span class="s">input = &#39;&#39;&#39;</span>
<span class="s">Is this a sentence?</span>
<span class="s">Yes!  And so</span>
<span class="s">is this.  And the fourth.</span>
<span class="s">&#39;&#39;&#39;</span>
<span class="s">sentences = []</span>
<span class="s">strip = input.replaceAll(/(\p{Punct})\n/, &#39;$1  &#39;).replaceAll(/\n/, &#39; &#39;).replaceAll(/ {3,}/,&#39;  &#39;)</span>
<span class="s">m = strip =~ /(\S.*?\p{Punct})(?=  |\Z)/</span>
<span class="s">(0..&lt;m.count).each{ sentences += m[it][1] }</span>
<span class="s">assert sentences == [&quot;Is this a sentence?&quot;, &quot;Yes!&quot;, &quot;And so is this.&quot;, &quot;And the fourth.&quot;]</span>

<span class="s">// YYYY-MM-DD</span>
<span class="s">m = &#39;2007-2-28&#39; =~ /(\d{4})-(\d\d?)-(\d\d?)/</span>
<span class="s">assert m.matches()</span>
<span class="s">assert [&#39;2007&#39;, &#39;2&#39;, &#39;28&#39;] == [m[0][1], m[0][2], m[0][3]]</span>

<span class="s">usPhoneRegex = /^[01]?[- .]?(\([2-9]\d{2}\)|[2-9]\d{2})[- .]?\d{3}[- .]?\d{4}$/</span>
<span class="s">numbers = &#39;&#39;&#39;</span>
<span class="s">(425) 555-0123</span>
<span class="s">425-555-0123</span>
<span class="s">425 555 0123</span>
<span class="s">1-425-555-0123</span>
<span class="s">&#39;&#39;&#39;.trim().split(&#39;\n&#39;).toList()</span>
<span class="s">assert numbers.every{ it ==~ usPhoneRegex }</span>

<span class="s">exclaimRegex = /(?i)\boh\s+my\s+gh?o(d(dess(es)?|s?)|odness|sh)\b/</span>
<span class="s">assert &#39;Oh my Goodness!&#39; =~ exclaimRegex</span>
<span class="s">assert !(&#39;Golly gosh&#39; =~ exclaimRegex)</span>

<span class="s">input = &#39;line 1\rline 2\nline\r\nline 3\n\rline 4&#39;</span>
<span class="s">m = input =~ /(?m)^([^\012\015]*)(\012\015?|\015\012?)/</span>
<span class="s">assert m.count == 4</span>


<span class="s">// @@PLEAC@@_6.22</span>
<span class="s">// not an exact equivalent to original cookbook but has</span>
<span class="s">// a reasonable subset of mostly similar functionality</span>
<span class="s">// instead of -r recursion option, use Ant fileset wildcards</span>
<span class="s">// e.g. **/*.c.  You can also specify an excludes pattern</span>
<span class="s">// e.g. **/*.* -X **/*.h will process all but header files</span>
<span class="s">// (currently not optimised and with minimal error checking)</span>
<span class="s">// uses jopt-simple (jopt-simple.sf.net)</span>

<span class="s">op = new joptsimple.OptionParser()</span>
<span class="s">NOCASE  = &#39;i&#39;;  op.accepts( NOCASE,  &quot;case insensitive&quot; )</span>
<span class="s">WITHN   = &#39;n&#39;;  op.accepts( WITHN,   &quot;display line/para with line/para number&quot; )</span>
<span class="s">WITHF   = &#39;H&#39;;  op.accepts( WITHF,   &quot;display line/para with filename&quot; )</span>
<span class="s">NONAME  = &#39;h&#39;;  op.accepts( NONAME,  &quot;hide filenames&quot; )</span>
<span class="s">COUNT   = &#39;c&#39;;  op.accepts( COUNT,   &quot;give count of lines/paras matching&quot; )</span>
<span class="s">TCOUNT  = &#39;C&#39;;  op.accepts( TCOUNT,  &quot;give count of total matches (multiple per line/para)&quot; )</span>
<span class="s">WORD    = &#39;w&#39;;  op.accepts( WORD,    &quot;word boundaries only&quot; )</span>
<span class="s">EXACT   = &#39;x&#39;;  op.accepts( EXACT,   &quot;exact matches only&quot; )</span>
<span class="s">INVERT  = &#39;v&#39;;  op.accepts( INVERT,  &quot;invert search sense (lines that DON&#39;T match)&quot; )</span>
<span class="s">EXCLUDE = &#39;X&#39;;  op.accepts( EXCLUDE, &quot;exclude files matching pattern [default is &#39;**/*.bak&#39;]&quot; ).</span>
<span class="s">                    withRequiredArg().describedAs(&#39;path_pattern&#39;)</span>
<span class="s">MATCH   = &#39;l&#39;;  op.accepts( MATCH,   &quot;list names of files with matches&quot; )</span>
<span class="s">NOMATCH = &#39;L&#39;;  op.accepts( NOMATCH, &quot;list names of files with no match&quot; )</span>
<span class="s">PARA    = &#39;p&#39;;  op.accepts( PARA,    &quot;para mode (.* matches newlines)&quot; ).</span>
<span class="s">                    withOptionalArg().describedAs(&#39;para_pattern&#39;)</span>
<span class="s">EXPR    = &#39;e&#39;;  op.accepts( EXPR,    &quot;expression (when pattern begins with &#39;-&#39;)&quot; ).</span>
<span class="s">                    withRequiredArg().describedAs(&#39;pattern&#39;)</span>
<span class="s">FILE    = &#39;f&#39;;  op.accepts( FILE,    &quot;file containing pattern&quot; ).</span>
<span class="s">                    withRequiredArg().describedAs(&#39;filename&#39;)</span>
<span class="s">HELP = &#39;help&#39;;  op.accepts( HELP,    &quot;display this message&quot; )</span>

<span class="s">options = op.parse(args)</span>
<span class="s">params = options.nonOptionArguments()</span>
<span class="s">if (options.wasDetected( HELP )) {</span>
<span class="s">    op.printHelpOn( System.out )</span>
<span class="s">} else if (params.size() == 0) {</span>
<span class="s">    println &quot;Usage: grep [OPTION]... PATTERN [FILE]...\nTry &#39;grep --$HELP&#39; for more information.&quot;</span>
<span class="s">} else {</span>
<span class="s">    modifiers = []</span>
<span class="s">    paraPattern = &#39;&#39;</span>
<span class="s">    o_withn   = options.wasDetected( WITHN )</span>
<span class="s">    o_withf   = options.wasDetected( WITHF )</span>
<span class="s">    o_noname  = options.wasDetected( NONAME )</span>
<span class="s">    o_count   = options.wasDetected( COUNT )</span>
<span class="s">    o_tcount  = options.wasDetected( TCOUNT )</span>
<span class="s">    o_invert  = options.wasDetected( INVERT )</span>
<span class="s">    o_match   = options.wasDetected( MATCH )</span>
<span class="s">    o_nomatch = options.wasDetected( NOMATCH )</span>
<span class="s">    if (options.wasDetected( EXPR )) {</span>
<span class="s">        pattern = options.valueOf( EXPR )</span>
<span class="s">    } else if (options.wasDetected( FILE )) {</span>
<span class="s">        pattern = new File(options.valueOf( FILE )).text.trim()</span>
<span class="s">    } else {</span>
<span class="s">        pattern = params[0]</span>
<span class="s">        params = params[1..-1]</span>
<span class="s">    }</span>
<span class="s">    if (options.wasDetected( EXCLUDE )) excludes = options.valueOf( EXCLUDE )</span>
<span class="s">    else excludes = [&#39;**/*.bak&#39;]</span>
<span class="s">    if (options.wasDetected( EXACT )) pattern = &#39;^&#39; + pattern + &#39;$&#39;</span>
<span class="s">    else if (options.wasDetected( WORD )) pattern = /\b$pattern\b/</span>
<span class="s">    if (options.wasDetected( NOCASE )) modifiers += &#39;i&#39;</span>
<span class="s">    if (options.wasDetected( PARA )) {</span>
<span class="s">        if (options.hasArgument( PARA )) paraPattern = options.valueOf( PARA )</span>
<span class="s">        else paraPattern = &#39;^$&#39;</span>
<span class="s">        paraPattern = &#39;(?sm)&#39; + paraPattern</span>
<span class="s">        modifiers += &#39;sm&#39;</span>
<span class="s">    }</span>
<span class="s">    if (modifiers) pattern = &quot;(?${modifiers.join()})&quot; + pattern</span>

<span class="s">    if (params.size() == 0) grepStream(System.in, &#39;&lt;stdin&gt;&#39;)</span>
<span class="s">    else {</span>
<span class="s">        scanner = new AntBuilder().fileScanner {</span>
<span class="s">            fileset(dir:&#39;.&#39;, includes:params.join(&#39;,&#39;), excludes:excludes)</span>
<span class="s">        }</span>
<span class="s">        for (f in scanner) {</span>
<span class="s">            grepStream(new FileInputStream(f), f)</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">def grepStream(s, name) {</span>
<span class="s">    def count = 0</span>
<span class="s">    def tcount = 0</span>
<span class="s">    def pieces</span>
<span class="s">    if (paraPattern) pieces = s.text.split(paraPattern)</span>
<span class="s">    else pieces = s.readLines()</span>
<span class="s">    def fileMode = o_match || o_nomatch || o_count || o_tcount</span>
<span class="s">    pieces.eachWithIndex{line, index -&gt;</span>
<span class="s">        def m = line =~ pattern</span>
<span class="s">        boolean found = m.count</span>
<span class="s">        if (found != o_invert) {</span>
<span class="s">            count++</span>
<span class="s">            tcount += m.count</span>
<span class="s">            if (!fileMode) {</span>
<span class="s">                linefields = []</span>
<span class="s">                if (o_withf) linefields += name</span>
<span class="s">                if (o_withn) linefields += index + 1</span>
<span class="s">                linefields += line</span>
<span class="s">                println linefields.join(&#39;:&#39;)</span>
<span class="s">            }</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">    def display = true</span>
<span class="s">    if ((o_match &amp;&amp; count == 0) || (o_nomatch &amp;&amp; count != 0)) display = false</span>
<span class="s">    if (fileMode &amp;&amp; display) {</span>
<span class="s">        filefields = []</span>
<span class="s">        if (!o_noname) filefields += name</span>
<span class="s">        if (o_tcount) filefields += tcount</span>
<span class="s">        else if (o_count) filefields += count</span>
<span class="s">        println filefields.join(&#39;:&#39;)</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_7.0</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">//testfile = new File(&#39;/usr/local/widgets/data&#39;)  // unix</span>
<span class="s">testfile = new File(&#39;Pleac/data/blue.txt&#39;)      // windows</span>
<span class="s">testfile.eachLine{ if (it =~ /blue/) println it }</span>

<span class="s">// Groovy (like Java) uses the File class as an abstraction for</span>
<span class="s">// the path representing a potential file system resource.</span>
<span class="s">// Channels and Streams (along with Reader adn Writer helper</span>
<span class="s">// classes) are used to read and write to files (and other</span>
<span class="s">// things). Files, channels, streams etc are all &quot;normal&quot;</span>
<span class="s">// objects; they can be passed around in your programs just</span>
<span class="s">// like other objects (though there are some restrictions</span>
<span class="s">// covered elsewhere - e.g. you can&#39;t expect to pass a File</span>
<span class="s">// object between JVMs on different machines running different</span>
<span class="s">// operating systems and expect them to maintain a meaningful</span>
<span class="s">// value across the different JVMs). In addition to Streams,</span>
<span class="s">// there is also support for random access to files.</span>

<span class="s">// Many operations are available on streams and channels. Some</span>
<span class="s">// return values to indicate success or failure, some can throw</span>
<span class="s">// exceptions, other times both styles of error reporting may be</span>
<span class="s">// available.</span>

<span class="s">// Streams at the lowest level are just a sequence of bytes though</span>
<span class="s">// there are various abstractions at higher levels to allow</span>
<span class="s">// interacting with streams at encoded character, data type or</span>
<span class="s">// object levels if desired. Standard streams include System.in,</span>
<span class="s">// System.out and System.err. Java and Groovy on top of that</span>
<span class="s">// provide facilities for buffering, filtering and processing</span>
<span class="s">// streams in various ways.</span>

<span class="s">// File channels provide more powerful operations than streams</span>
<span class="s">// for reading and writing files such as locks, buffering,</span>
<span class="s">// positioning, concurrent reading and writing, mapping to memory</span>
<span class="s">// etc. In the examples which follow, streams will be used for</span>
<span class="s">// simple cases, channels when more advanced features are</span>
<span class="s">// required. Groovy currently focusses on providing extra support</span>
<span class="s">// at the file and stream level rather than channel level.</span>
<span class="s">// This makes the simple things easy but lets you do more complex</span>
<span class="s">// things by just using the appropriate Java classes. All Java</span>
<span class="s">// classes are available within Groovy by default.</span>

<span class="s">// Groovy provides syntactic sugar over the top of Java&#39;s file</span>
<span class="s">// processing capabilities by providing meaning to shorthand</span>
<span class="s">// operators and by automatically handling scaffolding type</span>
<span class="s">// code such as opening, closing and handling exceptions behind</span>
<span class="s">// the scenes. It also provides many powerful closure operators,</span>
<span class="s">// e.g. file.eachLineMatch(pattern){ some_operation } will open</span>
<span class="s">// the file, process it line-by-line, finding all lines which</span>
<span class="s">// match the specified pattern and then invoke some operation</span>
<span class="s">// for the matching line(s) if any, before closing the file.</span>


<span class="s">// this example shows how to access the standard input stream</span>
<span class="s">// numericCheckingScript:</span>
<span class="s">prompt = &#39;\n&gt; &#39;</span>
<span class="s">print &#39;Enter text including a digit:&#39; + prompt</span>
<span class="s">new BufferedReader(new InputStreamReader(System.in)).eachLine{ line -&gt;</span>
<span class="s">                                               // line is read from System.in</span>
<span class="s">    if (line =~ &#39;\\d&#39;) println &quot;Read: $line&quot;   // normal output to System.out</span>
<span class="s">    else System.err.println &#39;No digit found.&#39;  // this message to System.err</span>
<span class="s">}</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_7.1</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// test values (change for your os and directories)</span>
<span class="s">inputPath=&#39;Pleac/src/pleac7.groovy&#39;; outPath=&#39;Pleac/temp/junk.txt&#39;</span>

<span class="s">// For input Java uses InputStreams (for byte-oriented processing) or Readers</span>
<span class="s">// (for character-oriented processing). These can throw FileNotFoundException.</span>
<span class="s">// There are also other stream variants: buffered, data, filters, objects, ...</span>
<span class="s">inputFile = new File(inputPath)</span>
<span class="s">inputStream = new FileInputStream(inputFile)</span>
<span class="s">reader = new FileReader(inputFile)</span>
<span class="s">inputChannel = inputStream.channel</span>

<span class="s">// Examples for random access to a file</span>
<span class="s">file = new RandomAccessFile(inputFile, &quot;rw&quot;) // for read and write</span>
<span class="s">channel = file.channel</span>

<span class="s">// Groovy provides some sugar coating on top of Java</span>
<span class="s">println inputFile.text.size()</span>
<span class="s">// =&gt; 13496</span>

<span class="s">// For output Java use OutputStreams or Writers. Can throw FileNotFound</span>
<span class="s">// or IO exceptions. There are also other flavours of stream: buffered,</span>
<span class="s">// data, filters, objects, ...</span>
<span class="s">outFile = new File(outPath)</span>
<span class="s">appendFlag = false</span>
<span class="s">outStream = new FileOutputStream(outFile, appendFlag)</span>
<span class="s">writer = new FileWriter(outFile, appendFlag)</span>
<span class="s">outChannel = outStream.channel</span>

<span class="s">// Also some Groovy sugar coating</span>
<span class="s">outFile &lt;&lt; &#39;A Chinese sailing vessel&#39;</span>
<span class="s">println outFile.text.size() // =&gt; 24</span>

<span class="s">// @@PLEAC@@_7.2</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// No problem with Groovy since the filename doesn&#39;t contain characters with</span>
<span class="s">// special meaning; like Perl&#39;s sysopen. Options are either additional parameters</span>
<span class="s">// or captured in different classes, e.g. Input vs Output, Buffered vs non etc.</span>
<span class="s">new FileReader(inputPath)</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_7.3</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// &#39;~&#39; is a shell expansion feature rather than file system feature per se.</span>
<span class="s">// Because &#39;~&#39; is a valid filename character in some operating systems, and Java</span>
<span class="s">// attempts to be cross-platform, it doesn&#39;t automatically expand Tilde&#39;s.</span>
<span class="s">// Given that &#39;~&#39; expansion is commonly used however, Java puts the $HOME</span>
<span class="s">// environment variable (used by shells to do typical expansion) into the</span>
<span class="s">// &quot;user.home&quot; system property. This works across operating systems - though</span>
<span class="s">// the value inside differs from system to system so you shouldn&#39;t rely on its</span>
<span class="s">// content to be of a particular format. In most cases though you should be</span>
<span class="s">// able to write a regex that will work as expected. Also, Apple&#39;s</span>
<span class="s">// NSPathUtilities can expand and introduce Tildes on platforms it supports.</span>
<span class="s">path = &#39;~paulk/.cvspass&#39;</span>
<span class="s">name = System.getProperty(&#39;user.name&#39;)</span>
<span class="s">home = System.getProperty(&#39;user.home&#39;)</span>
<span class="s">println home + path.replaceAll(&quot;~$name(.*)&quot;, &#39;$1&#39;)</span>
<span class="s">// =&gt; C:\Documents and Settings\Paul/.cvspass</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_7.4</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// The exception raised in Groovy reports the filename</span>
<span class="s">try {</span>
<span class="s">    new File(&#39;unknown_path/bad_file.ext&#39;).text</span>
<span class="s">} catch (Exception ex) {</span>
<span class="s">    System.err.println(ex.message)</span>
<span class="s">}</span>
<span class="s">// =&gt;</span>
<span class="s">// unknown_path\bad_file.ext (The system cannot find the path specified)</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_7.5</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">try {</span>
<span class="s">    temp = File.createTempFile(&quot;prefix&quot;, &quot;.suffix&quot;)</span>
<span class="s">    temp.deleteOnExit()</span>
<span class="s">} catch (IOException ex) {</span>
<span class="s">    System.err.println(&quot;Temp file could not be created&quot;)</span>
<span class="s">}</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_7.6</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// no special features are provided, here is a way to do it manually</span>
<span class="s">// DO NOT REMOVE THE FOLLOWING STRING DEFINITION.</span>
<span class="s">pleac_7_6_embeddedFileInfo = &#39;&#39;&#39;</span>
<span class="s">Script size is 13731</span>
<span class="s">Last script update: Wed Jan 10 19:05:58 EST 2007</span>
<span class="s">&#39;&#39;&#39;</span>
<span class="s">ls = System.getProperty(&#39;line.separator&#39;)</span>
<span class="s">file = new File(&#39;Pleac/src/pleac7.groovy&#39;)</span>
<span class="s">regex = /(?ms)(?&lt;=^pleac_7_6_embeddedFileInfo = &#39;&#39;&#39;)(.*)(?=^&#39;&#39;&#39;)/</span>
<span class="s">def readEmbeddedInfo() {</span>
<span class="s">    m = file.text =~ regex</span>
<span class="s">    println &#39;Found:\n&#39; + m[0][1]</span>
<span class="s">}</span>
<span class="s">def writeEmbeddedInfo() {</span>
<span class="s">    lastMod = new Date(file.lastModified())</span>
<span class="s">    newInfo = &quot;${ls}Script size is ${file.size()}${ls}Last script update: ${lastMod}${ls}&quot;</span>
<span class="s">    file.write(file.text.replaceAll(regex, newInfo))</span>
<span class="s">}</span>
<span class="s">readEmbeddedInfo()</span>
<span class="s">// writeEmbeddedInfo()  // uncomment to make script update itself</span>
<span class="s">// readEmbeddedInfo()   // uncomment to redisplay the embedded info after the update</span>

<span class="s">// =&gt; (output when above two method call lines are uncommented)</span>
<span class="s">// Found:</span>
<span class="s">//</span>
<span class="s">// Script size is 13550</span>
<span class="s">// Last script update: Wed Jan 10 18:56:03 EST 2007</span>
<span class="s">//</span>
<span class="s">// Found:</span>
<span class="s">//</span>
<span class="s">// Script size is 13731</span>
<span class="s">// Last script update: Wed Jan 10 19:05:58 EST 2007</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_7.7</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// general pattern for reading from System.in is:</span>
<span class="s">// System.in.readLines().each{ processLine(it) }</span>

<span class="s">// general pattern for a filter which can either process file args or read from System.in is:</span>
<span class="s">// if (args.size() != 0) args.each{</span>
<span class="s">//     file -&gt; new File(file).eachLine{ processLine(it) }</span>
<span class="s">// } else System.in.readLines().each{ processLine(it) }</span>

<span class="s">// note: the following examples are file-related per se. They show</span>
<span class="s">// how to do option processing in scenarios which typically also</span>
<span class="s">// involve file arguments. The reader should also consider using a</span>
<span class="s">// pre-packaged options parser package (there are several popular</span>
<span class="s">// ones) rather than the hard-coded processing examples shown here.</span>

<span class="s">chopFirst = false</span>
<span class="s">columns = 0</span>
<span class="s">args = [&#39;-c&#39;, &#39;-30&#39;, &#39;somefile&#39;]</span>

<span class="s">// demo1: optional c</span>
<span class="s">if (args[0] == &#39;-c&#39;) {</span>
<span class="s">    chopFirst = true</span>
<span class="s">    args = args[1..-1]</span>
<span class="s">}</span>

<span class="s">assert args == [&quot;-30&quot;, &quot;somefile&quot;]</span>
<span class="s">assert chopFirst</span>

<span class="s">// demo2: processing numerical options</span>
<span class="s">if (args[0] =~ /^-(\d+)$/) {</span>
<span class="s">    columns = args[0][1..-1].toInteger()</span>
<span class="s">    args = args[1..-1]</span>
<span class="s">}</span>

<span class="s">assert args == [&quot;somefile&quot;]</span>
<span class="s">assert columns == 30</span>

<span class="s">// demo3: multiple args (again consider option parsing package)</span>
<span class="s">args = [&#39;-n&#39;,&#39;-a&#39;,&#39;file1&#39;,&#39;file2&#39;]</span>
<span class="s">nostdout = false</span>
<span class="s">append = false</span>
<span class="s">unbuffer = false</span>
<span class="s">ignore_ints = false</span>
<span class="s">files = []</span>
<span class="s">args.each{ arg -&gt;</span>
<span class="s">    switch(arg) {</span>
<span class="s">        case &#39;-n&#39;: nostdout    = true; break</span>
<span class="s">        case &#39;-a&#39;: append      = true; break</span>
<span class="s">        case &#39;-u&#39;: unbuffer    = true; break</span>
<span class="s">        case &#39;-i&#39;: ignore_ints = true; break</span>
<span class="s">        default: files += arg</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">if (files.any{ it.startsWith(&#39;-&#39;)}) {</span>
<span class="s">    System.err.println(&quot;usage: demo3 [-ainu] [filenames]&quot;)</span>
<span class="s">}</span>
<span class="s">// process files ...</span>
<span class="s">assert nostdout &amp;&amp; append &amp;&amp; !unbuffer &amp;&amp; !ignore_ints</span>
<span class="s">assert files == [&#39;file1&#39;,&#39;file2&#39;]</span>

<span class="s">// find login: print all lines containing the string &quot;login&quot; (command-line version)</span>
<span class="s">//% groovy -ne &quot;if (line =~ &#39;login&#39;) println line&quot; filename</span>

<span class="s">// find login variation: lines containing &quot;login&quot; with line number (command-line version)</span>
<span class="s">//% groovy -ne &quot;if (line =~ &#39;login&#39;) println count + &#39;:&#39; + line&quot; filename</span>

<span class="s">// lowercase file (command-line version)</span>
<span class="s">//% groovy -pe &quot;line.toLowerCase()&quot;</span>


<span class="s">// count chunks but skip comments and stop when reaching &quot;__DATA__&quot; or &quot;__END__&quot;</span>
<span class="s">chunks = 0; done = false</span>
<span class="s">testfile = new File(&#39;Pleac/data/chunks.txt&#39;) // change on your system</span>
<span class="s">lines = testfile.readLines()</span>
<span class="s">for (line in lines) {</span>
<span class="s">    if (!line.trim()) continue</span>
<span class="s">    words = line.split(/[^\w#]+/).toList()</span>
<span class="s">    for (word in words) {</span>
<span class="s">        if (word =~ /^#/) break</span>
<span class="s">        if (word in [&quot;__DATA__&quot;, &quot;__END__&quot;]) { done = true; break }</span>
<span class="s">        chunks += 1</span>
<span class="s">    }</span>
<span class="s">    if (done) break</span>
<span class="s">}</span>
<span class="s">println &quot;Found $chunks chunks&quot;</span>


<span class="s">// groovy &quot;one-liner&quot; (cough cough) for turning .history file into pretty version:</span>
<span class="s">//% groovy -e &quot;m=new File(args[0]).text=~/(?ms)^#\+(\d+)\r?\n(.*?)$/;(0..&lt;m.count).each{println &#39;&#39;+new Date(m[it][1].toInteger())+&#39;  &#39;+m[it][2]}&quot; .history</span>
<span class="s">// =&gt;</span>
<span class="s">// Sun Jan 11 18:26:22 EST 1970  less /etc/motd</span>
<span class="s">// Sun Jan 11 18:26:22 EST 1970  vi ~/.exrc</span>
<span class="s">// Sun Jan 11 18:26:22 EST 1970  date</span>
<span class="s">// Sun Jan 11 18:26:22 EST 1970  who</span>
<span class="s">// Sun Jan 11 18:26:22 EST 1970  telnet home</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_7.8</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// test data for below</span>
<span class="s">testPath = &#39;Pleac/data/process.txt&#39;</span>

<span class="s">// general pattern</span>
<span class="s">def processWithBackup(inputPath, Closure processLine) {</span>
<span class="s">    def input = new File(inputPath)</span>
<span class="s">    def out = File.createTempFile(&quot;prefix&quot;, &quot;.suffix&quot;)</span>
<span class="s">    out.write(&#39;&#39;) // create empty file</span>
<span class="s">    count = 0</span>
<span class="s">    input.eachLine{ line -&gt;</span>
<span class="s">        count++</span>
<span class="s">        processLine(out, line, count)</span>
<span class="s">    }</span>
<span class="s">    def dest = new File(inputPath + &quot;.orig&quot;)</span>
<span class="s">    dest.delete() // clobber previous backup</span>
<span class="s">    input.renameTo(dest)</span>
<span class="s">    out.renameTo(input)</span>
<span class="s">}</span>

<span class="s">// use withPrintWriter if you don&#39;t want the &#39;\n&#39;&#39;s appearing</span>
<span class="s">processWithBackup(testPath) { out, line, count -&gt;</span>
<span class="s">    if (count == 20) {   // we are at the 20th line</span>
<span class="s">        out &lt;&lt; &quot;Extra line 1\n&quot;</span>
<span class="s">        out &lt;&lt; &quot;Extra line 2\n&quot;</span>
<span class="s">    }</span>
<span class="s">    out &lt;&lt; line + &#39;\n&#39;</span>
<span class="s">}</span>

<span class="s">processWithBackup(testPath) { out, line, count -&gt;</span>
<span class="s">    if (!(count in 20..30)) // skip the 20th line to the 30th</span>
<span class="s">        out &lt;&lt; line + &#39;\n&#39;</span>
<span class="s">}</span>
<span class="s">// equivalent to &quot;one-liner&quot;:</span>
<span class="s">//% groovy -i.orig -pe &quot;if (!(count in 20..30)) out &lt;&lt; line&quot; testPath</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_7.9</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">//% groovy -i.orig -pe &#39;FILTER COMMAND&#39; file1 file2 file3 ...</span>

<span class="s">// the following may also be possible on unix systems (unchecked)</span>
<span class="s">//#!/usr/bin/groovy -i.orig -p</span>
<span class="s">// filter commands go here</span>

<span class="s">// &quot;one-liner&quot; templating scenario: change DATE -&gt; current time</span>
<span class="s">//% groovy -pi.orig -e &#39;line.replaceAll(/DATE/){new Date()}&#39;</span>

<span class="s">//% groovy -i.old -pe &#39;line.replaceAll(/\bhisvar\b/, &#39;hervar&#39;)&#39; *.[Cchy] (globbing platform specific)</span>

<span class="s">// one-liner for correcting spelling typos</span>
<span class="s">//% groovy -i.orig -pe &#39;line.replaceAll(/\b(p)earl\b/i, &#39;\1erl&#39;)&#39; *.[Cchy] (globbing platform specific)</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_7.10</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// general pattern</span>
<span class="s">def processFileInplace(file, Closure processText) {</span>
<span class="s">    def text = file.text</span>
<span class="s">    file.write(processText(text))</span>
<span class="s">}</span>

<span class="s">// templating scenario: change DATE -&gt; current time</span>
<span class="s">testfile = new File(&#39;Pleac/data/pleac7_10.txt&#39;) // replace on your system</span>
<span class="s">processFileInplace(testfile) { text -&gt;</span>
<span class="s">    text.replaceAll(/(?m)DATE/, new Date().toString())</span>
<span class="s">}</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_7.11</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// You need to use Java&#39;s Channel class to acquire locks. The exact</span>
<span class="s">// nature of the lock is somewhat dependent on the operating system.</span>
<span class="s">def processFileWithLock(file, processStream) {</span>
<span class="s">    def random = new RandomAccessFile(file, &quot;rw&quot;)</span>
<span class="s">    def lock = random.channel.lock() // acquire exclusive lock</span>
<span class="s">    processStream(random)</span>
<span class="s">    lock.release()</span>
<span class="s">    random.close()</span>
<span class="s">}</span>

<span class="s">// Instead of an exclusive lock you can acquire a shared lock.</span>

<span class="s">// Also, you can acquire a lock for a region of a file by specifying</span>
<span class="s">// start and end positions of the region when acquiring the lock.</span>

<span class="s">// For non-blocking functionality, use tryLock() instead of lock().</span>
<span class="s">def processFileWithTryLock(file, processStream) {</span>
<span class="s">    random = new RandomAccessFile(file, &quot;rw&quot;)</span>
<span class="s">    channel = random.channel</span>
<span class="s">    def MAX_ATTEMPTS = 30</span>
<span class="s">    for (i in 0..&lt;MAX_ATTEMPTS) {</span>
<span class="s">        lock = channel.tryLock()</span>
<span class="s">        if (lock != null) break</span>
<span class="s">        println &#39;Could not get lock, pausing ...&#39;</span>
<span class="s">        Thread.sleep(500) // 500 millis = 0.5 secs</span>
<span class="s">    }</span>
<span class="s">    if (lock == null) {</span>
<span class="s">        println &#39;Unable to acquire lock, aborting ...&#39;</span>
<span class="s">    } else {</span>
<span class="s">        processStream(random)</span>
<span class="s">        lock.release()</span>
<span class="s">    }</span>
<span class="s">    random.close()</span>
<span class="s">}</span>


<span class="s">// non-blocking multithreaded example: print first line while holding lock</span>
<span class="s">Thread.start{</span>
<span class="s">    processFileWithLock(testfile) { source -&gt;</span>
<span class="s">        println &#39;First reader: &#39; + source.readLine().toUpperCase()</span>
<span class="s">        Thread.sleep(2000) // 2000 millis = 2 secs</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">processFileWithTryLock(testfile) { source -&gt;</span>
<span class="s">    println &#39;Second reader: &#39; + source.readLine().toUpperCase()</span>
<span class="s">}</span>
<span class="s">// =&gt;</span>
<span class="s">// Could not get lock, pausing ...</span>
<span class="s">// First reader: WAS LOWERCASE</span>
<span class="s">// Could not get lock, pausing ...</span>
<span class="s">// Could not get lock, pausing ...</span>
<span class="s">// Could not get lock, pausing ...</span>
<span class="s">// Could not get lock, pausing ...</span>
<span class="s">// Second reader: WAS LOWERCASE</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_7.12</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// In Java, input and output streams have a flush() method and file channels</span>
<span class="s">// have a force() method (applicable also to memory-mapped files). When creating</span>
<span class="s">// PrintWriters and // PrintStreams, an autoFlush option can be provided.</span>
<span class="s">// From a FileInput or Output Stream you can ask for the FileDescriptor</span>
<span class="s">// which has a sync() method - but you wouldn&#39;t you&#39;d just use flush().</span>

<span class="s">inputStream = testfile.newInputStream()    // returns a buffered input stream</span>
<span class="s">autoFlush = true</span>
<span class="s">printStream = new PrintStream(outStream, autoFlush)</span>
<span class="s">printWriter = new PrintWriter(outStream, autoFlush)</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_7.13</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// See the comments in 7.14 about scenarios where non-blocking can be</span>
<span class="s">// avoided. Also see 7.14 regarding basic information about channels.</span>
<span class="s">// An advanced feature of the java.nio.channels package is supported</span>
<span class="s">// by the Selector and SelectableChannel classes. These allow efficient</span>
<span class="s">// server multiplexing amongst responses from a number of potential sources.</span>
<span class="s">// Under the covers, it allows mapping to native operating system features</span>
<span class="s">// supporting such multiplexing or using a pool of worker processing threads</span>
<span class="s">// much smaller in size than the total available connections.</span>
<span class="s">//</span>
<span class="s">// The general pattern for using selectors is:</span>
<span class="s">//</span>
<span class="s">//      while (true) {</span>
<span class="s">//         selector.select()</span>
<span class="s">//         def it = selector.selectedKeys().iterator()</span>
<span class="s">//         while (it.hasNext()) {</span>
<span class="s">//            handleKey(it++)</span>
<span class="s">//            it.remove()</span>
<span class="s">//         }</span>
<span class="s">//      }</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_7.14</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Groovy has no special support for this apart from making it easier to</span>
<span class="s">// create threads (see note at end); it relies on Java&#39;s features here.</span>

<span class="s">// InputStreams in Java/Groovy block if input is not yet available.</span>
<span class="s">// This is not normally an issue, because if you have a potential blocking</span>
<span class="s">// operation, e.g. save a large file, you normally just create a thread</span>
<span class="s"> // and save it in the background.</span>

<span class="s">// Channels are one way to do non-blocking stream-based IO.</span>
<span class="s">// Classes which implement the AbstractSelectableChannel interface provide</span>
<span class="s">// a configureBlocking(boolean) method as well as an isBlocking() method.</span>
<span class="s">// When processing a non-blocking stream, you need to process incoming</span>
<span class="s">// information based on the number of bytes read returned by the various</span>
<span class="s">// read methods. For non-blocking, this can be 0 bytes even if you pass</span>
<span class="s">// a fixed size byte[] buffer to the read method. Non-blocking IO is typically</span>
<span class="s">// not used with Files but more normally with network streams though they</span>
<span class="s">// can when Pipes (couple sink and source channels) are involved where</span>
<span class="s">// one side of the pipe is a file.</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_7.15</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Groovy uses Java&#39;s features here.</span>
<span class="s">// For both blocking and non-blocking reads, the read operation returns the number</span>
<span class="s">// of bytes read. In blocking operations, this normally corresponds to the number</span>
<span class="s">// of bytes requested (typically the size of some buffer) but can have a smaller</span>
<span class="s">// value at the end of a stream. Java also makes no guarantees about whether</span>
<span class="s">// other streams in general will return bytes as they become available under</span>
<span class="s">// certain circumstances (rather than blocking until the entire buffer is filled.</span>
<span class="s">// In non-blocking operations, the number of bytes returned will typically be</span>
<span class="s">// the number of bytes available (up to some maximum buffer or requested size).</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_7.16</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// This just works in Java and Groovy as per the previous examples.</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_7.17</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Groovy uses Java&#39;s features here.</span>
<span class="s">// More work has been done in the Java on object caching than file caching</span>
<span class="s">// with several open source and commercial offerings in that area. File caches</span>
<span class="s">// are also available, for one, see:</span>
<span class="s">// http://portals.apache.org/jetspeed-1/apidocs/org/apache/jetspeed/cache/FileCache.html</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_7.18</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// The general pattern is: streams.each{ stream -&gt; stream.println &#39;item to print&#39; }</span>
<span class="s">// See the MultiStream example in 13.5 for a coded example.</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_7.19</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// You wouldn&#39;t normally be dealing with FileDescriptors. In case were you have</span>
<span class="s">// one you would normally walk through all known FileStreams asking each for</span>
<span class="s">// it&#39;s FileDescriptor until you found one that matched. You would then close</span>
<span class="s">// that stream.</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_7.20</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// There are several concepts here. At the object level, any two object references</span>
<span class="s">// can point to the same object. Any changes made by one of these will be visible</span>
<span class="s">// in the &#39;alias&#39;. You can also have multiple stream, reader, writer or channel objects</span>
<span class="s">// referencing the same resource. Depending on the kind of resource, any potential</span>
<span class="s">// locks, the operations being requested and the behaviour of third-party programs,</span>
<span class="s">// the result of trying to perform such concurrent operations may not always be</span>
<span class="s">// deterministic. There are strategies for coping with such scenarious but the</span>
<span class="s">// best bet is to avoid the issue.</span>

<span class="s">// For the scenario given, copying file handles, that corresponds most closely</span>
<span class="s">// with cloning streams. The best bet is to just use individual stream objects</span>
<span class="s">// both created from the same file. If you are attempting to do write operations,</span>
<span class="s">// then you should consider using locks.</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_7.21</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// locking is built in to Java (since 1.4), so should not be missing</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_7.22</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Java locking supports locking just regions of files.</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.0</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">datafile = new File(&#39;Pleac/data/pleac8_0.txt&#39;) // change on your system</span>

<span class="s">datafile.eachLine{ line -&gt; print line.size() }</span>

<span class="s">lines = datafile.readLines()</span>

<span class="s">wholeTextFile = datafile.text</span>

<span class="s">// on command line Groovy use -a auto split pattern instead of record separator</span>
<span class="s">// default pattern is /\s/</span>
<span class="s">// groovy -a -e &#39;println &quot;First word is ${split[0][1]}&quot;&#39;</span>

<span class="s">// (additional examples to original cookbook to illustrate -a)</span>
<span class="s">// Print processes owned by root:</span>
<span class="s">// ps aux|groovy -ane &quot;if(split[0][1] =~ &#39;root&#39;)println split[0][10..-1]&quot;</span>

<span class="s">// Print all logins from /etc/passwd that are not commented:</span>
<span class="s">// groovy -a&#39;:&#39; -ne &quot;if(!(split[0][1] =~ /^#/))println split[0][1]&quot; /etc/passwd</span>

<span class="s">// Add the first and the penultimate column of a file:</span>
<span class="s">// groovy -ape &quot;split[0][1].toInteger()+split[0][-2].toInteger()&quot; accounts.txt</span>

<span class="s">// no BEGIN and END in Groovy (has been proposed, may be added soon)</span>

<span class="s">datafile.withOutputStream{ stream -&gt;</span>
<span class="s">    stream.print &quot;one&quot; + &quot;two&quot; + &quot;three&quot;    // &quot;onetwothree&quot; -&gt; file</span>
<span class="s">    println &quot;Baa baa black sheep.&quot;          // sent to $stdout</span>
<span class="s">}</span>

<span class="s">// use streams or channels for advanced file handling</span>
<span class="s">int size = datafile.size()</span>
<span class="s">buffer = ByteBuffer.allocate(size) // for large files, use some block size, e.g. 4096</span>
<span class="s">channel = new FileInputStream(datafile).channel</span>
<span class="s">println &quot;Number of bytes read was: ${channel.read(buffer)}&quot; // -1 = EOF</span>

<span class="s">channel = new FileOutputStream(File.createTempFile(&quot;pleac8&quot;, &quot;.junk&quot;)).channel</span>
<span class="s">size = channel.size()</span>
<span class="s">channel.truncate(size) // shrinks file (in our case to same size)</span>

<span class="s">pos = channel.position()</span>
<span class="s">println &quot;I&#39;m $pos bytes from the start of datafile&quot;</span>
<span class="s">channel.position(pos)  // move to pos (in our case unchanged)</span>
<span class="s">channel.position(0)    // move to start of file</span>
<span class="s">channel.position(size) // move to end of file</span>

<span class="s">// no sysread and syswrite are available but dataInput/output streams</span>
<span class="s">// can be used to achieve similar functionality, see 8.15.</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.1</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">testfile = new File(&#39;Pleac/data/pleac8_1.txt&#39;) // change on your system</span>
<span class="s">// contents of testfile:</span>
<span class="s">// DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) \</span>
<span class="s">//         $(TEXINFOS) $(INFOS) $(MANS) $(DATA)</span>
<span class="s">// DEP_DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) \</span>
<span class="s">//         $(TEXINFOS) $(INFO_DEPS) $(MANS) $(DATA) \</span>
<span class="s">//         $(EXTRA_DIST)</span>

<span class="s">lines = []</span>
<span class="s">continuing = false</span>
<span class="s">regex = /\\$/</span>
<span class="s">testfile.eachLine{ line -&gt;</span>
<span class="s">    stripped = line.replaceAll(regex,&#39;&#39;)</span>
<span class="s">    if (continuing) lines[-1] += stripped</span>
<span class="s">    else lines += stripped</span>
<span class="s">    continuing = (line =~ regex)</span>
<span class="s">}</span>
<span class="s">println lines.join(&#39;\n&#39;)</span>
<span class="s">// =&gt;</span>
<span class="s">// DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS)         $(TEXINFOS) $(INFOS) $(MANS) $(DATA)</span>
<span class="s">// DEP_DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS)         $(TEXINFOS) $(INFO_DEPS) $(MANS) $(DATA)         $(EXTRA_DIST)</span>

<span class="s">// to remove hidden spaces after the slash (but keep the slash):</span>
<span class="s">def trimtail(line) {</span>
<span class="s">    line = line.replaceAll(/(?&lt;=\\)\s*$/, &#39;&#39;)</span>
<span class="s">}</span>
<span class="s">b = /\\/  // backslash</span>
<span class="s">assert &quot;abc  $b&quot;   == trimtail(&quot;abc  $b&quot;)</span>
<span class="s">assert &quot;abc  &quot;     == trimtail(&quot;abc  &quot;)</span>
<span class="s">assert &quot;abc  $b&quot;   == trimtail(&quot;abc  $b  &quot;)</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.2</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// unixScript:</span>
<span class="s">println (&quot;wc -l &lt; $filename&quot;.execute().text)</span>

<span class="s">// for small files which fit in memory</span>
<span class="s">println testfile.readLines().size()</span>

<span class="s">// streaming approach (lines and paras)</span>
<span class="s">lines = 0; paras = 1</span>
<span class="s">testfile.eachLine{ lines++; if (it =~ /^$/) paras++ }</span>
<span class="s">println &quot;Found $lines lines and $paras paras.&quot;</span>
<span class="s">// note: counts blank line at end as start of next empty para</span>

<span class="s">// with a StreamTokenizer</span>
<span class="s">st = new StreamTokenizer(testfile.newReader())</span>
<span class="s">while (st.nextToken() != StreamTokenizer.TT_EOF) {}</span>
<span class="s">println st.lineno()</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.3</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// general pattern</span>
<span class="s">def processWordsInFile(file, processWord) {</span>
<span class="s">    testfile.splitEachLine(/\W+/) { matched -&gt;</span>
<span class="s">        matched.each{ w -&gt; if (w) processWord(w) }</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">testfile = new File(&#39;Pleac/src/pleac8.groovy&#39;)  // change path on your system</span>

<span class="s">// count words</span>
<span class="s">count = 0</span>
<span class="s">processWordsInFile(testfile){ count++ }</span>
<span class="s">println count</span>

<span class="s">// (variation to Perl example)</span>
<span class="s">// with a StreamTokenizer (counting words and numbers in Pleac chapter 8 source file)</span>
<span class="s">words = 0; numbers = 0</span>
<span class="s">st = new StreamTokenizer(testfile.newReader())</span>
<span class="s">st.slashSlashComments(true) // ignore words and numbers in comments</span>
<span class="s">while (st.nextToken() != StreamTokenizer.TT_EOF) {</span>
<span class="s">    if (st.ttype == StreamTokenizer.TT_WORD) words++</span>
<span class="s">    else if (st.ttype == StreamTokenizer.TT_NUMBER) numbers++</span>
<span class="s">}</span>
<span class="s">println &quot;Found $words words and $numbers numbers.&quot;</span>


<span class="s">// word frequency count</span>
<span class="s">seen = [:]</span>
<span class="s">processWordsInFile(testfile) {</span>
<span class="s">    w = it.toLowerCase()</span>
<span class="s">    if (seen.containsKey(w)) seen[w] += 1</span>
<span class="s">    else seen[w] = 1</span>
<span class="s">}</span>
<span class="s">// output map in a descending numeric sort of its values</span>
<span class="s">seen.entrySet().sort { a,b -&gt; b.value &lt;=&gt; a.value }.each{ e -&gt;</span>
<span class="s">    printf(&quot;%5d %s\n&quot;, [e.value, e.key] )</span>
<span class="s">}</span>
<span class="s">// =&gt;</span>
<span class="s">//    25 pleac</span>
<span class="s">//    22 line</span>
<span class="s">//    20 file</span>
<span class="s">//    19 println</span>
<span class="s">//    19 lines</span>
<span class="s">//    13 testfile</span>
<span class="s">//    ...</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.4</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">testfile.readLines().reverseEach{</span>
<span class="s">    println it</span>
<span class="s">}</span>

<span class="s">lines = testfile.readLines()</span>
<span class="s">// normally one would use the reverseEach, but you can use</span>
<span class="s">// a numerical index if you want</span>
<span class="s">((lines.size() - 1)..0).each{</span>
<span class="s">    println lines[it]</span>
<span class="s">}</span>

<span class="s">// Paragraph-based processing could be done as in 8.2.</span>

<span class="s">// A streaming-based solution could use random file access</span>
<span class="s">// and have a sliding buffer working from the back of the</span>
<span class="s">// file to the front.</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.5</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">logfile = new File(&#39;Pleac/data/sampleLog.txt&#39;)</span>
<span class="s">// logTailingScript:</span>
<span class="s">sampleInterval = 2000 // 2000 millis = 2 secs</span>
<span class="s">file = new RandomAccessFile( logfile, &quot;r&quot; )</span>
<span class="s">filePointer = 0 // set to logfile.size() to begin tailing from the end of the file</span>
<span class="s">while( true ) {</span>
<span class="s">    // Compare the length of the file to the file pointer</span>
<span class="s">    long fileLength = logfile.size()</span>
<span class="s">    if( fileLength &lt; filePointer ) {</span>
<span class="s">        // Log file must have been rotated or deleted;</span>
<span class="s">        System.err.println &quot;${new Date()}: Reopening $logfile&quot;</span>
<span class="s">        file = new RandomAccessFile( logfile, &quot;r&quot; )</span>
<span class="s">        filePointer = 0</span>
<span class="s">    }</span>
<span class="s">    if( fileLength &gt; filePointer ) {</span>
<span class="s">        // There is data to read</span>
<span class="s">        file.seek( filePointer )</span>
<span class="s">        while( (line = file.readLine()) != null ) {</span>
<span class="s">            println &#39;##&#39; + line</span>
<span class="s">        }</span>
<span class="s">        filePointer = file.filePointer</span>
<span class="s">    }</span>
<span class="s">    // Sleep for the specified interval</span>
<span class="s">    Thread.sleep( sampleInterval )</span>
<span class="s">}</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.6</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">//testfile = newFile(&#39;/usr/share/fortune/humorists&#39;)</span>

<span class="s">// small files:</span>
<span class="s">random = new Random()</span>
<span class="s">lines = testfile.readLines()</span>
<span class="s">println lines[random.nextInt(lines.size())]</span>

<span class="s">// streamed alternative</span>
<span class="s">count = 0</span>
<span class="s">def adage</span>
<span class="s">testfile.eachLine{ line -&gt;</span>
<span class="s">    count++</span>
<span class="s">    if (random.nextInt(count) &lt; 1) adage = line</span>
<span class="s">}</span>
<span class="s">println adage</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.7</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// non-streamed solution (like Perl and Ruby)</span>
<span class="s">lines = testfile.readLines()</span>
<span class="s">Collections.shuffle(lines)</span>
<span class="s">println lines.join(&#39;\n&#39;)</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.8</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">desiredLine = 235</span>
<span class="s">// for small files</span>
<span class="s">lines = testfile.readLines()</span>
<span class="s">println &quot;Line $desiredLine: ${lines[desiredLine-1]}&quot;</span>

<span class="s">// streaming solution</span>
<span class="s">reader = testfile.newReader()</span>
<span class="s">count = 0</span>
<span class="s">def line</span>
<span class="s">while ((line = reader.readLine())!= null) {</span>
<span class="s">    if (++count == desiredLine) break</span>
<span class="s">}</span>
<span class="s">println &quot;Line $desiredLine: $line&quot;</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.9</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">println testfile.text.split(/@@pleac@@_8./i).size()</span>
<span class="s">// =&gt; 23 (21 sections .0 .. .20 plus before .0 plus line above)</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.10</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">file = new RandomAccessFile( logfile, &quot;rw&quot; )</span>
<span class="s">long previous, lastpos = 0</span>
<span class="s">while( (line = file.readLine()) != null ) {</span>
<span class="s">    previous = lastpos</span>
<span class="s">    lastpos = file.filePointer</span>
<span class="s">}</span>
<span class="s">if (previous) file.setLength(previous)</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.11</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Java&#39;s streams are binary at the lowest level if not processed with</span>
<span class="s">// higher level stream mechanisms or readers/writers. Some additions</span>
<span class="s">// to the Perl cookbook which illustrate the basics.</span>

<span class="s">// Print first ten bytes of a binary file:</span>
<span class="s">def dumpStart(filename) {</span>
<span class="s">    bytes = new File(filename).newInputStream()</span>
<span class="s">    10.times{</span>
<span class="s">        print bytes.read() + &#39; &#39;</span>
<span class="s">    }</span>
<span class="s">    println()</span>
<span class="s">}</span>
<span class="s">dumpStart(System.getProperty(&#39;java.home&#39;)+&#39;/lib/rt.jar&#39;)</span>
<span class="s">// =&gt; 80 75 3 4 10 0 0 0 0 0 (note first two bytes = PK - you might recognize this</span>
<span class="s">// as the starting sequence of a zip file)</span>
<span class="s">dumpStart(&#39;Pleac/classes/pleac8.class&#39;) // after running groovyc compiler in src directory</span>
<span class="s">// =&gt; 202 254 186 190 0 0 0 47 2 20 (starting bytes in HEX: CAFEBABE)</span>

<span class="s">binfile = new File(&#39;Pleac/data/temp.bin&#39;)</span>
<span class="s">binfile.withOutputStream{ stream -&gt; (0..&lt;20).each{ stream.write(it) }}</span>
<span class="s">binfile.eachByte{ print it + &#39; &#39; }; println()</span>
<span class="s">// =&gt; 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.12</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// lets treat binfile as having 5 records of size 4, let&#39;s print out the 3rd record</span>
<span class="s">recsize = 4</span>
<span class="s">recno = 2 // index starts at 0</span>
<span class="s">address = recsize * recno</span>
<span class="s">randomaccess = new RandomAccessFile(binfile, &#39;r&#39;)</span>
<span class="s">randomaccess.seek(address)</span>
<span class="s">recsize.times{ print randomaccess.read() + &#39; &#39; }; println()  // =&gt; 8 9 10 11</span>
<span class="s">randomaccess.close()</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.13</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// let&#39;s take the example from 8.12 but replace the 3rd record with</span>
<span class="s">// 90 - the original value in the file</span>
<span class="s">// this is an alternative example to the Perl cookbook which is cross platform</span>
<span class="s">// see chapter 1 regarding un/pack which could be combined with below</span>
<span class="s">// to achieve the full functionality of the original 8.13</span>
<span class="s">recsize = 4</span>
<span class="s">recno = 2 // index starts at 0</span>
<span class="s">address = recsize * recno</span>
<span class="s">randomaccess = new RandomAccessFile(binfile, &#39;rw&#39;)</span>
<span class="s">randomaccess.seek(address)</span>
<span class="s">bytes = []</span>
<span class="s">recsize.times{ bytes += randomaccess.read() }</span>
<span class="s">randomaccess.seek(address)</span>
<span class="s">bytes.each{ b -&gt; randomaccess.write(90 - b) }</span>
<span class="s">randomaccess.close()</span>
<span class="s">binfile.eachByte{ print it + &#39; &#39; }; println()</span>
<span class="s">// =&gt; 0 1 2 3 4 5 6 7 82 81 80 79 12 13 14 15 16 17 18 19</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.14</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// reading a String would involve looping and collecting the read bytes</span>

<span class="s">// simple bgets</span>
<span class="s">// this is similar to the revised 8.13 but would look for the terminating 0</span>

<span class="s">// simplistic strings functionality</span>
<span class="s">binfile.eachByte{ b -&gt; if ((int)b in 32..126) print ((char)b) }; println() // =&gt; RQPO</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.15</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// You could combine the byte-level reading/writing mechanisms shown</span>
<span class="s">// in 8.11 - 8.12 and combine that with the un/pack functionality from</span>
<span class="s">// Chapter 1 to achieve the desired functionality. A more Java and Groovy</span>
<span class="s">// friendly way to do this would be to use the Scattering and Gathering</span>
<span class="s">// stream operations of channels for byte-oriented record fields or</span>
<span class="s">// data-oriented records. Alternatively, the dataInput/output stream</span>
<span class="s">// capabilities for data-oriented records. Finally, the</span>
<span class="s">// objectInput/output stream capabilities could be used for object types.</span>
<span class="s">// Note, these examples mix reading and writing even though the original</span>
<span class="s">// Perl example was just about reading.</span>


<span class="s">// fixed-length byte-oriented records using channels</span>
<span class="s">// typical approach used with low-level protocols or file formats</span>
<span class="s">import java.nio.*</span>
<span class="s">binfile.delete(); binfile.createNewFile() // start from scratch</span>
<span class="s">buf1 = ByteBuffer.wrap([10,11,12,13] as byte[]) // simulate 4 byte field</span>
<span class="s">buf2 = ByteBuffer.wrap([44,45] as byte[])       // 2 byte field</span>
<span class="s">buf3 = ByteBuffer.wrap(&#39;Hello&#39;.bytes)           // String</span>
<span class="s">records = [buf1, buf2, buf3] as ByteBuffer[]</span>
<span class="s">channel = new FileOutputStream(binfile).channel</span>
<span class="s">channel.write(records) // gathering byte records</span>
<span class="s">channel.close()</span>
<span class="s">binfile.eachByte{ print it + &#39; &#39; }; println()</span>
<span class="s">// =&gt; 10 11 12 13 44 45 72 101 108 108 111</span>
<span class="s">// ScatteringInputStream would convert this back into an array of byte[]</span>


<span class="s">// data-oriented streams using channels</span>
<span class="s">binfile.delete(); binfile.createNewFile() // start from scratch</span>
<span class="s">buf = ByteBuffer.allocate(24)</span>
<span class="s">now = System.currentTimeMillis()</span>
<span class="s">buf.put(&#39;PI=&#39;.bytes).putDouble(Math.PI).put(&#39;Date=&#39;.bytes).putLong(now)</span>
<span class="s">buf.flip() // readies for writing: set length and point back to start</span>
<span class="s">channel = new FileOutputStream(binfile).channel</span>
<span class="s">channel.write(buf)</span>
<span class="s">channel.close()</span>
<span class="s">// now read it back in</span>
<span class="s">channel = new FileInputStream(binfile).channel</span>
<span class="s">buf = ByteBuffer.allocate(24)</span>
<span class="s">channel.read(buf)</span>
<span class="s">buf.flip()</span>
<span class="s">3.times{ print ((char)buf.get()) }</span>
<span class="s">println (buf.getDouble())</span>
<span class="s">5.times{ print ((char)buf.get()) }</span>
<span class="s">println (new Date(buf.getLong()))</span>
<span class="s">channel.close()</span>
<span class="s">// =&gt;</span>
<span class="s">// PI=3.141592653589793</span>
<span class="s">// Date=Sat Jan 13 00:14:50 EST 2007</span>

<span class="s">// object-oriented streams</span>
<span class="s">binfile.delete(); binfile.createNewFile() // start from scratch</span>
<span class="s">class Person implements Serializable { def name, age }</span>
<span class="s">binfile.withObjectOutputStream{ oos -&gt;</span>
<span class="s">    oos.writeObject(new Person(name:&#39;Bernie&#39;,age:16))</span>
<span class="s">    oos.writeObject([1:&#39;a&#39;, 2:&#39;b&#39;])</span>
<span class="s">    oos.writeObject(new Date())</span>
<span class="s">}</span>
<span class="s">// now read it back in</span>
<span class="s">binfile.withObjectInputStream{ ois -&gt;</span>
<span class="s">    person = ois.readObject()</span>
<span class="s">    println &quot;$person.name is $person.age&quot;</span>
<span class="s">    println ois.readObject()</span>
<span class="s">    println ois.readObject()</span>
<span class="s">}</span>
<span class="s">// =&gt;</span>
<span class="s">// Bernie is 16</span>
<span class="s">// [1:&quot;a&quot;, 2:&quot;b&quot;]</span>
<span class="s">// Sat Jan 13 00:22:13 EST 2007</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.16</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// use built-in Java property class</span>
<span class="s">// suppose you have the following file:</span>
<span class="s">// # set your database settings here</span>
<span class="s">// server=localhost</span>
<span class="s">// url=jdbc:derby:derbyDB;create=true</span>
<span class="s">// user.name=me</span>
<span class="s">// user.password=secret</span>
<span class="s">props = new Properties()</span>
<span class="s">propsfile=new File(&#39;Pleac/data/plain.properties&#39;)</span>
<span class="s">props.load(propsfile.newInputStream())</span>
<span class="s">props.list(System.out)</span>
<span class="s">// =&gt;</span>
<span class="s">// -- listing properties --</span>
<span class="s">// user.name=me</span>
<span class="s">// user.password=secret</span>
<span class="s">// url=jdbc:derby:derbyDB;create=true</span>
<span class="s">// server=localhost</span>

<span class="s">// There are also provisions for writing properties file.</span>

<span class="s">// (additional example to Perl)</span>
<span class="s">// You can also read and write xml properties files.</span>
<span class="s">new File(&#39;Pleac/data/props.xml&#39;).withOutputStream{ os -&gt;</span>
<span class="s">    props.storeToXML(os, &quot;Database Settings&quot;)</span>
<span class="s">}</span>
<span class="s">// =&gt;</span>
<span class="s">// &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="s">// &lt;!DOCTYPE properties SYSTEM &quot;http://java.sun.com/dtd/properties.dtd&quot;&gt;</span>
<span class="s">// &lt;properties&gt;</span>
<span class="s">// &lt;comment&gt;Database Settings&lt;/comment&gt;</span>
<span class="s">// &lt;entry key=&quot;user.password&quot;&gt;secret&lt;/entry&gt;</span>
<span class="s">// &lt;entry key=&quot;user.name&quot;&gt;me&lt;/entry&gt;</span>
<span class="s">// &lt;entry key=&quot;url&quot;&gt;jdbc:derby:derbyDB;create=true&lt;/entry&gt;</span>
<span class="s">// &lt;entry key=&quot;server&quot;&gt;localhost&lt;/entry&gt;</span>
<span class="s">// &lt;/properties&gt;</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.17</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// The File class provides canRead(), canWrite() and canExecute() (JDK6) methods</span>
<span class="s">// for finding out about security information specific to the user. JSR 203</span>
<span class="s">// (expected in Java 7) provides access to additional security related attributes.</span>

<span class="s">// Another useful package to use when wondering about the trustworthiness of a</span>
<span class="s">// file is the java.security package. It contains many classes. Just one is</span>
<span class="s">// MessageDigest. This would allow you to create a strong checksum of a file.</span>
<span class="s">// Your program could refuse to operate if a file it was accessing didn&#39;t have the</span>
<span class="s">// checksum it was expecting - an indication that it may have been tampered with.</span>

<span class="s">// (additional info)</span>
<span class="s">// While getting file-based security permissions correct is important, it isn&#39;t the</span>
<span class="s">// only mechanism to use for security when using Java based systems. Java provides</span>
<span class="s">// policy files and an authorization and authentication API which lets you secure</span>
<span class="s">// any reources (not just files) at various levels of granularity with various</span>
<span class="s">// security mechanisms.</span>
<span class="s">// Security policies may be universal, apply to a particular codebase, or</span>
<span class="s">// using JAAS apply to individuals. Some indicative policy statements:</span>
<span class="s">// grant {</span>
<span class="s">//     permission java.net.SocketPermission &quot;*&quot;, &quot;connect&quot;;</span>
<span class="s">//     permission java.io.FilePermission &quot;C:\\users\\cathy\\foo.bat&quot;, &quot;read&quot;;</span>
<span class="s">// };</span>
<span class="s">// grant codebase &quot;file:./*&quot;, Principal ExamplePrincipal &quot;Secret&quot; {</span>
<span class="s">//     permission java.io.FilePermission &quot;dummy.txt&quot;, &quot;read&quot;;</span>
<span class="s">// };</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.18</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// general purpose utility methods</span>
<span class="s">def getString(buf,size){</span>
<span class="s">    // consider get(buf[]) instead of get(buf) for efficiency</span>
<span class="s">    b=[]; size.times{b+=buf.get()}; new String(b as byte[]).trim()</span>
<span class="s">}</span>
<span class="s">def getInt(buf,size) {</span>
<span class="s">    // normally in Java we would just use methods like getLong()</span>
<span class="s">    // to read a long but wish to ignore platform issues here</span>
<span class="s">    long val = 0</span>
<span class="s">    for (n in 0..&lt;size) { val += ((int)buf.get() &amp; 0xFF) &lt;&lt; (n * 8) }</span>
<span class="s">    return val</span>
<span class="s">}</span>
<span class="s">def getDate(buf) {</span>
<span class="s">    return new Date(getInt(buf,4) * 1000) // Java uses millis</span>
<span class="s">}</span>

<span class="s">// specific utility method (wtmp file from ubuntu 6.10)</span>
<span class="s">def processWtmpRecords(file, origpos) {</span>
<span class="s">    channel = new RandomAccessFile(file, &#39;r&#39;).channel</span>
<span class="s">    recsize = 4 + 4 + 32 + 4 + 32 + 256 + 8 + 4 + 40</span>
<span class="s">    channel.position(origpos)</span>
<span class="s">    newpos = origpos</span>
<span class="s">    buf = ByteBuffer.allocate(recsize)</span>
<span class="s">    while ((count = channel.read(buf)) != -1) {</span>
<span class="s">        if (count != recsize) break</span>
<span class="s">        buf.flip()</span>
<span class="s">        print getInt(buf,4) + &#39; &#39;         // type</span>
<span class="s">        print getInt(buf,4) + &#39; &#39;         // pid</span>
<span class="s">        print getString(buf,32) + &#39; &#39;     // line</span>
<span class="s">        print getString(buf,4) + &#39; &#39;      // inittab</span>
<span class="s">        print getString(buf,32) + &#39; &#39;     // user</span>
<span class="s">        print getString(buf,256) + &#39; &#39;    // hostname</span>
<span class="s">        buf.position(buf.position() + 8)  // skip</span>
<span class="s">        println &quot;${getDate(buf)} &quot;        // time</span>
<span class="s">        buf.clear()</span>
<span class="s">        newpos = channel.position()</span>
<span class="s">    }</span>
<span class="s">    return newpos</span>
<span class="s">}</span>

<span class="s">wtmp = new File(&#39;Pleac/data/wtmp&#39;)</span>
<span class="s">// wtmpTailingScript:</span>
<span class="s">sampleInterval = 2000 // 2000 millis = 2 secs</span>
<span class="s">filePointer = wtmp.size() // begin tailing from the end of the file</span>
<span class="s">while(true) {</span>
<span class="s">    // Compare the length of the file to the file pointer</span>
<span class="s">    long fileLength = wtmp.size()</span>
<span class="s">    if( fileLength &gt; filePointer ) {</span>
<span class="s">        // There is data to read</span>
<span class="s">        filePointer = processWtmpRecords(wtmp, filePointer)</span>
<span class="s">    }</span>
<span class="s">    // Sleep for the specified interval</span>
<span class="s">    Thread.sleep( sampleInterval )</span>
<span class="s">}</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.19</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// contains most of the functionality of the original (not guaranteed to be perfect)</span>
<span class="s">// -i ignores errors, e.g. if one target is write protected, the others will work</span>
<span class="s">// -u writes files in unbuffered mode (ignore for &#39;|&#39;)</span>
<span class="s">// -n not to stdout</span>
<span class="s">// -a all files are in append mode</span>
<span class="s">// &#39;&gt;&gt;file1&#39; turn on append for individual file</span>
<span class="s">// &#39;|wc&#39; or &#39;|grep x&#39; etc sends output to forked process (only one at any time)</span>
<span class="s">class MultiStream {</span>
<span class="s">    private targets</span>
<span class="s">    private ignoreErrors</span>
<span class="s">    MultiStream(List targets, ignore) {</span>
<span class="s">        this.targets = targets</span>
<span class="s">        ignoreErrors = ignore</span>
<span class="s">    }</span>
<span class="s">    def println(String content) {</span>
<span class="s">        targets.each{</span>
<span class="s">            try {</span>
<span class="s">                it?.write(content.bytes)</span>
<span class="s">            } catch (Exception ex) {</span>
<span class="s">                if (!ignoreErrors) throw ex</span>
<span class="s">                targets -= it</span>
<span class="s">                it?.close()</span>
<span class="s">            }</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">    def close() { targets.each{ it?.close() } }</span>
<span class="s">}</span>

<span class="s">class TeeTarget {</span>
<span class="s">    private filename</span>
<span class="s">    private stream</span>
<span class="s">    private p</span>

<span class="s">    TeeTarget(String name, append, buffered, ignore) {</span>
<span class="s">        if (name.startsWith(&#39;&gt;&gt;&#39;)) {</span>
<span class="s">            createFileStream(name[2..-1],true,buffered,ignore)</span>
<span class="s">        } else if (name.startsWith(&#39;|&#39;)) {</span>
<span class="s">            createProcessReader(name[1..-1])</span>
<span class="s">        } else {</span>
<span class="s">            createFileStream(name,append,buffered,ignore)</span>
<span class="s">        }</span>
<span class="s">    }</span>

<span class="s">    TeeTarget(OutputStream stream) { this.stream = stream }</span>

<span class="s">    def write(bytes) { stream?.write(bytes) }</span>
<span class="s">    def close() { stream?.close() }</span>

<span class="s">    private createFileStream(name, append, buffered, ignore) {</span>
<span class="s">        filename = name</span>
<span class="s">        def fos</span>
<span class="s">        try {</span>
<span class="s">            fos = new FileOutputStream(name, append)</span>
<span class="s">        } catch (Exception ex) {</span>
<span class="s">            if (ignore) return</span>
<span class="s">        }</span>
<span class="s">        if (!buffered) stream = fos</span>
<span class="s">        else stream = new BufferedOutputStream(fos)</span>
<span class="s">    }</span>
<span class="s">    private createWriter(os) {new PrintWriter(new BufferedOutputStream(os))}</span>
<span class="s">    private createReader(is) {new BufferedReader(new InputStreamReader(is))}</span>
<span class="s">    private createPiperThread(br, pw) {</span>
<span class="s">        Thread.start{</span>
<span class="s">            def next</span>
<span class="s">            while((next = br.readLine())!=null) {</span>
<span class="s">                pw.println(next)</span>
<span class="s">            }</span>
<span class="s">            pw.flush(); pw.close()</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">    private createProcessReader(name) {</span>
<span class="s">        def readFromStream = new PipedInputStream()</span>
<span class="s">        def r1 = createReader(readFromStream)</span>
<span class="s">        stream = new BufferedOutputStream(new PipedOutputStream(readFromStream))</span>
<span class="s">        p = Runtime.runtime.exec(name)</span>
<span class="s">        def w1 = createWriter(p.outputStream)</span>
<span class="s">        createPiperThread(r1, w1)</span>
<span class="s">        def w2 = createWriter(System.out)</span>
<span class="s">        def r2 = createReader(p.inputStream)</span>
<span class="s">        createPiperThread(r2, w2)</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">targets = []</span>
<span class="s">append = false; ignore = false; includeStdout = true; buffer = true</span>
<span class="s">(0..&lt;args.size()).each{</span>
<span class="s">    arg = args[it]</span>
<span class="s">    if (arg.startsWith(&#39;-&#39;)) {</span>
<span class="s">        switch (arg) {</span>
<span class="s">            case &#39;-a&#39;: append = true; break</span>
<span class="s">            case &#39;-i&#39;: ignore = true; break</span>
<span class="s">            case &#39;-n&#39;: includeStdout = false; break</span>
<span class="s">            case &#39;-u&#39;: buffer = false; break</span>
<span class="s">            default:</span>
<span class="s">                println &quot;usage: tee [-ainu] [filenames] ...&quot;</span>
<span class="s">                System.exit(1)</span>
<span class="s">        }</span>
<span class="s">    } else targets += arg</span>
<span class="s">}</span>
<span class="s">targets = targets.collect{ new TeeTarget(it, append, buffer, ignore) }</span>
<span class="s">if (includeStdout) targets += new TeeTarget(System.out)</span>
<span class="s">def tee = new MultiStream(targets, ignore)</span>
<span class="s">while (line = System.in.readLine()) {</span>
<span class="s">    tee.println(line)</span>
<span class="s">}</span>
<span class="s">tee.close()</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_8.20</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// most of the functionality - uses an explicit uid - ran on ubuntu 6.10 on intel</span>
<span class="s">lastlog = new File(&#39;Pleac/data/lastlog&#39;)</span>
<span class="s">channel = new RandomAccessFile(lastlog, &#39;r&#39;).channel</span>
<span class="s">uid = 1000</span>
<span class="s">recsize = 4 + 32 + 256</span>
<span class="s">channel.position(uid * recsize)</span>
<span class="s">buf = ByteBuffer.allocate(recsize)</span>
<span class="s">channel.read(buf)</span>
<span class="s">buf.flip()</span>
<span class="s">date = getDate(buf)</span>
<span class="s">line = getString(buf,32)</span>
<span class="s">host = getString(buf,256)</span>
<span class="s">println &quot;User with uid $uid last logged on $date from ${host?host:&#39;unknown&#39;} on $line&quot;</span>
<span class="s">// =&gt; User with uid 1000 last logged on Sat Jan 13 09:09:35 EST 2007 from unknown on :0</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_9.0</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Groovy builds on Java&#39;s file and io classes which provide an operating</span>
<span class="s">// system independent abstraction of a file system. The actual File class</span>
<span class="s">// is the main class of interest. It represents a potential file or</span>
<span class="s">// directory - which may or may not (yet) exist. In versions of Java up to</span>
<span class="s">// and including Java 6, the File class was missing some of the functionality</span>
<span class="s">// required to implement some of the examples in the Chapter (workarounds</span>
<span class="s">// and alternatives are noted below). In Java 7, (also known as &quot;Dolphin&quot;)</span>
<span class="s">// new File abstraction facilities are being worked on but haven&#39;t yet been</span>
<span class="s">// publically released. These new features are known as JSR 203 and are</span>
<span class="s">// referred to when relevant to some of the examples. Thanks to Alan Bateman</span>
<span class="s">// from Sun for clarification regarding various aspects of JSR 203. Apologies</span>
<span class="s">// if I misunderstood any aspects relayed to me and also usual disclaimers</span>
<span class="s">// apply regarding features which may change or be dropped before release.</span>

<span class="s">// path=&#39;/usr/bin&#39;; file=&#39;vi&#39; // linux/mac os?</span>
<span class="s">path=&#39;C:/windows&#39;; file=&#39;explorer.exe&#39; // windows</span>
<span class="s">entry = new File(&quot;$path&quot;)</span>
<span class="s">assert entry.isDirectory()</span>
<span class="s">entry = new File(&quot;$path/$</span><span class="n">file</span><span class="s2">&quot;)</span>
<span class="s2">assert entry.isFile()</span>

<span class="s2">println File.separator</span>
<span class="s2">// =&gt; \ (on Windows)</span>
<span class="s2">// =&gt; / (on Unix)</span>
<span class="s2">// however if you just stick to backslashes Java converts for you</span>
<span class="s2">// in most situations</span>

<span class="s2">// File modification time (no exact equivalent of ctime - but you can</span>
<span class="s2">// call stat() using JNI or use exec() of dir or ls to get this kind of info)</span>
<span class="s2">// JSR 203 also plans to provide such info in Java 7.</span>
<span class="s2">println new Date(entry.lastModified())</span>
<span class="s2">// =&gt; Wed Aug 04 07:00:00 EST 2004</span>

<span class="s2">// file size</span>
<span class="s2">println entry.size()</span>
<span class="s2">// =&gt; 1032192</span>

<span class="s2">// check if we have permission to read the file</span>
<span class="s2">assert entry.canRead()</span>

<span class="s2">// check if file is binary or text?</span>
<span class="s2">// There is no functionality for this at the file level.</span>
<span class="s2">// Java has the Java Activation Framework (jaf) which is used to</span>
<span class="s2">// associate files (and streams) with MIME Types and subsequently</span>
<span class="s2">// binary data streams or character encodings for (potentially</span>
<span class="s2">// multilanguage) text files. JSR-203 provides a method to determine</span>
<span class="s2">// the MIME type of a file. Depending on the platform the file type may</span>
<span class="s2">// be determined based on a file attribute, file name &quot;</span><span class="n">extension</span><span class="s2">&quot;, the</span>
<span class="s2">// bytes of the files (byte sniffing) or other means. It is service</span>
<span class="s2">// provider based so developers can plug in their own file type detection</span>
<span class="s2">// mechanisms as required. &quot;</span><span class="n">Out</span> <span class="n">of</span> <span class="n">the</span> <span class="n">box</span><span class="s2">&quot; it will ship with file type</span>
<span class="s2">// detectors that are appropriate for the platform (integrates with GNOME,</span>
<span class="s2">// Windows registry, etc.).</span>

<span class="s2">// Groovy uses File for directories and files</span>
<span class="s2">// displayAllFilesInUsrBin:</span>
<span class="s2">new File(&#39;/usr/bin&#39;).eachFile{ file -&gt;</span>
<span class="s2">  println &quot;</span><span class="n">Inside</span> <span class="s">/usr/</span><span class="n">bin</span> <span class="n">is</span> <span class="n">something</span> <span class="n">called</span> <span class="n">$file</span><span class="o">.</span><span class="na">name</span><span class="s2">&quot;</span>
<span class="s2">}</span>
<span class="s2">//----------------------------------------------------------------------------------</span>

<span class="s2">// @@PLEAC@@_9.1</span>
<span class="s2">//----------------------------------------------------------------------------------</span>
<span class="s2">file = new File(&quot;</span><span class="n">filename</span><span class="s2">&quot;)</span>
<span class="s2">file &lt;&lt; &#39;hi&#39;</span>
<span class="s2">timeModified = file.lastModified()</span>
<span class="s2">println new Date(timeModified)</span>
<span class="s2">// =&gt; Sun Jan 07 11:49:02 EST 2007</span>

<span class="s2">MILLIS_PER_WEEK = 60 * 60 * 24 * 1000 * 7</span>
<span class="s2">file.setLastModified(timeModified - MILLIS_PER_WEEK)</span>
<span class="s2">println new Date(file.lastModified())</span>
<span class="s2">// =&gt; Sun Dec 31 11:49:02 EST 2006</span>

<span class="s2">// Java currently doesn&#39;t provide access to other timestamps but</span>
<span class="s2">// there are things that can be done:</span>
<span class="s2">// (1) You can use JNI to call to C, e.g. stat()</span>
<span class="s2">// (2) Use exec() and call another program, e.g. dir, ls, ... to get the value you are after</span>
<span class="s2">// (3) Here is a Windows specific patch to get lastAccessedTime and creationTime</span>
<span class="s2">//     http://forum.java.sun.com/thread.jspa?forumID=31&amp;start=0&amp;threadID=409921&amp;range=100#1800193</span>
<span class="s2">// (4) There is an informal patch for Java 5/6 which gives lastAccessedTime on Windows and Linux</span>
<span class="s2">//     and creationTime on windows:</span>
<span class="s2">//     http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6314708</span>
<span class="s2">// (5) JSR 203 (currently targetted for Java 7) aims to provide</span>
<span class="s2">//     &quot;</span><span class="n">bulk</span> <span class="n">access</span> <span class="n">to</span> <span class="n">file</span> <span class="n">attributes</span><span class="o">,</span> <span class="n">change</span> <span class="n">notification</span><span class="o">,</span> <span class="n">escape</span> <span class="n">to</span> <span class="n">filesystem</span><span class="o">-</span><span class="n">specific</span> <span class="n">APIs</span><span class="s2">&quot;</span>
<span class="s2">//     this is supposed to include creationTime and lastAccessedTime along with many</span>
<span class="s2">//     security-related file attributes</span>

<span class="s2">// viFileWithoutChangingModificationTimeScript:</span>
<span class="s2">#!/usr/bin/groovy</span>
<span class="s2">// uvi - vi a file without changing it&#39;s last modified time</span>
<span class="s2">if (args.size() != 1)</span>
<span class="s2">  println &quot;</span><span class="nl">usage:</span> <span class="n">uvi</span> <span class="n">filename</span><span class="s2">&quot;</span>
<span class="s2">  System.exit(1)</span>
<span class="s2">}</span>
<span class="s2">file = args[0]</span>
<span class="s2">origTime = new File(file).lastModified()</span>
<span class="s2">&quot;</span><span class="n">vi</span> <span class="n">$file</span><span class="s2">&quot;.execute()</span>
<span class="s2">new File(file).setLastModified(origTime)</span>
<span class="s2">//----------------------------------------------------------------------------------</span>

<span class="s2">// @@PLEAC@@_9.2</span>
<span class="s2">//----------------------------------------------------------------------------------</span>
<span class="s2">println new File(&#39;/doesnotexist&#39;).exists()  // =&gt; false</span>
<span class="s2">println new File(&#39;/doesnotexist&#39;).delete()  // =&gt; false</span>

<span class="s2">new File(&#39;/createme&#39;) &lt;&lt; &#39;Hi there&#39;</span>
<span class="s2">println new File(&#39;/createme&#39;).exists()  // =&gt; true</span>
<span class="s2">println new File(&#39;/createme&#39;).delete()  // =&gt; true</span>

<span class="s2">names = [&#39;file1&#39;,&#39;file2&#39;,&#39;file3&#39;]</span>
<span class="s2">files = names.collect{ new File(it) }</span>
<span class="s2">// create 2 of the files</span>
<span class="s2">files[0..1].each{ f -&gt; f &lt;&lt; f.name }</span>

<span class="s2">def deleteFiles(files) {</span>
<span class="s2">    def problemFileNames = []</span>
<span class="s2">    files.each{ f -&gt;</span>
<span class="s2">        if (!f.delete())</span>
<span class="s2">            problemFileNames += f.name</span>
<span class="s2">    }</span>
<span class="s2">    def delCnt = files.size() - problemFileNames.size()</span>
<span class="s2">    println &quot;</span><span class="n">Successfully</span> <span class="n">deleted</span> <span class="n">$delCnt</span> <span class="n">of</span> <span class="n">$</span><span class="o">{</span><span class="n">files</span><span class="o">.</span><span class="na">size</span><span class="o">()}</span> <span class="n">file</span><span class="o">(</span><span class="n">s</span><span class="o">)</span><span class="s2">&quot;</span>
<span class="s2">    if (problemFileNames)</span>
<span class="s2">        println &quot;</span><span class="n">Problems</span> <span class="n">file</span><span class="o">(</span><span class="n">s</span><span class="o">):</span> <span class="s2">&quot; + problemFileNames.join(&#39;, &#39;)</span>
<span class="s2">}</span>

<span class="s2">deleteFiles(files)</span>
<span class="s2">// =&gt;</span>
<span class="s2">// Successfully deleted 2 of 3 file(s)</span>
<span class="s2">// Problems file(s): file3</span>

<span class="s2">// we can also set files for deletion on exit</span>
<span class="s2">tempFile = new File(&#39;/xxx&#39;)</span>
<span class="s2">assert !tempFile.exists()</span>
<span class="s2">tempFile &lt;&lt; &#39;junk&#39;</span>
<span class="s2">assert tempFile.exists()</span>
<span class="s2">tempFile.deleteOnExit()</span>
<span class="s2">assert tempFile.exists()</span>
<span class="s2">// To confirm this is working, run these steps multiple times in a row.</span>

<span class="s2">// Discussion:</span>
<span class="s2">// Be careful with deleteOnExit() as there is no way to cancel it.</span>
<span class="s2">// There are also mechanisms specifically for creating unqiuely named temp files.</span>
<span class="s2">// On completion of JSR 203, there will be additional methods available for</span>
<span class="s2">// deleting which throw exceptions with detailed error messages rather than</span>
<span class="s2">// just return booleans.</span>
<span class="s2">//----------------------------------------------------------------------------------</span>

<span class="s2">// @@PLEAC@@_9.3</span>
<span class="s2">//----------------------------------------------------------------------------------</span>
<span class="s2">// (1) Copy examples</span>

<span class="s2">//shared setup</span>
<span class="s2">dummyContent = &#39;some content&#39; + System.getProperty(&#39;line.separator&#39;)</span>
<span class="s2">setUpFromFile()</span>
<span class="s2">setUpToFile()</span>

<span class="s2">// built-in copy via memory (text files only)</span>
<span class="s2">to &lt;&lt; from.text</span>
<span class="s2">checkSuccessfulCopyAndDelete()</span>

<span class="s2">// built-in as a stream (text or binary) with optional encoding</span>
<span class="s2">to &lt;&lt; from.asWritable(&#39;US-ASCII&#39;)</span>
<span class="s2">checkSuccessfulCopyAndDelete()</span>

<span class="s2">// built-in using AntBuilder</span>
<span class="s2">// for options, see: http://ant.apache.org/manual/CoreTasks/copy.html</span>
<span class="s2">new AntBuilder().copy( file: from.canonicalPath, tofile: to.canonicalPath )</span>
<span class="s2">checkSuccessfulCopyAndDelete()</span>
<span class="s2">// =&gt;</span>
<span class="s2">//     [copy] Copying 1 file to D:\</span>


<span class="s2">// use Apache Jakarta Commons IO (jakarta.apache.org)</span>
<span class="s2">import org.apache.commons.io.FileUtils</span>
<span class="s2">// Copies a file to a new location preserving the lastModified date.</span>
<span class="s2">FileUtils.copyFile(from, to)</span>
<span class="s2">checkSuccessfulCopyAndDelete()</span>

<span class="s2">// using execute()</span>
<span class="s2">// &quot;</span><span class="n">cp</span> <span class="n">$from</span><span class="o">.</span><span class="na">canonicalPath</span> <span class="n">$to</span><span class="o">.</span><span class="na">canonicalPath</span><span class="s2">&quot;.execute()      // unix</span>
<span class="s2">println &quot;</span><span class="n">cmd</span> <span class="s">/c \&quot;copy $from.canonicalPath $to.canonicalPath\&quot;&quot;.execute().text    // dos vms</span>
<span class="s">checkSuccessfulCopyAndDelete()</span>
<span class="s">// =&gt;</span>
<span class="s">//        1 file(s) copied.</span>

<span class="s">// (2) Move examples</span>
<span class="s">// You can just do copy followed by delete but many OS&#39;s can just &#39;rename&#39; in place</span>
<span class="s">// so you can additionally do using Java&#39;s functionality:</span>
<span class="s">assert from.renameTo(to)</span>
<span class="s">assert !from.exists()</span>
<span class="s">checkSuccessfulCopyAndDelete()</span>
<span class="s">// whether renameTo succeeds if from and to are on different platforms</span>
<span class="s">// or if to pre-exists is OS dependent, so you should check the return boolean</span>

<span class="s">// alternatively, Ant has a move task:</span>
<span class="s">// http://ant.apache.org/</span><span class="n">manual</span><span class="s">/CoreTasks/</span><span class="n">move</span><span class="o">.</span><span class="na">html</span>

<span class="c1">//helper methods</span>
<span class="kt">def</span> <span class="nf">checkSuccessfulCopyAndDelete</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">assert</span> <span class="n">to</span><span class="o">.</span><span class="na">text</span> <span class="o">==</span> <span class="n">dummyContent</span>
    <span class="k">assert</span> <span class="n">to</span><span class="o">.</span><span class="na">delete</span><span class="o">()</span>
    <span class="k">assert</span> <span class="o">!</span><span class="n">to</span><span class="o">.</span><span class="na">exists</span><span class="o">()</span>
<span class="o">}</span>
<span class="kt">def</span> <span class="nf">setUpFromFile</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">from</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">&#39;/from.txt&#39;</span><span class="o">)</span> <span class="c1">// just a name</span>
    <span class="n">from</span> <span class="o">&lt;&lt;</span> <span class="n">dummyContent</span>         <span class="c1">// now its a real file with content</span>
    <span class="n">from</span><span class="o">.</span><span class="na">deleteOnExit</span><span class="o">()</span>          <span class="c1">// that will be deleted on exit</span>
<span class="o">}</span>
<span class="kt">def</span> <span class="nf">setUpToFile</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">to</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">&#39;C:/to.txt&#39;</span><span class="o">)</span>     <span class="c1">// target name</span>
    <span class="n">to</span><span class="o">.</span><span class="na">delete</span><span class="o">()</span> <span class="c1">// ensure not left from previous aborted run</span>
    <span class="k">assert</span> <span class="o">!</span><span class="n">to</span><span class="o">.</span><span class="na">exists</span><span class="o">()</span>          <span class="c1">// double check</span>
<span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_9.4</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy (because of its Java heritage) doesn&#39;t have an exact</span>
<span class="c1">// equivalent of stat - as per 9.2 there are numerous mechanisms</span>
<span class="c1">// to achieve the equivalent, in particular, JSR203 (still in draft)</span>
<span class="c1">// has specific SymLink support including a FileId class in the</span>
<span class="c1">// java.nio.filesystems package. This will allow (depending on the</span>
<span class="c1">// operating system capabilities) files to be uniquely identified.</span>
<span class="c1">// If you work on Unix or Linux then you&#39;ll recognize this as it device/inode.</span>

<span class="c1">// If you are not interested in the above workarounds/future features</span>
<span class="c1">// and you are on a unix system, you can compare the absolutePath and</span>
<span class="c1">// canonicalPath attributes for a file. If they are different it is</span>
<span class="c1">// a symbolic link. On other operating systems, this difference is not</span>
<span class="c1">// to be relied upon and even on *nix systems, this will only get you</span>
<span class="c1">// so far and will also be relatively expensive resource and timewise.</span>

<span class="c1">// process only unique files</span>
<span class="n">seen</span> <span class="o">=</span> <span class="o">[]</span>
<span class="kt">def</span> <span class="nf">myProcessing</span><span class="o">(</span><span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">path</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">canonicalPath</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">seen</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">path</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">seen</span> <span class="o">&lt;&lt;</span> <span class="n">path</span>
        <span class="c1">// do something with file because we haven&#39;t seen it before</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// find linked files</span>
<span class="n">seen</span> <span class="o">=</span> <span class="o">[:]</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;/dummyfile1.txt&#39;</span><span class="o">,</span><span class="s1">&#39;/test.lnk&#39;</span><span class="o">,</span><span class="s1">&#39;/dummyfile2.txt&#39;</span><span class="o">]</span>
<span class="n">filenames</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">filename</span> <span class="o">-&gt;</span>
    <span class="kt">def</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">filename</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">cpath</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">canonicalPath</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">seen</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">cpath</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">seen</span><span class="o">[</span><span class="n">cpath</span><span class="o">]</span> <span class="o">=</span> <span class="o">[]</span>
    <span class="o">}</span>
    <span class="n">seen</span><span class="o">[</span><span class="n">cpath</span><span class="o">]</span> <span class="o">+=</span> <span class="n">file</span><span class="o">.</span><span class="na">absolutePath</span>
<span class="o">}</span>

<span class="n">println</span> <span class="s1">&#39;Files with links:&#39;</span>
<span class="n">println</span> <span class="n">seen</span><span class="o">.</span><span class="na">findAll</span><span class="o">{</span> <span class="n">k</span><span class="o">,</span><span class="n">v</span> <span class="o">-&gt;</span> <span class="n">v</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">}</span>
<span class="c1">//---------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_9.5</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// general pattern is:</span>
<span class="c1">// new File(&#39;dirname&#39;).eachFile{ /* do something ... */ }</span>

<span class="c1">// setup (change this on your system)</span>
<span class="n">basedir</span> <span class="o">=</span> <span class="s1">&#39;Pleac/src&#39;</span>

<span class="c1">// process all files printing out full name (. and .. auto excluded)</span>
<span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">basedir</span><span class="o">).</span><span class="na">eachFile</span><span class="o">{</span> <span class="n">f</span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">isFile</span><span class="o">())</span> <span class="n">println</span> <span class="n">f</span><span class="o">.</span><span class="na">canonicalPath</span>
<span class="o">}</span>
<span class="c1">// also remove dot files such as &#39;.svn&#39; and &#39;.cvs&#39; etc.</span>
<span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">basedir</span><span class="o">).</span><span class="na">eachFileMatch</span><span class="o">(~</span><span class="s1">&#39;^[^.].*&#39;</span><span class="o">){</span> <span class="n">f</span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">isFile</span><span class="o">())</span> <span class="n">println</span> <span class="n">f</span><span class="o">.</span><span class="na">canonicalPath</span>
<span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_9.6</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Globbing via Apache Jakarta ORO</span>
<span class="kn">import</span> <span class="nn">org.apache.oro.io.GlobFilenameFilter</span>
<span class="n">dir</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">basedir</span><span class="o">)</span>
<span class="n">namelist</span> <span class="o">=</span> <span class="n">dir</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="k">new</span> <span class="n">GlobFilenameFilter</span><span class="o">(</span><span class="s1">&#39;*.c&#39;</span><span class="o">))</span>
<span class="n">filelist</span> <span class="o">=</span> <span class="n">dir</span><span class="o">.</span><span class="na">listFiles</span><span class="o">(</span><span class="k">new</span> <span class="n">GlobFilenameFilter</span><span class="o">(</span><span class="s1">&#39;*.h&#39;</span><span class="o">)</span> <span class="k">as</span> <span class="n">FilenameFilter</span><span class="o">)</span>

<span class="c1">// Built-in matching using regex&#39;s</span>
<span class="n">files</span> <span class="o">=</span> <span class="o">[]</span>
<span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">basedir</span><span class="o">).</span><span class="na">eachFileMatch</span><span class="o">(~</span><span class="s">/\.[ch]$/</span><span class="o">){</span> <span class="n">f</span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">isFile</span><span class="o">())</span> <span class="n">files</span> <span class="o">+=</span> <span class="n">f</span>
<span class="o">}</span>

<span class="c1">// Using Ant&#39;s FileScanner (supports arbitrary nested levels using **)</span>
<span class="c1">// For more details about Ant FileSets, see here:</span>
<span class="c1">// http://ant.apache.org/manual/CoreTypes/fileset.html</span>
<span class="n">scanner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AntBuilder</span><span class="o">().</span><span class="na">fileScanner</span> <span class="o">{</span>
    <span class="n">fileset</span><span class="o">(</span><span class="nl">dir:</span><span class="n">basedir</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">include</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;**/pleac*.groovy&#39;</span><span class="o">)</span>
        <span class="n">include</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;Slowcat.*y&#39;</span><span class="o">)</span>
        <span class="n">exclude</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;**/pleac??.groovy&#39;</span><span class="o">)</span> <span class="c1">// chaps 10 and above</span>
        <span class="n">exclude</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;**/*Test*&#39;</span><span class="o">,</span> <span class="nl">unless:</span><span class="s1">&#39;testMode&#39;</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="k">for</span> <span class="o">(</span><span class="n">f</span> <span class="k">in</span> <span class="n">scanner</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s2">&quot;Found file $f&quot;</span>
<span class="o">}</span>

<span class="c1">// find and sort directories with numeric names</span>
<span class="n">candidateFiles</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">basedir</span><span class="o">).</span><span class="na">listFiles</span><span class="o">()</span>
<span class="n">allDigits</span> <span class="o">=</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">name</span> <span class="o">=~</span> <span class="s">/^\d+$/</span> <span class="o">}</span>
<span class="n">isDir</span> <span class="o">=</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">isDirectory</span><span class="o">()</span> <span class="o">}</span>
<span class="n">dirs</span> <span class="o">=</span> <span class="n">candidateFiles</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">isDir</span><span class="o">).</span><span class="na">findAll</span><span class="o">(</span><span class="n">allDigits</span><span class="o">)*.</span><span class="na">canonicalPath</span><span class="o">.</span><span class="na">sort</span><span class="o">()</span>
<span class="n">println</span> <span class="n">dirs</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_9.7</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// find all files recursively</span>
<span class="n">dir</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">basedir</span><span class="o">)</span>
<span class="n">files</span> <span class="o">=</span> <span class="o">[]</span>
<span class="n">dir</span><span class="o">.</span><span class="na">eachFileRecurse</span><span class="o">{</span> <span class="n">files</span> <span class="o">+=</span> <span class="n">it</span> <span class="o">}</span>

<span class="c1">// find total size</span>
<span class="n">sum</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="na">sum</span><span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">}</span>
<span class="n">println</span> <span class="s2">&quot;$basedir contains $sum bytes&quot;</span>
<span class="c1">// =&gt; Pleac/src contains 365676 bytes</span>

<span class="c1">// find biggest</span>
<span class="n">biggest</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="na">max</span><span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">}</span>
<span class="n">println</span> <span class="s2">&quot;Biggest file is $biggest.name with ${biggest.size()} bytes&quot;</span>
<span class="c1">// =&gt; Biggest file is pleac6.groovy with 42415 bytes</span>

<span class="c1">// find most recently modified</span>
<span class="n">youngest</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="na">max</span><span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">lastModified</span><span class="o">()</span> <span class="o">}</span>
<span class="n">println</span> <span class="s2">&quot;Most recently modified is $youngest.name, changed ${new Date(youngest.lastModified())}&quot;</span>
<span class="c1">// =&gt; Most recently modified is pleac9.groovy, changed Tue Jan 09 07:35:39 EST 2007</span>

<span class="c1">// find all directories</span>
<span class="n">dir</span><span class="o">.</span><span class="na">eachDir</span><span class="o">{</span> <span class="n">println</span> <span class="s1">&#39;Found: &#39;</span> <span class="o">+</span> <span class="n">it</span><span class="o">.</span><span class="na">name</span><span class="o">}</span>

<span class="c1">// find all directories recursively</span>
<span class="n">dir</span><span class="o">.</span><span class="na">eachFileRecurse</span><span class="o">{</span> <span class="n">f</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">isDirectory</span><span class="o">())</span> <span class="n">println</span> <span class="s1">&#39;Found: &#39;</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="na">canonicalPath</span><span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_9.8</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">base</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">&#39;path_to_somewhere_to_delete&#39;</span><span class="o">)</span>

<span class="c1">// delete using Jakarta Apache Commons IO</span>
<span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="n">base</span><span class="o">)</span>

<span class="c1">// delete using Ant, for various options see:</span>
<span class="c1">// http://ant.apache.org/manual/CoreTasks/delete.html</span>
<span class="n">ant</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AntBuilder</span><span class="o">()</span>
<span class="n">ant</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="nl">dir:</span> <span class="n">base</span><span class="o">)</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_9.9</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">names</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;Pleac/src/abc.java&#39;</span><span class="o">,</span> <span class="s1">&#39;Pleac/src/def.groovy&#39;</span><span class="o">]</span>
<span class="n">names</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">name</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">name</span><span class="o">).</span><span class="na">renameTo</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.bak&#39;</span><span class="o">))</span> <span class="o">}</span>

<span class="c1">// The Groovy way of doing rename using an expr would be to use a closure</span>
<span class="c1">// for the expr:</span>
<span class="c1">// groovySimpleRenameScript:</span>
<span class="err">#</span><span class="o">!</span><span class="s">/usr/</span><span class="n">bin</span><span class="s">/groovy</span>
<span class="s">// usage rename closure_expr filenames</span>
<span class="s">op = args[0]</span>
<span class="s">println op</span>
<span class="s">files = args[1..-1]</span>
<span class="s">shell = new GroovyShell(binding)</span>
<span class="s">files.each{ f -&gt;</span>
<span class="s">    newname = shell.evaluate(&quot;$op(&#39;$f&#39;)&quot;)</span>
<span class="s">    new File(f).renameTo(new File(newname))</span>
<span class="s">}</span>

<span class="s">// this would allow processing such as:</span>
<span class="s">//% rename &quot;{n -&gt; &#39;FILE_&#39; + n.toUpperCase()}&quot; files</span>
<span class="s">// with param pleac9.groovy =&gt; FILE_PLEAC9.GROOVY</span>
<span class="s">//% rename &quot;{n -&gt; n.replaceAll(/</span><span class="mi">9</span><span class="s">/,&#39;nine&#39;) }&quot; files</span>
<span class="s">// with param pleac9.groovy =&gt; pleacnine.groovy</span>
<span class="s">// The script could also be modified to take the list of</span>
<span class="s">// files from stdin if no args were present (not shown).</span>

<span class="s">// The above lets you type any Groovy code, but instead you might</span>
<span class="s">// decide to provide the user with some DSL-like additions, e.g.</span>
<span class="s">// adding the following lines into the script:</span>
<span class="s">sep = File.separator</span>
<span class="s">ext = { &#39;.&#39; + it.tokenize(&#39;.&#39;)[-1] }</span>
<span class="s">base = { new File(it).name - ext(it) }</span>
<span class="s">parent = { new File(it).parent }</span>
<span class="s">lastModified = { new Date(new File(it).lastModified()) }</span>
<span class="s">// would then allow the following more succinct expressions:</span>
<span class="s">//% rename &quot;{ n -&gt; parent(n) + sep + base(n).reverse() + ext(n) }&quot; files</span>
<span class="s">// with param Pleac/</span><span class="n">src</span><span class="s">/pleac9.groovy =&gt; Pleac\src\9caelp.groovy</span>
<span class="s">//% rename &quot;{ n -&gt; base(n) + &#39;_&#39; + lastModified(n).year + ext(n) }&quot; files</span>
<span class="s">// with param pleac9.groovy =&gt; pleac9_07.groovy</span>

<span class="s">// As a different alternative, you could hook into Ant&#39;s mapper mechanism.</span>
<span class="s">// You wouldn&#39;t normally type in this from the command-line but it could</span>
<span class="s">// be part of a script, here is an example (excludes the actual rename part)</span>
<span class="s">ant = new AntBuilder()</span>
<span class="s">ant.pathconvert(property:&#39;result&#39;,targetos:&#39;windows&#39;){</span>
<span class="s">    path(){ fileset(dir:&#39;Pleac/</span><span class="n">src</span><span class="s1">&#39;, includes:&#39;</span><span class="n">pleac</span><span class="o">?.</span><span class="na">groovy</span><span class="s1">&#39;) }</span>
<span class="s1">    compositemapper{</span>
<span class="s1">        globmapper(from:&#39;</span><span class="o">*</span><span class="mi">1</span><span class="o">.</span><span class="na">groovy</span><span class="s1">&#39;, to:&#39;</span><span class="o">*</span><span class="mi">1</span><span class="o">.</span><span class="na">groovy</span><span class="o">.</span><span class="na">bak</span><span class="s1">&#39;)</span>
<span class="s1">        regexpmapper(from:/^(.*C2)\.(.*)$/, to:/\1_beta.\2/, casesensitive:&#39;</span><span class="n">no</span><span class="s1">&#39;)</span>
<span class="s1">        chainedmapper{</span>
<span class="s1">            packagemapper(from:&#39;</span><span class="o">*</span><span class="n">pleac3</span><span class="o">.</span><span class="na">groovy</span><span class="s1">&#39;, to:&#39;</span><span class="o">*</span><span class="mi">3</span><span class="o">.</span><span class="na">xml</span><span class="s1">&#39;)</span>
<span class="s1">            filtermapper(){ replacestring(from:&#39;</span><span class="nl">C:</span><span class="o">.</span><span class="s1">&#39;, to:&#39;&#39;) }</span>
<span class="s1">        }</span>
<span class="s1">        chainedmapper{</span>
<span class="s1">            regexpmapper(from:/^(.*)4\.(.*)$/, to:/\1_4.\2/)</span>
<span class="s1">            flattenmapper()</span>
<span class="s1">            filtermapper(){ replacestring(from:&#39;</span><span class="mi">4</span><span class="s1">&#39;, to:&#39;</span><span class="n">four</span><span class="s1">&#39;) }</span>
<span class="s1">        }</span>
<span class="s1">    }</span>
<span class="s1">}</span>
<span class="s1">println ant.antProject.getProperty(&#39;</span><span class="n">result</span><span class="s1">&#39;).replaceAll(&#39;</span><span class="o">;</span><span class="s1">&#39;,&#39;</span><span class="err">\</span><span class="n">n</span><span class="s1">&#39;)</span>
<span class="s1">// =&gt;</span>
<span class="s1">// C:\Projects\GroovyExamples\Pleac\src\pleac1.groovy.bak</span>
<span class="s1">// C:\Projects\GroovyExamples\Pleac\src\pleac2_beta.groovy</span>
<span class="s1">// Projects.GroovyExamples.Pleac.src.3.xml</span>
<span class="s1">// pleac_four.groovy</span>
<span class="s1">//----------------------------------------------------------------------------------</span>

<span class="s1">// @@PLEAC@@_9.10</span>
<span class="s1">//----------------------------------------------------------------------------------</span>
<span class="s1">// Splitting a Filename into Its Component Parts</span>
<span class="s1">path = new File(&#39;</span><span class="n">Pleac</span><span class="s">/src/</span><span class="n">pleac9</span><span class="o">.</span><span class="na">groovy</span><span class="s1">&#39;)</span>
<span class="s1">assert path.parent == &#39;</span><span class="n">Pleac</span><span class="s1">&#39; + File.separator + &#39;</span><span class="n">src</span><span class="s1">&#39;</span>
<span class="s1">assert path.name == &#39;</span><span class="n">pleac9</span><span class="o">.</span><span class="na">groovy</span><span class="s1">&#39;</span>
<span class="s1">ext = path.name.tokenize(&#39;</span><span class="o">.</span><span class="s1">&#39;)[-1]</span>
<span class="s1">assert ext == &#39;</span><span class="n">groovy</span><span class="s1">&#39;</span>

<span class="s1">// No fileparse_set_fstype() equivalent in Groovy/Java. Java&#39;</span><span class="n">s</span> <span class="n">File</span> <span class="n">constructor</span>
<span class="c1">// automatically performs such a parse and does so appropriately of the operating</span>
<span class="c1">// system it is running on. In addition, 3rd party libraries allow platform</span>
<span class="c1">// specific operations ot be performed. As an example, many Ant tasks are OS</span>
<span class="c1">// aware, e.g. the pathconvert task (callable from an AntBuilder instance) has</span>
<span class="c1">// a &#39;targetos&#39; parameter which can be one of &#39;unix&#39;, &#39;windows&#39;, &#39;netware&#39;,</span>
<span class="c1">// &#39;tandem&#39; or &#39;os/2&#39;.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_9.11</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Given the previous discussion regarding the lack of support for symlinks</span>
<span class="c1">// in Java&#39;s File class without exec&#39;ing to the operating system or doing</span>
<span class="c1">// a JNI call (at least until JSR 203 arrives), I have modified this example</span>
<span class="c1">// to perform an actual replica forest of actual file copies rather than</span>
<span class="c1">// a shadow forest full of symlinks pointing back at the real files.</span>
<span class="c1">// Use Apache Jakarta Commons IO</span>
<span class="n">srcdir</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">&#39;Pleac/src&#39;</span><span class="o">)</span> <span class="c1">// path to src</span>
<span class="n">destdir</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">&#39;C:/temp&#39;</span><span class="o">)</span> <span class="c1">// path to dest</span>
<span class="n">preserveFileStamps</span> <span class="o">=</span> <span class="kc">true</span>
<span class="n">FileUtils</span><span class="o">.</span><span class="na">copyDirectory</span><span class="o">(</span><span class="n">srcdir</span><span class="o">,</span> <span class="n">destdir</span><span class="o">,</span> <span class="n">preserveFileStamps</span><span class="o">)</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_9.12</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="err">#</span><span class="o">!</span><span class="s">/usr/</span><span class="n">bin</span><span class="s">/groovy</span>
<span class="s">// lst - list sorted directory contents (depth first)</span>
<span class="s">// Given the previous discussion around Java&#39;s more limited Date</span>
<span class="s">// information available via the File class, this will be a reduced</span>
<span class="s">// functionality version of ls</span>
<span class="s">LONG_OPTION = &#39;l&#39;</span>
<span class="s">REVERSE_OPTION = &#39;r&#39;</span>
<span class="s">MODIFY_OPTION = &#39;m&#39;</span>
<span class="s">SIZE_OPTION = &#39;s&#39;</span>
<span class="s">HELP_OPTION = &#39;help&#39;</span>

<span class="s">op = new joptsimple.OptionParser()</span>
<span class="s">op.accepts( LONG_OPTION, &#39;long listing&#39; )</span>
<span class="s">op.accepts( REVERSE_OPTION, &#39;reverse listing&#39; )</span>
<span class="s">op.accepts( MODIFY_OPTION, &#39;sort based on modification time&#39; )</span>
<span class="s">op.accepts( SIZE_OPTION, &#39;sort based on size&#39; )</span>
<span class="s">op.accepts( HELP_OPTION, &#39;display this message&#39; )</span>

<span class="s">options = op.parse(args)</span>
<span class="s">if (options.wasDetected( HELP_OPTION )) {</span>
<span class="s">    op.printHelpOn( System.out )</span>
<span class="s">} else {</span>
<span class="s">    sort = {}</span>
<span class="s">    params = options.nonOptionArguments()</span>
<span class="s">    longFormat = options.wasDetected( LONG_OPTION )</span>
<span class="s">    reversed = options.wasDetected( REVERSE_OPTION )</span>
<span class="s">    if (options.wasDetected( SIZE_OPTION )) {</span>
<span class="s">        sort = {a,b -&gt; a.size()&lt;=&gt;b.size()}</span>
<span class="s">    } else if (options.wasDetected( MODIFY_OPTION )) {</span>
<span class="s">        sort = {a,b -&gt; a.lastModified()&lt;=&gt;b.lastModified()}</span>
<span class="s">    }</span>
<span class="s">    displayFiles(params, longFormat, reversed, sort)</span>
<span class="s">}</span>

<span class="s">def displayFiles(params, longFormat, reversed, sort) {</span>
<span class="s">    files = []</span>
<span class="s">    params.each{ name -&gt; new File(name).eachFileRecurse{ files += it } }</span>
<span class="s">    files.sort(sort)</span>
<span class="s">    if (reversed) files = files.reverse()</span>
<span class="s">    files.each { file -&gt;</span>
<span class="s">        if (longFormat) {</span>
<span class="s">            print (file.directory ? &#39;d&#39; : &#39;-&#39; )</span>
<span class="s">            print (file.canRead() ? &#39;r&#39; : &#39;-&#39; )</span>
<span class="s">            print (file.canWrite() ? &#39;w &#39; : &#39;- &#39; )</span>
<span class="s">            //print (file.canExecute() ? &#39;x&#39; : &#39;-&#39; ) // Java 6</span>
<span class="s">            print file.size().toString().padLeft(12) + &#39; &#39;</span>
<span class="s">            print new Date(file.lastModified()).toString().padRight(22)</span>
<span class="s">            println &#39;  &#39; + file</span>
<span class="s">        } else {</span>
<span class="s">            println file</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">// =&gt;</span>
<span class="s">// % lst -help</span>
<span class="s">// Option Description</span>
<span class="s">// ------ -------------------------------</span>
<span class="s">// --help display this message</span>
<span class="s">// -l     long listing</span>
<span class="s">// -m     sort based on modification time</span>
<span class="s">// -r     reverse listing</span>
<span class="s">// -s     sort based on size</span>
<span class="s">//</span>
<span class="s">// % lst -l -m Pleac/</span><span class="n">src</span> <span class="n">Pleac</span><span class="s">/lib</span>
<span class="s">// ...</span>
<span class="s">// drw            0 Mon Jan 08 22:33:00 EST 2007  Pleac\lib\.svn</span>
<span class="s">// -rw        18988 Mon Jan 08 22:33:41 EST 2007  Pleac\src\pleac9.groovy</span>
<span class="s">// -rw         2159 Mon Jan 08 23:15:41 EST 2007  Pleac\src\lst.groovy</span>
<span class="s">//</span>
<span class="s">// % -l -s -r Pleac/</span><span class="n">src</span> <span class="n">Pleac</span><span class="s">/lib</span>
<span class="s">// -rw      1034049 Sun Jan 07 19:24:41 EST 2007  Pleac\lib\ant.jar</span>
<span class="s">// -r-      1034049 Sun Jan 07 19:40:27 EST 2007  Pleac\lib\.svn\text-base\ant.jar.svn-base</span>
<span class="s">// -rw       421008 Thu Jun 02 15:15:34 EST 2005  Pleac\lib\ant-nodeps.jar</span>
<span class="s">// -rw       294436 Sat Jan 06 21:19:58 EST 2007  Pleac\lib\geronimo-javamail_1.3.1_mail-1.0.jar</span>
<span class="s">// ...</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_10.0</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">def hello() {</span>
<span class="s">    greeted += 1</span>
<span class="s">    println &quot;hi there!&quot;</span>
<span class="s">}</span>

<span class="s">// We need to initialize greeted before it can be used, because &quot;+=&quot; assumes predefinition</span>
<span class="s">greeted = 0</span>
<span class="s">hello()</span>
<span class="s">println greeted</span>
<span class="s">// =&gt;</span>
<span class="s">// hi there</span>
<span class="s">// 1</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_10.1</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// basic method calling examples</span>
<span class="s">// In Groovy, parameters are named anyway</span>
<span class="s">def hypotenuse(side1, side2) {</span>
<span class="s">    Math.sqrt(side1**2 + side2**2)    // sqrt in Math package</span>
<span class="s">}</span>
<span class="s">diag = hypotenuse(3, 4)</span>
<span class="s">assert diag == 5</span>

<span class="s">// the star operator will magically convert an Array into a &quot;tuple&quot;</span>
<span class="s">a = [5, 12]</span>
<span class="s">assert hypotenuse(*a) == 13</span>

<span class="s">// both = men + women</span>

<span class="s">// In Groovy, all objects are references, so the same problem arises.</span>
<span class="s">// Typically we just return a new object. Especially for immutable objects</span>
<span class="s">// this style of processing is very common.</span>
<span class="s">nums = [1.4, 3.5, 6.7]</span>
<span class="s">def toInteger(n) {</span>
<span class="s">    n.collect { v -&gt; v.toInteger() }</span>
<span class="s">}</span>
<span class="s">assert toInteger(nums) == [1, 3, 6]</span>

<span class="s">orignums = [1.4, 3.5, 6.7]</span>
<span class="s">def truncMe(n) {</span>
<span class="s">    (0..&lt;n.size()).each{ idx -&gt; n[idx] = n[idx].toInteger() }</span>
<span class="s">}</span>
<span class="s">truncMe(orignums)</span>
<span class="s">assert orignums == [1, 3, 6]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_10.2</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// variable scope examples</span>
<span class="s">def somefunc() {</span>
<span class="s">    def variableInMethod  // private is default in a method</span>
<span class="s">}</span>

<span class="s">def name // private is default for variable in a script</span>

<span class="s">bindingVar = 10 // this will be in the binding (sort of global)</span>
<span class="s">globalArray = []</span>

<span class="s">// In Groovy, run_check can&#39;t access a, b, or c until they are</span>
<span class="s">// explicitely defined global (using leading $), even if they are</span>
<span class="s">// both defined in the same scope</span>

<span class="s">def checkAccess(x) {</span>
<span class="s">    def y = 200</span>
<span class="s">    return x + y + bindingVar // access private, param, global</span>
<span class="s">}</span>
<span class="s">assert checkAccess(7) == 217</span>

<span class="s">def saveArray(ary) {</span>
<span class="s">    globalArray &lt;&lt; &#39;internal&#39;</span>
<span class="s">    globalArray += ary</span>
<span class="s">}</span>

<span class="s">saveArray([&#39;important&#39;])</span>
<span class="s">assert globalArray == [&quot;internal&quot;, &quot;important&quot;]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_10.3</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// you want a private persistent variable within a script method</span>

<span class="s">// you could use a helper class for this</span>
<span class="s">class CounterHelper {</span>
<span class="s">    private static counter = 0</span>
<span class="s">    def static next() { ++counter }</span>
<span class="s">}</span>
<span class="s">def greeting(s) {</span>
<span class="s">    def n = CounterHelper.next()</span>
<span class="s">    println &quot;Hello $s  (I have been called $n times)&quot;</span>
<span class="s">}</span>
<span class="s">greeting(&#39;tom&#39;)</span>
<span class="s">greeting(&#39;dick&#39;)</span>
<span class="s">greeting(&#39;harry&#39;)</span>
<span class="s">// =&gt;</span>
<span class="s">// Hello tom  (I have been called 1 times)</span>
<span class="s">// Hello dick  (I have been called 2 times)</span>
<span class="s">// Hello harry  (I have been called 3 times)</span>

<span class="s">// you could make it more fancy by having separate keys,</span>
<span class="s">// using synchronisation, singleton pattern, ThreadLocal, ...</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_10.4</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Determining Current Method Name</span>
<span class="s">// Getting class, package and static info is easy. Method info is just a little work.</span>
<span class="s">// From Java we can use:</span>
<span class="s">//     new Exception().stackTrace[0].methodName</span>
<span class="s">// or for Java 5 and above (saves relatively expensive exception creation)</span>
<span class="s">//     Thread.currentThread().stackTrace[3].methodName</span>
<span class="s">// But these give the Java method name. Groovy wraps its own runtime</span>
<span class="s">// system over the top. It&#39;s still a Java method, just a little bit further up the</span>
<span class="s">// stack from where we might expect. Getting the Groovy method name can be done in</span>
<span class="s">// an implementation specific way (subject to change as the language evolves):</span>
<span class="s">def myMethod() {</span>
<span class="s">    names = new Exception().stackTrace*.methodName</span>
<span class="s">    println groovyUnwrap(names)</span>
<span class="s">}</span>
<span class="s">def myMethod2() {</span>
<span class="s">    names = Thread.currentThread().stackTrace*.methodName</span>
<span class="s">    names = names[3..&lt;names.size()] // skip call to dumpThread</span>
<span class="s">    println groovyUnwrap(names)</span>
<span class="s">}</span>
<span class="s">def groovyUnwrap(names) { names[names.indexOf(&#39;invoke0&#39;)-1] }</span>
<span class="s">myMethod()  // =&gt; myMethod</span>
<span class="s">myMethod2() // =&gt; myMethod2</span>

<span class="s">// Discussion: If what you really wanted was a tracing mechanism, you could overrie</span>
<span class="s">// invokeMethod and print out method names before calling the original method. Or</span>
<span class="s">// you could use one of the Aspect-Oriented Programming packages for Java.</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_10.5</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Passing Arrays and Hashes by Reference</span>
<span class="s">// In Groovy, every value is a reference to an object, thus there is</span>
<span class="s">// no such problem, just call: arrayDiff(array1, array2)</span>

<span class="s">// pairwise add (altered so it doesn&#39;t require equal sizes)</span>
<span class="s">def pairWiseAdd(a1, a2) {</span>
<span class="s">    s1 = a1.size(); s2 = a2.size()</span>
<span class="s">    (0..&lt;[s1,s2].max()).collect{</span>
<span class="s">        it &gt; s1-1 ? a2[it] : (it &gt; s2-1 ? a1[it] : a1[it] + a2[it])</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">a = [1, 2]</span>
<span class="s">b = [5, 8]</span>
<span class="s">assert pairWiseAdd(a, b) == [6, 10]</span>

<span class="s">// also works for unequal sizes</span>
<span class="s">b = [5, 8, -1]</span>
<span class="s">assert pairWiseAdd(a, b) == [6, 10, -1]</span>
<span class="s">b = [5]</span>
<span class="s">assert pairWiseAdd(a, b) == [6, 2]</span>

<span class="s">// We could check if both arguments were of a particular type, e.g.</span>
<span class="s">// (a1 instanceof List) or (a2.class.isArray()) but duck typing allows</span>
<span class="s">// it to work on other things as well, so while wouldn&#39;t normally do this</span>
<span class="s">// you do need to be a little careful when calling the method, e.g.</span>
<span class="s">// here we call it with two maps of strings and get back strings</span>
<span class="s">// the important thing here was that the arguments were indexed</span>
<span class="s">// 0..size-1 and that the items supported the &#39;+&#39; operator (as String does)</span>
<span class="s">a = [0:&#39;Green &#39;, 1:&#39;Grey &#39;]</span>
<span class="s">b = [0:&#39;Frog&#39;, 1:&#39;Elephant&#39;, 2:&#39;Dog&#39;]</span>
<span class="s">assert pairWiseAdd(a, b) == [&quot;Green Frog&quot;, &quot;Grey Elephant&quot;, &quot;Dog&quot;]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_10.6</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Detecting Return Context</span>
<span class="s">// There is no exact equivalent of return context in Groovy but</span>
<span class="s">// you can behave differently when called under different circumstances</span>
<span class="s">def addValueOrSize(a1, a2) {</span>
<span class="s">     b1 = (a1 instanceof Number) ? a1 : a1.size()</span>
<span class="s">     b2 = (a2 instanceof Number) ? a2 : a2.size()</span>
<span class="s">     b1 + b2</span>
<span class="s">}</span>
<span class="s">assert (addValueOrSize(10, &#39;abcd&#39;)) == 14</span>
<span class="s">assert (addValueOrSize(10, [25, 50])) == 12</span>
<span class="s">assert (addValueOrSize(&#39;abc&#39;, [25, 50])) == 5</span>
<span class="s">assert (addValueOrSize(25, 50)) == 75</span>

<span class="s">// Of course, a key feature of many OO languages including Groovy is</span>
<span class="s">// method overloading so that responding to dofferent parameters has</span>
<span class="s">// a formal way of being captured in code with typed methods, e.g.</span>
<span class="s">class MakeBiggerHelper {</span>
<span class="s">    def triple(List iList) { iList.collect{ it * 3 } }</span>
<span class="s">    def triple(int i) { i * 3 }</span>
<span class="s">}</span>
<span class="s">mbh = new MakeBiggerHelper()</span>
<span class="s">assert mbh.triple([4, 5]) == [12, 15]</span>
<span class="s">assert mbh.triple(4) == 12</span>

<span class="s">// Of course with duck typing, we can rely on dynamic typing if we want</span>
<span class="s">def directTriple(arg) {</span>
<span class="s">    (arg instanceof Number) ? arg * 3 : arg.collect{ it * 3 }</span>
<span class="s">}</span>
<span class="s">assert directTriple([4, 5]) == [12, 15]</span>
<span class="s">assert directTriple(4) == 12</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_10.7</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Passing by Named Parameter</span>
<span class="s">// Groovy supports named params or positional arguments with optional</span>
<span class="s">// defaults to simplify method calling</span>

<span class="s">// named arguments work by using a map</span>
<span class="s">def thefunc(Map args) {</span>
<span class="s">    // in this example, we just call the positional version</span>
<span class="s">    thefunc(args.start, args.end, args.step)</span>
<span class="s">}</span>

<span class="s">// positional arguments with defaults</span>
<span class="s">def thefunc(start=0, end=30, step=10) {</span>
<span class="s">    ((start..end).step(step))</span>
<span class="s">}</span>

<span class="s">assert thefunc()                        == [0, 10, 20, 30]</span>
<span class="s">assert thefunc(15)                      == [15, 25]</span>
<span class="s">assert thefunc(0,40)                    == [0, 10, 20, 30, 40]</span>
<span class="s">assert thefunc(start:5, end:20, step:5) == [5, 10, 15, 20]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_10.8</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Skipping Selected Return Values</span>
<span class="s">// Groovy 1.0 doesn&#39;t support multiple return types, so you always use</span>
<span class="s">// a holder class, array or collection to return multiple values.</span>
<span class="s">def getSystemInfo() {</span>
<span class="s">    def millis = System.currentTimeMillis()</span>
<span class="s">    def freemem = Runtime.runtime.freeMemory()</span>
<span class="s">    def version = System.getProperty(&#39;java.vm.version&#39;)</span>
<span class="s">    return [millis:millis, freemem:freemem, version:version]</span>
<span class="s">    // if you are likely to want all the information use a list</span>
<span class="s">    //     return [millis, freemem, version]</span>
<span class="s">    // or dedicated holder class</span>
<span class="s">    //     return new SystemInfo(millis, freemem, version)</span>
<span class="s">}</span>
<span class="s">result = getSystemInfo()</span>
<span class="s">println result.version</span>
<span class="s">// =&gt; 1.5.0_08-b03</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_10.9</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Returning More Than One Array or Hash</span>
<span class="s">// As per 10.8, Groovy 1.0 doesn&#39;t support multiple return types but you</span>
<span class="s">// just use a holder class, array or collection. There are no limitations</span>
<span class="s">// on returning arbitrary nested values using this technique.</span>
<span class="s">def getInfo() {</span>
<span class="s">    def system = [millis:System.currentTimeMillis(),</span>
<span class="s">                  version:System.getProperty(&#39;java.vm.version&#39;)]</span>
<span class="s">    def runtime = [freemem:Runtime.runtime.freeMemory(),</span>
<span class="s">                   maxmem:Runtime.runtime.maxMemory()]</span>
<span class="s">    return [system:system, runtime:runtime]</span>
<span class="s">}</span>
<span class="s">println info.runtime.maxmem // =&gt; 66650112 (info automatically calls getInfo() here)</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_10.10</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Returning Failure</span>
<span class="s">// This is normally done in a heavy-weight way via Java Exceptions</span>
<span class="s">// (see 10.12) or in a lightweight way by returning null</span>
<span class="s">def sizeMinusOne(thing) {</span>
<span class="s">    if (thing instanceof Number) return</span>
<span class="s">    thing.size() - 1</span>
<span class="s">}</span>
<span class="s">def check(thing) {</span>
<span class="s">    result = sizeMinusOne(thing)</span>
<span class="s">    println (result ? &quot;Worked with result: $result&quot; : &#39;Failed&#39;)</span>
<span class="s">}</span>
<span class="s">check(4)</span>
<span class="s">check([1, 2])</span>
<span class="s">check(&#39;abc&#39;)</span>
<span class="s">// =&gt;</span>
<span class="s">// Failed</span>
<span class="s">// Worked with result: 1</span>
<span class="s">// Worked with result: 2</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_10.11</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Prototyping Functions: Not supported by Groovy but arguably</span>
<span class="s">// not important given other language features.</span>

<span class="s">// Omitting Parentheses Scenario: Groovy only lets you leave out</span>
<span class="s">// parentheses in simple cases. If you had two methods sum(a1,a2,a3)</span>
<span class="s">// and sum(a1,a2), there would be no way to indicate that whether</span>
<span class="s">// &#39;sum sum 2, 3, 4, 5&#39; meant sum(sum(2,3),4,5) or sum(sum(2,3,4),5).</span>
<span class="s">// You would have to include the parentheses. Groovy does much less</span>
<span class="s">// auto flattening than some other languages; it provides a *args</span>
<span class="s">// operator, varargs style optional params and supports method</span>
<span class="s">// overloading and ducktyping. Perhaps these other features mean</span>
<span class="s">// that this scenario is always easy to avoid.</span>
<span class="s">def sum(a,b,c){ a+b+c*2 }</span>
<span class="s">def sum(a,b){ a+b }</span>
<span class="s">// sum sum 1,2,4,5</span>
<span class="s">// =&gt; compilation error</span>
<span class="s">sum sum(1,2),4,5</span>
<span class="s">sum sum(1,2,4),5</span>
<span class="s">// these work but if you try to do anything fancy you will run into trouble;</span>
<span class="s">// your best bet is to actually include all the parentheses:</span>
<span class="s">println sum(sum(1,2),4,5) // =&gt; 17</span>
<span class="s">println sum(sum(1,2,4),5) // =&gt; 16</span>

<span class="s">// Mimicking built-ins scenario: this is a mechanism to turn-off</span>
<span class="s">// auto flattening, Groovy only does flattening in restricted circumstances.</span>
<span class="s">// func(array, 1, 2, 3) is never coerced into a single list but varargs</span>
<span class="s">// and optional args can be used instead</span>
<span class="s">def push(list, Object[] optionals) {</span>
<span class="s">    optionals.each{ list.add(it) }</span>
<span class="s">}</span>
<span class="s">items = [1,2]</span>
<span class="s">newItems = [7, 8, 9]</span>
<span class="s">push items, 3, 4</span>
<span class="s">push items, 6</span>
<span class="s">push (items, *newItems) // brackets currently required, *=flattening</span>
<span class="s">                        // without *: items = [1, 2, 3, 4, 6, [7, 8, 9]]</span>
<span class="s">assert items == [1, 2, 3, 4, 6, 7, 8, 9]</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_10.12</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Handling Exceptions</span>
<span class="s">// Same story as in Java but Groovy has some nice Checked -&gt; Unchecked</span>
<span class="s">// magic behind the scenes (Java folk will know what this means)</span>
<span class="s">// When writing methods:</span>
<span class="s">//     throw exception to raise it</span>
<span class="s">// When calling methods:</span>
<span class="s">//     try ... catch ... finally surrounds processing logic</span>
<span class="s">def getSizeMostOfTheTime(s) {</span>
<span class="s">    if (s =~ &#39;Full Moon&#39;) throw new RuntimeException(&#39;The world is ending&#39;)</span>
<span class="s">    s.size()</span>
<span class="s">}</span>
<span class="s">try {</span>
<span class="s">    println &#39;Size is: &#39; + getSizeMostOfTheTime(&#39;The quick brown fox&#39;)</span>
<span class="s">    println &#39;Size is: &#39; + getSizeMostOfTheTime(&#39;Beware the Full Moon&#39;)</span>
<span class="s">} catch (Exception ex) {</span>
<span class="s">    println &quot;Error was: $ex.message&quot;</span>
<span class="s">} finally {</span>
<span class="s">    println &#39;Doing common cleanup&#39;</span>
<span class="s">}</span>
<span class="s">// =&gt;</span>
<span class="s">// Size is: 19</span>
<span class="s">// Error was: The world is ending</span>
<span class="s">// Doing common cleanup</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_10.13</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Saving Global Values</span>
<span class="s">// We can just save the value and restore it later:</span>
<span class="s">def printAge() { println &quot;Age is $age&quot; }</span>

<span class="s">age = 18         // binding &quot;global&quot; variable</span>
<span class="s">printAge()       // =&gt; 18</span>

<span class="s">if (age &gt; 0) {</span>
<span class="s">    def origAge = age</span>
<span class="s">    age = 23</span>
<span class="s">    printAge()   // =&gt; 23</span>
<span class="s">    age = origAge</span>
<span class="s">}</span>
<span class="s">printAge()       // =&gt; 18</span>

<span class="s">// Depending on the circmstances we could enhance this in various ways</span>
<span class="s">// such as synchronizing, surrounding with try ... finally, using a</span>
<span class="s">// memento pattern, saving the whole binding, using a ThreadLocal ...</span>

<span class="s">// There is no need to use local() for filehandles or directory</span>
<span class="s">// handles in Groovy because filehandles are normal objects.</span>
<span class="s">//----------------------------------------------------------------------------------</span>

<span class="s">// @@PLEAC@@_10.14</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Redefining a Function</span>
<span class="s">// This can be done via a number of ways:</span>

<span class="s">// OO approach:</span>
<span class="s">// The standard trick using OO is to override methods in subclasses</span>
<span class="s">class Parent { def foo(){ println &#39;foo&#39; } }</span>
<span class="s">class Child extends Parent { def foo(){ println &#39;bar&#39; } }</span>
<span class="s">new Parent().foo()   // =&gt; foo</span>
<span class="s">new Child().foo()    // =&gt; bar</span>

<span class="s">// Category approach:</span>
<span class="s">// If you want to redefine a method from an existing library</span>
<span class="s">// you can use categories. This can be done to avoid name conflicts</span>
<span class="s">// or to patch functionality with local mods without changing</span>
<span class="s">// original code</span>
<span class="s">println new Date().toString()</span>
<span class="s">// =&gt; Sat Jan 06 16:44:55 EST 2007</span>
<span class="s">class DateCategory {</span>
<span class="s">    static toString(Date self) { &#39;not telling&#39; }</span>
<span class="s">}</span>
<span class="s">use (DateCategory) {</span>
<span class="s">    println new Date().toString()</span>
<span class="s">}</span>
<span class="s">// =&gt; not telling</span>

<span class="s">// Closure approach:</span>
<span class="s">// Groovy&#39;s closures let you have &quot;anonymous methods&quot; as objects.</span>
<span class="s">// This allows you to be very flexible with &quot;method&quot; redefinition, e.g.:</span>
<span class="s">colors = &#39;red yellow blue green&#39;.split(&#39; &#39;).toList()</span>
<span class="s">color2html = new Expando()</span>
<span class="s">colors.each { c -&gt;</span>
<span class="s">    color2html[c] = { args -&gt; &quot;&lt;FONT COLOR=&#39;$c&#39;&gt;$args&lt;/</span><span class="n">FONT</span><span class="o">&gt;</span><span class="s2">&quot; }</span>
<span class="s2">}</span>
<span class="s2">println color2html.yellow(&#39;error&#39;)</span>
<span class="s2">// =&gt; &lt;FONT COLOR=&#39;yellow&#39;&gt;error&lt;/FONT&gt;</span>
<span class="s2">color2html.yellow = { args -&gt; &quot;</span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">$args</span><span class="o">&lt;</span><span class="s">/b&gt;&quot; } // too hard to see yellow</span>
<span class="s">println color2html.yellow(&#39;error&#39;)</span>
<span class="s">// =&gt; &lt;b&gt;error&lt;/</span><span class="n">b</span><span class="o">&gt;</span>

<span class="c1">// Other approaches:</span>
<span class="c1">// you could use invokeMethod to intercept the original method and call</span>
<span class="c1">// your modified method on just particular input data</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_10.15</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Trapping Undefined Function Calls</span>
<span class="kd">class</span> <span class="nc">FontHelper</span> <span class="o">{</span>
    <span class="c1">// we could define all the important colors explicitly like this</span>
    <span class="kt">def</span> <span class="nf">pink</span><span class="o">(</span><span class="n">info</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">buildFont</span><span class="o">(</span><span class="s1">&#39;hot pink&#39;</span><span class="o">,</span> <span class="n">info</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="c1">// but this method will catch any undefined ones</span>
    <span class="kt">def</span> <span class="nf">invokeMethod</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Object</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">buildFont</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">args</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="s1">&#39; and &#39;</span><span class="o">))</span>
    <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">buildFont</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">info</span><span class="o">)</span> <span class="o">{</span>
        <span class="s2">&quot;&lt;FONT COLOR=&#39;$name&#39;&gt;&quot;</span> <span class="o">+</span> <span class="n">info</span> <span class="o">+</span> <span class="s2">&quot;&lt;/FONT&gt;&quot;</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">fh</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FontHelper</span><span class="o">()</span>
<span class="n">println</span> <span class="n">fh</span><span class="o">.</span><span class="na">pink</span><span class="o">(</span><span class="s2">&quot;panther&quot;</span><span class="o">)</span>
<span class="n">println</span> <span class="n">fh</span><span class="o">.</span><span class="na">chartreuse</span><span class="o">(</span><span class="s2">&quot;stuff&quot;</span><span class="o">,</span> <span class="s2">&quot;more stuff&quot;</span><span class="o">)</span>
<span class="c1">// =&gt;</span>
<span class="c1">// &lt;FONT COLOR=&#39;hot pink&#39;&gt;panther&lt;/FONT&gt;</span>
<span class="c1">// &lt;FONT COLOR=&#39;chartreuse&#39;&gt;stuff and more stuff&lt;/FONT&gt;</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_10.16</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Simulating Nested Subroutimes: Using Closures within Methods</span>
<span class="kt">def</span> <span class="nf">outer</span><span class="o">(</span><span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">x</span> <span class="o">=</span> <span class="n">arg</span> <span class="o">+</span> <span class="mi">35</span>
    <span class="n">inner</span> <span class="o">=</span> <span class="o">{</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">19</span> <span class="o">}</span>
    <span class="n">x</span> <span class="o">+</span> <span class="n">inner</span><span class="o">()</span>
<span class="o">}</span>
<span class="k">assert</span> <span class="nf">outer</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span> <span class="o">==</span> <span class="mi">900</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_10.17</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Program: Sorting Your Mail</span>
<span class="err">#</span><span class="o">!</span><span class="s">/usr/</span><span class="n">bin</span><span class="s">/groovy</span>
<span class="s">import javax.mail.*</span>

<span class="s">// solution using mstor package (mstor.sf.net)</span>
<span class="s">session = Session.getDefaultInstance(new Properties())</span>
<span class="s">store = session.getStore(new URLName(&#39;mstor:/</span><span class="n">path_to_your_mbox_directory</span><span class="s1">&#39;))</span>
<span class="s1">store.connect()</span>

<span class="s1">// read messages from Inbox</span>
<span class="s1">inbox = store.defaultFolder.getFolder(&#39;</span><span class="n">Inbox</span><span class="s1">&#39;)</span>
<span class="s1">inbox.open(Folder.READ_ONLY)</span>
<span class="s1">messages = inbox.messages.toList()</span>

<span class="s1">// extractor closures</span>
<span class="s1">subject = { m -&gt; m.subject }</span>
<span class="s1">subjectExcludingReplyPrefix = { m -&gt; subject(m).replaceAll(/(?i)Re:\\s*/,&#39;&#39;) } // double slash to single outside triple quotes</span>
<span class="s1">date = { m -&gt; d = m.sentDate; new Date(d.year, d.month, d.date) } // ignore time fields</span>

<span class="s1">// sort by subject excluding &#39;</span><span class="nl">Re:</span><span class="s1">&#39; prefixs then print subject for first 6</span>
<span class="s1">println messages.sort{subjectExcludingReplyPrefix(it)}[0..5]*.subject.join(&#39;</span><span class="err">\</span><span class="n">n</span><span class="s1">&#39;)</span>
<span class="s1">// =&gt;</span>
<span class="s1">// Additional Resources for JDeveloper 10g (10.1.3)</span>
<span class="s1">// Amazon Web Services Developer Connection Newsletter #18</span>
<span class="s1">// Re: Ant 1.7.0?</span>
<span class="s1">// ARN Daily | 2007: IT predictions for the year ahead</span>
<span class="s1">// Big Changes at Gentleware</span>
<span class="s1">// BigPond Account Notification</span>

<span class="s1">// sort by date then subject (print first 6 entries)</span>
<span class="s1">sorted = messages.sort{ a,b -&gt;</span>
<span class="s1">    date(a) == date(b) ?</span>
<span class="s1">        subjectExcludingReplyPrefix(a) &lt;=&gt; subjectExcludingReplyPrefix(b) :</span>
<span class="s1">        date(a) &lt;=&gt; date(b)</span>
<span class="s1">}</span>
<span class="s1">sorted[0..5].each{ m -&gt; println &quot;$m.sentDate: $m.subject&quot; }</span>
<span class="s1">// =&gt;</span>
<span class="s1">// Wed Jan 03 08:54:15 EST 2007: ARN Daily | 2007: IT predictions for the year ahead</span>
<span class="s1">// Wed Jan 03 15:33:31 EST 2007: EclipseSource: RCP Adoption, Where Art Thou?</span>
<span class="s1">// Wed Jan 03 00:10:11 EST 2007: What&#39;</span><span class="n">s</span> <span class="n">New</span> <span class="n">at</span> <span class="n">Sams</span> <span class="n">Publishing</span><span class="o">?</span>
<span class="c1">// Fri Jan 05 08:31:11 EST 2007: Building a Sustainable Open Source Business</span>
<span class="c1">// Fri Jan 05 09:53:45 EST 2007: Call for Participation: Agile 2007</span>
<span class="c1">// Fri Jan 05 05:51:36 EST 2007: IBM developerWorks Weekly Edition, 4 January 2007</span>

<span class="c1">// group by date then print first 2 entries of first 2 dates</span>
<span class="n">groups</span> <span class="o">=</span> <span class="n">messages</span><span class="o">.</span><span class="na">groupBy</span><span class="o">{</span> <span class="n">date</span><span class="o">(</span><span class="n">it</span><span class="o">)</span> <span class="o">}</span>
<span class="n">groups</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">toList</span><span class="o">()[</span><span class="mi">0</span><span class="o">..</span><span class="mi">1</span><span class="o">].</span><span class="na">each</span><span class="o">{</span>
    <span class="n">println</span> <span class="n">it</span>
    <span class="n">println</span> <span class="n">groups</span><span class="o">[</span><span class="n">it</span><span class="o">][</span><span class="mi">0</span><span class="o">..</span><span class="mi">1</span><span class="o">].</span><span class="na">collect</span><span class="o">{</span> <span class="s1">&#39;    &#39;</span> <span class="o">+</span> <span class="n">it</span><span class="o">.</span><span class="na">subject</span> <span class="o">}.</span><span class="na">join</span><span class="o">(</span><span class="s1">&#39;\n&#39;</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Wed Jan 03 00:00:00 EST 2007</span>
<span class="c1">//     ARN Daily | 2007: IT predictions for the year ahead</span>
<span class="c1">//     EclipseSource: RCP Adoption, Where Art Thou?</span>
<span class="c1">// Fri Jan 05 00:00:00 EST 2007</span>
<span class="c1">//     Building a Sustainable Open Source Business</span>
<span class="c1">//     Call for Participation: Agile 2007</span>


<span class="c1">// @@PLEAC@@_11.0</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// In Groovy, most usages of names are references (there are some special</span>
<span class="c1">// rules for the map shorthand notation and builders).</span>
<span class="c1">// Objects are inherently anonymous, they don&#39;t know what names refer to them.</span>
<span class="n">ref</span> <span class="o">=</span> <span class="mi">3</span>       <span class="c1">// points ref to an Integer object with value 3.</span>
<span class="n">println</span> <span class="n">ref</span>   <span class="c1">// prints the value that the name ref refers to.</span>

<span class="n">myList</span> <span class="o">=</span> <span class="o">[</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">]</span>       <span class="c1">// myList is a name for this list</span>
<span class="n">anotherRef</span> <span class="o">=</span> <span class="n">myList</span>
<span class="n">myMap</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;How&quot;</span><span class="o">:</span> <span class="s2">&quot;Now&quot;</span><span class="o">,</span> <span class="s2">&quot;Brown&quot;</span><span class="o">:</span> <span class="s2">&quot;Cow&quot;</span><span class="o">]</span> <span class="c1">// myMap is a name for this map</span>

<span class="n">anArray</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">]</span> <span class="k">as</span> <span class="kt">int</span><span class="o">[]</span> <span class="c1">// creates an array of three references to Integer objects</span>

<span class="n">list</span> <span class="o">=</span> <span class="o">[[]]</span>  <span class="c1">// a list containing an empty list</span>
<span class="n">list</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;Cat&#39;</span>
<span class="n">println</span> <span class="n">list</span> <span class="c1">// =&gt; [[], null, &quot;Cat&quot;]</span>
<span class="n">list</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;Dog&#39;</span>
<span class="n">println</span> <span class="n">list</span> <span class="c1">// =&gt; [[null, null, &quot;Dog&quot;], null, &quot;Cat&quot;]</span>

<span class="n">a</span> <span class="o">=</span> <span class="o">[</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span>  <span class="c1">// b is a reference to the same thing as a</span>
<span class="n">a</span><span class="o">.</span><span class="na">sort</span><span class="o">()</span>
<span class="n">println</span> <span class="n">b</span> <span class="c1">// =&gt; [1, 2]</span>

<span class="n">nat</span> <span class="o">=</span> <span class="o">[</span> <span class="nl">Name:</span> <span class="s2">&quot;Leonhard Euler&quot;</span><span class="o">,</span>
        <span class="nl">Address:</span> <span class="s2">&quot;1729 Ramanujan Lane\nMathworld, PI 31416&quot;</span><span class="o">,</span>
        <span class="nl">Birthday:</span> <span class="mh">0x5bb5580</span>
<span class="o">]</span>
<span class="n">println</span> <span class="n">nat</span>
<span class="c1">// =&gt;[&quot;Address&quot;:&quot;1729 Ramanujan Lane\nMathworld, PI 31416&quot;, &quot;Name&quot;:&quot;Leonhard Euler&quot;, &quot;Birthday&quot;:96163200]</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_11.1</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">aref</span> <span class="o">=</span> <span class="n">myList</span>
<span class="n">anonList</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">9</span><span class="o">]</span>
<span class="n">anonCopy</span> <span class="o">=</span> <span class="n">anonList</span>
<span class="n">implicitCreation</span> <span class="o">=</span> <span class="o">[</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">10</span><span class="o">]</span>

<span class="n">anonList</span> <span class="o">+=</span> <span class="mi">11</span>
<span class="n">println</span> <span class="n">anonList</span>  <span class="c1">// =&gt; [1, 3, 5, 7, 9, 11]</span>

<span class="n">two</span> <span class="o">=</span> <span class="n">implicitCreation</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
<span class="k">assert</span> <span class="n">two</span> <span class="o">==</span> <span class="mi">2</span>

<span class="c1">//  To get the last index of a list, you can use size()</span>
<span class="c1">// but you never would</span>
<span class="n">lastIdx</span> <span class="o">=</span> <span class="n">aref</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span>

<span class="c1">// Normally, though, you&#39;d use an index of -1 for the last</span>
<span class="c1">// element, -2 for the second last, etc.</span>
<span class="n">println</span> <span class="n">implicitCreation</span><span class="o">[-</span><span class="mi">1</span><span class="o">]</span>
<span class="c1">//=&gt; 10</span>

<span class="c1">// And if you were looping through (and not using a list closure operator)</span>
<span class="o">(</span><span class="mi">0</span><span class="o">..&lt;</span><span class="n">aref</span><span class="o">.</span><span class="na">size</span><span class="o">()).</span><span class="na">each</span><span class="o">{</span> <span class="cm">/* do something */</span> <span class="o">}</span>

<span class="n">numItems</span> <span class="o">=</span> <span class="n">aref</span><span class="o">.</span><span class="na">size</span><span class="o">()</span>

<span class="k">assert</span> <span class="n">anArray</span> <span class="k">instanceof</span> <span class="kt">int</span><span class="o">[]</span>
<span class="k">assert</span> <span class="n">anArray</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isArray</span><span class="o">()</span>
<span class="n">println</span> <span class="n">anArray</span>

<span class="n">myList</span><span class="o">.</span><span class="na">sort</span><span class="o">()</span> <span class="c1">// sort is in place.</span>
<span class="n">myList</span> <span class="o">+=</span> <span class="s2">&quot;an item&quot;</span> <span class="c1">// append item</span>

<span class="kt">def</span> <span class="nf">createList</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="o">[]</span> <span class="o">}</span>
<span class="n">aref1</span> <span class="o">=</span> <span class="n">createList</span><span class="o">()</span>
<span class="n">aref2</span> <span class="o">=</span> <span class="n">createList</span><span class="o">()</span>
<span class="c1">// aref1 and aref2 point to different lists.</span>

<span class="n">println</span> <span class="n">anonList</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="c1">// refers to the 4th item in the list_ref list.</span>

<span class="c1">// The following two statements are equivalent and return up to 3 elements</span>
<span class="c1">// at indices 3, 4, and 5 (if they exist).</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">anonList</span><span class="o">[</span><span class="mi">3</span><span class="o">..</span><span class="mi">5</span><span class="o">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">anonList</span><span class="o">[(</span><span class="mi">3</span><span class="o">..</span><span class="mi">5</span><span class="o">).</span><span class="na">step</span><span class="o">(</span><span class="mi">1</span><span class="o">)]</span>

<span class="c1">//   This will insert 3 elements, overwriting elements at indices 3,4, or 5 - if they exist.</span>
<span class="n">anonList</span><span class="o">[</span><span class="mi">3</span><span class="o">..</span><span class="mi">5</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;blackberry&quot;</span><span class="o">,</span> <span class="s2">&quot;blueberry&quot;</span><span class="o">,</span> <span class="s2">&quot;pumpkin&quot;</span><span class="o">]</span>

<span class="c1">// non index-based looping</span>
<span class="k">for</span> <span class="o">(</span><span class="n">item</span> <span class="k">in</span> <span class="n">anonList</span><span class="o">)</span> <span class="n">println</span> <span class="n">item</span>
<span class="n">anonList</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">println</span> <span class="n">it</span> <span class="o">}</span>

<span class="c1">// index-based looping</span>
<span class="o">(</span><span class="mi">0</span><span class="o">..&lt;</span><span class="n">anonList</span><span class="o">.</span><span class="na">size</span><span class="o">()).</span><span class="na">each</span><span class="o">{</span> <span class="n">idx</span> <span class="o">-&gt;</span> <span class="n">println</span> <span class="n">anonList</span><span class="o">[</span><span class="n">idx</span><span class="o">]</span> <span class="o">}</span>
<span class="k">for</span> <span class="o">(</span><span class="n">idx</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..&lt;</span><span class="n">anonList</span><span class="o">.</span><span class="na">size</span><span class="o">())</span> <span class="n">println</span> <span class="n">anonList</span><span class="o">[</span><span class="n">idx</span><span class="o">]</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_11.2</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Making Hashes of Arrays</span>
<span class="n">hash</span> <span class="o">=</span> <span class="o">[:]</span> <span class="c1">// empty map</span>
<span class="n">hash</span><span class="o">[</span><span class="s2">&quot;KEYNAME&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;new value&quot;</span>

<span class="n">hash</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span> <span class="o">-&gt;</span> <span class="n">println</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">}</span>

<span class="n">hash</span><span class="o">[</span><span class="s2">&quot;a key&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">hash</span><span class="o">[</span><span class="s2">&quot;a key&quot;</span><span class="o">]</span>

<span class="n">hash</span><span class="o">[</span><span class="s2">&quot;a key&quot;</span><span class="o">]</span> <span class="o">+=</span> <span class="mi">6</span>
<span class="n">println</span> <span class="n">hash</span>
<span class="c1">// =&gt; [&quot;KEYNAME&quot;:&quot;new value&quot;, &quot;a key&quot;:[3, 4, 5, 6]]</span>

<span class="c1">// attempting to access a value for a key not in the map yields null</span>
<span class="k">assert</span> <span class="n">hash</span><span class="o">[</span><span class="s1">&#39;unknown key&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span>
<span class="k">assert</span> <span class="n">hash</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s1">&#39;unknown key&#39;</span><span class="o">,</span> <span class="mi">45</span><span class="o">)</span> <span class="o">==</span> <span class="mi">45</span>
<span class="n">println</span> <span class="n">hash</span>
<span class="c1">// =&gt; [&quot;unknown key&quot;:45, &quot;KEYNAME&quot;:&quot;new value&quot;, &quot;a key&quot;:[3, 4, 5, 6]]</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_11.3</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Hashes are no different to other objects</span>
<span class="n">myHash</span> <span class="o">=</span> <span class="o">[</span> <span class="nl">key1:</span><span class="mi">100</span><span class="o">,</span> <span class="nl">key2:</span><span class="mi">200</span> <span class="o">]</span>
<span class="n">myHashCopy</span> <span class="o">=</span> <span class="n">myHash</span><span class="o">.</span><span class="na">clone</span><span class="o">()</span>

<span class="n">value</span> <span class="o">=</span> <span class="n">myHash</span><span class="o">[</span><span class="s1">&#39;key1&#39;</span><span class="o">]</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">myHash</span><span class="o">.</span><span class="s1">&#39;key1&#39;</span>
<span class="n">slice</span> <span class="o">=</span> <span class="n">myHash</span><span class="o">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="o">]</span>
<span class="n">keys</span> <span class="o">=</span> <span class="n">myHash</span><span class="o">.</span><span class="na">keySet</span><span class="o">()</span>

<span class="k">assert</span> <span class="n">myHash</span> <span class="k">instanceof</span> <span class="n">Map</span>

<span class="o">[</span><span class="n">myHash</span><span class="o">,</span> <span class="n">hash</span><span class="o">].</span><span class="na">each</span><span class="o">{</span> <span class="n">m</span> <span class="o">-&gt;</span>
    <span class="n">m</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">k</span><span class="o">,</span> <span class="n">v</span> <span class="o">-&gt;</span> <span class="n">println</span> <span class="s2">&quot;$k =&gt; $v&quot;</span><span class="o">}</span>
<span class="o">}</span>
<span class="c1">// =&gt;</span>
<span class="c1">// key1 =&gt; 100</span>
<span class="c1">// key2 =&gt; 200</span>
<span class="c1">// unknown key =&gt; 45</span>
<span class="c1">// KEYNAME =&gt; new value</span>
<span class="c1">// a key =&gt; [3, 4, 5, 6]</span>

<span class="n">values</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;key1&#39;</span><span class="o">,</span><span class="s1">&#39;key2&#39;</span><span class="o">].</span><span class="na">collect</span><span class="o">{</span> <span class="n">myHash</span><span class="o">[</span><span class="n">it</span><span class="o">]</span> <span class="o">}</span>
<span class="n">println</span> <span class="n">values</span>  <span class="c1">// =&gt; [100, 200]</span>

<span class="k">for</span> <span class="o">(</span><span class="n">key</span> <span class="k">in</span> <span class="o">[</span><span class="s2">&quot;key1&quot;</span><span class="o">,</span> <span class="s2">&quot;key2&quot;</span><span class="o">])</span> <span class="o">{</span>
    <span class="n">myHash</span><span class="o">[</span><span class="n">key</span><span class="o">]</span> <span class="o">+=</span> <span class="mi">7</span>
<span class="o">}</span>
<span class="n">println</span> <span class="n">myHash</span>  <span class="c1">// =&gt; [&quot;key1&quot;:107, &quot;key2&quot;:207]</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_11.4</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// you can use closures or the &amp;method notation</span>
<span class="kt">def</span> <span class="nf">joy</span><span class="o">()</span> <span class="o">{</span> <span class="n">println</span> <span class="s1">&#39;joy&#39;</span> <span class="o">}</span>
<span class="kt">def</span> <span class="nf">sullen</span><span class="o">()</span> <span class="o">{</span> <span class="n">println</span> <span class="s1">&#39;sullen&#39;</span> <span class="o">}</span>
<span class="n">angry</span> <span class="o">=</span> <span class="o">{</span> <span class="n">println</span> <span class="s1">&#39;angry&#39;</span> <span class="o">}</span>
<span class="n">commands</span> <span class="o">=</span> <span class="o">[</span><span class="nl">happy:</span> <span class="k">this</span><span class="o">.&amp;</span><span class="n">joy</span><span class="o">,</span>
            <span class="nl">sad:</span>   <span class="k">this</span><span class="o">.&amp;</span><span class="n">sullen</span><span class="o">,</span>
            <span class="nl">done:</span>  <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">},</span>
            <span class="nl">mad:</span>   <span class="n">angry</span>
<span class="o">]</span>

<span class="n">print</span> <span class="s2">&quot;How are you?&quot;</span>
<span class="n">cmd</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">()</span>
<span class="k">if</span> <span class="o">(</span><span class="n">cmd</span> <span class="k">in</span> <span class="n">commands</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="n">commands</span><span class="o">[</span><span class="n">cmd</span><span class="o">]()</span>
<span class="k">else</span> <span class="n">println</span> <span class="s2">&quot;No such command: $cmd&quot;</span>


<span class="c1">// a counter of the type referred to in the original cookbook</span>
<span class="c1">// would be implemented using a class</span>
<span class="kt">def</span> <span class="nf">counterMaker</span><span class="o">(){</span>
    <span class="kt">def</span> <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="o">{</span> <span class="o">-&gt;</span> <span class="n">start</span><span class="o">++;</span> <span class="n">start</span><span class="o">-</span><span class="mi">1</span> <span class="o">}</span>
<span class="o">}</span>

<span class="n">counter</span> <span class="o">=</span> <span class="n">counterMaker</span><span class="o">()</span>
<span class="mi">5</span><span class="o">.</span><span class="na">times</span><span class="o">{</span> <span class="n">print</span> <span class="s2">&quot;${counter()} &quot;</span> <span class="o">};</span> <span class="n">println</span><span class="o">()</span>

<span class="n">counter1</span> <span class="o">=</span> <span class="n">counterMaker</span><span class="o">()</span>
<span class="n">counter2</span> <span class="o">=</span> <span class="n">counterMaker</span><span class="o">()</span>

<span class="mi">5</span><span class="o">.</span><span class="na">times</span><span class="o">{</span> <span class="n">println</span> <span class="s2">&quot;${counter1()} &quot;</span> <span class="o">}</span>
<span class="n">println</span> <span class="s2">&quot;${counter1()} ${counter2()}&quot;</span>
<span class="c1">//=&gt; 0</span>
<span class="c1">//=&gt; 1</span>
<span class="c1">//=&gt; 2</span>
<span class="c1">//=&gt; 3</span>
<span class="c1">//=&gt; 4</span>
<span class="c1">//=&gt; 5 0</span>


<span class="kt">def</span> <span class="nf">timestamp</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span>
    <span class="k">return</span> <span class="o">{</span> <span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">start</span><span class="o">).</span><span class="na">intdiv</span><span class="o">(</span><span class="mi">1000</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>
<span class="n">early</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">()</span>
<span class="c1">//sleep(10000)</span>
<span class="n">later</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">()</span>
<span class="n">sleep</span><span class="o">(</span><span class="mi">2000</span><span class="o">)</span>
<span class="n">println</span> <span class="s2">&quot;It&#39;s been ${early()} seconds since early.&quot;</span>
<span class="n">println</span> <span class="s2">&quot;It&#39;s been ${later()} seconds since later.&quot;</span>
<span class="c1">//=&gt; It&#39;s been 12 seconds since early.</span>
<span class="c1">//=&gt; It&#39;s been 2 seconds since later.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_11.5</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// All variables in Groovy are objects including primitives. Some objects</span>
<span class="c1">// are immutable. Some operations on objects change mutable objects.</span>
<span class="c1">// Some operations produce new objects.</span>

<span class="c1">// 15 is an Integer which is an immutable object.</span>
<span class="c1">// passing 15 to a method passes a reference to the Integer object.</span>
<span class="kt">def</span> <span class="nf">print</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="n">println</span> <span class="s2">&quot;${n.toString()}&quot;</span> <span class="o">}</span>
<span class="n">print</span><span class="o">(</span><span class="mi">15</span><span class="o">)</span>  <span class="c1">// no need to create any kind of explicit reference</span>

<span class="c1">// even though Integers are immutable, references to them are not</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span>
<span class="n">println</span> <span class="s2">&quot;$x $y&quot;</span>  <span class="c1">// =&gt; 1 1</span>
<span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>    <span class="c1">// &quot;x&quot; now refers to a different object than y</span>
<span class="n">println</span> <span class="s2">&quot;$x $y&quot;</span>  <span class="c1">// =&gt; 2 1</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">4</span>     <span class="c1">// &quot;y&quot; now refers to a different object than it did before</span>
<span class="n">println</span> <span class="s2">&quot;$x $y&quot;</span>  <span class="c1">// =&gt; 2 4</span>

<span class="c1">// Some objects (including ints and strings) are immutable, however, which</span>
<span class="c1">// can give the illusion of a by-value/by-reference distinction:</span>
<span class="n">list</span> <span class="o">=</span> <span class="o">[[</span><span class="mi">1</span><span class="o">],</span> <span class="mi">1</span><span class="o">,</span> <span class="s1">&#39;s&#39;</span><span class="o">]</span>
<span class="n">list</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">it</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">}</span> <span class="c1">// plus operator doesn&#39;t operate inplace</span>
<span class="n">print</span> <span class="n">list</span> <span class="c1">//=&gt; [[1] 1 s]</span>
<span class="n">list</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">collect</span><span class="o">{</span> <span class="n">it</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">}</span>
<span class="n">print</span> <span class="n">list</span> <span class="c1">//=&gt; [[1, 1], 2, s1]</span>

<span class="n">list</span> <span class="o">=</span> <span class="o">[[</span><span class="s1">&#39;Z&#39;</span><span class="o">,</span> <span class="s1">&#39;Y&#39;</span><span class="o">,</span> <span class="s1">&#39;X&#39;</span><span class="o">],</span> <span class="o">[</span><span class="s1">&#39;C&#39;</span><span class="o">,</span> <span class="s1">&#39;B&#39;</span><span class="o">,</span> <span class="s1">&#39;A&#39;</span><span class="o">],</span> <span class="o">[</span><span class="mi">5</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">]]</span>
<span class="n">list</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">sort</span><span class="o">()</span> <span class="o">}</span> <span class="c1">// sort operation operates inline</span>
<span class="n">println</span> <span class="n">list</span> <span class="c1">// =&gt; [[&quot;X&quot;, &quot;Y&quot;, &quot;Z&quot;], [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;], [1, 3, 5]]</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_11.6</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// As indicated by the previous section, everything is referenced, so</span>
<span class="c1">// just create a list as normal, and beware that augmented assignment</span>
<span class="c1">// works differently with immutable objects to mutable ones and depends</span>
<span class="c1">// on the semantics of the particular operation invoked:</span>
<span class="n">mylist</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="s2">&quot;s&quot;</span><span class="o">,</span> <span class="o">[</span><span class="mi">1</span><span class="o">]]</span>
<span class="n">print</span> <span class="n">mylist</span>
<span class="c1">//=&gt; [1, s, [1]]</span>

<span class="n">mylist</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">it</span> <span class="o">*=</span> <span class="mi">2</span> <span class="o">}</span>
<span class="n">print</span> <span class="n">mylist</span>
<span class="c1">//=&gt; [1, s, [1,1]]</span>

<span class="n">mylist</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">*=</span> <span class="mi">2</span>
<span class="n">mylist</span><span class="o">[-</span><span class="mi">1</span><span class="o">]</span> <span class="o">*=</span> <span class="mi">2</span>
<span class="n">print</span> <span class="n">mylist</span>
<span class="c1">//=&gt; [2, s, [1, 1]]</span>

<span class="c1">// If you need to modify every value in a list, you use collect</span>
<span class="c1">// which does NOT modify inplace but rather returns a new collection:</span>
<span class="n">mylist</span> <span class="o">=</span> <span class="mi">1</span><span class="o">..</span><span class="mi">4</span>
<span class="n">println</span> <span class="n">mylist</span><span class="o">.</span><span class="na">collect</span><span class="o">{</span> <span class="n">it</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">4</span><span class="s">/3 * Math.PI }</span>
<span class="s">// =&gt; [4.188790204681671, 33.510321638395844, 113.09733552923255, 268.0825731062243]</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_11.7</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">def mkcounter(count) {</span>
<span class="s">    def start = count</span>
<span class="s">    def bundle = [:]</span>
<span class="s">    bundle.&#39;NEXT&#39; = { count += 1 }</span>
<span class="s">    bundle.&#39;PREV&#39; = { count -= 1 }</span>
<span class="s">    bundle.&#39;RESET&#39; = { count = start }</span>
<span class="s">    bundle[&quot;LAST&quot;] = bundle[&quot;PREV&quot;]</span>
<span class="s">    return bundle</span>
<span class="s">}</span>

<span class="s">c1 = mkcounter(20)</span>
<span class="s">c2 = mkcounter(77)</span>

<span class="s">println &quot;next c1: ${c1[&quot;NEXT&quot;]()}&quot;  // 21</span>
<span class="s">println &quot;next c2: ${c2[&quot;NEXT&quot;]()}&quot;  // 78</span>
<span class="s">println &quot;next c1: ${c1[&quot;NEXT&quot;]()}&quot;  // 22</span>
<span class="s">println &quot;last c1: ${c1[&quot;PREV&quot;]()}&quot;  // 21</span>
<span class="s">println &quot;last c1: ${c1[&quot;LAST&quot;]()}&quot;  // 20</span>
<span class="s">println &quot;old  c2: ${c2[&quot;RESET&quot;]()}&quot; // 77</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_11.8</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">def addAndMultiply(a, b) {</span>
<span class="s">    println &quot;${a+b} ${a*b}&quot;</span>
<span class="s">}</span>
<span class="s">methRef = this.&amp;addAndMultiply</span>
<span class="s">// or use direct closure</span>
<span class="s">multiplyAndAdd = { a,b -&gt; println &quot;${a*b} ${a+b}&quot; }</span>
<span class="s">// later ...</span>
<span class="s">methRef(2,3)                   // =&gt; 5 6</span>
<span class="s">multiplyAndAdd(2,3)            // =&gt; 6 5</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_11.9</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">record = [</span>
<span class="s">    &quot;name&quot;: &quot;Jason&quot;,</span>
<span class="s">    &quot;empno&quot;: 132,</span>
<span class="s">    &quot;title&quot;: &quot;deputy peon&quot;,</span>
<span class="s">    &quot;age&quot;: 23,</span>
<span class="s">    &quot;salary&quot;: 37000,</span>
<span class="s">    &quot;pals&quot;: [&quot;Norbert&quot;, &quot;Rhys&quot;, &quot;Phineas&quot;],</span>
<span class="s">]</span>
<span class="s">println &quot;I am ${record.&#39;name&#39;}, and my pals are ${record.&#39;pals&#39;.join(&#39;, &#39;)}.&quot;</span>
<span class="s">// =&gt; I am Jason, and my pals are Norbert, Rhys, Phineas.</span>

<span class="s">byname = [:]</span>
<span class="s">byname[record[&quot;name&quot;]] = record</span>

<span class="s">rp = byname.get(&quot;Aron&quot;)</span>
<span class="s">if (rp) println &quot;Aron is employee ${rp[&quot;empno&quot;]}.&quot;</span>

<span class="s">byname[&quot;Jason&quot;][&quot;pals&quot;] += &quot;Theodore&quot;</span>
<span class="s">println &quot;Jason now has ${byname[&#39;Jason&#39;][&#39;pals&#39;].size()} pals.&quot;</span>

<span class="s">byname.each{ name, record -&gt;</span>
<span class="s">    println &quot;$name is employee number ${record[&#39;empno&#39;]}.&quot;</span>
<span class="s">}</span>

<span class="s">employees = [:]</span>
<span class="s">employees[record[&quot;empno&quot;]] = record</span>

<span class="s">// lookup by id</span>
<span class="s">rp = employees[132]</span>
<span class="s">if (rp) println &quot;Employee number 132 is ${rp.&#39;name&#39;}.&quot;</span>

<span class="s">byname[&quot;Jason&quot;][&quot;salary&quot;] *= 1.035</span>
<span class="s">println record</span>
<span class="s">// =&gt; [&quot;pals&quot;:[&quot;Norbert&quot;, &quot;Rhys&quot;, &quot;Phineas&quot;, &quot;Theodore&quot;], &quot;age&quot;:23,</span>
<span class="s">//      &quot;title&quot;:&quot;deputy peon&quot;, &quot;name&quot;:&quot;Jason&quot;, &quot;salary&quot;:38295.000, &quot;empno&quot;:132]</span>

<span class="s">peons = employees.findAll{ k, v -&gt; v.&#39;title&#39; =~ /</span><span class="o">(?</span><span class="n">i</span><span class="o">)</span><span class="n">peon</span><span class="s">/ }</span>
<span class="s">assert peons.size() == 1</span>
<span class="s">tsevens = employees.findAll{ k, v -&gt; v.&#39;age&#39; == 27 }</span>
<span class="s">assert tsevens.size() == 0</span>

<span class="s">// Go through all records</span>
<span class="s">println &#39;Names are: &#39; + employees.values().collect{r-&gt;r.&#39;name&#39;}.join(&#39;, &#39;)</span>

<span class="s">byAge = {a,b-&gt; a.value().&#39;age&#39; &lt;=&gt; b.value().&#39;age&#39;}</span>
<span class="s">employees.values().sort{byAge}.each{ r-&gt;</span>
<span class="s">    println &quot;${r.&#39;name&#39;} is ${r.&#39;age&#39;}&quot;</span>
<span class="s">}</span>

<span class="s">// byage, a hash: age =&gt; list of records</span>
<span class="s">byage = [:]</span>
<span class="s">byage[record[&quot;age&quot;]] = byage.get(record[&quot;age&quot;], []) + [record]</span>

<span class="s">byage.each{ age, list -&gt;</span>
<span class="s">    println &quot;Age $age: ${list.collect{it.&#39;name&#39;}.join(&#39;, &#39;)}&quot;</span>
<span class="s">}</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_11.10</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// if you are using a Properties (see 8.16) then just use load</span>
<span class="s">// and store (or storeToXML)</span>
<span class="s">// variation to original cookbook as Groovy can use Java&#39;s object serialization</span>
<span class="s">map = [1:&#39;Jan&#39;, 2:&#39;Feb&#39;, 3:&#39;Mar&#39;]</span>
<span class="s">// write</span>
<span class="s">new File(&#39;months.dat&#39;).withObjectOutputStream{ oos -&gt;</span>
<span class="s">    oos.writeObject(map)</span>
<span class="s">}</span>
<span class="s">// reset</span>
<span class="s">map = null</span>
<span class="s">// read</span>
<span class="s">new File(&#39;months.dat&#39;).withObjectInputStream{ ois -&gt;</span>
<span class="s">    map = ois.readObject()</span>
<span class="s">}</span>
<span class="s">println map // =&gt; [1:&quot;Jan&quot;, 2:&quot;Feb&quot;, 3:&quot;Mar&quot;]</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_11.11</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Groovy automatically does pretty printing for some of the key types, e.g.</span>
<span class="s">mylist = [[1,2,3], [4, [5,6,7], 8,9, [0,3,5]], 7, 8]</span>
<span class="s">println mylist</span>
<span class="s">// =&gt; [[1, 2, 3], [4, [5, 6, 7], 8, 9, [0, 3, 5]], 7, 8]</span>

<span class="s">mydict = [&quot;abc&quot;: &quot;def&quot;, &quot;ghi&quot;:[1,2,3]]</span>
<span class="s">println mydict</span>
<span class="s">// =&gt; [&quot;abc&quot;:&quot;def&quot;, &quot;ghi&quot;:[1, 2, 3]]</span>

<span class="s">// if you have another type of object you can use the built-in dump() method</span>
<span class="s">class PetLover {</span>
<span class="s">    def name</span>
<span class="s">    def age</span>
<span class="s">    def pets</span>
<span class="s">}</span>
<span class="s">p = new PetLover(name:&#39;Jason&#39;, age:23, pets:[dog:&#39;Rover&#39;,cat:&#39;Garfield&#39;])</span>
<span class="s">println p</span>
<span class="s">// =&gt; PetLover@b957ea</span>
<span class="s">println p.dump()</span>
<span class="s">// =&gt; &lt;PetLover@b957ea name=Jason age=23 pets=[&quot;cat&quot;:&quot;Garfield&quot;, &quot;dog&quot;:&quot;Rover&quot;]&gt;</span>

<span class="s">// If that isn&#39;t good enough, you can use Boost (http://tara-indigo.org/</span><span class="n">daisy</span><span class="s">/geekscape/</span><span class="n">g2</span><span class="s">/128)</span>
<span class="s">// or Jakarta Commons Lang *ToStringBuilders (jakarta.apache.org/</span><span class="n">commons</span><span class="o">)</span>
<span class="c1">// Here&#39;s an example of Boost, just extend the supplied Primordial class</span>
<span class="kn">import</span> <span class="nn">au.net.netstorm.boost.primordial.Primordial</span>
<span class="kd">class</span> <span class="nc">PetLover2</span> <span class="kd">extends</span> <span class="n">Primordial</span> <span class="o">{</span> <span class="kt">def</span> <span class="n">name</span><span class="o">,</span> <span class="n">age</span><span class="o">,</span> <span class="n">pets</span> <span class="o">}</span>
<span class="n">println</span> <span class="k">new</span> <span class="nf">PetLover2</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;Jason&#39;</span><span class="o">,</span> <span class="nl">age:</span><span class="mi">23</span><span class="o">,</span> <span class="nl">pets:</span><span class="o">[</span><span class="nl">dog:</span><span class="s1">&#39;Rover&#39;</span><span class="o">,</span><span class="nl">cat:</span><span class="s1">&#39;Garfield&#39;</span><span class="o">])</span>
<span class="c1">// =&gt;</span>
<span class="c1">// PetLover2[</span>
<span class="c1">//     name=Jason</span>
<span class="c1">//     age=23</span>
<span class="c1">//     pets={cat=Garfield, dog=Rover}</span>
<span class="c1">//     metaClass=groovy.lang.MetaClassImpl@1d8d39f[class PetLover2]</span>
<span class="c1">// ]</span>

<span class="c1">// using Commons Lang ReflectionToStringBuilder (equivalent to dump())</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang.builder.*</span>
<span class="kd">class</span> <span class="nc">PetLover3</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">name</span><span class="o">,</span> <span class="n">age</span><span class="o">,</span> <span class="n">pets</span>
    <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">ReflectionToStringBuilder</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">println</span> <span class="k">new</span> <span class="nf">PetLover3</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;Jason&#39;</span><span class="o">,</span> <span class="nl">age:</span><span class="mi">23</span><span class="o">,</span> <span class="nl">pets:</span><span class="o">[</span><span class="nl">dog:</span><span class="s1">&#39;Rover&#39;</span><span class="o">,</span><span class="nl">cat:</span><span class="s1">&#39;Garfield&#39;</span><span class="o">])</span>
<span class="c1">// =&gt; PetLover3@196e136[name=Jason,age=23,pets={cat=Garfield, dog=Rover}]</span>

<span class="c1">// using Commons Lang ToStringBuilder if you want a custom format</span>
<span class="kd">class</span> <span class="nc">PetLover4</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">name</span><span class="o">,</span> <span class="n">dob</span><span class="o">,</span> <span class="n">pets</span>
    <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">def</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">dob</span><span class="o">.</span><span class="na">time</span><span class="o">;</span> <span class="kt">def</span> <span class="n">d2</span> <span class="o">=</span> <span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">()).</span><span class="na">time</span>
        <span class="kt">int</span> <span class="n">age</span> <span class="o">=</span> <span class="o">(</span><span class="n">d2</span> <span class="o">-</span> <span class="n">d1</span><span class="o">)</span><span class="s">/1000/</span><span class="mi">60</span><span class="s">/60/</span><span class="mi">24</span><span class="s">/365 // close approx good enough here</span>
<span class="s">        return new ToStringBuilder(this).</span>
<span class="s">            append(&quot;Pet Lover&#39;s name&quot;, name).</span>
<span class="s">            append(&#39;Pets&#39;, pets).</span>
<span class="s">            append(&#39;Age&#39;, age)</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">println new PetLover4(name:&#39;Jason&#39;, dob:new Date(83,03,04), pets:[dog:&#39;Rover&#39;,cat:&#39;Garfield&#39;])</span>
<span class="s">// =&gt; PetLover4@fdfc58[Pet Lover&#39;s name=Jason,Pets={cat=Garfield, dog=Rover},Age=23]</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_11.12</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">oldlist = [1, 2, 3]</span>
<span class="s">newlist = new ArrayList(oldlist) // shallow copy</span>
<span class="s">newlist = oldlist.clone() // shallow copy</span>

<span class="s">oldmap = [a:1, b:2, c:3]</span>
<span class="s">newmap = new HashMap(oldmap) // shallow copy</span>
<span class="s">newmap = oldmap.clone() // shallow copy</span>

<span class="s">oldarray = [1, 2, 3] as int[]</span>
<span class="s">newarray = oldarray.clone()</span>

<span class="s">// shallow copies copy a data structure, but don&#39;t copy the items in those</span>
<span class="s">// data structures so if there are nested data structures, both copy and</span>
<span class="s">// original will refer to the same object</span>
<span class="s">mylist = [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;]</span>
<span class="s">newlist = mylist.clone()</span>
<span class="s">mylist[0] = &quot;0&quot;</span>
<span class="s">println &quot;$mylist $newlist&quot;</span>
<span class="s">//=&gt; [&quot;0&quot;, &quot;2&quot;, &quot;3&quot;] [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;]</span>

<span class="s">mylist = [[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;], 4]</span>
<span class="s">newlist = mylist.clone()</span>
<span class="s">mylist[0][0] = &quot;0&quot;</span>
<span class="s">println &quot;$mylist $newlist&quot;</span>
<span class="s">//=&gt; [[&quot;0&quot;, &quot;2&quot;, &quot;3&quot;], 4] [[&quot;0&quot;, &quot;2&quot;, &quot;3&quot;], 4]</span>

<span class="s">// standard deep copy implementation</span>
<span class="s">def deepcopy(orig) {</span>
<span class="s">     bos = new ByteArrayOutputStream()</span>
<span class="s">     oos = new ObjectOutputStream(bos)</span>
<span class="s">     oos.writeObject(orig); oos.flush()</span>
<span class="s">     bin = new ByteArrayInputStream(bos.toByteArray())</span>
<span class="s">     ois = new ObjectInputStream(bin)</span>
<span class="s">     return ois.readObject()</span>
<span class="s">}</span>

<span class="s">newlist = deepcopy(oldlist) // deep copy</span>
<span class="s">newmap  = deepcopy(oldmap)  // deep copy</span>

<span class="s">mylist = [[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;], 4]</span>
<span class="s">newlist = deepcopy(mylist)</span>
<span class="s">mylist[0][0] = &quot;0&quot;</span>
<span class="s">println &quot;$mylist $newlist&quot;</span>
<span class="s">//=&gt; [[&quot;0&quot;, &quot;2&quot;, &quot;3&quot;], 4] [[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;], 4]</span>

<span class="s">// See also:</span>
<span class="s">// http://javatechniques.com/</span><span class="kd">public</span><span class="s">/java/</span><span class="n">docs</span><span class="s">/basics/</span><span class="n">low</span><span class="o">-</span><span class="n">memory</span><span class="o">-</span><span class="n">deep</span><span class="o">-</span><span class="n">copy</span><span class="o">.</span><span class="na">html</span>
<span class="c1">// http://javatechniques.com/public/java/docs/basics/faster-deep-copy.html</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_11.13</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// use Java&#39;s serialization capabilities as per 11.10</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_11.14</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// There are numerous mechanisms for persisting objects to disk</span>
<span class="c1">// using Groovy and Java mechanisms. Some are completely transparent,</span>
<span class="c1">// some require some initialization only, others make the persistence</span>
<span class="c1">// mechanisms visible. Here is a site that lists over 20 options:</span>
<span class="c1">// http://www.java-source.net/open-source/persistence</span>
<span class="c1">// (This list doesn&#39;t include EJB offerings which typically</span>
<span class="c1">// require an application server or XML-based options)</span>

<span class="c1">// We&#39;ll just consider one possibility from prevayler.sf.net.</span>
<span class="c1">// This package doesn&#39;t make changes to persistent data transparent;</span>
<span class="c1">// instead requiring an explicit call via a transaction object.</span>
<span class="c1">// It saves all such transaction objects in a journal file so</span>
<span class="c1">// that it can rollback the system any number of times (or if</span>
<span class="c1">// you make use of the timestamp feature) to a particular point</span>
<span class="c1">// in time. It can also be set up to create snapshots which</span>
<span class="c1">// consolidate all changes made up to a certain point. The</span>
<span class="c1">// journalling will begin again from that point.</span>
<span class="kn">import</span> <span class="nn">org.prevayler.*</span>
<span class="kd">class</span> <span class="nc">ImportantHash</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">map</span> <span class="o">=</span> <span class="o">[:]</span>
    <span class="kt">def</span> <span class="nf">putAt</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="n">map</span><span class="o">[</span><span class="n">key</span><span class="o">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">getAt</span><span class="o">(</span><span class="n">key</span><span class="o">)</span> <span class="o">{</span> <span class="n">map</span><span class="o">[</span><span class="n">key</span><span class="o">]</span> <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">StoreTransaction</span> <span class="kd">implements</span> <span class="n">Transaction</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">val</span>
    <span class="nf">StoreTransaction</span><span class="o">(</span><span class="n">val</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">}</span>
    <span class="kt">void</span> <span class="nf">executeOn</span><span class="o">(</span><span class="n">prevayler</span><span class="o">,</span> <span class="n">Date</span> <span class="n">ignored</span><span class="o">)</span> <span class="o">{</span> <span class="n">prevayler</span><span class="o">.</span><span class="na">putAt</span><span class="o">(</span><span class="n">val</span><span class="o">,</span><span class="n">val</span><span class="o">*</span><span class="mi">2</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>
<span class="kt">def</span> <span class="nf">save</span><span class="o">(</span><span class="n">n</span><span class="o">){</span> <span class="n">store</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">StoreTransaction</span><span class="o">(</span><span class="n">n</span><span class="o">))</span> <span class="o">}</span>
<span class="n">store</span> <span class="o">=</span> <span class="n">PrevaylerFactory</span><span class="o">.</span><span class="na">createPrevayler</span><span class="o">(</span><span class="k">new</span> <span class="n">ImportantHash</span><span class="o">(),</span> <span class="s2">&quot;pleac11&quot;</span><span class="o">)</span>
<span class="n">hash</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">prevalentSystem</span><span class="o">()</span>
<span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">save</span><span class="o">(</span><span class="n">i</span><span class="o">)</span>
<span class="o">}</span>
<span class="n">println</span> <span class="n">hash</span><span class="o">[</span><span class="mi">750</span><span class="o">]</span> <span class="c1">// =&gt; 1500</span>

<span class="n">store</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="n">hash</span> <span class="o">=</span> <span class="kc">null</span> <span class="c1">// *** could shutdown here</span>

<span class="n">store</span> <span class="o">=</span> <span class="n">PrevaylerFactory</span><span class="o">.</span><span class="na">createPrevayler</span><span class="o">(</span><span class="k">new</span> <span class="n">ImportantHash</span><span class="o">(),</span> <span class="s2">&quot;pleac11&quot;</span><span class="o">)</span>
<span class="n">hash</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">prevalentSystem</span><span class="o">()</span>
<span class="n">println</span> <span class="n">hash</span><span class="o">[</span><span class="mi">750</span><span class="o">]</span> <span class="c1">// =&gt; 1500</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_11.15</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// bintree - binary tree demo program</span>
<span class="kd">class</span> <span class="nc">BinaryTree</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">value</span><span class="o">,</span> <span class="n">left</span><span class="o">,</span> <span class="n">right</span>
    <span class="n">BinaryTree</span><span class="o">(</span><span class="n">val</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">val</span>
        <span class="n">left</span> <span class="o">=</span> <span class="kc">null</span>
        <span class="n">right</span> <span class="o">=</span> <span class="kc">null</span>
    <span class="o">}</span>

    <span class="c1">// insert given value into proper point of</span>
    <span class="c1">// provided tree.  If no tree provided,</span>
    <span class="c1">// use implicit pass by reference aspect of @_</span>
    <span class="c1">// to fill one in for our caller.</span>
    <span class="kt">def</span> <span class="nf">insert</span><span class="o">(</span><span class="n">val</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">left</span><span class="o">)</span> <span class="n">left</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">val</span><span class="o">)</span>
            <span class="k">else</span> <span class="n">left</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BinaryTree</span><span class="o">(</span><span class="n">val</span><span class="o">)</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">right</span><span class="o">)</span> <span class="n">right</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">val</span><span class="o">)</span>
            <span class="k">else</span> <span class="n">right</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BinaryTree</span><span class="o">(</span><span class="n">val</span><span class="o">)</span>
        <span class="o">}</span> <span class="k">else</span> <span class="n">println</span> <span class="s2">&quot;double&quot;</span> <span class="c1">// ignore double values</span>
    <span class="o">}</span>

    <span class="c1">// recurse on left child,</span>
    <span class="c1">// then show current value,</span>
    <span class="c1">// then recurse on right child.</span>
    <span class="kt">def</span> <span class="nf">inOrder</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">left</span><span class="o">)</span> <span class="n">left</span><span class="o">.</span><span class="na">inOrder</span><span class="o">()</span>
        <span class="n">print</span> <span class="n">value</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">right</span><span class="o">)</span> <span class="n">right</span><span class="o">.</span><span class="na">inOrder</span><span class="o">()</span>
    <span class="o">}</span>

    <span class="c1">// show current value,</span>
    <span class="c1">// then recurse on left child,</span>
    <span class="c1">// then recurse on right child.</span>
    <span class="kt">def</span> <span class="nf">preOrder</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">print</span> <span class="n">value</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">left</span><span class="o">)</span> <span class="n">left</span><span class="o">.</span><span class="na">preOrder</span><span class="o">()</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">right</span><span class="o">)</span> <span class="n">right</span><span class="o">.</span><span class="na">preOrder</span><span class="o">()</span>
    <span class="o">}</span>

    <span class="c1">// show current value,</span>
    <span class="c1">// then recurse on left child,</span>
    <span class="c1">// then recurse on right child.</span>
    <span class="kt">def</span> <span class="nf">dumpOrder</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">print</span> <span class="k">this</span><span class="o">.</span><span class="na">dump</span><span class="o">()</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">left</span><span class="o">)</span> <span class="n">left</span><span class="o">.</span><span class="na">dumpOrder</span><span class="o">()</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">right</span><span class="o">)</span> <span class="n">right</span><span class="o">.</span><span class="na">dumpOrder</span><span class="o">()</span>
    <span class="o">}</span>

    <span class="c1">// recurse on left child,</span>
    <span class="c1">// then recurse on right child,</span>
    <span class="c1">// then show current value.</span>
    <span class="kt">def</span> <span class="nf">postOrder</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">left</span><span class="o">)</span> <span class="n">left</span><span class="o">.</span><span class="na">postOrder</span><span class="o">()</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">right</span><span class="o">)</span> <span class="n">right</span><span class="o">.</span><span class="na">postOrder</span><span class="o">()</span>
        <span class="n">print</span> <span class="n">value</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
    <span class="o">}</span>

    <span class="c1">// find out whether provided value is in the tree.</span>
    <span class="c1">// if so, return the node at which the value was found.</span>
    <span class="c1">// cut down search time by only looking in the correct</span>
    <span class="c1">// branch, based on current value.</span>
    <span class="kt">def</span> <span class="nf">search</span><span class="o">(</span><span class="n">val</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">val</span> <span class="o">==</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">dump</span><span class="o">()</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">left</span> <span class="o">?</span> <span class="n">left</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">val</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">right</span> <span class="o">?</span> <span class="n">right</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">val</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// first generate 20 random inserts</span>
<span class="n">test</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BinaryTree</span><span class="o">(</span><span class="mi">500</span><span class="o">)</span>
<span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">()</span>
<span class="mi">20</span><span class="o">.</span><span class="na">times</span><span class="o">{</span>
    <span class="n">test</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">1000</span><span class="o">))</span>
<span class="o">}</span>

<span class="c1">// now dump out the tree all three ways</span>
<span class="n">print</span> <span class="s2">&quot;Pre order:  &quot;</span><span class="o">;</span> <span class="n">test</span><span class="o">.</span><span class="na">preOrder</span><span class="o">();</span>  <span class="n">println</span> <span class="s2">&quot;&quot;</span>
<span class="n">print</span> <span class="s2">&quot;In order:   &quot;</span><span class="o">;</span> <span class="n">test</span><span class="o">.</span><span class="na">inOrder</span><span class="o">();</span>   <span class="n">println</span> <span class="s2">&quot;&quot;</span>
<span class="n">print</span> <span class="s2">&quot;Post order: &quot;</span><span class="o">;</span> <span class="n">test</span><span class="o">.</span><span class="na">postOrder</span><span class="o">();</span> <span class="n">println</span> <span class="s2">&quot;&quot;</span>

<span class="n">println</span> <span class="s2">&quot;\nSearch?&quot;</span>
<span class="k">while</span> <span class="o">((</span><span class="n">item</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">()?.</span><span class="na">trim</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">println</span> <span class="n">test</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">toInteger</span><span class="o">())</span>
    <span class="n">println</span> <span class="s2">&quot;\nSearch?&quot;</span>
<span class="o">}</span>
<span class="c1">// Randomly produces a tree such as:</span>
<span class="c1">//           -------- 500 ------</span>
<span class="c1">//         /                     \</span>
<span class="c1">//       181                     847</span>
<span class="c1">//     /    \                    /  \</span>
<span class="c1">//   3       204              814   970</span>
<span class="c1">//    \       /  \            /</span>
<span class="c1">//    126  196  414        800</span>
<span class="c1">//             /   \       /</span>
<span class="c1">//          353   438   621</span>
<span class="c1">//                /     /  \</span>
<span class="c1">//             423    604   776</span>
<span class="c1">//                   /     /</span>
<span class="c1">//                 517   765</span>
<span class="c1">//                      /</span>
<span class="c1">//                    646</span>
<span class="c1">//                   /</span>
<span class="c1">//                 630</span>
<span class="c1">// Pre order:</span>
<span class="c1">// 500 181 3 126 204 196 414 353 438 423 847 814 800 621 604 517 776 765 646 630 970</span>
<span class="c1">// In order:</span>
<span class="c1">// 3 126 181 196 204 353 414 423 438 500 517 604 621 630 646 765 776 800 814 847 970</span>
<span class="c1">// Post order:</span>
<span class="c1">// 126 3 196 353 423 438 414 204 181 517 604 630 646 765 776 621 800 814 970 847 500</span>
<span class="c1">//</span>
<span class="c1">// Search?</span>
<span class="c1">// 125</span>
<span class="c1">// null</span>
<span class="c1">//</span>
<span class="c1">// Search?</span>
<span class="c1">// 126</span>
<span class="c1">// &lt;BinaryTree@ae97c4 value=126 left=null right=null&gt;</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_12.0</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy adopts many of the Java structuring conventions and terminology</span>
<span class="c1">// and adds some concepts of its own.</span>
<span class="c1">// Code-reuse can occur at the script, class, library, component or framework level.</span>
<span class="c1">// Source code including class file source and scripts are organised into packages.</span>
<span class="c1">// These can be thought of as like hierarchical folders or directories. Two class</span>
<span class="c1">// with the same name can be distinguished by having different packages. Compiled</span>
<span class="c1">// byte code and sometimes source code including scripts can be packaged up into</span>
<span class="c1">// jar files. Various conventions exist for packaging classes and resources in</span>
<span class="c1">// such a way to allow them to be easily reused. Some of these conventions allow</span>
<span class="c1">// reusable code to be placed within repositories for easy use by third parties.</span>
<span class="c1">// One such repository is the maven repository, e.g.: ibiblio.org/maven2</span>
<span class="c1">// When reusing classes, it is possible to compartmentalise knowledge of</span>
<span class="c1">// particular packages using multiple (potentially hierarchical) classloaders.</span>
<span class="c1">// By convention, package names are all lowercase. Class names are capitalized.</span>
<span class="c1">// Naming examples:</span>
<span class="c1">// package my.package1.name     // at most one per source file - at top of file</span>
<span class="c1">// class MyClass ...            // actually defines my.package1.name.MyClass</span>
<span class="c1">// import my.package1.name.MyClass  // allows package to be dropped within current file</span>
<span class="c1">// import my.package2.name.MyClass  // if class basenames are the same, can&#39;t</span>
<span class="c1">//                                  // import both, leave one fully qualified</span>
<span class="c1">// import my.package.name.*         // all classes in package can drop package prefix</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_12.1</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// No equivalent export process exists for Groovy.</span>

<span class="c1">// If you have some Groovy functionality that you would like others to use</span>
<span class="c1">// you either make the source code available or compile it into class files</span>
<span class="c1">// and package those up in a jar file. Some subset of your class files will</span>
<span class="c1">// define the OO interface to your functionality, e.g. public methods,</span>
<span class="c1">// interfaces, etc. Depending on the circumstances, various conventions are</span>
<span class="c1">// used to indicate this functionality including Manifest files, javadocs,</span>
<span class="c1">// deployment descriptors, project metadata and dependency management files.</span>
<span class="c1">// See 12.18 for an example.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_12.2</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy supports both static and dynamic (strong) typing. When trying to</span>
<span class="c1">// compile or run files using static typing, the required classes referenced</span>
<span class="c1">// must be available. Classes used in more dynamic ways may be loaded (or</span>
<span class="c1">// created) at runtime. Errors in loading such dynamic cases are handled</span>
<span class="c1">// using the normal exception handling mechanisms.</span>

<span class="c1">// attempt to load an unknown resource or script:</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">evaluate</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">&#39;doesnotexist.groovy&#39;</span><span class="o">))</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">FileNotFoundException</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s1">&#39;File not found, skipping ...&#39;</span>
<span class="o">}</span>
<span class="c1">// =&gt; File not found, skipping ...</span>

<span class="c1">// attempt to load an unknown class:</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s1">&#39;org.happytimes.LottoNumberGenerator&#39;</span><span class="o">)</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ClassNotFoundException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s1">&#39;Class not found, skipping ...&#39;</span>
<span class="o">}</span>
<span class="c1">// -&gt; Class not found, skipping ...</span>

<span class="c1">// dynamicallly look for a database driver (slight variation to original cookbook)</span>
<span class="c1">// Note: this hypothetical example ignores certain issues e.g. different url</span>
<span class="c1">// formats for configuration when establishing a connection with the driver</span>
<span class="n">candidates</span> <span class="o">=</span> <span class="o">[</span>
    <span class="s1">&#39;oracle.jdbc.OracleDriver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;com.ibm.db2.jcc.DB2Driver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;com.microsoft.jdbc.sqlserver.SQLServerDriver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;net.sourceforge.jtds.jdbc.Driver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;com.sybase.jdbc3.jdbc.SybDriver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;com.informix.jdbc.IfxDriver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;com.mysql.jdbc.Driver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;org.postgresql.Driver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;com.sap.dbtech.jdbc.DriverSapDB&#39;</span><span class="o">,</span>
    <span class="s1">&#39;org.hsqldb.jdbcDriver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;com.pointbase.jdbc.jdbcUniversalDriver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;org.apache.derby.jdbc.ClientDriver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;com.mckoi.JDBCDriver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;org.firebirdsql.jdbc.FBDriver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;sun.jdbc.odbc.JdbcOdbcDriver&#39;</span>
<span class="o">]</span>
<span class="n">loaded</span> <span class="o">=</span> <span class="kc">null</span>
<span class="k">for</span> <span class="o">(</span><span class="n">driver</span> <span class="k">in</span> <span class="n">candidates</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">loaded</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">driver</span><span class="o">).</span><span class="na">newInstance</span><span class="o">()</span>
        <span class="k">break</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span> <span class="cm">/* ignore */</span> <span class="o">}</span>
<span class="o">}</span>
<span class="n">println</span> <span class="n">loaded</span><span class="o">?.</span><span class="na">class</span><span class="o">?.</span><span class="na">name</span> <span class="c1">// =&gt; sun.jdbc.odbc.JdbcOdbcDriver</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_12.3</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// In Groovy (like Java), any static reference to an external class within</span>
<span class="c1">// your class will cause the external class to be loaded from the classpath.</span>
<span class="c1">// You can dynamically add to the classpath using:</span>
<span class="c1">// this.class.rootLoader.addURL(url)</span>
<span class="c1">// To delay loading of external classes, use Class.forName() or evaluate()</span>
<span class="c1">// the script separately as shown in 12.2.</span>

<span class="c1">// For the specific case of initialization code, here is another example:</span>
<span class="c1">// (The code within the anonymous { ... } block is called whenever the</span>
<span class="c1">// class is loaded.)</span>
<span class="kd">class</span> <span class="nc">DbHelper</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">driver</span>
    <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">properties</span><span class="o">.</span><span class="s1">&#39;driver&#39;</span> <span class="o">==</span> <span class="s1">&#39;oracle&#39;</span><span class="o">)</span>
            <span class="n">driver</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s1">&#39;oracle.jdbc.OracleDriver&#39;</span><span class="o">)</span>
        <span class="k">else</span>
            <span class="n">driver</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s1">&#39;sun.jdbc.odbc.JdbcOdbcDriver&#39;</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">println</span> <span class="k">new</span> <span class="nf">DbHelper</span><span class="o">().</span><span class="na">driver</span><span class="o">.</span><span class="na">name</span> <span class="c1">// =&gt; sun.jdbc.odbc.JdbcOdbcDriver</span>
<span class="c1">// call program with -Ddriver=oracle to swap to other driver</span>

<span class="c1">// A slightly related feature: If you want to load a script (typically in a</span>
<span class="c1">// server environment) whenever the source file changes, use GroovyScriptEngine()</span>
<span class="c1">// instead of GroovyShell() when embedding groovy.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_12.4</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// class variables are private unless access functions are defined</span>
<span class="kd">class</span> <span class="nc">Alpha</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="kd">private</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">12</span>
<span class="o">}</span>

<span class="n">println</span> <span class="k">new</span> <span class="nf">Alpha</span><span class="o">().</span><span class="na">x</span>    <span class="c1">// =&gt; 10</span>
<span class="n">println</span> <span class="k">new</span> <span class="nf">Alpha</span><span class="o">().</span><span class="na">y</span>    <span class="c1">// =&gt; 12 when referenced inside source file, error outside</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_12.5</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// You can examine the stacktrace to determine the calling class: see 10.4</span>
<span class="c1">// When executing a script from a groovy source file, you can either:</span>
<span class="n">println</span> <span class="nf">getClass</span><span class="o">().</span><span class="na">classLoader</span><span class="o">.</span><span class="na">resourceLoader</span><span class="o">.</span><span class="na">loadGroovySource</span><span class="o">(</span><span class="n">getClass</span><span class="o">().</span><span class="na">name</span><span class="o">)</span>
<span class="c1">// =&gt; file:/C:/Projects/GroovyExamples/Pleac/classes/pleac12.groovy</span>
<span class="c1">// or for the initially started script when started using the standard .bat/.sh files</span>
<span class="n">println</span> <span class="n">System</span><span class="o">.</span><span class="na">properties</span><span class="o">.</span><span class="s1">&#39;script.name&#39;</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_12.6</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// For code which executes at class startup, see the initialization code block</span>
<span class="c1">// mechanism mentioned in 12.3. For code which should execute during shutdown</span>
<span class="c1">// see the finalize() method discussed (including limitations) in 13.2.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_12.7</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Each JVM process may have its own classpath (and indeed its own version of Java</span>
<span class="c1">// runtime and libraries). You &quot;simply&quot; supply a classpath pointing to different</span>
<span class="c1">// locations to obtain different modules.</span>
<span class="c1">// Groovy augments the JVM behaviour by allowing individuals to have a ~/.groovy/lib</span>
<span class="c1">// directory with additional libraries (and potentially other resources).</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_12.8</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// To make your code available to others could involve any of the following:</span>
<span class="c1">// (1) make your source code available</span>
<span class="c1">// (2) if you are creating a standard class, use the jar tool to package the</span>
<span class="c1">//     compiled code into a jar - this is then added to the classpath to use</span>
<span class="c1">// (3) if the jar relies on additional jars, this is sometimes specified in</span>
<span class="c1">//     a special manifest file within the jar</span>
<span class="c1">// (4) if the code is designed to run within a container environment, there</span>
<span class="c1">//     might be additional packaging, e.g. servlets might be packaged in a war</span>
<span class="c1">//     file - essentially a jar file with extra metadata in xml format.</span>
<span class="c1">// (5) you might also supply your package to a well known repository such as the</span>
<span class="c1">//     maven repository - and you will add dependency information in xml format</span>
<span class="c1">// (6) you may use platform specific installers to produce easily installable</span>
<span class="c1">//     components (e.g. windows .exe files or linux rpm&#39;s)</span>
<span class="c1">// (7) you may spackage up your components as a plugin (e.g. as an eclipse plugin)</span>
<span class="c1">//     this is also typically in jar/zip like format with additional metadata</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_12.9</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy has no SelfLoader. Class loading can be delayed using external scripts</span>
<span class="c1">// and by using the Class.forName() approach discussed in 12.2/12.3. If you have</span>
<span class="c1">// critical performance issues, you can use these techniques and keep your class</span>
<span class="c1">// size small to maximise the ability to defer loading. There are other kinds of</span>
<span class="c1">// performance tradeoffs you can make too. Alot of work has been done with JIT</span>
<span class="c1">// (just in time) compilers for bytecode. You can pre-compile Groovy source files</span>
<span class="c1">// into bytecode using the groovy compiler (groovyc). You can also do this on</span>
<span class="c1">// the fly for scripts you know you are going to need shortly.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_12.10</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy has no AutoLoader. See the discussion in 12.9 for some techniques to</span>
<span class="c1">// impact program performance. There are many techniques available to speed up</span>
<span class="c1">// program performance (and in particular load speed). Some of these utilise</span>
<span class="c1">// techniques similar in nature to the technique used by the AutoLoader.</span>
<span class="c1">// As already mentioned, when you load a class into the JVM, any statically</span>
<span class="c1">// referenced class is also loaded. If you reference interfaces rather than</span>
<span class="c1">// concrete implementations, only the interface need be loaded. If you must</span>
<span class="c1">// reference a concrete implementation you can use either a Proxy class or</span>
<span class="c1">// classloader tricks to delay the loading of a full class (e.g. you supply a</span>
<span class="c1">// Proxy class with just one method implemented or a lazy-loading Proxy which</span>
<span class="c1">// loads the real class only when absolutely required)</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_12.11</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// You can use Categories to override Groovy and Java base functionality.</span>
<span class="n">println</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">().</span><span class="na">time</span> <span class="c1">// =&gt; 1169019557140</span>

<span class="kd">class</span> <span class="nc">DateCategory</span> <span class="o">{</span>  <span class="c1">// the class name by convention ends with category</span>
    <span class="c1">// we can add new functionality</span>
    <span class="kd">static</span> <span class="kt">float</span> <span class="nf">getFloatTime</span><span class="o">(</span><span class="n">Date</span> <span class="n">self</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span> <span class="n">self</span><span class="o">.</span><span class="na">getTime</span><span class="o">()</span>
    <span class="o">}</span>
    <span class="c1">// we can override existing functionality (now seconds since 1970 not millis)</span>
    <span class="kd">static</span> <span class="kt">long</span> <span class="nf">asSeconds</span><span class="o">(</span><span class="n">Date</span> <span class="n">self</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="o">(</span><span class="n">self</span><span class="o">.</span><span class="na">getTime</span><span class="o">()</span><span class="s">/1000)</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">use (DateCategory) {</span>
<span class="s">    println new Date().floatTime    // =&gt; 1.1690195E12</span>
<span class="s">    println new Date().asSeconds()  // =&gt; 1169019557</span>
<span class="s">}</span>

<span class="s">// We can also use the &#39;as&#39; keyword</span>
<span class="s">class MathLib {</span>
<span class="s">    def triple(n) { n * 4 }</span>
<span class="s">    def twice(n) { n * 2 }</span>
<span class="s">}</span>
<span class="s">def m = new MathLib()</span>
<span class="s">println m.twice(10)     // =&gt; 20</span>
<span class="s">println m.triple(10)    // =&gt; 40 (Intentional Bug!)</span>
<span class="s">// we might want to make use of some funtionality in the math</span>
<span class="s">// library but want to later some of its features slightly or fix</span>
<span class="s">// some bugs, we can simply import the original using a different name</span>
<span class="s">import MathLib as BuggyMathLib</span>
<span class="s">// now we could define our own MathLib which extended or had a delegate</span>
<span class="s">// of the BuggyMathLib class</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_12.12</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Many Java and Groovy programs emit a stacktrace when an error occurs.</span>
<span class="s">// This shows both the calling and called programs (with line numbers if</span>
<span class="s">// supplied). Groovy pretties up stacktraces to show less noise. You can use -d</span>
<span class="s">// or --debug on the commandline to force it to always produce full stacktraces.</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_12.13</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// already have log10, how to create log11 to log100</span>
<span class="s">(11..100).each { int base -&gt;</span>
<span class="s">    binding.&quot;log$base&quot; = { int n -&gt; Math.log(n) /</span> <span class="n">Math</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">base</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>
<span class="n">println</span> <span class="nf">log20</span><span class="o">(</span><span class="mi">400</span><span class="o">)</span>  <span class="c1">// =&gt; 2.0</span>
<span class="n">println</span> <span class="nf">log100</span><span class="o">(</span><span class="mi">1000000</span><span class="o">)</span>  <span class="c1">// =&gt; 3.0 (displays 2.9999999999999996 using doubles)</span>

<span class="c1">// same thing again use currying</span>
<span class="kt">def</span> <span class="n">logAnyBase</span> <span class="o">=</span> <span class="o">{</span> <span class="n">base</span><span class="o">,</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">Math</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="s">/ Math.log(base) }</span>
<span class="s">(11..100).each { int base -&gt;</span>
<span class="s">    binding.&quot;log$base&quot; = logAnyBase.curry(base)</span>
<span class="s">}</span>
<span class="s">println log20(400)  // =&gt; 2.0</span>
<span class="s">println log100(1000000)  // =&gt; 3.0 (displays 2.9999999999999996 using doubles)</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_12.14</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Groovy intefaces with C in the same way as Java: using JNI</span>
<span class="s">// For this discussion we will ignoring platform specific options and CORBA.</span>
<span class="s">// This tutorial here describes how to allow Java (and hence Groovy) to</span>
<span class="s">// call a C program which generates UUIDs:</span>
<span class="s">// http://ringlord.com/</span><span class="n">publications</span><span class="s">/jni-howto/</span>
<span class="c1">// Here&#39;s another useful reference:</span>
<span class="c1">// http://weblogs.java.net/blog/kellyohair/archive/2006/01/compilation_of_1.html</span>
<span class="c1">// And of course, Sun&#39;s tutorial:</span>
<span class="c1">// http://java.sun.com/developer/onlineTraining/Programming/JDCBook/jni.html</span>

<span class="c1">// You might also want to consider SWIG which simplifies connecting</span>
<span class="c1">// C/C++ to many scripting languages including Java (and hence Groovy)</span>
<span class="c1">// More details: http://www.swig.org/</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_12.15</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// See discussion for 12.14</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_12.16</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// The standard documentation system for Java is JavaDoc.</span>
<span class="c1">// Documentation for JavaDoc is part of a Java installation.</span>
<span class="c1">// Groovy has a GroovyDoc tool planned which expands upon the JavaDoc tool</span>
<span class="c1">// but work on the tool hasn&#39;t progressed much as yet.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_12.17</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Most libraries for Java (and hence Groovy) come precompiled. You simply download</span>
<span class="c1">// the jar and place it somewhere on your CLASSPATH.</span>

<span class="c1">// If only source code is available, you need to download the source and follow any</span>
<span class="c1">// instuctions which came with the source. Most projects use one of a handful of</span>
<span class="c1">// build tools to compile, test and package their artifacts. Typical ones are Ant</span>
<span class="c1">// and Maven which you need to install according to their respective instructions.</span>

<span class="c1">// If using Ant, you need to unpack the source files then type &#39;ant&#39;.</span>

<span class="c1">// If using Maven, you need to unpack the source files then type &#39;maven&#39;.</span>

<span class="c1">// If you are using Maven or Ivy for dependency management you can add</span>
<span class="c1">// the following lines to your project description file.</span>
<span class="cm">/*</span>
<span class="cm">    &lt;dependency&gt;</span>
<span class="cm">      &lt;groupId&gt;commons-collections&lt;/groupId&gt;</span>
<span class="cm">      &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;</span>
<span class="cm">      &lt;version&gt;3.2&lt;/version&gt;</span>
<span class="cm">    &lt;/dependency&gt;</span>
<span class="cm">*/</span>
<span class="c1">// This will automatically download the particular version of the referenced</span>
<span class="c1">// library file and also provide hooks so that you can make this automatically</span>
<span class="c1">// available in your classpath.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_12.18</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// example groovy file for a &quot;module&quot;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang.WordUtils</span>

<span class="kd">class</span> <span class="nc">Greeter</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">name</span>
    <span class="nf">Greeter</span><span class="o">(</span><span class="n">who</span><span class="o">)</span> <span class="o">{</span> <span class="n">name</span> <span class="o">=</span> <span class="n">WordUtils</span><span class="o">.</span><span class="na">capitalize</span><span class="o">(</span><span class="n">who</span><span class="o">)</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">salute</span><span class="o">()</span> <span class="o">{</span> <span class="s2">&quot;Hello $name!&quot;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// test class</span>
<span class="kd">class</span> <span class="nc">GreeterTest</span> <span class="kd">extends</span> <span class="n">GroovyTestCase</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="nf">testGreeting</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">assert</span> <span class="k">new</span> <span class="nf">Greeter</span><span class="o">(</span><span class="s1">&#39;world&#39;</span><span class="o">).</span><span class="na">salute</span><span class="o">()</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Typical Ant build file (could be in Groovy instead of XML):</span>
<span class="cm">/*</span>
<span class="cm">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="cm">&lt;project name=&quot;sample&quot; default=&quot;jar&quot; basedir=&quot;.&quot;&gt;</span>
<span class="cm">    &lt;property name=&quot;src&quot; value=&quot;src&quot;/&gt;</span>
<span class="cm">    &lt;property name=&quot;build&quot; value=&quot;build&quot;/&gt;</span>

<span class="cm">    &lt;target name=&quot;init&quot;&gt;</span>
<span class="cm">        &lt;mkdir dir=&quot;${build}&quot;/&gt;</span>
<span class="cm">    &lt;/target&gt;</span>

<span class="cm">    &lt;target name=&quot;compile&quot; depends=&quot;init&quot;&gt;</span>
<span class="cm">        &lt;mkdir dir=&quot;${build}/classes&quot;/&gt;</span>
<span class="cm">        &lt;groovyc srcdir=&quot;${src}&quot; destdir=&quot;${build}/classes&quot;/&gt;</span>
<span class="cm">    &lt;/target&gt;</span>

<span class="cm">    &lt;target name=&quot;test&quot; depends=&quot;compile&quot;&gt;</span>
<span class="cm">        &lt;groovy src=&quot;${src}/GreeterTest.groovy&quot;&gt;</span>
<span class="cm">    &lt;/target&gt;</span>

<span class="cm">    &lt;target name=&quot;jar&quot; depends=&quot;compile,test&quot;&gt;</span>
<span class="cm">        &lt;mkdir dir=&quot;${build}/jar&quot;/&gt;</span>
<span class="cm">        &lt;jar destfile=&quot;${build}/jar/Greeter.jar&quot; basedir=&quot;${build}/classes&quot;&gt;</span>
<span class="cm">            &lt;manifest&gt;</span>
<span class="cm">                &lt;attribute name=&quot;Main-Class&quot; value=&quot;Greeter&quot;/&gt;</span>
<span class="cm">            &lt;/manifest&gt;</span>
<span class="cm">        &lt;/jar&gt;</span>
<span class="cm">    &lt;/target&gt;</span>
<span class="cm">&lt;/project&gt;</span>

<span class="cm">*/</span>

<span class="c1">// Typical dependency management file</span>
<span class="cm">/*</span>
<span class="cm">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cm">&lt;project</span>
<span class="cm">  xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
<span class="cm">  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="cm">  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0</span>
<span class="cm">          http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;</span>
<span class="cm">  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span>
<span class="cm">  &lt;groupId&gt;groovy&lt;/groupId&gt;</span>
<span class="cm">  &lt;artifactId&gt;module&lt;/artifactId&gt;</span>
<span class="cm">  &lt;name&gt;Greeter&lt;/name&gt;</span>
<span class="cm">  &lt;version&gt;1.0&lt;/version&gt;</span>
<span class="cm">  &lt;packaging&gt;jar&lt;/packaging&gt;</span>
<span class="cm">  &lt;description&gt;Greeter Module/description&gt;</span>
<span class="cm">  &lt;dependencies&gt;</span>
<span class="cm">    &lt;dependency&gt;</span>
<span class="cm">      &lt;groupId&gt;commons-lang&lt;/groupId&gt;</span>
<span class="cm">      &lt;artifactId&gt;commons-lang&lt;/artifactId&gt;</span>
<span class="cm">      &lt;version&gt;2.2&lt;/version&gt;</span>
<span class="cm">    &lt;/dependency&gt;</span>
<span class="cm">  &lt;/dependencies&gt;</span>
<span class="cm">&lt;/project&gt;</span>
<span class="cm">*/</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_12.19</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Searching available modules in repositories:</span>
<span class="c1">// You can browse the repositories online, e.g. ibiblio.org/maven2 or various</span>
<span class="c1">// plugins are available for IDEs which do this for you, e.g. JarJuggler for IntelliJ.</span>

<span class="c1">// Searching currently &quot;installed&quot; modules:</span>
<span class="c1">// Browse your install directory, view your maven POM file, look in your ~/.groovy/lib</span>
<span class="c1">// directory, turn on debug modes and watch classloader messages ...</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_13.0</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Classes and objects in Groovy are rather straigthforward</span>
<span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="c1">// Class variables (also called static attributes) are prefixed by the keyword static</span>
    <span class="kd">static</span> <span class="n">personCounter</span><span class="o">=</span><span class="mi">0</span>
    <span class="kt">def</span> <span class="n">age</span><span class="o">,</span> <span class="n">name</span>               <span class="c1">// this creates setter and getter methods</span>
    <span class="kd">private</span> <span class="n">alive</span>

    <span class="c1">// object constructor</span>
    <span class="n">Person</span><span class="o">(</span><span class="n">age</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">alive</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span> <span class="o">{</span>            <span class="c1">// Default arg like in C++</span>
        <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">this</span><span class="o">.</span><span class="na">alive</span> <span class="o">=</span> <span class="n">alive</span>
        <span class="n">personCounter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1">// There is a &#39;++&#39; operator in Groovy but using += is often clearer.</span>
    <span class="o">}</span>

    <span class="kt">def</span> <span class="nf">die</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">alive</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="n">println</span> <span class="s2">&quot;$name has died at the age of $age.&quot;</span>
        <span class="n">alive</span>
    <span class="o">}</span>

    <span class="kt">def</span> <span class="nf">kill</span><span class="o">(</span><span class="n">anotherPerson</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">println</span> <span class="s2">&quot;$name is killing $anotherPerson.name.&quot;</span>
        <span class="n">anotherPerson</span><span class="o">.</span><span class="na">die</span><span class="o">()</span>
    <span class="o">}</span>

    <span class="c1">// methods used as queries generally start with is, are, will or can</span>
    <span class="c1">// usually have the &#39;?&#39; suffix</span>
    <span class="kt">def</span> <span class="nf">isStillAlive</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">alive</span>
    <span class="o">}</span>

    <span class="kt">def</span> <span class="nf">getYearOfBirth</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">new</span> <span class="nf">Date</span><span class="o">().</span><span class="na">year</span> <span class="o">-</span> <span class="n">age</span>
    <span class="o">}</span>

    <span class="c1">// Class method (also called static method)</span>
    <span class="kd">static</span> <span class="nf">getNumberOfPeople</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// accessors often start with get</span>
                                 <span class="c1">// in which case you can call it like</span>
                                 <span class="c1">// it was a field (without the get)</span>
        <span class="n">personCounter</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Using the class:</span>
<span class="c1">// Create objects of class Person</span>
<span class="n">lecter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="mi">47</span><span class="o">,</span> <span class="s1">&#39;Hannibal&#39;</span><span class="o">)</span>
<span class="n">starling</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="mi">29</span><span class="o">,</span> <span class="s1">&#39;Clarice&#39;</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="n">pazzi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="mi">40</span><span class="o">,</span> <span class="s1">&#39;Rinaldo&#39;</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>

<span class="c1">// Calling a class method</span>
<span class="n">println</span> <span class="s2">&quot;There are $Person.numberOfPeople Person objects.&quot;</span>

<span class="n">println</span> <span class="s2">&quot;$pazzi.name is ${pazzi.alive ? &#39;alive&#39; : &#39;dead&#39;}.&quot;</span>
<span class="n">lecter</span><span class="o">.</span><span class="na">kill</span><span class="o">(</span><span class="n">pazzi</span><span class="o">)</span>
<span class="n">println</span> <span class="s2">&quot;$pazzi.name is ${pazzi.isStillAlive() ? &#39;alive&#39; : &#39;dead&#39;}.&quot;</span>

<span class="n">println</span> <span class="s2">&quot;$starling.name was born in $starling.yearOfBirth.&quot;</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_13.1</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Classes may have no constructor.</span>
<span class="kd">class</span> <span class="nc">MyClass</span> <span class="o">{</span> <span class="o">}</span>

<span class="n">aValidButNotVeryUsefulObject</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyClass</span><span class="o">()</span>

<span class="c1">// If no explicit constructor is given a default implicit</span>
<span class="c1">// one which supports named parameters is provided.</span>
<span class="kd">class</span> <span class="nc">MyClass2</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">start</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">()</span>
    <span class="kt">def</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">0</span>
<span class="o">}</span>
<span class="n">println</span> <span class="k">new</span> <span class="nf">MyClass2</span><span class="o">(</span><span class="nl">age:</span><span class="mi">4</span><span class="o">).</span><span class="na">age</span> <span class="c1">// =&gt; 4</span>

<span class="c1">// One or more explicit constructors may also be provided</span>
<span class="kd">class</span> <span class="nc">MyClass3</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">start</span>
    <span class="kt">def</span> <span class="n">age</span>
    <span class="nf">MyClass3</span><span class="o">(</span><span class="n">date</span><span class="o">,</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">date</span>
        <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">println</span> <span class="k">new</span> <span class="nf">MyClass3</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">(),</span> <span class="mi">20</span><span class="o">).</span><span class="na">age</span> <span class="c1">// =&gt; 20</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_13.2</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Objects are destroyed by the JVM garbage collector.</span>
<span class="c1">// The time of destroying is not predicated but left up to the JVM.</span>
<span class="c1">// There is no direct support for destructor. There is a courtesy</span>
<span class="c1">// method called finalize() which the JVM may call when disposing</span>
<span class="c1">// an object. If you need to free resources for an object, like</span>
<span class="c1">// closing a socket or killing a spawned subprocess, you should do</span>
<span class="c1">// it explicitly - perhaps by supporting your own lifecycle methods</span>
<span class="c1">// on your class, e.g. close().</span>

<span class="kd">class</span> <span class="nc">MyClass4</span><span class="o">{</span>
    <span class="kt">void</span> <span class="nf">finalize</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">println</span> <span class="s2">&quot;Object [internal id=${hashCode()}] is dying at ${new Date()}&quot;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// test code</span>
<span class="mi">50</span><span class="o">.</span><span class="na">times</span> <span class="o">{</span>
    <span class="k">new</span> <span class="nf">MyClass4</span><span class="o">()</span>
<span class="o">}</span>
<span class="mi">20</span><span class="o">.</span><span class="na">times</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">gc</span><span class="o">()</span>
<span class="o">}</span>
<span class="c1">// =&gt; (between 0 and 50 lines similar to below)</span>
<span class="c1">// Object [internal id=10884088] is dying at Wed Jan 10 16:33:33 EST 2007</span>
<span class="c1">// Object [internal id=6131844] is dying at Wed Jan 10 16:33:33 EST 2007</span>
<span class="c1">// Object [internal id=12245160] is dying at Wed Jan 10 16:33:33 EST 2007</span>
<span class="c1">// ...</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_13.3</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// You can write getter and setter methods explicitly as shown below.</span>
<span class="c1">// One convention is to use set and get at the start of method names.</span>
<span class="kd">class</span> <span class="nc">Person2</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">name</span>
    <span class="kt">def</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span> <span class="n">name</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">setName</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// You can also just use def which auto defines default getters and setters.</span>
<span class="kd">class</span> <span class="nc">Person3</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">age</span><span class="o">,</span> <span class="n">name</span>
<span class="o">}</span>

<span class="c1">// Any variables marked as final will only have a default getter.</span>
<span class="c1">// You can also write an explicit getter. For a write-only variable</span>
<span class="c1">// just write only a setter.</span>
<span class="kd">class</span> <span class="nc">Person4</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">age</span>      <span class="c1">// getter only</span>
    <span class="kt">def</span> <span class="n">name</span>       <span class="c1">// getter and setter</span>
    <span class="kd">private</span> <span class="n">color</span>  <span class="c1">// private</span>
    <span class="kt">def</span> <span class="nf">setColor</span><span class="o">()</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">color</span> <span class="o">=</span> <span class="n">color</span> <span class="o">}</span> <span class="c1">// setter only</span>
<span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_13.4</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="kd">class</span> <span class="nc">Person5</span> <span class="o">{</span>
    <span class="c1">// Class variables (also called static attributes) are prefixed by the keyword static</span>
    <span class="kd">static</span> <span class="n">personCounter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kd">static</span> <span class="nf">getPopulation</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">personCounter</span>
    <span class="o">}</span>
    <span class="n">Person5</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">personCounter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="o">}</span>
    <span class="kt">void</span> <span class="nf">finalize</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">personCounter</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">people</span> <span class="o">=</span> <span class="o">[]</span>
<span class="mi">10</span><span class="o">.</span><span class="na">times</span> <span class="o">{</span>
    <span class="n">people</span> <span class="o">+=</span> <span class="k">new</span> <span class="n">Person5</span><span class="o">()</span>
<span class="o">}</span>
<span class="n">println</span> <span class="s2">&quot;There are ${Person5.population} people alive&quot;</span>
<span class="c1">// =&gt; There are 10 people alive</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FixedArray</span><span class="o">()</span>
<span class="n">println</span> <span class="s2">&quot;Bound on alpha is $alpha.maxBounds&quot;</span>

<span class="n">beta</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FixedArray</span><span class="o">()</span>
<span class="n">beta</span><span class="o">.</span><span class="na">maxBounds</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">println</span> <span class="s2">&quot;Bound on alpha is $alpha.maxBounds&quot;</span>

<span class="kd">class</span> <span class="nc">FixedArray</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="n">maxBounds</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="kt">def</span> <span class="nf">getMaxBounds</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">maxBounds</span>
    <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">setMaxBounds</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">maxBounds</span> <span class="o">=</span> <span class="n">value</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Bound on alpha is 100</span>
<span class="c1">// Bound on alpha is 50</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_13.5</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// The fields of this struct-like class are dynamically typed</span>
<span class="kd">class</span> <span class="nc">DynamicPerson</span> <span class="o">{</span> <span class="kt">def</span> <span class="n">name</span><span class="o">,</span> <span class="n">age</span><span class="o">,</span> <span class="n">peers</span> <span class="o">}</span>
<span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DynamicPerson</span><span class="o">()</span>
<span class="n">p</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="s2">&quot;Jason Smythe&quot;</span>
<span class="n">p</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="mi">13</span>
<span class="n">p</span><span class="o">.</span><span class="na">peers</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;Wilbur&quot;</span><span class="o">,</span> <span class="s2">&quot;Ralph&quot;</span><span class="o">,</span> <span class="s2">&quot;Fred&quot;</span><span class="o">]</span>
<span class="n">p</span><span class="o">.</span><span class="na">setPeers</span><span class="o">([</span><span class="s2">&quot;Wilbur&quot;</span><span class="o">,</span> <span class="s2">&quot;Ralph&quot;</span><span class="o">,</span> <span class="s2">&quot;Fred&quot;</span><span class="o">])</span>     <span class="c1">// alternative using implicit setter</span>
<span class="n">p</span><span class="o">[</span><span class="s2">&quot;peers&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;Wilbur&quot;</span><span class="o">,</span> <span class="s2">&quot;Ralph&quot;</span><span class="o">,</span> <span class="s2">&quot;Fred&quot;</span><span class="o">]</span>    <span class="c1">// alternative access using name of field</span>
<span class="n">println</span> <span class="s2">&quot;At age $p.age, $p.name&#39;s first friend is ${p.peers[0]}&quot;</span>
<span class="c1">// =&gt; At age 13, Jason Smythe&#39;s first friend is Wilbur</span>

<span class="c1">// The fields of this struct-like class are statically typed</span>
<span class="kd">class</span> <span class="nc">StaticPerson</span> <span class="o">{</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span> <span class="n">List</span> <span class="n">peers</span> <span class="o">}</span>
<span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StaticPerson</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;Jason&#39;</span><span class="o">,</span> <span class="nl">age:</span><span class="mi">14</span><span class="o">,</span> <span class="nl">peers:</span><span class="o">[</span><span class="s1">&#39;Fred&#39;</span><span class="o">,</span><span class="s1">&#39;Wilbur&#39;</span><span class="o">,</span><span class="s1">&#39;Ralph&#39;</span><span class="o">])</span>
<span class="n">println</span> <span class="s2">&quot;At age $p.age, $p.name&#39;s first friend is ${p.peers[0]}&quot;</span>
<span class="c1">// =&gt; At age 14, Jason&#39;s first friend is Fred</span>


<span class="kd">class</span> <span class="nc">Family</span> <span class="o">{</span> <span class="kt">def</span> <span class="n">head</span><span class="o">,</span> <span class="n">address</span><span class="o">,</span> <span class="n">members</span> <span class="o">}</span>
<span class="n">folks</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Family</span><span class="o">(</span><span class="nl">head:</span><span class="k">new</span> <span class="n">DynamicPerson</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;John&#39;</span><span class="o">,</span><span class="nl">age:</span><span class="mi">34</span><span class="o">))</span>

<span class="c1">// supply of own accessor method for the struct for error checking</span>
<span class="kd">class</span> <span class="nc">ValidatingPerson</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">age</span>
    <span class="kt">def</span> <span class="nf">printAge</span><span class="o">()</span> <span class="o">{</span> <span class="n">println</span> <span class="s1">&#39;Age=&#39;</span> <span class="o">+</span> <span class="n">age</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">setAge</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!(</span><span class="n">value</span> <span class="k">instanceof</span> <span class="n">Integer</span><span class="o">))</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s2">&quot;Argument &#39;${value}&#39; isn&#39;t an Integer&quot;</span><span class="o">)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s2">&quot;Age ${value} is unreasonable&quot;</span><span class="o">)</span>
        <span class="n">age</span> <span class="o">=</span> <span class="n">value</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// test ValidatingPerson</span>
<span class="kt">def</span> <span class="nf">tryCreate</span><span class="o">(</span><span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="k">new</span> <span class="nf">ValidatingPerson</span><span class="o">(</span><span class="nl">age:</span><span class="n">arg</span><span class="o">).</span><span class="na">printAge</span><span class="o">()</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">println</span> <span class="n">ex</span><span class="o">.</span><span class="na">message</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">tryCreate</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span>
<span class="n">tryCreate</span><span class="o">(</span><span class="s1">&#39;Youngish&#39;</span><span class="o">)</span>
<span class="n">tryCreate</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Age=20</span>
<span class="c1">// Argument &#39;Youngish&#39; isn&#39;t an Integer</span>
<span class="c1">// Age 200 is unreasonable</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_13.6</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy objects are (loosely speaking) extended Java objects.</span>
<span class="c1">// Java&#39;s Object class provides a clone() method. The conventions of</span>
<span class="c1">// clone() are that if I say a = b.clone() then a and b should be</span>
<span class="c1">// different objects with the same type and value. Java doesn&#39;t</span>
<span class="c1">// enforce a class to implement a clone() method at all let alone</span>
<span class="c1">// require that one has to meet these conventions. Classes which</span>
<span class="c1">// do support clone() should implement the Cloneable interface and</span>
<span class="c1">// implement an equals() method.</span>
<span class="c1">// Groovy follows Java&#39;s conventions for clone().</span>

<span class="kd">class</span> <span class="nc">A</span> <span class="kd">implements</span> <span class="n">Cloneable</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">name</span>
    <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">other</span> <span class="k">instanceof</span> <span class="n">A</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">name</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">ob1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">A</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;My named thing&#39;</span><span class="o">)</span>

<span class="n">ob2</span> <span class="o">=</span> <span class="n">ob1</span><span class="o">.</span><span class="na">clone</span><span class="o">()</span>
<span class="k">assert</span> <span class="o">!</span><span class="n">ob1</span><span class="o">.</span><span class="na">is</span><span class="o">(</span><span class="n">ob2</span><span class="o">)</span>
<span class="k">assert</span> <span class="n">ob1</span><span class="o">.</span><span class="na">class</span> <span class="o">==</span> <span class="n">ob2</span><span class="o">.</span><span class="na">class</span>
<span class="k">assert</span> <span class="n">ob2</span><span class="o">.</span><span class="na">name</span> <span class="o">==</span> <span class="n">ob1</span><span class="o">.</span><span class="na">name</span>
<span class="k">assert</span> <span class="n">ob1</span> <span class="o">==</span> <span class="n">ob2</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_13.7</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="kd">class</span> <span class="nc">CanFlicker</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="nf">flicker</span><span class="o">(</span><span class="n">arg</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">arg</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">}</span>
<span class="o">}</span>
<span class="n">methname</span> <span class="o">=</span> <span class="s1">&#39;flicker&#39;</span>
<span class="k">assert</span> <span class="k">new</span> <span class="nf">CanFlicker</span><span class="o">().</span><span class="na">invokeMethod</span><span class="o">(</span><span class="n">methname</span><span class="o">,</span> <span class="mi">10</span><span class="o">)</span> <span class="o">==</span> <span class="mi">20</span>
<span class="k">assert</span> <span class="k">new</span> <span class="nf">CanFlicker</span><span class="o">().</span><span class="s2">&quot;$methname&quot;</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span> <span class="o">==</span> <span class="mi">20</span>

<span class="kd">class</span> <span class="nc">NumberEcho</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="nf">one</span><span class="o">()</span> <span class="o">{</span> <span class="mi">1</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">two</span><span class="o">()</span> <span class="o">{</span> <span class="mi">2</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">three</span><span class="o">()</span> <span class="o">{</span> <span class="mi">3</span> <span class="o">}</span>
<span class="o">}</span>
<span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NumberEcho</span><span class="o">()</span>
<span class="c1">// call methods on the object, by name</span>
<span class="k">assert</span> <span class="o">[</span><span class="s1">&#39;one&#39;</span><span class="o">,</span> <span class="s1">&#39;two&#39;</span><span class="o">,</span> <span class="s1">&#39;three&#39;</span><span class="o">,</span> <span class="s1">&#39;two&#39;</span><span class="o">,</span> <span class="s1">&#39;one&#39;</span><span class="o">].</span><span class="na">collect</span><span class="o">{</span> <span class="n">obj</span><span class="o">.</span><span class="s2">&quot;$it&quot;</span><span class="o">()</span> <span class="o">}.</span><span class="na">join</span><span class="o">()</span> <span class="o">==</span> <span class="s1">&#39;12321&#39;</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_13.8</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy can work with Groovy objects which inherit from a common base</span>
<span class="c1">// class called GroovyObject or Java objects which inherit from Object.</span>

<span class="c1">// the class of the object</span>
<span class="k">assert</span> <span class="s1">&#39;a string&#39;</span><span class="o">.</span><span class="na">class</span> <span class="o">==</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span>

<span class="c1">// Groovy classes are actually objects of class Class and they</span>
<span class="c1">// respond to methods defined in the Class class as well</span>
<span class="k">assert</span> <span class="s1">&#39;a string&#39;</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">class</span> <span class="o">==</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span>
<span class="k">assert</span> <span class="o">!</span><span class="s1">&#39;a string&#39;</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isArray</span><span class="o">()</span>

<span class="c1">// ask an object whether it is an instance of particular class</span>
<span class="n">n</span> <span class="o">=</span> <span class="mf">4.7f</span>
<span class="n">println</span> <span class="o">(</span><span class="n">n</span> <span class="k">instanceof</span> <span class="n">Integer</span><span class="o">)</span>          <span class="c1">// false</span>
<span class="n">println</span> <span class="o">(</span><span class="n">n</span> <span class="k">instanceof</span> <span class="n">Float</span><span class="o">)</span>            <span class="c1">// true</span>
<span class="n">println</span> <span class="o">(</span><span class="n">n</span> <span class="k">instanceof</span> <span class="n">Double</span><span class="o">)</span>           <span class="c1">// false</span>
<span class="n">println</span> <span class="o">(</span><span class="n">n</span> <span class="k">instanceof</span> <span class="n">String</span><span class="o">)</span>           <span class="c1">// false</span>
<span class="n">println</span> <span class="o">(</span><span class="n">n</span> <span class="k">instanceof</span> <span class="n">StaticPerson</span><span class="o">)</span>     <span class="c1">// false</span>

<span class="c1">// ask if a class or interface is either the same as, or is a</span>
<span class="c1">// superclass or superinterface of another class</span>
<span class="n">println</span> <span class="n">n</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">Float</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>       <span class="c1">// true</span>
<span class="n">println</span> <span class="n">n</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>      <span class="c1">// false</span>

<span class="c1">// can a Groovy object respond to a particular method?</span>
<span class="k">assert</span> <span class="k">new</span> <span class="nf">CanFlicker</span><span class="o">().</span><span class="na">metaClass</span><span class="o">.</span><span class="na">methods</span><span class="o">*.</span><span class="na">name</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s1">&#39;flicker&#39;</span><span class="o">)</span>

<span class="kd">class</span> <span class="nc">POGO</span><span class="o">{}</span>
<span class="n">println</span> <span class="o">(</span><span class="n">obj</span><span class="o">.</span><span class="na">metaClass</span><span class="o">.</span><span class="na">methods</span><span class="o">*.</span><span class="na">name</span> <span class="o">-</span> <span class="k">new</span> <span class="n">POGO</span><span class="o">().</span><span class="na">metaClass</span><span class="o">.</span><span class="na">methods</span><span class="o">*.</span><span class="na">name</span><span class="o">)</span>
<span class="c1">// =&gt; [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_13.9</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Most classes in Groovy are inheritable</span>
<span class="kd">class</span> <span class="nc">Person6</span><span class="o">{</span> <span class="kt">def</span> <span class="n">age</span><span class="o">,</span> <span class="n">name</span> <span class="o">}</span>
<span class="n">dude</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person6</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;Jason&#39;</span><span class="o">,</span> <span class="nl">age:</span><span class="mi">23</span><span class="o">)</span>
<span class="n">println</span> <span class="s2">&quot;$dude.name is age $dude.age.&quot;</span>

<span class="c1">// Inheriting from Person</span>
<span class="kd">class</span> <span class="nc">Employee</span> <span class="kd">extends</span> <span class="n">Person6</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">salary</span>
<span class="o">}</span>
<span class="n">empl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;Jason&#39;</span><span class="o">,</span> <span class="nl">age:</span><span class="mi">23</span><span class="o">,</span> <span class="nl">salary:</span><span class="mi">200</span><span class="o">)</span>
<span class="n">println</span> <span class="s2">&quot;$empl.name is age $empl.age and has salary $empl.salary.&quot;</span>

<span class="c1">// Many built-in class can be inherited the same way</span>
<span class="kd">class</span> <span class="nc">WierdList</span> <span class="kd">extends</span> <span class="n">ArrayList</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="nf">size</span><span class="o">()</span> <span class="o">{</span>  <span class="c1">// size method in this class is overridden</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WierdList</span><span class="o">()</span>
<span class="n">a</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s1">&#39;dog&#39;</span><span class="o">)</span>
<span class="n">a</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s1">&#39;cat&#39;</span><span class="o">)</span>
<span class="n">println</span> <span class="n">a</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="c1">// =&gt; 4</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_13.10</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="kd">class</span> <span class="nc">Person7</span> <span class="o">{</span> <span class="kt">def</span> <span class="n">firstname</span><span class="o">,</span> <span class="n">surname</span><span class="o">;</span> <span class="kt">def</span> <span class="n">getName</span><span class="o">(){</span> <span class="n">firstname</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">surname</span> <span class="o">}</span> <span class="o">}</span>
<span class="kd">class</span> <span class="nc">Employee2</span> <span class="kd">extends</span> <span class="n">Person7</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">employeeId</span>
    <span class="kt">def</span> <span class="nf">getName</span><span class="o">(){</span> <span class="s1">&#39;Employee Number &#39;</span> <span class="o">+</span> <span class="n">employeeId</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">getRealName</span><span class="o">(){</span> <span class="kd">super</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">}</span>
<span class="o">}</span>
<span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person7</span><span class="o">(</span><span class="nl">firstname:</span><span class="s1">&#39;Jason&#39;</span><span class="o">,</span> <span class="nl">surname:</span><span class="s1">&#39;Smythe&#39;</span><span class="o">)</span>
<span class="n">println</span> <span class="n">p</span><span class="o">.</span><span class="na">name</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Jason Smythe</span>
<span class="n">e</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Employee2</span><span class="o">(</span><span class="nl">firstname:</span><span class="s1">&#39;Jason&#39;</span><span class="o">,</span> <span class="nl">surname:</span><span class="s1">&#39;Smythe&#39;</span><span class="o">,</span> <span class="nl">employeeId:</span><span class="mi">12349876</span><span class="o">)</span>
<span class="n">println</span> <span class="n">e</span><span class="o">.</span><span class="na">name</span>
<span class="n">println</span> <span class="n">e</span><span class="o">.</span><span class="na">realName</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Employee Number 12349876</span>
<span class="c1">// Jason Smythe</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_13.11</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy&#39;s built in constructor and auto getter/setter features</span>
 <span class="c1">// give you the required functionalty already but you could also</span>
 <span class="c1">// override invokeMethod() for trickier scenarios.</span>
<span class="kd">class</span> <span class="nc">Person8</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">name</span><span class="o">,</span> <span class="n">age</span><span class="o">,</span> <span class="n">peers</span><span class="o">,</span> <span class="n">parent</span>
    <span class="kt">def</span> <span class="nf">newChild</span><span class="o">(</span><span class="n">args</span><span class="o">)</span> <span class="o">{</span> <span class="k">new</span> <span class="n">Person8</span><span class="o">(</span><span class="nl">parent:</span><span class="k">this</span><span class="o">,</span> <span class="o">*:</span><span class="n">args</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>

<span class="n">dad</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person8</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;Jason&#39;</span><span class="o">,</span> <span class="nl">age:</span><span class="mi">23</span><span class="o">)</span>
<span class="n">kid</span> <span class="o">=</span> <span class="n">dad</span><span class="o">.</span><span class="na">newChild</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;Rachel&#39;</span><span class="o">,</span> <span class="nl">age:</span><span class="mi">2</span><span class="o">)</span>
<span class="n">println</span> <span class="s2">&quot;Kid&#39;s parent is ${kid.parent.name}&quot;</span>
<span class="c1">// =&gt; Kid&#39;s parent is Jason</span>

<span class="c1">// additional fields ...</span>
<span class="kd">class</span> <span class="nc">Employee3</span> <span class="kd">extends</span> <span class="n">Person8</span> <span class="o">{</span> <span class="kt">def</span> <span class="n">salary</span><span class="o">,</span> <span class="n">boss</span> <span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_13.12</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Fields marked as private in Groovy can&#39;t be trampled by another class in</span>
<span class="c1">// the class hierarchy</span>
<span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">name</span> <span class="c1">// my child&#39;s name</span>
    <span class="kt">def</span> <span class="nf">setChildName</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="n">name</span> <span class="o">=</span> <span class="n">value</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">getChildName</span><span class="o">()</span> <span class="o">{</span> <span class="n">name</span> <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">GrandParent</span> <span class="kd">extends</span> <span class="n">Parent</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">name</span> <span class="c1">// my grandchild&#39;s name</span>
    <span class="kt">def</span> <span class="nf">setgrandChildName</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="n">name</span> <span class="o">=</span> <span class="n">value</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">getGrandChildName</span><span class="o">()</span> <span class="o">{</span> <span class="n">name</span> <span class="o">}</span>
<span class="o">}</span>
<span class="n">g</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GrandParent</span><span class="o">()</span>
<span class="n">g</span><span class="o">.</span><span class="na">childName</span> <span class="o">=</span> <span class="s1">&#39;Jason&#39;</span>
<span class="n">g</span><span class="o">.</span><span class="na">grandChildName</span> <span class="o">=</span> <span class="s1">&#39;Rachel&#39;</span>
<span class="n">println</span> <span class="n">g</span><span class="o">.</span><span class="na">childName</span>       <span class="c1">// =&gt; Jason</span>
<span class="n">println</span> <span class="n">g</span><span class="o">.</span><span class="na">grandChildName</span>  <span class="c1">// =&gt; Rachel</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_13.13</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// The JVM garbage collector copes with circular structures.</span>
<span class="c1">// You can test it with this code:</span>
<span class="kd">class</span> <span class="nc">Person9</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">friend</span>
    <span class="kt">void</span> <span class="nf">finalize</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">println</span> <span class="s2">&quot;Object [internal id=${hashCode()}] is dying at ${new Date()}&quot;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">makeSomeFriends</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person9</span><span class="o">()</span>
    <span class="kt">def</span> <span class="n">second</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person9</span><span class="o">(</span><span class="nl">friend:</span><span class="n">first</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">third</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person9</span><span class="o">(</span><span class="nl">friend:</span><span class="n">second</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">fourth</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person9</span><span class="o">(</span><span class="nl">friend:</span><span class="n">third</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">fifth</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person9</span><span class="o">(</span><span class="nl">friend:</span><span class="n">fourth</span><span class="o">)</span>
    <span class="n">first</span><span class="o">.</span><span class="na">friend</span> <span class="o">=</span> <span class="n">fifth</span>
<span class="o">}</span>

<span class="n">makeSomeFriends</span><span class="o">()</span>
<span class="mi">100</span><span class="o">.</span><span class="na">times</span><span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">gc</span><span class="o">()</span>
<span class="o">}</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Object [internal id=24478976] is dying at Tue Jan 09 22:24:31 EST 2007</span>
<span class="c1">// Object [internal id=32853087] is dying at Tue Jan 09 22:24:31 EST 2007</span>
<span class="c1">// Object [internal id=23664622] is dying at Tue Jan 09 22:24:31 EST 2007</span>
<span class="c1">// Object [internal id=10630672] is dying at Tue Jan 09 22:24:31 EST 2007</span>
<span class="c1">// Object [internal id=25921812] is dying at Tue Jan 09 22:24:31 EST 2007</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_13.14</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy provides numerous methods which are automatically associated with</span>
<span class="c1">// symbol operators, e.g. here is &#39;&lt;=&gt;&#39; which is associated with compareTo()</span>
<span class="c1">// Suppose we have a class with a compareTo operator, such as:</span>
<span class="kd">class</span> <span class="nc">Person10</span> <span class="kd">implements</span> <span class="n">Comparable</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">firstname</span><span class="o">,</span> <span class="n">initial</span><span class="o">,</span> <span class="n">surname</span>
    <span class="n">Person10</span><span class="o">(</span><span class="n">f</span><span class="o">,</span><span class="n">i</span><span class="o">,</span><span class="n">s</span><span class="o">)</span> <span class="o">{</span> <span class="n">firstname</span> <span class="o">=</span> <span class="n">f</span><span class="o">;</span> <span class="n">initial</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span> <span class="n">surname</span> <span class="o">=</span> <span class="n">s</span> <span class="o">}</span>
    <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">other</span><span class="o">)</span> <span class="o">{</span> <span class="n">firstname</span> <span class="o">&lt;=&gt;</span> <span class="n">other</span><span class="o">.</span><span class="na">firstname</span> <span class="o">}</span>
<span class="o">}</span>
<span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person10</span><span class="o">(</span><span class="s1">&#39;James&#39;</span><span class="o">,</span> <span class="s1">&#39;T&#39;</span><span class="o">,</span> <span class="s1">&#39;Kirk&#39;</span><span class="o">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person10</span><span class="o">(</span><span class="s1">&#39;Samuel&#39;</span><span class="o">,</span> <span class="s1">&#39;L&#39;</span><span class="o">,</span> <span class="s1">&#39;Jackson&#39;</span><span class="o">)</span>
<span class="n">println</span> <span class="n">a</span> <span class="o">&lt;=&gt;</span> <span class="n">b</span>
<span class="c1">// =&gt; -1</span>

<span class="c1">// we can override the existing Person10&#39;s &lt;=&gt; operator as below</span>
<span class="c1">// so that now comparisons are made using the middle initial</span>
<span class="c1">// instead of the fisrtname:</span>
<span class="kd">class</span> <span class="nc">Person11</span> <span class="kd">extends</span> <span class="n">Person10</span> <span class="o">{</span>
    <span class="n">Person11</span><span class="o">(</span><span class="n">f</span><span class="o">,</span><span class="n">i</span><span class="o">,</span><span class="n">s</span><span class="o">)</span> <span class="o">{</span> <span class="kd">super</span><span class="o">(</span><span class="n">f</span><span class="o">,</span><span class="n">i</span><span class="o">,</span><span class="n">s</span><span class="o">)</span> <span class="o">}</span>
    <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">other</span><span class="o">)</span> <span class="o">{</span> <span class="n">initial</span> <span class="o">&lt;=&gt;</span> <span class="n">other</span><span class="o">.</span><span class="na">initial</span> <span class="o">}</span>
<span class="o">}</span>

<span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person11</span><span class="o">(</span><span class="s1">&#39;James&#39;</span><span class="o">,</span> <span class="s1">&#39;T&#39;</span><span class="o">,</span> <span class="s1">&#39;Kirk&#39;</span><span class="o">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person11</span><span class="o">(</span><span class="s1">&#39;Samuel&#39;</span><span class="o">,</span> <span class="s1">&#39;L&#39;</span><span class="o">,</span> <span class="s1">&#39;Jackson&#39;</span><span class="o">)</span>
<span class="n">println</span> <span class="n">a</span> <span class="o">&lt;=&gt;</span> <span class="n">b</span>
<span class="c1">// =&gt; 1</span>

<span class="c1">// we could also in general use Groovy&#39;s categories to extend class functionality.</span>

<span class="c1">// There is no way to directly overload the &#39;&quot;&quot;&#39; (stringify)</span>
<span class="c1">// operator in Groovy.  However, by convention, classes which</span>
<span class="c1">// can reasonably be converted to a String will define a</span>
<span class="c1">// &#39;toString()&#39; method as in the TimeNumber class defined below.</span>
<span class="c1">// The &#39;println&#39; method will automatcally call an object&#39;s</span>
<span class="c1">// &#39;toString()&#39; method as is demonstrated below. Furthermore,</span>
<span class="c1">// an object of that class can be used most any place where the</span>
<span class="c1">// interpreter is looking for a String value.</span>

<span class="c1">//---------------------------------------</span>
<span class="c1">// NOTE: Groovy has various built-in Time/Date/Calendar classes</span>
<span class="c1">// which would usually be used to manipulate time objects, the</span>
<span class="c1">// following is supplied for educational purposes to demonstrate</span>
<span class="c1">// operator overloading.</span>
<span class="kd">class</span> <span class="nc">TimeNumber</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">h</span><span class="o">,</span> <span class="n">m</span><span class="o">,</span> <span class="n">s</span>
    <span class="n">TimeNumber</span><span class="o">(</span><span class="n">hour</span><span class="o">,</span> <span class="n">min</span><span class="o">,</span> <span class="n">sec</span><span class="o">)</span> <span class="o">{</span> <span class="n">h</span> <span class="o">=</span> <span class="n">hour</span><span class="o">;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">min</span><span class="o">;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sec</span> <span class="o">}</span>

    <span class="kt">def</span> <span class="nf">toDigits</span><span class="o">(</span><span class="n">s</span><span class="o">)</span> <span class="o">{</span> <span class="n">s</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">padLeft</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="s1">&#39;0&#39;</span><span class="o">)</span> <span class="o">}</span>
    <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">toDigits</span><span class="o">(</span><span class="n">h</span><span class="o">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">toDigits</span><span class="o">(</span><span class="n">m</span><span class="o">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">toDigits</span><span class="o">(</span><span class="n">s</span><span class="o">)</span>
    <span class="o">}</span>

    <span class="kt">def</span> <span class="nf">plus</span><span class="o">(</span><span class="n">other</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="na">s</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="na">m</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="na">h</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">s</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">s</span> <span class="o">%=</span> <span class="mi">60</span>
            <span class="n">m</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">m</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">m</span> <span class="o">%=</span> <span class="mi">60</span>
            <span class="n">h</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">TimeNumber</span><span class="o">(</span><span class="n">h</span><span class="o">,</span> <span class="n">m</span><span class="o">,</span> <span class="n">s</span><span class="o">)</span>
    <span class="o">}</span>

<span class="o">}</span>

<span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TimeNumber</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">58</span><span class="o">,</span> <span class="mi">59</span><span class="o">)</span>
<span class="n">sec</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TimeNumber</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
<span class="n">min</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TimeNumber</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span>
<span class="n">println</span> <span class="n">t1</span> <span class="o">+</span> <span class="n">sec</span> <span class="o">+</span> <span class="n">min</span> <span class="o">+</span> <span class="n">min</span>

<span class="c1">//-----------------------------</span>
<span class="c1">// StrNum class example: Groovy&#39;s builtin String class already has the</span>
<span class="c1">// capabilities outlined in StrNum Perl example, however the &#39;*&#39; operator</span>
<span class="c1">// on Groovy&#39;s String class acts differently: It creates a string which</span>
<span class="c1">// is the original string repeated N times.</span>
<span class="c1">//</span>
<span class="c1">// Using Groovy&#39;s String class as is in this example:</span>
<span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;Red&quot;</span><span class="o">;</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;Black&quot;</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">z</span><span class="o">*</span><span class="mi">3</span> <span class="c1">// r is &quot;RedBlackRedBlackRedBlack&quot;</span>
<span class="n">println</span> <span class="s2">&quot;values are $x, $y, $z, and $r&quot;</span>
<span class="n">println</span> <span class="s2">&quot;$x is ${x &lt; y ? &#39;LT&#39; : &#39;GE&#39;} $y&quot;</span>
<span class="c1">// prints:</span>
<span class="c1">// values are Red, Black, RedBlack, and RedBlackRedBlackRedBlack</span>
<span class="c1">// Red is GE Black</span>

<span class="c1">//-----------------------------</span>
<span class="kd">class</span> <span class="nc">FixNum</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">REGEX</span> <span class="o">=</span> <span class="s">/(\.\d*)/</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="n">DEFAULT_PLACES</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="kt">def</span> <span class="kt">float</span> <span class="n">value</span>
    <span class="kt">def</span> <span class="kt">int</span> <span class="n">places</span>
    <span class="nf">FixNum</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">initValue</span><span class="o">(</span><span class="n">value</span><span class="o">)</span>
        <span class="kt">def</span> <span class="n">m</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span> <span class="o">=~</span> <span class="n">REGEX</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">m</span><span class="o">)</span> <span class="n">places</span> <span class="o">=</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">1</span><span class="o">].</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">else</span> <span class="n">places</span> <span class="o">=</span> <span class="n">DEFAULT_PLACES</span>
    <span class="o">}</span>
    <span class="n">FixNum</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">places</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">initValue</span><span class="o">(</span><span class="n">value</span><span class="o">)</span>
        <span class="k">this</span><span class="o">.</span><span class="na">places</span> <span class="o">=</span> <span class="n">places</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="nf">initValue</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="o">}</span>

    <span class="kt">def</span> <span class="nf">plus</span><span class="o">(</span><span class="n">other</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">new</span> <span class="nf">FixNum</span><span class="o">(</span><span class="n">value</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="na">value</span><span class="o">,</span> <span class="o">[</span><span class="n">places</span><span class="o">,</span> <span class="n">other</span><span class="o">.</span><span class="na">places</span><span class="o">].</span><span class="na">max</span><span class="o">())</span>
    <span class="o">}</span>

    <span class="kt">def</span> <span class="nf">multiply</span><span class="o">(</span><span class="n">other</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">new</span> <span class="nf">FixNum</span><span class="o">(</span><span class="n">value</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="na">value</span><span class="o">,</span> <span class="o">[</span><span class="n">places</span><span class="o">,</span> <span class="n">other</span><span class="o">.</span><span class="na">places</span><span class="o">].</span><span class="na">max</span><span class="o">())</span>
    <span class="o">}</span>

    <span class="kt">def</span> <span class="nf">div</span><span class="o">(</span><span class="n">other</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">println</span> <span class="s2">&quot;DEUG: Divide = ${value/other.value}&quot;</span>
        <span class="kt">def</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FixNum</span><span class="o">(</span><span class="n">value</span><span class="s">/other.value)</span>
<span class="s">        result.places = [places,other.places].max()</span>
<span class="s">        result</span>
<span class="s">    }</span>

<span class="s">    String toString() {</span>
<span class="s">        //m = value.toString() =~ /</span><span class="o">(</span><span class="err">\</span><span class="n">d</span><span class="o">)</span><span class="s">/ + REGEX</span>
<span class="s">        String.format(&quot;STR%s: %.${places}f&quot;, [this.class.name, value as float] as Object[])</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">x = new FixNum(40)</span>
<span class="s">y = new FixNum(12, 0)</span>

<span class="s">println &quot;sum of $x and $y is ${x+y}&quot;</span>
<span class="s">println &quot;product of $x and $y is ${x*y}&quot;</span>

<span class="s">z = x/</span><span class="n">y</span>
<span class="n">println</span> <span class="s2">&quot;$z has $z.places places&quot;</span>
<span class="n">z</span><span class="o">.</span><span class="na">places</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">println</span> <span class="s2">&quot;$z now has $z.places places&quot;</span>

<span class="n">println</span> <span class="s2">&quot;div of $x by $y is $z&quot;</span>
<span class="n">println</span> <span class="s2">&quot;square of that is ${z*z}&quot;</span>
<span class="c1">// =&gt;</span>
<span class="c1">// sum of STRFixNum: 40 and STRFixNum: 12 is STRFixNum: 52</span>
<span class="c1">// product of STRFixNum: 40 and STRFixNum: 12 is STRFixNum: 480</span>
<span class="c1">// DEUG: Divide = 3.3333333333333335</span>
<span class="c1">// STRFixNum: 3 has 0 places</span>
<span class="c1">// STRFixNum: 3.33 now has 2 places</span>
<span class="c1">// div of STRFixNum: 40 by STRFixNum: 12 is STRFixNum: 3.33</span>
<span class="c1">// square of that is STRFixNum: 11.11</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_13.15</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy doesn&#39;t use the tie terminology but you can achieve</span>
<span class="c1">// similar results with Groovy&#39;s metaprogramming facilities</span>
<span class="kd">class</span> <span class="nc">ValueRing</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">values</span>
    <span class="kt">def</span> <span class="nf">add</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="n">values</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">def</span> <span class="n">head</span> <span class="o">=</span> <span class="n">values</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">[</span><span class="mi">1</span><span class="o">..-</span><span class="mi">1</span><span class="o">]</span> <span class="o">+</span> <span class="n">head</span>
        <span class="k">return</span> <span class="n">head</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">ring</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ValueRing</span><span class="o">(</span><span class="nl">values:</span><span class="o">[</span><span class="s1">&#39;red&#39;</span><span class="o">,</span> <span class="s1">&#39;blue&#39;</span><span class="o">])</span>
<span class="kt">def</span> <span class="nf">getColor</span><span class="o">()</span> <span class="o">{</span> <span class="n">ring</span><span class="o">.</span><span class="na">next</span><span class="o">()</span> <span class="o">}</span>
<span class="kt">void</span> <span class="nf">setProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">n</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="s1">&#39;color&#39;</span><span class="o">)</span> <span class="o">{</span> <span class="n">ring</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">v</span><span class="o">);</span> <span class="k">return</span> <span class="o">}</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">n</span><span class="o">,</span><span class="n">v</span><span class="o">)</span>
<span class="o">}</span>

<span class="n">println</span> <span class="s2">&quot;$color $color $color $color $color $color&quot;</span>
<span class="c1">// =&gt; red blue red blue red blue</span>

<span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span>
<span class="n">println</span> <span class="s2">&quot;$color $color $color $color $color $color&quot;</span>
<span class="c1">// =&gt; green red blue green red blue</span>

<span class="c1">// Groovy doesn&#39;t have the $_ implicit variable so we can&#39;t show an</span>
<span class="c1">// example that gets rid of it. We can however show an example of how</span>
<span class="c1">// you could add in a simplified version of that facility into Groovy.</span>
<span class="c1">// We use Groovy&#39;s metaProgramming facilities. We execute our script</span>
<span class="c1">// in a new GroovyShell so that we don&#39;t affect subsequent examples.</span>
<span class="c1">// script:</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">println</span> <span class="s2">&quot;$_&quot;</span>
<span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;cat&#39;</span> <span class="o">*</span> <span class="n">x</span>
<span class="n">println</span> <span class="s2">&quot;$_&quot;</span>

<span class="c1">// metaUnderscore:</span>
<span class="kt">void</span> <span class="nf">setProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">n</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="n">v</span><span class="o">)</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">n</span><span class="o">,</span><span class="n">v</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">new</span> <span class="nf">GroovyShell</span><span class="o">().</span><span class="na">evaluate</span><span class="o">(</span><span class="n">metaUnderscore</span> <span class="o">+</span> <span class="n">script</span><span class="o">)</span>
<span class="c1">// =&gt;</span>
<span class="c1">// 3</span>
<span class="c1">// catcatcat</span>

<span class="c1">// We can get a little bit fancier by making an UnderscoreAware class</span>
<span class="c1">// that wraps up some of this functionality. This is not recommended</span>
<span class="c1">// as good Groovy style but mimicks the $_ behaviour in a sinple way.</span>
<span class="kd">class</span> <span class="nc">UnderscoreAware</span> <span class="kd">implements</span> <span class="n">GroovyInterceptable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">_saved</span>
    <span class="kt">void</span> <span class="nf">setProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">n</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">_saved</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">this</span><span class="o">.</span><span class="na">metaClass</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">n</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">getProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="o">)</span> <span class="k">return</span> <span class="n">_saved</span>
        <span class="k">this</span><span class="o">.</span><span class="na">metaClass</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">n</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">invokeMethod</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Object</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s1">&#39;print&#39;</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">args</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="o">[</span><span class="n">_saved</span><span class="o">]</span> <span class="k">as</span> <span class="n">Object</span><span class="o">[]</span>
        <span class="k">this</span><span class="o">.</span><span class="na">metaClass</span><span class="o">.</span><span class="na">invokeMethod</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">args</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">PerlishClass</span> <span class="kd">extends</span> <span class="n">UnderscoreAware</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">_age</span>
    <span class="kt">def</span> <span class="nf">setAge</span><span class="o">(</span><span class="n">age</span><span class="o">){</span> <span class="n">_age</span> <span class="o">=</span> <span class="n">age</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">getAge</span><span class="o">(){</span> <span class="n">_age</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">age</span> <span class="o">=</span> <span class="mi">25</span>
        <span class="n">println</span> <span class="s2">&quot;$_&quot;</span>   <span class="c1">// explicit $_ supported</span>
        <span class="n">age</span><span class="o">++</span>
        <span class="n">println</span><span class="o">()</span>      <span class="c1">// implicit $_ will be injected</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="n">x</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PerlishClass</span><span class="o">()</span>
<span class="n">x</span><span class="o">.</span><span class="na">test</span><span class="o">()</span>
<span class="c1">// =&gt;</span>
<span class="c1">// 25</span>
<span class="c1">// 26</span>

<span class="c1">// Autoappending hash:</span>
<span class="kd">class</span> <span class="nc">AutoMap</span> <span class="kd">extends</span> <span class="n">HashMap</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">setProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">containsKey</span><span class="o">(</span><span class="n">name</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">get</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">+</span> <span class="n">v</span><span class="o">)</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="o">[</span><span class="n">v</span><span class="o">])</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AutoMap</span><span class="o">()</span>
<span class="n">m</span><span class="o">.</span><span class="na">beer</span> <span class="o">=</span> <span class="s1">&#39;guinness&#39;</span>
<span class="n">m</span><span class="o">.</span><span class="na">food</span> <span class="o">=</span> <span class="s1">&#39;potatoes&#39;</span>
<span class="n">m</span><span class="o">.</span><span class="na">food</span> <span class="o">=</span> <span class="s1">&#39;peas&#39;</span>
<span class="n">println</span> <span class="n">m</span>
<span class="c1">// =&gt; [&quot;food&quot;:[&quot;potatoes&quot;, &quot;peas&quot;], &quot;beer&quot;:[&quot;guinness&quot;]]</span>

<span class="c1">// Case-Insensitive Hash:</span>
<span class="kd">class</span> <span class="nc">FoldedMap</span> <span class="kd">extends</span> <span class="n">HashMap</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">setProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">put</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span> <span class="n">v</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">getProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">get</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">())</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">tab</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FoldedMap</span><span class="o">()</span>
<span class="n">tab</span><span class="o">.</span><span class="na">VILLAIN</span> <span class="o">=</span> <span class="s1">&#39;big &#39;</span>
<span class="n">tab</span><span class="o">.</span><span class="na">herOine</span> <span class="o">=</span> <span class="s1">&#39;red riding hood&#39;</span>
<span class="n">tab</span><span class="o">.</span><span class="na">villain</span> <span class="o">+=</span> <span class="s1">&#39;bad wolf&#39;</span>
<span class="n">println</span> <span class="n">tab</span>
<span class="c1">// =&gt; [&quot;heroine&quot;:&quot;red riding hood&quot;, &quot;villain&quot;:&quot;big bad wolf&quot;]</span>

<span class="c1">// Hash That &quot;Allows Look-Ups by Key or Value&quot;:</span>
<span class="kd">class</span> <span class="nc">RevMap</span> <span class="kd">extends</span> <span class="n">HashMap</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">setProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">n</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span> <span class="n">put</span><span class="o">(</span><span class="n">n</span><span class="o">,</span><span class="n">v</span><span class="o">);</span> <span class="n">put</span><span class="o">(</span><span class="n">v</span><span class="o">,</span><span class="n">n</span><span class="o">)</span> <span class="o">}</span>
    <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="kd">super</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="n">n</span><span class="o">));</span> <span class="kd">super</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>
<span class="n">rev</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RevMap</span><span class="o">()</span>
<span class="n">rev</span><span class="o">.</span><span class="na">Rojo</span> <span class="o">=</span> <span class="s1">&#39;Red&#39;</span>
<span class="n">rev</span><span class="o">.</span><span class="na">Azul</span> <span class="o">=</span> <span class="s1">&#39;Blue&#39;</span>
<span class="n">rev</span><span class="o">.</span><span class="na">Verde</span> <span class="o">=</span> <span class="s1">&#39;Green&#39;</span>
<span class="n">rev</span><span class="o">.</span><span class="na">EVIL</span> <span class="o">=</span> <span class="o">[</span> <span class="s2">&quot;No way!&quot;</span><span class="o">,</span> <span class="s2">&quot;Way!!&quot;</span> <span class="o">]</span>
<span class="n">rev</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="s1">&#39;Red&#39;</span><span class="o">)</span>
<span class="n">rev</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="s1">&#39;Azul&#39;</span><span class="o">)</span>
<span class="n">println</span> <span class="n">rev</span>
<span class="c1">// =&gt;</span>
<span class="c1">// [[&quot;No way!&quot;, &quot;Way!!&quot;]:&quot;EVIL&quot;, &quot;EVIL&quot;:[&quot;No way!&quot;, &quot;Way!!&quot;], &quot;Verde&quot;:&quot;Green&quot;, &quot;Green&quot;:&quot;Verde&quot;]</span>

<span class="c1">// Infinite loop scenario:</span>
<span class="c1">// def x(n) { x(++n) }; x(0)</span>
<span class="c1">// =&gt; Caught: java.lang.StackOverflowError</span>

<span class="c1">// Multiple Strrams scenario:</span>
<span class="kd">class</span> <span class="nc">MultiStream</span> <span class="kd">extends</span> <span class="n">PrintStream</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">streams</span>
    <span class="nf">MultiStream</span><span class="o">(</span><span class="n">List</span> <span class="n">streams</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">streams</span><span class="o">[</span><span class="mi">0</span><span class="o">])</span>
        <span class="k">this</span><span class="o">.</span><span class="na">streams</span> <span class="o">=</span> <span class="n">streams</span>
    <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">println</span><span class="o">(</span><span class="n">String</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">streams</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">tee</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MultiStream</span><span class="o">([</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">])</span>
<span class="n">tee</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s1">&#39;This goes two places&#39;</span><span class="o">)</span>
<span class="c1">// =&gt;</span>
<span class="c1">// This goes two places</span>
<span class="c1">// This goes two places</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_14.0</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">As</span> <span class="n">discussed</span> <span class="k">in</span> <span class="mf">14.1</span><span class="o">,</span> <span class="n">many</span> <span class="n">database</span> <span class="n">options</span> <span class="n">exist</span><span class="o">,</span> <span class="n">one</span> <span class="n">of</span> <span class="n">which</span> <span class="n">is</span> <span class="n">JDBC</span><span class="o">.</span>
<span class="n">Over</span> <span class="mi">200</span> <span class="n">JDBC</span> <span class="n">drivers</span> <span class="n">are</span> <span class="n">listed</span> <span class="n">at</span> <span class="n">the</span> <span class="n">following</span> <span class="nl">URL:</span>
<span class="nl">http:</span><span class="c1">//developers.sun.com/product/jdbc/drivers/browse_all.jsp</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_14.1</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy can make use of various Java persistence libraries and has special</span>
<span class="c1">// support built-in (e.g. datasets) for interacting wth RDBMS systems.</span>
<span class="c1">// Some of the options include:</span>
<span class="c1">//   object serialization (built in to Java)</span>
<span class="c1">//   pbeans: pbeans.sf.net</span>
<span class="c1">//   prevayler: http://www.prevayler.org</span>
<span class="c1">//   Berkeley DB Java edition: http://www.oracle.com/database/berkeley-db/je/</span>
<span class="c1">//   JDBC: Over 200 drivers are listed at http://developers.sun.com/product/jdbc/drivers</span>
<span class="c1">//   Datasets (special Groovy support)</span>
<span class="c1">//   XML via e.g. xstream or JAXB or XmlBeans or ...</span>
<span class="c1">//   ORM: over 20 are listed at http://java-source.net/open-source/persistence</span>
<span class="c1">//   JNI: can be used directly on a platform that supports e.g. DBM or via</span>
<span class="c1">//     a cross platform API such as Apache APR which includes DBM routines:</span>
<span class="c1">//     http://apr.apache.org/docs/apr-util/0.9/group__APR__Util__DBM.html</span>
<span class="c1">//   jmork: used for Firefox/Thunderbird databases, e.g. address books, history files</span>
<span class="c1">// JDBC or Datasets would normally be most common for all examples in this chapter.</span>


<span class="c1">// Example shown using berkeley db Java edition - not quite as transparent as</span>
<span class="c1">// cookbook example as Berkeley DB Java addition makes transactions visible.</span>
<span class="kn">import</span> <span class="nn">com.sleepycat.je.*</span>
<span class="n">tx</span> <span class="o">=</span> <span class="kc">null</span>
<span class="n">envHome</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s2">&quot;D:/Projects/GroovyExamples/Pleac/data/db&quot;</span><span class="o">)</span>

<span class="n">myEnvConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EnvironmentConfig</span><span class="o">()</span>
<span class="n">myEnvConfig</span><span class="o">.</span><span class="na">setAllowCreate</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="n">myEnv</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Environment</span><span class="o">(</span><span class="n">envHome</span><span class="o">,</span> <span class="n">myEnvConfig</span><span class="o">)</span>

<span class="n">myDbConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatabaseConfig</span><span class="o">()</span>
<span class="n">myDbConfig</span><span class="o">.</span><span class="na">setAllowCreate</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="n">myDb</span> <span class="o">=</span> <span class="n">myEnv</span><span class="o">.</span><span class="na">openDatabase</span><span class="o">(</span><span class="n">tx</span><span class="o">,</span> <span class="s2">&quot;vendorDB&quot;</span><span class="o">,</span> <span class="n">myDbConfig</span><span class="o">)</span>

<span class="n">theKey</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatabaseEntry</span><span class="o">(</span><span class="s2">&quot;key&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s2">&quot;UTF-8&quot;</span><span class="o">))</span>
<span class="n">theData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatabaseEntry</span><span class="o">(</span><span class="s2">&quot;data&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s2">&quot;UTF-8&quot;</span><span class="o">))</span>
<span class="n">myDb</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">tx</span><span class="o">,</span> <span class="n">theKey</span><span class="o">,</span> <span class="n">theData</span><span class="o">)</span>
<span class="k">if</span> <span class="o">(</span><span class="n">myDb</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">tx</span><span class="o">,</span> <span class="n">theKey</span><span class="o">,</span> <span class="n">theData</span><span class="o">,</span> <span class="n">LockMode</span><span class="o">.</span><span class="na">DEFAULT</span><span class="o">)</span> <span class="o">==</span> <span class="n">OperationStatus</span><span class="o">.</span><span class="na">SUCCESS</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">key</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">theKey</span><span class="o">.</span><span class="na">data</span><span class="o">,</span> <span class="s2">&quot;UTF-8&quot;</span><span class="o">)</span>
    <span class="n">foundData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">theData</span><span class="o">.</span><span class="na">data</span><span class="o">,</span> <span class="s2">&quot;UTF-8&quot;</span><span class="o">)</span>
    <span class="n">println</span> <span class="s2">&quot;For key: &#39;$key&#39; found data: &#39;$foundData&#39;.&quot;</span>
<span class="o">}</span>
<span class="n">myDb</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">tx</span><span class="o">,</span> <span class="n">theKey</span><span class="o">)</span>
<span class="n">myDb</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="n">myEnv</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>


<span class="c1">// userstats using pbeans</span>
<span class="kn">import</span> <span class="nn">net.sourceforge.pbeans.*</span>
<span class="c1">// on *nix use: whotext = &quot;who&quot;.execute().text</span>
<span class="n">whotext</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">gnat ttyp1 May 29 15:39 (coprolith.frii.com)</span>
<span class="s1">bill ttyp1 May 28 15:38 (hilary.com)</span>
<span class="s1">gnit ttyp1 May 27 15:37 (somewhere.org)</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="kd">class</span> <span class="nc">LoginInfo</span> <span class="kd">implements</span> <span class="n">Persistent</span> <span class="o">{</span>
    <span class="n">LoginInfo</span><span class="o">()</span> <span class="o">{}</span>
    <span class="n">LoginInfo</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span> <span class="n">loginCount</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">}</span>
    <span class="n">String</span> <span class="n">name</span>
    <span class="kt">int</span> <span class="n">loginCount</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">printAllUsers</span><span class="o">(</span><span class="n">store</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">printUsers</span><span class="o">(</span><span class="n">store</span><span class="o">,</span> <span class="n">store</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">LoginInfo</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">collect</span><span class="o">{</span><span class="n">it</span><span class="o">.</span><span class="na">name</span><span class="o">}.</span><span class="na">sort</span><span class="o">())</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">printUsers</span><span class="o">(</span><span class="n">store</span><span class="o">,</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">list</span><span class="o">.</span><span class="na">each</span><span class="o">{</span>
        <span class="n">println</span> <span class="s2">&quot;$it  ${store.selectSingle(LoginInfo.class, &#39;name&#39;, it).loginCount}&quot;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">addUsers</span><span class="o">(</span><span class="n">store</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">whotext</span><span class="o">.</span><span class="na">trim</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s1">&#39;\n&#39;</span><span class="o">).</span><span class="na">each</span><span class="o">{</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">it</span> <span class="o">=~</span> <span class="s">/^(\S+)/</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">1</span><span class="o">]</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">selectSingle</span><span class="o">(</span><span class="n">LoginInfo</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s1">&#39;name&#39;</span><span class="o">,</span> <span class="n">name</span><span class="o">)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">item</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">item</span><span class="o">.</span><span class="na">loginCount</span><span class="o">++</span>
            <span class="n">store</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">item</span><span class="o">)</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">store</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="k">new</span> <span class="n">LoginInfo</span><span class="o">(</span><span class="n">name</span><span class="o">))</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="n">ds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">org</span><span class="o">.</span><span class="na">hsqldb</span><span class="o">.</span><span class="na">jdbc</span><span class="o">.</span><span class="na">jdbcDataSource</span><span class="o">()</span>
<span class="n">ds</span><span class="o">.</span><span class="na">database</span> <span class="o">=</span> <span class="s1">&#39;jdbc:hsqldb:hsql://localhost/mydb&#39;</span>
<span class="n">ds</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="s1">&#39;sa&#39;</span>
<span class="n">ds</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">store</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Store</span><span class="o">(</span><span class="n">ds</span><span class="o">)</span>
<span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">addUsers</span><span class="o">(</span><span class="n">store</span><span class="o">)</span>
<span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">args</span> <span class="o">==</span> <span class="o">[</span><span class="s1">&#39;ALL&#39;</span><span class="o">])</span> <span class="o">{</span>
    <span class="n">printAllUsers</span><span class="o">(</span><span class="n">store</span><span class="o">)</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">printUsers</span><span class="o">(</span><span class="n">store</span><span class="o">,</span> <span class="n">args</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_14.2</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy would normally use JDBC here (see 14.1 for details)</span>
<span class="kn">import</span> <span class="nn">com.sleepycat.je.*</span>
<span class="n">tx</span> <span class="o">=</span> <span class="kc">null</span>
<span class="n">envHome</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s2">&quot;D:/Projects/GroovyExamples/Pleac/data/db&quot;</span><span class="o">)</span>

<span class="n">myEnvConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EnvironmentConfig</span><span class="o">()</span>
<span class="n">myEnvConfig</span><span class="o">.</span><span class="na">setAllowCreate</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="n">myEnv</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Environment</span><span class="o">(</span><span class="n">envHome</span><span class="o">,</span> <span class="n">myEnvConfig</span><span class="o">)</span>

<span class="n">myDbConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatabaseConfig</span><span class="o">()</span>
<span class="n">myDbConfig</span><span class="o">.</span><span class="na">setAllowCreate</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="n">myDb</span> <span class="o">=</span> <span class="n">myEnv</span><span class="o">.</span><span class="na">openDatabase</span><span class="o">(</span><span class="n">tx</span><span class="o">,</span> <span class="s2">&quot;vendorDB&quot;</span><span class="o">,</span> <span class="n">myDbConfig</span><span class="o">)</span>

<span class="n">theKey</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatabaseEntry</span><span class="o">(</span><span class="s2">&quot;key&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s2">&quot;UTF-8&quot;</span><span class="o">))</span>
<span class="n">theData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatabaseEntry</span><span class="o">(</span><span class="s2">&quot;data&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s2">&quot;UTF-8&quot;</span><span class="o">))</span>
<span class="n">myDb</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">tx</span><span class="o">,</span> <span class="n">theKey</span><span class="o">,</span> <span class="n">theData</span><span class="o">)</span>
<span class="n">myDb</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="c1">// clear out database</span>
<span class="n">returnCount</span> <span class="o">=</span> <span class="kc">true</span>
<span class="n">println</span> <span class="n">myEnv</span><span class="o">.</span><span class="na">truncateDatabase</span><span class="o">(</span><span class="n">tx</span><span class="o">,</span> <span class="s2">&quot;vendorDB&quot;</span><span class="o">,</span> <span class="n">returnCount</span><span class="o">)</span> <span class="o">+</span> <span class="s1">&#39; records deleted&#39;</span>
<span class="c1">// remove database</span>
<span class="n">myEnv</span><span class="o">.</span><span class="na">removeDatabase</span><span class="o">(</span><span class="n">tx</span><span class="o">,</span> <span class="s2">&quot;vendorDB&quot;</span><span class="o">)</span>
<span class="n">myEnv</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_14.3</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Original cookbook example not likely in Groovy.</span>
<span class="c1">// Here is a more realistic example, copying pbeans -&gt; jdbc</span>
<span class="c1">// Creation of pbeans database not strictly needed but shown for completion</span>

<span class="kn">import</span> <span class="nn">net.sourceforge.pbeans.*</span>
<span class="kn">import</span> <span class="nn">groovy.sql.Sql</span>

<span class="kt">def</span> <span class="n">ds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">org</span><span class="o">.</span><span class="na">hsqldb</span><span class="o">.</span><span class="na">jdbc</span><span class="o">.</span><span class="na">jdbcDataSource</span><span class="o">()</span>
<span class="n">ds</span><span class="o">.</span><span class="na">database</span> <span class="o">=</span> <span class="s1">&#39;jdbc:hsqldb:hsql://localhost/mydb&#39;</span>
<span class="n">ds</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="s1">&#39;sa&#39;</span>
<span class="n">ds</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">store</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Store</span><span class="o">(</span><span class="n">ds</span><span class="o">)</span>

<span class="kd">class</span> <span class="nc">Person</span> <span class="kd">implements</span> <span class="n">Persistent</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">name</span>
    <span class="n">String</span> <span class="n">does</span>
    <span class="n">String</span> <span class="n">email</span>
<span class="o">}</span>

<span class="c1">// populate with test data</span>
<span class="n">store</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;Tom Christiansen&#39;</span><span class="o">,</span> <span class="nl">does:</span><span class="s1">&#39;book author&#39;</span><span class="o">,</span> <span class="nl">email:</span><span class="s1">&#39;tchrist@perl.com&#39;</span><span class="o">))</span>
<span class="n">store</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;Tom Boutell&#39;</span><span class="o">,</span> <span class="nl">does:</span><span class="s1">&#39;Poet Programmer&#39;</span><span class="o">,</span> <span class="nl">email:</span><span class="s1">&#39;boutell@boutell.com&#39;</span><span class="o">))</span>

<span class="n">people</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">Person</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>

<span class="n">db</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sql</span><span class="o">(</span><span class="n">ds</span><span class="o">)</span>

<span class="n">db</span><span class="o">.</span><span class="na">execute</span> <span class="s1">&#39;CREATE TABLE people ( name VARCHAR, does VARCHAR, email VARCHAR );&#39;</span>
<span class="n">people</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">p</span> <span class="o">-&gt;</span>
    <span class="n">db</span><span class="o">.</span><span class="na">execute</span> <span class="s2">&quot;INSERT INTO people ( name, does, email ) VALUES ($p.name,$p.does,$p.email);&quot;</span>
<span class="o">}</span>
<span class="n">db</span><span class="o">.</span><span class="na">eachRow</span><span class="o">(</span><span class="s2">&quot;SELECT * FROM people where does like &#39;book%&#39;&quot;</span><span class="o">){</span>
    <span class="n">println</span> <span class="s2">&quot;$it.name, $it.does, $it.email&quot;</span>
<span class="o">}</span>
<span class="n">db</span><span class="o">.</span><span class="na">execute</span> <span class="s1">&#39;DROP TABLE people;&#39;</span>
<span class="c1">// =&gt; Tom Christiansen, book author, tchrist@perl.com</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_14.4</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy would normally use JDBC here (see 14.1 for details)</span>
<span class="kn">import</span> <span class="nn">com.sleepycat.je.*</span>

<span class="kt">def</span> <span class="nf">copyEntries</span><span class="o">(</span><span class="n">indb</span><span class="o">,</span> <span class="n">outdb</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">indb1</span><span class="o">.</span><span class="na">openCursor</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">)</span>
    <span class="k">while</span> <span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">getNext</span><span class="o">(</span><span class="n">foundKey</span><span class="o">,</span> <span class="n">foundData</span><span class="o">,</span> <span class="n">LockMode</span><span class="o">.</span><span class="na">DEFAULT</span><span class="o">)</span> <span class="o">==</span> <span class="n">OperationStatus</span><span class="o">.</span><span class="na">SUCCESS</span><span class="o">)</span>
        <span class="n">outdb</span><span class="o">.</span><span class="na">out</span><span class="o">(</span><span class="n">tx</span><span class="o">,</span> <span class="n">foundKey</span><span class="o">,</span> <span class="n">foundData</span><span class="o">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="o">}</span>

<span class="n">tx</span> <span class="o">=</span> <span class="kc">null</span>
<span class="n">envHome</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s2">&quot;D:/Projects/GroovyExamples/Pleac/data/db&quot;</span><span class="o">)</span>

<span class="n">myEnvConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EnvironmentConfig</span><span class="o">()</span>
<span class="n">myEnvConfig</span><span class="o">.</span><span class="na">setAllowCreate</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="n">myEnv</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Environment</span><span class="o">(</span><span class="n">envHome</span><span class="o">,</span> <span class="n">myEnvConfig</span><span class="o">)</span>

<span class="n">myDbConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatabaseConfig</span><span class="o">()</span>
<span class="n">myDbConfig</span><span class="o">.</span><span class="na">setAllowCreate</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="n">indb1</span> <span class="o">=</span> <span class="n">myEnv</span><span class="o">.</span><span class="na">openDatabase</span><span class="o">(</span><span class="n">tx</span><span class="o">,</span> <span class="s2">&quot;db1&quot;</span><span class="o">,</span> <span class="n">myDbConfig</span><span class="o">)</span>
<span class="n">indb2</span> <span class="o">=</span> <span class="n">myEnv</span><span class="o">.</span><span class="na">openDatabase</span><span class="o">(</span><span class="n">tx</span><span class="o">,</span> <span class="s2">&quot;db2&quot;</span><span class="o">,</span> <span class="n">myDbConfig</span><span class="o">)</span>
<span class="n">outdb</span> <span class="o">=</span> <span class="n">myEnv</span><span class="o">.</span><span class="na">openDatabase</span><span class="o">(</span><span class="n">tx</span><span class="o">,</span> <span class="s2">&quot;db3&quot;</span><span class="o">,</span> <span class="n">myDbConfig</span><span class="o">)</span>
<span class="n">foundKey</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatabaseEntry</span><span class="o">()</span>
<span class="n">foundData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatabaseEntry</span><span class="o">()</span>
<span class="n">copyEntries</span><span class="o">(</span><span class="n">indb1</span><span class="o">,</span> <span class="n">outdb</span><span class="o">)</span>
<span class="n">copyEntries</span><span class="o">(</span><span class="n">indb2</span><span class="o">,</span> <span class="n">outdb</span><span class="o">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">indb2</span><span class="o">.</span><span class="na">openCursor</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">)</span>
<span class="k">while</span> <span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">getNext</span><span class="o">(</span><span class="n">foundKey</span><span class="o">,</span> <span class="n">foundData</span><span class="o">,</span> <span class="n">LockMode</span><span class="o">.</span><span class="na">DEFAULT</span><span class="o">)</span> <span class="o">==</span> <span class="n">OperationStatus</span><span class="o">.</span><span class="na">SUCCESS</span><span class="o">)</span>
    <span class="n">outdb</span><span class="o">.</span><span class="na">out</span><span class="o">(</span><span class="n">tx</span><span class="o">,</span> <span class="n">foundKey</span><span class="o">,</span> <span class="n">foundData</span><span class="o">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="n">indb1</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="n">indb2</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="n">outdb</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="n">myEnv</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_14.5</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// If you are using a single file based persistence mechanism you can</span>
<span class="c1">// use the file locking mechanisms mentioned in 7.11 otherwise the</span>
<span class="c1">// database itself or the ORM layer will provide locking mechanisms.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_14.6</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// N/A for most Java/Groovy persistent technologies.</span>
<span class="c1">// Use indexes for RDBMS systems.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_14.7</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
 <span class="c1">// We can write a category that allows the ArrayList class</span>
 <span class="c1">// to be persisted as required.</span>
 <span class="kd">class</span> <span class="nc">ArrayListCategory</span> <span class="o">{</span>
     <span class="kd">static</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">&#39;/temp.txt&#39;</span><span class="o">)</span>
     <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">ArrayList</span> <span class="n">self</span><span class="o">)</span> <span class="o">{</span>
         <span class="kt">def</span> <span class="n">LS</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s1">&#39;line.separator&#39;</span><span class="o">)</span>
         <span class="n">file</span><span class="o">.</span><span class="na">withWriter</span><span class="o">{</span> <span class="n">w</span> <span class="o">-&gt;</span>
             <span class="n">self</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">w</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">it</span> <span class="o">+</span> <span class="n">LS</span><span class="o">)</span>  <span class="o">}</span>
         <span class="o">}</span>
     <span class="o">}</span>
 <span class="o">}</span>

 <span class="n">lines</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1"> zero</span>
<span class="s1"> one</span>
<span class="s1"> two</span>
<span class="s1"> three</span>
<span class="s1"> four</span>
<span class="s1"> &#39;&#39;&#39;</span><span class="o">.</span><span class="na">trim</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s1">&#39;\n&#39;</span><span class="o">)</span> <span class="k">as</span> <span class="n">ArrayList</span>

 <span class="n">use</span><span class="o">(</span><span class="n">ArrayListCategory</span><span class="o">)</span> <span class="o">{</span>
     <span class="n">println</span> <span class="s2">&quot;ORIGINAL&quot;</span>
     <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..&lt;</span><span class="n">lines</span><span class="o">.</span><span class="na">size</span><span class="o">())</span>
         <span class="n">println</span> <span class="s2">&quot;${i}: ${lines[i]}&quot;</span>

     <span class="n">a</span> <span class="o">=</span> <span class="n">lines</span><span class="o">[-</span><span class="mi">1</span><span class="o">]</span>
     <span class="n">lines</span><span class="o">[-</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;last&quot;</span>
     <span class="n">println</span> <span class="s2">&quot;The last line was [$a]&quot;</span>

     <span class="n">a</span> <span class="o">=</span> <span class="n">lines</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
     <span class="n">lines</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;first&quot;</span><span class="o">]</span> <span class="o">+</span> <span class="n">lines</span><span class="o">[</span><span class="mi">1</span><span class="o">..-</span><span class="mi">1</span><span class="o">]</span>
     <span class="n">println</span> <span class="s2">&quot;The first line was [$a]&quot;</span>

     <span class="n">lines</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="s1">&#39;Newbie&#39;</span><span class="o">)</span>
     <span class="n">lines</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s1">&#39;New One&#39;</span><span class="o">)</span>

     <span class="n">lines</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>

     <span class="n">println</span> <span class="s2">&quot;REVERSE&quot;</span>
     <span class="o">(</span><span class="n">lines</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">).</span><span class="na">downto</span><span class="o">(</span><span class="mi">0</span><span class="o">){</span> <span class="n">i</span> <span class="o">-&gt;</span>
         <span class="n">println</span> <span class="s2">&quot;${i}: ${lines[i]}&quot;</span>
     <span class="o">}</span>
     <span class="n">lines</span><span class="o">.</span><span class="na">save</span><span class="o">()</span>
 <span class="o">}</span>
 <span class="c1">// =&gt;</span>
 <span class="c1">// ORIGINAL</span>
 <span class="c1">// 0: zero</span>
 <span class="c1">// 1: one</span>
 <span class="c1">// 2: two</span>
 <span class="c1">// 3: three</span>
 <span class="c1">// 4: four</span>
 <span class="c1">// The last line was [four]</span>
 <span class="c1">// The first line was [zero]</span>
 <span class="c1">// REVERSE</span>
 <span class="c1">// 5: last</span>
 <span class="c1">// 4: three</span>
 <span class="c1">// 3: Newbie</span>
 <span class="c1">// 2: one</span>
 <span class="c1">// 1: New One</span>
 <span class="c1">// 0: first</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_14.8</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// example using pbeans</span>
<span class="kn">import</span> <span class="nn">net.sourceforge.pbeans.*</span>
<span class="kt">def</span> <span class="n">ds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">org</span><span class="o">.</span><span class="na">hsqldb</span><span class="o">.</span><span class="na">jdbc</span><span class="o">.</span><span class="na">jdbcDataSource</span><span class="o">()</span>
<span class="n">ds</span><span class="o">.</span><span class="na">database</span> <span class="o">=</span> <span class="s1">&#39;jdbc:hsqldb:hsql://localhost/mydb&#39;</span>
<span class="n">ds</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="s1">&#39;sa&#39;</span>
<span class="n">ds</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">store</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Store</span><span class="o">(</span><span class="n">ds</span><span class="o">)</span>

<span class="kd">class</span> <span class="nc">Person</span> <span class="kd">implements</span> <span class="n">Persistent</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">name</span>
    <span class="n">String</span> <span class="n">does</span>
    <span class="n">String</span> <span class="n">email</span>
<span class="o">}</span>

<span class="n">name1</span> <span class="o">=</span> <span class="s1">&#39;Tom Christiansen&#39;</span>
<span class="n">name2</span> <span class="o">=</span> <span class="s1">&#39;Tom Boutell&#39;</span>

<span class="n">store</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="nl">name:</span><span class="n">name1</span><span class="o">,</span> <span class="nl">does:</span><span class="s1">&#39;book author&#39;</span><span class="o">,</span> <span class="nl">email:</span><span class="s1">&#39;tchrist@perl.com&#39;</span><span class="o">))</span>
<span class="n">store</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="nl">name:</span><span class="n">name2</span><span class="o">,</span> <span class="nl">does:</span><span class="s1">&#39;shareware author&#39;</span><span class="o">,</span> <span class="nl">email:</span><span class="s1">&#39;boutell@boutell.com&#39;</span><span class="o">))</span>

<span class="n">tom1</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">selectSingle</span><span class="o">(</span><span class="n">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s1">&#39;name&#39;</span><span class="o">,</span> <span class="n">name1</span><span class="o">)</span>
<span class="n">tom2</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">selectSingle</span><span class="o">(</span><span class="n">Person</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s1">&#39;name&#39;</span><span class="o">,</span> <span class="n">name2</span><span class="o">)</span>

<span class="n">println</span> <span class="s2">&quot;Two Toming: $tom1 $tom2&quot;</span>

<span class="k">if</span> <span class="o">(</span><span class="n">tom1</span><span class="o">.</span><span class="na">name</span> <span class="o">==</span> <span class="n">tom2</span><span class="o">.</span><span class="na">name</span> <span class="o">&amp;&amp;</span> <span class="n">tom1</span><span class="o">.</span><span class="na">does</span> <span class="o">==</span> <span class="n">tom2</span><span class="o">.</span><span class="na">does</span> <span class="o">&amp;&amp;</span> <span class="n">tom1</span><span class="o">.</span><span class="na">email</span> <span class="o">==</span> <span class="n">tom2</span><span class="o">.</span><span class="na">email</span><span class="o">)</span>
    <span class="n">println</span> <span class="s2">&quot;You&#39;re having runtime fun with one Tom made two.&quot;</span>
<span class="k">else</span>
    <span class="n">println</span> <span class="s2">&quot;No two Toms are ever alike&quot;</span>

<span class="n">tom2</span><span class="o">.</span><span class="na">does</span> <span class="o">=</span> <span class="s1">&#39;Poet Programmer&#39;</span>
<span class="n">store</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">tom2</span><span class="o">)</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Two Toming: Person@12884e0 Person@8ab708</span>
<span class="c1">// No two Toms are ever alike</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_14.9</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Use one of the mechanisms mentioned in 14.1 to load variables at the start</span>
<span class="c1">// of the script and save them at the end. You can save the binding, individual</span>
<span class="c1">// variables, maps of variables or composite objects.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_14.10</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="kn">import</span> <span class="nn">groovy.sql.Sql</span>

<span class="n">users</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;20&#39;</span><span class="o">:</span><span class="s1">&#39;Joe Bloggs&#39;</span><span class="o">,</span> <span class="s1">&#39;40&#39;</span><span class="o">:</span><span class="s1">&#39;Bill Clinton&#39;</span><span class="o">,</span> <span class="s1">&#39;60&#39;</span><span class="o">:</span><span class="s1">&#39;Ben Franklin&#39;</span><span class="o">]</span>

<span class="kt">def</span> <span class="n">source</span> <span class="o">=</span> <span class="k">new</span> <span class="n">org</span><span class="o">.</span><span class="na">hsqldb</span><span class="o">.</span><span class="na">jdbc</span><span class="o">.</span><span class="na">jdbcDataSource</span><span class="o">()</span>
<span class="n">source</span><span class="o">.</span><span class="na">database</span> <span class="o">=</span> <span class="s1">&#39;jdbc:hsqldb:mem:PLEAC&#39;</span>
<span class="n">source</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="s1">&#39;sa&#39;</span>
<span class="n">source</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">db</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sql</span><span class="o">(</span><span class="n">source</span><span class="o">)</span>

<span class="n">db</span><span class="o">.</span><span class="na">execute</span> <span class="s1">&#39;CREATE TABLE users ( uid INT, login CHAR(8) );&#39;</span>
<span class="n">users</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">uid</span><span class="o">,</span> <span class="n">login</span> <span class="o">-&gt;</span>
    <span class="n">db</span><span class="o">.</span><span class="na">execute</span> <span class="s2">&quot;INSERT INTO users ( uid, login ) VALUES ($uid,$login);&quot;</span>
<span class="o">}</span>
<span class="n">db</span><span class="o">.</span><span class="na">eachRow</span><span class="o">(</span><span class="s1">&#39;SELECT uid, login FROM users WHERE uid &lt; 50&#39;</span><span class="o">){</span>
    <span class="n">println</span> <span class="s2">&quot;$it.uid $it.login&quot;</span>
<span class="o">}</span>
<span class="n">db</span><span class="o">.</span><span class="na">execute</span> <span class="s1">&#39;DROP TABLE users;&#39;</span>
<span class="c1">// =&gt;</span>
<span class="c1">// 20 Joe Bloggs</span>
<span class="c1">// 40 Bill Clinton</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_14.11</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// variation to cookbook: uses Firefox instead of Netscape, always assumes</span>
<span class="c1">// argument is a regex, has some others args, retains no args to list all</span>

<span class="c1">// uses jmork mork dbm reading library:</span>
<span class="c1">//     http://www.smartwerkz.com/projects/jmork/index.html</span>
<span class="kn">import</span> <span class="nn">mork.*</span>
<span class="kt">def</span> <span class="n">cli</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CliBuilder</span><span class="o">()</span>
<span class="n">cli</span><span class="o">.</span><span class="na">h</span><span class="o">(</span><span class="nl">longOpt:</span> <span class="s1">&#39;help&#39;</span><span class="o">,</span> <span class="s1">&#39;print this message&#39;</span><span class="o">)</span>
<span class="n">cli</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="nl">longOpt:</span> <span class="s1">&#39;exclude&#39;</span><span class="o">,</span> <span class="s1">&#39;exclude hidden history entries (js, css, ads and images)&#39;</span><span class="o">)</span>
<span class="n">cli</span><span class="o">.</span><span class="na">c</span><span class="o">(</span><span class="nl">longOpt:</span> <span class="s1">&#39;clean&#39;</span><span class="o">,</span> <span class="s1">&#39;clean off url query string when reporting urls&#39;</span><span class="o">)</span>
<span class="n">cli</span><span class="o">.</span><span class="na">v</span><span class="o">(</span><span class="nl">longOpt:</span> <span class="s1">&#39;verbose&#39;</span><span class="o">,</span> <span class="s1">&#39;show referrer and first visit date&#39;</span><span class="o">)</span>
<span class="kt">def</span> <span class="n">options</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">args</span><span class="o">)</span>
<span class="k">if</span> <span class="o">(</span><span class="n">options</span><span class="o">.</span><span class="na">h</span><span class="o">)</span> <span class="o">{</span> <span class="n">cli</span><span class="o">.</span><span class="na">usage</span><span class="o">();</span> <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">}</span>
<span class="n">regex</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="na">arguments</span><span class="o">()</span>
<span class="k">if</span> <span class="o">(</span><span class="n">regex</span><span class="o">)</span> <span class="n">regex</span> <span class="o">=</span> <span class="n">regex</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
<span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="s1">&#39;Pleac/data/history.dat&#39;</span><span class="o">)</span>
<span class="n">morkDocument</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MorkDocument</span><span class="o">(</span><span class="n">reader</span><span class="o">)</span>
<span class="n">tables</span> <span class="o">=</span> <span class="n">morkDocument</span><span class="o">.</span><span class="na">tables</span>
<span class="n">tables</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">table</span> <span class="o">-&gt;</span>
    <span class="n">table</span><span class="o">.</span><span class="na">rows</span><span class="o">.</span><span class="na">each</span> <span class="o">{</span> <span class="n">row</span> <span class="o">-&gt;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="na">getValue</span><span class="o">(</span><span class="s1">&#39;URL&#39;</span><span class="o">)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">options</span><span class="o">.</span><span class="na">c</span><span class="o">)</span> <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">tokenize</span><span class="o">(</span><span class="s1">&#39;?&#39;</span><span class="o">)[</span><span class="mi">0</span><span class="o">]</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">regex</span> <span class="o">||</span> <span class="n">url</span> <span class="o">=~</span> <span class="n">regex</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">options</span><span class="o">.</span><span class="na">e</span> <span class="o">||</span> <span class="n">row</span><span class="o">.</span><span class="na">getValue</span><span class="o">(</span><span class="s1">&#39;Hidden&#39;</span><span class="o">)</span> <span class="o">!=</span> <span class="s1">&#39;1&#39;</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">println</span> <span class="s2">&quot;$url\n    Last Visited: ${date(row,&#39;LastVisitDate&#39;)}&quot;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">options</span><span class="o">.</span><span class="na">v</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">println</span> <span class="s2">&quot;    First Visited: ${date(row,&#39;FirstVisitDate&#39;)}&quot;</span>
                    <span class="n">println</span> <span class="s2">&quot;    Referrer: ${row.getValue(&#39;Referrer&#39;)}&quot;</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kt">def</span> <span class="nf">date</span><span class="o">(</span><span class="n">row</span><span class="o">,</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">((</span><span class="kt">long</span><span class="o">)(</span><span class="n">row</span><span class="o">.</span><span class="na">getValue</span><span class="o">(</span><span class="n">key</span><span class="o">).</span><span class="na">toLong</span><span class="o">()</span><span class="s">/1000))</span>
<span class="s">}</span>
<span class="s">// $ groovy gfh -ev oracle&#39; =&gt;</span>
<span class="s">// http://www.oracle.com/</span><span class="n">technology</span><span class="s">/products/</span><span class="n">jdev</span><span class="s">/index.html</span>
<span class="s">//     Last Visited: Thu Feb 15 20:20:36 EST 2007</span>
<span class="s">//     First Visited: Thu Feb 15 20:20:36 EST 2007</span>
<span class="s">//     Referrer: http://docs.codehaus.org/</span><span class="n">display</span><span class="s">/GROOVY/</span><span class="n">Oracle</span><span class="o">+</span><span class="n">JDeveloper</span><span class="o">+</span><span class="n">Plugin</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_15.1</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// The are several Java options builder packages available. Some popular ones:</span>
<span class="c1">//   Apache Jakarta Commons CLI: http://jakarta.apache.org/commons/cli/</span>
<span class="c1">//   jopt-simple: http://jopt-simple.sourceforge.net</span>
<span class="c1">//   args4j: https://args4j.dev.java.net/ (requires Java 5 with annotations)</span>
<span class="c1">//   jargs: http://jargs.sourceforge.net/</span>
<span class="c1">//   te-code: http://te-code.sourceforge.net/article-20041121-cli.html</span>
<span class="c1">// Most of these can be used from Groovy with some Groovy code benefits.</span>
<span class="c1">// Groovy also has the CliBuilder built right in.</span>


<span class="c1">// CliBuilder example</span>
<span class="kt">def</span> <span class="n">cli</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CliBuilder</span><span class="o">()</span>
<span class="n">cli</span><span class="o">.</span><span class="na">v</span><span class="o">(</span><span class="nl">longOpt:</span> <span class="s1">&#39;verbose&#39;</span><span class="o">,</span> <span class="s1">&#39;verbose mode&#39;</span><span class="o">)</span>
<span class="n">cli</span><span class="o">.</span><span class="na">D</span><span class="o">(</span><span class="nl">longOpt:</span> <span class="s1">&#39;Debug&#39;</span><span class="o">,</span> <span class="s1">&#39;display debug info&#39;</span><span class="o">)</span>
<span class="n">cli</span><span class="o">.</span><span class="na">o</span><span class="o">(</span><span class="nl">longOpt:</span> <span class="s1">&#39;output&#39;</span><span class="o">,</span> <span class="s1">&#39;use/specify output file&#39;</span><span class="o">)</span>
<span class="kt">def</span> <span class="n">options</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">args</span><span class="o">)</span>
<span class="k">if</span> <span class="o">(</span><span class="n">options</span><span class="o">.</span><span class="na">v</span><span class="o">)</span> <span class="c1">// ...</span>
<span class="k">if</span> <span class="o">(</span><span class="n">options</span><span class="o">.</span><span class="na">D</span><span class="o">)</span> <span class="n">println</span> <span class="s1">&#39;Debugging info available&#39;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">options</span><span class="o">.</span><span class="na">o</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s1">&#39;Output file flag was specified&#39;</span>
    <span class="n">println</span> <span class="s2">&quot;Output file is ${options.o}&quot;</span>
<span class="o">}</span>
<span class="c1">// ...</span>


<span class="c1">// jopt-simple example 1 (short form)</span>
<span class="n">cli</span> <span class="o">=</span> <span class="k">new</span> <span class="n">joptsimple</span><span class="o">.</span><span class="na">OptionParser</span><span class="o">(</span><span class="s2">&quot;vDo::&quot;</span><span class="o">)</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">args</span><span class="o">)</span>
<span class="k">if</span> <span class="o">(</span><span class="n">options</span><span class="o">.</span><span class="na">wasDetected</span><span class="o">(</span><span class="s1">&#39;o&#39;</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s1">&#39;Output file flag was specified.&#39;</span>
    <span class="n">println</span> <span class="s2">&quot;Output file is ${options.argumentsOf(&#39;o&#39;)}&quot;</span>
<span class="o">}</span>
<span class="c1">// ...</span>


<span class="c1">// jopt-simple example 2 (declarative form)</span>
<span class="n">op</span> <span class="o">=</span> <span class="k">new</span> <span class="n">joptsimple</span><span class="o">.</span><span class="na">OptionParser</span><span class="o">()</span>
<span class="n">VERBOSE</span> <span class="o">=</span> <span class="s1">&#39;v&#39;</span><span class="o">;</span>  <span class="n">op</span><span class="o">.</span><span class="na">accepts</span><span class="o">(</span> <span class="n">VERBOSE</span><span class="o">,</span>  <span class="s2">&quot;verbose mode&quot;</span> <span class="o">)</span>
<span class="n">DEBUG</span>   <span class="o">=</span> <span class="s1">&#39;D&#39;</span><span class="o">;</span>  <span class="n">op</span><span class="o">.</span><span class="na">accepts</span><span class="o">(</span> <span class="n">DEBUG</span><span class="o">,</span>    <span class="s2">&quot;display debug info&quot;</span> <span class="o">)</span>
<span class="n">OUTPUT</span>  <span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="o">;</span>  <span class="n">op</span><span class="o">.</span><span class="na">accepts</span><span class="o">(</span> <span class="n">OUTPUT</span><span class="o">,</span>   <span class="s2">&quot;use/specify output file&quot;</span> <span class="o">).</span><span class="na">withOptionalArg</span><span class="o">().</span>
    <span class="n">describedAs</span><span class="o">(</span> <span class="s2">&quot;file&quot;</span> <span class="o">).</span><span class="na">ofType</span><span class="o">(</span> <span class="n">File</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">args</span><span class="o">)</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="na">nonOptionArguments</span><span class="o">()</span>
<span class="k">if</span> <span class="o">(</span><span class="n">options</span><span class="o">.</span><span class="na">wasDetected</span><span class="o">(</span> <span class="n">DEBUG</span> <span class="o">))</span> <span class="n">println</span> <span class="s1">&#39;Debugging info available&#39;</span>
<span class="c1">// ...</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_15.2</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy like Java can be run in a variety of scenarios, not just interactive vs</span>
<span class="c1">// non-interative, e.g. within a servlet container. Sometimes InputStreams and other</span>
<span class="c1">// mechanisms are used to hide away differences between the different containers</span>
<span class="c1">// in which code is run; other times, code needs to be written purpose-built for</span>
<span class="c1">// the container in which it is running. In most situations where the latter applies</span>
<span class="c1">// the container will have specific lifecycle mechanisms to allow the code to</span>
<span class="c1">// access specific needs, e.g. javax.servlet.ServletRequest.getInputStream()</span>
<span class="c1">// rather than System.in</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_15.3</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Idiomatically Groovy encourages GUI over text-based applications where a rich</span>
<span class="c1">// interface is desirable. Libraries for richer text-based interfaces include:</span>
<span class="c1">// jline: http://jline.sourceforge.net</span>
<span class="c1">// jcurses: http://sourceforge.net/projects/javacurses/</span>
<span class="c1">// java-readline: http://java-readline.sourceforge.net</span>
<span class="c1">// enigma console: http://sourceforge.net/projects/enigma-shell/</span>
<span class="c1">// Note: Run examples using these libraries from command line not inside an IDE.</span>

<span class="c1">// If you are using a terminal/console that understands ANSI codes</span>
<span class="c1">// (excludes WinNT derivatives) you can just print the ANSI codes</span>
<span class="n">print</span> <span class="o">((</span><span class="kt">char</span><span class="o">)</span><span class="mi">27</span> <span class="o">+</span> <span class="s1">&#39;[2J&#39;</span><span class="o">)</span>

<span class="c1">// jline has constants for ANSI codes</span>
<span class="kn">import</span> <span class="nn">jline.ANSIBuffer</span>
<span class="n">print</span> <span class="n">ANSIBuffer</span><span class="o">.</span><span class="na">ANSICodes</span><span class="o">.</span><span class="na">clrscr</span><span class="o">()</span>
<span class="c1">// Also available through ConsoleReader.clearScreen()</span>

<span class="c1">// Using jcurses</span>
<span class="kn">import</span> <span class="nn">jcurses.system.*</span>
<span class="n">bg</span> <span class="o">=</span> <span class="n">CharColor</span><span class="o">.</span><span class="na">BLACK</span>
<span class="n">fg</span> <span class="o">=</span> <span class="n">CharColor</span><span class="o">.</span><span class="na">WHITE</span>
<span class="n">screenColors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CharColor</span><span class="o">(</span><span class="n">bg</span><span class="o">,</span> <span class="n">fg</span><span class="o">)</span>
<span class="n">Toolkit</span><span class="o">.</span><span class="na">clearScreen</span><span class="o">(</span><span class="n">screenColors</span><span class="o">)</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_15.4</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Not idiomatic for Groovy to use text-based applications here.</span>

<span class="c1">// Using jcurses: http://sourceforge.net/projects/javacurses/</span>
<span class="c1">// use Toolkit.screenWidth and Toolkit.screenHeight</span>

<span class="c1">// &#39;barchart&#39; example</span>
<span class="kn">import</span> <span class="nn">jcurses.system.Toolkit</span>
<span class="n">numCols</span> <span class="o">=</span> <span class="n">Toolkit</span><span class="o">.</span><span class="na">screenWidth</span>
<span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">()</span>
<span class="k">if</span> <span class="o">(</span><span class="n">numCols</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="o">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s2">&quot;You must have at least 20 characters&quot;</span><span class="o">)</span>
<span class="n">values</span> <span class="o">=</span> <span class="o">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="o">).</span><span class="na">collect</span> <span class="o">{</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span> <span class="o">}</span>  <span class="c1">// generate rand values</span>
<span class="n">max</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="na">max</span><span class="o">()</span>
<span class="n">ratio</span> <span class="o">=</span> <span class="o">(</span><span class="n">numCols</span> <span class="o">-</span> <span class="mi">12</span><span class="o">)</span><span class="s">/max</span>
<span class="s">values.each{ i -&gt;</span>
<span class="s">    printf(&#39;%8.1f %s\n&#39;, [i as double, &quot;*&quot; * ratio * i])</span>
<span class="s">}</span>

<span class="s">// gives, for example:</span>
<span class="s">//   15.0 *******************************</span>
<span class="s">//   10.0 *********************</span>
<span class="s">//    5.0 **********</span>
<span class="s">//   14.0 *****************************</span>
<span class="s">//   18.0 **************************************</span>
<span class="s">// Run from command line not inside an IDE which may give false width/</span><span class="n">height</span> <span class="n">values</span><span class="o">.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_15.5</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Idiomatically Groovy encourages GUI over text-based applications where a rich</span>
<span class="c1">// interface is desirable. See 15.3 for richer text-based interface libraries.</span>
<span class="c1">// Note: Run examples using these libraries from command line not inside an IDE.</span>

<span class="c1">// If you are using a terminal/console that understands ANSI codes</span>
<span class="c1">// (excludes WinNT derivatives) you can just print the ANSI codes</span>
<span class="n">ESC</span> <span class="o">=</span> <span class="s2">&quot;${(char)27}&quot;</span>
<span class="n">redOnBlack</span> <span class="o">=</span> <span class="n">ESC</span> <span class="o">+</span> <span class="s1">&#39;[31;40m&#39;</span>
<span class="n">reset</span> <span class="o">=</span> <span class="n">ESC</span> <span class="o">+</span> <span class="s1">&#39;[0m&#39;</span>
<span class="n">println</span> <span class="o">(</span><span class="n">redOnBlack</span> <span class="o">+</span> <span class="s1">&#39;Danger, Will Robinson!&#39;</span> <span class="o">+</span> <span class="n">reset</span><span class="o">)</span>

<span class="c1">// jline has constants for ANSI codes</span>
<span class="kn">import</span> <span class="nn">jline.ANSIBuffer</span>
<span class="n">redOnBlack</span> <span class="o">=</span> <span class="n">ANSIBuffer</span><span class="o">.</span><span class="na">ANSICodes</span><span class="o">.</span><span class="na">attrib</span><span class="o">(</span><span class="mi">31</span><span class="o">)</span> <span class="o">+</span> <span class="n">ANSIBuffer</span><span class="o">.</span><span class="na">ANSICodes</span><span class="o">.</span><span class="na">attrib</span><span class="o">(</span><span class="mi">40</span><span class="o">)</span>
<span class="n">reset</span> <span class="o">=</span> <span class="n">ANSIBuffer</span><span class="o">.</span><span class="na">ANSICodes</span><span class="o">.</span><span class="na">attrib</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
<span class="n">println</span> <span class="n">redOnBlack</span> <span class="o">+</span> <span class="s1">&#39;Danger, Will Robinson!&#39;</span> <span class="o">+</span> <span class="n">reset</span>

<span class="c1">// Using JavaCurses</span>
<span class="kn">import</span> <span class="nn">jcurses.system.*</span>
<span class="kn">import</span> <span class="nn">jcurses.widgets.*</span>
<span class="n">whiteOnBlack</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CharColor</span><span class="o">(</span><span class="n">CharColor</span><span class="o">.</span><span class="na">BLACK</span><span class="o">,</span> <span class="n">CharColor</span><span class="o">.</span><span class="na">WHITE</span><span class="o">)</span>
<span class="n">Toolkit</span><span class="o">.</span><span class="na">clearScreen</span><span class="o">(</span><span class="n">whiteOnBlack</span><span class="o">)</span>
<span class="n">redOnBlack</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CharColor</span><span class="o">(</span><span class="n">CharColor</span><span class="o">.</span><span class="na">BLACK</span><span class="o">,</span> <span class="n">CharColor</span><span class="o">.</span><span class="na">RED</span><span class="o">)</span>
<span class="n">Toolkit</span><span class="o">.</span><span class="na">printString</span><span class="o">(</span><span class="s2">&quot;Danger, Will Robinson!&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">redOnBlack</span><span class="o">)</span>
<span class="n">Toolkit</span><span class="o">.</span><span class="na">printString</span><span class="o">(</span><span class="s2">&quot;This is just normal text.&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="n">whiteOnBlack</span><span class="o">)</span>
<span class="c1">// Blink not supported by JavaCurses</span>

<span class="c1">// Using jline constants for Blink</span>
<span class="n">blink</span> <span class="o">=</span> <span class="n">ANSIBuffer</span><span class="o">.</span><span class="na">ANSICodes</span><span class="o">.</span><span class="na">attrib</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
<span class="n">reset</span> <span class="o">=</span> <span class="n">ANSIBuffer</span><span class="o">.</span><span class="na">ANSICodes</span><span class="o">.</span><span class="na">attrib</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
<span class="n">println</span> <span class="o">(</span><span class="n">blink</span> <span class="o">+</span> <span class="s1">&#39;Do you hurt yet?&#39;</span> <span class="o">+</span> <span class="n">reset</span><span class="o">)</span>

<span class="c1">// Using jline constants for Coral snake rhyme</span>
<span class="kt">def</span> <span class="nf">ansi</span><span class="o">(</span><span class="n">code</span><span class="o">)</span> <span class="o">{</span> <span class="n">ANSIBuffer</span><span class="o">.</span><span class="na">ANSICodes</span><span class="o">.</span><span class="na">attrib</span><span class="o">(</span><span class="n">code</span><span class="o">)</span> <span class="o">}</span>
<span class="n">redOnBlack</span> <span class="o">=</span> <span class="n">ansi</span><span class="o">(</span><span class="mi">31</span><span class="o">)</span> <span class="o">+</span> <span class="n">ansi</span><span class="o">(</span><span class="mi">40</span><span class="o">)</span>
<span class="n">redOnYellow</span> <span class="o">=</span> <span class="n">ansi</span><span class="o">(</span><span class="mi">31</span><span class="o">)</span> <span class="o">+</span> <span class="n">ansi</span><span class="o">(</span><span class="mi">43</span><span class="o">)</span>
<span class="n">greenOnCyanBlink</span> <span class="o">=</span> <span class="n">ansi</span><span class="o">(</span><span class="mi">32</span><span class="o">)</span> <span class="o">+</span> <span class="n">ansi</span><span class="o">(</span><span class="mi">46</span><span class="o">)</span> <span class="o">+</span> <span class="n">ansi</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
<span class="n">reset</span> <span class="o">=</span> <span class="n">ansi</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
<span class="n">println</span> <span class="n">redOnBlack</span> <span class="o">+</span> <span class="s2">&quot;venom lack&quot;</span>
<span class="n">println</span> <span class="n">redOnYellow</span> <span class="o">+</span> <span class="s2">&quot;kill that fellow&quot;</span>
<span class="n">println</span> <span class="n">greenOnCyanBlink</span> <span class="o">+</span> <span class="s2">&quot;garish!&quot;</span> <span class="o">+</span> <span class="n">reset</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_15.6</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Default Java libraries buffer System.in by default.</span>

<span class="c1">// Using JavaCurses:</span>
<span class="kn">import</span> <span class="nn">jcurses.system.Toolkit</span>
<span class="n">print</span> <span class="s1">&#39;Press a key: &#39;</span>
<span class="n">println</span> <span class="s2">&quot;\nYou pressed the &#39;${Toolkit.readCharacter().character}&#39; key&quot;</span>

<span class="c1">// Also works for special keys:</span>
<span class="kn">import</span> <span class="nn">jcurses.system.InputChar</span>
<span class="n">print</span> <span class="s2">&quot;Press the &#39;End&#39; key to finish: &quot;</span>
<span class="n">ch</span> <span class="o">=</span> <span class="n">Toolkit</span><span class="o">.</span><span class="na">readCharacter</span><span class="o">()</span>
<span class="k">assert</span> <span class="n">ch</span><span class="o">.</span><span class="na">isSpecialCode</span><span class="o">()</span>
<span class="k">assert</span> <span class="n">ch</span><span class="o">.</span><span class="na">code</span> <span class="o">==</span> <span class="n">InputChar</span><span class="o">.</span><span class="na">KEY_END</span>

<span class="c1">// See also jline Terminal#readCharacter() and Terminal#readVirtualKey()</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_15.7</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">print</span> <span class="s2">&quot;${(char)7}&quot;</span>

<span class="c1">// Using jline constant</span>
<span class="n">print</span> <span class="s2">&quot;${jline.ConsoleOperations.KEYBOARD_BELL}&quot;</span>
<span class="c1">// Also available through ConsoleReader.beep()</span>

<span class="c1">// Using JavaCurses (Works only with terminals that support &#39;beeps&#39;)</span>
<span class="kn">import</span> <span class="nn">jcurses.system.Toolkit</span>
<span class="n">Toolkit</span><span class="o">.</span><span class="na">beep</span><span class="o">()</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_15.8</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// I think you would need to resort to platform specific calls here,</span>
<span class="c1">// E.g. on *nix systems call &#39;stty&#39; using execute().</span>
<span class="c1">// Some things can be set through the packages mentioned in 15.3, e.g.</span>
<span class="c1">// echo can be turned on and off, but others like setting the kill character</span>
<span class="c1">// didn&#39;t appear to be supported (presumably because it doesn&#39;t make</span>
<span class="c1">// sense for a cross-platform toolkit).</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_15.9</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Consider using Java&#39;s PushbackInputStream or PushbackReader</span>
<span class="c1">// Different functionality to original cookbook but can be used</span>
<span class="c1">// as an alternative for some scenarios.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_15.10</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// If using Java 6, use Console.readPassword()</span>
<span class="c1">// Otherwise use jline (use 0 instead of mask character &#39;*&#39; for no echo):</span>
<span class="n">password</span> <span class="o">=</span> <span class="k">new</span> <span class="n">jline</span><span class="o">.</span><span class="na">ConsoleReader</span><span class="o">().</span><span class="na">readLine</span><span class="o">(</span><span class="k">new</span> <span class="n">Character</span><span class="o">(</span><span class="s1">&#39;*&#39;</span><span class="o">))</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_15.11</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// In Groovy (like Java) normal input is buffered so you can normally make</span>
<span class="c1">// edits before hitting &#39;Enter&#39;. For more control over editing (including completion</span>
<span class="c1">// and history etc.) use one of the packages mentioned in 15.3, e.g. jline.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_15.12</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Use javacurses or jline (see 15.3) for low level screen management.</span>
<span class="c1">// Java/Groovy would normally use a GUI for such functionality.</span>

<span class="c1">// Here is a slight variation to cookbook example. This repeatedly calls</span>
<span class="c1">// the command feedin on the command line, e.g. &quot;cmd /c dir&quot; on windows</span>
<span class="c1">// or &#39;ps -aux&#39; on Linux. Whenever a line changes, the old line is &quot;faded</span>
<span class="c1">// out&quot; using font colors from white through to black. Then the new line</span>
<span class="c1">// is faded in using the reverse process.</span>
<span class="kn">import</span> <span class="nn">jcurses.system.*</span>
<span class="n">color</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CharColor</span><span class="o">(</span><span class="n">CharColor</span><span class="o">.</span><span class="na">BLACK</span><span class="o">,</span> <span class="n">CharColor</span><span class="o">.</span><span class="na">WHITE</span><span class="o">)</span>
<span class="n">Toolkit</span><span class="o">.</span><span class="na">clearScreen</span><span class="o">(</span><span class="n">color</span><span class="o">)</span>
<span class="n">maxcol</span> <span class="o">=</span> <span class="n">Toolkit</span><span class="o">.</span><span class="na">screenWidth</span>
<span class="n">maxrow</span> <span class="o">=</span> <span class="n">Toolkit</span><span class="o">.</span><span class="na">screenHeight</span>
<span class="n">colors</span> <span class="o">=</span> <span class="o">[</span><span class="n">CharColor</span><span class="o">.</span><span class="na">WHITE</span><span class="o">,</span> <span class="n">CharColor</span><span class="o">.</span><span class="na">CYAN</span><span class="o">,</span> <span class="n">CharColor</span><span class="o">.</span><span class="na">YELLOW</span><span class="o">,</span> <span class="n">CharColor</span><span class="o">.</span><span class="na">GREEN</span><span class="o">,</span>
          <span class="n">CharColor</span><span class="o">.</span><span class="na">RED</span><span class="o">,</span> <span class="n">CharColor</span><span class="o">.</span><span class="na">BLUE</span><span class="o">,</span> <span class="n">CharColor</span><span class="o">.</span><span class="na">MAGENTA</span><span class="o">,</span> <span class="n">CharColor</span><span class="o">.</span><span class="na">BLACK</span><span class="o">]</span>
<span class="n">done</span> <span class="o">=</span> <span class="kc">false</span>
<span class="n">refresh</span> <span class="o">=</span> <span class="kc">false</span>
<span class="n">waittime</span> <span class="o">=</span> <span class="mi">8000</span>
<span class="n">oldlines</span> <span class="o">=</span> <span class="o">[]</span>
<span class="kt">def</span> <span class="nf">fade</span><span class="o">(</span><span class="n">line</span><span class="o">,</span> <span class="n">row</span><span class="o">,</span> <span class="n">colorList</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..&lt;</span><span class="n">colorList</span><span class="o">.</span><span class="na">size</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">Toolkit</span><span class="o">.</span><span class="na">printString</span><span class="o">(</span><span class="n">line</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">row</span><span class="o">,</span> <span class="k">new</span> <span class="n">CharColor</span><span class="o">(</span><span class="n">CharColor</span><span class="o">.</span><span class="na">BLACK</span><span class="o">,</span> <span class="n">colorList</span><span class="o">[</span><span class="n">i</span><span class="o">]))</span>
        <span class="n">sleep</span> <span class="mi">10</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="k">while</span><span class="o">(!</span><span class="n">done</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">waittime</span> <span class="o">&gt;</span> <span class="mi">9999</span> <span class="o">||</span> <span class="n">refresh</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">execute</span><span class="o">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s1">&#39;\n&#39;</span><span class="o">)</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">r</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..&lt;</span><span class="n">maxrow</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">r</span> <span class="o">&gt;=</span> <span class="n">lines</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">||</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="n">oldlines</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">||</span> <span class="n">lines</span><span class="o">[</span><span class="n">r</span><span class="o">]</span> <span class="o">!=</span> <span class="n">oldlines</span><span class="o">[</span><span class="n">r</span><span class="o">])</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">oldlines</span> <span class="o">!=</span> <span class="o">[])</span>
                    <span class="n">fade</span><span class="o">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">oldlines</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">?</span> <span class="n">oldlines</span><span class="o">[</span><span class="n">r</span><span class="o">]</span> <span class="o">:</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">maxcol</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="n">colors</span><span class="o">)</span>
                <span class="n">fade</span><span class="o">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">lines</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">?</span> <span class="n">lines</span><span class="o">[</span><span class="n">r</span><span class="o">]</span> <span class="o">:</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">maxcol</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="n">colors</span><span class="o">.</span><span class="na">reverse</span><span class="o">())</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">oldlines</span> <span class="o">=</span> <span class="n">lines</span>
        <span class="n">refresh</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="n">waittime</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="o">}</span>
    <span class="n">waittime</span> <span class="o">+=</span> <span class="mi">200</span>
    <span class="n">sleep</span> <span class="mi">200</span>
<span class="o">}</span>

<span class="c1">// Keyboard handling would be similar to 15.6.</span>
<span class="c1">// Something like below but need to synchronize as we are in different threads.</span>
<span class="n">Thread</span><span class="o">.</span><span class="na">start</span><span class="o">{</span>
    <span class="k">while</span><span class="o">(!</span><span class="n">done</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ch</span> <span class="o">=</span> <span class="n">Toolkit</span><span class="o">.</span><span class="na">readCharacter</span><span class="o">()</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ch</span><span class="o">.</span><span class="na">isSpecialCode</span><span class="o">()</span> <span class="o">||</span> <span class="n">ch</span><span class="o">.</span><span class="na">character</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span><span class="o">)</span> <span class="n">done</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="k">else</span> <span class="n">refresh</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_15.13</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// These examples uses expectj, a pure Java Expect-like module.</span>
<span class="c1">// http://expectj.sourceforge.net/</span>
<span class="n">defaultTimeout</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1">// infinite</span>
<span class="n">expect</span> <span class="o">=</span> <span class="k">new</span> <span class="n">expectj</span><span class="o">.</span><span class="na">ExpectJ</span><span class="o">(</span><span class="s2">&quot;logfile.log&quot;</span><span class="o">,</span> <span class="n">defaultTimeout</span><span class="o">)</span>
<span class="n">command</span> <span class="o">=</span> <span class="n">expect</span><span class="o">.</span><span class="na">spawn</span><span class="o">(</span><span class="s2">&quot;program to run&quot;</span><span class="o">)</span>
<span class="n">command</span><span class="o">.</span><span class="na">expect</span><span class="o">(</span><span class="s1">&#39;Password&#39;</span><span class="o">,</span> <span class="mi">10</span><span class="o">)</span>
<span class="c1">// expectj doesn&#39;t support regular expressions, but see readUntil</span>
<span class="c1">// in recipe 18.6 for how to manually code this</span>
<span class="n">command</span><span class="o">.</span><span class="na">expect</span><span class="o">(</span><span class="s1">&#39;invalid&#39;</span><span class="o">)</span>
<span class="n">command</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s1">&#39;Hello, world\r&#39;</span><span class="o">)</span>
<span class="c1">// kill spawned process</span>
<span class="n">command</span><span class="o">.</span><span class="na">stop</span><span class="o">()</span>

<span class="c1">// expecting multiple choices</span>
<span class="c1">// expectj doesn&#39;t support multiple choices, but see readUntil</span>
<span class="c1">// in recipe 18.6 for how to manually code this</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_15.14</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Methods not shown for the edit menu items, they would be the same as for the</span>
<span class="c1">// file menu items.</span>
<span class="kn">import</span> <span class="nn">groovy.swing.SwingBuilder</span>
<span class="kt">def</span> <span class="nf">print</span><span class="o">()</span> <span class="o">{}</span>
<span class="kt">def</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{}</span>
<span class="n">frame</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SwingBuilder</span><span class="o">().</span><span class="na">frame</span><span class="o">(</span><span class="nl">title:</span><span class="s1">&#39;Demo&#39;</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">menuBar</span> <span class="o">{</span>
        <span class="n">menu</span><span class="o">(</span><span class="nl">mnemonic:</span><span class="s1">&#39;F&#39;</span><span class="o">,</span> <span class="s1">&#39;File&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">menuItem</span> <span class="o">(</span><span class="nl">actionPerformed:</span><span class="k">this</span><span class="o">.&amp;</span><span class="n">print</span><span class="o">,</span> <span class="s1">&#39;Print&#39;</span><span class="o">)</span>
            <span class="n">separator</span><span class="o">()</span>
            <span class="n">menuItem</span> <span class="o">(</span><span class="nl">actionPerformed:</span><span class="k">this</span><span class="o">.&amp;</span><span class="n">save</span><span class="o">,</span> <span class="s1">&#39;Save&#39;</span><span class="o">)</span>
            <span class="n">menuItem</span> <span class="o">(</span><span class="nl">actionPerformed:</span><span class="o">{</span><span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">)},</span> <span class="s1">&#39;Quit immediately&#39;</span><span class="o">)</span>
        <span class="o">}</span>
        <span class="n">menu</span><span class="o">(</span><span class="nl">mnemonic:</span><span class="s1">&#39;O&#39;</span><span class="o">,</span> <span class="s1">&#39;Options&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">checkBoxMenuItem</span> <span class="o">(</span><span class="s1">&#39;Create Debugging Info&#39;</span><span class="o">,</span> <span class="nl">state:</span><span class="kc">true</span><span class="o">)</span>
        <span class="o">}</span>
        <span class="n">menu</span><span class="o">(</span><span class="nl">mnemonic:</span><span class="s1">&#39;D&#39;</span><span class="o">,</span> <span class="s1">&#39;Debug&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">buttonGroup</span><span class="o">()</span>
            <span class="n">radioButtonMenuItem</span> <span class="o">(</span><span class="s1">&#39;Log Level 1&#39;</span><span class="o">,</span> <span class="nl">buttonGroup:</span><span class="n">group</span><span class="o">,</span> <span class="nl">selected:</span><span class="kc">true</span><span class="o">)</span>
            <span class="n">radioButtonMenuItem</span> <span class="o">(</span><span class="s1">&#39;Log Level 2&#39;</span><span class="o">,</span> <span class="nl">buttonGroup:</span><span class="n">group</span><span class="o">)</span>
            <span class="n">radioButtonMenuItem</span> <span class="o">(</span><span class="s1">&#39;Log Level 3&#39;</span><span class="o">,</span> <span class="nl">buttonGroup:</span><span class="n">group</span><span class="o">)</span>
        <span class="o">}</span>
        <span class="n">menu</span><span class="o">(</span><span class="nl">mnemonic:</span><span class="s1">&#39;F&#39;</span><span class="o">,</span> <span class="s1">&#39;Format&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">menu</span><span class="o">(</span><span class="s1">&#39;Font&#39;</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">buttonGroup</span><span class="o">()</span>
                <span class="n">radioButtonMenuItem</span> <span class="o">(</span><span class="s1">&#39;Times Roman&#39;</span><span class="o">,</span> <span class="nl">buttonGroup:</span><span class="n">group</span><span class="o">,</span> <span class="nl">selected:</span><span class="kc">true</span><span class="o">)</span>
                <span class="n">radioButtonMenuItem</span> <span class="o">(</span><span class="s1">&#39;Courier&#39;</span><span class="o">,</span> <span class="nl">buttonGroup:</span><span class="n">group</span><span class="o">)</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">menu</span><span class="o">(</span><span class="nl">mnemonic:</span><span class="s1">&#39;E&#39;</span><span class="o">,</span> <span class="s1">&#39;Edit&#39;</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">menuItem</span> <span class="o">(</span><span class="nl">actionPerformed:</span><span class="o">{},</span> <span class="s1">&#39;Copy&#39;</span><span class="o">)</span>
            <span class="n">menuItem</span> <span class="o">(</span><span class="nl">actionPerformed:</span><span class="o">{},</span> <span class="s1">&#39;Cut&#39;</span><span class="o">)</span>
            <span class="n">menuItem</span> <span class="o">(</span><span class="nl">actionPerformed:</span><span class="o">{},</span> <span class="s1">&#39;Paste&#39;</span><span class="o">)</span>
            <span class="n">menuItem</span> <span class="o">(</span><span class="nl">actionPerformed:</span><span class="o">{},</span> <span class="s1">&#39;Delete&#39;</span><span class="o">)</span>
            <span class="n">separator</span><span class="o">()</span>
            <span class="n">menu</span><span class="o">(</span><span class="s1">&#39;Object ...&#39;</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">menuItem</span> <span class="o">(</span><span class="nl">actionPerformed:</span><span class="o">{},</span> <span class="s1">&#39;Circle&#39;</span><span class="o">)</span>
                <span class="n">menuItem</span> <span class="o">(</span><span class="nl">actionPerformed:</span><span class="o">{},</span> <span class="s1">&#39;Square&#39;</span><span class="o">)</span>
                <span class="n">menuItem</span> <span class="o">(</span><span class="nl">actionPerformed:</span><span class="o">{},</span> <span class="s1">&#39;Point&#39;</span><span class="o">)</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">frame</span><span class="o">.</span><span class="na">pack</span><span class="o">()</span>
<span class="n">frame</span><span class="o">.</span><span class="na">show</span><span class="o">()</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_15.15</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Registration Example</span>
<span class="kn">import</span> <span class="nn">groovy.swing.SwingBuilder</span>
<span class="kt">def</span> <span class="nf">cancel</span><span class="o">(</span><span class="n">event</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s1">&#39;Sorry you decided not to register.&#39;</span>
    <span class="n">dialog</span><span class="o">.</span><span class="na">dispose</span><span class="o">()</span>
<span class="o">}</span>
<span class="kt">def</span> <span class="nf">register</span><span class="o">(</span><span class="n">event</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">swing</span><span class="o">.</span><span class="na">name</span><span class="o">?.</span><span class="na">text</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">println</span> <span class="s2">&quot;Welcome to the fold $swing.name.text&quot;</span>
        <span class="n">dialog</span><span class="o">.</span><span class="na">dispose</span><span class="o">()</span>
    <span class="o">}</span> <span class="k">else</span> <span class="n">println</span> <span class="s2">&quot;You didn&#39;t give me your name!&quot;</span>
<span class="o">}</span>
<span class="kt">def</span> <span class="nf">dialog</span><span class="o">(</span><span class="n">event</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">dialog</span> <span class="o">=</span> <span class="n">swing</span><span class="o">.</span><span class="na">createDialog</span><span class="o">(</span><span class="nl">title:</span><span class="s1">&#39;Entry&#39;</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">panel</span> <span class="o">=</span> <span class="n">swing</span><span class="o">.</span><span class="na">panel</span> <span class="o">{</span>
        <span class="n">vbox</span> <span class="o">{</span>
            <span class="n">hbox</span> <span class="o">{</span>
                <span class="n">label</span><span class="o">(</span><span class="nl">text:</span><span class="s1">&#39;Name&#39;</span><span class="o">)</span>
                <span class="n">textField</span><span class="o">(</span><span class="nl">columns:</span><span class="mi">20</span><span class="o">,</span> <span class="nl">id:</span><span class="s1">&#39;name&#39;</span><span class="o">)</span>
            <span class="o">}</span>
            <span class="n">hbox</span> <span class="o">{</span>
                <span class="n">button</span><span class="o">(</span><span class="s1">&#39;Register&#39;</span><span class="o">,</span> <span class="nl">actionPerformed:</span><span class="k">this</span><span class="o">.&amp;</span><span class="n">register</span><span class="o">)</span>
                <span class="n">button</span><span class="o">(</span><span class="s1">&#39;Cancel&#39;</span><span class="o">,</span> <span class="nl">actionPerformed:</span><span class="k">this</span><span class="o">.&amp;</span><span class="n">cancel</span><span class="o">)</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">dialog</span><span class="o">.</span><span class="na">getContentPane</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">panel</span><span class="o">)</span>
    <span class="n">dialog</span><span class="o">.</span><span class="na">pack</span><span class="o">()</span>
    <span class="n">dialog</span><span class="o">.</span><span class="na">show</span><span class="o">()</span>
<span class="o">}</span>
<span class="n">swing</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SwingBuilder</span><span class="o">()</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">swing</span><span class="o">.</span><span class="na">frame</span><span class="o">(</span><span class="nl">title:</span><span class="s1">&#39;Registration Example&#39;</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">panel</span> <span class="o">{</span>
        <span class="n">button</span><span class="o">(</span><span class="nl">actionPerformed:</span><span class="k">this</span><span class="o">.&amp;</span><span class="n">dialog</span><span class="o">,</span> <span class="s1">&#39;Click Here For Registration Form&#39;</span><span class="o">)</span>
        <span class="n">glue</span><span class="o">()</span>
        <span class="n">button</span><span class="o">(</span><span class="nl">actionPerformed:</span><span class="o">{</span><span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">)},</span> <span class="s1">&#39;Quit&#39;</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">frame</span><span class="o">.</span><span class="na">pack</span><span class="o">()</span>
<span class="n">frame</span><span class="o">.</span><span class="na">show</span><span class="o">()</span>


<span class="c1">// Error Example, slight variation to original cookbook</span>
<span class="kn">import</span> <span class="nn">groovy.swing.SwingBuilder</span>
<span class="kn">import</span> <span class="nn">javax.swing.WindowConstants</span> <span class="k">as</span> <span class="n">WC</span>
<span class="kn">import</span> <span class="nn">javax.swing.JOptionPane</span>
<span class="kt">def</span> <span class="nf">calculate</span><span class="o">(</span><span class="n">event</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">swing</span><span class="o">.</span><span class="na">result</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="n">evaluate</span><span class="o">(</span><span class="n">swing</span><span class="o">.</span><span class="na">expr</span><span class="o">.</span><span class="na">text</span><span class="o">)</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">JOptionPane</span><span class="o">.</span><span class="na">showMessageDialog</span><span class="o">(</span><span class="n">frame</span><span class="o">,</span> <span class="n">ex</span><span class="o">.</span><span class="na">message</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">swing</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SwingBuilder</span><span class="o">()</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">swing</span><span class="o">.</span><span class="na">frame</span><span class="o">(</span><span class="nl">title:</span><span class="s1">&#39;Calculator Example&#39;</span><span class="o">,</span>
    <span class="nl">defaultCloseOperation:</span><span class="n">WC</span><span class="o">.</span><span class="na">EXIT_ON_CLOSE</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">panel</span> <span class="o">{</span>
        <span class="n">vbox</span> <span class="o">{</span>
            <span class="n">hbox</span> <span class="o">{</span>
                <span class="n">label</span><span class="o">(</span><span class="nl">text:</span><span class="s1">&#39;Expression&#39;</span><span class="o">)</span>
                <span class="n">hstrut</span><span class="o">()</span>
                <span class="n">textField</span><span class="o">(</span><span class="nl">columns:</span><span class="mi">12</span><span class="o">,</span> <span class="nl">id:</span><span class="s1">&#39;expr&#39;</span><span class="o">)</span>
            <span class="o">}</span>
            <span class="n">hbox</span> <span class="o">{</span>
                <span class="n">label</span><span class="o">(</span><span class="nl">text:</span><span class="s1">&#39;Result&#39;</span><span class="o">)</span>
                <span class="n">glue</span><span class="o">()</span>
                <span class="n">label</span><span class="o">(</span><span class="nl">id:</span><span class="s1">&#39;result&#39;</span><span class="o">)</span>
            <span class="o">}</span>
            <span class="n">hbox</span> <span class="o">{</span>
                <span class="n">button</span><span class="o">(</span><span class="s1">&#39;Calculate&#39;</span><span class="o">,</span> <span class="nl">actionPerformed:</span><span class="k">this</span><span class="o">.&amp;</span><span class="n">calculate</span><span class="o">)</span>
                <span class="n">button</span><span class="o">(</span><span class="s1">&#39;Quit&#39;</span><span class="o">,</span> <span class="nl">actionPerformed:</span><span class="o">{</span><span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">)})</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">frame</span><span class="o">.</span><span class="na">pack</span><span class="o">()</span>
<span class="n">frame</span><span class="o">.</span><span class="na">show</span><span class="o">()</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_15.16</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Resizing in Groovy follows Java rules, i.e. is dependent on the layout manager.</span>
<span class="c1">// You can set preferred, minimum and maximum sizes (may be ignored by some layout managers).</span>
<span class="c1">// You can setResizable(false) for some components.</span>
<span class="c1">// You can specify a weight value for some layout managers, e.g. GridBagLayout</span>
<span class="c1">// which control the degree of scaling which occurs during resizing.</span>
<span class="c1">// Some layout managers, e.g. GridLayout, automaticaly resize their contained widgets.</span>
<span class="c1">// You can capture resize events and do everything manually yourself.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_15.17</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Removing DOS console on Windows:</span>
<span class="c1">// If you are using java.exe to start your Groovy script, use javaw.exe instead.</span>
<span class="c1">// If you are using groovy.exe to start your Groovy script, use groovyw.exe instead.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_15.18</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// additions to original cookbook:</span>
<span class="c1">// random starting position</span>
<span class="c1">// color changes after each bounce</span>
<span class="kn">import</span> <span class="nn">jcurses.system.*</span>
<span class="n">color</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CharColor</span><span class="o">(</span><span class="n">CharColor</span><span class="o">.</span><span class="na">BLACK</span><span class="o">,</span> <span class="n">CharColor</span><span class="o">.</span><span class="na">WHITE</span><span class="o">)</span>
<span class="n">Toolkit</span><span class="o">.</span><span class="na">clearScreen</span><span class="o">(</span><span class="n">color</span><span class="o">)</span>
<span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">()</span>
<span class="n">maxrow</span> <span class="o">=</span> <span class="n">Toolkit</span><span class="o">.</span><span class="na">screenWidth</span>
<span class="n">maxcol</span> <span class="o">=</span> <span class="n">Toolkit</span><span class="o">.</span><span class="na">screenHeight</span>
<span class="n">rowinc</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">colinc</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">row</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">maxrow</span><span class="o">)</span>
<span class="n">col</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">maxcol</span><span class="o">)</span>
<span class="n">chars</span> <span class="o">=</span> <span class="s1">&#39;*-/|\\_&#39;</span>
<span class="n">colors</span> <span class="o">=</span> <span class="o">[</span><span class="n">CharColor</span><span class="o">.</span><span class="na">RED</span><span class="o">,</span> <span class="n">CharColor</span><span class="o">.</span><span class="na">BLUE</span><span class="o">,</span> <span class="n">CharColor</span><span class="o">.</span><span class="na">YELLOW</span><span class="o">,</span>
          <span class="n">CharColor</span><span class="o">.</span><span class="na">GREEN</span><span class="o">,</span> <span class="n">CharColor</span><span class="o">.</span><span class="na">CYAN</span><span class="o">,</span> <span class="n">CharColor</span><span class="o">.</span><span class="na">MAGENTA</span><span class="o">]</span>
<span class="n">delay</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">ch</span> <span class="o">=</span> <span class="kc">null</span>
<span class="kt">def</span> <span class="nf">nextChar</span><span class="o">(){</span>
    <span class="n">ch</span> <span class="o">=</span> <span class="n">chars</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
    <span class="n">chars</span> <span class="o">=</span> <span class="n">chars</span><span class="o">[</span><span class="mi">1</span><span class="o">..-</span><span class="mi">1</span><span class="o">]</span> <span class="o">+</span> <span class="n">chars</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
    <span class="n">color</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CharColor</span><span class="o">(</span><span class="n">CharColor</span><span class="o">.</span><span class="na">BLACK</span><span class="o">,</span> <span class="n">colors</span><span class="o">[</span><span class="mi">0</span><span class="o">])</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span><span class="o">[</span><span class="mi">1</span><span class="o">..-</span><span class="mi">1</span><span class="o">]</span> <span class="o">+</span> <span class="n">colors</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
<span class="o">}</span>
<span class="n">nextChar</span><span class="o">()</span>
<span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Toolkit</span><span class="o">.</span><span class="na">printString</span><span class="o">(</span><span class="n">ch</span><span class="o">,</span> <span class="n">row</span><span class="o">,</span> <span class="n">col</span><span class="o">,</span> <span class="n">color</span><span class="o">)</span>
    <span class="n">sleep</span> <span class="n">delay</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="n">rowinc</span>
    <span class="n">col</span> <span class="o">=</span> <span class="n">col</span> <span class="o">+</span> <span class="n">colinc</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">row</span> <span class="k">in</span> <span class="o">[</span><span class="mi">0</span><span class="o">,</span> <span class="n">maxrow</span><span class="o">])</span> <span class="o">{</span> <span class="n">nextChar</span><span class="o">();</span> <span class="n">rowinc</span> <span class="o">=</span> <span class="o">-</span><span class="n">rowinc</span> <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">col</span> <span class="k">in</span> <span class="o">[</span><span class="mi">0</span><span class="o">,</span> <span class="n">maxcol</span><span class="o">])</span> <span class="o">{</span> <span class="n">nextChar</span><span class="o">();</span> <span class="n">colinc</span> <span class="o">=</span> <span class="o">-</span><span class="n">colinc</span> <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_15.19</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Variation to cookbook. Let&#39;s you reshuffle lines in a multi-line string</span>
<span class="c1">// by drag-n-drop.</span>
<span class="kn">import</span> <span class="nn">java.awt.*</span>
<span class="kn">import</span> <span class="nn">java.awt.datatransfer.*</span>
<span class="kn">import</span> <span class="nn">java.awt.dnd.*</span>
<span class="kn">import</span> <span class="nn">javax.swing.*</span>
<span class="kn">import</span> <span class="nn">javax.swing.ScrollPaneConstants</span> <span class="k">as</span> <span class="n">SPC</span>

<span class="kd">class</span> <span class="nc">DragDropList</span> <span class="kd">extends</span> <span class="n">JList</span> <span class="kd">implements</span>
        <span class="n">DragSourceListener</span><span class="o">,</span> <span class="n">DropTargetListener</span><span class="o">,</span> <span class="n">DragGestureListener</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">dragSource</span>
    <span class="kt">def</span> <span class="n">dropTarget</span>
    <span class="kt">def</span> <span class="n">dropTargetCell</span>
    <span class="kt">int</span> <span class="n">draggedIndex</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="kt">def</span> <span class="n">localDataFlavor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataFlavor</span><span class="o">(</span><span class="n">DataFlavor</span><span class="o">.</span><span class="na">javaJVMLocalObjectMimeType</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">supportedFlavors</span> <span class="o">=</span> <span class="o">[</span><span class="n">localDataFlavor</span><span class="o">]</span> <span class="k">as</span> <span class="n">DataFlavor</span><span class="o">[]</span>

    <span class="kd">public</span> <span class="nf">DragDropList</span><span class="o">(</span><span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">()</span>
        <span class="n">setModel</span><span class="o">(</span><span class="n">model</span><span class="o">)</span>
        <span class="n">setCellRenderer</span><span class="o">(</span><span class="k">new</span> <span class="n">DragDropCellRenderer</span><span class="o">(</span><span class="k">this</span><span class="o">))</span>
        <span class="n">dragSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DragSource</span><span class="o">()</span>
        <span class="n">dragSource</span><span class="o">.</span><span class="na">createDefaultDragGestureRecognizer</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">DnDConstants</span><span class="o">.</span><span class="na">ACTION_MOVE</span><span class="o">,</span> <span class="k">this</span><span class="o">)</span>
        <span class="n">dropTarget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DropTarget</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">this</span><span class="o">)</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dragGestureRecognized</span><span class="o">(</span><span class="n">DragGestureEvent</span> <span class="n">dge</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">locationToIndex</span><span class="o">(</span><span class="n">dge</span><span class="o">.</span><span class="na">dragOrigin</span><span class="o">)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="n">index</span> <span class="o">==</span> <span class="n">model</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="k">return</span>
        <span class="kt">def</span> <span class="n">trans</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CustomTransferable</span><span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="na">getElementAt</span><span class="o">(</span><span class="n">index</span><span class="o">),</span> <span class="k">this</span><span class="o">)</span>
        <span class="n">draggedIndex</span> <span class="o">=</span> <span class="n">index</span>
        <span class="n">dragSource</span><span class="o">.</span><span class="na">startDrag</span><span class="o">(</span><span class="n">dge</span><span class="o">,</span> <span class="n">Cursor</span><span class="o">.</span><span class="na">defaultCursor</span><span class="o">,</span> <span class="n">trans</span><span class="o">,</span> <span class="k">this</span><span class="o">)</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dragDropEnd</span><span class="o">(</span><span class="n">DragSourceDropEvent</span> <span class="n">dsde</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">dropTargetCell</span> <span class="o">=</span> <span class="kc">null</span>
        <span class="n">draggedIndex</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">repaint</span><span class="o">()</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dragEnter</span><span class="o">(</span><span class="n">DragSourceDragEvent</span> <span class="n">dsde</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dragExit</span><span class="o">(</span><span class="n">DragSourceEvent</span> <span class="n">dse</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dragOver</span><span class="o">(</span><span class="n">DragSourceDragEvent</span> <span class="n">dsde</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dropActionChanged</span><span class="o">(</span><span class="n">DragSourceDragEvent</span> <span class="n">dsde</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dropActionChanged</span><span class="o">(</span><span class="n">DropTargetDragEvent</span> <span class="n">dtde</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dragExit</span><span class="o">(</span><span class="n">DropTargetEvent</span> <span class="n">dte</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dragEnter</span><span class="o">(</span><span class="n">DropTargetDragEvent</span> <span class="n">dtde</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">dtde</span><span class="o">.</span><span class="na">source</span> <span class="o">!=</span> <span class="n">dropTarget</span><span class="o">)</span> <span class="n">dtde</span><span class="o">.</span><span class="na">rejectDrag</span><span class="o">()</span>
        <span class="k">else</span> <span class="n">dtde</span><span class="o">.</span><span class="na">acceptDrag</span><span class="o">(</span><span class="n">DnDConstants</span><span class="o">.</span><span class="na">ACTION_COPY_OR_MOVE</span><span class="o">)</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">dragOver</span><span class="o">(</span><span class="n">DropTargetDragEvent</span> <span class="n">dtde</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">dtde</span><span class="o">.</span><span class="na">source</span> <span class="o">!=</span> <span class="n">dropTarget</span><span class="o">)</span> <span class="n">dtde</span><span class="o">.</span><span class="na">rejectDrag</span><span class="o">()</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">locationToIndex</span><span class="o">(</span><span class="n">dtde</span><span class="o">.</span><span class="na">location</span><span class="o">)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="n">index</span> <span class="o">==</span> <span class="n">draggedIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="n">dropTargetCell</span> <span class="o">=</span> <span class="kc">null</span>
        <span class="k">else</span> <span class="n">dropTargetCell</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">getElementAt</span><span class="o">(</span><span class="n">index</span><span class="o">)</span>
        <span class="n">repaint</span><span class="o">()</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">drop</span><span class="o">(</span><span class="n">DropTargetDropEvent</span> <span class="n">dtde</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">dtde</span><span class="o">.</span><span class="na">source</span> <span class="o">!=</span> <span class="n">dropTarget</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">dtde</span><span class="o">.</span><span class="na">rejectDrop</span><span class="o">()</span>
            <span class="k">return</span>
        <span class="o">}</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">locationToIndex</span><span class="o">(</span><span class="n">dtde</span><span class="o">.</span><span class="na">location</span><span class="o">)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="n">index</span> <span class="o">==</span> <span class="n">draggedIndex</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">dtde</span><span class="o">.</span><span class="na">rejectDrop</span><span class="o">()</span>
            <span class="k">return</span>
        <span class="o">}</span>
        <span class="n">dtde</span><span class="o">.</span><span class="na">acceptDrop</span><span class="o">(</span><span class="n">DnDConstants</span><span class="o">.</span><span class="na">ACTION_MOVE</span><span class="o">)</span>
        <span class="kt">def</span> <span class="n">dragged</span> <span class="o">=</span> <span class="n">dtde</span><span class="o">.</span><span class="na">transferable</span><span class="o">.</span><span class="na">getTransferData</span><span class="o">(</span><span class="n">localDataFlavor</span><span class="o">)</span>
        <span class="kt">boolean</span> <span class="n">sourceBeforeTarget</span> <span class="o">=</span> <span class="o">(</span><span class="n">draggedIndex</span> <span class="o">&lt;</span> <span class="n">index</span><span class="o">)</span>
        <span class="n">model</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">draggedIndex</span><span class="o">)</span>
        <span class="n">model</span><span class="o">.</span><span class="na">add</span><span class="o">((</span><span class="n">sourceBeforeTarget</span> <span class="o">?</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">index</span><span class="o">),</span> <span class="n">dragged</span><span class="o">)</span>
        <span class="n">dtde</span><span class="o">.</span><span class="na">dropComplete</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">CustomTransferable</span> <span class="kd">implements</span> <span class="n">Transferable</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">object</span>
    <span class="kt">def</span> <span class="n">ddlist</span>

    <span class="kd">public</span> <span class="nf">CustomTransferable</span><span class="o">(</span><span class="n">object</span><span class="o">,</span> <span class="n">ddlist</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">object</span> <span class="o">=</span> <span class="n">object</span>
        <span class="k">this</span><span class="o">.</span><span class="na">ddlist</span> <span class="o">=</span> <span class="n">ddlist</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getTransferData</span><span class="o">(</span><span class="n">DataFlavor</span> <span class="n">df</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">isDataFlavorSupported</span><span class="o">(</span><span class="n">df</span><span class="o">))</span> <span class="k">return</span> <span class="n">object</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isDataFlavorSupported</span><span class="o">(</span><span class="n">DataFlavor</span> <span class="n">df</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">ddlist</span><span class="o">.</span><span class="na">localDataFlavor</span><span class="o">)</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">DataFlavor</span><span class="o">[]</span> <span class="nf">getTransferDataFlavors</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ddlist</span><span class="o">.</span><span class="na">supportedFlavors</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">DragDropCellRenderer</span> <span class="kd">extends</span> <span class="n">DefaultListCellRenderer</span> <span class="o">{</span>
    <span class="kt">boolean</span> <span class="n">isTargetCell</span>
    <span class="kt">def</span> <span class="n">ddlist</span>

    <span class="kd">public</span> <span class="nf">DragDropCellRenderer</span><span class="o">(</span><span class="n">ddlist</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">()</span>
        <span class="k">this</span><span class="o">.</span><span class="na">ddlist</span> <span class="o">=</span> <span class="n">ddlist</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Component</span> <span class="nf">getListCellRendererComponent</span><span class="o">(</span><span class="n">JList</span> <span class="n">list</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">,</span>
            <span class="kt">int</span> <span class="n">index</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">isSelected</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">hasFocus</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">isTargetCell</span> <span class="o">=</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="n">ddlist</span><span class="o">.</span><span class="na">dropTargetCell</span><span class="o">)</span>
        <span class="kt">boolean</span> <span class="n">showSelected</span> <span class="o">=</span> <span class="n">isSelected</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">isTargetCell</span>
        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">getListCellRendererComponent</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">index</span><span class="o">,</span> <span class="n">showSelected</span><span class="o">,</span> <span class="n">hasFocus</span><span class="o">)</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">paintComponent</span><span class="o">(</span><span class="n">Graphics</span> <span class="n">g</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">paintComponent</span><span class="o">(</span><span class="n">g</span><span class="o">)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">isTargetCell</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">g</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">black</span><span class="o">)</span>
            <span class="n">g</span><span class="o">.</span><span class="na">drawLine</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">size</span><span class="o">.</span><span class="na">width</span><span class="o">.</span><span class="na">intValue</span><span class="o">(),</span> <span class="mi">0</span><span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">lines</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">This is line 1</span>
<span class="s1">This is line 2</span>
<span class="s1">This is line 3</span>
<span class="s1">This is line 4</span>
<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="na">trim</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s1">&#39;\n&#39;</span><span class="o">)</span>
<span class="kt">def</span> <span class="n">listModel</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultListModel</span><span class="o">()</span>
<span class="n">lines</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">listModel</span><span class="o">.</span><span class="na">addElement</span><span class="o">(</span><span class="n">it</span><span class="o">)</span> <span class="o">}</span>
<span class="n">listModel</span><span class="o">.</span><span class="na">addElement</span><span class="o">(</span><span class="s1">&#39; &#39;</span><span class="o">)</span> <span class="c1">// dummy</span>
<span class="kt">def</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DragDropList</span><span class="o">(</span><span class="n">listModel</span><span class="o">)</span>
<span class="kt">def</span> <span class="n">sp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JScrollPane</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="n">SPC</span><span class="o">.</span><span class="na">VERTICAL_SCROLLBAR_ALWAYS</span><span class="o">,</span> <span class="n">SPC</span><span class="o">.</span><span class="na">HORIZONTAL_SCROLLBAR_NEVER</span><span class="o">)</span>
<span class="kt">def</span> <span class="n">frame</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JFrame</span><span class="o">(</span><span class="s1">&#39;Line Shuffle Example&#39;</span><span class="o">)</span>
<span class="n">frame</span><span class="o">.</span><span class="na">setDefaultCloseOperation</span><span class="o">(</span><span class="n">WindowConstants</span><span class="o">.</span><span class="na">EXIT_ON_CLOSE</span><span class="o">)</span>
<span class="n">frame</span><span class="o">.</span><span class="na">contentPane</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">sp</span><span class="o">)</span>
<span class="n">frame</span><span class="o">.</span><span class="na">pack</span><span class="o">()</span>
<span class="n">frame</span><span class="o">.</span><span class="na">setVisible</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.1</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;program args&quot;</span><span class="o">.</span><span class="na">execute</span><span class="o">().</span><span class="na">text</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.2</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">proc</span> <span class="o">=</span> <span class="s2">&quot;vi myfile&quot;</span><span class="o">.</span><span class="na">execute</span><span class="o">()</span>
<span class="n">proc</span><span class="o">.</span><span class="na">waitFor</span><span class="o">()</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.3</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Calling execute() on a String, String[] or List (of Strings or objects with</span>
<span class="c1">// a toString() method) will fork off another process.</span>
<span class="c1">// This doesn&#39;t replace the existing process but if you simply finish the original</span>
<span class="c1">// process (leaving the spawned process to finish asynchronously) you will achieve</span>
<span class="c1">// a similar thing.</span>
<span class="s2">&quot;archive *.data&quot;</span><span class="o">.</span><span class="na">execute</span><span class="o">()</span>
<span class="o">[</span><span class="s2">&quot;archive&quot;</span><span class="o">,</span> <span class="s2">&quot;accounting.data&quot;</span><span class="o">].</span><span class="na">execute</span><span class="o">()</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.4</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// sending text to the input of another process</span>
<span class="n">proc</span> <span class="o">=</span> <span class="s1">&#39;groovy -e &quot;print System.in.text.toUpperCase()&quot;&#39;</span><span class="o">.</span><span class="na">execute</span><span class="o">()</span>
<span class="n">Thread</span><span class="o">.</span><span class="na">start</span><span class="o">{</span>
    <span class="kt">def</span> <span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="k">new</span> <span class="n">BufferedOutputStream</span><span class="o">(</span><span class="n">proc</span><span class="o">.</span><span class="na">out</span><span class="o">))</span>
    <span class="n">writer</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s1">&#39;Hello&#39;</span><span class="o">)</span>
    <span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="o">}</span>
<span class="n">proc</span><span class="o">.</span><span class="na">waitFor</span><span class="o">()</span>
<span class="c1">// further process output from process</span>
<span class="n">print</span> <span class="n">proc</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">reverse</span><span class="o">()</span>
<span class="c1">// =&gt;</span>
<span class="c1">// OLLEH</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.5</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// filter your own output</span>
<span class="n">keep</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PipedInputStream</span><span class="o">()</span>
<span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">pipe</span><span class="o">))</span>
<span class="n">System</span><span class="o">.</span><span class="na">setOut</span><span class="o">(</span><span class="k">new</span> <span class="n">PrintStream</span><span class="o">(</span><span class="k">new</span> <span class="n">BufferedOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">PipedOutputStream</span><span class="o">(</span><span class="n">pipe</span><span class="o">))))</span>
<span class="kt">int</span> <span class="n">numlines</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">Thread</span><span class="o">.</span><span class="na">start</span><span class="o">{</span>
    <span class="k">while</span><span class="o">((</span><span class="n">next</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">numlines</span><span class="o">--</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="n">keep</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">next</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="o">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">8</span><span class="o">).</span><span class="na">each</span><span class="o">{</span> <span class="n">println</span> <span class="n">it</span> <span class="o">}</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="n">System</span><span class="o">.</span><span class="na">setOut</span><span class="o">(</span><span class="n">keep</span><span class="o">)</span>
<span class="o">(</span><span class="mi">9</span><span class="o">..</span><span class="mi">10</span><span class="o">).</span><span class="na">each</span><span class="o">{</span> <span class="n">println</span> <span class="n">it</span> <span class="o">}</span>
<span class="c1">// =&gt;</span>
<span class="c1">// 1</span>
<span class="c1">// 2</span>
<span class="c1">// 9</span>
<span class="c1">// 10</span>


<span class="c1">// filtering output by adding quotes and numbers</span>
<span class="kd">class</span> <span class="nc">FilterOutput</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span>
    <span class="n">Closure</span> <span class="n">c</span>
    <span class="n">Reader</span> <span class="n">reader</span>
    <span class="n">PrintStream</span> <span class="n">orig</span>
    <span class="nf">FilterOutput</span><span class="o">(</span><span class="n">Closure</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">c</span> <span class="o">=</span> <span class="n">c</span>
        <span class="n">orig</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span>
        <span class="kt">def</span> <span class="n">pipe</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PipedInputStream</span><span class="o">()</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">pipe</span><span class="o">))</span>
        <span class="n">System</span><span class="o">.</span><span class="na">setOut</span><span class="o">(</span><span class="k">new</span> <span class="n">PrintStream</span><span class="o">(</span><span class="k">new</span> <span class="n">BufferedOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">PipedOutputStream</span><span class="o">(</span><span class="n">pipe</span><span class="o">))))</span>
    <span class="o">}</span>
    <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">def</span> <span class="n">next</span>
        <span class="nf">while</span><span class="o">((</span><span class="n">next</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">c</span><span class="o">(</span><span class="n">orig</span><span class="o">,</span> <span class="n">next</span><span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">close</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">sleep</span> <span class="mi">100</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
        <span class="n">System</span><span class="o">.</span><span class="na">setOut</span><span class="o">(</span><span class="n">orig</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">number</span> <span class="o">=</span> <span class="o">{</span> <span class="n">s</span><span class="o">,</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">cnt</span><span class="o">++;</span> <span class="n">s</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cnt</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">n</span><span class="o">)</span> <span class="o">}</span>
<span class="n">quote</span> <span class="o">=</span>  <span class="o">{</span> <span class="n">s</span><span class="o">,</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">s</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s1">&#39;&gt; &#39;</span> <span class="o">+</span> <span class="n">n</span><span class="o">)</span> <span class="o">}</span>
<span class="n">f1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FilterOutput</span><span class="o">(</span><span class="n">number</span><span class="o">);</span> <span class="n">f1</span><span class="o">.</span><span class="na">start</span><span class="o">()</span>
<span class="n">f2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FilterOutput</span><span class="o">(</span><span class="n">quote</span><span class="o">);</span> <span class="n">f2</span><span class="o">.</span><span class="na">start</span><span class="o">()</span>
<span class="o">(</span><span class="s1">&#39;a&#39;</span><span class="o">..</span><span class="s1">&#39;e&#39;</span><span class="o">).</span><span class="na">each</span><span class="o">{</span> <span class="n">println</span> <span class="n">it</span> <span class="o">}</span>
<span class="n">f2</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="n">f1</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.6</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy programs (like Java ones) would use streams here. Just process</span>
<span class="c1">// another stream instead of System.in or System.out:</span>

<span class="c1">// process url text</span>
<span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">address</span><span class="o">).</span><span class="na">openStream</span><span class="o">()</span>
<span class="c1">// ... process &#39;input&#39; stream</span>

<span class="c1">// process compressed file</span>
<span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GZIPInputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s1">&#39;source.gzip&#39;</span><span class="o">))</span>
<span class="c1">// ... process &#39;input&#39; stream</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.7</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// To read STDERR of a process you execute</span>
<span class="n">proc</span> <span class="o">=</span> <span class="s1">&#39;groovy -e &quot;println args[0]&quot;&#39;</span><span class="o">.</span><span class="na">execute</span><span class="o">()</span>
<span class="n">proc</span><span class="o">.</span><span class="na">waitFor</span><span class="o">()</span>
<span class="n">println</span> <span class="n">proc</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">text</span>
<span class="c1">// =&gt; Caught: java.lang.ArrayIndexOutOfBoundsException: 0 ...</span>

<span class="c1">// To redirect your STDERR to a file</span>
<span class="n">System</span><span class="o">.</span><span class="na">setErr</span><span class="o">(</span><span class="k">new</span> <span class="n">PrintStream</span><span class="o">(</span><span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="s2">&quot;error.txt&quot;</span><span class="o">)))</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.8</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// See 16.2, the technique allows both STDIN and STDOUT of another program to be</span>
<span class="c1">// changed at the same time, not just one or the other as per Perl 16.2 solution</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.9</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// See 16.2 and 16.7, the techniques can be combined to allow all three streams</span>
<span class="c1">// (STDIN, STDOUT, STDERR) to be altered as required.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.10</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy can piggy-back on the many options available to Java here:</span>
<span class="c1">// JIPC provides a wide set of standard primitives: semaphore, event,</span>
<span class="c1">//   FIFO queue, barrier, shared memory, shared and exclusive locks:</span>
<span class="c1">//   http://www.garret.ru/~knizhnik/jipc/jipc.html</span>
<span class="c1">// sockets allow process to communicate via low-level packets</span>
<span class="c1">// CORBA, RMI, SOAP allow process to communicate via RPC calls</span>
<span class="c1">// shared files can also be used</span>
<span class="c1">// JMS allows process to communicate via a messaging service</span>

<span class="c1">// Simplist approach is to just link streams:</span>
<span class="n">proc1</span> <span class="o">=</span> <span class="s1">&#39;groovy -e &quot;println args[0]&quot; Hello&#39;</span><span class="o">.</span><span class="na">execute</span><span class="o">()</span>
<span class="n">proc2</span> <span class="o">=</span> <span class="s1">&#39;groovy -e &quot;print System.in.text.toUpperCase()&quot;&#39;</span><span class="o">.</span><span class="na">execute</span><span class="o">()</span>
<span class="n">Thread</span><span class="o">.</span><span class="na">start</span><span class="o">{</span>
    <span class="kt">def</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">proc1</span><span class="o">.</span><span class="na">in</span><span class="o">))</span>
    <span class="kt">def</span> <span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="k">new</span> <span class="n">BufferedOutputStream</span><span class="o">(</span><span class="n">proc2</span><span class="o">.</span><span class="na">out</span><span class="o">))</span>
    <span class="k">while</span> <span class="o">((</span><span class="n">next</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">writer</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">next</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="o">}</span>
<span class="n">proc2</span><span class="o">.</span><span class="na">waitFor</span><span class="o">()</span>
<span class="n">print</span> <span class="n">proc2</span><span class="o">.</span><span class="na">text</span>
<span class="c1">// =&gt; HELLO</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.11</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Java/Groovy would normally just use some socket-based technique for communicating</span>
<span class="c1">// between processes (see 16.10 for a list of options). If you really must use a named</span>
<span class="c1">// pipe, you have these options:</span>
<span class="c1">// (1) On *nix machines:</span>
<span class="c1">// * Create a named pipe by invoking the mkfifo utility using execute().</span>
<span class="c1">// * Open a named pipe by name - which is just like opening a file.</span>
<span class="c1">// * Run an external process setting its input and output streams (see 16.1, 16.4, 16.5)</span>
<span class="c1">// (2) On Windows machines, Using JCIFS to Connect to Win32 Named Pipes, see:</span>
<span class="c1">// http://jcifs.samba.org/src/docs/pipes.html</span>
<span class="c1">// Neither of these achieve exactly the same result as the Perl example but some</span>
<span class="c1">// scenarios will be almost identical.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.12</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// The comments made in 16.10 regarding other alternative IPC mechanisms also apply here.</span>

<span class="c1">// This example would normally be done with multiple threads in Java/Groovy as follows.</span>
<span class="kd">class</span> <span class="nc">Shared</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">buffer</span> <span class="o">=</span> <span class="s2">&quot;not set yet&quot;</span>
    <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">leftShift</span><span class="o">(</span><span class="n">value</span><span class="o">){</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">notifyAll</span><span class="o">()</span>
    <span class="o">}</span>
    <span class="kd">synchronized</span> <span class="n">Object</span> <span class="nf">read</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">buffer</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">shared</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Shared</span><span class="o">()</span>
<span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">()</span>
<span class="n">threads</span> <span class="o">=</span> <span class="o">[]</span>
<span class="o">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="o">).</span><span class="na">each</span><span class="o">{</span>
    <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(){</span>
        <span class="kt">def</span> <span class="n">me</span> <span class="o">=</span> <span class="n">t</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">j</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="mi">9</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">shared</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;$me.name $j&quot;</span>
            <span class="n">sleep</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">()</span>
<span class="o">}</span>
<span class="k">while</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">println</span> <span class="n">shared</span><span class="o">.</span><span class="na">read</span><span class="o">()</span>
    <span class="n">sleep</span> <span class="mi">50</span>
<span class="o">}</span>
<span class="c1">// =&gt;</span>
<span class="c1">// not set yet</span>
<span class="c1">// Thread-2 0</span>
<span class="c1">// Thread-5 1</span>
<span class="c1">// Thread-1 1</span>
<span class="c1">// Thread-4 2</span>
<span class="c1">// Thread-3 1</span>
<span class="c1">// ...</span>
<span class="c1">// Thread-5 9</span>


<span class="c1">// Using JIPC between processes (as a less Groovy alternative that is closer</span>
<span class="c1">// to the original cookbook) is shown below.</span>

<span class="c1">// ipcWriterScript:</span>
<span class="kn">import</span> <span class="nn">org.garret.jipc.client.JIPCClientFactory</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">6000</span>
<span class="n">factory</span> <span class="o">=</span> <span class="n">JIPCClientFactory</span><span class="o">.</span><span class="na">instance</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s1">&#39;localhost&#39;</span><span class="o">,</span> <span class="n">port</span><span class="o">)</span>
<span class="n">mutex</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createMutex</span><span class="o">(</span><span class="s2">&quot;myMutex&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span>
<span class="n">buffer</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createSharedMemory</span><span class="o">(</span><span class="s2">&quot;myBuffer&quot;</span><span class="o">,</span> <span class="s2">&quot;not yet set&quot;</span><span class="o">)</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
<span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">()</span>
<span class="o">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">99</span><span class="o">).</span><span class="na">each</span> <span class="o">{</span>
    <span class="n">mutex</span><span class="o">.</span><span class="na">lock</span><span class="o">()</span>
    <span class="n">buffer</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s2">&quot;$name $it&quot;</span><span class="o">.</span><span class="na">toString</span><span class="o">())</span>
    <span class="n">mutex</span><span class="o">.</span><span class="na">unlock</span><span class="o">()</span>
    <span class="n">sleep</span> <span class="mi">200</span> <span class="o">+</span> <span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">500</span><span class="o">)</span>
<span class="o">}</span>
<span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>

<span class="c1">// ipcReaderScript:</span>
<span class="kn">import</span> <span class="nn">org.garret.jipc.client.JIPCClientFactory</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">6000</span>
<span class="n">factory</span> <span class="o">=</span> <span class="n">JIPCClientFactory</span><span class="o">.</span><span class="na">instance</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s1">&#39;localhost&#39;</span><span class="o">,</span> <span class="n">port</span><span class="o">)</span>
<span class="n">mutex</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createMutex</span><span class="o">(</span><span class="s2">&quot;myMutex&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span>
<span class="n">buffer</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createSharedMemory</span><span class="o">(</span><span class="s2">&quot;myBuffer&quot;</span><span class="o">,</span> <span class="s2">&quot;not yet set&quot;</span><span class="o">)</span>
<span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">()</span>
<span class="o">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">299</span><span class="o">).</span><span class="na">each</span> <span class="o">{</span>
    <span class="n">mutex</span><span class="o">.</span><span class="na">lock</span><span class="o">()</span>
    <span class="n">println</span> <span class="n">buffer</span><span class="o">.</span><span class="na">get</span><span class="o">()</span>
    <span class="n">mutex</span><span class="o">.</span><span class="na">unlock</span><span class="o">()</span>
    <span class="n">sleep</span> <span class="mi">150</span>
<span class="o">}</span>
<span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>

<span class="c1">// kick off processes:</span>
<span class="s2">&quot;java org.garret.jipc.server.JIPCServer 6000&quot;</span><span class="o">.</span><span class="na">execute</span><span class="o">()</span>
<span class="s2">&quot;groovy ipcReaderScript&quot;</span><span class="o">.</span><span class="na">execute</span><span class="o">()</span>
<span class="o">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">3</span><span class="o">).</span><span class="na">each</span><span class="o">{</span> <span class="s2">&quot;groovy ipcWriterScript $it&quot;</span><span class="o">.</span><span class="na">execute</span><span class="o">()</span> <span class="o">}</span>

<span class="c1">// =&gt;</span>
<span class="c1">// ...</span>
<span class="c1">// 0 10</span>
<span class="c1">// 2 10</span>
<span class="c1">// 2 11</span>
<span class="c1">// 1 9</span>
<span class="c1">// 1 9</span>
<span class="c1">// 1 10</span>
<span class="c1">// 2 12</span>
<span class="c1">// 3 12</span>
<span class="c1">// 3 12</span>
<span class="c1">// 2 13</span>
<span class="c1">// ...</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.13</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Signal handling in Groovy (like Java) is operating system and JVM dependent.</span>
<span class="c1">// The ISO C standard only requires the signal names SIGABRT, SIGFPE, SIGILL,</span>
<span class="c1">// SIGINT, SIGSEGV, and SIGTERM to be defined but depending on your platform</span>
<span class="c1">// other signals may be present, e.g. Windows supports SIGBREAK. For more info</span>
<span class="c1">// see: http://www-128.ibm.com/developerworks/java/library/i-signalhandling/</span>
<span class="c1">// Note: if you start up the JVM with -Xrs the JVM will try to reduce its</span>
<span class="c1">// internal usage of signals. Also the JVM takes over meany hooks and provides</span>
<span class="c1">// platform independent alternatives, e.g. see java.lang.Runtime#addShutdownHook()</span>

<span class="c1">// To see what signals are available for your system (excludes ones taken over</span>
<span class="c1">// by the JVM):</span>
<span class="n">sigs</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;HUP INT QUIT ILL TRAP ABRT EMT FPE KILL BUS SEGV SYS PIPE ALRM TERM</span>
<span class="s1">USR1 USR2 CHLD PWR WINCH URG POLL STOP TSTP CONT TTIN TTOU VTALRM PROF XCPU</span>
<span class="s1">XFSZ WAITING LWP AIO IO INFO THR BREAK FREEZE THAW CANCEL EMT</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">sigs</span><span class="o">.</span><span class="na">tokenize</span><span class="o">(</span><span class="s1">&#39; \n&#39;</span><span class="o">).</span><span class="na">each</span><span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">print</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="k">new</span> <span class="n">sun</span><span class="o">.</span><span class="na">misc</span><span class="o">.</span><span class="na">Signal</span><span class="o">(</span><span class="n">it</span><span class="o">)</span>
    <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">IllegalArgumentException</span> <span class="n">iae</span><span class="o">)</span> <span class="o">{}</span>
<span class="o">}</span>
<span class="c1">// =&gt;  on Windows XP:</span>
<span class="c1">// SIGINT SIGILL SIGABRT SIGFPE SIGSEGV SIGTERM SIGBREAK</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.14</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// To send a signal to your process:</span>
<span class="n">Signal</span><span class="o">.</span><span class="na">raise</span><span class="o">(</span><span class="k">new</span> <span class="n">Signal</span><span class="o">(</span><span class="s2">&quot;INT&quot;</span><span class="o">))</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.15</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// install a signal handler</span>
<span class="kd">class</span> <span class="nc">DiagSignalHandler</span> <span class="kd">implements</span> <span class="n">SignalHandler</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="n">diagHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DiagSignalHandler</span><span class="o">()</span>
<span class="n">Signal</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="k">new</span> <span class="n">Signal</span><span class="o">(</span><span class="s2">&quot;INT&quot;</span><span class="o">),</span> <span class="n">diagHandler</span><span class="o">)</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.16</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// temporarily install a signal handler</span>
<span class="kd">class</span> <span class="nc">DiagSignalHandler</span> <span class="kd">implements</span> <span class="n">SignalHandler</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="n">diagHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DiagSignalHandler</span><span class="o">()</span>
<span class="n">oldHandler</span> <span class="o">=</span> <span class="n">Signal</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="k">new</span> <span class="n">Signal</span><span class="o">(</span><span class="s2">&quot;INT&quot;</span><span class="o">),</span> <span class="n">diagHandler</span><span class="o">)</span>
<span class="n">Signal</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="k">new</span> <span class="n">Signal</span><span class="o">(</span><span class="s2">&quot;INT&quot;</span><span class="o">),</span> <span class="n">oldHandler</span><span class="o">)</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.17</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="kn">import</span> <span class="nn">sun.misc.Signal</span>
<span class="kn">import</span> <span class="nn">sun.misc.SignalHandler</span>

<span class="kd">class</span> <span class="nc">DiagSignalHandler</span> <span class="kd">implements</span> <span class="n">SignalHandler</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">oldHandler</span>

    <span class="c1">// Static method to install the signal handler</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nf">install</span><span class="o">(</span><span class="n">signal</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">def</span> <span class="n">diagHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DiagSignalHandler</span><span class="o">()</span>
        <span class="n">diagHandler</span><span class="o">.</span><span class="na">oldHandler</span> <span class="o">=</span> <span class="n">Signal</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">signal</span><span class="o">,</span> <span class="n">diagHandler</span><span class="o">)</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Signal</span> <span class="n">sig</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">println</span><span class="o">(</span><span class="s2">&quot;Diagnostic Signal handler called for signal &quot;</span><span class="o">+</span><span class="n">sig</span><span class="o">)</span>
        <span class="c1">// Output information for each thread</span>
        <span class="kt">def</span> <span class="n">list</span> <span class="o">=</span> <span class="o">[]</span>
        <span class="n">Thread</span><span class="o">.</span><span class="na">activeCount</span><span class="o">().</span><span class="na">each</span><span class="o">{</span> <span class="n">list</span> <span class="o">+=</span> <span class="kc">null</span> <span class="o">}</span>
        <span class="n">Thread</span><span class="o">[]</span> <span class="n">threadArray</span> <span class="o">=</span> <span class="n">list</span> <span class="k">as</span> <span class="n">Thread</span><span class="o">[]</span>
        <span class="kt">int</span> <span class="n">numThreads</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">enumerate</span><span class="o">(</span><span class="n">threadArray</span><span class="o">)</span>
        <span class="n">println</span><span class="o">(</span><span class="s2">&quot;Current threads:&quot;</span><span class="o">)</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..&lt;</span><span class="n">numThreads</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">println</span><span class="o">(</span><span class="s2">&quot;    &quot;</span><span class="o">+</span><span class="n">threadArray</span><span class="o">[</span><span class="n">i</span><span class="o">])</span>
        <span class="o">}</span>

        <span class="c1">// Chain back to previous handler, if one exists</span>
        <span class="k">if</span> <span class="o">(</span> <span class="n">oldHandler</span> <span class="o">!=</span> <span class="n">SIG_DFL</span> <span class="o">&amp;&amp;</span> <span class="n">oldHandler</span> <span class="o">!=</span> <span class="n">SIG_IGN</span> <span class="o">)</span> <span class="o">{</span>
            <span class="n">oldHandler</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">sig</span><span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// install using:</span>
<span class="n">DiagSignalHandler</span><span class="o">.</span><span class="na">install</span><span class="o">(</span><span class="k">new</span> <span class="n">Signal</span><span class="o">(</span><span class="s2">&quot;INT&quot;</span><span class="o">))</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.18</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// See 16.17, just don&#39;t chain to the previous handler because the default handler</span>
<span class="c1">// will abort the process.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.19</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy relies on Java features here. Java doesn&#39;t keep the process around</span>
<span class="c1">// as it stores metadata in a Process object. You can call waitFor() or destroy()</span>
<span class="c1">// or exitValue() on the Process object. If the Process object is garbage collected,</span>
<span class="c1">// the process can still execute asynchronously with respect to the original process.</span>

<span class="c1">// For ensuring processes don&#39;t die, see:</span>
<span class="c1">// http://jakarta.apache.org/commons/daemon/</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.20</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// There is no equivalent to a signal mask available directly in Groovy or Java.</span>
<span class="c1">// You can override and ignore individual signals using recipes 16.16 - 16.18.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.21</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Timer</span><span class="o">()</span>
<span class="n">t</span><span class="o">.</span><span class="na">runAfter</span><span class="o">(</span><span class="mi">3500</span><span class="o">){</span>
    <span class="n">println</span> <span class="s1">&#39;Took too long&#39;</span>
    <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
<span class="o">}</span>
<span class="kt">def</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="mi">6</span><span class="o">.</span><span class="na">times</span><span class="o">{</span>
    <span class="n">count</span><span class="o">++</span>
    <span class="n">sleep</span> <span class="mi">1000</span>
    <span class="n">println</span> <span class="s2">&quot;Count = $count&quot;</span>
<span class="o">}</span>
<span class="n">t</span><span class="o">.</span><span class="na">cancel</span><span class="o">()</span>
<span class="c1">// See also special JMX timer class: javax.management.timer.Timer</span>
<span class="c1">// For an external process you can also use: proc.waitForOrKill(3500)</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_16.22</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// One way to implement this functionality is to automatically replace the ~/.plan</span>
<span class="c1">// etc. files every fixed timed interval - though this wouldn&#39;t be efficient.</span>
<span class="c1">// Here is a simplified version which is a simplified version compared to the</span>
<span class="c1">// original cookbook. It only looks at the ~/.signature file and changes it</span>
<span class="c1">// freely. It also doesn&#39;t consider other news reader related files.</span>

<span class="kt">def</span> <span class="n">sigs</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Make is like Pascal: everybody likes it, so they go in and change it.</span>
<span class="s1">--Dennis Ritchie</span>
<span class="s1">%%</span>
<span class="s1">I eschew embedded capital letters in names; to my prose-oriented eyes,</span>
<span class="s1">they are too awkward to read comfortably. They jangle like bad typography.</span>
<span class="s1">--Rob Pike</span>
<span class="s1">%%</span>
<span class="s1">God made the integers; all else is the work of Man.</span>
<span class="s1">--Kronecker</span>
<span class="s1">%%</span>
<span class="s1">I d rather have :rofix than const. --Dennis Ritchie</span>
<span class="s1">%%</span>
<span class="s1">If you want to program in C, program in C. It s a nice language.</span>
<span class="s1">I use it occasionally... :-) --Larry Wall</span>
<span class="s1">%%</span>
<span class="s1">Twisted cleverness is my only skill as a programmer.</span>
<span class="s1">--Elizabeth Zwicky</span>
<span class="s1">%%</span>
<span class="s1">Basically, avoid comments. If your code needs a comment to be understood,</span>
<span class="s1">it would be better to rewrite it so it s easier to understand.</span>
<span class="s1">--Rob Pike</span>
<span class="s1">%%</span>
<span class="s1">Comments on data are usually much more helpful than on algorithms.</span>
<span class="s1">--Rob Pike</span>
<span class="s1">%%</span>
<span class="s1">Programs that write programs are the happiest programs in the world.</span>
<span class="s1">--Andrew Hume</span>
<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="na">trim</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">/\n%%\n/</span><span class="o">)</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;me@somewhere.org\n&#39;</span>
<span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s1">&#39;user.home&#39;</span><span class="o">)</span> <span class="o">+</span> <span class="n">File</span><span class="o">.</span><span class="na">separator</span> <span class="o">+</span> <span class="s1">&#39;.signature&#39;</span><span class="o">)</span>
<span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">()</span>
<span class="k">while</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">file</span><span class="o">.</span><span class="na">delete</span><span class="o">()</span>
    <span class="n">file</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">+</span> <span class="n">sigs</span><span class="o">[</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">sigs</span><span class="o">.</span><span class="na">size</span><span class="o">())]</span>
    <span class="n">sleep</span> <span class="mi">10000</span>
<span class="o">}</span>

<span class="c1">// Another way to implement this functionality (in a completely different way to the</span>
<span class="c1">// original cookbook) is to use a FileWatcher class, e.g.</span>
<span class="c1">// http://www.rgagnon.com/javadetails/java-0490.html (FileWatcher and DirWatcher)</span>
<span class="c1">// http://www.jconfig.org/javadoc/org/jconfig/FileWatcher.html</span>

<span class="c1">// These file watchers notify us whenever the file is modified, see Pleac chapter 7</span>
<span class="c1">// for workarounds to not being able to get last accessed time vs last modified time.</span>
<span class="c1">// (We would now need to touch the file whenever we accessed it to make it change).</span>
<span class="c1">// Our handler called from the watchdog class would update the file contents.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_17.0</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">myClient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Socket</span><span class="o">(</span><span class="s2">&quot;Machine name&quot;</span><span class="o">,</span> <span class="n">portNumber</span><span class="o">)</span>
<span class="n">myAddress</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="na">inetAddress</span>
<span class="n">myAddress</span><span class="o">.</span><span class="na">hostAddress</span>  <span class="c1">// string representation of host address</span>
<span class="n">myAddress</span><span class="o">.</span><span class="na">hostName</span>     <span class="c1">// host name</span>
<span class="n">myAddress</span><span class="o">.</span><span class="na">address</span>      <span class="c1">// IP address as array of bytes</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_17.1</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Socket</span><span class="o">(</span><span class="s2">&quot;localhost&quot;</span><span class="o">,</span> <span class="mi">5000</span><span class="o">);</span>
<span class="n">s</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Why don&#39;t you call me anymore?\n&quot;</span>
<span class="n">s</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_17.2</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// commandline socket server echoing input back to originator</span>
<span class="n">groovy</span> <span class="o">-</span><span class="n">l</span> <span class="mi">5000</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;println line&quot;</span>

<span class="c1">// commandline socket server eching input to stderr</span>
<span class="n">groovy</span> <span class="o">-</span><span class="n">l</span> <span class="mi">5000</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;System.err.println line&quot;</span>

<span class="c1">// a web server as a script (extension to cookbook)</span>
 <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="mi">5000</span><span class="o">)</span>
 <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
     <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">()</span> <span class="o">{</span> <span class="n">socket</span> <span class="o">-&gt;</span>
         <span class="n">socket</span><span class="o">.</span><span class="na">withStreams</span> <span class="o">{</span> <span class="n">input</span><span class="o">,</span> <span class="n">output</span> <span class="o">-&gt;</span>
             <span class="c1">// ignore input and just serve dummy content</span>
             <span class="n">output</span><span class="o">.</span><span class="na">withWriter</span> <span class="o">{</span> <span class="n">writer</span> <span class="o">-&gt;</span>
                 <span class="n">writer</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;HTTP/1.1 200 OK\n&quot;</span>
                 <span class="n">writer</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Content-Type: text/html\n\n&quot;</span>
                 <span class="n">writer</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;&lt;html&gt;&lt;body&gt;Hello World! It&#39;s ${new Date()}&lt;/body&gt;&lt;/html&gt;\n&quot;</span>
             <span class="o">}</span>
         <span class="o">}</span>
     <span class="o">}</span>
 <span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_17.3</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="mi">5000</span><span class="o">)</span>
<span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">()</span> <span class="o">{</span> <span class="n">socket</span> <span class="o">-&gt;</span>
        <span class="n">socket</span><span class="o">.</span><span class="na">withStreams</span> <span class="o">{</span> <span class="n">input</span><span class="o">,</span> <span class="n">output</span> <span class="o">-&gt;</span>
            <span class="n">w</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">output</span><span class="o">)</span>
            <span class="n">w</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;What is your name? &quot;</span>
            <span class="n">w</span><span class="o">.</span><span class="na">flush</span><span class="o">()</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">readLine</span><span class="o">()</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span> <span class="s2">&quot;User responded with $r&quot;</span>
            <span class="n">w</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_17.4</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// UDP client</span>
<span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;Message&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s2">&quot;ASCII&quot;</span><span class="o">)</span>
<span class="n">addr</span> <span class="o">=</span> <span class="n">InetAddress</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="s2">&quot;localhost&quot;</span><span class="o">)</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">packet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramPacket</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">data</span><span class="o">.</span><span class="na">length</span><span class="o">,</span> <span class="n">addr</span><span class="o">,</span> <span class="n">port</span><span class="o">)</span>
<span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramSocket</span><span class="o">()</span>
<span class="n">socket</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">packet</span><span class="o">)</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_17.5</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// UDP server</span>
<span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramSocket</span><span class="o">(</span><span class="mi">5000</span><span class="o">)</span>
<span class="n">buffer</span> <span class="o">=</span> <span class="o">(</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">4096</span><span class="o">)</span> <span class="k">as</span> <span class="kt">byte</span><span class="o">[]</span>
<span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">incoming</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramPacket</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="n">buffer</span><span class="o">.</span><span class="na">length</span><span class="o">)</span>
    <span class="n">socket</span><span class="o">.</span><span class="na">receive</span><span class="o">(</span><span class="n">incoming</span><span class="o">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">incoming</span><span class="o">.</span><span class="na">data</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">incoming</span><span class="o">.</span><span class="na">length</span><span class="o">)</span>
    <span class="n">String</span> <span class="n">reply</span> <span class="o">=</span> <span class="s2">&quot;Client said: &#39;$s&#39;&quot;</span>
    <span class="n">outgoing</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramPacket</span><span class="o">(</span><span class="n">reply</span><span class="o">.</span><span class="na">bytes</span><span class="o">,</span> <span class="n">reply</span><span class="o">.</span><span class="na">size</span><span class="o">(),</span>
            <span class="n">incoming</span><span class="o">.</span><span class="na">address</span><span class="o">,</span> <span class="n">incoming</span><span class="o">.</span><span class="na">port</span><span class="o">);</span>
    <span class="n">socket</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">outgoing</span><span class="o">)</span>
<span class="o">}</span>

<span class="c1">// UDP client</span>
<span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;Original Message&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s2">&quot;ASCII&quot;</span><span class="o">)</span>
<span class="n">addr</span> <span class="o">=</span> <span class="n">InetAddress</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="s2">&quot;localhost&quot;</span><span class="o">)</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">packet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramPacket</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">data</span><span class="o">.</span><span class="na">length</span><span class="o">,</span> <span class="n">addr</span><span class="o">,</span> <span class="n">port</span><span class="o">)</span>
<span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramSocket</span><span class="o">()</span>
<span class="n">socket</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">packet</span><span class="o">)</span>
<span class="n">socket</span><span class="o">.</span><span class="na">setSoTimeout</span><span class="o">(</span><span class="mi">30000</span><span class="o">)</span> <span class="c1">// block for no more than 30 seconds</span>
<span class="n">buffer</span> <span class="o">=</span> <span class="o">(</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">4096</span><span class="o">)</span> <span class="k">as</span> <span class="kt">byte</span><span class="o">[]</span>
<span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramPacket</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="n">buffer</span><span class="o">.</span><span class="na">length</span><span class="o">)</span>
<span class="n">socket</span><span class="o">.</span><span class="na">receive</span><span class="o">(</span><span class="n">response</span><span class="o">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">response</span><span class="o">.</span><span class="na">length</span><span class="o">)</span>
<span class="n">println</span> <span class="s2">&quot;Server said: &#39;$s&#39;&quot;</span>
<span class="c1">// =&gt; Server said: &#39;Client said: &#39;Original Message&#39;&#39;</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_17.6</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// DOMAIN sockets not available in cross platform form.</span>
<span class="c1">// On Linux, use jbuds:</span>
<span class="c1">// http://www.graphixprose.com/jbuds/</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_17.7</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// TCP socket</span>
<span class="n">socketAddress</span> <span class="o">=</span> <span class="n">tcpSocket</span><span class="o">.</span><span class="na">remoteSocketAddress</span>
<span class="n">println</span> <span class="s2">&quot;$socketAddress.address, $socketAddress.hostName, $socketAddress.port&quot;</span>
<span class="c1">// UDP packet</span>
<span class="n">println</span> <span class="s2">&quot;$udpPacket.address, $udpPacket.port&quot;</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_17.8</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Print the fully qualified domain name for this IP address</span>
<span class="n">println</span> <span class="n">InetAddress</span><span class="o">.</span><span class="na">localHost</span><span class="o">.</span><span class="na">canonicalHostName</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_17.9</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">socket</span><span class="o">.</span><span class="na">shutdownInput</span><span class="o">()</span>
<span class="n">socket</span><span class="o">.</span><span class="na">shutdownOutput</span><span class="o">()</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_17.10</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Spawn off a thread to handle each direction</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_17.11</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Spawn off a thread to handle each request.</span>
<span class="c1">// This is done automatically by the Groovy accept() method on ServerSocket.</span>
<span class="c1">// See 17.3 for an example.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_17.12</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Use a thread pool</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_17.13</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Consider using Selector and/or SocketChannel, ServerSocketChannel and DatagramChannel</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_17.14</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// When creating a socket on a multihomed machine, use the socket constructor with</span>
<span class="c1">// 4 params to select a specific address from those available:</span>
<span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Socket</span><span class="o">(</span><span class="n">remoteAddr</span><span class="o">,</span> <span class="n">remotePort</span><span class="o">,</span> <span class="n">localAddr</span><span class="o">,</span> <span class="n">localPort</span><span class="o">)</span>

<span class="c1">// When creating a server on a multihomed machine supply the optional bindAddr param:</span>
<span class="k">new</span> <span class="nf">ServerSocket</span><span class="o">(</span><span class="n">port</span><span class="o">,</span> <span class="n">queueLength</span><span class="o">,</span> <span class="n">bindAddr</span><span class="o">)</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_17.15</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Fork off a thread for your server and call setDaemon(true) on the thread.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_17.16</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Consider using special packages designed to provide robust startup/shutdown</span>
<span class="c1">// capability, e.g.: http://jakarta.apache.org/commons/daemon/</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_17.17</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Alternative to cookbook as proposed inetd solution is not cross platform.</span>
<span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
<span class="k">for</span> <span class="o">(</span><span class="n">port</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">1024</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Socket</span><span class="o">(</span><span class="n">host</span><span class="o">,</span> <span class="n">port</span><span class="o">)</span>
        <span class="n">println</span><span class="o">(</span><span class="s2">&quot;There is a server on port $port of $host&quot;</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{}</span>
<span class="o">}</span>
<span class="c1">// You could open a ServerSocket() on each unused port and monitor those.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_17.18</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// It&#39;s not too hard to write a TCP Proxy in Groovy but numerous Java packages</span>
<span class="c1">// already exist, so we might as well use one of those:</span>
<span class="c1">// http://ws.apache.org/axis/java/user-guide.html#AppendixUsingTheAxisTCPMonitorTcpmon</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_18.1</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;www.perl.com&#39;</span>
<span class="n">addresses</span> <span class="o">=</span> <span class="n">InetAddress</span><span class="o">.</span><span class="na">getAllByName</span><span class="o">(</span><span class="n">name</span><span class="o">)</span>
<span class="n">println</span> <span class="n">addresses</span> <span class="c1">// =&gt; {www.perl.com/208.201.239.36, www.perl.com/208.201.239.37}</span>
<span class="c1">// or to just resolve one:</span>
<span class="n">println</span> <span class="n">InetAddress</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="c1">// =&gt; www.perl.com/208.201.239.36</span>
<span class="c1">// try a different address</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;groovy.codehaus.org&#39;</span>
<span class="n">addresses</span> <span class="o">=</span> <span class="n">InetAddress</span><span class="o">.</span><span class="na">getAllByName</span><span class="o">(</span><span class="n">name</span><span class="o">)</span>
<span class="n">println</span> <span class="n">addresses</span> <span class="c1">// =&gt; {groovy.codehaus.org/63.246.7.187}</span>
<span class="c1">// starting with IP address</span>
<span class="n">address</span> <span class="o">=</span> <span class="n">InetAddress</span><span class="o">.</span><span class="na">getByAddress</span><span class="o">([</span><span class="mi">208</span><span class="o">,</span> <span class="mi">201</span><span class="o">,</span> <span class="mi">239</span><span class="o">,</span> <span class="mi">36</span><span class="o">]</span> <span class="k">as</span> <span class="kt">byte</span><span class="o">[])</span>
<span class="n">println</span> <span class="n">address</span><span class="o">.</span><span class="na">hostName</span> <span class="c1">// =&gt; www.oreillynet.com</span>

<span class="c1">// For more complex operations use dnsjava: http://www.dnsjava.org/</span>
<span class="kn">import</span> <span class="nn">org.xbill.DNS.*</span>
<span class="n">System</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s2">&quot;sun.net.spi.nameservice.provider.1&quot;</span><span class="o">,</span><span class="s2">&quot;dns,dnsjava&quot;</span><span class="o">)</span>
<span class="n">Lookup</span> <span class="n">lookup</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Lookup</span><span class="o">(</span><span class="s1">&#39;cnn.com&#39;</span><span class="o">,</span> <span class="n">Type</span><span class="o">.</span><span class="na">ANY</span><span class="o">)</span>
<span class="n">records</span> <span class="o">=</span> <span class="n">lookup</span><span class="o">.</span><span class="na">run</span><span class="o">()</span>
<span class="n">println</span> <span class="s2">&quot;${records?.size()} record(s) found&quot;</span>
<span class="n">records</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">println</span> <span class="n">it</span> <span class="o">}</span>
<span class="c1">// =&gt;</span>
<span class="c1">// 17 record(s) found</span>
<span class="c1">// cnn.com.     55  IN  A   64.236.16.20</span>
<span class="c1">// cnn.com.     55  IN  A   64.236.16.52</span>
<span class="c1">// cnn.com.     55  IN  A   64.236.16.84</span>
<span class="c1">// cnn.com.     55  IN  A   64.236.16.116</span>
<span class="c1">// cnn.com.     55  IN  A   64.236.24.12</span>
<span class="c1">// cnn.com.     55  IN  A   64.236.24.20</span>
<span class="c1">// cnn.com.     55  IN  A   64.236.24.28</span>
<span class="c1">// cnn.com.     55  IN  A   64.236.29.120</span>
<span class="c1">// cnn.com.     324 IN  NS  twdns-02.ns.aol.com.</span>
<span class="c1">// cnn.com.     324 IN  NS  twdns-03.ns.aol.com.</span>
<span class="c1">// cnn.com.     324 IN  NS  twdns-04.ns.aol.com.</span>
<span class="c1">// cnn.com.     324 IN  NS  twdns-01.ns.aol.com.</span>
<span class="c1">// cnn.com.     3324    IN  SOA twdns-01.ns.aol.com. hostmaster.tbsnames.turner.com. 2007011203 900 300 604801 900</span>
<span class="c1">// cnn.com.     3324    IN  MX  10 atlmail3.turner.com.</span>
<span class="c1">// cnn.com.     3324    IN  MX  10 atlmail5.turner.com.</span>
<span class="c1">// cnn.com.     3324    IN  MX  20 nycmail2.turner.com.</span>
<span class="c1">// cnn.com.     3324    IN  MX  30 nycmail1.turner.com.</span>

<span class="c1">// faster reverse lookup using dnsjava</span>
<span class="kt">def</span> <span class="nf">reverseDns</span><span class="o">(</span><span class="n">hostIp</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">ReverseMap</span><span class="o">.</span><span class="na">fromAddress</span><span class="o">(</span><span class="n">hostIp</span><span class="o">)</span>
    <span class="n">rec</span> <span class="o">=</span> <span class="n">Record</span><span class="o">.</span><span class="na">newRecord</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">Type</span><span class="o">.</span><span class="na">PTR</span><span class="o">,</span> <span class="n">DClass</span><span class="o">.</span><span class="na">IN</span><span class="o">)</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">Message</span><span class="o">.</span><span class="na">newQuery</span><span class="o">(</span><span class="n">rec</span><span class="o">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ExtendedResolver</span><span class="o">().</span><span class="na">send</span><span class="o">(</span><span class="n">query</span><span class="o">)</span>
    <span class="n">answers</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getSectionArray</span><span class="o">(</span><span class="n">Section</span><span class="o">.</span><span class="na">ANSWER</span><span class="o">)</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">answers</span><span class="o">)</span> <span class="k">return</span> <span class="n">answers</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">rdataToString</span><span class="o">()</span> <span class="k">else</span> <span class="k">return</span> <span class="n">hostIp</span>
<span class="o">}</span>
<span class="n">println</span> <span class="s1">&#39;208.201.239.36 =&gt; &#39;</span> <span class="o">+</span> <span class="n">reverseDns</span><span class="o">(</span><span class="s1">&#39;208.201.239.36&#39;</span><span class="o">)</span>
<span class="c1">// =&gt; 208.201.239.36 =&gt; www.oreillynet.com.</span>

<span class="kt">def</span> <span class="nf">hostAddrs</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">Address</span><span class="o">.</span><span class="na">getAllByName</span><span class="o">(</span><span class="n">name</span><span class="o">)</span>
    <span class="n">println</span> <span class="n">addresses</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">canonicalHostName</span> <span class="o">+</span> <span class="s1">&#39; =&gt; &#39;</span> <span class="o">+</span> <span class="n">addresses</span><span class="o">.</span><span class="na">collect</span><span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">hostAddress</span> <span class="o">}.</span><span class="na">join</span><span class="o">(</span><span class="s1">&#39; &#39;</span><span class="o">)</span>
<span class="o">}</span>
<span class="n">hostAddrs</span><span class="o">(</span><span class="s1">&#39;www.ora.com&#39;</span><span class="o">)</span>
<span class="c1">// =&gt; www.oreillynet.com. =&gt; 208.201.239.36 208.201.239.37</span>
<span class="n">hostAddrs</span><span class="o">(</span><span class="s1">&#39;www.whitehouse.gov&#39;</span><span class="o">)</span>
<span class="c1">// =&gt; 61.9.209.153 =&gt; 61.9.209.153 61.9.209.151</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_18.2</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// commons net examples (explicit error handling not shown)</span>
<span class="kn">import</span> <span class="nn">java.text.DateFormat</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.net.ftp.FTPClient</span>
<span class="c1">// connect</span>
<span class="n">server</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>                   <span class="c1">//server = &quot;ftp.host.com&quot;</span>

<span class="n">ftp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FTPClient</span><span class="o">()</span>
<span class="n">ftp</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span> <span class="n">server</span> <span class="o">)</span>
<span class="n">ftp</span><span class="o">.</span><span class="na">login</span><span class="o">(</span> <span class="s1">&#39;anonymous&#39;</span><span class="o">,</span> <span class="s1">&#39;guest&#39;</span> <span class="o">)</span>     <span class="c1">//ftp.login( &#39;username&#39;, &#39;password&#39; )</span>

<span class="n">println</span> <span class="s2">&quot;Connected to $server. $ftp.replyString&quot;</span>

<span class="c1">// retrieve file</span>
<span class="n">ftp</span><span class="o">.</span><span class="na">changeWorkingDirectory</span><span class="o">(</span> <span class="s1">&#39;.&#39;</span> <span class="o">)</span>  <span class="c1">//ftp.changeWorkingDirectory( &#39;serverFolder&#39; )</span>
<span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">&#39;README.txt&#39;</span><span class="o">)</span> <span class="c1">//new File(&#39;localFolder&#39; + File.separator + &#39;localFilename&#39;)</span>

<span class="n">file</span><span class="o">.</span><span class="na">withOutputStream</span><span class="o">{</span> <span class="n">os</span> <span class="o">-&gt;</span>
    <span class="n">ftp</span><span class="o">.</span><span class="na">retrieveFile</span><span class="o">(</span> <span class="s1">&#39;README.txt&#39;</span><span class="o">,</span> <span class="n">os</span> <span class="o">)</span>  <span class="c1">//ftp.retrieveFile( &#39;serverFilename&#39;, os )</span>
<span class="o">}</span>

<span class="c1">// upload file</span>
<span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">&#39;otherFile.txt&#39;</span><span class="o">)</span> <span class="c1">//new File(&#39;localFolder&#39; + File.separator + &#39;localFilename&#39;)</span>
<span class="n">file</span><span class="o">.</span><span class="na">withInputStream</span><span class="o">{</span> <span class="n">fis</span> <span class="o">-&gt;</span> <span class="n">ftp</span><span class="o">.</span><span class="na">storeFile</span><span class="o">(</span> <span class="s1">&#39;otherFile.txt&#39;</span><span class="o">,</span> <span class="n">fis</span> <span class="o">)</span> <span class="o">}</span>

<span class="c1">// List the files in the directory</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">ftp</span><span class="o">.</span><span class="na">listFiles</span><span class="o">()</span>
<span class="n">println</span> <span class="s2">&quot;Number of files in dir: $files.length&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">DateFormat</span><span class="o">.</span><span class="na">getDateInstance</span><span class="o">(</span> <span class="n">DateFormat</span><span class="o">.</span><span class="na">SHORT</span> <span class="o">)</span>
<span class="n">files</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">file</span> <span class="o">-&gt;</span>
    <span class="n">println</span> <span class="s2">&quot;${df.format(file.timestamp.time)}\t $file.name&quot;</span>
<span class="o">}</span>

<span class="c1">// Logout from the FTP Server and disconnect</span>
<span class="n">ftp</span><span class="o">.</span><span class="na">logout</span><span class="o">()</span>
<span class="n">ftp</span><span class="o">.</span><span class="na">disconnect</span><span class="o">()</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Connected to localhost. 230 User logged in, proceed.</span>
<span class="c1">// Number of files in dir: 2</span>
<span class="c1">// 18/01/07  otherFile.txt</span>
<span class="c1">// 25/04/06  README.txt</span>


<span class="c1">// Using AntBuilder; for more details, see:</span>
<span class="c1">// http://ant.apache.org/manual/OptionalTasks/ftp.html</span>
<span class="n">ant</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AntBuilder</span><span class="o">()</span>
<span class="n">ant</span><span class="o">.</span><span class="na">ftp</span><span class="o">(</span><span class="nl">action:</span><span class="s1">&#39;send&#39;</span><span class="o">,</span> <span class="nl">server:</span><span class="s1">&#39;ftp.hypothetical.india.org&#39;</span><span class="o">,</span> <span class="nl">port:</span><span class="s1">&#39;2121&#39;</span><span class="o">,</span>
        <span class="nl">remotedir:</span><span class="s1">&#39;/pub/incoming&#39;</span><span class="o">,</span> <span class="nl">userid:</span><span class="s1">&#39;coder&#39;</span><span class="o">,</span> <span class="nl">password:</span><span class="s1">&#39;java1&#39;</span><span class="o">,</span>
        <span class="nl">depends:</span><span class="s1">&#39;yes&#39;</span><span class="o">,</span> <span class="nl">binary:</span><span class="s1">&#39;no&#39;</span><span class="o">,</span> <span class="nl">systemTypeKey:</span><span class="s1">&#39;Windows&#39;</span><span class="o">,</span>
        <span class="nl">serverTimeZoneConfig:</span><span class="s1">&#39;India/Calcutta&#39;</span><span class="o">){</span>
    <span class="n">fileset</span><span class="o">(</span><span class="nl">dir:</span><span class="s1">&#39;htdocs/manual&#39;</span><span class="o">){</span>
        <span class="n">include</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;**/*.html&#39;</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_18.3</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// using AntBuilder; for more info, see:</span>
<span class="c1">// http://ant.apache.org/manual/CoreTasks/mail.html</span>
<span class="n">ant</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AntBuilder</span><span class="o">()</span>
<span class="n">ant</span><span class="o">.</span><span class="na">mail</span><span class="o">(</span><span class="nl">mailhost:</span><span class="s1">&#39;smtp.myisp.com&#39;</span><span class="o">,</span> <span class="nl">mailport:</span><span class="s1">&#39;1025&#39;</span><span class="o">,</span> <span class="nl">subject:</span><span class="s1">&#39;Test build&#39;</span><span class="o">){</span>
  <span class="n">from</span><span class="o">(</span><span class="nl">address:</span><span class="s1">&#39;config@myisp.com&#39;</span><span class="o">)</span>
  <span class="n">replyto</span><span class="o">(</span><span class="nl">address:</span><span class="s1">&#39;me@myisp.com&#39;</span><span class="o">)</span>
  <span class="n">to</span><span class="o">(</span><span class="nl">address:</span><span class="s1">&#39;all@xyz.com&#39;</span><span class="o">)</span>
  <span class="n">message</span><span class="o">(</span><span class="s2">&quot;The ${buildname} nightly build has completed&quot;</span><span class="o">)</span>
  <span class="n">attachments</span><span class="o">(){</span> <span class="c1">// ant 1.7 uses files attribute in earlier versions</span>
    <span class="n">fileset</span><span class="o">(</span><span class="nl">dir:</span><span class="s1">&#39;dist&#39;</span><span class="o">){</span>
      <span class="n">include</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;**/*.zip&#39;</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// using commons net</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.net.smtp.*</span>
<span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SMTPClient</span><span class="o">()</span>
<span class="n">client</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span> <span class="s2">&quot;mail.myserver.com&quot;</span><span class="o">,</span> <span class="mi">25</span> <span class="o">)</span>
<span class="k">if</span><span class="o">(</span> <span class="o">!</span><span class="n">SMTPReply</span><span class="o">.</span><span class="na">isPositiveCompletion</span><span class="o">(</span><span class="n">client</span><span class="o">.</span><span class="na">replyCode</span><span class="o">)</span> <span class="o">)</span> <span class="o">{</span>
    <span class="n">client</span><span class="o">.</span><span class="na">disconnect</span><span class="o">()</span>
    <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s2">&quot;SMTP server refused connection.&quot;</span><span class="o">)</span>
    <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
<span class="o">}</span>

<span class="c1">// Login</span>
<span class="n">client</span><span class="o">.</span><span class="na">login</span><span class="o">(</span> <span class="s2">&quot;myserver.com&quot;</span> <span class="o">)</span>

<span class="c1">// Set the sender and recipient(s)</span>
<span class="n">client</span><span class="o">.</span><span class="na">setSender</span><span class="o">(</span> <span class="s2">&quot;config@myisp.com&quot;</span> <span class="o">)</span>
<span class="n">client</span><span class="o">.</span><span class="na">addRecipient</span><span class="o">(</span> <span class="s2">&quot;all@xyz.com&quot;</span> <span class="o">)</span>

<span class="c1">// Use the SimpleSMTPHeader class to build the header</span>
<span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span> <span class="n">client</span><span class="o">.</span><span class="na">sendMessageData</span><span class="o">()</span> <span class="o">)</span>
<span class="n">header</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleSMTPHeader</span><span class="o">(</span> <span class="s2">&quot;config@myisp.com&quot;</span><span class="o">,</span> <span class="s2">&quot;all@xyz.com&quot;</span><span class="o">,</span> <span class="s2">&quot;My Subject&quot;</span><span class="o">)</span>
<span class="n">header</span><span class="o">.</span><span class="na">addCC</span><span class="o">(</span> <span class="s2">&quot;me@myisp.com&quot;</span> <span class="o">)</span>
<span class="n">header</span><span class="o">.</span><span class="na">addHeaderField</span><span class="o">(</span> <span class="s2">&quot;Organization&quot;</span><span class="o">,</span> <span class="s2">&quot;My Company&quot;</span> <span class="o">)</span>

<span class="c1">// Write the header to the SMTP Server</span>
<span class="n">writer</span><span class="o">.</span><span class="na">write</span><span class="o">(</span> <span class="n">header</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span> <span class="o">)</span>

<span class="c1">// Write the body of the message</span>
<span class="n">writer</span><span class="o">.</span><span class="na">write</span><span class="o">(</span> <span class="s2">&quot;This is a test...&quot;</span> <span class="o">)</span>

<span class="c1">// Close the writer </span>
<span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="k">if</span> <span class="o">(</span> <span class="o">!</span><span class="n">client</span><span class="o">.</span><span class="na">completePendingCommand</span><span class="o">()</span> <span class="o">)</span> <span class="c1">// failure</span>
    <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span> <span class="mi">1</span> <span class="o">)</span>

<span class="c1">// Logout from the e-mail server (QUIT) and close connection</span>
<span class="n">client</span><span class="o">.</span><span class="na">logout</span><span class="o">()</span>
<span class="n">client</span><span class="o">.</span><span class="na">disconnect</span><span class="o">()</span>

<span class="c1">// You can also use JavaMail; for more details, see:</span>
<span class="c1">// http://java.sun.com/products/javamail/</span>

<span class="c1">// For testing programs which send emails, consider:</span>
<span class="c1">// Dumbster (http://quintanasoft.com/dumbster/)</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_18.4</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// slight variation to original cookbook:</span>
<span class="c1">// prints 1st, 2nd and last articles from random newsgroup</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.net.nntp.NNTPClient</span>
<span class="n">postingPerm</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;Unknown&#39;</span><span class="o">,</span> <span class="s1">&#39;Moderated&#39;</span><span class="o">,</span> <span class="s1">&#39;Permitted&#39;</span><span class="o">,</span> <span class="s1">&#39;Prohibited&#39;</span><span class="o">]</span>
<span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NNTPClient</span><span class="o">()</span>
<span class="n">client</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="s2">&quot;news.example.com&quot;</span><span class="o">)</span>
<span class="n">list</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">listNewsgroups</span><span class="o">()</span>
<span class="n">println</span> <span class="s2">&quot;Found ${list.size()} newsgroups&quot;</span>
<span class="n">aList</span> <span class="o">=</span> <span class="n">list</span><span class="o">[</span><span class="k">new</span> <span class="n">Random</span><span class="o">().</span><span class="na">nextInt</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">())]</span>
<span class="n">println</span> <span class="s2">&quot;$aList.newsgroup has $aList.articleCount articles&quot;</span>
<span class="n">println</span> <span class="s2">&quot;PostingPermission = ${postingPerm[aList.postingPermission]}&quot;</span>
<span class="n">first</span> <span class="o">=</span> <span class="n">aList</span><span class="o">.</span><span class="na">firstArticle</span>
<span class="n">println</span> <span class="s2">&quot;First=$first, Last=$aList.lastArticle&quot;</span>
<span class="n">client</span><span class="o">.</span><span class="na">retrieveArticle</span><span class="o">(</span><span class="n">first</span><span class="o">)?.</span><span class="na">eachLine</span><span class="o">{</span> <span class="n">println</span> <span class="n">it</span> <span class="o">}</span>
<span class="n">client</span><span class="o">.</span><span class="na">selectNextArticle</span><span class="o">()</span>
<span class="n">client</span><span class="o">.</span><span class="na">retrieveArticle</span><span class="o">()?.</span><span class="na">eachLine</span><span class="o">{</span> <span class="n">println</span> <span class="n">it</span> <span class="o">}</span>
<span class="n">client</span><span class="o">.</span><span class="na">retrieveArticle</span><span class="o">(</span><span class="n">aList</span><span class="o">.</span><span class="na">lastArticle</span><span class="o">)?.</span><span class="na">eachLine</span><span class="o">{</span> <span class="n">println</span> <span class="n">it</span> <span class="o">}</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">postArticle</span><span class="o">()</span>
<span class="c1">// ... use writer ...</span>
<span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="n">client</span><span class="o">.</span><span class="na">logout</span><span class="o">()</span>
<span class="k">if</span> <span class="o">(</span><span class="n">client</span><span class="o">.</span><span class="na">isConnected</span><span class="o">())</span> <span class="n">client</span><span class="o">.</span><span class="na">disconnect</span><span class="o">()</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Found 37025 newsgroups</span>
<span class="c1">// alt.comp.sys.palmtops.pilot has 730 articles</span>
<span class="c1">// PostingPermission = Permitted</span>
<span class="c1">// First=21904, Last=22633</span>
<span class="c1">// ...</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_18.5</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// slight variation to original cookbook to print summary of messages on server</span>
<span class="c1">// uses commons net</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.net.pop3.POP3Client</span>
<span class="n">server</span> <span class="o">=</span> <span class="s1">&#39;pop.myisp.com&#39;</span>
<span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;gnat&#39;</span>
<span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;S33kr1T Pa55w0rD&#39;</span>
<span class="n">timeoutMillis</span> <span class="o">=</span> <span class="mi">30000</span>

<span class="kt">def</span> <span class="nf">printMessageInfo</span><span class="o">(</span><span class="n">reader</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">from</span><span class="o">,</span> <span class="n">subject</span>
    <span class="n">reader</span><span class="o">.</span><span class="na">eachLine</span><span class="o">{</span> <span class="n">line</span> <span class="o">-&gt;</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">()</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">lower</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s2">&quot;from: &quot;</span><span class="o">))</span> <span class="n">from</span> <span class="o">=</span> <span class="n">line</span><span class="o">[</span><span class="mi">6</span><span class="o">..-</span><span class="mi">1</span><span class="o">].</span><span class="na">trim</span><span class="o">()</span>
        <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">lower</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s2">&quot;subject: &quot;</span><span class="o">))</span> <span class="n">subject</span> <span class="o">=</span> <span class="n">line</span><span class="o">[</span><span class="mi">9</span><span class="o">..-</span><span class="mi">1</span><span class="o">].</span><span class="na">trim</span><span class="o">()</span>
    <span class="o">}</span>
    <span class="n">println</span> <span class="s2">&quot;$id From: $from, Subject: $subject&quot;</span>
<span class="o">}</span>

<span class="n">pop3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">POP3Client</span><span class="o">()</span>
<span class="n">pop3</span><span class="o">.</span><span class="na">setDefaultTimeout</span><span class="o">(</span><span class="n">timeoutMillis</span><span class="o">)</span>
<span class="n">pop3</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">server</span><span class="o">)</span>

<span class="k">if</span> <span class="o">(!</span><span class="n">pop3</span><span class="o">.</span><span class="na">login</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">password</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s2">&quot;Could not login to server.  Check password.&quot;</span><span class="o">)</span>
    <span class="n">pop3</span><span class="o">.</span><span class="na">disconnect</span><span class="o">()</span>
    <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
<span class="o">}</span>
<span class="n">messages</span> <span class="o">=</span> <span class="n">pop3</span><span class="o">.</span><span class="na">listMessages</span><span class="o">()</span>
<span class="k">if</span> <span class="o">(!</span><span class="n">messages</span><span class="o">)</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s2">&quot;Could not retrieve message list.&quot;</span><span class="o">)</span>
<span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">messages</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="n">println</span><span class="o">(</span><span class="s2">&quot;No messages&quot;</span><span class="o">)</span>
<span class="k">else</span> <span class="o">{</span>
    <span class="n">messages</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">message</span> <span class="o">-&gt;</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">pop3</span><span class="o">.</span><span class="na">retrieveMessageTop</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">number</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">reader</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s2">&quot;Could not retrieve message header. Skipping...&quot;</span><span class="o">)</span>
        <span class="o">}</span>
        <span class="n">printMessageInfo</span><span class="o">(</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">reader</span><span class="o">),</span> <span class="n">message</span><span class="o">.</span><span class="na">number</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">pop3</span><span class="o">.</span><span class="na">logout</span><span class="o">()</span>
<span class="n">pop3</span><span class="o">.</span><span class="na">disconnect</span><span class="o">()</span>

<span class="c1">// You can also use JavaMail; for more details, see:</span>
<span class="c1">// http://java.sun.com/products/javamail/</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_18.6</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Variation to original cookbook: this more extensive example</span>
<span class="c1">// uses telnet to extract weather information about Sydney from</span>
<span class="c1">// a telnet-based weather server at the University of Michigan.</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.net.telnet.TelnetClient</span>

<span class="kt">def</span> <span class="nf">readUntil</span><span class="o">(</span> <span class="n">pattern</span> <span class="o">)</span> <span class="o">{</span>
    <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">()</span>
    <span class="k">while</span> <span class="o">((</span><span class="n">ch</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">read</span><span class="o">())</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">sb</span> <span class="o">&lt;&lt;</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="n">ch</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">endsWith</span><span class="o">(</span><span class="n">pattern</span><span class="o">))</span> <span class="o">{</span>
            <span class="kt">def</span> <span class="n">found</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span>
            <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">()</span>
            <span class="k">return</span> <span class="n">found</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kc">null</span>
<span class="o">}</span>

<span class="n">telnet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TelnetClient</span><span class="o">()</span>
<span class="n">telnet</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span> <span class="s1">&#39;rainmaker.wunderground.com&#39;</span><span class="o">,</span> <span class="mi">3000</span> <span class="o">)</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">telnet</span><span class="o">.</span><span class="na">inputStream</span><span class="o">.</span><span class="na">newReader</span><span class="o">()</span>
<span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="k">new</span> <span class="n">OutputStreamWriter</span><span class="o">(</span><span class="n">telnet</span><span class="o">.</span><span class="na">outputStream</span><span class="o">),</span><span class="kc">true</span><span class="o">)</span>
<span class="n">readUntil</span><span class="o">(</span> <span class="s2">&quot;Welcome&quot;</span> <span class="o">)</span>
<span class="n">println</span> <span class="s1">&#39;Welcome&#39;</span> <span class="o">+</span> <span class="n">readUntil</span><span class="o">(</span> <span class="s2">&quot;!&quot;</span> <span class="o">)</span>
<span class="n">readUntil</span><span class="o">(</span> <span class="s2">&quot;continue:&quot;</span> <span class="o">)</span>
<span class="n">writer</span><span class="o">.</span><span class="na">println</span><span class="o">()</span>
<span class="n">readUntil</span><span class="o">(</span> <span class="s2">&quot;-- &quot;</span> <span class="o">)</span>
<span class="n">writer</span><span class="o">.</span><span class="na">println</span><span class="o">()</span>
<span class="n">readUntil</span><span class="o">(</span> <span class="s2">&quot;Selection:&quot;</span> <span class="o">)</span>
<span class="n">writer</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s2">&quot;10&quot;</span><span class="o">)</span>
<span class="n">readUntil</span><span class="o">(</span> <span class="s2">&quot;Selection:&quot;</span> <span class="o">)</span>
<span class="n">writer</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s2">&quot;3&quot;</span><span class="o">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">readUntil</span><span class="o">(</span> <span class="s2">&quot;Return&quot;</span> <span class="o">)</span>
<span class="k">while</span> <span class="o">(!</span><span class="n">x</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s1">&#39;SYDNEY&#39;</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">writer</span><span class="o">.</span><span class="na">println</span><span class="o">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">readUntil</span><span class="o">(</span> <span class="s2">&quot;Return&quot;</span> <span class="o">)</span>
<span class="o">}</span>
<span class="n">m</span> <span class="o">=</span> <span class="o">(</span><span class="n">x</span> <span class="o">=~</span> <span class="s">/(?sm).*(SYDNEY.*?)$/</span><span class="o">)</span>
<span class="n">telnet</span><span class="o">.</span><span class="na">disconnect</span><span class="o">()</span>
<span class="n">println</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">1</span><span class="o">]</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Welcome to THE WEATHER UNDERGROUND telnet service!</span>
<span class="c1">// SYDNEY           FAIR      10AM   81  27</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_18.7</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">address</span> <span class="o">=</span> <span class="n">InetAddress</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="s2">&quot;web.mit.edu&quot;</span><span class="o">)</span>
<span class="n">timeoutMillis</span> <span class="o">=</span> <span class="mi">3000</span>
<span class="n">println</span> <span class="n">address</span><span class="o">.</span><span class="na">isReachable</span><span class="o">(</span><span class="n">timeoutMillis</span><span class="o">)</span>
<span class="c1">// =&gt; true (if firewalls don&#39;t get in the way, may require privileges on Linux,</span>
<span class="c1">//          may not use ICMP but rather Echo protocol on Windows machines)</span>

<span class="c1">// You can also use commons net EchoUDPClient and EchoTCPClient to interact</span>
<span class="c1">// with the Echo protocol - sometimes useful for ping-like functionality.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_18.8</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.net.WhoisClient</span>
<span class="n">whois</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WhoisClient</span><span class="o">()</span>
<span class="n">whois</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">WhoisClient</span><span class="o">.</span><span class="na">DEFAULT_HOST</span><span class="o">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">whois</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="s1">&#39;cnn.com&#39;</span><span class="o">)</span> <span class="c1">// as text of complete query</span>
<span class="n">println</span> <span class="n">result</span> <span class="c1">// could extract info from result here (using e.g. regex)</span>
<span class="n">whois</span><span class="o">.</span><span class="na">disconnect</span><span class="o">()</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_18.9</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// not exact equivalent to original cookbook: just shows raw functionality</span>
<span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SMTPClient</span><span class="o">()</span>
<span class="n">client</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span> <span class="s2">&quot;smtp.example.com&quot;</span><span class="o">,</span> <span class="mi">25</span> <span class="o">)</span>
<span class="n">println</span> <span class="n">client</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="s2">&quot;george&quot;</span><span class="o">)</span> <span class="c1">// =&gt; true</span>
<span class="n">println</span> <span class="n">client</span><span class="o">.</span><span class="na">replyString</span> <span class="c1">// =&gt; 250 George Washington &lt;george@wash.dc.gov&gt;</span>
<span class="n">println</span> <span class="n">client</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="s2">&quot;jetson&quot;</span><span class="o">)</span> <span class="c1">// =&gt; false</span>
<span class="n">println</span> <span class="n">client</span><span class="o">.</span><span class="na">replyString</span> <span class="c1">// =&gt; 550 jetson... User unknown</span>
<span class="n">client</span><span class="o">.</span><span class="na">expn</span><span class="o">(</span><span class="s2">&quot;presidents&quot;</span><span class="o">)</span>
<span class="n">println</span> <span class="n">client</span><span class="o">.</span><span class="na">replyString</span>
<span class="c1">// =&gt;</span>
<span class="c1">// 250-George Washington &lt;george@wash.dc.gov&gt;</span>
<span class="c1">// 250-Thomas Jefferson &lt;tj@wash.dc.gov&gt;</span>
<span class="c1">// 250-Ben Franklin &lt;ben@here.us.edu&gt;</span>
<span class="c1">// ...</span>

<span class="c1">// expect these commands to be disabled by most public servers due to spam</span>
<span class="n">println</span> <span class="n">client</span><span class="o">.</span><span class="na">replyString</span>
<span class="c1">// =&gt; 502 Command is locally disabled</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_19.0</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// URLs have the same form as in Perl</span>

<span class="c1">// Invoking dynamic content is done through the same standard urls:</span>
<span class="c1">// http://mox.perl.com/cgi-bin/program?name=Johann&amp;born=1685</span>
<span class="c1">// http://mox.perl.com/cgi-bin/program</span>

<span class="c1">// Groovy has Groovelets and GSP page support built-in. For a full</span>
<span class="c1">// web framework, see Grails: http://grails.codehaus.org/</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_19.1</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// as a plain groovelet</span>
<span class="n">param</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s1">&#39;PARAM_NAME&#39;</span><span class="o">)</span>
<span class="n">println</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;html&gt;&lt;head&gt;</span>
<span class="s2">&lt;title&gt;Howdy there!&lt;/title&gt;</span>
<span class="s2">&lt;/head&gt;</span>
<span class="s2">&lt;body&gt;</span>
<span class="s2">&lt;p&gt;</span>
<span class="s2">You typed: $param</span>
<span class="s2">&lt;/p&gt;</span>
<span class="s2">&lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1">// as a groovelet using markup builder</span>
<span class="kn">import</span> <span class="nn">groovy.xml.MarkupBuilder</span>
<span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringWriter</span><span class="o">()</span>
<span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MarkupBuilder</span><span class="o">(</span><span class="n">writer</span><span class="o">)</span>
<span class="n">builder</span><span class="o">.</span><span class="na">html</span> <span class="o">{</span>
    <span class="n">head</span> <span class="o">{</span>
        <span class="n">title</span> <span class="s1">&#39;Howdy there!&#39;</span>
    <span class="o">}</span>
    <span class="n">body</span> <span class="o">{</span>
        <span class="n">p</span><span class="o">(</span><span class="s1">&#39;You typed: &#39;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s1">&#39;PARAM_NAME&#39;</span><span class="o">))</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">println</span> <span class="n">writer</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span>

<span class="c1">// as a GSP page:</span>
<span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;&lt;</span><span class="n">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Howdy</span> <span class="n">there</span><span class="o">!&lt;</span><span class="s">/title&gt;</span>
<span class="s">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
<span class="n">You</span> <span class="nl">typed:</span> <span class="n">$</span><span class="o">{</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s1">&#39;PARAM_NAME&#39;</span><span class="o">)}</span>
<span class="o">&lt;</span><span class="s">/p&gt;</span>
<span class="s">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="s">/html&gt;</span>

<span class="s">// Request parameters are often encoded by the browser before</span>
<span class="s">// sending to the server and usually can be printed out as is.</span>
<span class="s">// If you need to convert, use commons lang StringEscapeUtils#escapeHtml()</span>
<span class="s">// and StringEscapeUtils#unescapeHtml().</span>

<span class="s">// Getting parameters:</span>
<span class="s">who = request.getParameter(&#39;Name&#39;)</span>
<span class="s">phone = request.getParameter(&#39;Number&#39;)</span>
<span class="s">picks = request.getParameterValues(&#39;Choices&#39;) // String array or null</span>

<span class="s">// Changing headers:</span>
<span class="s">response.setContentType(&#39;text/</span><span class="n">html</span><span class="o">;</span><span class="n">charset</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span><span class="s1">&#39;)</span>
<span class="s1">response.setContentType(&#39;</span><span class="n">text</span><span class="s">/plain&#39;)</span>
<span class="s">response.setContentType(&#39;text/</span><span class="n">plain</span><span class="s1">&#39;)</span>
<span class="s1">response.setHeader(&#39;</span><span class="n">Cache</span><span class="o">-</span><span class="n">control</span><span class="s1">&#39;, &#39;</span><span class="n">no</span><span class="o">-</span><span class="n">cache</span><span class="s1">&#39;)</span>
<span class="s1">response.setDateHeader(&#39;</span><span class="n">Expires</span><span class="s1">&#39;, System.currentTimeMillis() + 3*24*60*60*1000)</span>
<span class="s1">//----------------------------------------------------------------------------------</span>


<span class="s1">// @@PLEAC@@_19.2</span>
<span class="s1">//----------------------------------------------------------------------------------</span>
<span class="s1">// The Java Servlet API has a special log() method for writing to the</span>
<span class="s1">// web server log.</span>

<span class="s1">// To send errors to custom HTML pages, update the web.xml deployment</span>
<span class="s1">// descriptor to include one or more &lt;error-page&gt; elements, e.g.:</span>
<span class="s1">&lt;error-page&gt;</span>
<span class="s1">    &lt;error-code&gt;404&lt;/error-code&gt;</span>
<span class="s1">    &lt;location&gt;/404.html&lt;/location&gt;</span>
<span class="s1">&lt;/error-page&gt;</span>
<span class="s1">&lt;error-page&gt;</span>
<span class="s1">    &lt;exception-type&gt;java.lang.NullPointerException&lt;/exception-type&gt;</span>
<span class="s1">    &lt;location&gt;/NpeError.gsp&lt;/location&gt;</span>
<span class="s1">&lt;/error-page&gt;</span>

<span class="s1">// Another trick is to catch an exception within the servlet/gsp code</span>
<span class="s1">// and print it out into the HTML as a comment.</span>
<span class="s1">//----------------------------------------------------------------------------------</span>


<span class="s1">// @@PLEAC@@_19.3</span>
<span class="s1">//----------------------------------------------------------------------------------</span>
<span class="s1">// 500 errors could occur if you have compile errors in your script.</span>
<span class="s1">// Pre-compile with your IDE or groovyc.</span>

<span class="s1">// You can use an expando, mock or map to run your scripts outside</span>
<span class="s1">// the web container environment. If you use Jetty as your container</span>
<span class="s1">// it has a special servlet tester, for more details:</span>
<span class="s1">// http://blogs.webtide.com/gregw/2006/12/16/1166307599250.html</span>
<span class="s1">//----------------------------------------------------------------------------------</span>


<span class="s1">// @@PLEAC@@_19.4</span>
<span class="s1">//----------------------------------------------------------------------------------</span>
<span class="s1">// Web servers should be invoked with an appropriate Java security policy in place.</span>
<span class="s1">// This can be used to limit possible actions from hacking attempts.</span>

<span class="s1">// Normal practices limit hacking exposure. The JDBC API encourages the use</span>
<span class="s1">// of Prepared queries rather than encouraging practices which lead to SQL</span>
<span class="s1">// injection. Using system or exec is rarely used either as Java provides</span>
<span class="s1">// cross-platform mechanisms for most operating system level functionality.</span>

<span class="s1">// Other security measures should be complemented with SSL and authentication.</span>
<span class="s1">//----------------------------------------------------------------------------------</span>


<span class="s1">// @@PLEAC@@_19.5</span>
<span class="s1">//----------------------------------------------------------------------------------</span>
<span class="s1">// Within the servlet element of your web.xml, there is a &lt;load-on-startup&gt; element.</span>
<span class="s1">// Use that on a per servlet basis to pre-load whichever servlets you like.</span>
<span class="s1">//----------------------------------------------------------------------------------</span>


<span class="s1">// @@PLEAC@@_19.6</span>
<span class="s1">//----------------------------------------------------------------------------------</span>
<span class="s1">// As discussed in 19.3 and 19.4:</span>
<span class="s1">// Web servers should be invoked with an appropriate Java security policy in place.</span>
<span class="s1">// This can be used to limit possible actions from hacking attempts.</span>

<span class="s1">// Normal practices limit hacking exposure. The JDBC API encourages the use</span>
<span class="s1">// of Prepared queries rather than encouraging practices which lead to SQL</span>
<span class="s1">// injection. Using system or exec is rarely used either as Java provides</span>
<span class="s1">// cross-platform mechanisms for most operating system level functionality.</span>

<span class="s1">// In addition, if authentication is used, security can be locked down at a</span>
<span class="s1">// very fine-grained level on a per servlet action or per user (with JAAS) basis.</span>
<span class="s1">//----------------------------------------------------------------------------------</span>


<span class="s1">// @@PLEAC@@_19.7</span>
<span class="s1">//----------------------------------------------------------------------------------</span>
<span class="s1">import groovy.xml.*</span>
<span class="s1">// using a builder:</span>
<span class="s1">Closure markup = {</span>
<span class="s1">    ol {</span>
<span class="s1">        [&#39;</span><span class="n">red</span><span class="s1">&#39;,&#39;</span><span class="n">blue</span><span class="s1">&#39;,&#39;</span><span class="n">green</span><span class="s1">&#39;].each{ li(it) }</span>
<span class="s1">    }</span>
<span class="s1">}</span>
<span class="s1">println new StreamingMarkupBuilder().bind(markup).toString()</span>
<span class="s1">// =&gt; &lt;ol&gt;&lt;li&gt;red&lt;/li&gt;&lt;li&gt;blue&lt;/li&gt;&lt;li&gt;green&lt;/li&gt;&lt;/ol&gt;</span>

<span class="s1">names = &#39;</span><span class="n">Larry</span> <span class="n">Moe</span> <span class="n">Curly</span><span class="s1">&#39;.split(&#39;</span> <span class="s1">&#39;)</span>
<span class="s1">markup = {</span>
<span class="s1">    ul {</span>
<span class="s1">        names.each{ li(type:&#39;</span><span class="n">disc</span><span class="s1">&#39;, it) }</span>
<span class="s1">    }</span>
<span class="s1">}</span>
<span class="s1">println new StreamingMarkupBuilder().bind(markup).toString()</span>
<span class="s1">// &lt;ul&gt;&lt;li type=&quot;disc&quot;&gt;Larry&lt;/li&gt;&lt;li type=&quot;disc&quot;&gt;Moe&lt;/li&gt;</span>
<span class="s1">//     &lt;li type=&quot;disc&quot;&gt;Curly&lt;/li&gt;&lt;/ul&gt;</span>
<span class="s1">//-----------------------------</span>

<span class="s1">m = { li(&quot;alpha&quot;) }</span>
<span class="s1">println new StreamingMarkupBuilder().bind(m).toString()</span>
<span class="s1">//     &lt;li&gt;alpha&lt;/li&gt;</span>

<span class="s1">m = { [&#39;</span><span class="n">alpha</span><span class="s1">&#39;,&#39;</span><span class="n">omega</span><span class="s1">&#39;].each { li(it) } }</span>
<span class="s1">println new StreamingMarkupBuilder().bind(m).toString()</span>
<span class="s1">//     &lt;li&gt;alpha&lt;/li&gt; &lt;li&gt;omega&lt;/li&gt;</span>
<span class="s1">//-----------------------------</span>

<span class="s1">states = [</span>
<span class="s1">    &quot;Wisconsin&quot;:  [ &quot;Superior&quot;, &quot;Lake Geneva&quot;, &quot;Madison&quot; ],</span>
<span class="s1">    &quot;Colorado&quot;:   [ &quot;Denver&quot;, &quot;Fort Collins&quot;, &quot;Boulder&quot; ],</span>
<span class="s1">    &quot;Texas&quot;:      [ &quot;Plano&quot;, &quot;Austin&quot;, &quot;Fort Stockton&quot; ],</span>
<span class="s1">    &quot;California&quot;: [ &quot;Sebastopol&quot;, &quot;Santa Rosa&quot;, &quot;Berkeley&quot; ],</span>
<span class="s1">]</span>

<span class="s1">writer = new StringWriter()</span>
<span class="s1">builder = new MarkupBuilder(writer)</span>
<span class="s1">builder.table{</span>
<span class="s1">    caption(&#39;</span><span class="n">Cities</span> <span class="n">I</span> <span class="n">Have</span> <span class="n">Known</span><span class="s1">&#39;)</span>
<span class="s1">    tr{ th(&#39;</span><span class="n">State</span><span class="s1">&#39;); th(colspan:3, &#39;</span><span class="n">Cities</span><span class="s1">&#39;) }</span>
<span class="s1">    states.keySet().sort().each{ state -&gt;</span>
<span class="s1">        tr{</span>
<span class="s1">            th(state)</span>
<span class="s1">            states[state].sort().each{ td(it) }</span>
<span class="s1">        }</span>
<span class="s1">    }</span>
<span class="s1">}</span>
<span class="s1">println writer.toString()</span>
<span class="s1">// =&gt;</span>
<span class="s1">// &lt;table&gt;</span>
<span class="s1">//   &lt;caption&gt;Cities I Have Known&lt;/caption&gt;</span>
<span class="s1">//   &lt;tr&gt;</span>
<span class="s1">//     &lt;th&gt;State&lt;/th&gt;</span>
<span class="s1">//     &lt;th colspan=&#39;</span><span class="mi">3</span><span class="s1">&#39;&gt;Cities&lt;/th&gt;</span>
<span class="s1">//   &lt;/tr&gt;</span>
<span class="s1">//   &lt;tr&gt;</span>
<span class="s1">//     &lt;th&gt;California&lt;/th&gt;</span>
<span class="s1">//     &lt;td&gt;Berkeley&lt;/td&gt;</span>
<span class="s1">//     &lt;td&gt;Santa Rosa&lt;/td&gt;</span>
<span class="s1">//     &lt;td&gt;Sebastopol&lt;/td&gt;</span>
<span class="s1">//   &lt;/tr&gt;</span>
<span class="s1">//   &lt;tr&gt;</span>
<span class="s1">//     &lt;th&gt;Colorado&lt;/th&gt;</span>
<span class="s1">//     &lt;td&gt;Boulder&lt;/td&gt;</span>
<span class="s1">//     &lt;td&gt;Denver&lt;/td&gt;</span>
<span class="s1">//     &lt;td&gt;Fort Collins&lt;/td&gt;</span>
<span class="s1">//   &lt;/tr&gt;</span>
<span class="s1">//   &lt;tr&gt;</span>
<span class="s1">//     &lt;th&gt;Texas&lt;/th&gt;</span>
<span class="s1">//     &lt;td&gt;Austin&lt;/td&gt;</span>
<span class="s1">//     &lt;td&gt;Fort Stockton&lt;/td&gt;</span>
<span class="s1">//     &lt;td&gt;Plano&lt;/td&gt;</span>
<span class="s1">//   &lt;/tr&gt;</span>
<span class="s1">//   &lt;tr&gt;</span>
<span class="s1">//     &lt;th&gt;Wisconsin&lt;/th&gt;</span>
<span class="s1">//     &lt;td&gt;Lake Geneva&lt;/td&gt;</span>
<span class="s1">//     &lt;td&gt;Madison&lt;/td&gt;</span>
<span class="s1">//     &lt;td&gt;Superior&lt;/td&gt;</span>
<span class="s1">//   &lt;/tr&gt;</span>
<span class="s1">// &lt;/table&gt;</span>

<span class="s1">import groovy.sql.Sql</span>
<span class="s1">import groovy.xml.MarkupBuilder</span>

<span class="s1">dbHandle = null</span>
<span class="s1">dbUrl = &#39;</span><span class="nl">jdbc:hsqldb:</span><span class="o">...</span><span class="s1">&#39;</span>
<span class="s1">def getDb(){</span>
<span class="s1">    if (dbHandle) return dbHandle</span>
<span class="s1">    def source = new org.hsqldb.jdbc.jdbcDataSource()</span>
<span class="s1">    source.database = dbUrl</span>
<span class="s1">    source.user = &#39;</span><span class="n">sa</span><span class="s1">&#39;</span>
<span class="s1">    source.password = &#39;&#39;</span>
<span class="s1">    dbHandle = new Sql(source)</span>
<span class="s1">    return dbHandle</span>
<span class="s1">}</span>

<span class="s1">def findByLimit(limit) {</span>
<span class="s1">    db.rows &quot;SELECT name,salary FROM employees where salary &gt; $limit&quot;</span>
<span class="s1">}</span>

<span class="s1">limit = request.getParameter(&#39;</span><span class="n">LIMIT</span><span class="s1">&#39;)</span>
<span class="s1">writer = new StringWriter()</span>
<span class="s1">builder = new MarkupBuilder(writer)</span>
<span class="s1">builder.html {</span>
<span class="s1">    head { title(&#39;</span><span class="n">Salary</span> <span class="n">Query</span><span class="s1">&#39;) }</span>
<span class="s1">    h1(&#39;</span><span class="n">Search</span><span class="s1">&#39;)</span>
<span class="s1">    form{</span>
<span class="s1">        p(&#39;</span><span class="n">Enter</span> <span class="n">minimum</span> <span class="n">salary</span><span class="s1">&#39;)</span>
<span class="s1">        input(type:&#39;</span><span class="n">text</span><span class="s1">&#39;, name:&#39;</span><span class="n">LIMIT</span><span class="s1">&#39;)</span>
<span class="s1">        input(type:&#39;</span><span class="n">submit</span><span class="s1">&#39;)</span>
<span class="s1">    }</span>
<span class="s1">    if (limit) {</span>
<span class="s1">        h1(&#39;</span><span class="n">Results</span><span class="s1">&#39;)</span>
<span class="s1">        table(border:1){</span>
<span class="s1">            findByLimit(limit).each{ row -&gt;</span>
<span class="s1">                tr{ td(row.name); td(row.salary) }</span>
<span class="s1">            }</span>
<span class="s1">        }</span>
<span class="s1">    }</span>
<span class="s1">}</span>
<span class="s1">println writer.toString()</span>
<span class="s1">//----------------------------------------------------------------------------------</span>


<span class="s1">// @@PLEAC@@_19.8</span>
<span class="s1">//----------------------------------------------------------------------------------</span>
<span class="s1">// The preferred way to redirect to resources within the web application:</span>
<span class="s1">dispatcher = request.getRequestDispatcher(&#39;</span><span class="n">hello</span><span class="o">.</span><span class="na">gsp</span><span class="s1">&#39;)</span>
<span class="s1">dispatcher.forward(request, response)</span>
<span class="s1">// Old versions of web containers allowed this mechanism to also redirect</span>
<span class="s1">// to external resources but this was deemed a potential security risk.</span>

<span class="s1">// The suggested way to external sites (less efficient for internal resources):</span>
<span class="s1">response.sendRedirect(&quot;http://www.perl.com/CPAN/&quot;)</span>

<span class="s1">// set cookie and forward</span>
<span class="s1">oreo = new Cookie(&#39;</span><span class="n">filling</span><span class="s1">&#39;, &#39;</span><span class="n">vanilla</span> <span class="n">creme</span><span class="s1">&#39;)</span>
<span class="s1">THREE_MONTHS = 3 * 30 * 24 * 60 * 60</span>
<span class="s1">oreo.maxAge = THREE_MONTHS</span>
<span class="s1">oreo.domain = &#39;</span><span class="o">.</span><span class="na">pleac</span><span class="o">.</span><span class="na">sourceforge</span><span class="o">.</span><span class="na">net</span><span class="s1">&#39;</span>
<span class="s1">whither = &#39;</span><span class="nl">http:</span><span class="c1">//pleac.sourceforge.net/pleac_ruby/cgiprogramming.html&#39;</span>
<span class="n">response</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">oreo</span><span class="o">)</span>
<span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">whither</span><span class="o">)</span>

<span class="c1">// forward based on user agent</span>
<span class="n">dir</span> <span class="o">=</span> <span class="s1">&#39;http://www.science.uva.nl/%7Emes/jargon&#39;</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s1">&#39;user-agent&#39;</span><span class="o">)</span>
<span class="n">menu</span> <span class="o">=</span> <span class="o">[</span>
    <span class="o">[</span><span class="s">/Mac/</span><span class="o">,</span> <span class="s1">&#39;m/macintrash.html&#39;</span><span class="o">],</span>
    <span class="o">[</span><span class="s">/Win(dows )?NT/</span><span class="o">,</span> <span class="s1">&#39;e/evilandrude.html&#39;</span><span class="o">],</span>
    <span class="o">[</span><span class="s">/Win|MSIE|WebTV/</span><span class="o">,</span> <span class="s1">&#39;m/microslothwindows.html&#39;</span><span class="o">],</span>
    <span class="o">[</span><span class="s">/Linux/</span><span class="o">,</span> <span class="s1">&#39;l/linux.html&#39;</span><span class="o">],</span>
    <span class="o">[</span><span class="s">/HP-UX/</span><span class="o">,</span> <span class="s1">&#39;h/hpsux.html&#39;</span><span class="o">],</span>
    <span class="o">[</span><span class="s">/SunOS/</span><span class="o">,</span> <span class="s1">&#39;s/scumos.html&#39;</span><span class="o">],</span>
<span class="o">]</span>
<span class="n">page</span> <span class="o">=</span> <span class="s1">&#39;a/aportraitofj.randomhacker.html&#39;</span>
<span class="n">menu</span><span class="o">.</span><span class="na">each</span><span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">agent</span> <span class="o">=~</span> <span class="n">it</span><span class="o">[</span><span class="mi">0</span><span class="o">])</span> <span class="n">page</span> <span class="o">=</span> <span class="n">it</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
<span class="o">}</span>
<span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s2">&quot;$dir/$page&quot;</span><span class="o">)</span>

<span class="c1">// no response output</span>
<span class="n">response</span><span class="o">.</span><span class="na">sendError</span><span class="o">(</span><span class="mi">204</span><span class="o">,</span> <span class="s1">&#39;No Response&#39;</span><span class="o">)</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_19.9</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Consider TCPMON or similar: http://ws.apache.org/commons/tcpmon/</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_19.10</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// helper method</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.Cookie</span>
<span class="kn">import</span> <span class="nn">groovy.xml.MarkupBuilder</span>

<span class="kt">def</span> <span class="nf">getCookieValue</span><span class="o">(</span><span class="n">cookies</span><span class="o">,</span> <span class="n">cookieName</span><span class="o">,</span> <span class="n">defaultValue</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">cookies</span><span class="o">)</span> <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..&lt;</span><span class="n">cookies</span><span class="o">.</span><span class="na">length</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">cookieName</span> <span class="o">==</span> <span class="n">cookies</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">name</span><span class="o">)</span> <span class="k">return</span> <span class="n">cookies</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">value</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">defaultValue</span>
<span class="o">}</span>

<span class="n">prefValue</span> <span class="o">=</span> <span class="n">getCookieValue</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">cookies</span><span class="o">,</span> <span class="s1">&#39;preference_name&#39;</span><span class="o">,</span> <span class="s1">&#39;default&#39;</span><span class="o">)</span>
<span class="n">cookie</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cookie</span><span class="o">(</span><span class="s1">&#39;preference name&#39;</span><span class="o">,</span><span class="s2">&quot;whatever you&#39;d like&quot;</span><span class="o">)</span>
<span class="n">SECONDS_PER_YEAR</span> <span class="o">=</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">365</span>
<span class="n">cookie</span><span class="o">.</span><span class="na">maxAge</span> <span class="o">=</span> <span class="n">SECONDS_PER_YEAR</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">response</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">cookie</span><span class="o">)</span>

<span class="n">cookname</span> <span class="o">=</span> <span class="s1">&#39;fav_ice_cream&#39;</span>
<span class="n">favorite</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s1">&#39;flavor&#39;</span><span class="o">)</span>
<span class="n">tasty</span>    <span class="o">=</span> <span class="n">getCookieValue</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">cookies</span><span class="o">,</span> <span class="n">cookname</span><span class="o">,</span> <span class="s1">&#39;mint&#39;</span><span class="o">)</span>

<span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringWriter</span><span class="o">()</span>
<span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MarkupBuilder</span><span class="o">(</span><span class="n">writer</span><span class="o">)</span>
<span class="n">builder</span><span class="o">.</span><span class="na">html</span> <span class="o">{</span>
    <span class="n">head</span> <span class="o">{</span> <span class="n">title</span><span class="o">(</span><span class="s1">&#39;Ice Cookies&#39;</span><span class="o">)</span> <span class="o">}</span>
    <span class="n">body</span> <span class="o">{</span>
        <span class="n">h1</span><span class="o">(</span><span class="s1">&#39;Hello Ice Cream&#39;</span><span class="o">)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">favorite</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">p</span><span class="o">(</span><span class="s2">&quot;You chose as your favorite flavor &#39;$favorite&#39;.&quot;</span><span class="o">)</span>
            <span class="n">cookie</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cookie</span><span class="o">(</span><span class="n">cookname</span><span class="o">,</span> <span class="n">favorite</span><span class="o">)</span>
            <span class="n">ONE_HOUR</span> <span class="o">=</span> <span class="mi">3600</span> <span class="c1">// secs</span>
            <span class="n">cookie</span><span class="o">.</span><span class="na">maxAge</span> <span class="o">=</span> <span class="n">ONE_HOUR</span>
            <span class="n">response</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">cookie</span><span class="o">)</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">hr</span><span class="o">()</span>
            <span class="n">form</span> <span class="o">{</span>
                <span class="n">p</span><span class="o">(</span><span class="s1">&#39;Please select a flavor: &#39;</span><span class="o">)</span>
                <span class="n">input</span><span class="o">(</span><span class="nl">type:</span><span class="s1">&#39;text&#39;</span><span class="o">,</span> <span class="nl">name:</span><span class="s1">&#39;flavor&#39;</span><span class="o">,</span> <span class="nl">value:</span><span class="n">tasty</span><span class="o">)</span>
            <span class="o">}</span>
            <span class="n">hr</span><span class="o">()</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">println</span> <span class="n">writer</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span>
<span class="c1">//----------------------------------------------------------------------------------</span>

<span class="c1">// @@PLEAC@@_19.11</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="kn">import</span> <span class="nn">groovy.xml.MarkupBuilder</span>
<span class="c1">// On Linux systems replace with: &quot;who&quot;.execute().text</span>
<span class="n">fakedWhoInput</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">root tty1 Nov 2 17:57</span>
<span class="s1">hermie tty3 Nov 2 18:43</span>
<span class="s1">hermie tty4 Nov 1 20:01</span>
<span class="s1">sigmund tty2 Nov 2 18:08</span>
<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="na">trim</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">/\n/</span><span class="o">)</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s1">&#39;WHO&#39;</span><span class="o">)</span>
<span class="k">if</span> <span class="o">(!</span><span class="n">name</span><span class="o">)</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringWriter</span><span class="o">()</span>
<span class="k">new</span> <span class="nf">MarkupBuilder</span><span class="o">(</span><span class="n">writer</span><span class="o">).</span><span class="na">html</span><span class="o">{</span>
    <span class="n">head</span><span class="o">{</span> <span class="n">title</span><span class="o">(</span><span class="s1">&#39;Query Users&#39;</span><span class="o">)</span> <span class="o">}</span>
    <span class="n">body</span><span class="o">{</span>
        <span class="n">h1</span><span class="o">(</span><span class="s1">&#39;Search&#39;</span><span class="o">)</span>
        <span class="n">form</span><span class="o">{</span>
            <span class="n">p</span><span class="o">(</span><span class="s1">&#39;Which User?&#39;</span><span class="o">)</span>
            <span class="n">input</span><span class="o">(</span><span class="nl">type:</span><span class="s1">&#39;text&#39;</span><span class="o">,</span> <span class="nl">name:</span><span class="s1">&#39;WHO&#39;</span><span class="o">,</span> <span class="nl">value:</span><span class="n">name</span><span class="o">)</span>
            <span class="n">input</span><span class="o">(</span><span class="nl">type:</span><span class="s1">&#39;submit&#39;</span><span class="o">)</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">h1</span><span class="o">(</span><span class="s1">&#39;Results&#39;</span><span class="o">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">fakedWhoInput</span><span class="o">.</span><span class="na">grep</span><span class="o">(~</span><span class="s">/^$name\s.*/</span><span class="o">)</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">lines</span><span class="o">)</span> <span class="n">message</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="s1">&#39;\n&#39;</span><span class="o">)</span>
            <span class="k">else</span> <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;$name is not logged in&quot;</span>
            <span class="n">pre</span><span class="o">(</span><span class="n">message</span><span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">println</span> <span class="n">writer</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span>
<span class="c1">// if you need to escape special symbols, e.g. &#39;&lt;&#39; or &#39;&gt;&#39; use commons lang StringEscapeUtils</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_19.12</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// frameworks typically do this for you, but shown here are the manual steps</span>
<span class="c1">// even when doing it manually, you would probably use session variables</span>

<span class="c1">// setting a hidden field</span>
<span class="n">input</span><span class="o">(</span><span class="nl">type:</span><span class="s1">&#39;hidden&#39;</span><span class="o">,</span> <span class="nl">value:</span><span class="s1">&#39;bacon&#39;</span><span class="o">)</span>

<span class="c1">// setting a value on the submit</span>
<span class="n">input</span><span class="o">(</span><span class="nl">type:</span><span class="s1">&#39;submit&#39;</span><span class="o">,</span> <span class="nl">name:</span><span class="s2">&quot;.State&quot;</span><span class="o">,</span> <span class="nl">value:</span><span class="s1">&#39;Checkout&#39;</span><span class="o">)</span>

<span class="c1">// determining &#39;mode&#39;</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s1">&#39;.State&#39;</span><span class="o">)</span>
<span class="k">if</span> <span class="o">(!</span><span class="n">page</span><span class="o">)</span> <span class="n">page</span> <span class="o">=</span> <span class="s1">&#39;Default&#39;</span>

<span class="c1">// forking with if chain</span>
<span class="k">if</span> <span class="o">(</span><span class="n">page</span> <span class="o">==</span> <span class="s2">&quot;Default&quot;</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">frontPage</span><span class="o">()</span>
<span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">page</span> <span class="o">==</span> <span class="s2">&quot;Checkout&quot;</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">checkout</span><span class="o">()</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">noSuchPage</span><span class="o">()</span>
<span class="o">}</span>

<span class="c1">// forking with map</span>
<span class="n">states</span> <span class="o">=</span> <span class="o">[</span>
    <span class="nl">Default:</span>  <span class="k">this</span><span class="o">.&amp;</span><span class="n">frontPage</span><span class="o">,</span>
    <span class="nl">Shirt:</span>    <span class="k">this</span><span class="o">.&amp;</span><span class="n">tShirt</span><span class="o">,</span>
    <span class="nl">Sweater:</span>  <span class="k">this</span><span class="o">.&amp;</span><span class="n">sweater</span><span class="o">,</span>
    <span class="nl">Checkout:</span> <span class="k">this</span><span class="o">.&amp;</span><span class="n">checkout</span><span class="o">,</span>
    <span class="nl">Card:</span>     <span class="k">this</span><span class="o">.&amp;</span><span class="n">creditCard</span><span class="o">,</span>
    <span class="nl">Order:</span>    <span class="k">this</span><span class="o">.&amp;</span><span class="n">order</span><span class="o">,</span>
    <span class="nl">Cancel:</span>   <span class="k">this</span><span class="o">.&amp;</span><span class="n">frontPage</span><span class="o">,</span>
<span class="o">]</span>

<span class="c1">// calling each to allow hidden variable saving</span>
<span class="n">states</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">key</span><span class="o">,</span> <span class="n">closure</span> <span class="o">-&gt;</span>
    <span class="n">closure</span><span class="o">(</span><span class="n">page</span> <span class="o">==</span> <span class="n">key</span><span class="o">)</span>
<span class="o">}</span>

<span class="c1">// exemplar method</span>
<span class="kt">def</span> <span class="nf">tShirt</span><span class="o">(</span><span class="n">active</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">sizes</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;XL&#39;</span><span class="o">,</span> <span class="s1">&#39;L&#39;</span><span class="o">,</span> <span class="s1">&#39;M&#39;</span><span class="o">,</span> <span class="s1">&#39;S&#39;</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">colors</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;Black&#39;</span><span class="o">,</span> <span class="s1">&#39;White&#39;</span><span class="o">]</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">active</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">hidden</span><span class="o">(</span><span class="s2">&quot;size&quot;</span><span class="o">)</span>
        <span class="n">hidden</span><span class="o">(</span><span class="s2">&quot;color&quot;</span><span class="o">)</span>
        <span class="k">return</span>
    <span class="o">}</span>
    <span class="n">p</span><span class="o">(</span><span class="s2">&quot;You want to buy a t-shirt?&quot;</span><span class="o">);</span>
    <span class="n">label</span><span class="o">(</span><span class="s2">&quot;Size:  &quot;</span><span class="o">);</span>     <span class="n">dropDown</span><span class="o">(</span><span class="s2">&quot;size&quot;</span><span class="o">,</span> <span class="n">sizes</span><span class="o">)</span>
    <span class="n">label</span><span class="o">(</span><span class="s2">&quot;Color: &quot;</span><span class="o">);</span>     <span class="n">dropDown</span><span class="o">(</span><span class="s2">&quot;color&quot;</span><span class="o">,</span> <span class="n">colors</span><span class="o">)</span>
    <span class="n">shopMenu</span><span class="o">()</span>
<span class="o">}</span>

<span class="c1">// kicking off processing</span>
<span class="n">html</span><span class="o">{</span>
    <span class="n">head</span><span class="o">{</span> <span class="n">title</span><span class="o">(</span><span class="s1">&#39;chemiserie store&#39;</span><span class="o">)</span> <span class="o">}</span>
    <span class="n">body</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">states</span><span class="o">[</span><span class="n">page</span><span class="o">])</span> <span class="n">process</span><span class="o">(</span><span class="n">page</span><span class="o">)</span>
        <span class="k">else</span> <span class="nf">noSuchPage</span><span class="o">()</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_19.13</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// get request parameters as map</span>
<span class="n">map</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">parameterMap</span>

<span class="c1">// save to file</span>
<span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">filename</span><span class="o">).</span><span class="na">withOutputStream</span><span class="o">{</span> <span class="n">fos</span> <span class="o">-&gt;</span>
    <span class="n">oos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObjectOutputStream</span><span class="o">(</span><span class="n">fos</span><span class="o">)</span>
    <span class="n">oos</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="n">map</span><span class="o">)</span>
    <span class="n">oos</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="o">}</span>

<span class="c1">// convert to text</span>
<span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">()</span>
<span class="n">map</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">k</span><span class="o">,</span><span class="n">v</span> <span class="o">-&gt;</span> <span class="n">sb</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;$k=$v&quot;</span> <span class="o">}</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span>
<span class="c1">// to send text via email, see 18.3</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_19.14</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// you wouldn&#39;t normally do it this way, consider a framework like Grails</span>
<span class="c1">// even when doing it by hand, you would probably use session variables</span>
<span class="kn">import</span> <span class="nn">groovy.xml.MarkupBuilder</span>

<span class="n">page</span> <span class="o">=</span> <span class="n">param</span><span class="o">(</span><span class="s1">&#39;.State&#39;</span><span class="o">,</span> <span class="s1">&#39;Default&#39;</span><span class="o">)</span>

<span class="n">states</span> <span class="o">=</span> <span class="o">[</span>
    <span class="nl">Default:</span>  <span class="k">this</span><span class="o">.&amp;</span><span class="n">frontPage</span><span class="o">,</span>
    <span class="nl">Shirt:</span>    <span class="k">this</span><span class="o">.&amp;</span><span class="n">shirt</span><span class="o">,</span>
    <span class="nl">Sweater:</span>  <span class="k">this</span><span class="o">.&amp;</span><span class="n">sweater</span><span class="o">,</span>
    <span class="nl">Checkout:</span> <span class="k">this</span><span class="o">.&amp;</span><span class="n">checkout</span><span class="o">,</span>
    <span class="nl">Card:</span>     <span class="k">this</span><span class="o">.&amp;</span><span class="n">creditCard</span><span class="o">,</span>
    <span class="nl">Order:</span>    <span class="k">this</span><span class="o">.&amp;</span><span class="n">order</span><span class="o">,</span>
    <span class="nl">Cancel:</span>   <span class="k">this</span><span class="o">.&amp;</span><span class="n">frontPage</span><span class="o">,</span>
<span class="o">]</span>

<span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringWriter</span><span class="o">()</span>
<span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MarkupBuilder</span><span class="o">(</span><span class="n">writer</span><span class="o">)</span>
<span class="n">b</span><span class="o">.</span><span class="na">html</span><span class="o">{</span>
    <span class="n">head</span><span class="o">{</span> <span class="n">title</span><span class="o">(</span><span class="s1">&#39;chemiserie store&#39;</span><span class="o">)</span> <span class="o">}</span>
    <span class="n">body</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">states</span><span class="o">[</span><span class="n">page</span><span class="o">])</span> <span class="n">process</span><span class="o">(</span><span class="n">page</span><span class="o">)</span>
        <span class="k">else</span> <span class="nf">noSuchPage</span><span class="o">()</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">println</span> <span class="n">writer</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span>

<span class="kt">def</span> <span class="nf">process</span><span class="o">(</span><span class="n">page</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">b</span><span class="o">.</span><span class="na">form</span><span class="o">{</span>
        <span class="n">states</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">key</span><span class="o">,</span> <span class="n">closure</span> <span class="o">-&gt;</span>
            <span class="n">closure</span><span class="o">(</span><span class="n">page</span> <span class="o">==</span> <span class="n">key</span><span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">noSuchPage</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">b</span><span class="o">.</span><span class="na">p</span><span class="o">(</span><span class="s1">&#39;Unknown request&#39;</span><span class="o">)</span>
    <span class="n">reset</span><span class="o">(</span><span class="s1">&#39;Click here to start over&#39;</span><span class="o">)</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">shopMenu</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">b</span><span class="o">.</span><span class="na">p</span><span class="o">()</span>
    <span class="n">toPage</span><span class="o">(</span><span class="s2">&quot;Shirt&quot;</span><span class="o">)</span>
    <span class="n">toPage</span><span class="o">(</span><span class="s2">&quot;Sweater&quot;</span><span class="o">)</span>
    <span class="n">toPage</span><span class="o">(</span><span class="s2">&quot;Checkout&quot;</span><span class="o">)</span>
    <span class="n">reset</span><span class="o">(</span><span class="s1">&#39;Empty My Shopping Cart&#39;</span><span class="o">)</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">frontPage</span><span class="o">(</span><span class="n">active</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">active</span><span class="o">)</span> <span class="k">return</span>
    <span class="n">b</span><span class="o">.</span><span class="na">h1</span><span class="o">(</span><span class="s1">&#39;Hi!&#39;</span><span class="o">)</span>
    <span class="n">b</span><span class="o">.</span><span class="na">p</span><span class="o">(</span><span class="s1">&#39;Welcome to our Shirt Shop! Please make your selection from the menu below.&#39;</span><span class="o">)</span>
    <span class="n">shopMenu</span><span class="o">()</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">shirt</span><span class="o">(</span><span class="n">active</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">sizes</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;XL&#39;</span><span class="o">,</span> <span class="s1">&#39;L&#39;</span><span class="o">,</span> <span class="s1">&#39;M&#39;</span><span class="o">,</span> <span class="s1">&#39;S&#39;</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">colors</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;Black&#39;</span><span class="o">,</span> <span class="s1">&#39;White&#39;</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">count</span> <span class="o">=</span> <span class="n">param</span><span class="o">(</span><span class="s1">&#39;shirt_count&#39;</span><span class="o">,</span><span class="mi">0</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">color</span> <span class="o">=</span> <span class="n">param</span><span class="o">(</span><span class="s1">&#39;shirt_color&#39;</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">size</span> <span class="o">=</span> <span class="n">param</span><span class="o">(</span><span class="s1">&#39;shirt_size&#39;</span><span class="o">)</span>
    <span class="c1">// sanity check</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">count</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!(</span><span class="n">color</span> <span class="k">in</span> <span class="n">colors</span><span class="o">))</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
        <span class="k">if</span> <span class="o">(!(</span><span class="n">size</span> <span class="k">in</span> <span class="n">sizes</span><span class="o">))</span> <span class="n">size</span> <span class="o">=</span> <span class="n">sizes</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">active</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">size</span><span class="o">)</span> <span class="n">hidden</span><span class="o">(</span><span class="s2">&quot;shirt_size&quot;</span><span class="o">,</span> <span class="n">size</span><span class="o">)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">color</span><span class="o">)</span> <span class="n">hidden</span><span class="o">(</span><span class="s2">&quot;shirt_color&quot;</span><span class="o">,</span> <span class="n">color</span><span class="o">)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">count</span><span class="o">)</span> <span class="n">hidden</span><span class="o">(</span><span class="s2">&quot;shirt_count&quot;</span><span class="o">,</span> <span class="n">count</span><span class="o">)</span>
        <span class="k">return</span>
    <span class="o">}</span>
    <span class="n">b</span><span class="o">.</span><span class="na">h1</span> <span class="s1">&#39;T-Shirt&#39;</span>
    <span class="n">b</span><span class="o">.</span><span class="na">p</span> <span class="s1">&#39;&#39;&#39;What a shirt! This baby is decked out with all the options.</span>
<span class="s1">        It comes with full luxury interior, cotton trim, and a collar</span>
<span class="s1">        to make your eyes water! Unit price: $33.00&#39;&#39;&#39;</span>
    <span class="n">b</span><span class="o">.</span><span class="na">h2</span> <span class="s1">&#39;Options&#39;</span>
    <span class="n">label</span><span class="o">(</span><span class="s2">&quot;How Many?&quot;</span><span class="o">);</span>  <span class="n">textfield</span><span class="o">(</span><span class="s2">&quot;shirt_count&quot;</span><span class="o">)</span>
    <span class="n">label</span><span class="o">(</span><span class="s2">&quot;Size?&quot;</span><span class="o">);</span>      <span class="n">dropDown</span><span class="o">(</span><span class="s2">&quot;shirt_size&quot;</span><span class="o">,</span> <span class="n">sizes</span><span class="o">)</span>
    <span class="n">label</span><span class="o">(</span><span class="s2">&quot;Color?&quot;</span><span class="o">);</span>     <span class="n">dropDown</span><span class="o">(</span><span class="s2">&quot;shirt_color&quot;</span><span class="o">,</span> <span class="n">colors</span><span class="o">)</span>
    <span class="n">shopMenu</span><span class="o">()</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">sweater</span><span class="o">(</span><span class="n">active</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">sizes</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;XL&#39;</span><span class="o">,</span> <span class="s1">&#39;L&#39;</span><span class="o">,</span> <span class="s1">&#39;M&#39;</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">colors</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;Chartreuse&#39;</span><span class="o">,</span> <span class="s1">&#39;Puce&#39;</span><span class="o">,</span> <span class="s1">&#39;Lavender&#39;</span><span class="o">]</span>
    <span class="kt">def</span> <span class="n">count</span> <span class="o">=</span> <span class="n">param</span><span class="o">(</span><span class="s1">&#39;sweater_count&#39;</span><span class="o">,</span><span class="mi">0</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">color</span> <span class="o">=</span> <span class="n">param</span><span class="o">(</span><span class="s1">&#39;sweater_color&#39;</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">size</span> <span class="o">=</span> <span class="n">param</span><span class="o">(</span><span class="s1">&#39;sweater_size&#39;</span><span class="o">)</span>
    <span class="c1">// sanity check</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">count</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!(</span><span class="n">color</span> <span class="k">in</span> <span class="n">colors</span><span class="o">))</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
        <span class="k">if</span> <span class="o">(!(</span><span class="n">size</span> <span class="k">in</span> <span class="n">sizes</span><span class="o">))</span> <span class="n">size</span> <span class="o">=</span> <span class="n">sizes</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">active</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">size</span><span class="o">)</span> <span class="n">hidden</span><span class="o">(</span><span class="s2">&quot;sweater_size&quot;</span><span class="o">,</span> <span class="n">size</span><span class="o">)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">color</span><span class="o">)</span> <span class="n">hidden</span><span class="o">(</span><span class="s2">&quot;sweater_color&quot;</span><span class="o">,</span> <span class="n">color</span><span class="o">)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">count</span><span class="o">)</span> <span class="n">hidden</span><span class="o">(</span><span class="s2">&quot;sweater_count&quot;</span><span class="o">,</span> <span class="n">count</span><span class="o">)</span>
        <span class="k">return</span>
    <span class="o">}</span>
    <span class="n">b</span><span class="o">.</span><span class="na">h1</span><span class="o">(</span><span class="s2">&quot;Sweater&quot;</span><span class="o">)</span>
    <span class="n">b</span><span class="o">.</span><span class="na">p</span><span class="o">(</span><span class="s2">&quot;Nothing implies preppy elegance more than this fine &quot;</span> <span class="o">+</span>
        <span class="s2">&quot;sweater. Made by peasant workers from black market silk, &quot;</span> <span class="o">+</span>
        <span class="s2">&quot;it slides onto your lean form and cries out ``Take me, &quot;</span> <span class="o">+</span>
        <span class="s2">&quot;for I am a god!&#39;&#39;. Unit price: \$49.99.&quot;</span><span class="o">)</span>
    <span class="n">b</span><span class="o">.</span><span class="na">h2</span><span class="o">(</span><span class="s2">&quot;Options&quot;</span><span class="o">)</span>
    <span class="n">label</span><span class="o">(</span><span class="s2">&quot;How Many?&quot;</span><span class="o">);</span> <span class="n">textfield</span><span class="o">(</span><span class="s2">&quot;sweater_count&quot;</span><span class="o">)</span>
    <span class="n">label</span><span class="o">(</span><span class="s2">&quot;Size?&quot;</span><span class="o">);</span> <span class="n">dropDown</span><span class="o">(</span><span class="s2">&quot;sweater_size&quot;</span><span class="o">,</span> <span class="n">sizes</span><span class="o">)</span>
    <span class="n">label</span><span class="o">(</span><span class="s2">&quot;Color?&quot;</span><span class="o">);</span> <span class="n">dropDown</span><span class="o">(</span><span class="s2">&quot;sweater_color&quot;</span><span class="o">,</span> <span class="n">colors</span><span class="o">)</span>
    <span class="n">shopMenu</span><span class="o">()</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">checkout</span><span class="o">(</span><span class="n">active</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">active</span><span class="o">)</span> <span class="k">return</span>
    <span class="n">b</span><span class="o">.</span><span class="na">h1</span><span class="o">(</span><span class="s2">&quot;Order Confirmation&quot;</span><span class="o">)</span>
    <span class="n">b</span><span class="o">.</span><span class="na">p</span><span class="o">(</span><span class="s2">&quot;You ordered the following:&quot;</span><span class="o">)</span>
    <span class="n">orderText</span><span class="o">()</span>
    <span class="n">b</span><span class="o">.</span><span class="na">p</span><span class="o">(</span><span class="s2">&quot;Is this right? Select &#39;Card&#39; to pay for the items&quot;</span> <span class="o">+</span>
        <span class="s2">&quot;or &#39;Shirt&#39; or &#39;Sweater&#39; to continue shopping.&quot;</span><span class="o">)</span>
    <span class="n">toPage</span><span class="o">(</span><span class="s2">&quot;Card&quot;</span><span class="o">)</span>
    <span class="n">toPage</span><span class="o">(</span><span class="s2">&quot;Shirt&quot;</span><span class="o">)</span>
    <span class="n">toPage</span><span class="o">(</span><span class="s2">&quot;Sweater&quot;</span><span class="o">)</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">creditCard</span><span class="o">(</span><span class="n">active</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">widgets</span> <span class="o">=</span> <span class="s1">&#39;Name Address1 Address2 City Zip State Phone Card Expiry&#39;</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s1">&#39; &#39;</span><span class="o">)</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">active</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">widgets</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">hidden</span><span class="o">(</span><span class="n">it</span><span class="o">)</span> <span class="o">}</span>
        <span class="k">return</span>
    <span class="o">}</span>
    <span class="n">b</span><span class="o">.</span><span class="na">pre</span><span class="o">{</span>
        <span class="n">label</span><span class="o">(</span><span class="s2">&quot;Name: &quot;</span><span class="o">);</span>          <span class="n">textfield</span><span class="o">(</span><span class="s2">&quot;Name&quot;</span><span class="o">)</span>
        <span class="n">label</span><span class="o">(</span><span class="s2">&quot;Address: &quot;</span><span class="o">);</span>       <span class="n">textfield</span><span class="o">(</span><span class="s2">&quot;Address1&quot;</span><span class="o">)</span>
        <span class="n">label</span><span class="o">(</span><span class="s2">&quot; &quot;</span><span class="o">);</span>               <span class="n">textfield</span><span class="o">(</span><span class="s2">&quot;Address2&quot;</span><span class="o">)</span>
        <span class="n">label</span><span class="o">(</span><span class="s2">&quot;City: &quot;</span><span class="o">);</span>          <span class="n">textfield</span><span class="o">(</span><span class="s2">&quot;City&quot;</span><span class="o">)</span>
        <span class="n">label</span><span class="o">(</span><span class="s2">&quot;Zip: &quot;</span><span class="o">);</span>           <span class="n">textfield</span><span class="o">(</span><span class="s2">&quot;Zip&quot;</span><span class="o">)</span>
        <span class="n">label</span><span class="o">(</span><span class="s2">&quot;State: &quot;</span><span class="o">);</span>         <span class="n">textfield</span><span class="o">(</span><span class="s2">&quot;State&quot;</span><span class="o">)</span>
        <span class="n">label</span><span class="o">(</span><span class="s2">&quot;Phone: &quot;</span><span class="o">);</span>         <span class="n">textfield</span><span class="o">(</span><span class="s2">&quot;Phone&quot;</span><span class="o">)</span>
        <span class="n">label</span><span class="o">(</span><span class="s2">&quot;Credit Card #: &quot;</span><span class="o">);</span> <span class="n">textfield</span><span class="o">(</span><span class="s2">&quot;Card&quot;</span><span class="o">)</span>
        <span class="n">label</span><span class="o">(</span><span class="s2">&quot;Expiry: &quot;</span><span class="o">);</span>        <span class="n">textfield</span><span class="o">(</span><span class="s2">&quot;Expiry&quot;</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="n">b</span><span class="o">.</span><span class="na">p</span><span class="o">(</span><span class="s2">&quot;Click on &#39;Order&#39; to order the items. Click on &#39;Cancel&#39; to return shopping.&quot;</span><span class="o">)</span>
    <span class="n">toPage</span><span class="o">(</span><span class="s2">&quot;Order&quot;</span><span class="o">)</span>
    <span class="n">toPage</span><span class="o">(</span><span class="s2">&quot;Cancel&quot;</span><span class="o">)</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">order</span><span class="o">(</span><span class="n">active</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">active</span><span class="o">)</span> <span class="k">return</span>
    <span class="n">b</span><span class="o">.</span><span class="na">h1</span><span class="o">(</span><span class="s2">&quot;Ordered!&quot;</span><span class="o">)</span>
    <span class="n">b</span><span class="o">.</span><span class="na">p</span><span class="o">(</span><span class="s2">&quot;You have ordered the following items:&quot;</span><span class="o">)</span>
    <span class="n">orderText</span><span class="o">()</span>
    <span class="n">reset</span><span class="o">(</span><span class="s1">&#39;Begin Again&#39;</span><span class="o">)</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">orderText</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">shirts</span> <span class="o">=</span> <span class="n">param</span><span class="o">(</span><span class="s1">&#39;shirt_count&#39;</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">sweaters</span> <span class="o">=</span> <span class="n">param</span><span class="o">(</span><span class="s1">&#39;sweater_count&#39;</span><span class="o">)</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">shirts</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">b</span><span class="o">.</span><span class="na">p</span><span class="o">(</span><span class="s2">&quot;&quot;&quot;You have ordered ${param(&#39;shirt_count&#39;)}</span>
<span class="s2">            shirts of size ${param(&#39;shirt_size&#39;)}</span>
<span class="s2">            and color ${param(&quot;</span><span class="n">shirt_color</span><span class="s2">&quot;)}.&quot;&quot;&quot;</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">sweaters</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">b</span><span class="o">.</span><span class="na">p</span><span class="o">(</span><span class="s2">&quot;&quot;&quot;You have ordered ${param(&#39;sweater_count&#39;)}</span>
<span class="s2">        sweaters of size ${param(&#39;sweater_size&#39;)}</span>
<span class="s2">        and color ${param(&#39;sweater_color&#39;)}.&quot;&quot;&quot;</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">sweaters</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">shirts</span><span class="o">)</span> <span class="n">b</span><span class="o">.</span><span class="na">p</span><span class="o">(</span><span class="s2">&quot;Nothing!&quot;</span><span class="o">)</span>
    <span class="n">b</span><span class="o">.</span><span class="na">p</span><span class="o">(</span><span class="s2">&quot;For a total cost of ${calcPrice()}&quot;</span><span class="o">)</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">label</span><span class="o">(</span><span class="n">text</span><span class="o">)</span> <span class="o">{</span> <span class="n">b</span><span class="o">.</span><span class="na">span</span><span class="o">(</span><span class="n">text</span><span class="o">)</span> <span class="o">}</span>
<span class="kt">def</span> <span class="nf">reset</span><span class="o">(</span><span class="n">text</span><span class="o">)</span> <span class="o">{</span> <span class="n">b</span><span class="o">.</span><span class="na">a</span><span class="o">(</span><span class="nl">href:</span><span class="n">request</span><span class="o">.</span><span class="na">requestURI</span><span class="o">,</span><span class="n">text</span><span class="o">)</span> <span class="o">}</span>
<span class="kt">def</span> <span class="nf">toPage</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">{</span> <span class="n">b</span><span class="o">.</span><span class="na">input</span><span class="o">(</span><span class="nl">type:</span><span class="s1">&#39;submit&#39;</span><span class="o">,</span> <span class="nl">name:</span><span class="s1">&#39;.State&#39;</span><span class="o">,</span> <span class="nl">value:</span><span class="n">name</span><span class="o">)</span> <span class="o">}</span>
<span class="kt">def</span> <span class="nf">dropDown</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">values</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">b</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="nl">name:</span><span class="n">name</span><span class="o">){</span>
        <span class="n">values</span><span class="o">.</span><span class="na">each</span><span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">param</span><span class="o">(</span><span class="n">name</span><span class="o">)==</span><span class="n">it</span><span class="o">)</span> <span class="n">option</span><span class="o">(</span><span class="nl">value:</span><span class="n">it</span><span class="o">,</span> <span class="nl">selected:</span><span class="kc">true</span><span class="o">,</span> <span class="n">it</span><span class="o">)</span>
            <span class="k">else</span> <span class="nf">option</span><span class="o">(</span><span class="nl">value:</span><span class="n">it</span><span class="o">,</span> <span class="n">it</span><span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">b</span><span class="o">.</span><span class="na">br</span><span class="o">()</span>
<span class="o">}</span>
<span class="kt">def</span> <span class="nf">hidden</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">binding</span><span class="o">.</span><span class="na">variables</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">name</span><span class="o">))</span> <span class="n">v</span> <span class="o">=</span> <span class="n">binding</span><span class="o">[</span><span class="n">name</span><span class="o">]</span>
    <span class="k">else</span> <span class="n">v</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">hidden</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span>
<span class="o">}</span>
<span class="kt">def</span> <span class="nf">hidden</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="n">b</span><span class="o">.</span><span class="na">input</span><span class="o">(</span><span class="nl">type:</span><span class="s1">&#39;hidden&#39;</span><span class="o">,</span> <span class="nl">name:</span><span class="n">name</span><span class="o">,</span> <span class="nl">value:</span><span class="n">value</span><span class="o">)</span> <span class="o">}</span>
<span class="kt">def</span> <span class="nf">textfield</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">{</span> <span class="n">b</span><span class="o">.</span><span class="na">input</span><span class="o">(</span><span class="nl">type:</span><span class="s1">&#39;text&#39;</span><span class="o">,</span> <span class="nl">name:</span><span class="n">name</span><span class="o">,</span> <span class="nl">value:</span><span class="n">param</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="s1">&#39;&#39;</span><span class="o">));</span> <span class="n">b</span><span class="o">.</span><span class="na">br</span><span class="o">()</span> <span class="o">}</span>
<span class="kt">def</span> <span class="nf">param</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">{</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">}</span>
<span class="kt">def</span> <span class="nf">param</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">defValue</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">val</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="n">name</span><span class="o">)</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">val</span><span class="o">)</span> <span class="k">return</span> <span class="n">val</span> <span class="k">else</span> <span class="k">return</span> <span class="n">defValue</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">calcPrice</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">shirts</span> <span class="o">=</span> <span class="n">param</span><span class="o">(</span><span class="s1">&#39;shirt_count&#39;</span><span class="o">,</span> <span class="mi">0</span><span class="o">).</span><span class="na">toInteger</span><span class="o">()</span>
    <span class="kt">def</span> <span class="n">sweaters</span> <span class="o">=</span> <span class="n">param</span><span class="o">(</span><span class="s1">&#39;sweater_count&#39;</span><span class="o">,</span> <span class="mi">0</span><span class="o">).</span><span class="na">toInteger</span><span class="o">()</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">shirts</span> <span class="o">*</span> <span class="mi">33</span> <span class="o">+</span> <span class="n">sweaters</span> <span class="o">*</span> <span class="mf">49.99</span><span class="o">).</span><span class="na">toString</span><span class="o">()</span>
<span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_20.0</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Many packages are available for simulating a browser. A good starting point:</span>
<span class="c1">// http://groovy.codehaus.org/Testing+Web+Applications</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_20.1</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// for non-binary content</span>
<span class="n">urlStr</span> <span class="o">=</span> <span class="s1">&#39;http://groovy.codehaus.org&#39;</span>
<span class="n">content</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">urlStr</span><span class="o">).</span><span class="na">text</span>
<span class="n">println</span> <span class="n">content</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="c1">// =&gt; 34824</span>

<span class="c1">// for binary content</span>
<span class="n">urlStr</span> <span class="o">=</span> <span class="s1">&#39;http://groovy.codehaus.org/download/attachments/1871/gina_3d.gif&#39;</span>
<span class="n">bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">()</span>
<span class="n">bytes</span> <span class="o">&lt;&lt;</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">urlStr</span><span class="o">).</span><span class="na">openStream</span><span class="o">()</span>
<span class="n">println</span> <span class="n">bytes</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="c1">// =&gt; 6066</span>

<span class="c1">// various forms of potential error checking</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="k">new</span> <span class="nf">URL</span><span class="o">(</span><span class="s1">&#39;x:y:z&#39;</span><span class="o">)</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">MalformedURLException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">println</span> <span class="n">ex</span><span class="o">.</span><span class="na">message</span> <span class="c1">// =&gt; unknown protocol: x</span>
<span class="o">}</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="k">new</span> <span class="nf">URL</span><span class="o">(</span><span class="s1">&#39;cnn.com/not.there&#39;</span><span class="o">)</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">MalformedURLException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">println</span> <span class="n">ex</span><span class="o">.</span><span class="na">message</span> <span class="c1">// =&gt; no protocol: cnn.com/not.there</span>
<span class="o">}</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">content</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s1">&#39;http://cnn.com/not.there&#39;</span><span class="o">).</span><span class="na">text</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">FileNotFoundException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s2">&quot;Couldn&#39;t find: &quot;</span> <span class="o">+</span> <span class="n">ex</span><span class="o">.</span><span class="na">message</span>
    <span class="c1">// =&gt; Couldn&#39;t find: http://www.cnn.com/not.there</span>
<span class="o">}</span>

<span class="c1">// titleBytes example</span>
<span class="kt">def</span> <span class="nf">titleBytes</span><span class="o">(</span><span class="n">urlStr</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">lineCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="kt">def</span> <span class="n">byteCount</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">new</span> <span class="nf">URL</span><span class="o">(</span><span class="n">urlStr</span><span class="o">).</span><span class="na">eachLine</span><span class="o">{</span> <span class="n">line</span> <span class="o">-&gt;</span>
        <span class="n">lineCount</span><span class="o">++;</span> <span class="n">byteCount</span> <span class="o">+=</span> <span class="n">line</span><span class="o">.</span><span class="na">size</span><span class="o">()</span>
    <span class="o">}</span>
    <span class="n">println</span> <span class="s2">&quot;$urlStr =&gt; ($lineCount lines, $byteCount bytes)&quot;</span>
<span class="o">}</span>
<span class="n">titleBytes</span><span class="o">(</span><span class="s1">&#39;http://www.tpj.com/&#39;</span><span class="o">)</span>
<span class="c1">// http://www.tpj.com/ =&gt; (677 lines, 25503 bytes)</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_20.2</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// using HtmlUnit (htmlunit.sf.net)</span>
<span class="kn">import</span> <span class="nn">com.gargoylesoftware.htmlunit.WebClient</span>

<span class="kt">def</span> <span class="n">webClient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WebClient</span><span class="o">()</span>
<span class="kt">def</span> <span class="n">page</span> <span class="o">=</span> <span class="n">webClient</span><span class="o">.</span><span class="na">getPage</span><span class="o">(</span><span class="s1">&#39;http://search.cpan.org/&#39;</span><span class="o">)</span>
<span class="c1">// check page title</span>
<span class="k">assert</span> <span class="n">page</span><span class="o">.</span><span class="na">titleText</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s1">&#39;The CPAN Search Site&#39;</span><span class="o">)</span>
<span class="c1">// fill in form and submit it</span>
<span class="kt">def</span> <span class="n">form</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="na">getFormByName</span><span class="o">(</span><span class="s1">&#39;f&#39;</span><span class="o">)</span>
<span class="kt">def</span> <span class="n">field</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="na">getInputByName</span><span class="o">(</span><span class="s1">&#39;query&#39;</span><span class="o">)</span>
<span class="n">field</span><span class="o">.</span><span class="na">setValueAttribute</span><span class="o">(</span><span class="s1">&#39;DB_File&#39;</span><span class="o">)</span>
<span class="kt">def</span> <span class="n">button</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="na">getInputByValue</span><span class="o">(</span><span class="s1">&#39;CPAN Search&#39;</span><span class="o">)</span>
<span class="kt">def</span> <span class="n">result</span> <span class="o">=</span> <span class="n">button</span><span class="o">.</span><span class="na">click</span><span class="o">()</span>
<span class="c1">// check search result has at least one link ending in DB_File.pm</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="na">anchors</span><span class="o">.</span><span class="na">any</span><span class="o">{</span> <span class="n">a</span> <span class="o">-&gt;</span> <span class="n">a</span><span class="o">.</span><span class="na">hrefAttribute</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s1">&#39;DB_File.pm&#39;</span><span class="o">)</span> <span class="o">}</span>

<span class="c1">// fields must be properly escaped</span>
<span class="n">println</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="s">/&quot;this isn&#39;t &lt;EASY&gt;&amp;&lt;FUN&gt;&quot;/</span><span class="o">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="o">)</span>
<span class="c1">// =&gt; %22this+isn%27t+%3CEASY%3E%26%3CFUN%3E%22</span>

<span class="c1">// proxies can be taken from environment, or specified</span>
<span class="c1">//System.properties.putAll( [&quot;http.proxyHost&quot;:&quot;proxy-host&quot;, &quot;http.proxyPort&quot;:&quot;proxy-port&quot;,</span>
<span class="c1">//    &quot;http.proxyUserName&quot;:&quot;user-name&quot;, &quot;http.proxyPassword&quot;:&quot;proxy-passwd&quot;] )</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_20.3</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// using HtmlUnit (htmlunit.sf.net)</span>
<span class="kn">import</span> <span class="nn">com.gargoylesoftware.htmlunit.WebClient</span>

<span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WebClient</span><span class="o">()</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">getPage</span><span class="o">(</span><span class="s1">&#39;http://www.perl.com/CPAN/&#39;</span><span class="o">)</span>
<span class="n">println</span> <span class="n">page</span><span class="o">.</span><span class="na">anchors</span><span class="o">.</span><span class="na">collect</span><span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">hrefAttribute</span> <span class="o">}.</span><span class="na">sort</span><span class="o">().</span><span class="na">unique</span><span class="o">().</span><span class="na">join</span><span class="o">(</span><span class="s1">&#39;\n&#39;</span><span class="o">)</span>
<span class="c1">// =&gt;</span>
<span class="c1">// disclaimer.html</span>
<span class="c1">// http://bookmarks.cpan.org/</span>
<span class="c1">// http://faq.perl.org/</span>
<span class="c1">// mailto:cpan@perl.org</span>
<span class="c1">// ...</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_20.4</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// split paragraphs</span>
<span class="n">LS</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">properties</span><span class="o">.</span><span class="s1">&#39;line.separator&#39;</span>
<span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]).</span><span class="na">text</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s2">&quot;$LS$LS&quot;</span><span class="o">).</span><span class="na">each</span><span class="o">{</span> <span class="n">para</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">para</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s2">&quot; &quot;</span><span class="o">))</span> <span class="n">println</span> <span class="s2">&quot;&lt;pre&gt;\n$para\n&lt;/pre&gt;&quot;</span>
    <span class="k">else</span> <span class="o">{</span>
        <span class="n">para</span> <span class="o">=</span> <span class="n">para</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">/(?m)^(&gt;.*?)$/</span><span class="o">,</span> <span class="s">/$1&lt;br \/</span><span class="o">&gt;</span><span class="s">/)            // quoted text</span>
<span class="s">        para = para.replaceAll(/</span><span class="o">&lt;</span><span class="nl">URL:</span><span class="o">(.*)&gt;</span><span class="s">/, /</span><span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;$1&quot;</span><span class="o">&gt;</span><span class="n">$1</span><span class="o">&lt;</span><span class="err">\</span><span class="s">/a&gt;/</span><span class="o">)</span>   <span class="c1">// embedded URL</span>
        <span class="n">para</span> <span class="o">=</span> <span class="n">para</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">/(http:\S+)/</span><span class="o">,</span> <span class="s">/&lt;a href=&quot;$1&quot;&gt;$1&lt;\/</span><span class="n">a</span><span class="o">&gt;</span><span class="s">/)   // guessed URL</span>
<span class="s">        para = para.replaceAll(&#39;\\*(\\S+)\\*&#39;, /</span><span class="o">&lt;</span><span class="n">strong</span><span class="o">&gt;</span><span class="n">$1</span><span class="o">&lt;</span><span class="err">\</span><span class="s">/strong&gt;/</span><span class="o">)</span> <span class="c1">// this is *bold* here</span>
        <span class="n">para</span> <span class="o">=</span> <span class="n">para</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">/\b_(\S+)_\b/</span><span class="o">,</span> <span class="s">/&lt;em&gt;$1&lt;\/</span><span class="n">em</span><span class="o">&gt;</span><span class="s">/)          // this is _italic_ here</span>
<span class="s">        println &quot;&lt;p&gt;\n$para\n&lt;/</span><span class="n">p</span><span class="o">&gt;</span><span class="s2">&quot;                                     // add paragraph tags</span>
<span class="s2">    }</span>
<span class="s2">}</span>

<span class="s2">def encodeEmail(email) {</span>
<span class="s2">    println &quot;</span><span class="o">&lt;</span><span class="n">table</span><span class="o">&gt;</span><span class="s2">&quot;</span>
<span class="s2">    email = URLEncoder.encode(email)</span>
<span class="s2">    email = text.replaceAll(/(\n[ \t]+)/, / . /)   // continuation lines</span>
<span class="s2">    email = text.replaceAll(/(?m)^(\S+?:)\s*(.*?)$/,</span>
<span class="s2">                  /&lt;tr&gt;&lt;th align=&quot;</span><span class="n">left</span><span class="s2">&quot;&gt;$1&lt;\/th&gt;&lt;td&gt;$2&lt;\/td&gt;&lt;\/tr&gt;/);</span>
<span class="s2">    println email</span>
<span class="s2">    println &quot;</span><span class="o">&lt;</span><span class="s">/table&gt;&quot;</span>
<span class="s">}</span>
<span class="s">//----------------------------------------------------------------------------------</span>


<span class="s">// @@PLEAC@@_20.5</span>
<span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// using CyberNeko Parser (people.apache.org/</span><span class="o">~</span><span class="n">andyc</span><span class="s">/neko/</span><span class="n">doc</span><span class="o">)</span>
<span class="n">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">org</span><span class="o">.</span><span class="na">cyberneko</span><span class="o">.</span><span class="na">html</span><span class="o">.</span><span class="na">parsers</span><span class="o">.</span><span class="na">SAXParser</span><span class="o">()</span>
<span class="n">parser</span><span class="o">.</span><span class="na">setFeature</span><span class="o">(</span><span class="s1">&#39;http://xml.org/sax/features/namespaces&#39;</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span>
<span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XmlParser</span><span class="o">(</span><span class="n">parser</span><span class="o">).</span><span class="na">parse</span><span class="o">(</span><span class="s1">&#39;http://www.perl.com/CPAN/&#39;</span><span class="o">)</span>
<span class="n">page</span><span class="o">.</span><span class="na">depthFirst</span><span class="o">().</span><span class="na">each</span><span class="o">{</span> <span class="n">println</span> <span class="n">it</span><span class="o">.</span><span class="na">text</span><span class="o">()</span> <span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_20.6</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// removing tags, see 20.5</span>

<span class="c1">// extracting tags: htitle using cyberneko and XmlSlurper</span>
<span class="n">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">org</span><span class="o">.</span><span class="na">cyberneko</span><span class="o">.</span><span class="na">html</span><span class="o">.</span><span class="na">parsers</span><span class="o">.</span><span class="na">SAXParser</span><span class="o">()</span>
<span class="n">parser</span><span class="o">.</span><span class="na">setFeature</span><span class="o">(</span><span class="s1">&#39;http://xml.org/sax/features/namespaces&#39;</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span>
<span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XmlParser</span><span class="o">(</span><span class="n">parser</span><span class="o">).</span><span class="na">parse</span><span class="o">(</span><span class="s1">&#39;http://www.perl.com/CPAN/&#39;</span><span class="o">)</span>
<span class="n">println</span> <span class="n">page</span><span class="o">.</span><span class="na">HEAD</span><span class="o">.</span><span class="na">TITLE</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">text</span><span class="o">()</span>

<span class="c1">// extracting tags: htitle using HtmlUnit</span>
<span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WebClient</span><span class="o">()</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">getPage</span><span class="o">(</span><span class="s1">&#39;http://www.perl.com/CPAN/&#39;</span><span class="o">)</span>
<span class="n">println</span> <span class="n">html</span><span class="o">.</span><span class="na">titleText</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_20.7</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="kn">import</span> <span class="nn">com.gargoylesoftware.htmlunit.WebClient</span>

<span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WebClient</span><span class="o">()</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">getPage</span><span class="o">(</span><span class="s1">&#39;http://www.perl.com/CPAN/&#39;</span><span class="o">)</span>
<span class="n">page</span><span class="o">.</span><span class="na">anchors</span><span class="o">.</span><span class="na">each</span><span class="o">{</span>
    <span class="n">checkUrl</span><span class="o">(</span><span class="n">page</span><span class="o">,</span> <span class="n">it</span><span class="o">.</span><span class="na">hrefAttribute</span><span class="o">)</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">checkUrl</span><span class="o">(</span><span class="n">page</span><span class="o">,</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">print</span> <span class="s2">&quot;$url &quot;</span>
        <span class="n">qurl</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="na">getFullyQualifiedUrl</span><span class="o">(</span><span class="n">url</span><span class="o">)</span>
        <span class="n">client</span><span class="o">.</span><span class="na">getPage</span><span class="o">(</span><span class="n">qurl</span><span class="o">)</span>
        <span class="n">println</span> <span class="s1">&#39;OK&#39;</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">println</span> <span class="s1">&#39;BAD&#39;</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// =&gt;</span>
<span class="c1">// modules/index.html OK</span>
<span class="c1">// RECENT.html OK</span>
<span class="c1">// http://search.cpan.org/recent OK</span>
<span class="c1">// http://mirrors.cpan.org/ OK</span>
<span class="c1">// http://perldoc.perl.org/ OK</span>
<span class="c1">// mailto:cpan@perl.org BAD</span>
<span class="c1">// http://www.csc.fi/suomi/funet/verkko.html.en/ BAD</span>
<span class="c1">// ...</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_20.8</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.httpclient.HttpClient</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.httpclient.methods.HeadMethod</span>
<span class="kn">import</span> <span class="nn">java.text.DateFormat</span>

<span class="n">urls</span> <span class="o">=</span> <span class="o">[</span>
    <span class="s2">&quot;http://www.apache.org/&quot;</span><span class="o">,</span>
    <span class="s2">&quot;http://www.perl.org/&quot;</span><span class="o">,</span>
    <span class="s2">&quot;http://www.python.org/&quot;</span><span class="o">,</span>
    <span class="s2">&quot;http://www.ora.com/&quot;</span><span class="o">,</span>
    <span class="s2">&quot;http://jakarta.apache.org/&quot;</span><span class="o">,</span>
    <span class="s2">&quot;http://www.w3.org/&quot;</span>
<span class="o">]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">DateFormat</span><span class="o">.</span><span class="na">getDateTimeInstance</span><span class="o">(</span><span class="n">DateFormat</span><span class="o">.</span><span class="na">FULL</span><span class="o">,</span> <span class="n">DateFormat</span><span class="o">.</span><span class="na">MEDIUM</span><span class="o">)</span>
<span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpClient</span><span class="o">()</span>
<span class="n">urlInfo</span> <span class="o">=</span> <span class="o">[:]</span>
<span class="n">urls</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">url</span> <span class="o">-&gt;</span>
    <span class="n">head</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HeadMethod</span><span class="o">(</span><span class="n">url</span><span class="o">)</span>
    <span class="n">client</span><span class="o">.</span><span class="na">executeMethod</span><span class="o">(</span><span class="n">head</span><span class="o">)</span>
    <span class="n">lastModified</span> <span class="o">=</span> <span class="n">head</span><span class="o">.</span><span class="na">getResponseHeader</span><span class="o">(</span><span class="s2">&quot;last-modified&quot;</span><span class="o">)?.</span><span class="na">value</span>
    <span class="n">urlInfo</span><span class="o">[</span><span class="n">df</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">lastModified</span><span class="o">)]=</span><span class="n">url</span>
<span class="o">}</span>

<span class="n">urlInfo</span><span class="o">.</span><span class="na">keySet</span><span class="o">().</span><span class="na">sort</span><span class="o">().</span><span class="na">each</span><span class="o">{</span> <span class="n">key</span> <span class="o">-&gt;</span>
    <span class="n">println</span> <span class="s2">&quot;$key ${urlInfo[key]}&quot;</span>
<span class="o">}</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Sun Jan 07 21:48:15 EST 2007 http://www.apache.org/</span>
<span class="c1">// Sat Jan 13 12:44:32 EST 2007 http://jakarta.apache.org/</span>
<span class="c1">// Fri Jan 19 14:50:13 EST 2007 http://www.w3.org/</span>
<span class="c1">// Fri Jan 19 19:28:35 EST 2007 http://www.python.org/</span>
<span class="c1">// Sat Jan 20 09:36:08 EST 2007 http://www.ora.com/</span>
<span class="c1">// Sat Jan 20 13:25:53 EST 2007 http://www.perl.org/</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_20.9</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// GString version (variables must be predefined):</span>
<span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;Tom&#39;</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">99</span>
<span class="n">total</span> <span class="o">=</span> <span class="mi">999</span>
<span class="n">htmlStr</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;!-- simple.template for internal template() function --&gt;</span>
<span class="s2">&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Report for $username&lt;/TITLE&gt;&lt;/HEAD&gt;</span>
<span class="s2">&lt;BODY&gt;&lt;H1&gt;Report for $username&lt;/H1&gt;</span>
<span class="s2">$username logged in $count times, for a total of $total minutes.</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">println</span> <span class="n">htmlStr</span>

<span class="c1">// SimpleTemplateEngine version:</span>
<span class="kt">def</span> <span class="n">html</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;!-- simple.template for internal template() function --&gt;</span>
<span class="s1">&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Report for $username&lt;/TITLE&gt;&lt;/HEAD&gt;</span>
<span class="s1">&lt;BODY&gt;&lt;H1&gt;Report for $username&lt;/H1&gt;</span>
<span class="s1">$username logged in $count times, for a total of $total minutes.</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="kt">def</span> <span class="n">engine</span> <span class="o">=</span> <span class="k">new</span> <span class="n">groovy</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">SimpleTemplateEngine</span><span class="o">()</span>
<span class="kt">def</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringReader</span><span class="o">(</span><span class="n">html</span><span class="o">)</span>
<span class="kt">def</span> <span class="n">template</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="na">createTemplate</span><span class="o">(</span><span class="n">reader</span><span class="o">)</span>
<span class="n">println</span> <span class="n">template</span><span class="o">.</span><span class="na">make</span><span class="o">(</span><span class="nl">username:</span><span class="s2">&quot;Peter&quot;</span><span class="o">,</span> <span class="nl">count:</span><span class="s2">&quot;23&quot;</span><span class="o">,</span> <span class="nl">total:</span> <span class="s2">&quot;1234&quot;</span><span class="o">)</span>

<span class="c1">// SQL version</span>
<span class="kn">import</span> <span class="nn">groovy.sql.Sql</span>
<span class="n">user</span> <span class="o">=</span> <span class="s1">&#39;Peter&#39;</span>
<span class="kt">def</span> <span class="n">sql</span> <span class="o">=</span> <span class="n">Sql</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="s1">&#39;jdbc:mysql://localhost:3306/mydb&#39;</span><span class="o">,</span> <span class="s1">&#39;dbuser&#39;</span><span class="o">,</span>
                      <span class="s1">&#39;dbpass&#39;</span><span class="o">,</span> <span class="s1">&#39;com.mysql.jdbc.Driver&#39;</span><span class="o">)</span>
<span class="n">sql</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="s2">&quot;SELECT COUNT(duration),SUM(duration) FROM logins WHERE username=&#39;$user&#39;&quot;</span><span class="o">)</span> <span class="o">{</span> <span class="n">answer</span> <span class="o">-&gt;</span>
    <span class="n">println</span> <span class="o">(</span><span class="n">template</span><span class="o">.</span><span class="na">make</span><span class="o">(</span><span class="nl">username:</span><span class="n">user</span><span class="o">,</span> <span class="nl">count:</span><span class="n">answer</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="nl">total:</span><span class="n">answer</span><span class="o">[</span><span class="mi">1</span><span class="o">]))</span>
<span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_20.10</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// using built-in connection features</span>
<span class="n">urlStr</span> <span class="o">=</span> <span class="s1">&#39;http://jakarta.apache.org/&#39;</span>
<span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">urlStr</span><span class="o">)</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">()</span>
<span class="n">connection</span><span class="o">.</span><span class="na">ifModifiedSince</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">(</span><span class="mi">2007</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">18</span><span class="o">).</span><span class="na">time</span>
<span class="n">connection</span><span class="o">.</span><span class="na">connect</span><span class="o">()</span>
<span class="n">println</span> <span class="n">connection</span><span class="o">.</span><span class="na">responseCode</span>

<span class="c1">// manually setting header field</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="na">openConnection</span><span class="o">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">SimpleDateFormat</span> <span class="o">(</span><span class="s2">&quot;EEE, dd MMM yyyy HH:mm:ss &#39;GMT&#39;&quot;</span><span class="o">)</span>
<span class="n">df</span><span class="o">.</span><span class="na">setTimeZone</span><span class="o">(</span><span class="n">TimeZone</span><span class="o">.</span><span class="na">getTimeZone</span><span class="o">(</span><span class="s1">&#39;GMT&#39;</span><span class="o">))</span>
<span class="n">connection</span><span class="o">.</span><span class="na">setRequestProperty</span><span class="o">(</span><span class="s2">&quot;If-Modified-Since&quot;</span><span class="o">,</span><span class="n">df</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">(</span><span class="mi">2007</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">18</span><span class="o">)));</span>
<span class="n">connection</span><span class="o">.</span><span class="na">connect</span><span class="o">()</span>
<span class="n">println</span> <span class="n">connection</span><span class="o">.</span><span class="na">responseCode</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_20.11</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// The website http://www.robotstxt.org/wc/active/html/ lists many available robots</span>
<span class="c1">// including Java ones which can be used from Groovy. In particular, j-spider</span>
<span class="c1">// allows you to:</span>
<span class="c1">// + Check your site for errors (internal server errors, ...)</span>
<span class="c1">// + Outgoing and/or internal link checking</span>
<span class="c1">// + Analyze your site structure (creating a sitemap, ...)</span>
<span class="c1">// + Download complete web sites</span>
<span class="c1">// most of its functionality is available by tweaking appropriate configuration</span>
<span class="c1">// files and then running it as a standalone application but you can also write</span>
<span class="c1">// your own java classes.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_20.12</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// sample data, use &#39;LOGFILE = new File(args[0]).text&#39; or similar</span>
<span class="n">LOGFILE</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">127.0.0.1 - - [04/Sep/2005:20:50:31 +0200] &quot;GET /bus HTTP/1.1&quot; 301 303</span>
<span class="s1">127.0.0.1 - - [04/Sep/2005:20:50:31 +0200] &quot;GET /bus HTTP/1.1&quot; 301 303 &quot;-&quot; &quot;Opera/8.02 (X11; Linux i686; U; en)&quot;</span>
<span class="s1">192.168.0.1 - - [04/Sep/2005:20:50:36 +0200] &quot;GET /bus/libjs/layersmenu-library.js HTTP/1.1&quot; 200 6228</span>
<span class="s1">192.168.0.1 - - [04/Sep/2005:20:50:36 +0200] &quot;GET /bus/libjs/layersmenu-library.js HTTP/1.1&quot; 200 6228 &quot;http://localhost/bus/&quot; &quot;Opera/8.02 (X11; Linux i686; U; en)&quot;</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="c1">// similar to perl version:</span>
<span class="n">fields</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;client&#39;</span><span class="o">,</span><span class="s1">&#39;identuser&#39;</span><span class="o">,</span><span class="s1">&#39;authuser&#39;</span><span class="o">,</span><span class="s1">&#39;date&#39;</span><span class="o">,</span><span class="s1">&#39;time&#39;</span><span class="o">,</span><span class="s1">&#39;tz&#39;</span><span class="o">,</span><span class="s1">&#39;method&#39;</span><span class="o">,</span><span class="s1">&#39;url&#39;</span><span class="o">,</span><span class="s1">&#39;protocol&#39;</span><span class="o">,</span><span class="s1">&#39;status&#39;</span><span class="o">,</span><span class="s1">&#39;bytes&#39;</span><span class="o">]</span>
<span class="n">regex</span> <span class="o">=</span> <span class="s">/^(\S+) (\S+) (\S+) \[([^:]+):(\d+:\d+:\d+) ([^\]]+)\] &quot;(\S+) (.*?) (\S+)&quot; (\S+) (\S+).*$/</span>

<span class="n">LOGFILE</span><span class="o">.</span><span class="na">trim</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s1">&#39;\n&#39;</span><span class="o">).</span><span class="na">each</span><span class="o">{</span> <span class="n">line</span> <span class="o">-&gt;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">line</span> <span class="o">=~</span> <span class="n">regex</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">matches</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">idx</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..&lt;</span><span class="n">fields</span><span class="o">.</span><span class="na">size</span><span class="o">())</span> <span class="o">{</span> <span class="n">println</span> <span class="s2">&quot;${fields[idx]}=${m[0][idx+1]}&quot;</span> <span class="o">}</span>
        <span class="n">println</span><span class="o">()</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_20.13</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// sample data, use &#39;LOGFILE = new File(args[0]).text&#39; or similar</span>
<span class="n">LOGFILE</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">204.31.113.138 - - [03/Jul/1996:06:56:12 -0800] &quot;POST /forms/login.jsp HTTP/1.0&quot; 200 5593</span>
<span class="s1">fcrawler.looksmart.com - - [26/Apr/2000:00:00:12 -0400] &quot;GET /contacts.html HTTP/1.0&quot; 200 4595 &quot;-&quot; &quot;FAST-WebCrawler/2.1-pre2 (ashen@looksmart.net)&quot;</span>
<span class="s1">fcrawler.looksmart.com - - [26/Apr/2000:00:17:19 -0400] &quot;GET /news/news.html HTTP/1.0&quot; 200 16716 &quot;-&quot; &quot;FAST-WebCrawler/2.1-pre2 (ashen@looksmart.net)&quot;</span>
<span class="s1">ppp931.on.bellglobal.com - - [26/Apr/2000:00:16:12 -0400] &quot;GET /download/windows/asctab31.zip HTTP/1.0&quot; 200 1540096 &quot;http://www.htmlgoodies.com/downloads/freeware/webdevelopment/15.html&quot; &quot;Mozilla/4.7 [en]C-SYMPA  (Win95; U)&quot;</span>
<span class="s1">123.123.123.123 - - [26/Apr/2000:00:23:48 -0400] &quot;GET /pics/wpaper.gif HTTP/1.0&quot; 200 6248 &quot;http://www.jafsoft.com/asctortf/&quot; &quot;Mozilla/4.05 (Macintosh; I; PPC)&quot;</span>
<span class="s1">123.123.123.123 - - [26/Apr/2000:00:23:47 -0400] &quot;GET /asctortf/ HTTP/1.0&quot; 200 8130 &quot;http://search.netscape.com/Computers/Data_Formats/Document/Text/RTF&quot; &quot;Mozilla/4.05 (Macintosh; I; PPC)&quot;</span>
<span class="s1">123.123.123.123 - - [26/Apr/2000:00:23:48 -0400] &quot;GET /pics/5star2000.gif HTTP/1.0&quot; 200 4005 &quot;http://www.jafsoft.com/asctortf/&quot; &quot;Mozilla/4.05 (Macintosh; I; PPC)&quot;</span>
<span class="s1">123.123.123.123 - - [27/Apr/2000:00:23:50 -0400] &quot;GET /pics/5star.gif HTTP/1.0&quot; 200 1031 &quot;http://www.jafsoft.com/asctortf/&quot; &quot;Mozilla/4.05 (Macintosh; I; PPC)&quot;</span>
<span class="s1">123.123.123.123 - - [27/Apr/2000:00:23:51 -0400] &quot;GET /pics/a2hlogo.jpg HTTP/1.0&quot; 200 4282 &quot;http://www.jafsoft.com/asctortf/&quot; &quot;Mozilla/4.05 (Macintosh; I; PPC)&quot;</span>
<span class="s1">123.123.123.123 - - [27/Apr/2000:00:23:51 -0400] &quot;GET /cgi-bin/newcount?jafsof3&amp;width=4&amp;font=digital&amp;noshow HTTP/1.0&quot; 200 36 &quot;http://www.jafsoft.com/asctortf/&quot; &quot;Mozilla/4.05 (Macintosh; I; PPC)&quot;</span>
<span class="s1">127.0.0.1 - frank [10/Oct/2000:13:55:36 -0700] &quot;GET /apache_pb.gif HTTP/1.0&quot; 200 2326</span>
<span class="s1">127.0.0.1 - - [04/Sep/2005:20:50:31 +0200] &quot;GET / HTTP/1.1&quot; 200 1927</span>
<span class="s1">127.0.0.1 - - [04/Sep/2005:20:50:31 +0200] &quot;GET /bus HTTP/1.1&quot; 301 303 &quot;-&quot; &quot;Opera/8.02 (X11; Linux i686; U; en)&quot;</span>
<span class="s1">192.168.0.1 - - [05/Sep/2005:20:50:36 +0200] &quot;GET /bus/libjs/layersmenu-library.js HTTP/1.1&quot; 200 6228</span>
<span class="s1">192.168.0.1 - - [05/Sep/2005:20:50:36 +0200] &quot;GET /bus/libjs/layersmenu-library.js HTTP/1.1&quot; 200 6228 &quot;http://localhost/bus/&quot; &quot;Opera/8.02 (X11; Linux i686; U; en)&quot;</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">fields</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;client&#39;</span><span class="o">,</span><span class="s1">&#39;identuser&#39;</span><span class="o">,</span><span class="s1">&#39;authuser&#39;</span><span class="o">,</span><span class="s1">&#39;date&#39;</span><span class="o">,</span><span class="s1">&#39;time&#39;</span><span class="o">,</span><span class="s1">&#39;tz&#39;</span><span class="o">,</span><span class="s1">&#39;method&#39;</span><span class="o">,</span><span class="s1">&#39;url&#39;</span><span class="o">,</span><span class="s1">&#39;protocol&#39;</span><span class="o">,</span><span class="s1">&#39;status&#39;</span><span class="o">,</span><span class="s1">&#39;bytes&#39;</span><span class="o">]</span>
<span class="n">regex</span> <span class="o">=</span> <span class="s">/^(\S+) (\S+) (\S+) \[([^:]+):(\d+:\d+:\d+) ([^\]]+)\] &quot;(\S+) (.*?) (\S+)&quot; (\S+) (\S+).*$/</span>

<span class="kd">class</span> <span class="nc">Summary</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">hosts</span> <span class="o">=</span> <span class="o">[:]</span>
    <span class="kt">def</span> <span class="n">what</span> <span class="o">=</span> <span class="o">[:]</span>
    <span class="kt">def</span> <span class="n">accessCount</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="kt">def</span> <span class="n">postCount</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="kt">def</span> <span class="n">homeCount</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="kt">def</span> <span class="n">totalBytes</span> <span class="o">=</span> <span class="mi">0</span>
<span class="o">}</span>
<span class="n">totals</span> <span class="o">=</span> <span class="o">[:]</span>
<span class="n">LOGFILE</span><span class="o">.</span><span class="na">trim</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s1">&#39;\n&#39;</span><span class="o">).</span><span class="na">each</span><span class="o">{</span> <span class="n">line</span> <span class="o">-&gt;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">line</span> <span class="o">=~</span> <span class="n">regex</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">matches</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="n">fields</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="s1">&#39;date&#39;</span><span class="o">)+</span><span class="mi">1</span><span class="o">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">totals</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">date</span><span class="o">,</span> <span class="k">new</span> <span class="n">Summary</span><span class="o">())</span>
        <span class="n">s</span><span class="o">.</span><span class="na">accessCount</span><span class="o">++</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="n">fields</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="s1">&#39;method&#39;</span><span class="o">)+</span><span class="mi">1</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="o">)</span> <span class="n">s</span><span class="o">.</span><span class="na">postCount</span><span class="o">++</span>
        <span class="n">s</span><span class="o">.</span><span class="na">totalBytes</span> <span class="o">+=</span> <span class="o">(</span><span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="n">fields</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="s1">&#39;bytes&#39;</span><span class="o">)+</span><span class="mi">1</span><span class="o">]).</span><span class="na">toInteger</span><span class="o">()</span>
        <span class="kt">def</span> <span class="n">url</span> <span class="o">=</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="n">fields</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="s1">&#39;url&#39;</span><span class="o">)+</span><span class="mi">1</span><span class="o">]</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">url</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="o">)</span> <span class="n">s</span><span class="o">.</span><span class="na">homeCount</span><span class="o">++</span>
        <span class="n">s</span><span class="o">.</span><span class="na">what</span><span class="o">[</span><span class="n">url</span><span class="o">]</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">what</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="kt">def</span> <span class="n">host</span> <span class="o">=</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="n">fields</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="s1">&#39;client&#39;</span><span class="o">)+</span><span class="mi">1</span><span class="o">]</span>
        <span class="n">s</span><span class="o">.</span><span class="na">hosts</span><span class="o">[</span><span class="n">host</span><span class="o">]</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">hosts</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">host</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">report</span><span class="o">(</span><span class="s1">&#39;Date&#39;</span><span class="o">,</span><span class="s1">&#39;Hosts&#39;</span><span class="o">,</span><span class="s1">&#39;Accesses&#39;</span><span class="o">,</span><span class="s1">&#39;Unidocs&#39;</span><span class="o">,</span><span class="s1">&#39;POST&#39;</span><span class="o">,</span><span class="s1">&#39;Home&#39;</span><span class="o">,</span><span class="s1">&#39;Bytes&#39;</span><span class="o">)</span>
<span class="n">totals</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">key</span><span class="o">,</span> <span class="n">s</span> <span class="o">-&gt;</span>
    <span class="n">report</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">s</span><span class="o">.</span><span class="na">hosts</span><span class="o">.</span><span class="na">size</span><span class="o">(),</span> <span class="n">s</span><span class="o">.</span><span class="na">accessCount</span><span class="o">,</span> <span class="n">s</span><span class="o">.</span><span class="na">what</span><span class="o">.</span><span class="na">size</span><span class="o">(),</span> <span class="n">s</span><span class="o">.</span><span class="na">postCount</span><span class="o">,</span> <span class="n">s</span><span class="o">.</span><span class="na">homeCount</span><span class="o">,</span> <span class="n">s</span><span class="o">.</span><span class="na">totalBytes</span><span class="o">)</span>
<span class="o">}</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">totals</span><span class="o">.</span><span class="na">values</span><span class="o">()</span>
<span class="n">report</span><span class="o">(</span><span class="s1">&#39;Grand Total&#39;</span><span class="o">,</span> <span class="n">v</span><span class="o">.</span><span class="na">sum</span><span class="o">{</span><span class="n">it</span><span class="o">.</span><span class="na">hosts</span><span class="o">.</span><span class="na">size</span><span class="o">()},</span> <span class="n">v</span><span class="o">.</span><span class="na">sum</span><span class="o">{</span><span class="n">it</span><span class="o">.</span><span class="na">accessCount</span><span class="o">},</span> <span class="n">v</span><span class="o">.</span><span class="na">sum</span><span class="o">{</span><span class="n">it</span><span class="o">.</span><span class="na">what</span><span class="o">.</span><span class="na">size</span><span class="o">()},</span>
        <span class="n">v</span><span class="o">.</span><span class="na">sum</span><span class="o">{</span><span class="n">it</span><span class="o">.</span><span class="na">postCount</span><span class="o">},</span> <span class="n">v</span><span class="o">.</span><span class="na">sum</span><span class="o">{</span><span class="n">it</span><span class="o">.</span><span class="na">homeCount</span><span class="o">},</span> <span class="n">v</span><span class="o">.</span><span class="na">sum</span><span class="o">{</span><span class="n">it</span><span class="o">.</span><span class="na">totalBytes</span><span class="o">}</span> <span class="o">)</span>

<span class="kt">def</span> <span class="nf">report</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">,</span> <span class="n">e</span><span class="o">,</span> <span class="n">f</span><span class="o">,</span> <span class="n">g</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">printf</span> <span class="o">(</span><span class="s2">&quot;%12s %6s %8s %8s %8s %8s %10s\n&quot;</span><span class="o">,</span> <span class="o">[</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">,</span><span class="n">c</span><span class="o">,</span><span class="n">d</span><span class="o">,</span><span class="n">e</span><span class="o">,</span><span class="n">f</span><span class="o">,</span><span class="n">g</span><span class="o">])</span>
<span class="o">}</span>
<span class="c1">// =&gt;</span>
<span class="c1">//         Date  Hosts Accesses  Unidocs     POST     Home      Bytes</span>
<span class="c1">//  03/Jul/1996      1        1        1        1        0       5593</span>
<span class="c1">//  10/Oct/2000      1        1        1        0        0       2326</span>
<span class="c1">//  04/Sep/2005      1        2        2        0        1       2230</span>
<span class="c1">//  05/Sep/2005      1        2        1        0        0      12456</span>
<span class="c1">//  26/Apr/2000      3        6        6        0        0    1579790</span>
<span class="c1">//  27/Apr/2000      1        3        3        0        0       5349</span>
<span class="c1">//  Grand Total      8       15       14        1        1    1607744</span>


<span class="c1">// Some open source log processing packages in Java:</span>
<span class="c1">// http://www.generationjava.com/projects/logview/index.shtml</span>
<span class="c1">// http://ostermiller.org/webalizer/</span>
<span class="c1">// http://jxla.nvdcms.org/en/index.xml</span>
<span class="c1">// http://polliwog.sourceforge.net/index.html</span>
<span class="c1">// as well as textual reports, most of these can produce graphical reports</span>
<span class="c1">// Most have their own configuration information and Java extension points.</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_20.14</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
 <span class="kn">import</span> <span class="nn">org.cyberneko.html.filters.Writer</span>
 <span class="kn">import</span> <span class="nn">org.cyberneko.html.filters.DefaultFilter</span>
 <span class="kn">import</span> <span class="nn">org.apache.xerces.xni.parser.XMLDocumentFilter</span>
 <span class="kn">import</span> <span class="nn">org.apache.xerces.xni.*</span>
 <span class="kn">import</span> <span class="nn">org.cyberneko.html.parsers.DOMParser</span>
 <span class="kn">import</span> <span class="nn">org.xml.sax.InputSource</span>

 <span class="n">input</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1"> &lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Hi!&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;</span>
<span class="s1"> &lt;H1&gt;Welcome to Scooby World!&lt;/H1&gt;</span>
<span class="s1"> I have &lt;A HREF=&quot;pictures.html&quot;&gt;pictures&lt;/A&gt; of the crazy dog</span>
<span class="s1"> himself. Here&#39;</span><span class="n">s</span> <span class="n">one</span><span class="o">!&lt;</span><span class="n">P</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">IMG</span> <span class="n">SRC</span><span class="o">=</span><span class="s2">&quot;scooby.jpg&quot;</span> <span class="n">ALT</span><span class="o">=</span><span class="s2">&quot;Good doggy!&quot;</span><span class="o">&gt;&lt;</span><span class="n">P</span><span class="o">&gt;</span>
 <span class="o">&lt;</span><span class="n">BLINK</span><span class="o">&gt;</span><span class="n">He</span><span class="s1">&#39;s my hero!&lt;/BLINK&gt; I would like to meet him some day,</span>
<span class="s1"> and get my picture taken with him.&lt;P&gt;</span>
<span class="s1"> P.S. I am deathly ill. &lt;A HREF=&quot;shergold.html&quot;&gt;Please send</span>
<span class="s1"> cards&lt;/A&gt;.</span>
<span class="s1"> &lt;/BODY&gt;&lt;/HTML&gt;</span>
<span class="s1"> &#39;&#39;&#39;</span>

 <span class="kd">class</span> <span class="nc">WordReplaceFilter</span> <span class="kd">extends</span> <span class="n">DefaultFilter</span> <span class="o">{</span>
     <span class="kd">private</span> <span class="n">before</span><span class="o">,</span> <span class="n">after</span>
     <span class="n">WordReplaceFilter</span><span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span> <span class="n">before</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span> <span class="n">after</span> <span class="o">=</span> <span class="n">a</span> <span class="o">}</span>
     <span class="kt">void</span> <span class="nf">characters</span><span class="o">(</span><span class="n">XMLString</span> <span class="n">text</span><span class="o">,</span> <span class="n">Augmentations</span> <span class="n">augs</span><span class="o">)</span> <span class="o">{</span>
         <span class="kt">char</span><span class="o">[]</span> <span class="n">c</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">replaceAll</span><span class="o">(</span><span class="n">before</span><span class="o">,</span> <span class="n">after</span><span class="o">)</span>
         <span class="kd">super</span><span class="o">.</span><span class="na">characters</span><span class="o">(</span><span class="k">new</span> <span class="n">XMLString</span><span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">c</span><span class="o">.</span><span class="na">size</span><span class="o">()),</span> <span class="n">augs</span><span class="o">)</span>
     <span class="o">}</span>
     <span class="kt">void</span> <span class="nf">setProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">,</span> <span class="n">Object</span> <span class="n">o</span><span class="o">){}</span>
 <span class="o">}</span>
 <span class="n">XMLDocumentFilter</span><span class="o">[]</span> <span class="n">filters</span> <span class="o">=</span> <span class="o">[</span>
     <span class="k">new</span> <span class="nf">WordReplaceFilter</span><span class="o">(</span><span class="s">/(?sm)picture/</span><span class="o">,</span> <span class="s">/photo/</span><span class="o">),</span>
     <span class="k">new</span> <span class="nf">Writer</span><span class="o">()</span>
 <span class="o">]</span>
 <span class="n">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DOMParser</span><span class="o">()</span>
 <span class="n">parser</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s2">&quot;http://cyberneko.org/html/properties/filters&quot;</span><span class="o">,</span> <span class="n">filters</span><span class="o">)</span>
 <span class="n">parser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="k">new</span> <span class="n">InputSource</span><span class="o">(</span><span class="k">new</span> <span class="n">StringReader</span><span class="o">(</span><span class="n">input</span><span class="o">)))</span>
<span class="c1">//----------------------------------------------------------------------------------</span>


<span class="c1">// @@PLEAC@@_20.15</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
<span class="kn">import</span> <span class="nn">org.cyberneko.html.filters.Writer</span>
<span class="kn">import</span> <span class="nn">org.cyberneko.html.filters.DefaultFilter</span>
<span class="kn">import</span> <span class="nn">org.apache.xerces.xni.parser.XMLDocumentFilter</span>
<span class="kn">import</span> <span class="nn">org.apache.xerces.xni.*</span>
<span class="kn">import</span> <span class="nn">org.cyberneko.html.parsers.DOMParser</span>
<span class="kn">import</span> <span class="nn">org.xml.sax.InputSource</span>

<span class="n">input</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Hi!&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;</span>
<span class="s1">&lt;H1&gt;Welcome to Scooby World!&lt;/H1&gt;</span>
<span class="s1">I have &lt;A HREF=&quot;pictures.html&quot;&gt;pictures&lt;/A&gt; of the crazy dog</span>
<span class="s1">himself. Here&#39;</span><span class="n">s</span> <span class="n">one</span><span class="o">!&lt;</span><span class="n">P</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">IMG</span> <span class="n">SRC</span><span class="o">=</span><span class="s2">&quot;scooby.jpg&quot;</span> <span class="n">ALT</span><span class="o">=</span><span class="s2">&quot;Good doggy!&quot;</span><span class="o">&gt;&lt;</span><span class="n">P</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">BLINK</span><span class="o">&gt;</span><span class="n">He</span><span class="s1">&#39;s my hero!&lt;/BLINK&gt; I would like to meet him some day,</span>
<span class="s1">and get my picture taken with him.&lt;P&gt;</span>
<span class="s1">P.S. I am deathly ill. &lt;A HREF=&quot;shergold.html&quot;&gt;Please send</span>
<span class="s1">cards&lt;/A&gt;.</span>
<span class="s1">&lt;/BODY&gt;&lt;/HTML&gt;</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="kd">class</span> <span class="nc">HrefReplaceFilter</span> <span class="kd">extends</span> <span class="n">DefaultFilter</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">before</span><span class="o">,</span> <span class="n">after</span>
    <span class="n">HrefReplaceFilter</span><span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="n">a</span><span class="o">)</span> <span class="o">{</span> <span class="n">before</span> <span class="o">=</span> <span class="n">b</span><span class="o">;</span> <span class="n">after</span> <span class="o">=</span> <span class="n">a</span> <span class="o">}</span>
    <span class="kt">void</span> <span class="nf">startElement</span><span class="o">(</span><span class="n">QName</span> <span class="n">element</span><span class="o">,</span> <span class="n">XMLAttributes</span> <span class="n">attributes</span><span class="o">,</span> <span class="n">Augmentations</span> <span class="n">augs</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">def</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="na">getIndex</span><span class="o">(</span><span class="s1">&#39;href&#39;</span><span class="o">)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">idx</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">def</span> <span class="n">newtext</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="na">getValue</span><span class="o">(</span><span class="n">idx</span><span class="o">).</span><span class="na">replaceAll</span><span class="o">(</span><span class="n">before</span><span class="o">,</span> <span class="n">after</span><span class="o">)</span>
            <span class="n">attributes</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">idx</span><span class="o">,</span> <span class="n">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">newtext</span><span class="o">))</span>
        <span class="o">}</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">startElement</span><span class="o">(</span><span class="n">element</span><span class="o">,</span> <span class="n">attributes</span><span class="o">,</span> <span class="n">augs</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="kt">void</span> <span class="nf">setProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">,</span> <span class="n">Object</span> <span class="n">o</span><span class="o">){}</span>
<span class="o">}</span>
<span class="n">XMLDocumentFilter</span><span class="o">[]</span> <span class="n">myfilters</span> <span class="o">=</span> <span class="o">[</span>
    <span class="k">new</span> <span class="nf">HrefReplaceFilter</span><span class="o">(</span><span class="s">/shergold.html/</span><span class="o">,</span> <span class="s">/cards.html/</span><span class="o">),</span>
    <span class="k">new</span> <span class="nf">Writer</span><span class="o">()</span>
<span class="o">]</span>
<span class="n">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DOMParser</span><span class="o">()</span>
<span class="n">parser</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s2">&quot;http://cyberneko.org/html/properties/filters&quot;</span><span class="o">,</span> <span class="n">myfilters</span><span class="o">)</span>
<span class="n">parser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="k">new</span> <span class="n">InputSource</span><span class="o">(</span><span class="k">new</span> <span class="n">StringReader</span><span class="o">(</span><span class="n">input</span><span class="o">)))</span>
<span class="c1">//----------------------------------------------------------------------------------</span>
</pre></div>
</body>
</html>
