<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Classes, Objects, and Ties</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Groovy"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Packages, Libraries, and Modules"
HREF="packagesetc.html"><LINK
REL="NEXT"
TITLE="Database Access"
HREF="dbaccess.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Groovy</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="packagesetc.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="dbaccess.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="CLASSESETC"
>13. Classes, Objects, and Ties</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN704"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Classes and objects in Groovy are rather straigthforward</span>
<span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="c1">// Class variables (also called static attributes) are prefixed by the keyword static</span>
    <span class="kd">static</span> <span class="n">personCounter</span><span class="o">=</span><span class="mi">0</span>
    <span class="kt">def</span> <span class="n">age</span><span class="o">,</span> <span class="n">name</span>               <span class="c1">// this creates setter and getter methods</span>
    <span class="kd">private</span> <span class="n">alive</span>

    <span class="c1">// object constructor</span>
    <span class="n">Person</span><span class="o">(</span><span class="n">age</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">alive</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span> <span class="o">{</span>            <span class="c1">// Default arg like in C++</span>
        <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">this</span><span class="o">.</span><span class="na">alive</span> <span class="o">=</span> <span class="n">alive</span>
        <span class="n">personCounter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1">// There is a &#39;++&#39; operator in Groovy but using += is often clearer.</span>
    <span class="o">}</span>

    <span class="kt">def</span> <span class="nf">die</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">alive</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="n">println</span> <span class="s2">&quot;$name has died at the age of $age.&quot;</span>
        <span class="n">alive</span>
    <span class="o">}</span>

    <span class="kt">def</span> <span class="nf">kill</span><span class="o">(</span><span class="n">anotherPerson</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">println</span> <span class="s2">&quot;$name is killing $anotherPerson.name.&quot;</span>
        <span class="n">anotherPerson</span><span class="o">.</span><span class="na">die</span><span class="o">()</span>
    <span class="o">}</span>

    <span class="c1">// methods used as queries generally start with is, are, will or can</span>
    <span class="c1">// usually have the &#39;?&#39; suffix</span>
    <span class="kt">def</span> <span class="nf">isStillAlive</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">alive</span>
    <span class="o">}</span>

    <span class="kt">def</span> <span class="nf">getYearOfBirth</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">new</span> <span class="nf">Date</span><span class="o">().</span><span class="na">year</span> <span class="o">-</span> <span class="n">age</span>
    <span class="o">}</span>

    <span class="c1">// Class method (also called static method)</span>
    <span class="kd">static</span> <span class="nf">getNumberOfPeople</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// accessors often start with get</span>
                                 <span class="c1">// in which case you can call it like</span>
                                 <span class="c1">// it was a field (without the get)</span>
        <span class="n">personCounter</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Using the class:</span>
<span class="c1">// Create objects of class Person</span>
<span class="n">lecter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="mi">47</span><span class="o">,</span> <span class="s1">&#39;Hannibal&#39;</span><span class="o">)</span>
<span class="n">starling</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="mi">29</span><span class="o">,</span> <span class="s1">&#39;Clarice&#39;</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="n">pazzi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="mi">40</span><span class="o">,</span> <span class="s1">&#39;Rinaldo&#39;</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>

<span class="c1">// Calling a class method</span>
<span class="n">println</span> <span class="s2">&quot;There are $Person.numberOfPeople Person objects.&quot;</span>

<span class="n">println</span> <span class="s2">&quot;$pazzi.name is ${pazzi.alive ? &#39;alive&#39; : &#39;dead&#39;}.&quot;</span>
<span class="n">lecter</span><span class="o">.</span><span class="na">kill</span><span class="o">(</span><span class="n">pazzi</span><span class="o">)</span>
<span class="n">println</span> <span class="s2">&quot;$pazzi.name is ${pazzi.isStillAlive() ? &#39;alive&#39; : &#39;dead&#39;}.&quot;</span>

<span class="n">println</span> <span class="s2">&quot;$starling.name was born in $starling.yearOfBirth.&quot;</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN707"
>Constructing an Object</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Classes may have no constructor.</span>
<span class="kd">class</span> <span class="nc">MyClass</span> <span class="o">{</span> <span class="o">}</span>

<span class="n">aValidButNotVeryUsefulObject</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyClass</span><span class="o">()</span>

<span class="c1">// If no explicit constructor is given a default implicit</span>
<span class="c1">// one which supports named parameters is provided.</span>
<span class="kd">class</span> <span class="nc">MyClass2</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">start</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">()</span>
    <span class="kt">def</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">0</span>
<span class="o">}</span>
<span class="n">println</span> <span class="k">new</span> <span class="nf">MyClass2</span><span class="o">(</span><span class="nl">age:</span><span class="mi">4</span><span class="o">).</span><span class="na">age</span> <span class="c1">// =&gt; 4</span>

<span class="c1">// One or more explicit constructors may also be provided</span>
<span class="kd">class</span> <span class="nc">MyClass3</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">start</span>
    <span class="kt">def</span> <span class="n">age</span>
    <span class="nf">MyClass3</span><span class="o">(</span><span class="n">date</span><span class="o">,</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">date</span>
        <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">println</span> <span class="k">new</span> <span class="nf">MyClass3</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">(),</span> <span class="mi">20</span><span class="o">).</span><span class="na">age</span> <span class="c1">// =&gt; 20</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN710"
>Destroying an Object</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Objects are destroyed by the JVM garbage collector.</span>
<span class="c1">// The time of destroying is not predicated but left up to the JVM.</span>
<span class="c1">// There is no direct support for destructor. There is a courtesy</span>
<span class="c1">// method called finalize() which the JVM may call when disposing</span>
<span class="c1">// an object. If you need to free resources for an object, like</span>
<span class="c1">// closing a socket or killing a spawned subprocess, you should do</span>
<span class="c1">// it explicitly - perhaps by supporting your own lifecycle methods</span>
<span class="c1">// on your class, e.g. close().</span>

<span class="kd">class</span> <span class="nc">MyClass4</span><span class="o">{</span>
    <span class="kt">void</span> <span class="nf">finalize</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">println</span> <span class="s2">&quot;Object [internal id=${hashCode()}] is dying at ${new Date()}&quot;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// test code</span>
<span class="mi">50</span><span class="o">.</span><span class="na">times</span> <span class="o">{</span>
    <span class="k">new</span> <span class="nf">MyClass4</span><span class="o">()</span>
<span class="o">}</span>
<span class="mi">20</span><span class="o">.</span><span class="na">times</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">gc</span><span class="o">()</span>
<span class="o">}</span>
<span class="c1">// =&gt; (between 0 and 50 lines similar to below)</span>
<span class="c1">// Object [internal id=10884088] is dying at Wed Jan 10 16:33:33 EST 2007</span>
<span class="c1">// Object [internal id=6131844] is dying at Wed Jan 10 16:33:33 EST 2007</span>
<span class="c1">// Object [internal id=12245160] is dying at Wed Jan 10 16:33:33 EST 2007</span>
<span class="c1">// ...</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN713"
>Managing Instance Data</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// You can write getter and setter methods explicitly as shown below.</span>
<span class="c1">// One convention is to use set and get at the start of method names.</span>
<span class="kd">class</span> <span class="nc">Person2</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">name</span>
    <span class="kt">def</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span> <span class="n">name</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">setName</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// You can also just use def which auto defines default getters and setters.</span>
<span class="kd">class</span> <span class="nc">Person3</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">age</span><span class="o">,</span> <span class="n">name</span>
<span class="o">}</span>

<span class="c1">// Any variables marked as final will only have a default getter.</span>
<span class="c1">// You can also write an explicit getter. For a write-only variable</span>
<span class="c1">// just write only a setter.</span>
<span class="kd">class</span> <span class="nc">Person4</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">age</span>      <span class="c1">// getter only</span>
    <span class="kt">def</span> <span class="n">name</span>       <span class="c1">// getter and setter</span>
    <span class="kd">private</span> <span class="n">color</span>  <span class="c1">// private</span>
    <span class="kt">def</span> <span class="nf">setColor</span><span class="o">()</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">color</span> <span class="o">=</span> <span class="n">color</span> <span class="o">}</span> <span class="c1">// setter only</span>
<span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN716"
>Managing Class Data</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="kd">class</span> <span class="nc">Person5</span> <span class="o">{</span>
    <span class="c1">// Class variables (also called static attributes) are prefixed by the keyword static</span>
    <span class="kd">static</span> <span class="n">personCounter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="kd">static</span> <span class="nf">getPopulation</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">personCounter</span>
    <span class="o">}</span>
    <span class="n">Person5</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">personCounter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="o">}</span>
    <span class="kt">void</span> <span class="nf">finalize</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">personCounter</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">people</span> <span class="o">=</span> <span class="o">[]</span>
<span class="mi">10</span><span class="o">.</span><span class="na">times</span> <span class="o">{</span>
    <span class="n">people</span> <span class="o">+=</span> <span class="k">new</span> <span class="n">Person5</span><span class="o">()</span>
<span class="o">}</span>
<span class="n">println</span> <span class="s2">&quot;There are ${Person5.population} people alive&quot;</span>
<span class="c1">// =&gt; There are 10 people alive</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FixedArray</span><span class="o">()</span>
<span class="n">println</span> <span class="s2">&quot;Bound on alpha is $alpha.maxBounds&quot;</span>

<span class="n">beta</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FixedArray</span><span class="o">()</span>
<span class="n">beta</span><span class="o">.</span><span class="na">maxBounds</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">println</span> <span class="s2">&quot;Bound on alpha is $alpha.maxBounds&quot;</span>

<span class="kd">class</span> <span class="nc">FixedArray</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="n">maxBounds</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="kt">def</span> <span class="nf">getMaxBounds</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">maxBounds</span>
    <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">setMaxBounds</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">maxBounds</span> <span class="o">=</span> <span class="n">value</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Bound on alpha is 100</span>
<span class="c1">// Bound on alpha is 50</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN719"
>Using Classes as Structs</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// The fields of this struct-like class are dynamically typed</span>
<span class="kd">class</span> <span class="nc">DynamicPerson</span> <span class="o">{</span> <span class="kt">def</span> <span class="n">name</span><span class="o">,</span> <span class="n">age</span><span class="o">,</span> <span class="n">peers</span> <span class="o">}</span>
<span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DynamicPerson</span><span class="o">()</span>
<span class="n">p</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="s2">&quot;Jason Smythe&quot;</span>
<span class="n">p</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="mi">13</span>
<span class="n">p</span><span class="o">.</span><span class="na">peers</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;Wilbur&quot;</span><span class="o">,</span> <span class="s2">&quot;Ralph&quot;</span><span class="o">,</span> <span class="s2">&quot;Fred&quot;</span><span class="o">]</span>
<span class="n">p</span><span class="o">.</span><span class="na">setPeers</span><span class="o">([</span><span class="s2">&quot;Wilbur&quot;</span><span class="o">,</span> <span class="s2">&quot;Ralph&quot;</span><span class="o">,</span> <span class="s2">&quot;Fred&quot;</span><span class="o">])</span>     <span class="c1">// alternative using implicit setter</span>
<span class="n">p</span><span class="o">[</span><span class="s2">&quot;peers&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;Wilbur&quot;</span><span class="o">,</span> <span class="s2">&quot;Ralph&quot;</span><span class="o">,</span> <span class="s2">&quot;Fred&quot;</span><span class="o">]</span>    <span class="c1">// alternative access using name of field</span>
<span class="n">println</span> <span class="s2">&quot;At age $p.age, $p.name&#39;s first friend is ${p.peers[0]}&quot;</span>
<span class="c1">// =&gt; At age 13, Jason Smythe&#39;s first friend is Wilbur</span>

<span class="c1">// The fields of this struct-like class are statically typed</span>
<span class="kd">class</span> <span class="nc">StaticPerson</span> <span class="o">{</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span> <span class="n">List</span> <span class="n">peers</span> <span class="o">}</span>
<span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StaticPerson</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;Jason&#39;</span><span class="o">,</span> <span class="nl">age:</span><span class="mi">14</span><span class="o">,</span> <span class="nl">peers:</span><span class="o">[</span><span class="s1">&#39;Fred&#39;</span><span class="o">,</span><span class="s1">&#39;Wilbur&#39;</span><span class="o">,</span><span class="s1">&#39;Ralph&#39;</span><span class="o">])</span>
<span class="n">println</span> <span class="s2">&quot;At age $p.age, $p.name&#39;s first friend is ${p.peers[0]}&quot;</span>
<span class="c1">// =&gt; At age 14, Jason&#39;s first friend is Fred</span>


<span class="kd">class</span> <span class="nc">Family</span> <span class="o">{</span> <span class="kt">def</span> <span class="n">head</span><span class="o">,</span> <span class="n">address</span><span class="o">,</span> <span class="n">members</span> <span class="o">}</span>
<span class="n">folks</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Family</span><span class="o">(</span><span class="nl">head:</span><span class="k">new</span> <span class="n">DynamicPerson</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;John&#39;</span><span class="o">,</span><span class="nl">age:</span><span class="mi">34</span><span class="o">))</span>

<span class="c1">// supply of own accessor method for the struct for error checking</span>
<span class="kd">class</span> <span class="nc">ValidatingPerson</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">age</span>
    <span class="kt">def</span> <span class="nf">printAge</span><span class="o">()</span> <span class="o">{</span> <span class="n">println</span> <span class="s1">&#39;Age=&#39;</span> <span class="o">+</span> <span class="n">age</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">setAge</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!(</span><span class="n">value</span> <span class="k">instanceof</span> <span class="n">Integer</span><span class="o">))</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s2">&quot;Argument &#39;${value}&#39; isn&#39;t an Integer&quot;</span><span class="o">)</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s2">&quot;Age ${value} is unreasonable&quot;</span><span class="o">)</span>
        <span class="n">age</span> <span class="o">=</span> <span class="n">value</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// test ValidatingPerson</span>
<span class="kt">def</span> <span class="nf">tryCreate</span><span class="o">(</span><span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="k">new</span> <span class="nf">ValidatingPerson</span><span class="o">(</span><span class="nl">age:</span><span class="n">arg</span><span class="o">).</span><span class="na">printAge</span><span class="o">()</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">println</span> <span class="n">ex</span><span class="o">.</span><span class="na">message</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">tryCreate</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span>
<span class="n">tryCreate</span><span class="o">(</span><span class="s1">&#39;Youngish&#39;</span><span class="o">)</span>
<span class="n">tryCreate</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Age=20</span>
<span class="c1">// Argument &#39;Youngish&#39; isn&#39;t an Integer</span>
<span class="c1">// Age 200 is unreasonable</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN722"
>Cloning Objects</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy objects are (loosely speaking) extended Java objects.</span>
<span class="c1">// Java&#39;s Object class provides a clone() method. The conventions of</span>
<span class="c1">// clone() are that if I say a = b.clone() then a and b should be</span>
<span class="c1">// different objects with the same type and value. Java doesn&#39;t</span>
<span class="c1">// enforce a class to implement a clone() method at all let alone</span>
<span class="c1">// require that one has to meet these conventions. Classes which</span>
<span class="c1">// do support clone() should implement the Cloneable interface and</span>
<span class="c1">// implement an equals() method.</span>
<span class="c1">// Groovy follows Java&#39;s conventions for clone().</span>

<span class="kd">class</span> <span class="nc">A</span> <span class="kd">implements</span> <span class="n">Cloneable</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">name</span>
    <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">other</span> <span class="k">instanceof</span> <span class="n">A</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">name</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">ob1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">A</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;My named thing&#39;</span><span class="o">)</span>

<span class="n">ob2</span> <span class="o">=</span> <span class="n">ob1</span><span class="o">.</span><span class="na">clone</span><span class="o">()</span>
<span class="k">assert</span> <span class="o">!</span><span class="n">ob1</span><span class="o">.</span><span class="na">is</span><span class="o">(</span><span class="n">ob2</span><span class="o">)</span>
<span class="k">assert</span> <span class="n">ob1</span><span class="o">.</span><span class="na">class</span> <span class="o">==</span> <span class="n">ob2</span><span class="o">.</span><span class="na">class</span>
<span class="k">assert</span> <span class="n">ob2</span><span class="o">.</span><span class="na">name</span> <span class="o">==</span> <span class="n">ob1</span><span class="o">.</span><span class="na">name</span>
<span class="k">assert</span> <span class="n">ob1</span> <span class="o">==</span> <span class="n">ob2</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN725"
>Calling Methods Indirectly</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="kd">class</span> <span class="nc">CanFlicker</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="nf">flicker</span><span class="o">(</span><span class="n">arg</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> <span class="n">arg</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">}</span>
<span class="o">}</span>
<span class="n">methname</span> <span class="o">=</span> <span class="s1">&#39;flicker&#39;</span>
<span class="k">assert</span> <span class="k">new</span> <span class="nf">CanFlicker</span><span class="o">().</span><span class="na">invokeMethod</span><span class="o">(</span><span class="n">methname</span><span class="o">,</span> <span class="mi">10</span><span class="o">)</span> <span class="o">==</span> <span class="mi">20</span>
<span class="k">assert</span> <span class="k">new</span> <span class="nf">CanFlicker</span><span class="o">().</span><span class="s2">&quot;$methname&quot;</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span> <span class="o">==</span> <span class="mi">20</span>

<span class="kd">class</span> <span class="nc">NumberEcho</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="nf">one</span><span class="o">()</span> <span class="o">{</span> <span class="mi">1</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">two</span><span class="o">()</span> <span class="o">{</span> <span class="mi">2</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">three</span><span class="o">()</span> <span class="o">{</span> <span class="mi">3</span> <span class="o">}</span>
<span class="o">}</span>
<span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NumberEcho</span><span class="o">()</span>
<span class="c1">// call methods on the object, by name</span>
<span class="k">assert</span> <span class="o">[</span><span class="s1">&#39;one&#39;</span><span class="o">,</span> <span class="s1">&#39;two&#39;</span><span class="o">,</span> <span class="s1">&#39;three&#39;</span><span class="o">,</span> <span class="s1">&#39;two&#39;</span><span class="o">,</span> <span class="s1">&#39;one&#39;</span><span class="o">].</span><span class="na">collect</span><span class="o">{</span> <span class="n">obj</span><span class="o">.</span><span class="s2">&quot;$it&quot;</span><span class="o">()</span> <span class="o">}.</span><span class="na">join</span><span class="o">()</span> <span class="o">==</span> <span class="s1">&#39;12321&#39;</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN728"
>Determining Subclass Membership</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy can work with Groovy objects which inherit from a common base</span>
<span class="c1">// class called GroovyObject or Java objects which inherit from Object.</span>

<span class="c1">// the class of the object</span>
<span class="k">assert</span> <span class="s1">&#39;a string&#39;</span><span class="o">.</span><span class="na">class</span> <span class="o">==</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span>

<span class="c1">// Groovy classes are actually objects of class Class and they</span>
<span class="c1">// respond to methods defined in the Class class as well</span>
<span class="k">assert</span> <span class="s1">&#39;a string&#39;</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">class</span> <span class="o">==</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span>
<span class="k">assert</span> <span class="o">!</span><span class="s1">&#39;a string&#39;</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isArray</span><span class="o">()</span>

<span class="c1">// ask an object whether it is an instance of particular class</span>
<span class="n">n</span> <span class="o">=</span> <span class="mf">4.7f</span>
<span class="n">println</span> <span class="o">(</span><span class="n">n</span> <span class="k">instanceof</span> <span class="n">Integer</span><span class="o">)</span>          <span class="c1">// false</span>
<span class="n">println</span> <span class="o">(</span><span class="n">n</span> <span class="k">instanceof</span> <span class="n">Float</span><span class="o">)</span>            <span class="c1">// true</span>
<span class="n">println</span> <span class="o">(</span><span class="n">n</span> <span class="k">instanceof</span> <span class="n">Double</span><span class="o">)</span>           <span class="c1">// false</span>
<span class="n">println</span> <span class="o">(</span><span class="n">n</span> <span class="k">instanceof</span> <span class="n">String</span><span class="o">)</span>           <span class="c1">// false</span>
<span class="n">println</span> <span class="o">(</span><span class="n">n</span> <span class="k">instanceof</span> <span class="n">StaticPerson</span><span class="o">)</span>     <span class="c1">// false</span>

<span class="c1">// ask if a class or interface is either the same as, or is a</span>
<span class="c1">// superclass or superinterface of another class</span>
<span class="n">println</span> <span class="n">n</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">Float</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>       <span class="c1">// true</span>
<span class="n">println</span> <span class="n">n</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>      <span class="c1">// false</span>

<span class="c1">// can a Groovy object respond to a particular method?</span>
<span class="k">assert</span> <span class="k">new</span> <span class="nf">CanFlicker</span><span class="o">().</span><span class="na">metaClass</span><span class="o">.</span><span class="na">methods</span><span class="o">*.</span><span class="na">name</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s1">&#39;flicker&#39;</span><span class="o">)</span>

<span class="kd">class</span> <span class="nc">POGO</span><span class="o">{}</span>
<span class="n">println</span> <span class="o">(</span><span class="n">obj</span><span class="o">.</span><span class="na">metaClass</span><span class="o">.</span><span class="na">methods</span><span class="o">*.</span><span class="na">name</span> <span class="o">-</span> <span class="k">new</span> <span class="n">POGO</span><span class="o">().</span><span class="na">metaClass</span><span class="o">.</span><span class="na">methods</span><span class="o">*.</span><span class="na">name</span><span class="o">)</span>
<span class="c1">// =&gt; [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN731"
>Writing an Inheritable Class</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Most classes in Groovy are inheritable</span>
<span class="kd">class</span> <span class="nc">Person6</span><span class="o">{</span> <span class="kt">def</span> <span class="n">age</span><span class="o">,</span> <span class="n">name</span> <span class="o">}</span>
<span class="n">dude</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person6</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;Jason&#39;</span><span class="o">,</span> <span class="nl">age:</span><span class="mi">23</span><span class="o">)</span>
<span class="n">println</span> <span class="s2">&quot;$dude.name is age $dude.age.&quot;</span>

<span class="c1">// Inheriting from Person</span>
<span class="kd">class</span> <span class="nc">Employee</span> <span class="kd">extends</span> <span class="n">Person6</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">salary</span>
<span class="o">}</span>
<span class="n">empl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;Jason&#39;</span><span class="o">,</span> <span class="nl">age:</span><span class="mi">23</span><span class="o">,</span> <span class="nl">salary:</span><span class="mi">200</span><span class="o">)</span>
<span class="n">println</span> <span class="s2">&quot;$empl.name is age $empl.age and has salary $empl.salary.&quot;</span>

<span class="c1">// Many built-in class can be inherited the same way</span>
<span class="kd">class</span> <span class="nc">WierdList</span> <span class="kd">extends</span> <span class="n">ArrayList</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="nf">size</span><span class="o">()</span> <span class="o">{</span>  <span class="c1">// size method in this class is overridden</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WierdList</span><span class="o">()</span>
<span class="n">a</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s1">&#39;dog&#39;</span><span class="o">)</span>
<span class="n">a</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s1">&#39;cat&#39;</span><span class="o">)</span>
<span class="n">println</span> <span class="n">a</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="c1">// =&gt; 4</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN734"
>Accessing Overridden Methods</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="kd">class</span> <span class="nc">Person7</span> <span class="o">{</span> <span class="kt">def</span> <span class="n">firstname</span><span class="o">,</span> <span class="n">surname</span><span class="o">;</span> <span class="kt">def</span> <span class="n">getName</span><span class="o">(){</span> <span class="n">firstname</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">surname</span> <span class="o">}</span> <span class="o">}</span>
<span class="kd">class</span> <span class="nc">Employee2</span> <span class="kd">extends</span> <span class="n">Person7</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">employeeId</span>
    <span class="kt">def</span> <span class="nf">getName</span><span class="o">(){</span> <span class="s1">&#39;Employee Number &#39;</span> <span class="o">+</span> <span class="n">employeeId</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">getRealName</span><span class="o">(){</span> <span class="kd">super</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">}</span>
<span class="o">}</span>
<span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person7</span><span class="o">(</span><span class="nl">firstname:</span><span class="s1">&#39;Jason&#39;</span><span class="o">,</span> <span class="nl">surname:</span><span class="s1">&#39;Smythe&#39;</span><span class="o">)</span>
<span class="n">println</span> <span class="n">p</span><span class="o">.</span><span class="na">name</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Jason Smythe</span>
<span class="n">e</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Employee2</span><span class="o">(</span><span class="nl">firstname:</span><span class="s1">&#39;Jason&#39;</span><span class="o">,</span> <span class="nl">surname:</span><span class="s1">&#39;Smythe&#39;</span><span class="o">,</span> <span class="nl">employeeId:</span><span class="mi">12349876</span><span class="o">)</span>
<span class="n">println</span> <span class="n">e</span><span class="o">.</span><span class="na">name</span>
<span class="n">println</span> <span class="n">e</span><span class="o">.</span><span class="na">realName</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Employee Number 12349876</span>
<span class="c1">// Jason Smythe</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN737"
>Generating Attribute Methods Using AUTOLOAD</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy&#39;s built in constructor and auto getter/setter features</span>
 <span class="c1">// give you the required functionalty already but you could also</span>
 <span class="c1">// override invokeMethod() for trickier scenarios.</span>
<span class="kd">class</span> <span class="nc">Person8</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">name</span><span class="o">,</span> <span class="n">age</span><span class="o">,</span> <span class="n">peers</span><span class="o">,</span> <span class="n">parent</span>
    <span class="kt">def</span> <span class="nf">newChild</span><span class="o">(</span><span class="n">args</span><span class="o">)</span> <span class="o">{</span> <span class="k">new</span> <span class="n">Person8</span><span class="o">(</span><span class="nl">parent:</span><span class="k">this</span><span class="o">,</span> <span class="o">*:</span><span class="n">args</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>

<span class="n">dad</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person8</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;Jason&#39;</span><span class="o">,</span> <span class="nl">age:</span><span class="mi">23</span><span class="o">)</span>
<span class="n">kid</span> <span class="o">=</span> <span class="n">dad</span><span class="o">.</span><span class="na">newChild</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;Rachel&#39;</span><span class="o">,</span> <span class="nl">age:</span><span class="mi">2</span><span class="o">)</span>
<span class="n">println</span> <span class="s2">&quot;Kid&#39;s parent is ${kid.parent.name}&quot;</span>
<span class="c1">// =&gt; Kid&#39;s parent is Jason</span>

<span class="c1">// additional fields ...</span>
<span class="kd">class</span> <span class="nc">Employee3</span> <span class="kd">extends</span> <span class="n">Person8</span> <span class="o">{</span> <span class="kt">def</span> <span class="n">salary</span><span class="o">,</span> <span class="n">boss</span> <span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN740"
>Solving the Data Inheritance Problem</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Fields marked as private in Groovy can&#39;t be trampled by another class in</span>
<span class="c1">// the class hierarchy</span>
<span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">name</span> <span class="c1">// my child&#39;s name</span>
    <span class="kt">def</span> <span class="nf">setChildName</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="n">name</span> <span class="o">=</span> <span class="n">value</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">getChildName</span><span class="o">()</span> <span class="o">{</span> <span class="n">name</span> <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">GrandParent</span> <span class="kd">extends</span> <span class="n">Parent</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">name</span> <span class="c1">// my grandchild&#39;s name</span>
    <span class="kt">def</span> <span class="nf">setgrandChildName</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="n">name</span> <span class="o">=</span> <span class="n">value</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">getGrandChildName</span><span class="o">()</span> <span class="o">{</span> <span class="n">name</span> <span class="o">}</span>
<span class="o">}</span>
<span class="n">g</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GrandParent</span><span class="o">()</span>
<span class="n">g</span><span class="o">.</span><span class="na">childName</span> <span class="o">=</span> <span class="s1">&#39;Jason&#39;</span>
<span class="n">g</span><span class="o">.</span><span class="na">grandChildName</span> <span class="o">=</span> <span class="s1">&#39;Rachel&#39;</span>
<span class="n">println</span> <span class="n">g</span><span class="o">.</span><span class="na">childName</span>       <span class="c1">// =&gt; Jason</span>
<span class="n">println</span> <span class="n">g</span><span class="o">.</span><span class="na">grandChildName</span>  <span class="c1">// =&gt; Rachel</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN743"
>Coping with Circular Data Structures</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// The JVM garbage collector copes with circular structures.</span>
<span class="c1">// You can test it with this code:</span>
<span class="kd">class</span> <span class="nc">Person9</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">friend</span>
    <span class="kt">void</span> <span class="nf">finalize</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">println</span> <span class="s2">&quot;Object [internal id=${hashCode()}] is dying at ${new Date()}&quot;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">makeSomeFriends</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">first</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person9</span><span class="o">()</span>
    <span class="kt">def</span> <span class="n">second</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person9</span><span class="o">(</span><span class="nl">friend:</span><span class="n">first</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">third</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person9</span><span class="o">(</span><span class="nl">friend:</span><span class="n">second</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">fourth</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person9</span><span class="o">(</span><span class="nl">friend:</span><span class="n">third</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">fifth</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person9</span><span class="o">(</span><span class="nl">friend:</span><span class="n">fourth</span><span class="o">)</span>
    <span class="n">first</span><span class="o">.</span><span class="na">friend</span> <span class="o">=</span> <span class="n">fifth</span>
<span class="o">}</span>

<span class="n">makeSomeFriends</span><span class="o">()</span>
<span class="mi">100</span><span class="o">.</span><span class="na">times</span><span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">gc</span><span class="o">()</span>
<span class="o">}</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Object [internal id=24478976] is dying at Tue Jan 09 22:24:31 EST 2007</span>
<span class="c1">// Object [internal id=32853087] is dying at Tue Jan 09 22:24:31 EST 2007</span>
<span class="c1">// Object [internal id=23664622] is dying at Tue Jan 09 22:24:31 EST 2007</span>
<span class="c1">// Object [internal id=10630672] is dying at Tue Jan 09 22:24:31 EST 2007</span>
<span class="c1">// Object [internal id=25921812] is dying at Tue Jan 09 22:24:31 EST 2007</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN746"
>Overloading Operators</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy provides numerous methods which are automatically associated with</span>
<span class="c1">// symbol operators, e.g. here is &#39;&lt;=&gt;&#39; which is associated with compareTo()</span>
<span class="c1">// Suppose we have a class with a compareTo operator, such as:</span>
<span class="kd">class</span> <span class="nc">Person10</span> <span class="kd">implements</span> <span class="n">Comparable</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">firstname</span><span class="o">,</span> <span class="n">initial</span><span class="o">,</span> <span class="n">surname</span>
    <span class="n">Person10</span><span class="o">(</span><span class="n">f</span><span class="o">,</span><span class="n">i</span><span class="o">,</span><span class="n">s</span><span class="o">)</span> <span class="o">{</span> <span class="n">firstname</span> <span class="o">=</span> <span class="n">f</span><span class="o">;</span> <span class="n">initial</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span> <span class="n">surname</span> <span class="o">=</span> <span class="n">s</span> <span class="o">}</span>
    <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">other</span><span class="o">)</span> <span class="o">{</span> <span class="n">firstname</span> <span class="o">&lt;=&gt;</span> <span class="n">other</span><span class="o">.</span><span class="na">firstname</span> <span class="o">}</span>
<span class="o">}</span>
<span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person10</span><span class="o">(</span><span class="s1">&#39;James&#39;</span><span class="o">,</span> <span class="s1">&#39;T&#39;</span><span class="o">,</span> <span class="s1">&#39;Kirk&#39;</span><span class="o">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person10</span><span class="o">(</span><span class="s1">&#39;Samuel&#39;</span><span class="o">,</span> <span class="s1">&#39;L&#39;</span><span class="o">,</span> <span class="s1">&#39;Jackson&#39;</span><span class="o">)</span>
<span class="n">println</span> <span class="n">a</span> <span class="o">&lt;=&gt;</span> <span class="n">b</span>
<span class="c1">// =&gt; -1</span>

<span class="c1">// we can override the existing Person10&#39;s &lt;=&gt; operator as below</span>
<span class="c1">// so that now comparisons are made using the middle initial</span>
<span class="c1">// instead of the fisrtname:</span>
<span class="kd">class</span> <span class="nc">Person11</span> <span class="kd">extends</span> <span class="n">Person10</span> <span class="o">{</span>
    <span class="n">Person11</span><span class="o">(</span><span class="n">f</span><span class="o">,</span><span class="n">i</span><span class="o">,</span><span class="n">s</span><span class="o">)</span> <span class="o">{</span> <span class="kd">super</span><span class="o">(</span><span class="n">f</span><span class="o">,</span><span class="n">i</span><span class="o">,</span><span class="n">s</span><span class="o">)</span> <span class="o">}</span>
    <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">other</span><span class="o">)</span> <span class="o">{</span> <span class="n">initial</span> <span class="o">&lt;=&gt;</span> <span class="n">other</span><span class="o">.</span><span class="na">initial</span> <span class="o">}</span>
<span class="o">}</span>

<span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person11</span><span class="o">(</span><span class="s1">&#39;James&#39;</span><span class="o">,</span> <span class="s1">&#39;T&#39;</span><span class="o">,</span> <span class="s1">&#39;Kirk&#39;</span><span class="o">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person11</span><span class="o">(</span><span class="s1">&#39;Samuel&#39;</span><span class="o">,</span> <span class="s1">&#39;L&#39;</span><span class="o">,</span> <span class="s1">&#39;Jackson&#39;</span><span class="o">)</span>
<span class="n">println</span> <span class="n">a</span> <span class="o">&lt;=&gt;</span> <span class="n">b</span>
<span class="c1">// =&gt; 1</span>

<span class="c1">// we could also in general use Groovy&#39;s categories to extend class functionality.</span>

<span class="c1">// There is no way to directly overload the &#39;&quot;&quot;&#39; (stringify)</span>
<span class="c1">// operator in Groovy.  However, by convention, classes which</span>
<span class="c1">// can reasonably be converted to a String will define a</span>
<span class="c1">// &#39;toString()&#39; method as in the TimeNumber class defined below.</span>
<span class="c1">// The &#39;println&#39; method will automatcally call an object&#39;s</span>
<span class="c1">// &#39;toString()&#39; method as is demonstrated below. Furthermore,</span>
<span class="c1">// an object of that class can be used most any place where the</span>
<span class="c1">// interpreter is looking for a String value.</span>

<span class="c1">//---------------------------------------</span>
<span class="c1">// NOTE: Groovy has various built-in Time/Date/Calendar classes</span>
<span class="c1">// which would usually be used to manipulate time objects, the</span>
<span class="c1">// following is supplied for educational purposes to demonstrate</span>
<span class="c1">// operator overloading.</span>
<span class="kd">class</span> <span class="nc">TimeNumber</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">h</span><span class="o">,</span> <span class="n">m</span><span class="o">,</span> <span class="n">s</span>
    <span class="n">TimeNumber</span><span class="o">(</span><span class="n">hour</span><span class="o">,</span> <span class="n">min</span><span class="o">,</span> <span class="n">sec</span><span class="o">)</span> <span class="o">{</span> <span class="n">h</span> <span class="o">=</span> <span class="n">hour</span><span class="o">;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">min</span><span class="o">;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sec</span> <span class="o">}</span>

    <span class="kt">def</span> <span class="nf">toDigits</span><span class="o">(</span><span class="n">s</span><span class="o">)</span> <span class="o">{</span> <span class="n">s</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">padLeft</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="s1">&#39;0&#39;</span><span class="o">)</span> <span class="o">}</span>
    <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">toDigits</span><span class="o">(</span><span class="n">h</span><span class="o">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">toDigits</span><span class="o">(</span><span class="n">m</span><span class="o">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">toDigits</span><span class="o">(</span><span class="n">s</span><span class="o">)</span>
    <span class="o">}</span>

    <span class="kt">def</span> <span class="nf">plus</span><span class="o">(</span><span class="n">other</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="na">s</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="na">m</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="na">h</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">s</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">s</span> <span class="o">%=</span> <span class="mi">60</span>
            <span class="n">m</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">m</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">m</span> <span class="o">%=</span> <span class="mi">60</span>
            <span class="n">h</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">TimeNumber</span><span class="o">(</span><span class="n">h</span><span class="o">,</span> <span class="n">m</span><span class="o">,</span> <span class="n">s</span><span class="o">)</span>
    <span class="o">}</span>

<span class="o">}</span>

<span class="n">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TimeNumber</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">58</span><span class="o">,</span> <span class="mi">59</span><span class="o">)</span>
<span class="n">sec</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TimeNumber</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
<span class="n">min</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TimeNumber</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span>
<span class="n">println</span> <span class="n">t1</span> <span class="o">+</span> <span class="n">sec</span> <span class="o">+</span> <span class="n">min</span> <span class="o">+</span> <span class="n">min</span>

<span class="c1">//-----------------------------</span>
<span class="c1">// StrNum class example: Groovy&#39;s builtin String class already has the</span>
<span class="c1">// capabilities outlined in StrNum Perl example, however the &#39;*&#39; operator</span>
<span class="c1">// on Groovy&#39;s String class acts differently: It creates a string which</span>
<span class="c1">// is the original string repeated N times.</span>
<span class="c1">//</span>
<span class="c1">// Using Groovy&#39;s String class as is in this example:</span>
<span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;Red&quot;</span><span class="o">;</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;Black&quot;</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">z</span><span class="o">*</span><span class="mi">3</span> <span class="c1">// r is &quot;RedBlackRedBlackRedBlack&quot;</span>
<span class="n">println</span> <span class="s2">&quot;values are $x, $y, $z, and $r&quot;</span>
<span class="n">println</span> <span class="s2">&quot;$x is ${x &lt; y ? &#39;LT&#39; : &#39;GE&#39;} $y&quot;</span>
<span class="c1">// prints:</span>
<span class="c1">// values are Red, Black, RedBlack, and RedBlackRedBlackRedBlack</span>
<span class="c1">// Red is GE Black</span>

<span class="c1">//-----------------------------</span>
<span class="kd">class</span> <span class="nc">FixNum</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">REGEX</span> <span class="o">=</span> <span class="s">/(\.\d*)/</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="n">DEFAULT_PLACES</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="kt">def</span> <span class="kt">float</span> <span class="n">value</span>
    <span class="kt">def</span> <span class="kt">int</span> <span class="n">places</span>
    <span class="nf">FixNum</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">initValue</span><span class="o">(</span><span class="n">value</span><span class="o">)</span>
        <span class="kt">def</span> <span class="n">m</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span> <span class="o">=~</span> <span class="n">REGEX</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">m</span><span class="o">)</span> <span class="n">places</span> <span class="o">=</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">1</span><span class="o">].</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">else</span> <span class="n">places</span> <span class="o">=</span> <span class="n">DEFAULT_PLACES</span>
    <span class="o">}</span>
    <span class="n">FixNum</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">places</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">initValue</span><span class="o">(</span><span class="n">value</span><span class="o">)</span>
        <span class="k">this</span><span class="o">.</span><span class="na">places</span> <span class="o">=</span> <span class="n">places</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="nf">initValue</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="o">}</span>

    <span class="kt">def</span> <span class="nf">plus</span><span class="o">(</span><span class="n">other</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">new</span> <span class="nf">FixNum</span><span class="o">(</span><span class="n">value</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="na">value</span><span class="o">,</span> <span class="o">[</span><span class="n">places</span><span class="o">,</span> <span class="n">other</span><span class="o">.</span><span class="na">places</span><span class="o">].</span><span class="na">max</span><span class="o">())</span>
    <span class="o">}</span>

    <span class="kt">def</span> <span class="nf">multiply</span><span class="o">(</span><span class="n">other</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">new</span> <span class="nf">FixNum</span><span class="o">(</span><span class="n">value</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="na">value</span><span class="o">,</span> <span class="o">[</span><span class="n">places</span><span class="o">,</span> <span class="n">other</span><span class="o">.</span><span class="na">places</span><span class="o">].</span><span class="na">max</span><span class="o">())</span>
    <span class="o">}</span>

    <span class="kt">def</span> <span class="nf">div</span><span class="o">(</span><span class="n">other</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">println</span> <span class="s2">&quot;DEUG: Divide = ${value/other.value}&quot;</span>
        <span class="kt">def</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FixNum</span><span class="o">(</span><span class="n">value</span><span class="s">/other.value)</span>
<span class="s">        result.places = [places,other.places].max()</span>
<span class="s">        result</span>
<span class="s">    }</span>

<span class="s">    String toString() {</span>
<span class="s">        //m = value.toString() =~ /</span><span class="o">(</span><span class="err">\</span><span class="n">d</span><span class="o">)</span><span class="s">/ + REGEX</span>
<span class="s">        String.format(&quot;STR%s: %.${places}f&quot;, [this.class.name, value as float] as Object[])</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">x = new FixNum(40)</span>
<span class="s">y = new FixNum(12, 0)</span>

<span class="s">println &quot;sum of $x and $y is ${x+y}&quot;</span>
<span class="s">println &quot;product of $x and $y is ${x*y}&quot;</span>

<span class="s">z = x/</span><span class="n">y</span>
<span class="n">println</span> <span class="s2">&quot;$z has $z.places places&quot;</span>
<span class="n">z</span><span class="o">.</span><span class="na">places</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">println</span> <span class="s2">&quot;$z now has $z.places places&quot;</span>

<span class="n">println</span> <span class="s2">&quot;div of $x by $y is $z&quot;</span>
<span class="n">println</span> <span class="s2">&quot;square of that is ${z*z}&quot;</span>
<span class="c1">// =&gt;</span>
<span class="c1">// sum of STRFixNum: 40 and STRFixNum: 12 is STRFixNum: 52</span>
<span class="c1">// product of STRFixNum: 40 and STRFixNum: 12 is STRFixNum: 480</span>
<span class="c1">// DEUG: Divide = 3.3333333333333335</span>
<span class="c1">// STRFixNum: 3 has 0 places</span>
<span class="c1">// STRFixNum: 3.33 now has 2 places</span>
<span class="c1">// div of STRFixNum: 40 by STRFixNum: 12 is STRFixNum: 3.33</span>
<span class="c1">// square of that is STRFixNum: 11.11</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN749"
>Creating Magic Variables with tie</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy doesn&#39;t use the tie terminology but you can achieve</span>
<span class="c1">// similar results with Groovy&#39;s metaprogramming facilities</span>
<span class="kd">class</span> <span class="nc">ValueRing</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">values</span>
    <span class="kt">def</span> <span class="nf">add</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="n">values</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">next</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">def</span> <span class="n">head</span> <span class="o">=</span> <span class="n">values</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">[</span><span class="mi">1</span><span class="o">..-</span><span class="mi">1</span><span class="o">]</span> <span class="o">+</span> <span class="n">head</span>
        <span class="k">return</span> <span class="n">head</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">ring</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ValueRing</span><span class="o">(</span><span class="nl">values:</span><span class="o">[</span><span class="s1">&#39;red&#39;</span><span class="o">,</span> <span class="s1">&#39;blue&#39;</span><span class="o">])</span>
<span class="kt">def</span> <span class="nf">getColor</span><span class="o">()</span> <span class="o">{</span> <span class="n">ring</span><span class="o">.</span><span class="na">next</span><span class="o">()</span> <span class="o">}</span>
<span class="kt">void</span> <span class="nf">setProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">n</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="s1">&#39;color&#39;</span><span class="o">)</span> <span class="o">{</span> <span class="n">ring</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">v</span><span class="o">);</span> <span class="k">return</span> <span class="o">}</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">n</span><span class="o">,</span><span class="n">v</span><span class="o">)</span>
<span class="o">}</span>

<span class="n">println</span> <span class="s2">&quot;$color $color $color $color $color $color&quot;</span>
<span class="c1">// =&gt; red blue red blue red blue</span>

<span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span>
<span class="n">println</span> <span class="s2">&quot;$color $color $color $color $color $color&quot;</span>
<span class="c1">// =&gt; green red blue green red blue</span>

<span class="c1">// Groovy doesn&#39;t have the $_ implicit variable so we can&#39;t show an</span>
<span class="c1">// example that gets rid of it. We can however show an example of how</span>
<span class="c1">// you could add in a simplified version of that facility into Groovy.</span>
<span class="c1">// We use Groovy&#39;s metaProgramming facilities. We execute our script</span>
<span class="c1">// in a new GroovyShell so that we don&#39;t affect subsequent examples.</span>
<span class="c1">// script:</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">println</span> <span class="s2">&quot;$_&quot;</span>
<span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;cat&#39;</span> <span class="o">*</span> <span class="n">x</span>
<span class="n">println</span> <span class="s2">&quot;$_&quot;</span>

<span class="c1">// metaUnderscore:</span>
<span class="kt">void</span> <span class="nf">setProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">n</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s1">&#39;_&#39;</span><span class="o">,</span><span class="n">v</span><span class="o">)</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">n</span><span class="o">,</span><span class="n">v</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">new</span> <span class="nf">GroovyShell</span><span class="o">().</span><span class="na">evaluate</span><span class="o">(</span><span class="n">metaUnderscore</span> <span class="o">+</span> <span class="n">script</span><span class="o">)</span>
<span class="c1">// =&gt;</span>
<span class="c1">// 3</span>
<span class="c1">// catcatcat</span>

<span class="c1">// We can get a little bit fancier by making an UnderscoreAware class</span>
<span class="c1">// that wraps up some of this functionality. This is not recommended</span>
<span class="c1">// as good Groovy style but mimicks the $_ behaviour in a sinple way.</span>
<span class="kd">class</span> <span class="nc">UnderscoreAware</span> <span class="kd">implements</span> <span class="n">GroovyInterceptable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">_saved</span>
    <span class="kt">void</span> <span class="nf">setProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">n</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">_saved</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">this</span><span class="o">.</span><span class="na">metaClass</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">n</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">getProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="o">)</span> <span class="k">return</span> <span class="n">_saved</span>
        <span class="k">this</span><span class="o">.</span><span class="na">metaClass</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">n</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">invokeMethod</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Object</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s1">&#39;print&#39;</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">args</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="o">[</span><span class="n">_saved</span><span class="o">]</span> <span class="k">as</span> <span class="n">Object</span><span class="o">[]</span>
        <span class="k">this</span><span class="o">.</span><span class="na">metaClass</span><span class="o">.</span><span class="na">invokeMethod</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">args</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">PerlishClass</span> <span class="kd">extends</span> <span class="n">UnderscoreAware</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">_age</span>
    <span class="kt">def</span> <span class="nf">setAge</span><span class="o">(</span><span class="n">age</span><span class="o">){</span> <span class="n">_age</span> <span class="o">=</span> <span class="n">age</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">getAge</span><span class="o">(){</span> <span class="n">_age</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">age</span> <span class="o">=</span> <span class="mi">25</span>
        <span class="n">println</span> <span class="s2">&quot;$_&quot;</span>   <span class="c1">// explicit $_ supported</span>
        <span class="n">age</span><span class="o">++</span>
        <span class="n">println</span><span class="o">()</span>      <span class="c1">// implicit $_ will be injected</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="n">x</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PerlishClass</span><span class="o">()</span>
<span class="n">x</span><span class="o">.</span><span class="na">test</span><span class="o">()</span>
<span class="c1">// =&gt;</span>
<span class="c1">// 25</span>
<span class="c1">// 26</span>

<span class="c1">// Autoappending hash:</span>
<span class="kd">class</span> <span class="nc">AutoMap</span> <span class="kd">extends</span> <span class="n">HashMap</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">setProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">containsKey</span><span class="o">(</span><span class="n">name</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">get</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">+</span> <span class="n">v</span><span class="o">)</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="o">[</span><span class="n">v</span><span class="o">])</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AutoMap</span><span class="o">()</span>
<span class="n">m</span><span class="o">.</span><span class="na">beer</span> <span class="o">=</span> <span class="s1">&#39;guinness&#39;</span>
<span class="n">m</span><span class="o">.</span><span class="na">food</span> <span class="o">=</span> <span class="s1">&#39;potatoes&#39;</span>
<span class="n">m</span><span class="o">.</span><span class="na">food</span> <span class="o">=</span> <span class="s1">&#39;peas&#39;</span>
<span class="n">println</span> <span class="n">m</span>
<span class="c1">// =&gt; [&quot;food&quot;:[&quot;potatoes&quot;, &quot;peas&quot;], &quot;beer&quot;:[&quot;guinness&quot;]]</span>

<span class="c1">// Case-Insensitive Hash:</span>
<span class="kd">class</span> <span class="nc">FoldedMap</span> <span class="kd">extends</span> <span class="n">HashMap</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">setProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">put</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(),</span> <span class="n">v</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">getProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">get</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">())</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">tab</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FoldedMap</span><span class="o">()</span>
<span class="n">tab</span><span class="o">.</span><span class="na">VILLAIN</span> <span class="o">=</span> <span class="s1">&#39;big &#39;</span>
<span class="n">tab</span><span class="o">.</span><span class="na">herOine</span> <span class="o">=</span> <span class="s1">&#39;red riding hood&#39;</span>
<span class="n">tab</span><span class="o">.</span><span class="na">villain</span> <span class="o">+=</span> <span class="s1">&#39;bad wolf&#39;</span>
<span class="n">println</span> <span class="n">tab</span>
<span class="c1">// =&gt; [&quot;heroine&quot;:&quot;red riding hood&quot;, &quot;villain&quot;:&quot;big bad wolf&quot;]</span>

<span class="c1">// Hash That &quot;Allows Look-Ups by Key or Value&quot;:</span>
<span class="kd">class</span> <span class="nc">RevMap</span> <span class="kd">extends</span> <span class="n">HashMap</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">setProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">n</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span> <span class="n">put</span><span class="o">(</span><span class="n">n</span><span class="o">,</span><span class="n">v</span><span class="o">);</span> <span class="n">put</span><span class="o">(</span><span class="n">v</span><span class="o">,</span><span class="n">n</span><span class="o">)</span> <span class="o">}</span>
    <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="kd">super</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="n">n</span><span class="o">));</span> <span class="kd">super</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>
<span class="n">rev</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RevMap</span><span class="o">()</span>
<span class="n">rev</span><span class="o">.</span><span class="na">Rojo</span> <span class="o">=</span> <span class="s1">&#39;Red&#39;</span>
<span class="n">rev</span><span class="o">.</span><span class="na">Azul</span> <span class="o">=</span> <span class="s1">&#39;Blue&#39;</span>
<span class="n">rev</span><span class="o">.</span><span class="na">Verde</span> <span class="o">=</span> <span class="s1">&#39;Green&#39;</span>
<span class="n">rev</span><span class="o">.</span><span class="na">EVIL</span> <span class="o">=</span> <span class="o">[</span> <span class="s2">&quot;No way!&quot;</span><span class="o">,</span> <span class="s2">&quot;Way!!&quot;</span> <span class="o">]</span>
<span class="n">rev</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="s1">&#39;Red&#39;</span><span class="o">)</span>
<span class="n">rev</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="s1">&#39;Azul&#39;</span><span class="o">)</span>
<span class="n">println</span> <span class="n">rev</span>
<span class="c1">// =&gt;</span>
<span class="c1">// [[&quot;No way!&quot;, &quot;Way!!&quot;]:&quot;EVIL&quot;, &quot;EVIL&quot;:[&quot;No way!&quot;, &quot;Way!!&quot;], &quot;Verde&quot;:&quot;Green&quot;, &quot;Green&quot;:&quot;Verde&quot;]</span>

<span class="c1">// Infinite loop scenario:</span>
<span class="c1">// def x(n) { x(++n) }; x(0)</span>
<span class="c1">// =&gt; Caught: java.lang.StackOverflowError</span>

<span class="c1">// Multiple Strrams scenario:</span>
<span class="kd">class</span> <span class="nc">MultiStream</span> <span class="kd">extends</span> <span class="n">PrintStream</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">streams</span>
    <span class="nf">MultiStream</span><span class="o">(</span><span class="n">List</span> <span class="n">streams</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">streams</span><span class="o">[</span><span class="mi">0</span><span class="o">])</span>
        <span class="k">this</span><span class="o">.</span><span class="na">streams</span> <span class="o">=</span> <span class="n">streams</span>
    <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">println</span><span class="o">(</span><span class="n">String</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">streams</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">tee</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MultiStream</span><span class="o">([</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">])</span>
<span class="n">tee</span><span class="o">.</span><span class="na">println</span> <span class="o">(</span><span class="s1">&#39;This goes two places&#39;</span><span class="o">)</span>
<span class="c1">// =&gt;</span>
<span class="c1">// This goes two places</span>
<span class="c1">// This goes two places</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="packagesetc.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="dbaccess.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Packages, Libraries, and Modules</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Database Access</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>