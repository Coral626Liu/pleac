<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Internet Services</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Groovy"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Sockets"
HREF="sockets.html"><LINK
REL="NEXT"
TITLE="CGI Programming"
HREF="cgiprogramming.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Groovy</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="sockets.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="cgiprogramming.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="INTERNETSERVICES"
>18. Internet Services</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN978"
>Simple DNS Lookups</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;www.perl.com&#39;</span>
<span class="n">addresses</span> <span class="o">=</span> <span class="n">InetAddress</span><span class="o">.</span><span class="na">getAllByName</span><span class="o">(</span><span class="n">name</span><span class="o">)</span>
<span class="n">println</span> <span class="n">addresses</span> <span class="c1">// =&gt; {www.perl.com/208.201.239.36, www.perl.com/208.201.239.37}</span>
<span class="c1">// or to just resolve one:</span>
<span class="n">println</span> <span class="n">InetAddress</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="c1">// =&gt; www.perl.com/208.201.239.36</span>
<span class="c1">// try a different address</span>
<span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;groovy.codehaus.org&#39;</span>
<span class="n">addresses</span> <span class="o">=</span> <span class="n">InetAddress</span><span class="o">.</span><span class="na">getAllByName</span><span class="o">(</span><span class="n">name</span><span class="o">)</span>
<span class="n">println</span> <span class="n">addresses</span> <span class="c1">// =&gt; {groovy.codehaus.org/63.246.7.187}</span>
<span class="c1">// starting with IP address</span>
<span class="n">address</span> <span class="o">=</span> <span class="n">InetAddress</span><span class="o">.</span><span class="na">getByAddress</span><span class="o">([</span><span class="mi">208</span><span class="o">,</span> <span class="mi">201</span><span class="o">,</span> <span class="mi">239</span><span class="o">,</span> <span class="mi">36</span><span class="o">]</span> <span class="k">as</span> <span class="kt">byte</span><span class="o">[])</span>
<span class="n">println</span> <span class="n">address</span><span class="o">.</span><span class="na">hostName</span> <span class="c1">// =&gt; www.oreillynet.com</span>

<span class="c1">// For more complex operations use dnsjava: http://www.dnsjava.org/</span>
<span class="kn">import</span> <span class="nn">org.xbill.DNS.*</span>
<span class="n">System</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s2">&quot;sun.net.spi.nameservice.provider.1&quot;</span><span class="o">,</span><span class="s2">&quot;dns,dnsjava&quot;</span><span class="o">)</span>
<span class="n">Lookup</span> <span class="n">lookup</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Lookup</span><span class="o">(</span><span class="s1">&#39;cnn.com&#39;</span><span class="o">,</span> <span class="n">Type</span><span class="o">.</span><span class="na">ANY</span><span class="o">)</span>
<span class="n">records</span> <span class="o">=</span> <span class="n">lookup</span><span class="o">.</span><span class="na">run</span><span class="o">()</span>
<span class="n">println</span> <span class="s2">&quot;${records?.size()} record(s) found&quot;</span>
<span class="n">records</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">println</span> <span class="n">it</span> <span class="o">}</span>
<span class="c1">// =&gt;</span>
<span class="c1">// 17 record(s) found</span>
<span class="c1">// cnn.com.     55  IN  A   64.236.16.20</span>
<span class="c1">// cnn.com.     55  IN  A   64.236.16.52</span>
<span class="c1">// cnn.com.     55  IN  A   64.236.16.84</span>
<span class="c1">// cnn.com.     55  IN  A   64.236.16.116</span>
<span class="c1">// cnn.com.     55  IN  A   64.236.24.12</span>
<span class="c1">// cnn.com.     55  IN  A   64.236.24.20</span>
<span class="c1">// cnn.com.     55  IN  A   64.236.24.28</span>
<span class="c1">// cnn.com.     55  IN  A   64.236.29.120</span>
<span class="c1">// cnn.com.     324 IN  NS  twdns-02.ns.aol.com.</span>
<span class="c1">// cnn.com.     324 IN  NS  twdns-03.ns.aol.com.</span>
<span class="c1">// cnn.com.     324 IN  NS  twdns-04.ns.aol.com.</span>
<span class="c1">// cnn.com.     324 IN  NS  twdns-01.ns.aol.com.</span>
<span class="c1">// cnn.com.     3324    IN  SOA twdns-01.ns.aol.com. hostmaster.tbsnames.turner.com. 2007011203 900 300 604801 900</span>
<span class="c1">// cnn.com.     3324    IN  MX  10 atlmail3.turner.com.</span>
<span class="c1">// cnn.com.     3324    IN  MX  10 atlmail5.turner.com.</span>
<span class="c1">// cnn.com.     3324    IN  MX  20 nycmail2.turner.com.</span>
<span class="c1">// cnn.com.     3324    IN  MX  30 nycmail1.turner.com.</span>

<span class="c1">// faster reverse lookup using dnsjava</span>
<span class="kt">def</span> <span class="nf">reverseDns</span><span class="o">(</span><span class="n">hostIp</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">ReverseMap</span><span class="o">.</span><span class="na">fromAddress</span><span class="o">(</span><span class="n">hostIp</span><span class="o">)</span>
    <span class="n">rec</span> <span class="o">=</span> <span class="n">Record</span><span class="o">.</span><span class="na">newRecord</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">Type</span><span class="o">.</span><span class="na">PTR</span><span class="o">,</span> <span class="n">DClass</span><span class="o">.</span><span class="na">IN</span><span class="o">)</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">Message</span><span class="o">.</span><span class="na">newQuery</span><span class="o">(</span><span class="n">rec</span><span class="o">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ExtendedResolver</span><span class="o">().</span><span class="na">send</span><span class="o">(</span><span class="n">query</span><span class="o">)</span>
    <span class="n">answers</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getSectionArray</span><span class="o">(</span><span class="n">Section</span><span class="o">.</span><span class="na">ANSWER</span><span class="o">)</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">answers</span><span class="o">)</span> <span class="k">return</span> <span class="n">answers</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">rdataToString</span><span class="o">()</span> <span class="k">else</span> <span class="k">return</span> <span class="n">hostIp</span>
<span class="o">}</span>
<span class="n">println</span> <span class="s1">&#39;208.201.239.36 =&gt; &#39;</span> <span class="o">+</span> <span class="n">reverseDns</span><span class="o">(</span><span class="s1">&#39;208.201.239.36&#39;</span><span class="o">)</span>
<span class="c1">// =&gt; 208.201.239.36 =&gt; www.oreillynet.com.</span>

<span class="kt">def</span> <span class="nf">hostAddrs</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">addresses</span> <span class="o">=</span> <span class="n">Address</span><span class="o">.</span><span class="na">getAllByName</span><span class="o">(</span><span class="n">name</span><span class="o">)</span>
    <span class="n">println</span> <span class="n">addresses</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">canonicalHostName</span> <span class="o">+</span> <span class="s1">&#39; =&gt; &#39;</span> <span class="o">+</span> <span class="n">addresses</span><span class="o">.</span><span class="na">collect</span><span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">hostAddress</span> <span class="o">}.</span><span class="na">join</span><span class="o">(</span><span class="s1">&#39; &#39;</span><span class="o">)</span>
<span class="o">}</span>
<span class="n">hostAddrs</span><span class="o">(</span><span class="s1">&#39;www.ora.com&#39;</span><span class="o">)</span>
<span class="c1">// =&gt; www.oreillynet.com. =&gt; 208.201.239.36 208.201.239.37</span>
<span class="n">hostAddrs</span><span class="o">(</span><span class="s1">&#39;www.whitehouse.gov&#39;</span><span class="o">)</span>
<span class="c1">// =&gt; 61.9.209.153 =&gt; 61.9.209.153 61.9.209.151</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN981"
>Being an FTP Client</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// commons net examples (explicit error handling not shown)</span>
<span class="kn">import</span> <span class="nn">java.text.DateFormat</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.net.ftp.FTPClient</span>
<span class="c1">// connect</span>
<span class="n">server</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>                   <span class="c1">//server = &quot;ftp.host.com&quot;</span>

<span class="n">ftp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FTPClient</span><span class="o">()</span>
<span class="n">ftp</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span> <span class="n">server</span> <span class="o">)</span>
<span class="n">ftp</span><span class="o">.</span><span class="na">login</span><span class="o">(</span> <span class="s1">&#39;anonymous&#39;</span><span class="o">,</span> <span class="s1">&#39;guest&#39;</span> <span class="o">)</span>     <span class="c1">//ftp.login( &#39;username&#39;, &#39;password&#39; )</span>

<span class="n">println</span> <span class="s2">&quot;Connected to $server. $ftp.replyString&quot;</span>

<span class="c1">// retrieve file</span>
<span class="n">ftp</span><span class="o">.</span><span class="na">changeWorkingDirectory</span><span class="o">(</span> <span class="s1">&#39;.&#39;</span> <span class="o">)</span>  <span class="c1">//ftp.changeWorkingDirectory( &#39;serverFolder&#39; )</span>
<span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">&#39;README.txt&#39;</span><span class="o">)</span> <span class="c1">//new File(&#39;localFolder&#39; + File.separator + &#39;localFilename&#39;)</span>

<span class="n">file</span><span class="o">.</span><span class="na">withOutputStream</span><span class="o">{</span> <span class="n">os</span> <span class="o">-&gt;</span>
    <span class="n">ftp</span><span class="o">.</span><span class="na">retrieveFile</span><span class="o">(</span> <span class="s1">&#39;README.txt&#39;</span><span class="o">,</span> <span class="n">os</span> <span class="o">)</span>  <span class="c1">//ftp.retrieveFile( &#39;serverFilename&#39;, os )</span>
<span class="o">}</span>

<span class="c1">// upload file</span>
<span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">&#39;otherFile.txt&#39;</span><span class="o">)</span> <span class="c1">//new File(&#39;localFolder&#39; + File.separator + &#39;localFilename&#39;)</span>
<span class="n">file</span><span class="o">.</span><span class="na">withInputStream</span><span class="o">{</span> <span class="n">fis</span> <span class="o">-&gt;</span> <span class="n">ftp</span><span class="o">.</span><span class="na">storeFile</span><span class="o">(</span> <span class="s1">&#39;otherFile.txt&#39;</span><span class="o">,</span> <span class="n">fis</span> <span class="o">)</span> <span class="o">}</span>

<span class="c1">// List the files in the directory</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">ftp</span><span class="o">.</span><span class="na">listFiles</span><span class="o">()</span>
<span class="n">println</span> <span class="s2">&quot;Number of files in dir: $files.length&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">DateFormat</span><span class="o">.</span><span class="na">getDateInstance</span><span class="o">(</span> <span class="n">DateFormat</span><span class="o">.</span><span class="na">SHORT</span> <span class="o">)</span>
<span class="n">files</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">file</span> <span class="o">-&gt;</span>
    <span class="n">println</span> <span class="s2">&quot;${df.format(file.timestamp.time)}\t $file.name&quot;</span>
<span class="o">}</span>

<span class="c1">// Logout from the FTP Server and disconnect</span>
<span class="n">ftp</span><span class="o">.</span><span class="na">logout</span><span class="o">()</span>
<span class="n">ftp</span><span class="o">.</span><span class="na">disconnect</span><span class="o">()</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Connected to localhost. 230 User logged in, proceed.</span>
<span class="c1">// Number of files in dir: 2</span>
<span class="c1">// 18/01/07  otherFile.txt</span>
<span class="c1">// 25/04/06  README.txt</span>


<span class="c1">// Using AntBuilder; for more details, see:</span>
<span class="c1">// http://ant.apache.org/manual/OptionalTasks/ftp.html</span>
<span class="n">ant</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AntBuilder</span><span class="o">()</span>
<span class="n">ant</span><span class="o">.</span><span class="na">ftp</span><span class="o">(</span><span class="nl">action:</span><span class="s1">&#39;send&#39;</span><span class="o">,</span> <span class="nl">server:</span><span class="s1">&#39;ftp.hypothetical.india.org&#39;</span><span class="o">,</span> <span class="nl">port:</span><span class="s1">&#39;2121&#39;</span><span class="o">,</span>
        <span class="nl">remotedir:</span><span class="s1">&#39;/pub/incoming&#39;</span><span class="o">,</span> <span class="nl">userid:</span><span class="s1">&#39;coder&#39;</span><span class="o">,</span> <span class="nl">password:</span><span class="s1">&#39;java1&#39;</span><span class="o">,</span>
        <span class="nl">depends:</span><span class="s1">&#39;yes&#39;</span><span class="o">,</span> <span class="nl">binary:</span><span class="s1">&#39;no&#39;</span><span class="o">,</span> <span class="nl">systemTypeKey:</span><span class="s1">&#39;Windows&#39;</span><span class="o">,</span>
        <span class="nl">serverTimeZoneConfig:</span><span class="s1">&#39;India/Calcutta&#39;</span><span class="o">){</span>
    <span class="n">fileset</span><span class="o">(</span><span class="nl">dir:</span><span class="s1">&#39;htdocs/manual&#39;</span><span class="o">){</span>
        <span class="n">include</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;**/*.html&#39;</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN984"
>Sending Mail</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// using AntBuilder; for more info, see:</span>
<span class="c1">// http://ant.apache.org/manual/CoreTasks/mail.html</span>
<span class="n">ant</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AntBuilder</span><span class="o">()</span>
<span class="n">ant</span><span class="o">.</span><span class="na">mail</span><span class="o">(</span><span class="nl">mailhost:</span><span class="s1">&#39;smtp.myisp.com&#39;</span><span class="o">,</span> <span class="nl">mailport:</span><span class="s1">&#39;1025&#39;</span><span class="o">,</span> <span class="nl">subject:</span><span class="s1">&#39;Test build&#39;</span><span class="o">){</span>
  <span class="n">from</span><span class="o">(</span><span class="nl">address:</span><span class="s1">&#39;config@myisp.com&#39;</span><span class="o">)</span>
  <span class="n">replyto</span><span class="o">(</span><span class="nl">address:</span><span class="s1">&#39;me@myisp.com&#39;</span><span class="o">)</span>
  <span class="n">to</span><span class="o">(</span><span class="nl">address:</span><span class="s1">&#39;all@xyz.com&#39;</span><span class="o">)</span>
  <span class="n">message</span><span class="o">(</span><span class="s2">&quot;The ${buildname} nightly build has completed&quot;</span><span class="o">)</span>
  <span class="n">attachments</span><span class="o">(){</span> <span class="c1">// ant 1.7 uses files attribute in earlier versions</span>
    <span class="n">fileset</span><span class="o">(</span><span class="nl">dir:</span><span class="s1">&#39;dist&#39;</span><span class="o">){</span>
      <span class="n">include</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;**/*.zip&#39;</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// using commons net</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.net.smtp.*</span>
<span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SMTPClient</span><span class="o">()</span>
<span class="n">client</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span> <span class="s2">&quot;mail.myserver.com&quot;</span><span class="o">,</span> <span class="mi">25</span> <span class="o">)</span>
<span class="k">if</span><span class="o">(</span> <span class="o">!</span><span class="n">SMTPReply</span><span class="o">.</span><span class="na">isPositiveCompletion</span><span class="o">(</span><span class="n">client</span><span class="o">.</span><span class="na">replyCode</span><span class="o">)</span> <span class="o">)</span> <span class="o">{</span>
    <span class="n">client</span><span class="o">.</span><span class="na">disconnect</span><span class="o">()</span>
    <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s2">&quot;SMTP server refused connection.&quot;</span><span class="o">)</span>
    <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
<span class="o">}</span>

<span class="c1">// Login</span>
<span class="n">client</span><span class="o">.</span><span class="na">login</span><span class="o">(</span> <span class="s2">&quot;myserver.com&quot;</span> <span class="o">)</span>

<span class="c1">// Set the sender and recipient(s)</span>
<span class="n">client</span><span class="o">.</span><span class="na">setSender</span><span class="o">(</span> <span class="s2">&quot;config@myisp.com&quot;</span> <span class="o">)</span>
<span class="n">client</span><span class="o">.</span><span class="na">addRecipient</span><span class="o">(</span> <span class="s2">&quot;all@xyz.com&quot;</span> <span class="o">)</span>

<span class="c1">// Use the SimpleSMTPHeader class to build the header</span>
<span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span> <span class="n">client</span><span class="o">.</span><span class="na">sendMessageData</span><span class="o">()</span> <span class="o">)</span>
<span class="n">header</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleSMTPHeader</span><span class="o">(</span> <span class="s2">&quot;config@myisp.com&quot;</span><span class="o">,</span> <span class="s2">&quot;all@xyz.com&quot;</span><span class="o">,</span> <span class="s2">&quot;My Subject&quot;</span><span class="o">)</span>
<span class="n">header</span><span class="o">.</span><span class="na">addCC</span><span class="o">(</span> <span class="s2">&quot;me@myisp.com&quot;</span> <span class="o">)</span>
<span class="n">header</span><span class="o">.</span><span class="na">addHeaderField</span><span class="o">(</span> <span class="s2">&quot;Organization&quot;</span><span class="o">,</span> <span class="s2">&quot;My Company&quot;</span> <span class="o">)</span>

<span class="c1">// Write the header to the SMTP Server</span>
<span class="n">writer</span><span class="o">.</span><span class="na">write</span><span class="o">(</span> <span class="n">header</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span> <span class="o">)</span>

<span class="c1">// Write the body of the message</span>
<span class="n">writer</span><span class="o">.</span><span class="na">write</span><span class="o">(</span> <span class="s2">&quot;This is a test...&quot;</span> <span class="o">)</span>

<span class="c1">// Close the writer </span>
<span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="k">if</span> <span class="o">(</span> <span class="o">!</span><span class="n">client</span><span class="o">.</span><span class="na">completePendingCommand</span><span class="o">()</span> <span class="o">)</span> <span class="c1">// failure</span>
    <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span> <span class="mi">1</span> <span class="o">)</span>

<span class="c1">// Logout from the e-mail server (QUIT) and close connection</span>
<span class="n">client</span><span class="o">.</span><span class="na">logout</span><span class="o">()</span>
<span class="n">client</span><span class="o">.</span><span class="na">disconnect</span><span class="o">()</span>

<span class="c1">// You can also use JavaMail; for more details, see:</span>
<span class="c1">// http://java.sun.com/products/javamail/</span>

<span class="c1">// For testing programs which send emails, consider:</span>
<span class="c1">// Dumbster (http://quintanasoft.com/dumbster/)</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN987"
>Reading and Posting Usenet News Messages</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// slight variation to original cookbook:</span>
<span class="c1">// prints 1st, 2nd and last articles from random newsgroup</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.net.nntp.NNTPClient</span>
<span class="n">postingPerm</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;Unknown&#39;</span><span class="o">,</span> <span class="s1">&#39;Moderated&#39;</span><span class="o">,</span> <span class="s1">&#39;Permitted&#39;</span><span class="o">,</span> <span class="s1">&#39;Prohibited&#39;</span><span class="o">]</span>
<span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NNTPClient</span><span class="o">()</span>
<span class="n">client</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="s2">&quot;news.example.com&quot;</span><span class="o">)</span>
<span class="n">list</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">listNewsgroups</span><span class="o">()</span>
<span class="n">println</span> <span class="s2">&quot;Found ${list.size()} newsgroups&quot;</span>
<span class="n">aList</span> <span class="o">=</span> <span class="n">list</span><span class="o">[</span><span class="k">new</span> <span class="n">Random</span><span class="o">().</span><span class="na">nextInt</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">())]</span>
<span class="n">println</span> <span class="s2">&quot;$aList.newsgroup has $aList.articleCount articles&quot;</span>
<span class="n">println</span> <span class="s2">&quot;PostingPermission = ${postingPerm[aList.postingPermission]}&quot;</span>
<span class="n">first</span> <span class="o">=</span> <span class="n">aList</span><span class="o">.</span><span class="na">firstArticle</span>
<span class="n">println</span> <span class="s2">&quot;First=$first, Last=$aList.lastArticle&quot;</span>
<span class="n">client</span><span class="o">.</span><span class="na">retrieveArticle</span><span class="o">(</span><span class="n">first</span><span class="o">)?.</span><span class="na">eachLine</span><span class="o">{</span> <span class="n">println</span> <span class="n">it</span> <span class="o">}</span>
<span class="n">client</span><span class="o">.</span><span class="na">selectNextArticle</span><span class="o">()</span>
<span class="n">client</span><span class="o">.</span><span class="na">retrieveArticle</span><span class="o">()?.</span><span class="na">eachLine</span><span class="o">{</span> <span class="n">println</span> <span class="n">it</span> <span class="o">}</span>
<span class="n">client</span><span class="o">.</span><span class="na">retrieveArticle</span><span class="o">(</span><span class="n">aList</span><span class="o">.</span><span class="na">lastArticle</span><span class="o">)?.</span><span class="na">eachLine</span><span class="o">{</span> <span class="n">println</span> <span class="n">it</span> <span class="o">}</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">postArticle</span><span class="o">()</span>
<span class="c1">// ... use writer ...</span>
<span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="n">client</span><span class="o">.</span><span class="na">logout</span><span class="o">()</span>
<span class="k">if</span> <span class="o">(</span><span class="n">client</span><span class="o">.</span><span class="na">isConnected</span><span class="o">())</span> <span class="n">client</span><span class="o">.</span><span class="na">disconnect</span><span class="o">()</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Found 37025 newsgroups</span>
<span class="c1">// alt.comp.sys.palmtops.pilot has 730 articles</span>
<span class="c1">// PostingPermission = Permitted</span>
<span class="c1">// First=21904, Last=22633</span>
<span class="c1">// ...</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN990"
>Reading Mail with POP3</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// slight variation to original cookbook to print summary of messages on server</span>
<span class="c1">// uses commons net</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.net.pop3.POP3Client</span>
<span class="n">server</span> <span class="o">=</span> <span class="s1">&#39;pop.myisp.com&#39;</span>
<span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;gnat&#39;</span>
<span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;S33kr1T Pa55w0rD&#39;</span>
<span class="n">timeoutMillis</span> <span class="o">=</span> <span class="mi">30000</span>

<span class="kt">def</span> <span class="nf">printMessageInfo</span><span class="o">(</span><span class="n">reader</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">from</span><span class="o">,</span> <span class="n">subject</span>
    <span class="n">reader</span><span class="o">.</span><span class="na">eachLine</span><span class="o">{</span> <span class="n">line</span> <span class="o">-&gt;</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">()</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">lower</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s2">&quot;from: &quot;</span><span class="o">))</span> <span class="n">from</span> <span class="o">=</span> <span class="n">line</span><span class="o">[</span><span class="mi">6</span><span class="o">..-</span><span class="mi">1</span><span class="o">].</span><span class="na">trim</span><span class="o">()</span>
        <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">lower</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s2">&quot;subject: &quot;</span><span class="o">))</span> <span class="n">subject</span> <span class="o">=</span> <span class="n">line</span><span class="o">[</span><span class="mi">9</span><span class="o">..-</span><span class="mi">1</span><span class="o">].</span><span class="na">trim</span><span class="o">()</span>
    <span class="o">}</span>
    <span class="n">println</span> <span class="s2">&quot;$id From: $from, Subject: $subject&quot;</span>
<span class="o">}</span>

<span class="n">pop3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">POP3Client</span><span class="o">()</span>
<span class="n">pop3</span><span class="o">.</span><span class="na">setDefaultTimeout</span><span class="o">(</span><span class="n">timeoutMillis</span><span class="o">)</span>
<span class="n">pop3</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">server</span><span class="o">)</span>

<span class="k">if</span> <span class="o">(!</span><span class="n">pop3</span><span class="o">.</span><span class="na">login</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">password</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s2">&quot;Could not login to server.  Check password.&quot;</span><span class="o">)</span>
    <span class="n">pop3</span><span class="o">.</span><span class="na">disconnect</span><span class="o">()</span>
    <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
<span class="o">}</span>
<span class="n">messages</span> <span class="o">=</span> <span class="n">pop3</span><span class="o">.</span><span class="na">listMessages</span><span class="o">()</span>
<span class="k">if</span> <span class="o">(!</span><span class="n">messages</span><span class="o">)</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s2">&quot;Could not retrieve message list.&quot;</span><span class="o">)</span>
<span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">messages</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="n">println</span><span class="o">(</span><span class="s2">&quot;No messages&quot;</span><span class="o">)</span>
<span class="k">else</span> <span class="o">{</span>
    <span class="n">messages</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">message</span> <span class="o">-&gt;</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">pop3</span><span class="o">.</span><span class="na">retrieveMessageTop</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">number</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">reader</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s2">&quot;Could not retrieve message header. Skipping...&quot;</span><span class="o">)</span>
        <span class="o">}</span>
        <span class="n">printMessageInfo</span><span class="o">(</span><span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="n">reader</span><span class="o">),</span> <span class="n">message</span><span class="o">.</span><span class="na">number</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">pop3</span><span class="o">.</span><span class="na">logout</span><span class="o">()</span>
<span class="n">pop3</span><span class="o">.</span><span class="na">disconnect</span><span class="o">()</span>

<span class="c1">// You can also use JavaMail; for more details, see:</span>
<span class="c1">// http://java.sun.com/products/javamail/</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN993"
>Simulating Telnet from a Program</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Variation to original cookbook: this more extensive example</span>
<span class="c1">// uses telnet to extract weather information about Sydney from</span>
<span class="c1">// a telnet-based weather server at the University of Michigan.</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.net.telnet.TelnetClient</span>

<span class="kt">def</span> <span class="nf">readUntil</span><span class="o">(</span> <span class="n">pattern</span> <span class="o">)</span> <span class="o">{</span>
    <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">()</span>
    <span class="k">while</span> <span class="o">((</span><span class="n">ch</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">read</span><span class="o">())</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">sb</span> <span class="o">&lt;&lt;</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="n">ch</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">endsWith</span><span class="o">(</span><span class="n">pattern</span><span class="o">))</span> <span class="o">{</span>
            <span class="kt">def</span> <span class="n">found</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span>
            <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">()</span>
            <span class="k">return</span> <span class="n">found</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kc">null</span>
<span class="o">}</span>

<span class="n">telnet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TelnetClient</span><span class="o">()</span>
<span class="n">telnet</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span> <span class="s1">&#39;rainmaker.wunderground.com&#39;</span><span class="o">,</span> <span class="mi">3000</span> <span class="o">)</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">telnet</span><span class="o">.</span><span class="na">inputStream</span><span class="o">.</span><span class="na">newReader</span><span class="o">()</span>
<span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="k">new</span> <span class="n">OutputStreamWriter</span><span class="o">(</span><span class="n">telnet</span><span class="o">.</span><span class="na">outputStream</span><span class="o">),</span><span class="kc">true</span><span class="o">)</span>
<span class="n">readUntil</span><span class="o">(</span> <span class="s2">&quot;Welcome&quot;</span> <span class="o">)</span>
<span class="n">println</span> <span class="s1">&#39;Welcome&#39;</span> <span class="o">+</span> <span class="n">readUntil</span><span class="o">(</span> <span class="s2">&quot;!&quot;</span> <span class="o">)</span>
<span class="n">readUntil</span><span class="o">(</span> <span class="s2">&quot;continue:&quot;</span> <span class="o">)</span>
<span class="n">writer</span><span class="o">.</span><span class="na">println</span><span class="o">()</span>
<span class="n">readUntil</span><span class="o">(</span> <span class="s2">&quot;-- &quot;</span> <span class="o">)</span>
<span class="n">writer</span><span class="o">.</span><span class="na">println</span><span class="o">()</span>
<span class="n">readUntil</span><span class="o">(</span> <span class="s2">&quot;Selection:&quot;</span> <span class="o">)</span>
<span class="n">writer</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s2">&quot;10&quot;</span><span class="o">)</span>
<span class="n">readUntil</span><span class="o">(</span> <span class="s2">&quot;Selection:&quot;</span> <span class="o">)</span>
<span class="n">writer</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s2">&quot;3&quot;</span><span class="o">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">readUntil</span><span class="o">(</span> <span class="s2">&quot;Return&quot;</span> <span class="o">)</span>
<span class="k">while</span> <span class="o">(!</span><span class="n">x</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s1">&#39;SYDNEY&#39;</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">writer</span><span class="o">.</span><span class="na">println</span><span class="o">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">readUntil</span><span class="o">(</span> <span class="s2">&quot;Return&quot;</span> <span class="o">)</span>
<span class="o">}</span>
<span class="n">m</span> <span class="o">=</span> <span class="o">(</span><span class="n">x</span> <span class="o">=~</span> <span class="s">/(?sm).*(SYDNEY.*?)$/</span><span class="o">)</span>
<span class="n">telnet</span><span class="o">.</span><span class="na">disconnect</span><span class="o">()</span>
<span class="n">println</span> <span class="n">m</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">1</span><span class="o">]</span>
<span class="c1">// =&gt;</span>
<span class="c1">// Welcome to THE WEATHER UNDERGROUND telnet service!</span>
<span class="c1">// SYDNEY           FAIR      10AM   81  27</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN996"
>Pinging a Machine</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">address</span> <span class="o">=</span> <span class="n">InetAddress</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="s2">&quot;web.mit.edu&quot;</span><span class="o">)</span>
<span class="n">timeoutMillis</span> <span class="o">=</span> <span class="mi">3000</span>
<span class="n">println</span> <span class="n">address</span><span class="o">.</span><span class="na">isReachable</span><span class="o">(</span><span class="n">timeoutMillis</span><span class="o">)</span>
<span class="c1">// =&gt; true (if firewalls don&#39;t get in the way, may require privileges on Linux,</span>
<span class="c1">//          may not use ICMP but rather Echo protocol on Windows machines)</span>

<span class="c1">// You can also use commons net EchoUDPClient and EchoTCPClient to interact</span>
<span class="c1">// with the Echo protocol - sometimes useful for ping-like functionality.</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN999"
>Using Whois to Retrieve Information from the InterNIC</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.net.WhoisClient</span>
<span class="n">whois</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WhoisClient</span><span class="o">()</span>
<span class="n">whois</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">WhoisClient</span><span class="o">.</span><span class="na">DEFAULT_HOST</span><span class="o">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">whois</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="s1">&#39;cnn.com&#39;</span><span class="o">)</span> <span class="c1">// as text of complete query</span>
<span class="n">println</span> <span class="n">result</span> <span class="c1">// could extract info from result here (using e.g. regex)</span>
<span class="n">whois</span><span class="o">.</span><span class="na">disconnect</span><span class="o">()</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN1002"
>Program: expn and vrfy</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// not exact equivalent to original cookbook: just shows raw functionality</span>
<span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SMTPClient</span><span class="o">()</span>
<span class="n">client</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span> <span class="s2">&quot;smtp.example.com&quot;</span><span class="o">,</span> <span class="mi">25</span> <span class="o">)</span>
<span class="n">println</span> <span class="n">client</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="s2">&quot;george&quot;</span><span class="o">)</span> <span class="c1">// =&gt; true</span>
<span class="n">println</span> <span class="n">client</span><span class="o">.</span><span class="na">replyString</span> <span class="c1">// =&gt; 250 George Washington &lt;george@wash.dc.gov&gt;</span>
<span class="n">println</span> <span class="n">client</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="s2">&quot;jetson&quot;</span><span class="o">)</span> <span class="c1">// =&gt; false</span>
<span class="n">println</span> <span class="n">client</span><span class="o">.</span><span class="na">replyString</span> <span class="c1">// =&gt; 550 jetson... User unknown</span>
<span class="n">client</span><span class="o">.</span><span class="na">expn</span><span class="o">(</span><span class="s2">&quot;presidents&quot;</span><span class="o">)</span>
<span class="n">println</span> <span class="n">client</span><span class="o">.</span><span class="na">replyString</span>
<span class="c1">// =&gt;</span>
<span class="c1">// 250-George Washington &lt;george@wash.dc.gov&gt;</span>
<span class="c1">// 250-Thomas Jefferson &lt;tj@wash.dc.gov&gt;</span>
<span class="c1">// 250-Ben Franklin &lt;ben@here.us.edu&gt;</span>
<span class="c1">// ...</span>

<span class="c1">// expect these commands to be disabled by most public servers due to spam</span>
<span class="n">println</span> <span class="n">client</span><span class="o">.</span><span class="na">replyString</span>
<span class="c1">// =&gt; 502 Command is locally disabled</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sockets.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="cgiprogramming.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Sockets</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>CGI Programming</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>