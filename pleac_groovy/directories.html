<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Directories</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Groovy"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="File Contents"
HREF="filecontents.html"><LINK
REL="NEXT"
TITLE="Subroutines"
HREF="subroutines.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Groovy</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="filecontents.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="subroutines.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DIRECTORIES"
>9. Directories</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN495"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s"></span><span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Groovy builds on Java&#39;s file and io classes which provide an operating</span>
<span class="s">// system independent abstraction of a file system. The actual File class</span>
<span class="s">// is the main class of interest. It represents a potential file or</span>
<span class="s">// directory - which may or may not (yet) exist. In versions of Java up to</span>
<span class="s">// and including Java 6, the File class was missing some of the functionality</span>
<span class="s">// required to implement some of the examples in the Chapter (workarounds</span>
<span class="s">// and alternatives are noted below). In Java 7, (also known as &quot;Dolphin&quot;)</span>
<span class="s">// new File abstraction facilities are being worked on but haven&#39;t yet been</span>
<span class="s">// publically released. These new features are known as JSR 203 and are</span>
<span class="s">// referred to when relevant to some of the examples. Thanks to Alan Bateman</span>
<span class="s">// from Sun for clarification regarding various aspects of JSR 203. Apologies</span>
<span class="s">// if I misunderstood any aspects relayed to me and also usual disclaimers</span>
<span class="s">// apply regarding features which may change or be dropped before release.</span>

<span class="s">// path=&#39;/usr/bin&#39;; file=&#39;vi&#39; // linux/mac os?</span>
<span class="s">path=&#39;C:/windows&#39;; file=&#39;explorer.exe&#39; // windows</span>
<span class="s">entry = new File(&quot;$path&quot;)</span>
<span class="s">assert entry.isDirectory()</span>
<span class="s">entry = new File(&quot;$path/$</span><span class="n">file</span><span class="s2">&quot;)</span>
<span class="s2">assert entry.isFile()</span>

<span class="s2">println File.separator</span>
<span class="s2">// =&gt; \ (on Windows)</span>
<span class="s2">// =&gt; / (on Unix)</span>
<span class="s2">// however if you just stick to backslashes Java converts for you</span>
<span class="s2">// in most situations</span>

<span class="s2">// File modification time (no exact equivalent of ctime - but you can</span>
<span class="s2">// call stat() using JNI or use exec() of dir or ls to get this kind of info)</span>
<span class="s2">// JSR 203 also plans to provide such info in Java 7.</span>
<span class="s2">println new Date(entry.lastModified())</span>
<span class="s2">// =&gt; Wed Aug 04 07:00:00 EST 2004</span>

<span class="s2">// file size</span>
<span class="s2">println entry.size()</span>
<span class="s2">// =&gt; 1032192</span>

<span class="s2">// check if we have permission to read the file</span>
<span class="s2">assert entry.canRead()</span>

<span class="s2">// check if file is binary or text?</span>
<span class="s2">// There is no functionality for this at the file level.</span>
<span class="s2">// Java has the Java Activation Framework (jaf) which is used to</span>
<span class="s2">// associate files (and streams) with MIME Types and subsequently</span>
<span class="s2">// binary data streams or character encodings for (potentially</span>
<span class="s2">// multilanguage) text files. JSR-203 provides a method to determine</span>
<span class="s2">// the MIME type of a file. Depending on the platform the file type may</span>
<span class="s2">// be determined based on a file attribute, file name &quot;</span><span class="n">extension</span><span class="s2">&quot;, the</span>
<span class="s2">// bytes of the files (byte sniffing) or other means. It is service</span>
<span class="s2">// provider based so developers can plug in their own file type detection</span>
<span class="s2">// mechanisms as required. &quot;</span><span class="n">Out</span> <span class="n">of</span> <span class="n">the</span> <span class="n">box</span><span class="s2">&quot; it will ship with file type</span>
<span class="s2">// detectors that are appropriate for the platform (integrates with GNOME,</span>
<span class="s2">// Windows registry, etc.).</span>

<span class="s2">// Groovy uses File for directories and files</span>
<span class="s2">// displayAllFilesInUsrBin:</span>
<span class="s2">new File(&#39;/usr/bin&#39;).eachFile{ file -&gt;</span>
<span class="s2">  println &quot;</span><span class="n">Inside</span> <span class="s">/usr/</span><span class="n">bin</span> <span class="n">is</span> <span class="n">something</span> <span class="n">called</span> <span class="n">$file</span><span class="o">.</span><span class="na">name</span><span class="s2">&quot;</span>
<span class="s2">}</span>
<span class="s2">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN498"
>Getting and Setting Timestamps</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s2"></span><span class="s2">//----------------------------------------------------------------------------------</span>
<span class="s2">file = new File(&quot;</span><span class="n">filename</span><span class="s2">&quot;)</span>
<span class="s2">file &lt;&lt; &#39;hi&#39;</span>
<span class="s2">timeModified = file.lastModified()</span>
<span class="s2">println new Date(timeModified)</span>
<span class="s2">// =&gt; Sun Jan 07 11:49:02 EST 2007</span>

<span class="s2">MILLIS_PER_WEEK = 60 * 60 * 24 * 1000 * 7</span>
<span class="s2">file.setLastModified(timeModified - MILLIS_PER_WEEK)</span>
<span class="s2">println new Date(file.lastModified())</span>
<span class="s2">// =&gt; Sun Dec 31 11:49:02 EST 2006</span>

<span class="s2">// Java currently doesn&#39;t provide access to other timestamps but</span>
<span class="s2">// there are things that can be done:</span>
<span class="s2">// (1) You can use JNI to call to C, e.g. stat()</span>
<span class="s2">// (2) Use exec() and call another program, e.g. dir, ls, ... to get the value you are after</span>
<span class="s2">// (3) Here is a Windows specific patch to get lastAccessedTime and creationTime</span>
<span class="s2">//     http://forum.java.sun.com/thread.jspa?forumID=31&amp;start=0&amp;threadID=409921&amp;range=100#1800193</span>
<span class="s2">// (4) There is an informal patch for Java 5/6 which gives lastAccessedTime on Windows and Linux</span>
<span class="s2">//     and creationTime on windows:</span>
<span class="s2">//     http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6314708</span>
<span class="s2">// (5) JSR 203 (currently targetted for Java 7) aims to provide</span>
<span class="s2">//     &quot;</span><span class="n">bulk</span> <span class="n">access</span> <span class="n">to</span> <span class="n">file</span> <span class="n">attributes</span><span class="o">,</span> <span class="n">change</span> <span class="n">notification</span><span class="o">,</span> <span class="n">escape</span> <span class="n">to</span> <span class="n">filesystem</span><span class="o">-</span><span class="n">specific</span> <span class="n">APIs</span><span class="s2">&quot;</span>
<span class="s2">//     this is supposed to include creationTime and lastAccessedTime along with many</span>
<span class="s2">//     security-related file attributes</span>

<span class="s2">// viFileWithoutChangingModificationTimeScript:</span>
<span class="s2">#!/usr/bin/groovy</span>
<span class="s2">// uvi - vi a file without changing it&#39;s last modified time</span>
<span class="s2">if (args.size() != 1)</span>
<span class="s2">  println &quot;</span><span class="nl">usage:</span> <span class="n">uvi</span> <span class="n">filename</span><span class="s2">&quot;</span>
<span class="s2">  System.exit(1)</span>
<span class="s2">}</span>
<span class="s2">file = args[0]</span>
<span class="s2">origTime = new File(file).lastModified()</span>
<span class="s2">&quot;</span><span class="n">vi</span> <span class="n">$file</span><span class="s2">&quot;.execute()</span>
<span class="s2">new File(file).setLastModified(origTime)</span>
<span class="s2">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN501"
>Deleting a File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s2"></span><span class="s2">//----------------------------------------------------------------------------------</span>
<span class="s2">println new File(&#39;/doesnotexist&#39;).exists()  // =&gt; false</span>
<span class="s2">println new File(&#39;/doesnotexist&#39;).delete()  // =&gt; false</span>

<span class="s2">new File(&#39;/createme&#39;) &lt;&lt; &#39;Hi there&#39;</span>
<span class="s2">println new File(&#39;/createme&#39;).exists()  // =&gt; true</span>
<span class="s2">println new File(&#39;/createme&#39;).delete()  // =&gt; true</span>

<span class="s2">names = [&#39;file1&#39;,&#39;file2&#39;,&#39;file3&#39;]</span>
<span class="s2">files = names.collect{ new File(it) }</span>
<span class="s2">// create 2 of the files</span>
<span class="s2">files[0..1].each{ f -&gt; f &lt;&lt; f.name }</span>

<span class="s2">def deleteFiles(files) {</span>
<span class="s2">    def problemFileNames = []</span>
<span class="s2">    files.each{ f -&gt;</span>
<span class="s2">        if (!f.delete())</span>
<span class="s2">            problemFileNames += f.name</span>
<span class="s2">    }</span>
<span class="s2">    def delCnt = files.size() - problemFileNames.size()</span>
<span class="s2">    println &quot;</span><span class="n">Successfully</span> <span class="n">deleted</span> <span class="n">$delCnt</span> <span class="n">of</span> <span class="n">$</span><span class="o">{</span><span class="n">files</span><span class="o">.</span><span class="na">size</span><span class="o">()}</span> <span class="n">file</span><span class="o">(</span><span class="n">s</span><span class="o">)</span><span class="s2">&quot;</span>
<span class="s2">    if (problemFileNames)</span>
<span class="s2">        println &quot;</span><span class="n">Problems</span> <span class="n">file</span><span class="o">(</span><span class="n">s</span><span class="o">):</span> <span class="s2">&quot; + problemFileNames.join(&#39;, &#39;)</span>
<span class="s2">}</span>

<span class="s2">deleteFiles(files)</span>
<span class="s2">// =&gt;</span>
<span class="s2">// Successfully deleted 2 of 3 file(s)</span>
<span class="s2">// Problems file(s): file3</span>

<span class="s2">// we can also set files for deletion on exit</span>
<span class="s2">tempFile = new File(&#39;/xxx&#39;)</span>
<span class="s2">assert !tempFile.exists()</span>
<span class="s2">tempFile &lt;&lt; &#39;junk&#39;</span>
<span class="s2">assert tempFile.exists()</span>
<span class="s2">tempFile.deleteOnExit()</span>
<span class="s2">assert tempFile.exists()</span>
<span class="s2">// To confirm this is working, run these steps multiple times in a row.</span>

<span class="s2">// Discussion:</span>
<span class="s2">// Be careful with deleteOnExit() as there is no way to cancel it.</span>
<span class="s2">// There are also mechanisms specifically for creating unqiuely named temp files.</span>
<span class="s2">// On completion of JSR 203, there will be additional methods available for</span>
<span class="s2">// deleting which throw exceptions with detailed error messages rather than</span>
<span class="s2">// just return booleans.</span>
<span class="s2">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN504"
>Copying or Moving a File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s2"></span><span class="s2">//----------------------------------------------------------------------------------</span>
<span class="s2">// (1) Copy examples</span>

<span class="s2">//shared setup</span>
<span class="s2">dummyContent = &#39;some content&#39; + System.getProperty(&#39;line.separator&#39;)</span>
<span class="s2">setUpFromFile()</span>
<span class="s2">setUpToFile()</span>

<span class="s2">// built-in copy via memory (text files only)</span>
<span class="s2">to &lt;&lt; from.text</span>
<span class="s2">checkSuccessfulCopyAndDelete()</span>

<span class="s2">// built-in as a stream (text or binary) with optional encoding</span>
<span class="s2">to &lt;&lt; from.asWritable(&#39;US-ASCII&#39;)</span>
<span class="s2">checkSuccessfulCopyAndDelete()</span>

<span class="s2">// built-in using AntBuilder</span>
<span class="s2">// for options, see: http://ant.apache.org/manual/CoreTasks/copy.html</span>
<span class="s2">new AntBuilder().copy( file: from.canonicalPath, tofile: to.canonicalPath )</span>
<span class="s2">checkSuccessfulCopyAndDelete()</span>
<span class="s2">// =&gt;</span>
<span class="s2">//     [copy] Copying 1 file to D:\</span>


<span class="s2">// use Apache Jakarta Commons IO (jakarta.apache.org)</span>
<span class="s2">import org.apache.commons.io.FileUtils</span>
<span class="s2">// Copies a file to a new location preserving the lastModified date.</span>
<span class="s2">FileUtils.copyFile(from, to)</span>
<span class="s2">checkSuccessfulCopyAndDelete()</span>

<span class="s2">// using execute()</span>
<span class="s2">// &quot;</span><span class="n">cp</span> <span class="n">$from</span><span class="o">.</span><span class="na">canonicalPath</span> <span class="n">$to</span><span class="o">.</span><span class="na">canonicalPath</span><span class="s2">&quot;.execute()      // unix</span>
<span class="s2">println &quot;</span><span class="n">cmd</span> <span class="s">/c \&quot;copy $from.canonicalPath $to.canonicalPath\&quot;&quot;.execute().text    // dos vms</span>
<span class="s">checkSuccessfulCopyAndDelete()</span>
<span class="s">// =&gt;</span>
<span class="s">//        1 file(s) copied.</span>

<span class="s">// (2) Move examples</span>
<span class="s">// You can just do copy followed by delete but many OS&#39;s can just &#39;rename&#39; in place</span>
<span class="s">// so you can additionally do using Java&#39;s functionality:</span>
<span class="s">assert from.renameTo(to)</span>
<span class="s">assert !from.exists()</span>
<span class="s">checkSuccessfulCopyAndDelete()</span>
<span class="s">// whether renameTo succeeds if from and to are on different platforms</span>
<span class="s">// or if to pre-exists is OS dependent, so you should check the return boolean</span>

<span class="s">// alternatively, Ant has a move task:</span>
<span class="s">// http://ant.apache.org/</span><span class="n">manual</span><span class="s">/CoreTasks/</span><span class="n">move</span><span class="o">.</span><span class="na">html</span>

<span class="c1">//helper methods</span>
<span class="kt">def</span> <span class="nf">checkSuccessfulCopyAndDelete</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">assert</span> <span class="n">to</span><span class="o">.</span><span class="na">text</span> <span class="o">==</span> <span class="n">dummyContent</span>
    <span class="k">assert</span> <span class="n">to</span><span class="o">.</span><span class="na">delete</span><span class="o">()</span>
    <span class="k">assert</span> <span class="o">!</span><span class="n">to</span><span class="o">.</span><span class="na">exists</span><span class="o">()</span>
<span class="o">}</span>
<span class="kt">def</span> <span class="nf">setUpFromFile</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">from</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">&#39;/from.txt&#39;</span><span class="o">)</span> <span class="c1">// just a name</span>
    <span class="n">from</span> <span class="o">&lt;&lt;</span> <span class="n">dummyContent</span>         <span class="c1">// now its a real file with content</span>
    <span class="n">from</span><span class="o">.</span><span class="na">deleteOnExit</span><span class="o">()</span>          <span class="c1">// that will be deleted on exit</span>
<span class="o">}</span>
<span class="kt">def</span> <span class="nf">setUpToFile</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">to</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">&#39;C:/to.txt&#39;</span><span class="o">)</span>     <span class="c1">// target name</span>
    <span class="n">to</span><span class="o">.</span><span class="na">delete</span><span class="o">()</span> <span class="c1">// ensure not left from previous aborted run</span>
    <span class="k">assert</span> <span class="o">!</span><span class="n">to</span><span class="o">.</span><span class="na">exists</span><span class="o">()</span>          <span class="c1">// double check</span>
<span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN507"
>Recognizing Two Names for the Same File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy (because of its Java heritage) doesn&#39;t have an exact</span>
<span class="c1">// equivalent of stat - as per 9.2 there are numerous mechanisms</span>
<span class="c1">// to achieve the equivalent, in particular, JSR203 (still in draft)</span>
<span class="c1">// has specific SymLink support including a FileId class in the</span>
<span class="c1">// java.nio.filesystems package. This will allow (depending on the</span>
<span class="c1">// operating system capabilities) files to be uniquely identified.</span>
<span class="c1">// If you work on Unix or Linux then you&#39;ll recognize this as it device/inode.</span>

<span class="c1">// If you are not interested in the above workarounds/future features</span>
<span class="c1">// and you are on a unix system, you can compare the absolutePath and</span>
<span class="c1">// canonicalPath attributes for a file. If they are different it is</span>
<span class="c1">// a symbolic link. On other operating systems, this difference is not</span>
<span class="c1">// to be relied upon and even on *nix systems, this will only get you</span>
<span class="c1">// so far and will also be relatively expensive resource and timewise.</span>

<span class="c1">// process only unique files</span>
<span class="n">seen</span> <span class="o">=</span> <span class="o">[]</span>
<span class="kt">def</span> <span class="nf">myProcessing</span><span class="o">(</span><span class="n">file</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">path</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">canonicalPath</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">seen</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">path</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">seen</span> <span class="o">&lt;&lt;</span> <span class="n">path</span>
        <span class="c1">// do something with file because we haven&#39;t seen it before</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// find linked files</span>
<span class="n">seen</span> <span class="o">=</span> <span class="o">[:]</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;/dummyfile1.txt&#39;</span><span class="o">,</span><span class="s1">&#39;/test.lnk&#39;</span><span class="o">,</span><span class="s1">&#39;/dummyfile2.txt&#39;</span><span class="o">]</span>
<span class="n">filenames</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">filename</span> <span class="o">-&gt;</span>
    <span class="kt">def</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">filename</span><span class="o">)</span>
    <span class="kt">def</span> <span class="n">cpath</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">canonicalPath</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">seen</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">cpath</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">seen</span><span class="o">[</span><span class="n">cpath</span><span class="o">]</span> <span class="o">=</span> <span class="o">[]</span>
    <span class="o">}</span>
    <span class="n">seen</span><span class="o">[</span><span class="n">cpath</span><span class="o">]</span> <span class="o">+=</span> <span class="n">file</span><span class="o">.</span><span class="na">absolutePath</span>
<span class="o">}</span>

<span class="n">println</span> <span class="s1">&#39;Files with links:&#39;</span>
<span class="n">println</span> <span class="n">seen</span><span class="o">.</span><span class="na">findAll</span><span class="o">{</span> <span class="n">k</span><span class="o">,</span><span class="n">v</span> <span class="o">-&gt;</span> <span class="n">v</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">}</span>
<span class="c1">//---------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN510"
>Processing All Files in a Directory</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// general pattern is:</span>
<span class="c1">// new File(&#39;dirname&#39;).eachFile{ /* do something ... */ }</span>

<span class="c1">// setup (change this on your system)</span>
<span class="n">basedir</span> <span class="o">=</span> <span class="s1">&#39;Pleac/src&#39;</span>

<span class="c1">// process all files printing out full name (. and .. auto excluded)</span>
<span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">basedir</span><span class="o">).</span><span class="na">eachFile</span><span class="o">{</span> <span class="n">f</span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">isFile</span><span class="o">())</span> <span class="n">println</span> <span class="n">f</span><span class="o">.</span><span class="na">canonicalPath</span>
<span class="o">}</span>
<span class="c1">// also remove dot files such as &#39;.svn&#39; and &#39;.cvs&#39; etc.</span>
<span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">basedir</span><span class="o">).</span><span class="na">eachFileMatch</span><span class="o">(~</span><span class="s1">&#39;^[^.].*&#39;</span><span class="o">){</span> <span class="n">f</span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">isFile</span><span class="o">())</span> <span class="n">println</span> <span class="n">f</span><span class="o">.</span><span class="na">canonicalPath</span>
<span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN513"
>Globbing, or Getting a List of Filenames Matching a Pattern</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Globbing via Apache Jakarta ORO</span>
<span class="kn">import</span> <span class="nn">org.apache.oro.io.GlobFilenameFilter</span>
<span class="n">dir</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">basedir</span><span class="o">)</span>
<span class="n">namelist</span> <span class="o">=</span> <span class="n">dir</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="k">new</span> <span class="n">GlobFilenameFilter</span><span class="o">(</span><span class="s1">&#39;*.c&#39;</span><span class="o">))</span>
<span class="n">filelist</span> <span class="o">=</span> <span class="n">dir</span><span class="o">.</span><span class="na">listFiles</span><span class="o">(</span><span class="k">new</span> <span class="n">GlobFilenameFilter</span><span class="o">(</span><span class="s1">&#39;*.h&#39;</span><span class="o">)</span> <span class="k">as</span> <span class="n">FilenameFilter</span><span class="o">)</span>

<span class="c1">// Built-in matching using regex&#39;s</span>
<span class="n">files</span> <span class="o">=</span> <span class="o">[]</span>
<span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">basedir</span><span class="o">).</span><span class="na">eachFileMatch</span><span class="o">(~</span><span class="s">/\.[ch]$/</span><span class="o">){</span> <span class="n">f</span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">isFile</span><span class="o">())</span> <span class="n">files</span> <span class="o">+=</span> <span class="n">f</span>
<span class="o">}</span>

<span class="c1">// Using Ant&#39;s FileScanner (supports arbitrary nested levels using **)</span>
<span class="c1">// For more details about Ant FileSets, see here:</span>
<span class="c1">// http://ant.apache.org/manual/CoreTypes/fileset.html</span>
<span class="n">scanner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AntBuilder</span><span class="o">().</span><span class="na">fileScanner</span> <span class="o">{</span>
    <span class="n">fileset</span><span class="o">(</span><span class="nl">dir:</span><span class="n">basedir</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">include</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;**/pleac*.groovy&#39;</span><span class="o">)</span>
        <span class="n">include</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;Slowcat.*y&#39;</span><span class="o">)</span>
        <span class="n">exclude</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;**/pleac??.groovy&#39;</span><span class="o">)</span> <span class="c1">// chaps 10 and above</span>
        <span class="n">exclude</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;**/*Test*&#39;</span><span class="o">,</span> <span class="nl">unless:</span><span class="s1">&#39;testMode&#39;</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="k">for</span> <span class="o">(</span><span class="n">f</span> <span class="k">in</span> <span class="n">scanner</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s2">&quot;Found file $f&quot;</span>
<span class="o">}</span>

<span class="c1">// find and sort directories with numeric names</span>
<span class="n">candidateFiles</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">basedir</span><span class="o">).</span><span class="na">listFiles</span><span class="o">()</span>
<span class="n">allDigits</span> <span class="o">=</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">name</span> <span class="o">=~</span> <span class="s">/^\d+$/</span> <span class="o">}</span>
<span class="n">isDir</span> <span class="o">=</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">isDirectory</span><span class="o">()</span> <span class="o">}</span>
<span class="n">dirs</span> <span class="o">=</span> <span class="n">candidateFiles</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">isDir</span><span class="o">).</span><span class="na">findAll</span><span class="o">(</span><span class="n">allDigits</span><span class="o">)*.</span><span class="na">canonicalPath</span><span class="o">.</span><span class="na">sort</span><span class="o">()</span>
<span class="n">println</span> <span class="n">dirs</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN516"
>Processing All Files in a Directory Recursively</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// find all files recursively</span>
<span class="n">dir</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">basedir</span><span class="o">)</span>
<span class="n">files</span> <span class="o">=</span> <span class="o">[]</span>
<span class="n">dir</span><span class="o">.</span><span class="na">eachFileRecurse</span><span class="o">{</span> <span class="n">files</span> <span class="o">+=</span> <span class="n">it</span> <span class="o">}</span>

<span class="c1">// find total size</span>
<span class="n">sum</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="na">sum</span><span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">}</span>
<span class="n">println</span> <span class="s2">&quot;$basedir contains $sum bytes&quot;</span>
<span class="c1">// =&gt; Pleac/src contains 365676 bytes</span>

<span class="c1">// find biggest</span>
<span class="n">biggest</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="na">max</span><span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">}</span>
<span class="n">println</span> <span class="s2">&quot;Biggest file is $biggest.name with ${biggest.size()} bytes&quot;</span>
<span class="c1">// =&gt; Biggest file is pleac6.groovy with 42415 bytes</span>

<span class="c1">// find most recently modified</span>
<span class="n">youngest</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="na">max</span><span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">lastModified</span><span class="o">()</span> <span class="o">}</span>
<span class="n">println</span> <span class="s2">&quot;Most recently modified is $youngest.name, changed ${new Date(youngest.lastModified())}&quot;</span>
<span class="c1">// =&gt; Most recently modified is pleac9.groovy, changed Tue Jan 09 07:35:39 EST 2007</span>

<span class="c1">// find all directories</span>
<span class="n">dir</span><span class="o">.</span><span class="na">eachDir</span><span class="o">{</span> <span class="n">println</span> <span class="s1">&#39;Found: &#39;</span> <span class="o">+</span> <span class="n">it</span><span class="o">.</span><span class="na">name</span><span class="o">}</span>

<span class="c1">// find all directories recursively</span>
<span class="n">dir</span><span class="o">.</span><span class="na">eachFileRecurse</span><span class="o">{</span> <span class="n">f</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">isDirectory</span><span class="o">())</span> <span class="n">println</span> <span class="s1">&#39;Found: &#39;</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="na">canonicalPath</span><span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN519"
>Removing a Directory and Its Contents</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">base</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">&#39;path_to_somewhere_to_delete&#39;</span><span class="o">)</span>

<span class="c1">// delete using Jakarta Apache Commons IO</span>
<span class="n">FileUtils</span><span class="o">.</span><span class="na">deleteDirectory</span><span class="o">(</span><span class="n">base</span><span class="o">)</span>

<span class="c1">// delete using Ant, for various options see:</span>
<span class="c1">// http://ant.apache.org/manual/CoreTasks/delete.html</span>
<span class="n">ant</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AntBuilder</span><span class="o">()</span>
<span class="n">ant</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="nl">dir:</span> <span class="n">base</span><span class="o">)</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN522"
>Renaming Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">names</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;Pleac/src/abc.java&#39;</span><span class="o">,</span> <span class="s1">&#39;Pleac/src/def.groovy&#39;</span><span class="o">]</span>
<span class="n">names</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">name</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">name</span><span class="o">).</span><span class="na">renameTo</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.bak&#39;</span><span class="o">))</span> <span class="o">}</span>

<span class="c1">// The Groovy way of doing rename using an expr would be to use a closure</span>
<span class="c1">// for the expr:</span>
<span class="c1">// groovySimpleRenameScript:</span>
<span class="err">#</span><span class="o">!</span><span class="s">/usr/</span><span class="n">bin</span><span class="s">/groovy</span>
<span class="s">// usage rename closure_expr filenames</span>
<span class="s">op = args[0]</span>
<span class="s">println op</span>
<span class="s">files = args[1..-1]</span>
<span class="s">shell = new GroovyShell(binding)</span>
<span class="s">files.each{ f -&gt;</span>
<span class="s">    newname = shell.evaluate(&quot;$op(&#39;$f&#39;)&quot;)</span>
<span class="s">    new File(f).renameTo(new File(newname))</span>
<span class="s">}</span>

<span class="s">// this would allow processing such as:</span>
<span class="s">//% rename &quot;{n -&gt; &#39;FILE_&#39; + n.toUpperCase()}&quot; files</span>
<span class="s">// with param pleac9.groovy =&gt; FILE_PLEAC9.GROOVY</span>
<span class="s">//% rename &quot;{n -&gt; n.replaceAll(/</span><span class="mi">9</span><span class="s">/,&#39;nine&#39;) }&quot; files</span>
<span class="s">// with param pleac9.groovy =&gt; pleacnine.groovy</span>
<span class="s">// The script could also be modified to take the list of</span>
<span class="s">// files from stdin if no args were present (not shown).</span>

<span class="s">// The above lets you type any Groovy code, but instead you might</span>
<span class="s">// decide to provide the user with some DSL-like additions, e.g.</span>
<span class="s">// adding the following lines into the script:</span>
<span class="s">sep = File.separator</span>
<span class="s">ext = { &#39;.&#39; + it.tokenize(&#39;.&#39;)[-1] }</span>
<span class="s">base = { new File(it).name - ext(it) }</span>
<span class="s">parent = { new File(it).parent }</span>
<span class="s">lastModified = { new Date(new File(it).lastModified()) }</span>
<span class="s">// would then allow the following more succinct expressions:</span>
<span class="s">//% rename &quot;{ n -&gt; parent(n) + sep + base(n).reverse() + ext(n) }&quot; files</span>
<span class="s">// with param Pleac/</span><span class="n">src</span><span class="s">/pleac9.groovy =&gt; Pleac\src\9caelp.groovy</span>
<span class="s">//% rename &quot;{ n -&gt; base(n) + &#39;_&#39; + lastModified(n).year + ext(n) }&quot; files</span>
<span class="s">// with param pleac9.groovy =&gt; pleac9_07.groovy</span>

<span class="s">// As a different alternative, you could hook into Ant&#39;s mapper mechanism.</span>
<span class="s">// You wouldn&#39;t normally type in this from the command-line but it could</span>
<span class="s">// be part of a script, here is an example (excludes the actual rename part)</span>
<span class="s">ant = new AntBuilder()</span>
<span class="s">ant.pathconvert(property:&#39;result&#39;,targetos:&#39;windows&#39;){</span>
<span class="s">    path(){ fileset(dir:&#39;Pleac/</span><span class="n">src</span><span class="s1">&#39;, includes:&#39;</span><span class="n">pleac</span><span class="o">?.</span><span class="na">groovy</span><span class="s1">&#39;) }</span>
<span class="s1">    compositemapper{</span>
<span class="s1">        globmapper(from:&#39;</span><span class="o">*</span><span class="mi">1</span><span class="o">.</span><span class="na">groovy</span><span class="s1">&#39;, to:&#39;</span><span class="o">*</span><span class="mi">1</span><span class="o">.</span><span class="na">groovy</span><span class="o">.</span><span class="na">bak</span><span class="s1">&#39;)</span>
<span class="s1">        regexpmapper(from:/^(.*C2)\.(.*)$/, to:/\1_beta.\2/, casesensitive:&#39;</span><span class="n">no</span><span class="s1">&#39;)</span>
<span class="s1">        chainedmapper{</span>
<span class="s1">            packagemapper(from:&#39;</span><span class="o">*</span><span class="n">pleac3</span><span class="o">.</span><span class="na">groovy</span><span class="s1">&#39;, to:&#39;</span><span class="o">*</span><span class="mi">3</span><span class="o">.</span><span class="na">xml</span><span class="s1">&#39;)</span>
<span class="s1">            filtermapper(){ replacestring(from:&#39;</span><span class="nl">C:</span><span class="o">.</span><span class="s1">&#39;, to:&#39;&#39;) }</span>
<span class="s1">        }</span>
<span class="s1">        chainedmapper{</span>
<span class="s1">            regexpmapper(from:/^(.*)4\.(.*)$/, to:/\1_4.\2/)</span>
<span class="s1">            flattenmapper()</span>
<span class="s1">            filtermapper(){ replacestring(from:&#39;</span><span class="mi">4</span><span class="s1">&#39;, to:&#39;</span><span class="n">four</span><span class="s1">&#39;) }</span>
<span class="s1">        }</span>
<span class="s1">    }</span>
<span class="s1">}</span>
<span class="s1">println ant.antProject.getProperty(&#39;</span><span class="n">result</span><span class="s1">&#39;).replaceAll(&#39;</span><span class="o">;</span><span class="s1">&#39;,&#39;</span><span class="err">\</span><span class="n">n</span><span class="s1">&#39;)</span>
<span class="s1">// =&gt;</span>
<span class="s1">// C:\Projects\GroovyExamples\Pleac\src\pleac1.groovy.bak</span>
<span class="s1">// C:\Projects\GroovyExamples\Pleac\src\pleac2_beta.groovy</span>
<span class="s1">// Projects.GroovyExamples.Pleac.src.3.xml</span>
<span class="s1">// pleac_four.groovy</span>
<span class="s1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN525"
>Splitting a Filename into Its Component Parts</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s1"></span><span class="s1">//----------------------------------------------------------------------------------</span>
<span class="s1">// Splitting a Filename into Its Component Parts</span>
<span class="s1">path = new File(&#39;</span><span class="n">Pleac</span><span class="s">/src/</span><span class="n">pleac9</span><span class="o">.</span><span class="na">groovy</span><span class="s1">&#39;)</span>
<span class="s1">assert path.parent == &#39;</span><span class="n">Pleac</span><span class="s1">&#39; + File.separator + &#39;</span><span class="n">src</span><span class="s1">&#39;</span>
<span class="s1">assert path.name == &#39;</span><span class="n">pleac9</span><span class="o">.</span><span class="na">groovy</span><span class="s1">&#39;</span>
<span class="s1">ext = path.name.tokenize(&#39;</span><span class="o">.</span><span class="s1">&#39;)[-1]</span>
<span class="s1">assert ext == &#39;</span><span class="n">groovy</span><span class="s1">&#39;</span>

<span class="s1">// No fileparse_set_fstype() equivalent in Groovy/Java. Java&#39;</span><span class="n">s</span> <span class="n">File</span> <span class="n">constructor</span>
<span class="c1">// automatically performs such a parse and does so appropriately of the operating</span>
<span class="c1">// system it is running on. In addition, 3rd party libraries allow platform</span>
<span class="c1">// specific operations ot be performed. As an example, many Ant tasks are OS</span>
<span class="c1">// aware, e.g. the pathconvert task (callable from an AntBuilder instance) has</span>
<span class="c1">// a &#39;targetos&#39; parameter which can be one of &#39;unix&#39;, &#39;windows&#39;, &#39;netware&#39;,</span>
<span class="c1">// &#39;tandem&#39; or &#39;os/2&#39;.</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN528"
>Program: symirror</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Given the previous discussion regarding the lack of support for symlinks</span>
<span class="c1">// in Java&#39;s File class without exec&#39;ing to the operating system or doing</span>
<span class="c1">// a JNI call (at least until JSR 203 arrives), I have modified this example</span>
<span class="c1">// to perform an actual replica forest of actual file copies rather than</span>
<span class="c1">// a shadow forest full of symlinks pointing back at the real files.</span>
<span class="c1">// Use Apache Jakarta Commons IO</span>
<span class="n">srcdir</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">&#39;Pleac/src&#39;</span><span class="o">)</span> <span class="c1">// path to src</span>
<span class="n">destdir</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">&#39;C:/temp&#39;</span><span class="o">)</span> <span class="c1">// path to dest</span>
<span class="n">preserveFileStamps</span> <span class="o">=</span> <span class="kc">true</span>
<span class="n">FileUtils</span><span class="o">.</span><span class="na">copyDirectory</span><span class="o">(</span><span class="n">srcdir</span><span class="o">,</span> <span class="n">destdir</span><span class="o">,</span> <span class="n">preserveFileStamps</span><span class="o">)</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN531"
>Program: lst</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="err">#</span><span class="o">!</span><span class="s">/usr/</span><span class="n">bin</span><span class="s">/groovy</span>
<span class="s">// lst - list sorted directory contents (depth first)</span>
<span class="s">// Given the previous discussion around Java&#39;s more limited Date</span>
<span class="s">// information available via the File class, this will be a reduced</span>
<span class="s">// functionality version of ls</span>
<span class="s">LONG_OPTION = &#39;l&#39;</span>
<span class="s">REVERSE_OPTION = &#39;r&#39;</span>
<span class="s">MODIFY_OPTION = &#39;m&#39;</span>
<span class="s">SIZE_OPTION = &#39;s&#39;</span>
<span class="s">HELP_OPTION = &#39;help&#39;</span>

<span class="s">op = new joptsimple.OptionParser()</span>
<span class="s">op.accepts( LONG_OPTION, &#39;long listing&#39; )</span>
<span class="s">op.accepts( REVERSE_OPTION, &#39;reverse listing&#39; )</span>
<span class="s">op.accepts( MODIFY_OPTION, &#39;sort based on modification time&#39; )</span>
<span class="s">op.accepts( SIZE_OPTION, &#39;sort based on size&#39; )</span>
<span class="s">op.accepts( HELP_OPTION, &#39;display this message&#39; )</span>

<span class="s">options = op.parse(args)</span>
<span class="s">if (options.wasDetected( HELP_OPTION )) {</span>
<span class="s">    op.printHelpOn( System.out )</span>
<span class="s">} else {</span>
<span class="s">    sort = {}</span>
<span class="s">    params = options.nonOptionArguments()</span>
<span class="s">    longFormat = options.wasDetected( LONG_OPTION )</span>
<span class="s">    reversed = options.wasDetected( REVERSE_OPTION )</span>
<span class="s">    if (options.wasDetected( SIZE_OPTION )) {</span>
<span class="s">        sort = {a,b -&gt; a.size()&lt;=&gt;b.size()}</span>
<span class="s">    } else if (options.wasDetected( MODIFY_OPTION )) {</span>
<span class="s">        sort = {a,b -&gt; a.lastModified()&lt;=&gt;b.lastModified()}</span>
<span class="s">    }</span>
<span class="s">    displayFiles(params, longFormat, reversed, sort)</span>
<span class="s">}</span>

<span class="s">def displayFiles(params, longFormat, reversed, sort) {</span>
<span class="s">    files = []</span>
<span class="s">    params.each{ name -&gt; new File(name).eachFileRecurse{ files += it } }</span>
<span class="s">    files.sort(sort)</span>
<span class="s">    if (reversed) files = files.reverse()</span>
<span class="s">    files.each { file -&gt;</span>
<span class="s">        if (longFormat) {</span>
<span class="s">            print (file.directory ? &#39;d&#39; : &#39;-&#39; )</span>
<span class="s">            print (file.canRead() ? &#39;r&#39; : &#39;-&#39; )</span>
<span class="s">            print (file.canWrite() ? &#39;w &#39; : &#39;- &#39; )</span>
<span class="s">            //print (file.canExecute() ? &#39;x&#39; : &#39;-&#39; ) // Java 6</span>
<span class="s">            print file.size().toString().padLeft(12) + &#39; &#39;</span>
<span class="s">            print new Date(file.lastModified()).toString().padRight(22)</span>
<span class="s">            println &#39;  &#39; + file</span>
<span class="s">        } else {</span>
<span class="s">            println file</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">// =&gt;</span>
<span class="s">// % lst -help</span>
<span class="s">// Option Description</span>
<span class="s">// ------ -------------------------------</span>
<span class="s">// --help display this message</span>
<span class="s">// -l     long listing</span>
<span class="s">// -m     sort based on modification time</span>
<span class="s">// -r     reverse listing</span>
<span class="s">// -s     sort based on size</span>
<span class="s">//</span>
<span class="s">// % lst -l -m Pleac/</span><span class="n">src</span> <span class="n">Pleac</span><span class="s">/lib</span>
<span class="s">// ...</span>
<span class="s">// drw            0 Mon Jan 08 22:33:00 EST 2007  Pleac\lib\.svn</span>
<span class="s">// -rw        18988 Mon Jan 08 22:33:41 EST 2007  Pleac\src\pleac9.groovy</span>
<span class="s">// -rw         2159 Mon Jan 08 23:15:41 EST 2007  Pleac\src\lst.groovy</span>
<span class="s">//</span>
<span class="s">// % -l -s -r Pleac/</span><span class="n">src</span> <span class="n">Pleac</span><span class="s">/lib</span>
<span class="s">// -rw      1034049 Sun Jan 07 19:24:41 EST 2007  Pleac\lib\ant.jar</span>
<span class="s">// -r-      1034049 Sun Jan 07 19:40:27 EST 2007  Pleac\lib\.svn\text-base\ant.jar.svn-base</span>
<span class="s">// -rw       421008 Thu Jun 02 15:15:34 EST 2005  Pleac\lib\ant-nodeps.jar</span>
<span class="s">// -rw       294436 Sat Jan 06 21:19:58 EST 2007  Pleac\lib\geronimo-javamail_1.3.1_mail-1.0.jar</span>
<span class="s">// ...</span>
<span class="s">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="filecontents.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="subroutines.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>File Contents</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Subroutines</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>