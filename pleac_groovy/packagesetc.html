<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Packages, Libraries, and Modules</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Groovy"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="References and Records"
HREF="referencesandrecords.html"><LINK
REL="NEXT"
TITLE="Classes, Objects, and Ties"
HREF="classesetc.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Groovy</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="referencesandrecords.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="classesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="PACKAGESETC"
>12. Packages, Libraries, and Modules</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN642"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy adopts many of the Java structuring conventions and terminology</span>
<span class="c1">// and adds some concepts of its own.</span>
<span class="c1">// Code-reuse can occur at the script, class, library, component or framework level.</span>
<span class="c1">// Source code including class file source and scripts are organised into packages.</span>
<span class="c1">// These can be thought of as like hierarchical folders or directories. Two class</span>
<span class="c1">// with the same name can be distinguished by having different packages. Compiled</span>
<span class="c1">// byte code and sometimes source code including scripts can be packaged up into</span>
<span class="c1">// jar files. Various conventions exist for packaging classes and resources in</span>
<span class="c1">// such a way to allow them to be easily reused. Some of these conventions allow</span>
<span class="c1">// reusable code to be placed within repositories for easy use by third parties.</span>
<span class="c1">// One such repository is the maven repository, e.g.: ibiblio.org/maven2</span>
<span class="c1">// When reusing classes, it is possible to compartmentalise knowledge of</span>
<span class="c1">// particular packages using multiple (potentially hierarchical) classloaders.</span>
<span class="c1">// By convention, package names are all lowercase. Class names are capitalized.</span>
<span class="c1">// Naming examples:</span>
<span class="c1">// package my.package1.name     // at most one per source file - at top of file</span>
<span class="c1">// class MyClass ...            // actually defines my.package1.name.MyClass</span>
<span class="c1">// import my.package1.name.MyClass  // allows package to be dropped within current file</span>
<span class="c1">// import my.package2.name.MyClass  // if class basenames are the same, can&#39;t</span>
<span class="c1">//                                  // import both, leave one fully qualified</span>
<span class="c1">// import my.package.name.*         // all classes in package can drop package prefix</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN645"
>Defining a Module's Interface</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// No equivalent export process exists for Groovy.</span>

<span class="c1">// If you have some Groovy functionality that you would like others to use</span>
<span class="c1">// you either make the source code available or compile it into class files</span>
<span class="c1">// and package those up in a jar file. Some subset of your class files will</span>
<span class="c1">// define the OO interface to your functionality, e.g. public methods,</span>
<span class="c1">// interfaces, etc. Depending on the circumstances, various conventions are</span>
<span class="c1">// used to indicate this functionality including Manifest files, javadocs,</span>
<span class="c1">// deployment descriptors, project metadata and dependency management files.</span>
<span class="c1">// See 12.18 for an example.</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN648"
>Trapping Errors in require or use</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy supports both static and dynamic (strong) typing. When trying to</span>
<span class="c1">// compile or run files using static typing, the required classes referenced</span>
<span class="c1">// must be available. Classes used in more dynamic ways may be loaded (or</span>
<span class="c1">// created) at runtime. Errors in loading such dynamic cases are handled</span>
<span class="c1">// using the normal exception handling mechanisms.</span>

<span class="c1">// attempt to load an unknown resource or script:</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">evaluate</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">&#39;doesnotexist.groovy&#39;</span><span class="o">))</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">FileNotFoundException</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s1">&#39;File not found, skipping ...&#39;</span>
<span class="o">}</span>
<span class="c1">// =&gt; File not found, skipping ...</span>

<span class="c1">// attempt to load an unknown class:</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s1">&#39;org.happytimes.LottoNumberGenerator&#39;</span><span class="o">)</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ClassNotFoundException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">println</span> <span class="s1">&#39;Class not found, skipping ...&#39;</span>
<span class="o">}</span>
<span class="c1">// -&gt; Class not found, skipping ...</span>

<span class="c1">// dynamicallly look for a database driver (slight variation to original cookbook)</span>
<span class="c1">// Note: this hypothetical example ignores certain issues e.g. different url</span>
<span class="c1">// formats for configuration when establishing a connection with the driver</span>
<span class="n">candidates</span> <span class="o">=</span> <span class="o">[</span>
    <span class="s1">&#39;oracle.jdbc.OracleDriver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;com.ibm.db2.jcc.DB2Driver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;com.microsoft.jdbc.sqlserver.SQLServerDriver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;net.sourceforge.jtds.jdbc.Driver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;com.sybase.jdbc3.jdbc.SybDriver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;com.informix.jdbc.IfxDriver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;com.mysql.jdbc.Driver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;org.postgresql.Driver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;com.sap.dbtech.jdbc.DriverSapDB&#39;</span><span class="o">,</span>
    <span class="s1">&#39;org.hsqldb.jdbcDriver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;com.pointbase.jdbc.jdbcUniversalDriver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;org.apache.derby.jdbc.ClientDriver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;com.mckoi.JDBCDriver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;org.firebirdsql.jdbc.FBDriver&#39;</span><span class="o">,</span>
    <span class="s1">&#39;sun.jdbc.odbc.JdbcOdbcDriver&#39;</span>
<span class="o">]</span>
<span class="n">loaded</span> <span class="o">=</span> <span class="kc">null</span>
<span class="k">for</span> <span class="o">(</span><span class="n">driver</span> <span class="k">in</span> <span class="n">candidates</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">loaded</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">driver</span><span class="o">).</span><span class="na">newInstance</span><span class="o">()</span>
        <span class="k">break</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span> <span class="cm">/* ignore */</span> <span class="o">}</span>
<span class="o">}</span>
<span class="n">println</span> <span class="n">loaded</span><span class="o">?.</span><span class="na">class</span><span class="o">?.</span><span class="na">name</span> <span class="c1">// =&gt; sun.jdbc.odbc.JdbcOdbcDriver</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN651"
>Delaying use Until Run Time</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// In Groovy (like Java), any static reference to an external class within</span>
<span class="c1">// your class will cause the external class to be loaded from the classpath.</span>
<span class="c1">// You can dynamically add to the classpath using:</span>
<span class="c1">// this.class.rootLoader.addURL(url)</span>
<span class="c1">// To delay loading of external classes, use Class.forName() or evaluate()</span>
<span class="c1">// the script separately as shown in 12.2.</span>

<span class="c1">// For the specific case of initialization code, here is another example:</span>
<span class="c1">// (The code within the anonymous { ... } block is called whenever the</span>
<span class="c1">// class is loaded.)</span>
<span class="kd">class</span> <span class="nc">DbHelper</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">driver</span>
    <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">properties</span><span class="o">.</span><span class="s1">&#39;driver&#39;</span> <span class="o">==</span> <span class="s1">&#39;oracle&#39;</span><span class="o">)</span>
            <span class="n">driver</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s1">&#39;oracle.jdbc.OracleDriver&#39;</span><span class="o">)</span>
        <span class="k">else</span>
            <span class="n">driver</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s1">&#39;sun.jdbc.odbc.JdbcOdbcDriver&#39;</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">println</span> <span class="k">new</span> <span class="nf">DbHelper</span><span class="o">().</span><span class="na">driver</span><span class="o">.</span><span class="na">name</span> <span class="c1">// =&gt; sun.jdbc.odbc.JdbcOdbcDriver</span>
<span class="c1">// call program with -Ddriver=oracle to swap to other driver</span>

<span class="c1">// A slightly related feature: If you want to load a script (typically in a</span>
<span class="c1">// server environment) whenever the source file changes, use GroovyScriptEngine()</span>
<span class="c1">// instead of GroovyShell() when embedding groovy.</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN654"
>Making Variables Private to a Module</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// class variables are private unless access functions are defined</span>
<span class="kd">class</span> <span class="nc">Alpha</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="kd">private</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">12</span>
<span class="o">}</span>

<span class="n">println</span> <span class="k">new</span> <span class="nf">Alpha</span><span class="o">().</span><span class="na">x</span>    <span class="c1">// =&gt; 10</span>
<span class="n">println</span> <span class="k">new</span> <span class="nf">Alpha</span><span class="o">().</span><span class="na">y</span>    <span class="c1">// =&gt; 12 when referenced inside source file, error outside</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN657"
>Determining the Caller's Package</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// You can examine the stacktrace to determine the calling class: see 10.4</span>
<span class="c1">// When executing a script from a groovy source file, you can either:</span>
<span class="n">println</span> <span class="nf">getClass</span><span class="o">().</span><span class="na">classLoader</span><span class="o">.</span><span class="na">resourceLoader</span><span class="o">.</span><span class="na">loadGroovySource</span><span class="o">(</span><span class="n">getClass</span><span class="o">().</span><span class="na">name</span><span class="o">)</span>
<span class="c1">// =&gt; file:/C:/Projects/GroovyExamples/Pleac/classes/pleac12.groovy</span>
<span class="c1">// or for the initially started script when started using the standard .bat/.sh files</span>
<span class="n">println</span> <span class="n">System</span><span class="o">.</span><span class="na">properties</span><span class="o">.</span><span class="s1">&#39;script.name&#39;</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN660"
>Automating Module Clean-Up</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// For code which executes at class startup, see the initialization code block</span>
<span class="c1">// mechanism mentioned in 12.3. For code which should execute during shutdown</span>
<span class="c1">// see the finalize() method discussed (including limitations) in 13.2.</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN663"
>Keeping Your Own Module Directory</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Each JVM process may have its own classpath (and indeed its own version of Java</span>
<span class="c1">// runtime and libraries). You &quot;simply&quot; supply a classpath pointing to different</span>
<span class="c1">// locations to obtain different modules.</span>
<span class="c1">// Groovy augments the JVM behaviour by allowing individuals to have a ~/.groovy/lib</span>
<span class="c1">// directory with additional libraries (and potentially other resources).</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN666"
>Preparing a Module for Distribution</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// To make your code available to others could involve any of the following:</span>
<span class="c1">// (1) make your source code available</span>
<span class="c1">// (2) if you are creating a standard class, use the jar tool to package the</span>
<span class="c1">//     compiled code into a jar - this is then added to the classpath to use</span>
<span class="c1">// (3) if the jar relies on additional jars, this is sometimes specified in</span>
<span class="c1">//     a special manifest file within the jar</span>
<span class="c1">// (4) if the code is designed to run within a container environment, there</span>
<span class="c1">//     might be additional packaging, e.g. servlets might be packaged in a war</span>
<span class="c1">//     file - essentially a jar file with extra metadata in xml format.</span>
<span class="c1">// (5) you might also supply your package to a well known repository such as the</span>
<span class="c1">//     maven repository - and you will add dependency information in xml format</span>
<span class="c1">// (6) you may use platform specific installers to produce easily installable</span>
<span class="c1">//     components (e.g. windows .exe files or linux rpm&#39;s)</span>
<span class="c1">// (7) you may spackage up your components as a plugin (e.g. as an eclipse plugin)</span>
<span class="c1">//     this is also typically in jar/zip like format with additional metadata</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN669"
>Speeding Module Loading with SelfLoader</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy has no SelfLoader. Class loading can be delayed using external scripts</span>
<span class="c1">// and by using the Class.forName() approach discussed in 12.2/12.3. If you have</span>
<span class="c1">// critical performance issues, you can use these techniques and keep your class</span>
<span class="c1">// size small to maximise the ability to defer loading. There are other kinds of</span>
<span class="c1">// performance tradeoffs you can make too. Alot of work has been done with JIT</span>
<span class="c1">// (just in time) compilers for bytecode. You can pre-compile Groovy source files</span>
<span class="c1">// into bytecode using the groovy compiler (groovyc). You can also do this on</span>
<span class="c1">// the fly for scripts you know you are going to need shortly.</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN672"
>Speeding Up Module Loading with Autoloader</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Groovy has no AutoLoader. See the discussion in 12.9 for some techniques to</span>
<span class="c1">// impact program performance. There are many techniques available to speed up</span>
<span class="c1">// program performance (and in particular load speed). Some of these utilise</span>
<span class="c1">// techniques similar in nature to the technique used by the AutoLoader.</span>
<span class="c1">// As already mentioned, when you load a class into the JVM, any statically</span>
<span class="c1">// referenced class is also loaded. If you reference interfaces rather than</span>
<span class="c1">// concrete implementations, only the interface need be loaded. If you must</span>
<span class="c1">// reference a concrete implementation you can use either a Proxy class or</span>
<span class="c1">// classloader tricks to delay the loading of a full class (e.g. you supply a</span>
<span class="c1">// Proxy class with just one method implemented or a lazy-loading Proxy which</span>
<span class="c1">// loads the real class only when absolutely required)</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN675"
>Overriding Built-In Functions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// You can use Categories to override Groovy and Java base functionality.</span>
<span class="n">println</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">().</span><span class="na">time</span> <span class="c1">// =&gt; 1169019557140</span>

<span class="kd">class</span> <span class="nc">DateCategory</span> <span class="o">{</span>  <span class="c1">// the class name by convention ends with category</span>
    <span class="c1">// we can add new functionality</span>
    <span class="kd">static</span> <span class="kt">float</span> <span class="nf">getFloatTime</span><span class="o">(</span><span class="n">Date</span> <span class="n">self</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span> <span class="n">self</span><span class="o">.</span><span class="na">getTime</span><span class="o">()</span>
    <span class="o">}</span>
    <span class="c1">// we can override existing functionality (now seconds since 1970 not millis)</span>
    <span class="kd">static</span> <span class="kt">long</span> <span class="nf">asSeconds</span><span class="o">(</span><span class="n">Date</span> <span class="n">self</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="o">(</span><span class="n">self</span><span class="o">.</span><span class="na">getTime</span><span class="o">()</span><span class="s">/1000)</span>
<span class="s">    }</span>
<span class="s">}</span>

<span class="s">use (DateCategory) {</span>
<span class="s">    println new Date().floatTime    // =&gt; 1.1690195E12</span>
<span class="s">    println new Date().asSeconds()  // =&gt; 1169019557</span>
<span class="s">}</span>

<span class="s">// We can also use the &#39;as&#39; keyword</span>
<span class="s">class MathLib {</span>
<span class="s">    def triple(n) { n * 4 }</span>
<span class="s">    def twice(n) { n * 2 }</span>
<span class="s">}</span>
<span class="s">def m = new MathLib()</span>
<span class="s">println m.twice(10)     // =&gt; 20</span>
<span class="s">println m.triple(10)    // =&gt; 40 (Intentional Bug!)</span>
<span class="s">// we might want to make use of some funtionality in the math</span>
<span class="s">// library but want to later some of its features slightly or fix</span>
<span class="s">// some bugs, we can simply import the original using a different name</span>
<span class="s">import MathLib as BuggyMathLib</span>
<span class="s">// now we could define our own MathLib which extended or had a delegate</span>
<span class="s">// of the BuggyMathLib class</span>
<span class="s">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN678"
>Reporting Errors and Warnings Like Built-Ins</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s"></span><span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Many Java and Groovy programs emit a stacktrace when an error occurs.</span>
<span class="s">// This shows both the calling and called programs (with line numbers if</span>
<span class="s">// supplied). Groovy pretties up stacktraces to show less noise. You can use -d</span>
<span class="s">// or --debug on the commandline to force it to always produce full stacktraces.</span>
<span class="s">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN681"
>Referring to Packages Indirectly</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s"></span><span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// already have log10, how to create log11 to log100</span>
<span class="s">(11..100).each { int base -&gt;</span>
<span class="s">    binding.&quot;log$base&quot; = { int n -&gt; Math.log(n) /</span> <span class="n">Math</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">base</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>
<span class="n">println</span> <span class="nf">log20</span><span class="o">(</span><span class="mi">400</span><span class="o">)</span>  <span class="c1">// =&gt; 2.0</span>
<span class="n">println</span> <span class="nf">log100</span><span class="o">(</span><span class="mi">1000000</span><span class="o">)</span>  <span class="c1">// =&gt; 3.0 (displays 2.9999999999999996 using doubles)</span>

<span class="c1">// same thing again use currying</span>
<span class="kt">def</span> <span class="n">logAnyBase</span> <span class="o">=</span> <span class="o">{</span> <span class="n">base</span><span class="o">,</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">Math</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="s">/ Math.log(base) }</span>
<span class="s">(11..100).each { int base -&gt;</span>
<span class="s">    binding.&quot;log$base&quot; = logAnyBase.curry(base)</span>
<span class="s">}</span>
<span class="s">println log20(400)  // =&gt; 2.0</span>
<span class="s">println log100(1000000)  // =&gt; 3.0 (displays 2.9999999999999996 using doubles)</span>
<span class="s">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN684"
>Using h2ph to Translate C #include Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s"></span><span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Groovy intefaces with C in the same way as Java: using JNI</span>
<span class="s">// For this discussion we will ignoring platform specific options and CORBA.</span>
<span class="s">// This tutorial here describes how to allow Java (and hence Groovy) to</span>
<span class="s">// call a C program which generates UUIDs:</span>
<span class="s">// http://ringlord.com/</span><span class="n">publications</span><span class="s">/jni-howto/</span>
<span class="c1">// Here&#39;s another useful reference:</span>
<span class="c1">// http://weblogs.java.net/blog/kellyohair/archive/2006/01/compilation_of_1.html</span>
<span class="c1">// And of course, Sun&#39;s tutorial:</span>
<span class="c1">// http://java.sun.com/developer/onlineTraining/Programming/JDCBook/jni.html</span>

<span class="c1">// You might also want to consider SWIG which simplifies connecting</span>
<span class="c1">// C/C++ to many scripting languages including Java (and hence Groovy)</span>
<span class="c1">// More details: http://www.swig.org/</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN687"
>Using h2xs to Make a Module with C Code</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// See discussion for 12.14</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN690"
>Documenting Your Module with Pod</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// The standard documentation system for Java is JavaDoc.</span>
<span class="c1">// Documentation for JavaDoc is part of a Java installation.</span>
<span class="c1">// Groovy has a GroovyDoc tool planned which expands upon the JavaDoc tool</span>
<span class="c1">// but work on the tool hasn&#39;t progressed much as yet.</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN693"
>Building and Installing a CPAN Module</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Most libraries for Java (and hence Groovy) come precompiled. You simply download</span>
<span class="c1">// the jar and place it somewhere on your CLASSPATH.</span>

<span class="c1">// If only source code is available, you need to download the source and follow any</span>
<span class="c1">// instuctions which came with the source. Most projects use one of a handful of</span>
<span class="c1">// build tools to compile, test and package their artifacts. Typical ones are Ant</span>
<span class="c1">// and Maven which you need to install according to their respective instructions.</span>

<span class="c1">// If using Ant, you need to unpack the source files then type &#39;ant&#39;.</span>

<span class="c1">// If using Maven, you need to unpack the source files then type &#39;maven&#39;.</span>

<span class="c1">// If you are using Maven or Ivy for dependency management you can add</span>
<span class="c1">// the following lines to your project description file.</span>
<span class="cm">/*</span>
<span class="cm">    &lt;dependency&gt;</span>
<span class="cm">      &lt;groupId&gt;commons-collections&lt;/groupId&gt;</span>
<span class="cm">      &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;</span>
<span class="cm">      &lt;version&gt;3.2&lt;/version&gt;</span>
<span class="cm">    &lt;/dependency&gt;</span>
<span class="cm">*/</span>
<span class="c1">// This will automatically download the particular version of the referenced</span>
<span class="c1">// library file and also provide hooks so that you can make this automatically</span>
<span class="c1">// available in your classpath.</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN696"
>Example: Module Template</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// example groovy file for a &quot;module&quot;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang.WordUtils</span>

<span class="kd">class</span> <span class="nc">Greeter</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">name</span>
    <span class="nf">Greeter</span><span class="o">(</span><span class="n">who</span><span class="o">)</span> <span class="o">{</span> <span class="n">name</span> <span class="o">=</span> <span class="n">WordUtils</span><span class="o">.</span><span class="na">capitalize</span><span class="o">(</span><span class="n">who</span><span class="o">)</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">salute</span><span class="o">()</span> <span class="o">{</span> <span class="s2">&quot;Hello $name!&quot;</span> <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// test class</span>
<span class="kd">class</span> <span class="nc">GreeterTest</span> <span class="kd">extends</span> <span class="n">GroovyTestCase</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="nf">testGreeting</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">assert</span> <span class="k">new</span> <span class="nf">Greeter</span><span class="o">(</span><span class="s1">&#39;world&#39;</span><span class="o">).</span><span class="na">salute</span><span class="o">()</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Typical Ant build file (could be in Groovy instead of XML):</span>
<span class="cm">/*</span>
<span class="cm">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="cm">&lt;project name=&quot;sample&quot; default=&quot;jar&quot; basedir=&quot;.&quot;&gt;</span>
<span class="cm">    &lt;property name=&quot;src&quot; value=&quot;src&quot;/&gt;</span>
<span class="cm">    &lt;property name=&quot;build&quot; value=&quot;build&quot;/&gt;</span>

<span class="cm">    &lt;target name=&quot;init&quot;&gt;</span>
<span class="cm">        &lt;mkdir dir=&quot;${build}&quot;/&gt;</span>
<span class="cm">    &lt;/target&gt;</span>

<span class="cm">    &lt;target name=&quot;compile&quot; depends=&quot;init&quot;&gt;</span>
<span class="cm">        &lt;mkdir dir=&quot;${build}/classes&quot;/&gt;</span>
<span class="cm">        &lt;groovyc srcdir=&quot;${src}&quot; destdir=&quot;${build}/classes&quot;/&gt;</span>
<span class="cm">    &lt;/target&gt;</span>

<span class="cm">    &lt;target name=&quot;test&quot; depends=&quot;compile&quot;&gt;</span>
<span class="cm">        &lt;groovy src=&quot;${src}/GreeterTest.groovy&quot;&gt;</span>
<span class="cm">    &lt;/target&gt;</span>

<span class="cm">    &lt;target name=&quot;jar&quot; depends=&quot;compile,test&quot;&gt;</span>
<span class="cm">        &lt;mkdir dir=&quot;${build}/jar&quot;/&gt;</span>
<span class="cm">        &lt;jar destfile=&quot;${build}/jar/Greeter.jar&quot; basedir=&quot;${build}/classes&quot;&gt;</span>
<span class="cm">            &lt;manifest&gt;</span>
<span class="cm">                &lt;attribute name=&quot;Main-Class&quot; value=&quot;Greeter&quot;/&gt;</span>
<span class="cm">            &lt;/manifest&gt;</span>
<span class="cm">        &lt;/jar&gt;</span>
<span class="cm">    &lt;/target&gt;</span>
<span class="cm">&lt;/project&gt;</span>

<span class="cm">*/</span>

<span class="c1">// Typical dependency management file</span>
<span class="cm">/*</span>
<span class="cm">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cm">&lt;project</span>
<span class="cm">  xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
<span class="cm">  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="cm">  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0</span>
<span class="cm">          http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;</span>
<span class="cm">  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span>
<span class="cm">  &lt;groupId&gt;groovy&lt;/groupId&gt;</span>
<span class="cm">  &lt;artifactId&gt;module&lt;/artifactId&gt;</span>
<span class="cm">  &lt;name&gt;Greeter&lt;/name&gt;</span>
<span class="cm">  &lt;version&gt;1.0&lt;/version&gt;</span>
<span class="cm">  &lt;packaging&gt;jar&lt;/packaging&gt;</span>
<span class="cm">  &lt;description&gt;Greeter Module/description&gt;</span>
<span class="cm">  &lt;dependencies&gt;</span>
<span class="cm">    &lt;dependency&gt;</span>
<span class="cm">      &lt;groupId&gt;commons-lang&lt;/groupId&gt;</span>
<span class="cm">      &lt;artifactId&gt;commons-lang&lt;/artifactId&gt;</span>
<span class="cm">      &lt;version&gt;2.2&lt;/version&gt;</span>
<span class="cm">    &lt;/dependency&gt;</span>
<span class="cm">  &lt;/dependencies&gt;</span>
<span class="cm">&lt;/project&gt;</span>
<span class="cm">*/</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN699"
>Program: Finding Versions and Descriptions of Installed Modules</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Searching available modules in repositories:</span>
<span class="c1">// You can browse the repositories online, e.g. ibiblio.org/maven2 or various</span>
<span class="c1">// plugins are available for IDEs which do this for you, e.g. JarJuggler for IntelliJ.</span>

<span class="c1">// Searching currently &quot;installed&quot; modules:</span>
<span class="c1">// Browse your install directory, view your maven POM file, look in your ~/.groovy/lib</span>
<span class="c1">// directory, turn on debug modes and watch classloader messages ...</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="referencesandrecords.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="classesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>References and Records</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Classes, Objects, and Ties</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>