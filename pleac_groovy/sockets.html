<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Sockets</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Groovy"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Process Management and Communication"
HREF="processmanagementetc.html"><LINK
REL="NEXT"
TITLE="Internet Services"
HREF="internetservices.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Groovy</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="processmanagementetc.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="internetservices.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="SOCKETS"
>17. Sockets</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN919"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">myClient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Socket</span><span class="o">(</span><span class="s2">&quot;Machine name&quot;</span><span class="o">,</span> <span class="n">portNumber</span><span class="o">)</span>
<span class="n">myAddress</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="na">inetAddress</span>
<span class="n">myAddress</span><span class="o">.</span><span class="na">hostAddress</span>  <span class="c1">// string representation of host address</span>
<span class="n">myAddress</span><span class="o">.</span><span class="na">hostName</span>     <span class="c1">// host name</span>
<span class="n">myAddress</span><span class="o">.</span><span class="na">address</span>      <span class="c1">// IP address as array of bytes</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN922"
>Writing a TCP Client</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Socket</span><span class="o">(</span><span class="s2">&quot;localhost&quot;</span><span class="o">,</span> <span class="mi">5000</span><span class="o">);</span>
<span class="n">s</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Why don&#39;t you call me anymore?\n&quot;</span>
<span class="n">s</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN925"
>Writing a TCP Server</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// commandline socket server echoing input back to originator</span>
<span class="n">groovy</span> <span class="o">-</span><span class="n">l</span> <span class="mi">5000</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;println line&quot;</span>

<span class="c1">// commandline socket server eching input to stderr</span>
<span class="n">groovy</span> <span class="o">-</span><span class="n">l</span> <span class="mi">5000</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;System.err.println line&quot;</span>

<span class="c1">// a web server as a script (extension to cookbook)</span>
 <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="mi">5000</span><span class="o">)</span>
 <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
     <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">()</span> <span class="o">{</span> <span class="n">socket</span> <span class="o">-&gt;</span>
         <span class="n">socket</span><span class="o">.</span><span class="na">withStreams</span> <span class="o">{</span> <span class="n">input</span><span class="o">,</span> <span class="n">output</span> <span class="o">-&gt;</span>
             <span class="c1">// ignore input and just serve dummy content</span>
             <span class="n">output</span><span class="o">.</span><span class="na">withWriter</span> <span class="o">{</span> <span class="n">writer</span> <span class="o">-&gt;</span>
                 <span class="n">writer</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;HTTP/1.1 200 OK\n&quot;</span>
                 <span class="n">writer</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Content-Type: text/html\n\n&quot;</span>
                 <span class="n">writer</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;&lt;html&gt;&lt;body&gt;Hello World! It&#39;s ${new Date()}&lt;/body&gt;&lt;/html&gt;\n&quot;</span>
             <span class="o">}</span>
         <span class="o">}</span>
     <span class="o">}</span>
 <span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN928"
>Communicating over TCP</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerSocket</span><span class="o">(</span><span class="mi">5000</span><span class="o">)</span>
<span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">()</span> <span class="o">{</span> <span class="n">socket</span> <span class="o">-&gt;</span>
        <span class="n">socket</span><span class="o">.</span><span class="na">withStreams</span> <span class="o">{</span> <span class="n">input</span><span class="o">,</span> <span class="n">output</span> <span class="o">-&gt;</span>
            <span class="n">w</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintWriter</span><span class="o">(</span><span class="n">output</span><span class="o">)</span>
            <span class="n">w</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;What is your name? &quot;</span>
            <span class="n">w</span><span class="o">.</span><span class="na">flush</span><span class="o">()</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">readLine</span><span class="o">()</span>
            <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span> <span class="s2">&quot;User responded with $r&quot;</span>
            <span class="n">w</span><span class="o">.</span><span class="na">close</span><span class="o">()</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN931"
>Setting Up a UDP Client</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// UDP client</span>
<span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;Message&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s2">&quot;ASCII&quot;</span><span class="o">)</span>
<span class="n">addr</span> <span class="o">=</span> <span class="n">InetAddress</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="s2">&quot;localhost&quot;</span><span class="o">)</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">packet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramPacket</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">data</span><span class="o">.</span><span class="na">length</span><span class="o">,</span> <span class="n">addr</span><span class="o">,</span> <span class="n">port</span><span class="o">)</span>
<span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramSocket</span><span class="o">()</span>
<span class="n">socket</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">packet</span><span class="o">)</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN934"
>Setting Up a UDP Server</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// UDP server</span>
<span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramSocket</span><span class="o">(</span><span class="mi">5000</span><span class="o">)</span>
<span class="n">buffer</span> <span class="o">=</span> <span class="o">(</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">4096</span><span class="o">)</span> <span class="k">as</span> <span class="kt">byte</span><span class="o">[]</span>
<span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">incoming</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramPacket</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="n">buffer</span><span class="o">.</span><span class="na">length</span><span class="o">)</span>
    <span class="n">socket</span><span class="o">.</span><span class="na">receive</span><span class="o">(</span><span class="n">incoming</span><span class="o">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">incoming</span><span class="o">.</span><span class="na">data</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">incoming</span><span class="o">.</span><span class="na">length</span><span class="o">)</span>
    <span class="n">String</span> <span class="n">reply</span> <span class="o">=</span> <span class="s2">&quot;Client said: &#39;$s&#39;&quot;</span>
    <span class="n">outgoing</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramPacket</span><span class="o">(</span><span class="n">reply</span><span class="o">.</span><span class="na">bytes</span><span class="o">,</span> <span class="n">reply</span><span class="o">.</span><span class="na">size</span><span class="o">(),</span>
            <span class="n">incoming</span><span class="o">.</span><span class="na">address</span><span class="o">,</span> <span class="n">incoming</span><span class="o">.</span><span class="na">port</span><span class="o">);</span>
    <span class="n">socket</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">outgoing</span><span class="o">)</span>
<span class="o">}</span>

<span class="c1">// UDP client</span>
<span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;Original Message&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s2">&quot;ASCII&quot;</span><span class="o">)</span>
<span class="n">addr</span> <span class="o">=</span> <span class="n">InetAddress</span><span class="o">.</span><span class="na">getByName</span><span class="o">(</span><span class="s2">&quot;localhost&quot;</span><span class="o">)</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">packet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramPacket</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">data</span><span class="o">.</span><span class="na">length</span><span class="o">,</span> <span class="n">addr</span><span class="o">,</span> <span class="n">port</span><span class="o">)</span>
<span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramSocket</span><span class="o">()</span>
<span class="n">socket</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">packet</span><span class="o">)</span>
<span class="n">socket</span><span class="o">.</span><span class="na">setSoTimeout</span><span class="o">(</span><span class="mi">30000</span><span class="o">)</span> <span class="c1">// block for no more than 30 seconds</span>
<span class="n">buffer</span> <span class="o">=</span> <span class="o">(</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">4096</span><span class="o">)</span> <span class="k">as</span> <span class="kt">byte</span><span class="o">[]</span>
<span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramPacket</span><span class="o">(</span><span class="n">buffer</span><span class="o">,</span> <span class="n">buffer</span><span class="o">.</span><span class="na">length</span><span class="o">)</span>
<span class="n">socket</span><span class="o">.</span><span class="na">receive</span><span class="o">(</span><span class="n">response</span><span class="o">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">response</span><span class="o">.</span><span class="na">length</span><span class="o">)</span>
<span class="n">println</span> <span class="s2">&quot;Server said: &#39;$s&#39;&quot;</span>
<span class="c1">// =&gt; Server said: &#39;Client said: &#39;Original Message&#39;&#39;</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN937"
>Using UNIX Domain Sockets</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// DOMAIN sockets not available in cross platform form.</span>
<span class="c1">// On Linux, use jbuds:</span>
<span class="c1">// http://www.graphixprose.com/jbuds/</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN940"
>Identifying the Other End of a Socket</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// TCP socket</span>
<span class="n">socketAddress</span> <span class="o">=</span> <span class="n">tcpSocket</span><span class="o">.</span><span class="na">remoteSocketAddress</span>
<span class="n">println</span> <span class="s2">&quot;$socketAddress.address, $socketAddress.hostName, $socketAddress.port&quot;</span>
<span class="c1">// UDP packet</span>
<span class="n">println</span> <span class="s2">&quot;$udpPacket.address, $udpPacket.port&quot;</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN943"
>Finding Your Own Name and Address</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Print the fully qualified domain name for this IP address</span>
<span class="n">println</span> <span class="n">InetAddress</span><span class="o">.</span><span class="na">localHost</span><span class="o">.</span><span class="na">canonicalHostName</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN946"
>Closing a Socket After Forking</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">socket</span><span class="o">.</span><span class="na">shutdownInput</span><span class="o">()</span>
<span class="n">socket</span><span class="o">.</span><span class="na">shutdownOutput</span><span class="o">()</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN949"
>Writing Bidirectional Clients</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Spawn off a thread to handle each direction</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN952"
>Forking Servers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Spawn off a thread to handle each request.</span>
<span class="c1">// This is done automatically by the Groovy accept() method on ServerSocket.</span>
<span class="c1">// See 17.3 for an example.</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN955"
>Pre-Forking Servers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Use a thread pool</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN958"
>Non-Forking Servers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Consider using Selector and/or SocketChannel, ServerSocketChannel and DatagramChannel</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN961"
>Writing a Multi-Homed Server</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// When creating a socket on a multihomed machine, use the socket constructor with</span>
<span class="c1">// 4 params to select a specific address from those available:</span>
<span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Socket</span><span class="o">(</span><span class="n">remoteAddr</span><span class="o">,</span> <span class="n">remotePort</span><span class="o">,</span> <span class="n">localAddr</span><span class="o">,</span> <span class="n">localPort</span><span class="o">)</span>

<span class="c1">// When creating a server on a multihomed machine supply the optional bindAddr param:</span>
<span class="k">new</span> <span class="nf">ServerSocket</span><span class="o">(</span><span class="n">port</span><span class="o">,</span> <span class="n">queueLength</span><span class="o">,</span> <span class="n">bindAddr</span><span class="o">)</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN964"
>Making a Daemon Server</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Fork off a thread for your server and call setDaemon(true) on the thread.</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN967"
>Restarting a Server on Demand</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Consider using special packages designed to provide robust startup/shutdown</span>
<span class="c1">// capability, e.g.: http://jakarta.apache.org/commons/daemon/</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN970"
>Program: backsniff</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Alternative to cookbook as proposed inetd solution is not cross platform.</span>
<span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
<span class="k">for</span> <span class="o">(</span><span class="n">port</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">1024</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Socket</span><span class="o">(</span><span class="n">host</span><span class="o">,</span> <span class="n">port</span><span class="o">)</span>
        <span class="n">println</span><span class="o">(</span><span class="s2">&quot;There is a server on port $port of $host&quot;</span><span class="o">)</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{}</span>
<span class="o">}</span>
<span class="c1">// You could open a ServerSocket() on each unused port and monitor those.</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN973"
>Program: fwdport</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// It&#39;s not too hard to write a TCP Proxy in Groovy but numerous Java packages</span>
<span class="c1">// already exist, so we might as well use one of those:</span>
<span class="c1">// http://ws.apache.org/axis/java/user-guide.html#AppendixUsingTheAxisTCPMonitorTcpmon</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="processmanagementetc.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="internetservices.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Process Management and Communication</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Internet Services</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>