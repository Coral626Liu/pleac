<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>References and Records</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Groovy"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Subroutines"
HREF="subroutines.html"><LINK
REL="NEXT"
TITLE="Packages, Libraries, and Modules"
HREF="packagesetc.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Groovy</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="subroutines.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="packagesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="REFERENCESANDRECORDS"
>11. References and Records</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN592"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// In Groovy, most usages of names are references (there are some special</span>
<span class="c1">// rules for the map shorthand notation and builders).</span>
<span class="c1">// Objects are inherently anonymous, they don&#39;t know what names refer to them.</span>
<span class="n">ref</span> <span class="o">=</span> <span class="mi">3</span>       <span class="c1">// points ref to an Integer object with value 3.</span>
<span class="n">println</span> <span class="n">ref</span>   <span class="c1">// prints the value that the name ref refers to.</span>

<span class="n">myList</span> <span class="o">=</span> <span class="o">[</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">]</span>       <span class="c1">// myList is a name for this list</span>
<span class="n">anotherRef</span> <span class="o">=</span> <span class="n">myList</span>
<span class="n">myMap</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;How&quot;</span><span class="o">:</span> <span class="s2">&quot;Now&quot;</span><span class="o">,</span> <span class="s2">&quot;Brown&quot;</span><span class="o">:</span> <span class="s2">&quot;Cow&quot;</span><span class="o">]</span> <span class="c1">// myMap is a name for this map</span>

<span class="n">anArray</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">]</span> <span class="k">as</span> <span class="kt">int</span><span class="o">[]</span> <span class="c1">// creates an array of three references to Integer objects</span>

<span class="n">list</span> <span class="o">=</span> <span class="o">[[]]</span>  <span class="c1">// a list containing an empty list</span>
<span class="n">list</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;Cat&#39;</span>
<span class="n">println</span> <span class="n">list</span> <span class="c1">// =&gt; [[], null, &quot;Cat&quot;]</span>
<span class="n">list</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;Dog&#39;</span>
<span class="n">println</span> <span class="n">list</span> <span class="c1">// =&gt; [[null, null, &quot;Dog&quot;], null, &quot;Cat&quot;]</span>

<span class="n">a</span> <span class="o">=</span> <span class="o">[</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span>  <span class="c1">// b is a reference to the same thing as a</span>
<span class="n">a</span><span class="o">.</span><span class="na">sort</span><span class="o">()</span>
<span class="n">println</span> <span class="n">b</span> <span class="c1">// =&gt; [1, 2]</span>

<span class="n">nat</span> <span class="o">=</span> <span class="o">[</span> <span class="nl">Name:</span> <span class="s2">&quot;Leonhard Euler&quot;</span><span class="o">,</span>
        <span class="nl">Address:</span> <span class="s2">&quot;1729 Ramanujan Lane\nMathworld, PI 31416&quot;</span><span class="o">,</span>
        <span class="nl">Birthday:</span> <span class="mh">0x5bb5580</span>
<span class="o">]</span>
<span class="n">println</span> <span class="n">nat</span>
<span class="c1">// =&gt;[&quot;Address&quot;:&quot;1729 Ramanujan Lane\nMathworld, PI 31416&quot;, &quot;Name&quot;:&quot;Leonhard Euler&quot;, &quot;Birthday&quot;:96163200]</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN595"
>Taking References to Arrays</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="n">aref</span> <span class="o">=</span> <span class="n">myList</span>
<span class="n">anonList</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">9</span><span class="o">]</span>
<span class="n">anonCopy</span> <span class="o">=</span> <span class="n">anonList</span>
<span class="n">implicitCreation</span> <span class="o">=</span> <span class="o">[</span><span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">10</span><span class="o">]</span>

<span class="n">anonList</span> <span class="o">+=</span> <span class="mi">11</span>
<span class="n">println</span> <span class="n">anonList</span>  <span class="c1">// =&gt; [1, 3, 5, 7, 9, 11]</span>

<span class="n">two</span> <span class="o">=</span> <span class="n">implicitCreation</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
<span class="k">assert</span> <span class="n">two</span> <span class="o">==</span> <span class="mi">2</span>

<span class="c1">//  To get the last index of a list, you can use size()</span>
<span class="c1">// but you never would</span>
<span class="n">lastIdx</span> <span class="o">=</span> <span class="n">aref</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span>

<span class="c1">// Normally, though, you&#39;d use an index of -1 for the last</span>
<span class="c1">// element, -2 for the second last, etc.</span>
<span class="n">println</span> <span class="n">implicitCreation</span><span class="o">[-</span><span class="mi">1</span><span class="o">]</span>
<span class="c1">//=&gt; 10</span>

<span class="c1">// And if you were looping through (and not using a list closure operator)</span>
<span class="o">(</span><span class="mi">0</span><span class="o">..&lt;</span><span class="n">aref</span><span class="o">.</span><span class="na">size</span><span class="o">()).</span><span class="na">each</span><span class="o">{</span> <span class="cm">/* do something */</span> <span class="o">}</span>

<span class="n">numItems</span> <span class="o">=</span> <span class="n">aref</span><span class="o">.</span><span class="na">size</span><span class="o">()</span>

<span class="k">assert</span> <span class="n">anArray</span> <span class="k">instanceof</span> <span class="kt">int</span><span class="o">[]</span>
<span class="k">assert</span> <span class="n">anArray</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isArray</span><span class="o">()</span>
<span class="n">println</span> <span class="n">anArray</span>

<span class="n">myList</span><span class="o">.</span><span class="na">sort</span><span class="o">()</span> <span class="c1">// sort is in place.</span>
<span class="n">myList</span> <span class="o">+=</span> <span class="s2">&quot;an item&quot;</span> <span class="c1">// append item</span>

<span class="kt">def</span> <span class="nf">createList</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="o">[]</span> <span class="o">}</span>
<span class="n">aref1</span> <span class="o">=</span> <span class="n">createList</span><span class="o">()</span>
<span class="n">aref2</span> <span class="o">=</span> <span class="n">createList</span><span class="o">()</span>
<span class="c1">// aref1 and aref2 point to different lists.</span>

<span class="n">println</span> <span class="n">anonList</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="c1">// refers to the 4th item in the list_ref list.</span>

<span class="c1">// The following two statements are equivalent and return up to 3 elements</span>
<span class="c1">// at indices 3, 4, and 5 (if they exist).</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">anonList</span><span class="o">[</span><span class="mi">3</span><span class="o">..</span><span class="mi">5</span><span class="o">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">anonList</span><span class="o">[(</span><span class="mi">3</span><span class="o">..</span><span class="mi">5</span><span class="o">).</span><span class="na">step</span><span class="o">(</span><span class="mi">1</span><span class="o">)]</span>

<span class="c1">//   This will insert 3 elements, overwriting elements at indices 3,4, or 5 - if they exist.</span>
<span class="n">anonList</span><span class="o">[</span><span class="mi">3</span><span class="o">..</span><span class="mi">5</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;blackberry&quot;</span><span class="o">,</span> <span class="s2">&quot;blueberry&quot;</span><span class="o">,</span> <span class="s2">&quot;pumpkin&quot;</span><span class="o">]</span>

<span class="c1">// non index-based looping</span>
<span class="k">for</span> <span class="o">(</span><span class="n">item</span> <span class="k">in</span> <span class="n">anonList</span><span class="o">)</span> <span class="n">println</span> <span class="n">item</span>
<span class="n">anonList</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">println</span> <span class="n">it</span> <span class="o">}</span>

<span class="c1">// index-based looping</span>
<span class="o">(</span><span class="mi">0</span><span class="o">..&lt;</span><span class="n">anonList</span><span class="o">.</span><span class="na">size</span><span class="o">()).</span><span class="na">each</span><span class="o">{</span> <span class="n">idx</span> <span class="o">-&gt;</span> <span class="n">println</span> <span class="n">anonList</span><span class="o">[</span><span class="n">idx</span><span class="o">]</span> <span class="o">}</span>
<span class="k">for</span> <span class="o">(</span><span class="n">idx</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..&lt;</span><span class="n">anonList</span><span class="o">.</span><span class="na">size</span><span class="o">())</span> <span class="n">println</span> <span class="n">anonList</span><span class="o">[</span><span class="n">idx</span><span class="o">]</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN598"
>Making Hashes of Arrays</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Making Hashes of Arrays</span>
<span class="n">hash</span> <span class="o">=</span> <span class="o">[:]</span> <span class="c1">// empty map</span>
<span class="n">hash</span><span class="o">[</span><span class="s2">&quot;KEYNAME&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;new value&quot;</span>

<span class="n">hash</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span> <span class="o">-&gt;</span> <span class="n">println</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">}</span>

<span class="n">hash</span><span class="o">[</span><span class="s2">&quot;a key&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">hash</span><span class="o">[</span><span class="s2">&quot;a key&quot;</span><span class="o">]</span>

<span class="n">hash</span><span class="o">[</span><span class="s2">&quot;a key&quot;</span><span class="o">]</span> <span class="o">+=</span> <span class="mi">6</span>
<span class="n">println</span> <span class="n">hash</span>
<span class="c1">// =&gt; [&quot;KEYNAME&quot;:&quot;new value&quot;, &quot;a key&quot;:[3, 4, 5, 6]]</span>

<span class="c1">// attempting to access a value for a key not in the map yields null</span>
<span class="k">assert</span> <span class="n">hash</span><span class="o">[</span><span class="s1">&#39;unknown key&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span>
<span class="k">assert</span> <span class="n">hash</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s1">&#39;unknown key&#39;</span><span class="o">,</span> <span class="mi">45</span><span class="o">)</span> <span class="o">==</span> <span class="mi">45</span>
<span class="n">println</span> <span class="n">hash</span>
<span class="c1">// =&gt; [&quot;unknown key&quot;:45, &quot;KEYNAME&quot;:&quot;new value&quot;, &quot;a key&quot;:[3, 4, 5, 6]]</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN601"
>Taking References to Hashes</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// Hashes are no different to other objects</span>
<span class="n">myHash</span> <span class="o">=</span> <span class="o">[</span> <span class="nl">key1:</span><span class="mi">100</span><span class="o">,</span> <span class="nl">key2:</span><span class="mi">200</span> <span class="o">]</span>
<span class="n">myHashCopy</span> <span class="o">=</span> <span class="n">myHash</span><span class="o">.</span><span class="na">clone</span><span class="o">()</span>

<span class="n">value</span> <span class="o">=</span> <span class="n">myHash</span><span class="o">[</span><span class="s1">&#39;key1&#39;</span><span class="o">]</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">myHash</span><span class="o">.</span><span class="s1">&#39;key1&#39;</span>
<span class="n">slice</span> <span class="o">=</span> <span class="n">myHash</span><span class="o">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="o">]</span>
<span class="n">keys</span> <span class="o">=</span> <span class="n">myHash</span><span class="o">.</span><span class="na">keySet</span><span class="o">()</span>

<span class="k">assert</span> <span class="n">myHash</span> <span class="k">instanceof</span> <span class="n">Map</span>

<span class="o">[</span><span class="n">myHash</span><span class="o">,</span> <span class="n">hash</span><span class="o">].</span><span class="na">each</span><span class="o">{</span> <span class="n">m</span> <span class="o">-&gt;</span>
    <span class="n">m</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">k</span><span class="o">,</span> <span class="n">v</span> <span class="o">-&gt;</span> <span class="n">println</span> <span class="s2">&quot;$k =&gt; $v&quot;</span><span class="o">}</span>
<span class="o">}</span>
<span class="c1">// =&gt;</span>
<span class="c1">// key1 =&gt; 100</span>
<span class="c1">// key2 =&gt; 200</span>
<span class="c1">// unknown key =&gt; 45</span>
<span class="c1">// KEYNAME =&gt; new value</span>
<span class="c1">// a key =&gt; [3, 4, 5, 6]</span>

<span class="n">values</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;key1&#39;</span><span class="o">,</span><span class="s1">&#39;key2&#39;</span><span class="o">].</span><span class="na">collect</span><span class="o">{</span> <span class="n">myHash</span><span class="o">[</span><span class="n">it</span><span class="o">]</span> <span class="o">}</span>
<span class="n">println</span> <span class="n">values</span>  <span class="c1">// =&gt; [100, 200]</span>

<span class="k">for</span> <span class="o">(</span><span class="n">key</span> <span class="k">in</span> <span class="o">[</span><span class="s2">&quot;key1&quot;</span><span class="o">,</span> <span class="s2">&quot;key2&quot;</span><span class="o">])</span> <span class="o">{</span>
    <span class="n">myHash</span><span class="o">[</span><span class="n">key</span><span class="o">]</span> <span class="o">+=</span> <span class="mi">7</span>
<span class="o">}</span>
<span class="n">println</span> <span class="n">myHash</span>  <span class="c1">// =&gt; [&quot;key1&quot;:107, &quot;key2&quot;:207]</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN604"
>Taking References to Functions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// you can use closures or the &amp;method notation</span>
<span class="kt">def</span> <span class="nf">joy</span><span class="o">()</span> <span class="o">{</span> <span class="n">println</span> <span class="s1">&#39;joy&#39;</span> <span class="o">}</span>
<span class="kt">def</span> <span class="nf">sullen</span><span class="o">()</span> <span class="o">{</span> <span class="n">println</span> <span class="s1">&#39;sullen&#39;</span> <span class="o">}</span>
<span class="n">angry</span> <span class="o">=</span> <span class="o">{</span> <span class="n">println</span> <span class="s1">&#39;angry&#39;</span> <span class="o">}</span>
<span class="n">commands</span> <span class="o">=</span> <span class="o">[</span><span class="nl">happy:</span> <span class="k">this</span><span class="o">.&amp;</span><span class="n">joy</span><span class="o">,</span>
            <span class="nl">sad:</span>   <span class="k">this</span><span class="o">.&amp;</span><span class="n">sullen</span><span class="o">,</span>
            <span class="nl">done:</span>  <span class="o">{</span> <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">},</span>
            <span class="nl">mad:</span>   <span class="n">angry</span>
<span class="o">]</span>

<span class="n">print</span> <span class="s2">&quot;How are you?&quot;</span>
<span class="n">cmd</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">()</span>
<span class="k">if</span> <span class="o">(</span><span class="n">cmd</span> <span class="k">in</span> <span class="n">commands</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="n">commands</span><span class="o">[</span><span class="n">cmd</span><span class="o">]()</span>
<span class="k">else</span> <span class="n">println</span> <span class="s2">&quot;No such command: $cmd&quot;</span>


<span class="c1">// a counter of the type referred to in the original cookbook</span>
<span class="c1">// would be implemented using a class</span>
<span class="kt">def</span> <span class="nf">counterMaker</span><span class="o">(){</span>
    <span class="kt">def</span> <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="o">{</span> <span class="o">-&gt;</span> <span class="n">start</span><span class="o">++;</span> <span class="n">start</span><span class="o">-</span><span class="mi">1</span> <span class="o">}</span>
<span class="o">}</span>

<span class="n">counter</span> <span class="o">=</span> <span class="n">counterMaker</span><span class="o">()</span>
<span class="mi">5</span><span class="o">.</span><span class="na">times</span><span class="o">{</span> <span class="n">print</span> <span class="s2">&quot;${counter()} &quot;</span> <span class="o">};</span> <span class="n">println</span><span class="o">()</span>

<span class="n">counter1</span> <span class="o">=</span> <span class="n">counterMaker</span><span class="o">()</span>
<span class="n">counter2</span> <span class="o">=</span> <span class="n">counterMaker</span><span class="o">()</span>

<span class="mi">5</span><span class="o">.</span><span class="na">times</span><span class="o">{</span> <span class="n">println</span> <span class="s2">&quot;${counter1()} &quot;</span> <span class="o">}</span>
<span class="n">println</span> <span class="s2">&quot;${counter1()} ${counter2()}&quot;</span>
<span class="c1">//=&gt; 0</span>
<span class="c1">//=&gt; 1</span>
<span class="c1">//=&gt; 2</span>
<span class="c1">//=&gt; 3</span>
<span class="c1">//=&gt; 4</span>
<span class="c1">//=&gt; 5 0</span>


<span class="kt">def</span> <span class="nf">timestamp</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span>
    <span class="k">return</span> <span class="o">{</span> <span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">start</span><span class="o">).</span><span class="na">intdiv</span><span class="o">(</span><span class="mi">1000</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>
<span class="n">early</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">()</span>
<span class="c1">//sleep(10000)</span>
<span class="n">later</span> <span class="o">=</span> <span class="n">timestamp</span><span class="o">()</span>
<span class="n">sleep</span><span class="o">(</span><span class="mi">2000</span><span class="o">)</span>
<span class="n">println</span> <span class="s2">&quot;It&#39;s been ${early()} seconds since early.&quot;</span>
<span class="n">println</span> <span class="s2">&quot;It&#39;s been ${later()} seconds since later.&quot;</span>
<span class="c1">//=&gt; It&#39;s been 12 seconds since early.</span>
<span class="c1">//=&gt; It&#39;s been 2 seconds since later.</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN607"
>Taking References to Scalars</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// All variables in Groovy are objects including primitives. Some objects</span>
<span class="c1">// are immutable. Some operations on objects change mutable objects.</span>
<span class="c1">// Some operations produce new objects.</span>

<span class="c1">// 15 is an Integer which is an immutable object.</span>
<span class="c1">// passing 15 to a method passes a reference to the Integer object.</span>
<span class="kt">def</span> <span class="nf">print</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">{</span> <span class="n">println</span> <span class="s2">&quot;${n.toString()}&quot;</span> <span class="o">}</span>
<span class="n">print</span><span class="o">(</span><span class="mi">15</span><span class="o">)</span>  <span class="c1">// no need to create any kind of explicit reference</span>

<span class="c1">// even though Integers are immutable, references to them are not</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span>
<span class="n">println</span> <span class="s2">&quot;$x $y&quot;</span>  <span class="c1">// =&gt; 1 1</span>
<span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>    <span class="c1">// &quot;x&quot; now refers to a different object than y</span>
<span class="n">println</span> <span class="s2">&quot;$x $y&quot;</span>  <span class="c1">// =&gt; 2 1</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">4</span>     <span class="c1">// &quot;y&quot; now refers to a different object than it did before</span>
<span class="n">println</span> <span class="s2">&quot;$x $y&quot;</span>  <span class="c1">// =&gt; 2 4</span>

<span class="c1">// Some objects (including ints and strings) are immutable, however, which</span>
<span class="c1">// can give the illusion of a by-value/by-reference distinction:</span>
<span class="n">list</span> <span class="o">=</span> <span class="o">[[</span><span class="mi">1</span><span class="o">],</span> <span class="mi">1</span><span class="o">,</span> <span class="s1">&#39;s&#39;</span><span class="o">]</span>
<span class="n">list</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">it</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">}</span> <span class="c1">// plus operator doesn&#39;t operate inplace</span>
<span class="n">print</span> <span class="n">list</span> <span class="c1">//=&gt; [[1] 1 s]</span>
<span class="n">list</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">collect</span><span class="o">{</span> <span class="n">it</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">}</span>
<span class="n">print</span> <span class="n">list</span> <span class="c1">//=&gt; [[1, 1], 2, s1]</span>

<span class="n">list</span> <span class="o">=</span> <span class="o">[[</span><span class="s1">&#39;Z&#39;</span><span class="o">,</span> <span class="s1">&#39;Y&#39;</span><span class="o">,</span> <span class="s1">&#39;X&#39;</span><span class="o">],</span> <span class="o">[</span><span class="s1">&#39;C&#39;</span><span class="o">,</span> <span class="s1">&#39;B&#39;</span><span class="o">,</span> <span class="s1">&#39;A&#39;</span><span class="o">],</span> <span class="o">[</span><span class="mi">5</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">1</span><span class="o">]]</span>
<span class="n">list</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">sort</span><span class="o">()</span> <span class="o">}</span> <span class="c1">// sort operation operates inline</span>
<span class="n">println</span> <span class="n">list</span> <span class="c1">// =&gt; [[&quot;X&quot;, &quot;Y&quot;, &quot;Z&quot;], [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;], [1, 3, 5]]</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN610"
>Creating Arrays of Scalar References</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// As indicated by the previous section, everything is referenced, so</span>
<span class="c1">// just create a list as normal, and beware that augmented assignment</span>
<span class="c1">// works differently with immutable objects to mutable ones and depends</span>
<span class="c1">// on the semantics of the particular operation invoked:</span>
<span class="n">mylist</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="s2">&quot;s&quot;</span><span class="o">,</span> <span class="o">[</span><span class="mi">1</span><span class="o">]]</span>
<span class="n">print</span> <span class="n">mylist</span>
<span class="c1">//=&gt; [1, s, [1]]</span>

<span class="n">mylist</span><span class="o">.</span><span class="na">each</span><span class="o">{</span> <span class="n">it</span> <span class="o">*=</span> <span class="mi">2</span> <span class="o">}</span>
<span class="n">print</span> <span class="n">mylist</span>
<span class="c1">//=&gt; [1, s, [1,1]]</span>

<span class="n">mylist</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">*=</span> <span class="mi">2</span>
<span class="n">mylist</span><span class="o">[-</span><span class="mi">1</span><span class="o">]</span> <span class="o">*=</span> <span class="mi">2</span>
<span class="n">print</span> <span class="n">mylist</span>
<span class="c1">//=&gt; [2, s, [1, 1]]</span>

<span class="c1">// If you need to modify every value in a list, you use collect</span>
<span class="c1">// which does NOT modify inplace but rather returns a new collection:</span>
<span class="n">mylist</span> <span class="o">=</span> <span class="mi">1</span><span class="o">..</span><span class="mi">4</span>
<span class="n">println</span> <span class="n">mylist</span><span class="o">.</span><span class="na">collect</span><span class="o">{</span> <span class="n">it</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">4</span><span class="s">/3 * Math.PI }</span>
<span class="s">// =&gt; [4.188790204681671, 33.510321638395844, 113.09733552923255, 268.0825731062243]</span>
<span class="s">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN613"
>Using Closures Instead of Objects</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s"></span><span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">def mkcounter(count) {</span>
<span class="s">    def start = count</span>
<span class="s">    def bundle = [:]</span>
<span class="s">    bundle.&#39;NEXT&#39; = { count += 1 }</span>
<span class="s">    bundle.&#39;PREV&#39; = { count -= 1 }</span>
<span class="s">    bundle.&#39;RESET&#39; = { count = start }</span>
<span class="s">    bundle[&quot;LAST&quot;] = bundle[&quot;PREV&quot;]</span>
<span class="s">    return bundle</span>
<span class="s">}</span>

<span class="s">c1 = mkcounter(20)</span>
<span class="s">c2 = mkcounter(77)</span>

<span class="s">println &quot;next c1: ${c1[&quot;NEXT&quot;]()}&quot;  // 21</span>
<span class="s">println &quot;next c2: ${c2[&quot;NEXT&quot;]()}&quot;  // 78</span>
<span class="s">println &quot;next c1: ${c1[&quot;NEXT&quot;]()}&quot;  // 22</span>
<span class="s">println &quot;last c1: ${c1[&quot;PREV&quot;]()}&quot;  // 21</span>
<span class="s">println &quot;last c1: ${c1[&quot;LAST&quot;]()}&quot;  // 20</span>
<span class="s">println &quot;old  c2: ${c2[&quot;RESET&quot;]()}&quot; // 77</span>
<span class="s">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN616"
>Creating References to Methods</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s"></span><span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">def addAndMultiply(a, b) {</span>
<span class="s">    println &quot;${a+b} ${a*b}&quot;</span>
<span class="s">}</span>
<span class="s">methRef = this.&amp;addAndMultiply</span>
<span class="s">// or use direct closure</span>
<span class="s">multiplyAndAdd = { a,b -&gt; println &quot;${a*b} ${a+b}&quot; }</span>
<span class="s">// later ...</span>
<span class="s">methRef(2,3)                   // =&gt; 5 6</span>
<span class="s">multiplyAndAdd(2,3)            // =&gt; 6 5</span>
<span class="s">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN619"
>Constructing Records</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s"></span><span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">record = [</span>
<span class="s">    &quot;name&quot;: &quot;Jason&quot;,</span>
<span class="s">    &quot;empno&quot;: 132,</span>
<span class="s">    &quot;title&quot;: &quot;deputy peon&quot;,</span>
<span class="s">    &quot;age&quot;: 23,</span>
<span class="s">    &quot;salary&quot;: 37000,</span>
<span class="s">    &quot;pals&quot;: [&quot;Norbert&quot;, &quot;Rhys&quot;, &quot;Phineas&quot;],</span>
<span class="s">]</span>
<span class="s">println &quot;I am ${record.&#39;name&#39;}, and my pals are ${record.&#39;pals&#39;.join(&#39;, &#39;)}.&quot;</span>
<span class="s">// =&gt; I am Jason, and my pals are Norbert, Rhys, Phineas.</span>

<span class="s">byname = [:]</span>
<span class="s">byname[record[&quot;name&quot;]] = record</span>

<span class="s">rp = byname.get(&quot;Aron&quot;)</span>
<span class="s">if (rp) println &quot;Aron is employee ${rp[&quot;empno&quot;]}.&quot;</span>

<span class="s">byname[&quot;Jason&quot;][&quot;pals&quot;] += &quot;Theodore&quot;</span>
<span class="s">println &quot;Jason now has ${byname[&#39;Jason&#39;][&#39;pals&#39;].size()} pals.&quot;</span>

<span class="s">byname.each{ name, record -&gt;</span>
<span class="s">    println &quot;$name is employee number ${record[&#39;empno&#39;]}.&quot;</span>
<span class="s">}</span>

<span class="s">employees = [:]</span>
<span class="s">employees[record[&quot;empno&quot;]] = record</span>

<span class="s">// lookup by id</span>
<span class="s">rp = employees[132]</span>
<span class="s">if (rp) println &quot;Employee number 132 is ${rp.&#39;name&#39;}.&quot;</span>

<span class="s">byname[&quot;Jason&quot;][&quot;salary&quot;] *= 1.035</span>
<span class="s">println record</span>
<span class="s">// =&gt; [&quot;pals&quot;:[&quot;Norbert&quot;, &quot;Rhys&quot;, &quot;Phineas&quot;, &quot;Theodore&quot;], &quot;age&quot;:23,</span>
<span class="s">//      &quot;title&quot;:&quot;deputy peon&quot;, &quot;name&quot;:&quot;Jason&quot;, &quot;salary&quot;:38295.000, &quot;empno&quot;:132]</span>

<span class="s">peons = employees.findAll{ k, v -&gt; v.&#39;title&#39; =~ /</span><span class="o">(?</span><span class="n">i</span><span class="o">)</span><span class="n">peon</span><span class="s">/ }</span>
<span class="s">assert peons.size() == 1</span>
<span class="s">tsevens = employees.findAll{ k, v -&gt; v.&#39;age&#39; == 27 }</span>
<span class="s">assert tsevens.size() == 0</span>

<span class="s">// Go through all records</span>
<span class="s">println &#39;Names are: &#39; + employees.values().collect{r-&gt;r.&#39;name&#39;}.join(&#39;, &#39;)</span>

<span class="s">byAge = {a,b-&gt; a.value().&#39;age&#39; &lt;=&gt; b.value().&#39;age&#39;}</span>
<span class="s">employees.values().sort{byAge}.each{ r-&gt;</span>
<span class="s">    println &quot;${r.&#39;name&#39;} is ${r.&#39;age&#39;}&quot;</span>
<span class="s">}</span>

<span class="s">// byage, a hash: age =&gt; list of records</span>
<span class="s">byage = [:]</span>
<span class="s">byage[record[&quot;age&quot;]] = byage.get(record[&quot;age&quot;], []) + [record]</span>

<span class="s">byage.each{ age, list -&gt;</span>
<span class="s">    println &quot;Age $age: ${list.collect{it.&#39;name&#39;}.join(&#39;, &#39;)}&quot;</span>
<span class="s">}</span>
<span class="s">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN622"
>Reading and Writing Hash Records to Text Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s"></span><span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// if you are using a Properties (see 8.16) then just use load</span>
<span class="s">// and store (or storeToXML)</span>
<span class="s">// variation to original cookbook as Groovy can use Java&#39;s object serialization</span>
<span class="s">map = [1:&#39;Jan&#39;, 2:&#39;Feb&#39;, 3:&#39;Mar&#39;]</span>
<span class="s">// write</span>
<span class="s">new File(&#39;months.dat&#39;).withObjectOutputStream{ oos -&gt;</span>
<span class="s">    oos.writeObject(map)</span>
<span class="s">}</span>
<span class="s">// reset</span>
<span class="s">map = null</span>
<span class="s">// read</span>
<span class="s">new File(&#39;months.dat&#39;).withObjectInputStream{ ois -&gt;</span>
<span class="s">    map = ois.readObject()</span>
<span class="s">}</span>
<span class="s">println map // =&gt; [1:&quot;Jan&quot;, 2:&quot;Feb&quot;, 3:&quot;Mar&quot;]</span>
<span class="s">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN625"
>Printing Data Structures</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s"></span><span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">// Groovy automatically does pretty printing for some of the key types, e.g.</span>
<span class="s">mylist = [[1,2,3], [4, [5,6,7], 8,9, [0,3,5]], 7, 8]</span>
<span class="s">println mylist</span>
<span class="s">// =&gt; [[1, 2, 3], [4, [5, 6, 7], 8, 9, [0, 3, 5]], 7, 8]</span>

<span class="s">mydict = [&quot;abc&quot;: &quot;def&quot;, &quot;ghi&quot;:[1,2,3]]</span>
<span class="s">println mydict</span>
<span class="s">// =&gt; [&quot;abc&quot;:&quot;def&quot;, &quot;ghi&quot;:[1, 2, 3]]</span>

<span class="s">// if you have another type of object you can use the built-in dump() method</span>
<span class="s">class PetLover {</span>
<span class="s">    def name</span>
<span class="s">    def age</span>
<span class="s">    def pets</span>
<span class="s">}</span>
<span class="s">p = new PetLover(name:&#39;Jason&#39;, age:23, pets:[dog:&#39;Rover&#39;,cat:&#39;Garfield&#39;])</span>
<span class="s">println p</span>
<span class="s">// =&gt; PetLover@b957ea</span>
<span class="s">println p.dump()</span>
<span class="s">// =&gt; &lt;PetLover@b957ea name=Jason age=23 pets=[&quot;cat&quot;:&quot;Garfield&quot;, &quot;dog&quot;:&quot;Rover&quot;]&gt;</span>

<span class="s">// If that isn&#39;t good enough, you can use Boost (http://tara-indigo.org/</span><span class="n">daisy</span><span class="s">/geekscape/</span><span class="n">g2</span><span class="s">/128)</span>
<span class="s">// or Jakarta Commons Lang *ToStringBuilders (jakarta.apache.org/</span><span class="n">commons</span><span class="o">)</span>
<span class="c1">// Here&#39;s an example of Boost, just extend the supplied Primordial class</span>
<span class="kn">import</span> <span class="nn">au.net.netstorm.boost.primordial.Primordial</span>
<span class="kd">class</span> <span class="nc">PetLover2</span> <span class="kd">extends</span> <span class="n">Primordial</span> <span class="o">{</span> <span class="kt">def</span> <span class="n">name</span><span class="o">,</span> <span class="n">age</span><span class="o">,</span> <span class="n">pets</span> <span class="o">}</span>
<span class="n">println</span> <span class="k">new</span> <span class="nf">PetLover2</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;Jason&#39;</span><span class="o">,</span> <span class="nl">age:</span><span class="mi">23</span><span class="o">,</span> <span class="nl">pets:</span><span class="o">[</span><span class="nl">dog:</span><span class="s1">&#39;Rover&#39;</span><span class="o">,</span><span class="nl">cat:</span><span class="s1">&#39;Garfield&#39;</span><span class="o">])</span>
<span class="c1">// =&gt;</span>
<span class="c1">// PetLover2[</span>
<span class="c1">//     name=Jason</span>
<span class="c1">//     age=23</span>
<span class="c1">//     pets={cat=Garfield, dog=Rover}</span>
<span class="c1">//     metaClass=groovy.lang.MetaClassImpl@1d8d39f[class PetLover2]</span>
<span class="c1">// ]</span>

<span class="c1">// using Commons Lang ReflectionToStringBuilder (equivalent to dump())</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang.builder.*</span>
<span class="kd">class</span> <span class="nc">PetLover3</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">name</span><span class="o">,</span> <span class="n">age</span><span class="o">,</span> <span class="n">pets</span>
    <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">ReflectionToStringBuilder</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">println</span> <span class="k">new</span> <span class="nf">PetLover3</span><span class="o">(</span><span class="nl">name:</span><span class="s1">&#39;Jason&#39;</span><span class="o">,</span> <span class="nl">age:</span><span class="mi">23</span><span class="o">,</span> <span class="nl">pets:</span><span class="o">[</span><span class="nl">dog:</span><span class="s1">&#39;Rover&#39;</span><span class="o">,</span><span class="nl">cat:</span><span class="s1">&#39;Garfield&#39;</span><span class="o">])</span>
<span class="c1">// =&gt; PetLover3@196e136[name=Jason,age=23,pets={cat=Garfield, dog=Rover}]</span>

<span class="c1">// using Commons Lang ToStringBuilder if you want a custom format</span>
<span class="kd">class</span> <span class="nc">PetLover4</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">name</span><span class="o">,</span> <span class="n">dob</span><span class="o">,</span> <span class="n">pets</span>
    <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">def</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">dob</span><span class="o">.</span><span class="na">time</span><span class="o">;</span> <span class="kt">def</span> <span class="n">d2</span> <span class="o">=</span> <span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">()).</span><span class="na">time</span>
        <span class="kt">int</span> <span class="n">age</span> <span class="o">=</span> <span class="o">(</span><span class="n">d2</span> <span class="o">-</span> <span class="n">d1</span><span class="o">)</span><span class="s">/1000/</span><span class="mi">60</span><span class="s">/60/</span><span class="mi">24</span><span class="s">/365 // close approx good enough here</span>
<span class="s">        return new ToStringBuilder(this).</span>
<span class="s">            append(&quot;Pet Lover&#39;s name&quot;, name).</span>
<span class="s">            append(&#39;Pets&#39;, pets).</span>
<span class="s">            append(&#39;Age&#39;, age)</span>
<span class="s">    }</span>
<span class="s">}</span>
<span class="s">println new PetLover4(name:&#39;Jason&#39;, dob:new Date(83,03,04), pets:[dog:&#39;Rover&#39;,cat:&#39;Garfield&#39;])</span>
<span class="s">// =&gt; PetLover4@fdfc58[Pet Lover&#39;s name=Jason,Pets={cat=Garfield, dog=Rover},Age=23]</span>
<span class="s">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN628"
>Copying Data Structures</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s"></span><span class="s">//----------------------------------------------------------------------------------</span>
<span class="s">oldlist = [1, 2, 3]</span>
<span class="s">newlist = new ArrayList(oldlist) // shallow copy</span>
<span class="s">newlist = oldlist.clone() // shallow copy</span>

<span class="s">oldmap = [a:1, b:2, c:3]</span>
<span class="s">newmap = new HashMap(oldmap) // shallow copy</span>
<span class="s">newmap = oldmap.clone() // shallow copy</span>

<span class="s">oldarray = [1, 2, 3] as int[]</span>
<span class="s">newarray = oldarray.clone()</span>

<span class="s">// shallow copies copy a data structure, but don&#39;t copy the items in those</span>
<span class="s">// data structures so if there are nested data structures, both copy and</span>
<span class="s">// original will refer to the same object</span>
<span class="s">mylist = [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;]</span>
<span class="s">newlist = mylist.clone()</span>
<span class="s">mylist[0] = &quot;0&quot;</span>
<span class="s">println &quot;$mylist $newlist&quot;</span>
<span class="s">//=&gt; [&quot;0&quot;, &quot;2&quot;, &quot;3&quot;] [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;]</span>

<span class="s">mylist = [[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;], 4]</span>
<span class="s">newlist = mylist.clone()</span>
<span class="s">mylist[0][0] = &quot;0&quot;</span>
<span class="s">println &quot;$mylist $newlist&quot;</span>
<span class="s">//=&gt; [[&quot;0&quot;, &quot;2&quot;, &quot;3&quot;], 4] [[&quot;0&quot;, &quot;2&quot;, &quot;3&quot;], 4]</span>

<span class="s">// standard deep copy implementation</span>
<span class="s">def deepcopy(orig) {</span>
<span class="s">     bos = new ByteArrayOutputStream()</span>
<span class="s">     oos = new ObjectOutputStream(bos)</span>
<span class="s">     oos.writeObject(orig); oos.flush()</span>
<span class="s">     bin = new ByteArrayInputStream(bos.toByteArray())</span>
<span class="s">     ois = new ObjectInputStream(bin)</span>
<span class="s">     return ois.readObject()</span>
<span class="s">}</span>

<span class="s">newlist = deepcopy(oldlist) // deep copy</span>
<span class="s">newmap  = deepcopy(oldmap)  // deep copy</span>

<span class="s">mylist = [[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;], 4]</span>
<span class="s">newlist = deepcopy(mylist)</span>
<span class="s">mylist[0][0] = &quot;0&quot;</span>
<span class="s">println &quot;$mylist $newlist&quot;</span>
<span class="s">//=&gt; [[&quot;0&quot;, &quot;2&quot;, &quot;3&quot;], 4] [[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;], 4]</span>

<span class="s">// See also:</span>
<span class="s">// http://javatechniques.com/</span><span class="kd">public</span><span class="s">/java/</span><span class="n">docs</span><span class="s">/basics/</span><span class="n">low</span><span class="o">-</span><span class="n">memory</span><span class="o">-</span><span class="n">deep</span><span class="o">-</span><span class="n">copy</span><span class="o">.</span><span class="na">html</span>
<span class="c1">// http://javatechniques.com/public/java/docs/basics/faster-deep-copy.html</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN631"
>Storing Data Structures to Disk</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// use Java&#39;s serialization capabilities as per 11.10</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN634"
>Transparently Persistent Data Structures</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// There are numerous mechanisms for persisting objects to disk</span>
<span class="c1">// using Groovy and Java mechanisms. Some are completely transparent,</span>
<span class="c1">// some require some initialization only, others make the persistence</span>
<span class="c1">// mechanisms visible. Here is a site that lists over 20 options:</span>
<span class="c1">// http://www.java-source.net/open-source/persistence</span>
<span class="c1">// (This list doesn&#39;t include EJB offerings which typically</span>
<span class="c1">// require an application server or XML-based options)</span>

<span class="c1">// We&#39;ll just consider one possibility from prevayler.sf.net.</span>
<span class="c1">// This package doesn&#39;t make changes to persistent data transparent;</span>
<span class="c1">// instead requiring an explicit call via a transaction object.</span>
<span class="c1">// It saves all such transaction objects in a journal file so</span>
<span class="c1">// that it can rollback the system any number of times (or if</span>
<span class="c1">// you make use of the timestamp feature) to a particular point</span>
<span class="c1">// in time. It can also be set up to create snapshots which</span>
<span class="c1">// consolidate all changes made up to a certain point. The</span>
<span class="c1">// journalling will begin again from that point.</span>
<span class="kn">import</span> <span class="nn">org.prevayler.*</span>
<span class="kd">class</span> <span class="nc">ImportantHash</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">map</span> <span class="o">=</span> <span class="o">[:]</span>
    <span class="kt">def</span> <span class="nf">putAt</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span> <span class="n">map</span><span class="o">[</span><span class="n">key</span><span class="o">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">}</span>
    <span class="kt">def</span> <span class="nf">getAt</span><span class="o">(</span><span class="n">key</span><span class="o">)</span> <span class="o">{</span> <span class="n">map</span><span class="o">[</span><span class="n">key</span><span class="o">]</span> <span class="o">}</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">StoreTransaction</span> <span class="kd">implements</span> <span class="n">Transaction</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">val</span>
    <span class="nf">StoreTransaction</span><span class="o">(</span><span class="n">val</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">}</span>
    <span class="kt">void</span> <span class="nf">executeOn</span><span class="o">(</span><span class="n">prevayler</span><span class="o">,</span> <span class="n">Date</span> <span class="n">ignored</span><span class="o">)</span> <span class="o">{</span> <span class="n">prevayler</span><span class="o">.</span><span class="na">putAt</span><span class="o">(</span><span class="n">val</span><span class="o">,</span><span class="n">val</span><span class="o">*</span><span class="mi">2</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>
<span class="kt">def</span> <span class="nf">save</span><span class="o">(</span><span class="n">n</span><span class="o">){</span> <span class="n">store</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">StoreTransaction</span><span class="o">(</span><span class="n">n</span><span class="o">))</span> <span class="o">}</span>
<span class="n">store</span> <span class="o">=</span> <span class="n">PrevaylerFactory</span><span class="o">.</span><span class="na">createPrevayler</span><span class="o">(</span><span class="k">new</span> <span class="n">ImportantHash</span><span class="o">(),</span> <span class="s2">&quot;pleac11&quot;</span><span class="o">)</span>
<span class="n">hash</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">prevalentSystem</span><span class="o">()</span>
<span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="mi">1000</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">save</span><span class="o">(</span><span class="n">i</span><span class="o">)</span>
<span class="o">}</span>
<span class="n">println</span> <span class="n">hash</span><span class="o">[</span><span class="mi">750</span><span class="o">]</span> <span class="c1">// =&gt; 1500</span>

<span class="n">store</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="n">hash</span> <span class="o">=</span> <span class="kc">null</span> <span class="c1">// *** could shutdown here</span>

<span class="n">store</span> <span class="o">=</span> <span class="n">PrevaylerFactory</span><span class="o">.</span><span class="na">createPrevayler</span><span class="o">(</span><span class="k">new</span> <span class="n">ImportantHash</span><span class="o">(),</span> <span class="s2">&quot;pleac11&quot;</span><span class="o">)</span>
<span class="n">hash</span> <span class="o">=</span> <span class="n">store</span><span class="o">.</span><span class="na">prevalentSystem</span><span class="o">()</span>
<span class="n">println</span> <span class="n">hash</span><span class="o">[</span><span class="mi">750</span><span class="o">]</span> <span class="c1">// =&gt; 1500</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN637"
>Program: Binary Trees</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">//----------------------------------------------------------------------------------</span>
<span class="c1">// bintree - binary tree demo program</span>
<span class="kd">class</span> <span class="nc">BinaryTree</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">value</span><span class="o">,</span> <span class="n">left</span><span class="o">,</span> <span class="n">right</span>
    <span class="n">BinaryTree</span><span class="o">(</span><span class="n">val</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">val</span>
        <span class="n">left</span> <span class="o">=</span> <span class="kc">null</span>
        <span class="n">right</span> <span class="o">=</span> <span class="kc">null</span>
    <span class="o">}</span>

    <span class="c1">// insert given value into proper point of</span>
    <span class="c1">// provided tree.  If no tree provided,</span>
    <span class="c1">// use implicit pass by reference aspect of @_</span>
    <span class="c1">// to fill one in for our caller.</span>
    <span class="kt">def</span> <span class="nf">insert</span><span class="o">(</span><span class="n">val</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">left</span><span class="o">)</span> <span class="n">left</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">val</span><span class="o">)</span>
            <span class="k">else</span> <span class="n">left</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BinaryTree</span><span class="o">(</span><span class="n">val</span><span class="o">)</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">right</span><span class="o">)</span> <span class="n">right</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">val</span><span class="o">)</span>
            <span class="k">else</span> <span class="n">right</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BinaryTree</span><span class="o">(</span><span class="n">val</span><span class="o">)</span>
        <span class="o">}</span> <span class="k">else</span> <span class="n">println</span> <span class="s2">&quot;double&quot;</span> <span class="c1">// ignore double values</span>
    <span class="o">}</span>

    <span class="c1">// recurse on left child,</span>
    <span class="c1">// then show current value,</span>
    <span class="c1">// then recurse on right child.</span>
    <span class="kt">def</span> <span class="nf">inOrder</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">left</span><span class="o">)</span> <span class="n">left</span><span class="o">.</span><span class="na">inOrder</span><span class="o">()</span>
        <span class="n">print</span> <span class="n">value</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">right</span><span class="o">)</span> <span class="n">right</span><span class="o">.</span><span class="na">inOrder</span><span class="o">()</span>
    <span class="o">}</span>

    <span class="c1">// show current value,</span>
    <span class="c1">// then recurse on left child,</span>
    <span class="c1">// then recurse on right child.</span>
    <span class="kt">def</span> <span class="nf">preOrder</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">print</span> <span class="n">value</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">left</span><span class="o">)</span> <span class="n">left</span><span class="o">.</span><span class="na">preOrder</span><span class="o">()</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">right</span><span class="o">)</span> <span class="n">right</span><span class="o">.</span><span class="na">preOrder</span><span class="o">()</span>
    <span class="o">}</span>

    <span class="c1">// show current value,</span>
    <span class="c1">// then recurse on left child,</span>
    <span class="c1">// then recurse on right child.</span>
    <span class="kt">def</span> <span class="nf">dumpOrder</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">print</span> <span class="k">this</span><span class="o">.</span><span class="na">dump</span><span class="o">()</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">left</span><span class="o">)</span> <span class="n">left</span><span class="o">.</span><span class="na">dumpOrder</span><span class="o">()</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">right</span><span class="o">)</span> <span class="n">right</span><span class="o">.</span><span class="na">dumpOrder</span><span class="o">()</span>
    <span class="o">}</span>

    <span class="c1">// recurse on left child,</span>
    <span class="c1">// then recurse on right child,</span>
    <span class="c1">// then show current value.</span>
    <span class="kt">def</span> <span class="nf">postOrder</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">left</span><span class="o">)</span> <span class="n">left</span><span class="o">.</span><span class="na">postOrder</span><span class="o">()</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">right</span><span class="o">)</span> <span class="n">right</span><span class="o">.</span><span class="na">postOrder</span><span class="o">()</span>
        <span class="n">print</span> <span class="n">value</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
    <span class="o">}</span>

    <span class="c1">// find out whether provided value is in the tree.</span>
    <span class="c1">// if so, return the node at which the value was found.</span>
    <span class="c1">// cut down search time by only looking in the correct</span>
    <span class="c1">// branch, based on current value.</span>
    <span class="kt">def</span> <span class="nf">search</span><span class="o">(</span><span class="n">val</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">val</span> <span class="o">==</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">dump</span><span class="o">()</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">left</span> <span class="o">?</span> <span class="n">left</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">val</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">right</span> <span class="o">?</span> <span class="n">right</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">val</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// first generate 20 random inserts</span>
<span class="n">test</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BinaryTree</span><span class="o">(</span><span class="mi">500</span><span class="o">)</span>
<span class="n">rand</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">()</span>
<span class="mi">20</span><span class="o">.</span><span class="na">times</span><span class="o">{</span>
    <span class="n">test</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">rand</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">1000</span><span class="o">))</span>
<span class="o">}</span>

<span class="c1">// now dump out the tree all three ways</span>
<span class="n">print</span> <span class="s2">&quot;Pre order:  &quot;</span><span class="o">;</span> <span class="n">test</span><span class="o">.</span><span class="na">preOrder</span><span class="o">();</span>  <span class="n">println</span> <span class="s2">&quot;&quot;</span>
<span class="n">print</span> <span class="s2">&quot;In order:   &quot;</span><span class="o">;</span> <span class="n">test</span><span class="o">.</span><span class="na">inOrder</span><span class="o">();</span>   <span class="n">println</span> <span class="s2">&quot;&quot;</span>
<span class="n">print</span> <span class="s2">&quot;Post order: &quot;</span><span class="o">;</span> <span class="n">test</span><span class="o">.</span><span class="na">postOrder</span><span class="o">();</span> <span class="n">println</span> <span class="s2">&quot;&quot;</span>

<span class="n">println</span> <span class="s2">&quot;\nSearch?&quot;</span>
<span class="k">while</span> <span class="o">((</span><span class="n">item</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">()?.</span><span class="na">trim</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">println</span> <span class="n">test</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">item</span><span class="o">.</span><span class="na">toInteger</span><span class="o">())</span>
    <span class="n">println</span> <span class="s2">&quot;\nSearch?&quot;</span>
<span class="o">}</span>
<span class="c1">// Randomly produces a tree such as:</span>
<span class="c1">//           -------- 500 ------</span>
<span class="c1">//         /                     \</span>
<span class="c1">//       181                     847</span>
<span class="c1">//     /    \                    /  \</span>
<span class="c1">//   3       204              814   970</span>
<span class="c1">//    \       /  \            /</span>
<span class="c1">//    126  196  414        800</span>
<span class="c1">//             /   \       /</span>
<span class="c1">//          353   438   621</span>
<span class="c1">//                /     /  \</span>
<span class="c1">//             423    604   776</span>
<span class="c1">//                   /     /</span>
<span class="c1">//                 517   765</span>
<span class="c1">//                      /</span>
<span class="c1">//                    646</span>
<span class="c1">//                   /</span>
<span class="c1">//                 630</span>
<span class="c1">// Pre order:</span>
<span class="c1">// 500 181 3 126 204 196 414 353 438 423 847 814 800 621 604 517 776 765 646 630 970</span>
<span class="c1">// In order:</span>
<span class="c1">// 3 126 181 196 204 353 414 423 438 500 517 604 621 630 646 765 776 800 814 847 970</span>
<span class="c1">// Post order:</span>
<span class="c1">// 126 3 196 353 423 438 414 204 181 517 604 630 646 765 776 621 800 814 970 847 500</span>
<span class="c1">//</span>
<span class="c1">// Search?</span>
<span class="c1">// 125</span>
<span class="c1">// null</span>
<span class="c1">//</span>
<span class="c1">// Search?</span>
<span class="c1">// 126</span>
<span class="c1">// &lt;BinaryTree@ae97c4 value=126 left=null right=null&gt;</span>
<span class="c1">//----------------------------------------------------------------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="subroutines.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="packagesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Subroutines</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Packages, Libraries, and Modules</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>