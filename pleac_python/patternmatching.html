<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Pattern Matching</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Python"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Hashes"
HREF="hashes.html"><LINK
REL="NEXT"
TITLE="File Access"
HREF="fileaccess.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Python</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="hashes.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="fileaccess.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="PATTERNMATCHING"
>6. Pattern Matching</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN285"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c"># Note: regexes are used less often in Python than in Perl as tasks are often</span>
<span class="c"># covered by string methods, or specialised objects, modules, or packages.</span>

<span class="kn">import</span> <span class="nn">re</span>                   <span class="c"># &quot;re&quot; is the regular expression module.</span>
<span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;sheep&quot;</span><span class="p">,</span><span class="n">meadow</span><span class="p">)</span>   <span class="c"># returns a MatchObject is meadow contains &quot;sheep&quot;.</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;sheep&quot;</span><span class="p">,</span><span class="n">meadow</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;no sheep on this meadow only a fat python.&quot;</span>
<span class="c"># replacing strings is not done by &quot;re&quot;gular expressions.</span>
<span class="n">meadow</span> <span class="o">=</span> <span class="n">meadow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;old&quot;</span><span class="p">,</span><span class="s">&quot;new&quot;</span><span class="p">)</span>   <span class="c"># replace &quot;old&quot; with &quot;new&quot; and assign result.</span>
<span class="c">#-----------------------------</span>
<span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;ovine&quot;</span><span class="p">,</span><span class="n">meadow</span><span class="p">)</span>

<span class="n">meadow</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Fine bovines demand fine toreadors.</span>
<span class="s">Muskoxen are polar ovibovine species.</span>
<span class="s">Grooviness went out of fashion decades ago.&quot;&quot;&quot;</span>

<span class="n">meadow</span> <span class="o">=</span> <span class="s">&quot;Ovines are found typically in ovaries.&quot;</span>

<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;\bovines\b&quot;</span><span class="p">,</span><span class="n">meadow</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="p">:</span> <span class="k">print</span> <span class="s">&quot;Here be sheep!&quot;</span>
<span class="c">#-----------------------------</span>
<span class="c"># The tricky bit</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&quot;good food&quot;</span>
<span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;o*&quot;</span><span class="p">,</span><span class="s">&quot;e&quot;</span><span class="p">,</span><span class="n">mystr</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c"># gives &#39;egood food&#39;</span>

<span class="n">echo</span> <span class="n">ababacaca</span> <span class="o">|</span> <span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s">&quot;import sys,re; print re.search(&#39;(a|ba|b)+(a|ac)+&#39;,sys.stdin.read()).group()&quot;</span>
<span class="c">#-----------------------------</span>
<span class="c"># pattern matching modifiers</span>
<span class="c"># assume perl code iterates over some file</span>
<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">fileinput</span>
<span class="k">for</span> <span class="n">ln</span> <span class="o">=</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="n">fnd</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;(\d+)&quot;</span><span class="p">,</span><span class="n">ln</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fnd</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Found number </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fnd</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c"># ----------------------------</span>
<span class="n">digits</span> <span class="o">=</span> <span class="s">&quot;123456789&quot;</span>
<span class="n">nonlap</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;(\d\d\d)&quot;</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span>
<span class="n">yeslap</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;not yet&quot;</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&quot;Non-overlapping:&quot;</span><span class="p">,</span><span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nonlap</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Overlapping    :&quot;</span><span class="p">,</span><span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">yeslap</span><span class="p">)</span>
<span class="c"># ----------------------------</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&quot;And little lambs eat ivy&quot;</span>
<span class="n">fnd</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;(l[^s]*s)&quot;</span><span class="p">,</span> <span class="n">mystr</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;(</span><span class="si">%s</span><span class="s">) (</span><span class="si">%s</span><span class="s">) (</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mystr</span><span class="p">[:</span><span class="n">fnd</span><span class="o">.</span><span class="n">start</span><span class="p">()],</span> <span class="n">fnd</span><span class="o">.</span><span class="n">group</span><span class="p">(),</span> <span class="n">mystr</span><span class="p">[</span><span class="n">fnd</span><span class="o">.</span><span class="n">end</span><span class="p">():])</span>
<span class="c"># (And ) (little lambs) ( eat ivy)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN288"
>Copying and Substituting Simultaneously</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="kn">import</span> <span class="nn">re</span>
<span class="n">dst</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;this&quot;</span><span class="p">,</span><span class="s">&quot;that&quot;</span><span class="p">,</span><span class="n">src</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># strip to basename</span>
<span class="n">basename</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;.*/(?=[^/]+)&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">progname</span><span class="p">)</span>

<span class="c"># Make All Words Title-Cased</span>
<span class="c"># DON&#39;T DO THIS - use str.title() instead</span>
<span class="k">def</span> <span class="nf">cap</span><span class="p">(</span><span class="n">mo</span><span class="p">):</span> <span class="k">return</span> <span class="n">mo</span><span class="o">.</span><span class="n">group</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
<span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;(?P&lt;n&gt;\w+)&quot;</span><span class="p">,</span><span class="n">cap</span><span class="p">,</span><span class="s">&quot;make all words title-cased&quot;</span><span class="p">)</span>

<span class="c"># /usr/man/man3/foo.1 changes to /usr/man/cat3/foo.1</span>
<span class="n">manpage</span> <span class="o">=</span> <span class="s">&quot;/usr/man/man3/foo.1&quot;</span>
<span class="n">catpage</span>  <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;man(?=\d)&quot;</span><span class="p">,</span><span class="s">&quot;cat&quot;</span><span class="p">,</span><span class="n">manpage</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">bindirs</span> <span class="o">=</span> <span class="s">&quot;/usr/bin /bin /usr/local/bin&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">libdirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;bin&quot;</span><span class="p">,</span> <span class="s">&quot;lib&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">bindirs</span><span class="p">]</span>

<span class="k">print</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">libdirs</span><span class="p">)</span>
<span class="c">#=&gt; /usr/lib /lib /usr/local/lib</span>
<span class="c">#-----------------------------</span>
<span class="c"># strings are never modified in place.</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN291"
>Matching Letters</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">##---------------------------</span>

<span class="c"># DON&#39;T DO THIS.  use line[:-1].isalpha() [this probably goes for the</span>
<span class="c">#    remainder of this section too!]</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;^[A-Za-z]+$&quot;</span><span class="p">,</span><span class="n">line</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;pure alphabetic&quot;</span>
<span class="c">##---------------------------</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^[^\W\d_]+$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">LOCALE</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;pure alphabetic&quot;</span>
<span class="c">##---------------------------</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">locale</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">locale</span><span class="o">.</span><span class="n">setlocale</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">LC_ALL</span><span class="p">,</span> <span class="s">&#39;fr_CA.ISO8859-1&#39;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;couldn&#39;t set locale to French Cnadian&quot;</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span>

<span class="n">DATA</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">silly</span>
<span class="s">faзade</span>
<span class="s">coцperate</span>
<span class="s">niсo</span>
<span class="s">Renйe</span>
<span class="s">Moliиre </span>
<span class="s">hжmoglobin</span>
<span class="s">naпve</span>
<span class="s">tschья</span>
<span class="s">random!stuff#here</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">DATA</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
    <span class="n">ln</span> <span class="o">=</span> <span class="n">ln</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^[^\W\d_]+$&quot;</span><span class="p">,</span><span class="n">ln</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">LOCALE</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: alphabetic&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ln</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: line noise&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ln</span><span class="p">)</span>
<span class="c"># although i dont think &quot;coцperate&quot; should be in canadian</span>
<span class="c">##---------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN294"
>Matching Words</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c"># Matching Words</span>
<span class="s">&quot;\S+&quot;</span>          <span class="c"># as many non-whitespace bytes as possible</span>
<span class="s">&quot;[A-Za-z&#39;-]+&quot;</span>  <span class="c"># as many letters, apostrophes, and hyphens</span>

<span class="c"># string split is similar to splitting on &quot;\s+&quot;</span>
<span class="s">&quot;A text   with some</span><span class="se">\t</span><span class="s">separator&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="s">&quot;</span><span class="se">\b</span><span class="s">*([A-Za-z]+)</span><span class="se">\b</span><span class="s">*&quot;</span>   <span class="c"># word boundaries </span>
<span class="s">&quot;\s*([A-Za-z]+)\s*&quot;</span>   <span class="c"># might work too as on letters are allowed.</span>

<span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;\Bis\B&quot;</span><span class="p">,</span><span class="s">&quot;this thistle&quot;</span><span class="p">)</span> <span class="c"># matches on thistle not on this</span>
<span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;\Bis\B&quot;</span><span class="p">,</span><span class="s">&quot;vis-a-vis&quot;</span><span class="p">)</span>    <span class="c"># does not match</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN297"
>Commenting Regular Expressions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="c">#!/usr/bin/python</span>
<span class="c"># resname - change all &quot;foo.bar.com&quot; style names in the input stream</span>
<span class="c"># into &quot;foo.bar.com [204.148.40.9]&quot; (or whatever) instead</span>

<span class="kn">import</span> <span class="nn">socket</span>               <span class="c"># load inet_addr</span>
<span class="kn">import</span> <span class="nn">fileinput</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;&quot;&quot;(?P&lt;hostname&gt;  # capture hostname</span>
<span class="s">                         (?:         # these parens for grouping only</span>
<span class="s">                            [\w-]+   # hostname component</span>
<span class="s">                            \.       # ant the domain dot</span>
<span class="s">                         ) +         # now repeat that whole thing a bunch of times</span>
<span class="s">                         [A-Za-z]    # next must be a letter</span>
<span class="s">                         [\w-] +     # now trailing domain part</span>
<span class="s">                      )              # end of hostname capture</span>
<span class="s">                   &quot;&quot;&quot;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>   <span class="c"># for nice formatting</span>

<span class="k">def</span> <span class="nf">repl</span><span class="p">(</span><span class="n">match_obj</span><span class="p">):</span>
    <span class="n">orig_hostname</span> <span class="o">=</span> <span class="n">match_obj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&quot;hostname&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">orig_hostname</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span><span class="p">:</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="s">&quot;???&quot;</span>
    <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> [</span><span class="si">%s</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">orig_hostname</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">match</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">repl</span><span class="p">,</span> <span class="n">ln</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;&quot;&quot;(?x)     # nicer formatting</span>
<span class="s">          \#       #   a pound sign</span>
<span class="s">          (\w+)    #   the variable name</span>
<span class="s">          \#       #   another pound sign</span>
<span class="s">          &quot;&quot;&quot;</span><span class="p">,</span>
          <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>  <span class="c"># replace with the value of the global variable</span>
          <span class="n">line</span>
      <span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;&quot;&quot;(?x)     # nicer formatting</span>
<span class="s">          \#       #   a pound sign</span>
<span class="s">          (\w+)    #   the variable name</span>
<span class="s">          \#       #   another pound sign</span>
<span class="s">          &quot;&quot;&quot;</span><span class="p">,</span>
          <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))),</span>  <span class="c"># replace with the value of *any* variable</span>
          <span class="n">line</span>
      <span class="p">)</span>
<span class="c">##-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN300"
>Finding the Nth Occurrence of a Match</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="kn">import</span> <span class="nn">re</span>
<span class="n">pond</span> <span class="o">=</span> <span class="s">&quot;one fish two fish red fish blue fish&quot;</span>
<span class="n">fishes</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?i)(\w+)\s+fish\b&quot;</span><span class="p">,</span><span class="n">pond</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fishes</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;The third fish is a </span><span class="si">%s</span><span class="s"> one.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fishes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="c">##-----------------------------</span>
<span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?i)(?:\w+\s+fish\s+){2}(\w+)\s+fish&quot;</span><span class="p">,</span><span class="n">pond</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">match_object</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s">r&quot;PAT&quot;</span><span class="p">,</span> <span class="n">mystr</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>   <span class="c"># or whatever you want to do here</span>

<span class="c"># &quot;progressive&quot; matching might be better if one wants match 5 from 50.</span>
<span class="c"># to count use</span>
<span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;PAT&quot;</span><span class="p">,</span><span class="n">mystr</span><span class="p">))</span>
<span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;aba&quot;</span><span class="p">,</span><span class="s">&quot;abaababa&quot;</span><span class="p">))</span>

<span class="c"># &quot;count&quot; overlapping matches</span>
<span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?=aba)&quot;</span><span class="p">,</span><span class="s">&quot;abaababa&quot;</span><span class="p">))</span>

<span class="c"># FASTEST non-overlapping might be str.count</span>
<span class="s">&quot;abaababa&quot;</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;aba&quot;</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">pond</span> <span class="o">=</span> <span class="s">&quot;one fish two fish red fish blue fish&quot;</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?i)(\w+)\s+fish\b&quot;</span><span class="p">,</span><span class="n">pond</span><span class="p">)</span>   <span class="c"># get all matches</span>
<span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>                                 <span class="c"># then the one we want</span>

<span class="c"># or without a temporary list</span>
<span class="n">color</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?i)(\w+)\s+fish\b&quot;</span><span class="p">,</span><span class="n">pond</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="c"># just grab element 3</span>

<span class="k">print</span> <span class="s">&quot;The third fish in the pond is </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">color</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">pond</span> <span class="o">=</span> <span class="s">&quot;one fish two fish red fish blue fish&quot;</span>
<span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(\w+)\s+fish\b&quot;</span><span class="p">,</span><span class="n">pond</span><span class="p">)</span>
<span class="n">evens</span> <span class="o">=</span> <span class="p">[</span><span class="n">fish</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">fish</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">2</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&quot;Even numbered fish are </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">evens</span><span class="p">))</span>
<span class="c">##-----------------------------</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">def</span> <span class="nf">four_is_sushi</span><span class="p">(</span><span class="n">match_obj</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">count</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">count</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&quot;sushi</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">match_obj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">match_obj</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>

<span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;(?x)               # VERBOSE</span>
<span class="s">           \b                 # makes next \w more efficient</span>
<span class="s">           ( \w+ )            # this is what we&#39;ll be changing</span>
<span class="s">           (</span>
<span class="s">             \s+ fish \b</span>
<span class="s">           )&quot;&quot;&quot;</span><span class="p">,</span>
           <span class="n">four_is_sushi</span><span class="p">,</span>
           <span class="n">pond</span><span class="p">)</span>
<span class="c"># one fish two fish red fish sushi fish</span>
<span class="c">##-----------------------------</span>
<span class="c"># greedily</span>
<span class="n">last_fish</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?i).*\b(\w+)\s+fish\b&quot;</span><span class="p">,</span><span class="n">pond</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">pond</span> <span class="o">=</span> <span class="s">&quot;One fish two fish red fish blue fish swim here&quot;</span>
<span class="n">color</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?i)\b(\w+)\s+fish\b&quot;</span><span class="p">,</span><span class="n">pond</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&quot;Last fish is &quot;</span><span class="o">+</span><span class="n">color</span><span class="o">+</span><span class="s">&quot;.&quot;</span>
<span class="c"># FASTER using string.</span>
<span class="n">lastfish</span> <span class="o">=</span> <span class="n">pond</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&quot;fish&quot;</span><span class="p">)</span>
<span class="n">color</span> <span class="o">=</span> <span class="n">pond</span><span class="p">[:</span><span class="n">lastfish</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c">##-----------------------------</span>
<span class="sd">r&quot;&quot;&quot;(?x)</span>
<span class="sd">    A             # find some pattern A</span>
<span class="sd">    (?!           # mustn&#39;t be able to find</span>
<span class="sd">      .*          # something</span>
<span class="sd">      A           # and A</span>
<span class="sd">    )</span>
<span class="sd">    $             # through the end of string</span>
<span class="sd"> &quot;&quot;&quot;</span>

<span class="n">pond</span> <span class="o">=</span> <span class="s">&quot;One fish two fish red fish blue fish swim here&quot;</span>
<span class="n">fnd</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;(?xis)                # VERBOSE, CASEINSENSITIVE, DOTALL</span>
<span class="s">                  \b ( \w+ ) \s+ fish \b</span>
<span class="s">                  (?! .* \b fish \b )&quot;&quot;&quot;</span><span class="p">,</span>
                  <span class="n">pond</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fnd</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Last fish is </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fnd</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Failed!&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN303"
>Matching Multiple Lines</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c"># Matching Multiple Lines</span>
<span class="c">#</span>
<span class="c">#!/usr/bin/python</span>
<span class="c"># killtags - very bad html tag killer</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">text</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>        <span class="c"># read the whole file</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;(?ms)&lt;.*?&gt;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>    <span class="c"># strip tags (terrible</span>
<span class="k">print</span> <span class="n">text</span>
<span class="c">## ----------------------------</span>
<span class="c">#!/usr/bin/python</span>
<span class="c"># headerfy: change certain chapter headers to html</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">re</span>

<span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;(?xms)          # re.VERBOSE, re.MULTILINE, and re.DOTALL</span>
<span class="s">                       \A              # start of the string</span>
<span class="s">                       (?P&lt;chapter&gt;    # capture in g&lt;chapter&gt;</span>
<span class="s">                         Chapter       # literal string</span>
<span class="s">                         \s+           # mandatory whitespace</span>
<span class="s">                         \d+           # decimal number</span>
<span class="s">                         \s*           # optional whitespace</span>
<span class="s">                         :             # a real colon</span>
<span class="s">                         . *           # anything not a newline till end of line</span>
<span class="s">                       )</span>
<span class="s">                    &quot;&quot;&quot;</span><span class="p">)</span>
<span class="n">text</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>        <span class="c"># read the whole file</span>
<span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">):</span>   <span class="c"># split on unix end of lines</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;&lt;h1&gt;\g&lt;chapter&gt;&lt;/h1&gt;&quot;</span><span class="p">,</span><span class="n">paragraph</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">p</span>
<span class="c">## ----------------------------</span>
<span class="c"># the one liner does not run.</span>
<span class="c"># python -c &#39;import sys,re; for p in open(sys.argv[1]).read().split(&quot;\n\n&quot;): print re.sub(r&quot;(?ms)\A(Chapter\s+\d+\s*:.*)&quot;,&quot;&lt;h1&gt;\g0&lt;/h1&gt;&quot;,p)&#39;</span>
<span class="c">## ----------------------------</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;(?ms)^START(.*?)^END&quot;</span><span class="p">)</span>
     <span class="c"># s makes . span line boundaries</span>
     <span class="c"># m makes ^ match at the beginning of the string and at the beginning of each line</span>

<span class="n">chunk</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">):</span>
    <span class="n">chunk</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">fnd</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fnd</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;chunk </span><span class="si">%d</span><span class="s"> in </span><span class="si">%s</span><span class="s"> has &lt;&lt;</span><span class="si">%s</span><span class="s">&gt;&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">chunk</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&quot;&gt;&gt;,&lt;&lt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fnd</span><span class="p">))</span>
<span class="c">## ----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN306"
>Reading Records with a Pattern Separator</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="c"># Read the whole file and split</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>      <span class="c"># on whitespace</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>  <span class="c"># on line ends</span>

<span class="c"># splitting on pattern</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="s">r&quot;x&quot;</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="c">##-----------------------------</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&quot;(?m)^\.(Ch|Se|Ss)$&quot;</span><span class="p">,</span><span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="k">print</span> <span class="s">&quot;I read </span><span class="si">%d</span><span class="s"> chunks.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">))</span>
<span class="c"># without delimiters</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&quot;(?m)^\.(?:Ch|Se|Ss)$&quot;</span><span class="p">,</span><span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="c"># with delimiters</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&quot;(?m)^(\.(?:Ch|Se|Ss))$&quot;</span><span class="p">,</span><span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="c"># with delimiters at chunkstart</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;(?xms)       # multiline, dot matches lineend, allow comments</span>
<span class="s">                          ((?:^\.)?  # consume the separator if present</span>
<span class="s">                           .*?)      # match everything but not greedy</span>
<span class="s">                          (?=        # end the match on this but dont consume it</span>
<span class="s">                            (?:                  # dont put into group [1]</span>
<span class="s">                               ^\.(?:Ch|Se|Ss)$  # either end on one of the roff commands</span>
<span class="s">                               |\Z               # or end of text</span>
<span class="s">                            )</span>
<span class="s">                          )&quot;&quot;&quot;</span><span class="p">,</span>
                    <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="c"># [1] if &quot;?:&quot; is removed the result holds tuples: (&#39;.Ch\nchapter x&#39;,&#39;.Ch&#39;)</span>
<span class="c">#     which might be more usefull. </span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN309"
>Extracting a Range of Lines</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">##-----------------------------</span>
<span class="c"># Python doesn&#39;t have perl&#39;s range operators</span>
<span class="c"># If you want to only use a selected line range, use enumerate</span>
<span class="c"># (though note that indexing starts at zero:</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">myfile</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">firstlinenum</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">lastlinenum</span><span class="p">:</span>
        <span class="n">dosomethingwith</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="c"># Using patterned ranges is slightly trickier -</span>
<span class="c"># You need to search for the first pattern then</span>
<span class="c"># search for the next pattern:</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">myfile</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat1</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="k">break</span>

<span class="n">dosomethingwith</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>    <span class="c"># Only if pat1 can be on same line as pat2</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">myfile</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat2</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="k">break</span>
    <span class="n">dosomethingwith</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="c"># If you need to extract ranges a lot, the following generator funcs</span>
<span class="c"># may be useful:</span>
<span class="k">def</span> <span class="nf">extract_range</span><span class="p">(</span><span class="n">myfile</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">myfile</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">finish</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">line</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">finish</span><span class="p">:</span>
            <span class="k">break</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">extract_range</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&quot;/etc/passwd&quot;</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">line</span>

<span class="k">def</span> <span class="nf">patterned_range</span><span class="p">(</span><span class="n">myfile</span><span class="p">,</span> <span class="n">startpat</span><span class="p">,</span> <span class="n">endpat</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">startpat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">startpat</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">endpat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">endpat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">endpat</span><span class="p">)</span>
    <span class="n">in_range</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">myfile</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">startpat</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="n">in_range</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">in_range</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">line</span>
        <span class="k">if</span> <span class="n">endpat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">endpat</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="k">break</span>

<span class="c"># DO NOT DO THIS.  Use the email module instead</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">patterned_range</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&quot;^From:?&quot;</span><span class="p">,</span> <span class="s">&quot;^$&quot;</span><span class="p">):</span>
    <span class="k">pass</span> <span class="c">#...</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN312"
>Matching Shell Globs as Regular Expressions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="n">tests</span> <span class="o">=</span> <span class="p">((</span><span class="s">&quot;list.?&quot;</span><span class="p">,</span><span class="s">r&quot;^list\..$&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;project.*&quot;</span><span class="p">,</span><span class="s">r&quot;^project\..*$&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;*old&quot;</span><span class="p">,</span><span class="s">r&quot;^.*old$&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;type*.[ch]&quot;</span><span class="p">,</span><span class="s">r&quot;^type.*\.[ch]$&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;*.*&quot;</span><span class="p">,</span><span class="s">r&quot;^.*\..*$&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="s">r&quot;^.*$&quot;</span><span class="p">),</span>
        <span class="p">)</span>

<span class="c"># The book says convert &quot;*&quot;,&quot;?&quot;,&quot;[&quot;,&quot;]&quot; all other characters will be quoted.</span>
<span class="c"># The book uses &quot;\Q&quot; which escapes any characters that would otherwise be</span>
<span class="c"># treated as regular expression.</span>
<span class="c"># Escaping every char fails as &quot;\s&quot; is not &quot;s&quot; in a regex.</span>

<span class="k">def</span> <span class="nf">glob2pat</span><span class="p">(</span><span class="n">globstr</span><span class="p">):</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="n">globstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">,</span><span class="s">r&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="n">pat</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">,</span><span class="s">r&quot;\.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;?&quot;</span><span class="p">,</span><span class="s">r&quot;.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="s">r&quot;.*&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="s">&quot;^&quot;</span><span class="o">+</span><span class="n">pat</span><span class="o">+</span><span class="s">&quot;$&quot;</span>

<span class="k">for</span> <span class="n">globstr</span><span class="p">,</span> <span class="n">patstr</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
    <span class="n">g2p</span> <span class="o">=</span> <span class="n">glob2pat</span><span class="p">(</span><span class="n">globstr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">g2p</span> <span class="o">!=</span> <span class="n">patstr</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">globstr</span><span class="p">,</span> <span class="s">&quot;failed! Should be&quot;</span><span class="p">,</span> <span class="n">patstr</span><span class="p">,</span> <span class="s">&quot;but was&quot;</span><span class="p">,</span> <span class="n">g2p</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN315"
>Speeding Up Interpolated Matches</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch06/popgrep1</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># popgrep1 - grep for abbreviations of places that say &quot;pop&quot;</span>
<span class="c"># version 1: slow but obvious way</span>
<span class="kn">import</span> <span class="nn">fileinput</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">popstates</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;CO&quot;</span><span class="p">,</span><span class="s">&quot;ON&quot;</span><span class="p">,</span><span class="s">&quot;MI&quot;</span><span class="p">,</span><span class="s">&quot;WI&quot;</span><span class="p">,</span><span class="s">&quot;MN&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">popstates</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;\b&quot;</span><span class="o">+</span><span class="n">state</span><span class="o">+</span><span class="s">r&quot;\b&quot;</span><span class="p">,</span><span class="n">line</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">line</span>



<span class="c">#-----------------------------</span>
<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch06/popgrep2</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># popgrep2 - grep for abbreviations of places that say &quot;pop&quot;</span>
<span class="c"># version 2: compile the patterns</span>
<span class="kn">import</span> <span class="nn">fileinput</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">popstates</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;CO&quot;</span><span class="p">,</span><span class="s">&quot;ON&quot;</span><span class="p">,</span><span class="s">&quot;MI&quot;</span><span class="p">,</span><span class="s">&quot;WI&quot;</span><span class="p">,</span><span class="s">&quot;MN&quot;</span><span class="p">]</span>
<span class="n">state_re</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">popstates</span><span class="p">:</span>
    <span class="n">state_re</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;\b&quot;</span><span class="o">+</span><span class="n">state</span><span class="o">+</span><span class="s">r&quot;\b&quot;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">state_re</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">line</span>


<span class="c">#-----------------------------</span>
<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch06/popgrep3</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># popgrep3 - grep for abbreviations of places that say &quot;pop&quot;</span>
<span class="c"># version 3: compile a single pattern</span>
<span class="kn">import</span> <span class="nn">fileinput</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">popstates</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;CO&quot;</span><span class="p">,</span><span class="s">&quot;ON&quot;</span><span class="p">,</span><span class="s">&quot;MI&quot;</span><span class="p">,</span><span class="s">&quot;WI&quot;</span><span class="p">,</span><span class="s">&quot;MN&quot;</span><span class="p">]</span>
<span class="n">state_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;\b(?:&quot;</span><span class="o">+</span><span class="s">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">popstates</span><span class="p">)</span><span class="o">+</span><span class="s">r&quot;)\b&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">state_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">line</span>


<span class="c">#-----------------------------</span>
<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch06/grepauth</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># grepauth - print lines that mention both Tom and Nat</span>
<span class="kn">import</span> <span class="nn">fileinput</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">build_match_any</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">uniq</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
        <span class="n">seen</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">seen</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">seen</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">build_match_all</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">uniq</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">line</span><span class="p">)))</span><span class="o">&gt;=</span><span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">c</span>

<span class="nb">any</span> <span class="o">=</span> <span class="n">build_match_any</span><span class="p">((</span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="s">&quot;Nat&quot;</span><span class="p">))</span>
<span class="nb">all</span> <span class="o">=</span> <span class="n">build_match_all</span><span class="p">((</span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="s">&quot;Nat&quot;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">any</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;any:&quot;</span><span class="p">,</span> <span class="n">line</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;all:&quot;</span><span class="p">,</span> <span class="n">line</span>



<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN318"
>Testing for a Valid Pattern</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c"># Testing for a Valid Pattern</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;Pattern? &quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;INVALID PATTERN&quot;</span><span class="p">,</span> <span class="n">err</span>
        <span class="k">continue</span>
    <span class="k">break</span>

<span class="c"># ----</span>
<span class="k">def</span> <span class="nf">is_valid_pattern</span><span class="p">(</span><span class="n">pat</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>

<span class="c"># ----</span>

<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch06/paragrep</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># paragrep - trivial paragraph grepper</span>
<span class="c">#</span>
<span class="c"># differs from perl version in parano.</span>
<span class="c"># python version displays paragraph in current file.</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os.path</span><span class="o">,</span> <span class="nn">re</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">:</span>
	<span class="k">print</span> <span class="s">&quot;usage: </span><span class="si">%s</span><span class="s"> pat [files]</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
	<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">pat</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">try</span><span class="p">:</span>
	<span class="n">pat_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
	<span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: bad pattern </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pat</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
	<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">:]):</span>
	<span class="n">parano</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">):</span>
		<span class="n">parano</span> <span class="o">+=</span> <span class="mi">1</span>
		<span class="k">if</span> <span class="n">pat_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">para</span><span class="p">):</span>
			<span class="k">print</span> <span class="n">filename</span><span class="p">,</span> <span class="n">parano</span><span class="p">,</span> <span class="n">para</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
			


<span class="c"># ----</span>

<span class="c"># as we dont evaluate patterns the attack ::</span>
<span class="c">#</span>
<span class="c">#   $pat = &quot;You lose @{[ system(&#39;rm -rf *&#39;]} big here&quot;;</span>
<span class="c">#</span>
<span class="c"># does not work.</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN321"
>Honoring Locale Settings in Regular Expressions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch06/localeg</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># localeg - demonstrates locale effects</span>
<span class="c">#</span>
<span class="c"># re must be told to respect locale either in the regexp</span>
<span class="c"># &quot;(?L)&quot; or as flag to the call (python 2.4) &quot;re.LOCALE&quot;.</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">string</span>
<span class="kn">from</span> <span class="nn">locale</span> <span class="kn">import</span> <span class="n">LC_CTYPE</span><span class="p">,</span> <span class="n">setlocale</span><span class="p">,</span> <span class="n">getlocale</span>

<span class="n">name</span> <span class="o">=</span> <span class="s">&quot;andreas k</span><span class="se">\xF6</span><span class="s">nig&quot;</span>
<span class="n">locale</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;German&quot;</span> <span class="p">:</span> <span class="s">&quot;de_DE.ISO_8859-1&quot;</span><span class="p">,</span> <span class="s">&quot;English&quot;</span> <span class="p">:</span> <span class="s">&quot;en_US&quot;</span><span class="p">}</span>
<span class="c"># us-ascii is not supported on linux py23</span>
<span class="c"># none works in activestate py24</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">setlocale</span><span class="p">(</span><span class="n">LC_CTYPE</span><span class="p">,</span> <span class="n">locale</span><span class="p">[</span><span class="s">&quot;English&quot;</span><span class="p">])</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Invalid locale </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">locale</span><span class="p">[</span><span class="s">&quot;English&quot;</span><span class="p">]</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">english_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?L)\b(\w+)\b&quot;</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
    <span class="n">english_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">setlocale</span><span class="p">(</span><span class="n">LC_CTYPE</span><span class="p">,</span> <span class="n">locale</span><span class="p">[</span><span class="s">&quot;German&quot;</span><span class="p">])</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Invalid locale </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">locale</span><span class="p">[</span><span class="s">&quot;German&quot;</span><span class="p">]</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">german_names</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">capitalize</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?L)\b(\w+)\b&quot;</span><span class="p">,</span><span class="n">name</span><span class="p">))</span>

<span class="k">print</span> <span class="s">&quot;English names: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">english_names</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;German names: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">german_names</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN324"
>Approximate Matching</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">##-----------------------------</span>
<span class="kn">import</span> <span class="nn">difflib</span>
<span class="n">matchlist</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;ape&quot;</span><span class="p">,</span> <span class="s">&quot;apple&quot;</span><span class="p">,</span> <span class="s">&quot;lapel&quot;</span><span class="p">,</span> <span class="s">&quot;peach&quot;</span><span class="p">,</span> <span class="s">&quot;puppy&quot;</span><span class="p">]</span>
<span class="k">print</span> <span class="n">difflib</span><span class="o">.</span><span class="n">get_close_matches</span><span class="p">(</span><span class="s">&quot;appel&quot;</span><span class="p">,</span> <span class="n">matchlist</span><span class="p">)</span>
<span class="c">#=&gt; [&#39;lapel&#39;, &#39;apple&#39;, &#39;ape&#39;]</span>
<span class="c">##-----------------------------</span>
<span class="c"># Also see:</span>
<span class="c">#     http://www.personal.psu.edu/staff/i/u/iua1/python/apse/</span>
<span class="c">#     http://www.bio.cam.ac.uk/~mw263/pyagrep.html</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN327"
>Matching from Where the Last Pattern Left Off</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">##-----------------------------</span>
<span class="c"># To search (potentially) repeatedly for a pattern, use re.finditer():</span>

<span class="c"># DO NOT DO THIS.  Split on commas and convert elems using int()</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&quot;3,4,5,9,120&quot;</span>
<span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s">&quot;(\d+)&quot;</span><span class="p">,</span> <span class="n">mystr</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="s">&quot;9&quot;</span><span class="p">:</span>
        <span class="k">break</span> <span class="c"># &#39;120&#39; will never be matched</span>
    <span class="k">print</span> <span class="s">&quot;Found number&quot;</span><span class="p">,</span> <span class="n">n</span>

<span class="c"># matches know their end position</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&quot;The year 1752 lost 10 days on the 3rd of September&quot;</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s">&quot;(\d+)&quot;</span><span class="p">,</span> <span class="n">mystr</span><span class="p">)</span>
<span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;Found number&quot;</span><span class="p">,</span> <span class="n">n</span>

<span class="n">tail</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;(\S+)&quot;</span><span class="p">,</span> <span class="n">mystr</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">():])</span>
<span class="k">if</span> <span class="n">tail</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Found </span><span class="si">%s</span><span class="s"> after the last number.&quot;</span><span class="o">%</span><span class="n">tail</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN330"
>Greedy and Non-Greedy Matches</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c"># Python&#39;s regexes are based on Perl&#39;s, so it has the non-greedy </span>
<span class="c"># &#39;*?&#39;, &#39;+?&#39;, and &#39;??&#39; versions of &#39;*&#39;, &#39;+&#39;, and &#39;?&#39;.</span>
<span class="c"># DO NOT DO THIS. import htmllib, formatter, etc, instead</span>
<span class="c">#-----------------------------</span>
<span class="c"># greedy pattern</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;&lt;.*&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span> <span class="c"># try to remove tags, very badly</span>

<span class="c"># non-greedy pattern</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;&lt;.*?&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span> <span class="c"># try to remove tags, still rather badly</span>
<span class="c">#-----------------------------</span>
<span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;&lt;b&gt;&lt;i&gt;this&lt;/i&gt; and &lt;i&gt;that&lt;/i&gt; are important&lt;/b&gt; Oh, &lt;b&gt;&lt;i&gt;me too!&lt;/i&gt;&lt;/b&gt;&quot;</span>

<span class="k">print</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;&lt;b&gt;&lt;i&gt;(.*?)&lt;/i&gt;&lt;/b&gt;&quot;</span><span class="p">,</span> <span class="n">txt</span>
<span class="c">##-----------------------------</span>
<span class="k">print</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;/BEGIN((?:(?!BEGIN).)*)END/&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="k">print</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;&lt;b&gt;&lt;i&gt;((?:(?!&lt;b&gt;|&lt;i&gt;).)*)&lt;/i&gt;&lt;/b&gt;&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="k">print</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;&lt;b&gt;&lt;i&gt;((?:(?!&lt;[ib]&gt;).)*)&lt;/i&gt;&lt;/b&gt;&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="k">print</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    &lt;b&gt;&lt;i&gt; </span>
<span class="s">    [^&lt;]*  # stuff not possibly bad, and not possibly the end.</span>
<span class="s">    (?:    # at this point, we can have &#39;&lt;&#39; if not part of something bad</span>
<span class="s">     (?!  &lt;/?[ib]&gt;  )   # what we can&#39;t have</span>
<span class="s">     &lt;                  # okay, so match the &#39;&lt;&#39;</span>
<span class="s">     [^&lt;]*              # and continue with more safe stuff</span>
<span class="s">    ) *</span>
<span class="s">    &lt;/i&gt;&lt;/b&gt;</span>
<span class="s">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN333"
>Detecting Duplicate Words</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">##-----------------------------</span>
<span class="n">text</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">This is a test</span>
<span class="s">test of the duplicate word finder.</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="n">words</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="k">for</span> <span class="n">curr</span><span class="p">,</span> <span class="nb">next</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">words</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
    <span class="k">if</span> <span class="n">curr</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="nb">next</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
	    <span class="k">print</span> <span class="s">&quot;Duplicate word &#39;</span><span class="si">%s</span><span class="s">&#39; found.&quot;</span> <span class="o">%</span> <span class="n">curr</span>

<span class="c"># DON&#39;T DO THIS</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;</span>
<span class="s">      \b            # start at a word boundary (begin letters)</span>
<span class="s">      (\S+)         # find chunk of non-whitespace</span>
<span class="s">      \b            # until another word boundary (end letters)</span>
<span class="s">      (</span>
<span class="s">          \s+       # separated by some whitespace</span>
<span class="s">          \1        # and that very same chunk again</span>
<span class="s">          \b        # until another word boundary</span>
<span class="s">      ) +           # one or more sets of those</span>
<span class="s">      &quot;&quot;&quot;</span>
<span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Duplicate word &#39;</span><span class="si">%s</span><span class="s">&#39; found.&quot;</span> <span class="o">%</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">a</span> <span class="o">=</span> <span class="s">&#39;nobody&#39;</span><span class="p">;</span>
<span class="n">b</span> <span class="o">=</span> <span class="s">&#39;bodysnatcher&#39;</span><span class="p">;</span>

<span class="n">text</span> <span class="o">=</span> <span class="n">a</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">b</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">r&quot;^(\w+)(\w+) \2(\w+)$&quot;</span>
<span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">m2</span><span class="p">,</span> <span class="s">&quot;overlaps in </span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">r&quot;^(\w+?)(\w+) \2(\w+)$&quot;</span>
<span class="c">##-----------------------------</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^(oo+?)\1+$&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">factor</span><span class="p">,</span> <span class="s">&quot;o&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="k">def</span> <span class="nf">diaphantine</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="s">r&quot;^(o*)\1{</span><span class="si">%s</span><span class="s">}(o*)\2{</span><span class="si">%s</span><span class="s">}(o*)\3{</span><span class="si">%s</span><span class="s">}$&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">z</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;o&quot;</span><span class="o">*</span><span class="n">n</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;No solutions.&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;One solution is: x=</span><span class="si">%s</span><span class="s">, y=</span><span class="si">%s</span><span class="s">, z=</span><span class="si">%s</span><span class="s">.&quot;</span><span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
        
<span class="n">diaphantine</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">281</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN336"
>Expressing AND, OR, and NOT in a Single Pattern</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">##-----------------------------</span>
<span class="c"># Pass any of the following patterns to re.match(), etc</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">&quot;ALPHA|BETA&quot;</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">&quot;^(?=.*ALPHA)(?=.*BETA)&quot;</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">&quot;ALPHA.*BETA|BETA.*ALPHA&quot;</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">&quot;^(?:(?!PAT).)*$&quot;</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">&quot;(?=^(?:(?!BAD).)*$)GOOD&quot;</span>
<span class="c">##-----------------------------</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="n">something</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat1</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat2</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="n">something</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat1</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat2</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="n">something</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="c"># DON&#39;T DO THIS.</span>
<span class="sd">&quot;&quot;&quot;minigrep - trivial grep&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">re</span>

<span class="n">pat</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c">##-----------------------------</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^(?=.*bell)(?=.*lab)&quot;</span><span class="p">,</span> <span class="s">&quot;labelled&quot;</span><span class="p">):</span>
    <span class="n">something</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;bell&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;lab&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="n">something</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">             ^              # start of string</span>
<span class="s">            (?=             # zero-width lookahead</span>
<span class="s">                .*          # any amount of intervening stuff</span>
<span class="s">                bell        # the desired bell string</span>
<span class="s">            )               # rewind, since we were only looking</span>
<span class="s">            (?=             # and do the same thing</span>
<span class="s">                .*          # any amount of intervening stuff</span>
<span class="s">                lab         # and the lab part</span>
<span class="s">            )</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">,</span>
            <span class="n">murray_hill</span><span class="p">,</span>
            <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Looks like Bell Labs might be in Murray Hill!&quot;</span>
<span class="c">##-----------------------------</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;(?:^.*bell.*lab)|(?:^.*lab.*bell)&quot;</span><span class="p">,</span> <span class="s">&quot;labelled&quot;</span><span class="p">):</span>
    <span class="n">something</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="n">brand</span> <span class="o">=</span> <span class="s">&quot;labelled&quot;</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            (?:                 # non-capturing grouper</span>
<span class="s">                ^ .*?           # any amount of stuff at the front</span>
<span class="s">                bell            # look for a bell</span>
<span class="s">                .*?             # followed by any amount of anything</span>
<span class="s">                lab             # look for a lab</span>
<span class="s">            )                   # end grouper</span>
<span class="s">            |                   # otherwise, try the other direction</span>
<span class="s">            (?:                 # non-capturing grouper</span>
<span class="s">                ^ .*?           # any amount of stuff at the front</span>
<span class="s">                lab             # look for a lab</span>
<span class="s">                .*?             # followed by any amount of anything</span>
<span class="s">                bell            # followed by a bell</span>
<span class="s">            )                   # end grouper</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">,</span>
            <span class="n">brand</span><span class="p">,</span>
            <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Our brand has bell and lab separate.&quot;</span>
<span class="c">##-----------------------------</span>
<span class="n">x</span> <span class="o">=</span> <span class="s">&quot;odlaw&quot;</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;^(?:(?!waldo).)*$&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
   <span class="k">print</span> <span class="s">&quot;There&#39;s no waldo here!&quot;</span>
<span class="c">##-----------------------------</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            ^                   # start of string</span>
<span class="s">            (?:                 # non-capturing grouper</span>
<span class="s">                (?!             # look ahead negation</span>
<span class="s">                    waldo       # is he ahead of us now?</span>
<span class="s">                )               # is so, the negation failed</span>
<span class="s">                .               # any character (cuzza /s)</span>
<span class="s">            ) *                 # repeat that grouping 0 or more</span>
<span class="s">            $                   # through the end of the string</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">,</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;There&#39;s no waldo here!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="c">##-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN339"
>Matching Multiple-Byte Characters</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN342"
>Matching a Valid Mail Address</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">##-----------------------------</span>
<span class="kn">from</span> <span class="nn">email._parseaddr</span> <span class="kn">import</span> <span class="n">AddressList</span>

<span class="k">print</span> <span class="n">AddressList</span><span class="p">(</span><span class="s">&quot;fred&amp;barney@stonehenge.com&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">addresslist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">print</span> <span class="n">AddressList</span><span class="p">(</span><span class="s">&quot;fred&amp;barney@stonehenge.com (Hanna Barbara)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">addresslist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">name</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="n">AddressList</span><span class="p">(</span><span class="s">&quot;Mr Fooby Blah &lt;me@nowhere.com&gt;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">addresslist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">&#39;s address is &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN345"
>Matching Abbreviations</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">##-----------------------------</span>
<span class="c"># Assuming the strings all start with different letters, or you don&#39;t</span>
<span class="c"># mind there being precedence, use the startswith string method:</span>

<span class="k">def</span> <span class="nf">get_action</span><span class="p">(</span><span class="n">answer</span><span class="p">):</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="n">answer</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;send&quot;</span><span class="p">,</span> <span class="s">&quot;stop&quot;</span><span class="p">,</span> <span class="s">&quot;abort&quot;</span><span class="p">,</span> <span class="s">&quot;list&quot;</span><span class="p">,</span> <span class="s">&quot;end&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">answer</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">action</span>

<span class="k">print</span> <span class="s">&quot;Action is </span><span class="si">%s</span><span class="s">.&quot;</span><span class="o">%</span><span class="n">get_action</span><span class="p">(</span><span class="s">&quot;L&quot;</span><span class="p">)</span>
<span class="c">#=&gt; Action is list.</span>
<span class="c">##-----------------------------</span>
<span class="c">#DON&#39;T DO THIS:</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">answer</span> <span class="o">=</span> <span class="s">&quot;ab&quot;</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">answer</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
<span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;SEND&quot;</span><span class="p">,</span> <span class="s">&quot;STOP&quot;</span><span class="p">,</span> <span class="s">&quot;ABORT&quot;</span><span class="p">,</span> <span class="s">&quot;LIST&quot;</span><span class="p">,</span> <span class="s">&quot;EDIT&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">answer</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;Action is </span><span class="si">%s</span><span class="s">.&quot;</span><span class="o">%</span><span class="n">action</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">sys</span>
<span class="k">def</span> <span class="nf">handle_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>    
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">action</span> <span class="ow">in</span> <span class="p">{</span><span class="s">&quot;edit&quot;</span><span class="p">:</span> <span class="n">invoke_editor</span><span class="p">,</span>
                         <span class="s">&quot;send&quot;</span><span class="p">:</span> <span class="n">deliver_message</span><span class="p">,</span>
                         <span class="s">&quot;list&quot;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">system</span><span class="p">(</span><span class="n">pager</span><span class="p">,</span> <span class="n">myfile</span><span class="p">),</span>
                         <span class="s">&quot;abort&quot;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">,</span>
                         <span class="p">}</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">action</span><span class="p">()</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Unknown command:&quot;</span><span class="p">,</span> <span class="n">cmd</span>
<span class="n">handle_cmd</span><span class="p">(</span><span class="s">&quot;ab&quot;</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN348"
>Program: urlify</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">##-----------------------------</span>
<span class="c"># urlify - wrap HTML links around URL-like constructs</span>
<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">fileinput</span>

<span class="k">def</span> <span class="nf">urlify_string</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">r&#39;(http|telnet|gopher|file|wais|ftp)&#39;</span>
    
    <span class="n">ltrs</span> <span class="o">=</span> <span class="s">r&#39;\w&#39;</span><span class="p">;</span>
    <span class="n">gunk</span> <span class="o">=</span> <span class="s">r&#39;/#~:.?+=&amp;%@!\-&#39;</span>
    <span class="n">punc</span> <span class="o">=</span> <span class="s">r&#39;.:?\-&#39;</span>
    <span class="nb">any</span>  <span class="o">=</span> <span class="n">ltrs</span> <span class="o">+</span> <span class="n">gunk</span> <span class="o">+</span> <span class="n">punc</span> 

    <span class="n">pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;</span>
<span class="s">      \b                    # start at word boundary</span>
<span class="s">      (                     # begin \1  {</span>
<span class="s">       </span><span class="si">%(urls)s</span><span class="s">  :          # need resource and a colon</span>
<span class="s">       [</span><span class="si">%(any)s</span><span class="s">] +?         # followed by one or more</span>
<span class="s">                            #  of any valid character, but</span>
<span class="s">                            #  be conservative and take only</span>
<span class="s">                            #  what you need to....</span>
<span class="s">      )                     # end   \1  }</span>
<span class="s">      (?=                   # look-ahead non-consumptive assertion</span>
<span class="s">       [</span><span class="si">%(punc)s</span><span class="s">]*          # either 0 or more punctuation</span>
<span class="s">       [^</span><span class="si">%(any)s</span><span class="s">]           #   followed by a non-url char</span>
<span class="s">       |                    # or else</span>
<span class="s">       $                    #   then end of the string</span>
<span class="s">      )</span>
<span class="s">    &quot;&quot;&quot;</span><span class="o">%</span><span class="nb">locals</span><span class="p">(),</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="s">r&quot;&lt;A HREF=\1&gt;\1&lt;/A&gt;&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
        <span class="k">print</span> <span class="n">urlify_string</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN351"
>Program: tcgrep</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">##-----------------------------</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN354"
>Regular Expression Grabbag</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c"># The majority of regexes in this section are either partially</span>
<span class="c"># or completely The Wrong Thing to Do.</span>
<span class="c">##-----------------------------</span>
<span class="c"># DON&#39;T DO THIS.  Use a Roman Numeral module, etc. (since</span>
<span class="c"># you need one anyway to calculate values)</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">r&quot;^m*(d?c{0,3}|c[dm])(l?x{0,3}|x[lc])(v?i{0,3}|i[vx])$&quot;</span>
<span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="s">&quot;mcmlxcvii&quot;</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;one two three four five&quot;</span>

<span class="c"># If the words are cleanly delimited just split and rejoin:</span>
<span class="n">word1</span><span class="p">,</span> <span class="n">word2</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">word2</span><span class="p">,</span> <span class="n">word1</span><span class="p">,</span> <span class="n">rest</span><span class="p">])</span>

<span class="c"># Otherwise:</span>
<span class="n">frompat</span> <span class="o">=</span> <span class="s">r&quot;(\S+)(\s+)(\S+)&quot;</span>
<span class="n">topat</span> <span class="o">=</span>  <span class="s">r&quot;\3\2\1&quot;</span>
<span class="k">print</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">frompat</span><span class="p">,</span> <span class="n">topat</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>

<span class="c">##-----------------------------</span>
<span class="k">print</span> <span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;=&quot;</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">r&quot;(\w+)\s*=\s*(.*)\s*$&quot;</span>
<span class="k">print</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="s">&quot;key=val&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="n">line</span> <span class="o">=</span> <span class="s">&quot;such a very very very very very very very very very very very very very long line&quot;</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
    <span class="n">process</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">&quot;.{80,}&quot;</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
    <span class="n">process</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s">&quot;12/11/05 12:34:56&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">/%m/%y %H:%M:%S&quot;</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">r&quot;(\d+)/(\d+)/(\d+) (\d+):(\d+):(\d+)&quot;</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="s">&quot;12/11/05 12:34:56&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;/usr/bin/python&quot;</span>
<span class="k">print</span> <span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;/usr/bin&quot;</span><span class="p">,</span> <span class="s">&quot;/usr/local/bin&quot;</span><span class="p">)</span>
<span class="c"># Alternatively for file operations use os.path, shutil, etc.</span>

<span class="c"># DON&#39;T DO THIS</span>
<span class="k">print</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;/usr/bin&quot;</span><span class="p">,</span> <span class="s">&quot;/usr/local/bin&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">unescape_hex</span><span class="p">(</span><span class="n">matchobj</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">matchobj</span><span class="o">.</span><span class="n">groups</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">16</span><span class="p">))</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;%([0-9A-Fa-f][0-9A-Fa-f])&quot;</span><span class="p">,</span> <span class="n">unescape_hex</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>

<span class="c"># Assuming that the hex escaping is well-behaved, an alternative is:</span>
<span class="k">def</span> <span class="nf">unescape_hex</span><span class="p">(</span><span class="n">seg</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">seg</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="mi">16</span><span class="p">))</span> <span class="o">+</span> <span class="n">seg</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>

<span class="n">segs</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;%&quot;</span><span class="p">)</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unescape_hex</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span> <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">segs</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="c">##-----------------------------</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;</span>
<span class="s">             /\*                    # Match the opening delimiter</span>
<span class="s">             .*?                    # Match a minimal number of characters</span>
<span class="s">             \*/                    # Match the closing delimiter</span>
<span class="s">             &quot;&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">txt</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="c"># DON&#39;T DO THIS</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;^\s+&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;\s+$&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;^.*::&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="n">socket</span><span class="o">.</span><span class="n">inet_aton</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="c"># Will raise an error if incorrect</span>

<span class="c"># DON&#39;T DO THIS.</span>
<span class="n">octseg</span> <span class="o">=</span><span class="s">r&quot;([01]?\d\d|2[0-4]\d|25[0-5])&quot;</span>
<span class="n">dot</span> <span class="o">=</span> <span class="s">r&quot;\.&quot;</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">&quot;^&quot;</span> <span class="o">+</span> <span class="n">octseg</span> <span class="o">+</span> <span class="n">dot</span> <span class="o">+</span> <span class="n">octseg</span> <span class="o">+</span> <span class="n">dot</span> <span class="o">+</span> <span class="n">octseg</span> <span class="o">+</span> <span class="n">dot</span> <span class="o">+</span> <span class="n">octseg</span> <span class="o">+</span> <span class="s">&quot;$&quot;</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>
   <span class="k">raise</span> <span class="ne">ValueError</span>

<span class="c"># Defitely DON&#39;T DO THIS.</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;^([01]?\d\d|2[0-4]\d|25[0-5])\.([01]?\d\d|2[0-4]\d|25[0-5])\.</span>
<span class="s">          ([01]?\d\d|2[0-4]\d|25[0-5])\.([01]?\d\d|2[0-4]\d|25[0-5])$&quot;&quot;&quot;</span>
<span class="c">##-----------------------------</span>
<span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS.</span>
<span class="n">fname</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;^.*/&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">tc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;TERMCAP&quot;</span><span class="p">]</span>
<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="mi">80</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;:co#(\d+):&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="c"># (not quite equivalent to the Perl version)</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c"># DON&#39;T DO THIS.</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;^.*/&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c">##-----------------------------</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="s">&quot;linux&quot;</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s">&quot;This isn&#39;t Linux&quot;</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;\n\s+&quot;</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>

<span class="c"># In many cases you could just use:</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">nums</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;\d+\.?\d*|\.\d+&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="c"># If the words are clearly delimited just use:</span>
<span class="n">capwords</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">isupper</span><span class="p">()]</span>

<span class="c"># Otherwise</span>
<span class="n">capwords</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;\b(\S+)\b&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span> <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">isupper</span><span class="p">()]</span>

<span class="c"># (probably) DON&#39;T DO THIS. </span>
<span class="n">capwords</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(\b[^\Wa-z0-9_]+\b)&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="c"># If the words are clearly delimited just use:</span>
<span class="n">lowords</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">islower</span><span class="p">()]</span>

<span class="c"># Otherwise</span>
<span class="n">lowords</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;\b(\S+)\b&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span> <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">islower</span><span class="p">()]</span>

<span class="c"># (probably) DON&#39;T DO THIS. </span>
<span class="n">lowords</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(\b[^\WA-Z0-9_]+\b)&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="c"># If the words are clearly delimited just use:</span>
<span class="n">icwords</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">istitle</span><span class="p">()]</span>

<span class="c"># Otherwise</span>
<span class="n">icwords</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s">r&quot;\b(\S+)\b&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">istitle</span><span class="p">()]</span>

<span class="c"># DON&#39;T DO THIS. </span>
<span class="n">icwords</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(\b[^\Wa-z0-9_][^\WA-Z0-9_]*\b)&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="c"># DON&#39;T DO THIS - use HTMLParser, etc.</span>
<span class="n">links</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;&lt;A[^&gt;]+?HREF\s*=\s*[&quot;&#39;]?([^&#39;&quot; &gt;]+?)[ &#39;&quot;]?&gt;&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">names</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">initial</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">initial</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

<span class="c"># DON&#39;T DO THIS. </span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">&quot;^\S+\s+(\S)\S*\s+\S&quot;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">initial</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="n">initial</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
<span class="c">##-----------------------------</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;&quot;([^&quot;]*)&quot;&#39;</span><span class="p">,</span> <span class="s">&quot;``</span><span class="se">\1</span><span class="s">&#39;&#39;&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(.*?[!?.])(  |\Z)&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)]</span>
<span class="c">##-----------------------------</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS.</span>
<span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;(\d{4})-(\d\d)-(\d\d)&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;</span>
<span class="s">      ^</span>
<span class="s">      (?:</span>
<span class="s">       1 \s (?: \d\d\d \s)?            # 1, or 1 and area code</span>
<span class="s">       |                               # ... or ...</span>
<span class="s">       \(\d\d\d\) \s                   # area code with parens</span>
<span class="s">       |                               # ... or ...</span>
<span class="s">       (?: \+\d\d?\d? \s)?             # optional +country code</span>
<span class="s">       \d\d\d ([\s\-])                 # and area code</span>
<span class="s">      )</span>
<span class="s">      \d\d\d (\s|\1)                   # prefix (and area code separator)</span>
<span class="s">      \d\d\d\d                         # exchange</span>
<span class="s">        $</span>
<span class="s">      &quot;&quot;&quot;</span>
<span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;\boh\s+my\s+gh?o(d(dess(es)?|s?)|odness|sh)\b&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&quot;Ur&quot;</span><span class="p">):</span>          <span class="c">#Universal newlines</span>
    <span class="n">process</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS</span>
<span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;^([^\012\015]*)(\012\015?|\015\012?)&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> 
         <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">(</span><span class="n">fname</span><span class="p">)]</span>
<span class="c">##-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="hashes.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="fileaccess.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Hashes</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>File Access</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>