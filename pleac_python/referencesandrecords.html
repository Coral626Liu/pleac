<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>References and Records</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Python"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Subroutines"
HREF="subroutines.html"><LINK
REL="NEXT"
TITLE="Packages, Libraries, and Modules"
HREF="packagesetc.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Python</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="subroutines.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="packagesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="REFERENCESANDRECORDS"
>11. References and Records</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN592"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#Introduction.</span>
<span class="c">#   In Python, all names are references.</span>
<span class="c">#   All objects are inherently anonymous, they don&#39;t know what names refer to them.</span>
<span class="k">print</span> <span class="n">ref</span>   <span class="c"># prints the value that the name ref refers to. </span>
<span class="n">ref</span> <span class="o">=</span> <span class="mi">3</span>     <span class="c"># assigns the name ref to the value 3.</span>
<span class="c">#-----------------------------</span>
<span class="n">aref</span> <span class="o">=</span> <span class="n">mylist</span>
<span class="c">#-----------------------------</span>
<span class="n">aref</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>    <span class="c"># aref is a name for this list</span>
<span class="n">href</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;How&quot;</span><span class="p">:</span> <span class="s">&quot;Now&quot;</span><span class="p">,</span> <span class="s">&quot;Brown&quot;</span><span class="p">:</span> <span class="s">&quot;Cow&quot;</span><span class="p">}</span> <span class="c"># href is a name for this dictionary</span>
<span class="c">#-----------------------------</span>
<span class="c">#   Python doesn&#39;t have autovivification as (for simple types) there is no difference between a name and a reference.</span>
<span class="c">#   If we try the equivalent of the Perl code we get the list, not a reference to the list.</span>
<span class="c">#-----------------------------</span>
<span class="c">#   To handle multidimensional arrays, you should use an extension to Python,</span>
<span class="c">#   such as numarray (http://www.stsci.edu/resources/software_hardware/numarray)</span>
<span class="c">#-----------------------------</span>
<span class="c">#   In Python, assignment doesn&#39;t return anything. </span>
<span class="c">#-----------------------------</span>
<span class="n">Nat</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;Name&quot;</span><span class="p">:</span> <span class="s">&quot;Leonhard Euler&quot;</span><span class="p">,</span>
        <span class="s">&quot;Address&quot;</span><span class="p">:</span> <span class="s">&quot;1729 Ramanujan Lane</span><span class="se">\n</span><span class="s">Mathworld, PI 31416&quot;</span><span class="p">,</span>
        <span class="s">&quot;Birthday&quot;</span><span class="p">:</span> <span class="mh">0x5bb5580</span>
<span class="p">}</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN595"
>Taking References to Arrays</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="n">aref</span> <span class="o">=</span> <span class="n">mylist</span>
<span class="n">anon_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">anon_copy</span> <span class="o">=</span> <span class="n">anon_list</span>
<span class="n">implicit_creation</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="n">anon_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">two</span> <span class="o">=</span> <span class="n">implicit_creation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="c">#  To get the last index of a list, you can use len() </span>
<span class="c"># [or list.__len__() - but don&#39;t] directly</span>
<span class="n">last_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aref</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

<span class="c"># Normally, though, you&#39;d use an index of -1 for the last</span>
<span class="c"># element, -2 for the second last, etc.</span>
<span class="k">print</span> <span class="n">implicit_creation</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c">#=&gt; 10</span>

<span class="n">num_items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aref</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">last_idx</span> <span class="o">=</span> <span class="n">aref</span><span class="o">.</span><span class="n">__len__</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">num_items</span> <span class="o">=</span> <span class="n">aref</span><span class="o">.</span><span class="n">__len__</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">someVar</span><span class="p">,</span> <span class="nb">type</span><span class="p">([])):</span>
    <span class="k">print</span> <span class="s">&quot;Expected a list&quot;</span>
<span class="c">#-----------------------------</span>
<span class="k">print</span> <span class="n">list_ref</span>
<span class="c">#-----------------------------</span>
<span class="c">#   sort is in place.</span>
<span class="n">list_ref</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="n">list_ref</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">list_ref</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[]</span>

<span class="n">aref1</span> <span class="o">=</span> <span class="n">list_ref</span><span class="p">()</span>
<span class="n">aref2</span> <span class="o">=</span> <span class="n">list_ref</span><span class="p">()</span>
<span class="c">#   aref1 and aref2 point to different lists.</span>
<span class="c">#-----------------------------</span>
<span class="n">list_ref</span><span class="p">[</span><span class="n">N</span><span class="p">]</span> <span class="c"># refers to the Nth item in the list_ref list.</span>
<span class="c">#-----------------------------</span>
<span class="c"># The following two statements are equivalent and return up to 3 elements</span>
<span class="c"># at indices 3, 4, and 5 (if they exist).</span>
<span class="n">pie</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
<span class="n">pie</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="c">#   This will insert 3 elements, overwriting elements at indices 3,4, or 5 - if they exist.</span>
<span class="n">pie</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;blackberry&quot;</span><span class="p">,</span> <span class="s">&quot;blueberry&quot;</span><span class="p">,</span> <span class="s">&quot;pumpkin&quot;</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">pie</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">item</span>

<span class="c"># DON&#39;T DO THIS (this type of indexing should be done with enumerate)</span>
<span class="c"># xrange does not create a list 0..len(pie) - 1, it creates an object </span>
<span class="c"># that returns one index at a time.</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pie</span><span class="p">)):</span>
    <span class="k">print</span> <span class="n">pie</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN598"
>Making Hashes of Arrays</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c"># Making Hashes of Arrays</span>

<span class="nb">hash</span><span class="p">[</span><span class="s">&quot;KEYNAME&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;new value&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">mystr</span> <span class="ow">in</span> <span class="nb">hash</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mystr</span><span class="p">,</span> <span class="nb">hash</span><span class="p">[</span><span class="n">mystr</span><span class="p">])</span>

<span class="nb">hash</span><span class="p">[</span><span class="s">&quot;a key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="n">values</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">[</span><span class="s">&quot;a key&quot;</span><span class="p">]</span>

<span class="nb">hash</span><span class="p">[</span><span class="s">&quot;a key&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="c"># autovivification also does not work in python.</span>
<span class="n">residents</span> <span class="o">=</span> <span class="n">phone2name</span><span class="p">[</span><span class="n">number</span><span class="p">]</span>
<span class="c"># do this instead</span>
<span class="n">residents</span> <span class="o">=</span> <span class="n">phone2name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="p">[])</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN601"
>Taking References to Hashes</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c"># Taking References to Hashes</span>

<span class="n">href</span> <span class="o">=</span> <span class="nb">hash</span>
<span class="n">anon_hash</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;key1&quot;</span><span class="p">:</span><span class="s">&quot;value1&quot;</span><span class="p">,</span> <span class="s">&quot;key2&quot;</span> <span class="p">:</span> <span class="s">&quot;value2 ...&quot;</span> <span class="p">}</span>
<span class="n">anon_hash_copy</span> <span class="o">=</span> <span class="n">anon_hash</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="nb">hash</span> <span class="o">=</span> <span class="n">href</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">href</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="nb">slice</span> <span class="o">=</span> <span class="p">[</span><span class="n">href</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">,</span> <span class="n">key3</span><span class="p">)]</span>
<span class="n">keys</span> <span class="o">=</span> <span class="nb">hash</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">types</span>
<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">someref</span><span class="p">)</span> <span class="o">!=</span> <span class="n">types</span><span class="o">.</span><span class="n">DictType</span><span class="p">:</span>
    <span class="k">raise</span> <span class="s">&quot;Expected a dictionary, not </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">someref</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">someref</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
    <span class="k">raise</span> <span class="s">&quot;Expected a dictionary, not </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">someref</span><span class="p">)</span>

<span class="k">for</span> <span class="n">href</span> <span class="ow">in</span> <span class="p">(</span> <span class="n">ENV</span><span class="p">,</span> <span class="n">INC</span> <span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">href</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> =&gt; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">href</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">hash_ref</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">,</span> <span class="n">key3</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span> <span class="s">&quot;key2&quot;</span><span class="p">,</span> <span class="s">&quot;key3&quot;</span><span class="p">):</span>
    <span class="n">hash_ref</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">7</span>    <span class="c"># not like in perl but the same result.</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN604"
>Taking References to Functions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="n">cref</span> <span class="o">=</span> <span class="n">func</span>
<span class="n">cref</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="o">...</span>
<span class="c">#-----------------------------</span>
<span class="n">returned</span> <span class="o">=</span> <span class="n">cref</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">funcname</span> <span class="o">=</span> <span class="s">&quot;thefunc&quot;</span>
<span class="nb">locals</span><span class="p">()[</span><span class="n">funcname</span><span class="p">]();</span>
<span class="c">#-----------------------------</span>
<span class="n">commands</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;happy&#39;</span><span class="p">:</span> <span class="n">joy</span><span class="p">,</span>
    <span class="s">&#39;sad&#39;</span><span class="p">:</span> <span class="n">sullen</span><span class="p">,</span>
    <span class="s">&#39;done&#39;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()),</span>  <span class="c"># In this case &quot;done: sys.exit&quot; would suffice</span>
    <span class="s">&#39;mad&#39;</span><span class="p">:</span> <span class="n">angry</span><span class="p">,</span>
    <span class="p">}</span>

<span class="k">print</span> <span class="s">&quot;How are you?&quot;</span><span class="p">,</span>
<span class="n">cmd</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">()</span>
<span class="k">if</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
    <span class="n">commands</span><span class="p">[</span><span class="n">cmd</span><span class="p">]()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;No such command: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">cmd</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">counter_maker</span><span class="p">():</span>
    <span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">counter_function</span><span class="p">():</span>
        <span class="c"># start refers to the variable defined in counter_maker, but</span>
        <span class="c"># we can&#39;t reassign or increment variables in parent scopes.</span>
        <span class="c"># By using a one-element list we can modify the list without</span>
        <span class="c"># reassigning the variable.  This way of using a list is very</span>
        <span class="c"># like a reference.</span>
        <span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">counter_function</span>

<span class="n">counter</span> <span class="o">=</span> <span class="n">counter_maker</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">counter</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="n">counter1</span> <span class="o">=</span> <span class="n">counter_maker</span><span class="p">()</span>
<span class="n">counter2</span> <span class="o">=</span> <span class="n">counter_maker</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">counter1</span><span class="p">()</span>
<span class="k">print</span> <span class="n">counter1</span><span class="p">(),</span> <span class="n">counter2</span><span class="p">()</span>
<span class="c">#=&gt; 0</span>
<span class="c">#=&gt; 1</span>
<span class="c">#=&gt; 2</span>
<span class="c">#=&gt; 3</span>
<span class="c">#=&gt; 4</span>
<span class="c">#=&gt; 5 0</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">def</span> <span class="nf">timestamp</span><span class="p">():</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">elapsed</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="k">return</span> <span class="n">elapsed</span>
<span class="n">early</span> <span class="o">=</span> <span class="n">timestamp</span><span class="p">()</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">later</span> <span class="o">=</span> <span class="n">timestamp</span><span class="p">()</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;It&#39;s been </span><span class="si">%d</span><span class="s"> seconds since early&quot;</span> <span class="o">%</span> <span class="n">early</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;It&#39;s been </span><span class="si">%d</span><span class="s"> seconds since later&quot;</span> <span class="o">%</span> <span class="n">later</span><span class="p">()</span>
<span class="c">#=&gt; It&#39;s been 30 seconds since early.</span>
<span class="c">#=&gt; It&#39;s been 10 seconds since later.</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN607"
>Taking References to Scalars</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c"># A name is a reference to an object and an object can be referred to</span>
<span class="c"># by any number of names. There is no way to manipulate pointers or</span>
<span class="c"># an object&#39;s id.  This section is thus inapplicable.</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span>
<span class="k">print</span> <span class="n">x</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>    <span class="c"># &quot;x&quot; now refers to a different object than y</span>
<span class="k">print</span> <span class="n">x</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">4</span>     <span class="c"># &quot;y&quot; now refers to a different object than it did before</span>
<span class="k">print</span> <span class="n">x</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="c"># Some objects (including ints and strings) are immutable, however, which</span>
<span class="c"># can give the illusion of a by-value/by-reference distinction:</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">z</span> <span class="o">=</span> <span class="s">&quot;s&quot;</span>
<span class="k">print</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>
<span class="c">#=&gt; [1] 1 s</span>

<span class="n">x</span> <span class="o">+=</span> <span class="n">x</span>      <span class="c"># calls list.__iadd__ which is inplace.</span>
<span class="n">y</span> <span class="o">+=</span> <span class="n">y</span>      <span class="c"># can&#39;t find int.__iadd__ so calls int.__add__ which isn&#39;t inplace</span>
<span class="n">z</span> <span class="o">+=</span> <span class="n">z</span>      <span class="c"># can&#39;t find str.__iadd__ so calls str.__add__ which isn&#39;t inplace              </span>
<span class="k">print</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>
<span class="c">#=&gt; [1, 1] 1 s</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN610"
>Creating Arrays of Scalar References</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c"># As indicated by the previous section, everything is referenced, so</span>
<span class="c"># just create a list as normal, and beware that augmented assignment</span>
<span class="c"># works differently with immutable objects to mutable ones:</span>
<span class="n">mylist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;s&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<span class="k">print</span> <span class="n">mylist</span>
<span class="c">#=&gt; [1, s, [1]]</span>

<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
    <span class="n">elem</span> <span class="o">*=</span> <span class="mi">2</span>
<span class="k">print</span> <span class="n">mylist</span>
<span class="c">#=&gt; [1, s, [1, 1]]</span>

<span class="n">mylist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">2</span>
<span class="n">mylist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">2</span>
<span class="k">print</span> <span class="n">mylist</span>
<span class="c">#=&gt; [1, s, [1, 1, 1, 1]]</span>

<span class="c"># If you need to modify every value in a list, you should use a list comprehension</span>
<span class="c"># which does NOT modify inplace:</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="n">mylist</span> <span class="o">=</span> <span class="p">[(</span><span class="n">val</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">4</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">]</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN613"
>Using Closures Instead of Objects</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">mkcounter</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">mkcounter</span><span class="p">(</span><span class="mi">77</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;next c1: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">c1</span><span class="p">[</span><span class="s">&#39;next&#39;</span><span class="p">]()</span>  <span class="c"># 21</span>
<span class="k">print</span> <span class="s">&quot;next c2: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">c2</span><span class="p">[</span><span class="s">&#39;next&#39;</span><span class="p">]()</span>  <span class="c"># 78</span>
<span class="k">print</span> <span class="s">&quot;next c1: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">c1</span><span class="p">[</span><span class="s">&#39;next&#39;</span><span class="p">]()</span>  <span class="c"># 22</span>
<span class="k">print</span> <span class="s">&quot;last c1: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">c1</span><span class="p">[</span><span class="s">&#39;prev&#39;</span><span class="p">]()</span>  <span class="c"># 21</span>
<span class="k">print</span> <span class="s">&quot;old  c2: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">c2</span><span class="p">[</span><span class="s">&#39;reset&#39;</span><span class="p">]()</span> <span class="c"># 77</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS.  Use an object instead  </span>
<span class="k">def</span> <span class="nf">mkcounter</span><span class="p">(</span><span class="n">start</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">next</span><span class="p">():</span>
        <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">prev</span><span class="p">():</span>
        <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">bump</span><span class="p">(</span><span class="n">incr</span><span class="p">):</span>
        <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">incr</span>
        <span class="k">return</span> <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">():</span>
        <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">start</span>
        <span class="k">return</span> <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">&#39;next&#39;</span><span class="p">:</span> <span class="nb">next</span><span class="p">,</span> <span class="s">&#39;prev&#39;</span><span class="p">:</span> <span class="n">prev</span><span class="p">,</span> <span class="s">&#39;get&#39;</span><span class="p">:</span> <span class="n">get</span><span class="p">,</span> <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">,</span>
        <span class="s">&#39;bump&#39;</span><span class="p">:</span> <span class="n">bump</span><span class="p">,</span> <span class="s">&#39;reset&#39;</span><span class="p">:</span> <span class="n">reset</span><span class="p">,</span> <span class="s">&#39;last&#39;</span><span class="p">:</span> <span class="n">prev</span><span class="p">}</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN616"
>Creating References to Methods</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="n">mref</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">meth</span>
<span class="c"># later...</span>
<span class="n">mref</span><span class="p">(</span><span class="s">&quot;args&quot;</span><span class="p">,</span> <span class="s">&quot;go&quot;</span><span class="p">,</span> <span class="s">&quot;here&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN619"
>Constructing Records</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="n">record</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;Jason&quot;</span><span class="p">,</span>
    <span class="s">&quot;empno&quot;</span><span class="p">:</span> <span class="mi">132</span><span class="p">,</span>
    <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;deputy peon&quot;</span><span class="p">,</span>
    <span class="s">&quot;age&quot;</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span>
    <span class="s">&quot;salary&quot;</span><span class="p">:</span> <span class="mi">37000</span><span class="p">,</span>
    <span class="s">&quot;pals&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;Norbert&quot;</span><span class="p">,</span> <span class="s">&quot;Rhys&quot;</span><span class="p">,</span> <span class="s">&quot;Phineas&quot;</span><span class="p">],</span>
<span class="p">}</span>
<span class="k">print</span> <span class="s">&quot;I am </span><span class="si">%s</span><span class="s">, and my pals are </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">],</span>
                                        <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s">&quot;pals&quot;</span><span class="p">]))</span>
<span class="c">#-----------------------------</span>
<span class="n">byname</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">byname</span><span class="p">[</span><span class="n">record</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">record</span>

<span class="n">rp</span> <span class="o">=</span> <span class="n">byname</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;Aron&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">rp</span><span class="p">:</span>
     <span class="k">print</span> <span class="s">&quot;Aron is employee </span><span class="si">%d</span><span class="s">.&quot;</span><span class="o">%</span> <span class="n">rp</span><span class="p">[</span><span class="s">&quot;empno&quot;</span><span class="p">]</span>

<span class="n">byname</span><span class="p">[</span><span class="s">&quot;Jason&quot;</span><span class="p">][</span><span class="s">&quot;pals&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Theodore&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Jason now has </span><span class="si">%d</span><span class="s"> pals.&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">byname</span><span class="p">[</span><span class="s">&quot;Jason&quot;</span><span class="p">][</span><span class="s">&quot;pals&quot;</span><span class="p">])</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">byname</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> is employee number </span><span class="si">%d</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="s">&quot;empno&quot;</span><span class="p">])</span>

<span class="n">employees</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">employees</span><span class="p">[</span><span class="n">record</span><span class="p">[</span><span class="s">&quot;empno&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">record</span><span class="p">;</span>

<span class="c"># lookup by id</span>
<span class="n">rp</span> <span class="o">=</span> <span class="n">employees</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">rp</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Employee number 132 is </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">rp</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span>

<span class="n">byname</span><span class="p">[</span><span class="s">&quot;Jason&quot;</span><span class="p">][</span><span class="s">&quot;salary&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">1.035</span>

<span class="n">peons</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">employees</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s">&quot;title&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;peon&quot;</span><span class="p">]</span>
<span class="n">tsevens</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">employees</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s">&quot;age&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">27</span><span class="p">]</span>

<span class="c"># Go through all records</span>
<span class="k">print</span> <span class="n">employees</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

<span class="k">for</span> <span class="n">rp</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">employees</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="s">&quot;age&quot;</span><span class="p">]):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> is age </span><span class="si">%d</span><span class="s">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">rp</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">],</span> <span class="n">rp</span><span class="p">[</span><span class="s">&quot;age&quot;</span><span class="p">])</span>

<span class="c"># use @byage, an array of arrays of records</span>
<span class="n">byage</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">byage</span><span class="p">[</span><span class="n">record</span><span class="p">[</span><span class="s">&quot;age&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">byage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s">&quot;age&quot;</span><span class="p">],</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">[</span><span class="n">record</span><span class="p">]</span>

<span class="k">for</span> <span class="n">age</span><span class="p">,</span> <span class="n">records</span> <span class="ow">in</span> <span class="n">byage</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">records</span>
    <span class="k">print</span> <span class="s">&quot;Age </span><span class="si">%s</span><span class="s">:&quot;</span><span class="o">%</span><span class="n">age</span><span class="p">,</span>
    <span class="k">for</span> <span class="n">rp</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">rp</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">],</span>
    <span class="k">print</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN622"
>Reading and Writing Hash Records to Text Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="n">FieldName</span><span class="p">:</span> <span class="n">Value</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">list_of_records</span><span class="p">:</span>
    <span class="c"># Note: sorted added in Python 2.4</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="k">print</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">list_of_records</span> <span class="o">=</span> <span class="p">[{}]</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
        <span class="c"># EOF</span>
        <span class="k">break</span>
    <span class="c"># Remove trailing \n:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="c"># New record</span>
        <span class="n">list_of_records</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
        <span class="k">continue</span>
    <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&#39;:\s*&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c"># Assign the key/value to the last item in the list_of_records:</span>
    <span class="n">list_of_records</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN625"
>Printing Data Structures</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="kn">import</span> <span class="nn">pprint</span>

<span class="n">mylist</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]],</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="n">mydict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;abc&quot;</span><span class="p">:</span> <span class="s">&quot;def&quot;</span><span class="p">,</span> <span class="s">&quot;ghi&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]}</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">mylist</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">fmtdict</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">mydict</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span> <span class="n">fmtdict</span>
<span class="c"># &quot;import pprint; help(pprint)&quot; for more details</span>

<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># Note that pprint does not currently handle user objects</span>

<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN628"
>Copying Data Structures</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="n">newlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span> <span class="c"># shallow copy</span>
<span class="n">newdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mydict</span><span class="p">)</span> <span class="c"># shallow copy</span>

<span class="c"># Pre 2.3:</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="n">newlist</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span> <span class="c"># shallow copy</span>
<span class="n">newdict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mydict</span><span class="p">)</span> <span class="c"># shallow copy</span>

<span class="c"># shallow copies copy a data structure, but don&#39;t copy the items in those</span>
<span class="c"># data structures so if there are nested data structures, both copy and</span>
<span class="c"># original will refer to the same object</span>
<span class="n">mylist</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="s">&quot;2&quot;</span><span class="p">,</span> <span class="s">&quot;3&quot;</span><span class="p">]</span>
<span class="n">newlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span>
<span class="n">mylist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;0&quot;</span>
<span class="k">print</span> <span class="n">mylist</span><span class="p">,</span> <span class="n">newlist</span>
<span class="c">#=&gt; [&#39;0&#39;, &#39;2&#39;, &#39;3&#39;] [&#39;1&#39;, &#39;2&#39;, &#39;3&#39;]</span>

<span class="n">mylist</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="s">&quot;2&quot;</span><span class="p">,</span> <span class="s">&quot;3&quot;</span><span class="p">],</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">newlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span>
<span class="n">mylist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;0&quot;</span>
<span class="k">print</span> <span class="n">mylist</span><span class="p">,</span> <span class="n">newlist</span>
<span class="c">#=&gt; [[&#39;0&#39;, &#39;2&#39;, &#39;3&#39;], 4] [[&#39;0&#39;, &#39;2&#39;, &#39;3&#39;], 4]</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="n">newlist</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span> <span class="c"># deep copy</span>
<span class="n">newdict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mydict</span><span class="p">)</span> <span class="c"># deep copy</span>

<span class="c"># deep copies copy a data structure recursively:</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="n">mylist</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="s">&quot;2&quot;</span><span class="p">,</span> <span class="s">&quot;3&quot;</span><span class="p">],</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">newlist</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span>
<span class="n">mylist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;0&quot;</span>
<span class="k">print</span> <span class="n">mylist</span><span class="p">,</span> <span class="n">newlist</span>
<span class="c">#=&gt; [[&#39;0&#39;, &#39;2&#39;, &#39;3&#39;], 4] [[&#39;1&#39;, &#39;2&#39;, &#39;3&#39;], 4]</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN631"
>Storing Data Structures to Disk</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="n">x</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">p_x</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c"># Also pickle.dump(x, myfile) which writes to myfile</span>
<span class="k">del</span> <span class="n">x</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">p_x</span><span class="p">)</span>  <span class="c"># Also x = pickle.load(myfile) which loads from myfile</span>
<span class="k">print</span> <span class="n">x</span><span class="o">.</span><span class="n">val</span>
<span class="c">#=&gt; 3</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN634"
>Transparently Persistent Data Structures</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">shelve</span>
<span class="n">fname</span> <span class="o">=</span> <span class="s">&quot;testfile.db&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;testfile.db&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100000</span><span class="p">):</span>
        <span class="n">d</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">i</span>
    <span class="n">d</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;testfile.db&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">d</span><span class="p">[</span><span class="s">&quot;100&quot;</span><span class="p">]</span>
<span class="k">print</span> <span class="n">d</span><span class="p">[</span><span class="s">&quot;1212010201&quot;</span><span class="p">]</span> <span class="c"># KeyError</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN637"
>Program: Binary Trees</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c"># bintree - binary tree demo program</span>
<span class="c"># Use the heapq module instead?</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="k">class</span> <span class="nc">BTree</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="c">### insert given value into proper point of</span>
    <span class="c">### the tree, extending this node if necessary.</span>
    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">BTree</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">BTree</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;Duplicate insertion of </span><span class="si">%s</span><span class="s">.&quot;</span><span class="o">%</span><span class="n">value</span><span class="p">)</span>
            
    <span class="c"># recurse on left child, </span>
    <span class="c"># then show current value, </span>
    <span class="c"># then recurse on right child.</span>
    <span class="k">def</span> <span class="nf">in_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
       <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">in_order</span><span class="p">()</span>
           <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">in_order</span><span class="p">()</span>

    <span class="c"># show current value, </span>
    <span class="c"># then recurse on left child, </span>
    <span class="c"># then recurse on right child.</span>
    <span class="k">def</span> <span class="nf">pre_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">pre_order</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">pre_order</span><span class="p">()</span>
    
    <span class="c"># recurse on left child, </span>
    <span class="c"># then recurse on right child,</span>
    <span class="c"># then show current value. </span>
    <span class="k">def</span> <span class="nf">post_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">post_order</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">post_order</span><span class="p">()</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>

    <span class="c"># find out whether provided value is in the tree.</span>
    <span class="c"># if so, return the node at which the value was found.</span>
    <span class="c"># cut down search time by only looking in the correct</span>
    <span class="c"># branch, based on current value.</span>
    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">BTree</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
        <span class="n">root</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>

    <span class="c"># now dump out the tree all three ways</span>
    <span class="k">print</span> <span class="s">&quot;Pre order: &quot;</span><span class="p">,</span> <span class="n">root</span><span class="o">.</span><span class="n">pre_order</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&quot;In order:  &quot;</span><span class="p">,</span> <span class="n">root</span><span class="o">.</span><span class="n">in_order</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&quot;Post order:&quot;</span><span class="p">,</span> <span class="n">root</span><span class="o">.</span><span class="n">post_order</span><span class="p">()</span>

    <span class="c">### prompt until empty line</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;Search? &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="n">found</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Found </span><span class="si">%s</span><span class="s"> at </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">found</span><span class="p">,</span> <span class="n">found</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;No </span><span class="si">%s</span><span class="s"> in tree&quot;</span> <span class="o">%</span> <span class="n">val</span>
            
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">test</span><span class="p">()</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="subroutines.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="packagesetc.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Subroutines</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Packages, Libraries, and Modules</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>