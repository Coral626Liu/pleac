<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Dates and Times</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Python"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Numbers"
HREF="numbers.html"><LINK
REL="NEXT"
TITLE="Arrays"
HREF="arrays.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Python</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="numbers.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="arrays.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DATESANDTIMES"
>3. Dates and Times</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN132"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#----------------------------- </span>
<span class="c">#introduction</span>
<span class="c"># There are three common ways of manipulating dates in Python</span>
<span class="c"># mxDateTime - a popular third-party module (not discussed here) </span>
<span class="c"># time - a fairly low-level standard library module </span>
<span class="c"># datetime - a new library module for Python 2.3 and used for most of these samples </span>
<span class="c"># (I will use full names to show which module they are in, but you can also use</span>
<span class="c"># from datetime import datetime, timedelta and so on for convenience) </span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">print</span> <span class="s">&quot;Today is day&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()[</span><span class="mi">7</span><span class="p">],</span> <span class="s">&quot;of the current year&quot;</span> 
<span class="c"># Today is day 218 of the current year</span>

<span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;Today is day&quot;</span><span class="p">,</span> <span class="n">today</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()[</span><span class="mi">7</span><span class="p">],</span> <span class="s">&quot;of &quot;</span><span class="p">,</span> <span class="n">today</span><span class="o">.</span><span class="n">year</span>
<span class="c"># Today is day 218 of 2003</span>

<span class="k">print</span> <span class="s">&quot;Today is day&quot;</span><span class="p">,</span> <span class="n">today</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%j&quot;</span><span class="p">),</span> <span class="s">&quot;of the current year&quot;</span> 
<span class="c"># Today is day 218 of the current year</span>
 </PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN135"
>Finding Today's Date</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#----------------------------- </span>
<span class="c"># Finding todays date</span>

<span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;The date is&quot;</span><span class="p">,</span> <span class="n">today</span> 
<span class="c">#=&gt; The date is 2003-08-06</span>

<span class="c"># the function strftime() (string-format time) produces nice formatting</span>
<span class="c"># All codes are detailed at http://www.python.org/doc/current/lib/module-time.html</span>
<span class="k">print</span> <span class="n">t</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;four-digit year: %Y, two-digit year: %y, month: %m, day: </span><span class="si">%d</span><span class="s">&quot;</span><span class="p">)</span> 
<span class="c">#=&gt; four-digit year: 2003, two-digit year: 03, month: 08, day: 06</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN138"
>Converting DMYHMS to Epoch Seconds</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#----------------------------- </span>
<span class="c"># Converting DMYHMS to Epoch Seconds</span>
<span class="c"># To work with Epoch Seconds, you need to use the time module</span>

<span class="c"># For the local timezone</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;Epoch Seconds:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>
<span class="c">#=&gt; Epoch Seconds: 1060199000.0</span>

<span class="c"># For UTC</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;Epoch Seconds:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>
<span class="c">#=&gt; Epoch Seconds: 1060195503.0</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN141"
>Converting Epoch Seconds to DMYHMS</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#----------------------------- </span>
<span class="c"># Converting Epoch Seconds to DMYHMS</span>

<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">EpochSeconds</span><span class="p">)</span>
<span class="c">#or use datetime.datetime.utcfromtimestamp()</span>
<span class="k">print</span> <span class="n">now</span>
<span class="c">#=&gt; datetime.datetime(2003, 8, 6, 20, 43, 20)</span>
<span class="k">print</span> <span class="n">now</span><span class="o">.</span><span class="n">ctime</span><span class="p">()</span>
<span class="c">#=&gt; Wed Aug  6 20:43:20 2003</span>

<span class="c"># or with the time module</span>
<span class="n">oldtimetuple</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">EpochSeconds</span><span class="p">)</span>
<span class="c"># oldtimetuple contains (year, month, day, hour, minute, second, weekday, yearday, daylightSavingAdjustment) </span>
<span class="k">print</span> <span class="n">oldtimetuple</span> 
<span class="c">#=&gt; (2003, 8, 6, 20, 43, 20, 2, 218, 1)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN144"
>Adding to or Subtracting from a Date</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#----------------------------- </span>
<span class="c"># Adding to or Subtracting from a Date</span>
<span class="c"># Use the rather nice datetime.timedelta objects</span>

<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2003</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">difference1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">difference2</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;One day in the future is:&quot;</span><span class="p">,</span> <span class="n">now</span> <span class="o">+</span> <span class="n">difference1</span>
<span class="c">#=&gt; One day in the future is: 2003-08-07</span>

<span class="k">print</span> <span class="s">&quot;Two weeks in the past is:&quot;</span><span class="p">,</span> <span class="n">now</span> <span class="o">+</span> <span class="n">difference2</span>
<span class="c">#=&gt; Two weeks in the past is: 2003-07-23</span>

<span class="k">print</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2003</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="c">#=&gt; 1095 days, 0:00:00</span>

<span class="c">#----------------------------- </span>
<span class="n">birthtime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1973</span><span class="p">,</span> <span class="mo">01</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>   <span class="c"># 1973-01-18 03:45:50</span>

<span class="n">interval</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">hours</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">55</span><span class="p">)</span> 
<span class="n">then</span> <span class="o">=</span> <span class="n">birthtime</span> <span class="o">+</span> <span class="n">interval</span>

<span class="k">print</span> <span class="s">&quot;Then is&quot;</span><span class="p">,</span> <span class="n">then</span><span class="o">.</span><span class="n">ctime</span><span class="p">()</span>
<span class="c">#=&gt; Then is Wed Mar 14 06:02:55 1973</span>

<span class="k">print</span> <span class="s">&quot;Then is&quot;</span><span class="p">,</span> <span class="n">then</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%A %B </span><span class="si">%d</span><span class="s"> %I:%M:%S %p %Y&quot;</span><span class="p">)</span>
<span class="c">#=&gt; Then is Wednesday March 14 06:02:55 AM 1973</span>

<span class="c">#-----------------------------</span>
<span class="n">when</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1973</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">55</span><span class="p">)</span> 
<span class="k">print</span> <span class="s">&quot;Nat was 55 days old on:&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%m/</span><span class="si">%d</span><span class="s">/%Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
<span class="c">#=&gt; Nat was 55 days old on: 3/14/1973</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN147"
>Difference of Two Dates</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#----------------------------- </span>
<span class="c"># Dates produce timedeltas when subtracted.</span>

<span class="n">diff</span> <span class="o">=</span> <span class="n">date2</span> <span class="o">-</span> <span class="n">date1</span>
<span class="n">diff</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year1</span><span class="p">,</span> <span class="n">month1</span><span class="p">,</span> <span class="n">day1</span><span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year2</span><span class="p">,</span> <span class="n">month2</span><span class="p">,</span> <span class="n">day2</span><span class="p">)</span>
<span class="c">#----------------------------- </span>

<span class="n">bree</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1981</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">nat</span>  <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1973</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

<span class="n">difference</span> <span class="o">=</span> <span class="n">bree</span> <span class="o">-</span> <span class="n">nat</span>
<span class="k">print</span> <span class="s">&quot;There were&quot;</span><span class="p">,</span> <span class="n">difference</span><span class="p">,</span> <span class="s">&quot;minutes between Nat and Bree&quot;</span>
<span class="c">#=&gt; There were 3071 days, 0:49:35 between Nat and Bree</span>

<span class="n">weeks</span><span class="p">,</span> <span class="n">days</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">difference</span><span class="o">.</span><span class="n">days</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

<span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">difference</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
<span class="n">hours</span><span class="p">,</span> <span class="n">minutes</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">minutes</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s"> weeks, </span><span class="si">%d</span><span class="s"> days, </span><span class="si">%d</span><span class="s">:</span><span class="si">%d</span><span class="s">:</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">weeks</span><span class="p">,</span> <span class="n">days</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span><span class="p">)</span>
<span class="c">#=&gt; 438 weeks, 5 days, 0:49:35</span>

<span class="c">#----------------------------- </span>
<span class="k">print</span> <span class="s">&quot;There were&quot;</span><span class="p">,</span> <span class="n">difference</span><span class="o">.</span><span class="n">days</span><span class="p">,</span> <span class="s">&quot;days between Bree and Nat.&quot;</span> 
<span class="c">#=&gt; There were 3071 days between bree and nat</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN150"
>Day in a Week/Month/Year or Week Number</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#----------------------------- </span>
<span class="c"># Day in a Week/Month/Year or Week Number</span>

<span class="n">when</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">1981</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;16/6/1981 was:&quot;</span>
<span class="k">print</span> <span class="n">when</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;Day %w of the week (a %A). Day </span><span class="si">%d</span><span class="s"> of the month (%B).&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">when</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;Day %j of the year (%Y), in week %W of the year.&quot;</span><span class="p">)</span>

<span class="c">#=&gt; 16/6/1981 was:</span>
<span class="c">#=&gt; Day 2 of the week (a Tuesday). Day 16 of the month (June).</span>
<span class="c">#=&gt; Day 167 of the year (1981), in week 24 of the year.</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN153"
>Parsing Dates and Times from Strings</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#----------------------------- </span>
<span class="c"># Parsing Dates and Times from Strings</span>

<span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s">&quot;Tue Jun 16 20:18:03 1981&quot;</span><span class="p">)</span>
<span class="c"># (1981, 6, 16, 20, 18, 3, 1, 167, -1)</span>

<span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s">&quot;16/6/1981&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">/%m/%Y&quot;</span><span class="p">)</span>
<span class="c"># (1981, 6, 16, 0, 0, 0, 1, 167, -1)</span>
<span class="c"># strptime() can use any of the formatting codes from time.strftime()</span>

<span class="c"># The easiest way to convert this to a datetime seems to be; </span>
<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s">&quot;16/6/1981&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">/%m/%Y&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>
<span class="c"># the &#39;*&#39; operator unpacks the tuple, producing the argument list.</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN156"
>Printing a Date</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#----------------------------- </span>
<span class="c"># Printing a Date</span>
<span class="c"># Use datetime.strftime() - see helpfiles in distro or at python.org</span>

<span class="k">print</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;The date is %A (%a) </span><span class="si">%d</span><span class="s">/%m/%Y&quot;</span><span class="p">)</span> 
<span class="c">#=&gt; The date is Friday (Fri) 08/08/2003</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN159"
>High-Resolution Timers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#----------------------------- </span>
<span class="c"># High Resolution Timers</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<span class="c"># Do Stuff Here</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<span class="k">print</span> <span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span>

<span class="c"># 2.27236813618</span>
<span class="c"># Accuracy will depend on platform and OS,</span>
<span class="c"># but time.clock() uses the most accurate timer it can</span>

<span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">();</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<span class="c"># 174485.51365466841</span>
<span class="c"># 174485.55702610247</span>

<span class="c">#----------------------------- </span>
<span class="c"># Also useful;</span>
<span class="kn">import</span> <span class="nn">timeit</span>
<span class="n">code</span> <span class="o">=</span> <span class="s">&#39;[x for x in range(10) if x % 2 == 0]&#39;</span>
<span class="nb">eval</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="c"># [0, 2, 4, 6, 8]</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;10,000 repeats of that code takes:&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span> <span class="s">&quot;seconds&quot;</span> 
<span class="k">print</span> <span class="s">&quot;1,000,000 repeats of that code takes:&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">timeit</span><span class="p">(),</span> <span class="s">&quot;seconds&quot;</span>

<span class="c"># 10,000 repeats of that code takes: 0.128238644856 seconds</span>
<span class="c"># 1,000,000 repeats of that code takes:  12.5396490336 seconds</span>

<span class="c">#----------------------------- </span>
<span class="kn">import</span> <span class="nn">timeit</span>
<span class="n">code</span> <span class="o">=</span> <span class="s">&#39;import random; l = random.sample(xrange(10000000), 1000); l.sort()&#39;</span> 
<span class="n">t</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;Create a list of a thousand random numbers. Sort the list. Repeated a thousand times.&quot;</span> 
<span class="k">print</span> <span class="s">&quot;Average Time:&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>
<span class="c"># Time taken: 5.24391507859</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN162"
>Short Sleeps</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#----------------------------- </span>
<span class="c"># Short Sleeps</span>

<span class="n">seconds</span> <span class="o">=</span> <span class="mf">3.1</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;boo&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN165"
>Program: hopdelta</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#----------------------------- </span>
<span class="c"># Program HopDelta</span>
<span class="c"># Save a raw email to disk and run &quot;python hopdelta.py FILE&quot;</span>
<span class="c"># and it will process the headers and show the time taken</span>
<span class="c"># for each server hop (nb: if server times are wrong, negative dates</span>
<span class="c"># might appear in the output).</span>

<span class="kn">import</span> <span class="nn">datetime</span><span class="o">,</span> <span class="nn">email</span><span class="o">,</span> <span class="nn">email.Utils</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">extract_date</span><span class="p">(</span><span class="n">hop</span><span class="p">):</span>
    <span class="c"># According to RFC822, the date will be prefixed with</span>
    <span class="c"># a semi-colon, and is the last part of a received</span>
    <span class="c"># header.</span>
    <span class="n">date_string</span> <span class="o">=</span> <span class="n">hop</span><span class="p">[</span><span class="n">hop</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">:]</span>
    <span class="n">date_string</span> <span class="o">=</span> <span class="n">date_string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">time_tuple</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">Utils</span><span class="o">.</span><span class="n">parsedate</span><span class="p">(</span><span class="n">date_string</span><span class="p">)</span>

    <span class="c"># convert time_tuple to datetime</span>
    <span class="n">EpochSeconds</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">time_tuple</span><span class="p">)</span> 
    <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">EpochSeconds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dt</span>

<span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="c"># Main email file processing</span>
    <span class="c"># read the headers and process them</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_file</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="n">hops</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="s">&#39;received&#39;</span><span class="p">)</span>
    
    <span class="c"># in reverse order, get the server(s) and date/time involved</span>
    <span class="n">hops</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">hop</span> <span class="ow">in</span> <span class="n">hops</span><span class="p">:</span>
        <span class="n">hop</span> <span class="o">=</span> <span class="n">hop</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">hop</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;by&#39;</span><span class="p">):</span>  <span class="c"># &#39;Received: by&#39; line</span>
            <span class="n">sender</span> <span class="o">=</span> <span class="s">&quot;start&quot;</span>
            <span class="n">receiver</span> <span class="o">=</span> <span class="n">hop</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">hop</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">extract_date</span><span class="p">(</span><span class="n">hop</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c"># &#39;Received: from&#39; line</span>
            <span class="n">sender</span> <span class="o">=</span> <span class="n">hop</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="n">hop</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">)]</span>
            <span class="n">by</span> <span class="o">=</span> <span class="n">hop</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;by &#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span>
            <span class="n">receiver</span> <span class="o">=</span> <span class="n">hop</span><span class="p">[</span><span class="n">by</span><span class="p">:</span><span class="n">hop</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">by</span><span class="p">)]</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">extract_date</span><span class="p">(</span><span class="n">hop</span><span class="p">)</span>

        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">sender</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">date</span><span class="p">))</span>
    <span class="n">output</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Sender, Recipient, Time, Delta&quot;</span>
    <span class="k">print</span>
    <span class="n">previous_dt</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">previous_dt</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">date</span> <span class="o">-</span> <span class="n">previous_dt</span>
        
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sender</span><span class="p">,</span>
                               <span class="n">receiver</span><span class="p">,</span>
                               <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y/</span><span class="si">%d</span><span class="s">/%m %H:%M:%S&quot;</span><span class="p">),</span>
                               <span class="n">delta</span><span class="p">)</span>
        <span class="k">print</span>
        <span class="n">previous_dt</span> <span class="o">=</span> <span class="n">date</span>   
            
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c"># Perform some basic argument checking</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Usage: mailhop.py FILENAME&quot;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="n">process</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">filename</span><span class="p">,</span> <span class="s">&quot;doesn&#39;t seem to be a valid file.&quot;</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="numbers.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="arrays.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Numbers</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Arrays</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>