<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Subroutines</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Python"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Directories"
HREF="directories.html"><LINK
REL="NEXT"
TITLE="References and Records"
HREF="referencesandrecords.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Python</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="directories.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="referencesandrecords.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="SUBROUTINES"
>10. Subroutines</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN536"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="c"># DO NOT DO THIS...</span>
<span class="n">greeted</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">greeted</span>
    <span class="n">greeted</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">print</span> <span class="s">&quot;hi there&quot;</span>

<span class="c">#... as using a callable object to save state is cleaner</span>
<span class="c"># class hello</span>
<span class="c">#     def __init__(self):</span>
<span class="c">#         self.greeted = 0</span>
<span class="c">#     def __call__(self):</span>
<span class="c">#         self.greeted += 1</span>
<span class="c">#         print &quot;hi there&quot;</span>
<span class="c"># hello = hello()</span>
<span class="c">#-----------------------------</span>
<span class="n">hello</span><span class="p">()</span>                 <span class="c"># call subroutine hello with no arguments/parameters</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN539"
>Accessing Subroutine Arguments</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="c"># Provided for demonstration purposes only.  Use math.hypot() instead.</span>
<span class="k">def</span> <span class="nf">hypotenuse</span><span class="p">(</span><span class="n">side1</span><span class="p">,</span> <span class="n">side2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">side1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">side2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">diag</span> <span class="o">=</span> <span class="n">hypotenuse</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  <span class="c"># diag is 5.0</span>
<span class="c">#-----------------------------</span>
<span class="k">print</span> <span class="n">hypotenuse</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>               <span class="c"># prints 5.0</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="k">print</span> <span class="n">hypotenuse</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>                 <span class="c"># prints 5.0</span>
<span class="c">#-----------------------------</span>
<span class="n">both</span> <span class="o">=</span> <span class="n">men</span> <span class="o">+</span> <span class="n">women</span>
<span class="c">#-----------------------------</span>
<span class="n">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">6.7</span><span class="p">]</span>
<span class="c"># Provided for demonstration purposes only.  Use:</span>
<span class="c">#     ints = [int(num) for num in nums] </span>
<span class="k">def</span> <span class="nf">int_all</span><span class="p">(</span><span class="n">nums</span><span class="p">):</span>
    <span class="n">retlist</span> <span class="o">=</span> <span class="p">[]</span>            <span class="c"># make new list for return</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">:</span>
        <span class="n">retlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">retlist</span>
<span class="n">ints</span> <span class="o">=</span> <span class="n">int_all</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>        <span class="c"># nums unchanged</span>
<span class="c">#-----------------------------</span>
<span class="n">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">6.7</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">trunc_em</span><span class="p">(</span><span class="n">nums</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nums</span><span class="p">):</span>
        <span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
<span class="n">trunc_em</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>               <span class="c"># nums now [1,3,6]</span>

<span class="c">#-----------------------------</span>
<span class="c"># By convention, if a method (or function) modifies an object</span>
<span class="c"># in-place, it returns None rather than the modified object.</span>
<span class="c"># None of Python&#39;s built-in functions modify in-place; methods</span>
<span class="c"># such as list.sort() are somewhat more common.</span>
<span class="n">mylist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">mylist</span> <span class="o">=</span> <span class="n">mylist</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>   <span class="c"># incorrect - returns None</span>
<span class="n">mylist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span>  <span class="c"># correct - returns sorted copy</span>
<span class="n">mylist</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>            <span class="c"># correct - sorts in-place</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN542"
>Making Variables Private to a Function</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="c"># Using global variables is discouraged - by default variables</span>
<span class="c"># are visible only at and below the scope at which they are declared.</span>
<span class="c"># Global variables modified by a function or method must be declared </span>
<span class="c"># using the &quot;global&quot; keyword if they are modified</span>
<span class="k">def</span> <span class="nf">somefunc</span><span class="p">():</span>
    <span class="n">variable</span> <span class="o">=</span> <span class="n">something</span>  <span class="c"># variable is invisible outside of somefunc</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">name</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="c"># assumes two and only two command line parameters</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">fetch_time</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">pair</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">fetch_time</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">check_x</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;whatever&quot;</span>
    <span class="n">run_check</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">condition</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;got&quot;</span><span class="p">,</span> <span class="n">x</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">save_list</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">Global_List</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN545"
>Creating Persistent Private Variables</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="c">## Python allows static nesting of scopes for reading but not writing,</span>
<span class="c">## preferring to use objects.  The closest equivalent to:</span>
<span class="c">#{</span>
<span class="c">#    my $counter;</span>
<span class="c">#    sub next_counter { return ++$counter }</span>
<span class="c">#}</span>
<span class="c">## is:</span>
<span class="k">def</span> <span class="nf">next_counter</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>  <span class="c"># default lists are created once only.</span>
    <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c"># As that&#39;s a little tricksy (and can&#39;t make more than one counter),</span>
<span class="c"># many Pythonistas would prefer either:</span>
<span class="k">def</span> <span class="nf">make_counter</span><span class="p">():</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">yield</span> <span class="n">counter</span>
<span class="n">next_counter</span> <span class="o">=</span> <span class="n">make_counter</span><span class="p">()</span><span class="o">.</span><span class="n">next</span>

<span class="c"># Or:</span>
<span class="k">class</span> <span class="nc">Counter</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span>
<span class="n">next_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>

<span class="c">#-----------------------------</span>
<span class="c">## A close equivalent of</span>
<span class="c">#BEGIN {</span>
<span class="c">#    my $counter = 42;</span>
<span class="c">#    sub next_counter { return ++$counter }</span>
<span class="c">#    sub prev_counter { return --$counter }</span>
<span class="c">#}</span>
<span class="c">## is to use a list (to save the counter) and closured functions:</span>
<span class="k">def</span> <span class="nf">make_counter</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">next_counter</span><span class="p">():</span>
        <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">prev_counter</span><span class="p">():</span>
        <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">next_counter</span><span class="p">,</span> <span class="n">prev_counter</span>
<span class="n">next_counter</span><span class="p">,</span> <span class="n">prev_counter</span> <span class="o">=</span> <span class="n">make_counter</span><span class="p">()</span>

<span class="c">## A clearer way uses a class:</span>
<span class="k">class</span> <span class="nc">Counter</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">start</span>
    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
    <span class="k">def</span> <span class="nf">prev</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
    <span class="k">def</span> <span class="nf">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

<span class="n">counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">next_counter</span> <span class="o">=</span> <span class="n">counter</span><span class="o">.</span><span class="n">next</span>
<span class="n">prev_counter</span> <span class="o">=</span> <span class="n">counter</span><span class="o">.</span><span class="n">prev</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN548"
>Determining Current Function Name</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">## This sort of code inspection is liable to change as</span>
<span class="c">## Python evolves.  There may be cleaner ways to do this.</span>
<span class="c">## This also may not work for code called from functions</span>
<span class="c">## written in C.</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">this_function</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
<span class="c">#-----------------------------</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># how far up the call stack to look</span>
<span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">f_globals</span><span class="p">[</span><span class="s">&quot;__name__&quot;</span><span class="p">]</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_filename</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">f_lineno</span>
<span class="n">subr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
<span class="n">has_args</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_argcount</span><span class="p">)</span>

<span class="c"># &#39;wantarray&#39; is Perl specific</span>

<span class="c">#-----------------------------</span>
<span class="n">me</span> <span class="o">=</span> <span class="n">whoami</span><span class="p">()</span>
<span class="n">him</span> <span class="o">=</span> <span class="n">whowasi</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">whoami</span><span class="p">():</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
<span class="k">def</span> <span class="nf">whowasi</span><span class="p">():</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN551"
>Passing Arrays and Hashes by Reference</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="c"># Every variable name is a reference to an object, thus nothing special</span>
<span class="c"># needs to be done to pass a list or a dict as a parameter.</span>
<span class="n">list_diff</span><span class="p">(</span><span class="n">list1</span><span class="p">,</span> <span class="n">list2</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># Note: if one parameter to zip() is longer it will be truncated</span>
<span class="k">def</span> <span class="nf">add_vecpair</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x1</span><span class="o">+</span><span class="n">y1</span> <span class="k">for</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">add_vecpair</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)])</span>
<span class="c">#=&gt; 6 10</span>
<span class="c">#-----------------------------</span>
<span class="c"># DO NOT DO THIS:</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">type</span><span class="p">([]))</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nb">type</span><span class="p">([])),</span> \
    <span class="s">&quot;usage: add_vecpair(list1, list2)&quot;</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN554"
>Detecting Return Context</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="c"># perl return context is not something standard in python...</span>
<span class="c"># but still you can achieve something alike if you really need it</span>
<span class="c"># (but you must really need it badly since you should never use this!!)</span>
<span class="c">#</span>
<span class="c"># see http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/284742 for more</span>
<span class="c">#</span>
<span class="c"># NB: it has been tested under Python 2.3.x and no guarantees can be given</span>
<span class="c">#     that it works under any future Python version.</span>
<span class="kn">import</span> <span class="nn">inspect</span><span class="o">,</span><span class="nn">dis</span>

<span class="k">def</span> <span class="nf">expecting</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return how many values the caller is expecting&quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span><span class="o">.</span><span class="n">f_back</span>
    <span class="n">bytecode</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_code</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">f_lasti</span>
    <span class="n">instruction</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">bytecode</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">instruction</span> <span class="o">==</span> <span class="n">dis</span><span class="o">.</span><span class="n">opmap</span><span class="p">[</span><span class="s">&#39;UNPACK_SEQUENCE&#39;</span><span class="p">]:</span>
        <span class="n">howmany</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">bytecode</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">howmany</span>
    <span class="k">elif</span> <span class="n">instruction</span> <span class="o">==</span> <span class="n">dis</span><span class="o">.</span><span class="n">opmap</span><span class="p">[</span><span class="s">&#39;POP_TOP&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">cleverfunc</span><span class="p">():</span>
    <span class="n">howmany</span> <span class="o">=</span> <span class="n">expecting</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">howmany</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;return value discarded&quot;</span>
    <span class="k">if</span> <span class="n">howmany</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
    <span class="k">elif</span> <span class="n">howmany</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span>
    <span class="k">return</span> <span class="mi">1</span>

<span class="n">cleverfunc</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">cleverfunc</span><span class="p">()</span>
<span class="k">print</span> <span class="n">x</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">cleverfunc</span><span class="p">()</span>
<span class="k">print</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">cleverfunc</span><span class="p">()</span>
<span class="k">print</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN557"
>Passing by Named Parameter</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="n">thefunc</span><span class="p">(</span><span class="n">increment</span><span class="o">=</span> <span class="s">&quot;20s&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s">&quot;+5m&quot;</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="s">&quot;+30m&quot;</span><span class="p">)</span>
<span class="n">thefunc</span><span class="p">(</span><span class="n">start</span><span class="o">=</span> <span class="s">&quot;+5m&quot;</span><span class="p">,</span><span class="n">finish</span><span class="o">=</span><span class="s">&quot;+30m&quot;</span><span class="p">)</span>
<span class="n">thefunc</span><span class="p">(</span><span class="n">finish</span><span class="o">=</span> <span class="s">&quot;+30m&quot;</span><span class="p">)</span>
<span class="n">thefunc</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s">&quot;+5m&quot;</span><span class="p">,</span> <span class="n">increment</span><span class="o">=</span><span class="s">&quot;15s&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">thefunc</span><span class="p">(</span><span class="n">increment</span><span class="o">=</span><span class="s">&#39;10s&#39;</span><span class="p">,</span>
            <span class="n">finish</span><span class="o">=</span><span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="n">start</span><span class="o">=</span><span class="s">&#39;0&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">increment</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;m&quot;</span><span class="p">):</span>
        <span class="k">pass</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN560"
>Skipping Selected Return Values</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="n">a</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>       <span class="c"># Use _ as a placeholder...</span>
<span class="n">a</span><span class="p">,</span> <span class="n">ignore</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>  <span class="c"># ...or assign to an otherwise unused variable</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN563"
>Returning More Than One Array or Hash</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">somefunc</span><span class="p">():</span>
    <span class="n">mylist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mydict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c"># ...</span>
    <span class="k">return</span> <span class="n">mylist</span><span class="p">,</span> <span class="n">mydict</span>

<span class="n">mylist</span><span class="p">,</span> <span class="n">mydict</span> <span class="o">=</span> <span class="n">somefunc</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">fn</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>

<span class="c">#-----------------------------</span>
<span class="n">h0</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span> <span class="o">=</span> <span class="n">fn</span><span class="p">()</span>
<span class="n">tuple_of_dicts</span> <span class="o">=</span> <span class="n">fn</span><span class="p">()</span>   <span class="c"># eg: tuple_of_dicts[2][&quot;keystring&quot;]</span>
<span class="n">r0</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span> <span class="o">=</span> <span class="n">fn</span><span class="p">()</span>       <span class="c"># eg: r2[&quot;keystring&quot;]</span>

<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN566"
>Returning Failure</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="c"># Note: Exceptions are almost always preferred to error values</span>
<span class="k">return</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">empty_retval</span><span class="p">():</span>
    <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">empty_retval</span><span class="p">():</span>
    <span class="k">return</span>          <span class="c"># identical to return None</span>

<span class="k">def</span> <span class="nf">empty_retval</span><span class="p">():</span>
    <span class="k">pass</span>            <span class="c"># None returned by default (empty func needs pass)</span>
<span class="c">#-----------------------------</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">yourfunc</span><span class="p">()</span>
<span class="k">if</span> <span class="n">a</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="c">#-----------------------------</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">sfunc</span><span class="p">()</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&quot;sfunc failed&quot;</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">sfunc</span><span class="p">(),</span> <span class="s">&quot;sfunc failed&quot;</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN569"
>Prototyping Functions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c"># Prototypes are inapplicable to Python as Python disallows calling</span>
<span class="c"># functions without using brackets, and user functions are able to</span>
<span class="c"># mimic built-in functions with no special actions required as they</span>
<span class="c"># only flatten lists (and convert dicts to named arguments) if</span>
<span class="c"># explicitly told to do so.  Python functions use named parameters</span>
<span class="c"># rather than shifting arguments:</span>

<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
   <span class="k">print</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>

<span class="n">mylist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>

<span class="n">mydict1</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;b&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">mydict2</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;b&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>

<span class="n">myfunc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="c">#=&gt; 1 2 3</span>

<span class="n">myfunc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="c">#=&gt; 1 2 4</span>

<span class="n">myfunc</span><span class="p">(</span><span class="o">*</span><span class="n">mylist</span><span class="p">)</span>
<span class="c">#=&gt; 1 2 4</span>

<span class="n">myfunc</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="o">*</span><span class="n">mylist</span><span class="p">)</span>
<span class="c">#=&gt; 5, 1, 2</span>

<span class="n">myfunc</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">mydict1</span><span class="p">)</span>
<span class="c">#=&gt; 5, 2, 3</span>

<span class="n">myfunc</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">mydict2</span><span class="p">)</span>
<span class="c">#=&gt; 5, 2, 4</span>

<span class="n">myfunc</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c">#=&gt; 1, 2, 3</span>

<span class="n">myfunc</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c">#=&gt; 1, 2, 4</span>

<span class="n">myfunc</span><span class="p">(</span><span class="n">mylist</span><span class="p">,</span> <span class="n">mydict1</span><span class="p">)</span>
<span class="c">#=&gt; [1, 2] {&#39;c&#39;: 3, &#39;b&#39;: 2} 4</span>

<span class="c"># For demonstration purposes only - don&#39;t do this</span>
<span class="k">def</span> <span class="nf">mypush</span><span class="p">(</span><span class="n">mylist</span><span class="p">,</span> <span class="o">*</span><span class="n">vals</span><span class="p">):</span>
   <span class="n">mylist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

<span class="n">mylist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">mypush</span><span class="p">(</span><span class="n">mylist</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="k">print</span> <span class="n">mylist</span>
<span class="c">#=&gt; [1, 2, 3, 4, 5]</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN572"
>Handling Exceptions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;some message&quot;</span><span class="p">)</span>  <span class="c"># specific exception class</span>
<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;use me rarely&quot;</span><span class="p">)</span>  <span class="c"># general exception</span>
<span class="k">raise</span> <span class="s">&quot;don&#39;t use me&quot;</span>              <span class="c"># string exception (deprecated)</span>
<span class="c">#-----------------------------</span>
<span class="c"># Note that bare excepts are considered bad style.  Normally you should</span>
<span class="c"># trap specific exceptions.  For instance these bare excepts will</span>
<span class="c"># catch KeyboardInterrupt, SystemExit, and MemoryError as well as</span>
<span class="c"># more common errors.  In addition they force you to import sys to</span>
<span class="c"># get the error message.</span>
<span class="kn">import</span> <span class="nn">warnings</span><span class="o">,</span> <span class="nn">sys</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">func</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;func raised an exception: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
<span class="c">#-----------------------------</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">func</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;func blew up: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
<span class="c">#-----------------------------</span>
<span class="k">class</span> <span class="nc">MoonPhaseError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span>
<span class="k">class</span> <span class="nc">FullMoonError</span><span class="p">(</span><span class="n">MoonPhaseError</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">MoonPhaseError</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="s">&quot;full moon&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">raise</span> <span class="n">FullMoonError</span><span class="p">()</span>

<span class="c"># Ignore only FullMoonError exceptions</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">func</span><span class="p">()</span>
<span class="k">except</span> <span class="n">FullMoonError</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="c">#-----------------------------</span>
<span class="c"># Ignore only MoonPhaseError for a full moon</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">func</span><span class="p">()</span>
<span class="k">except</span> <span class="n">MoonPhaseError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">phase</span> <span class="o">!=</span> <span class="s">&quot;full moon&quot;</span><span class="p">:</span>
        <span class="k">raise</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN575"
>Saving Global Values</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c"># There is no direct equivalent to &#39;local&#39; in Python, and</span>
<span class="c"># it&#39;s impossible to write your own.  But then again, even in</span>
<span class="c"># Perl it&#39;s considered poor style.</span>

<span class="c"># DON&#39;T DO THIS (You probably shouldn&#39;t use global variables anyway):</span>
<span class="k">class</span> <span class="nc">Local</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">globalname</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">globalname</span> <span class="o">=</span> <span class="n">globalname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">globalval</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">globalname</span><span class="p">]</span>
        <span class="nb">globals</span><span class="p">()[</span><span class="n">globalname</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">globals</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">globalname</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">globalval</span>

<span class="n">foo</span> <span class="o">=</span> <span class="mi">4</span>

<span class="k">def</span> <span class="nf">blah</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">foo</span>

<span class="k">def</span> <span class="nf">blech</span><span class="p">():</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">Local</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">blah</span><span class="p">()</span>

<span class="n">blah</span><span class="p">()</span>
<span class="n">blech</span><span class="p">()</span>
<span class="n">blah</span><span class="p">()</span>

<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN578"
>Redefining a Function</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="n">grow</span> <span class="o">=</span> <span class="n">expand</span>
<span class="n">grow</span><span class="p">()</span>                     <span class="c"># calls expand()</span>

<span class="c">#-----------------------------</span>
<span class="n">one</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">two</span><span class="o">.</span><span class="n">table</span>   <span class="c"># make one.var the same as two.table</span>
<span class="n">one</span><span class="o">.</span><span class="n">big</span> <span class="o">=</span> <span class="n">two</span><span class="o">.</span><span class="n">small</span>   <span class="c"># make one.big the same as two.small</span>
<span class="c">#-----------------------------</span>
<span class="n">fred</span> <span class="o">=</span> <span class="n">barney</span>     <span class="c"># alias fred to barney</span>
<span class="c">#-----------------------------</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">red</span><span class="p">(</span><span class="s">&quot;careful here&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">s</span>
<span class="c">#&gt; &lt;FONT COLOR=&#39;red&#39;&gt;careful here&lt;/FONT&gt;</span>
<span class="c">#-----------------------------</span>
<span class="c"># Note: the &#39;text&#39; should be HTML escaped if it can contain</span>
<span class="c"># any of the characters &#39;&lt;&#39;, &#39;&gt;&#39; or &#39;&amp;&#39;</span>
<span class="k">def</span> <span class="nf">red</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;&lt;FONT COLOR=&#39;red&#39;&gt;&quot;</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="s">&quot;&lt;/FONT&gt;&quot;</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">color_font</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;&lt;FONT COLOR=&#39;</span><span class="si">%s</span><span class="s">&#39;&gt;</span><span class="si">%s</span><span class="s">&lt;/FONT&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">red</span><span class="p">(</span><span class="n">text</span><span class="p">):</span> <span class="k">return</span> <span class="n">color_font</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">green</span><span class="p">(</span><span class="n">text</span><span class="p">):</span> <span class="k">return</span> <span class="n">color_font</span><span class="p">(</span><span class="s">&quot;green&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">blue</span><span class="p">(</span><span class="n">text</span><span class="p">):</span> <span class="k">return</span> <span class="n">color_font</span><span class="p">(</span><span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">purple</span><span class="p">(</span><span class="n">text</span><span class="p">):</span> <span class="k">return</span> <span class="n">color_font</span><span class="p">(</span><span class="s">&quot;purple&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span class="c"># etc</span>
<span class="c">#-----------------------------</span>
<span class="c"># This is done in Python by making an object, instead of</span>
<span class="c"># saving state in a local anonymous context.</span>
<span class="k">class</span> <span class="nc">ColorFont</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&lt;FONT COLOR=&#39;</span><span class="si">%s</span><span class="s">&#39;&gt;</span><span class="si">%s</span><span class="s">&lt;/FONT&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="s">&quot;red blue green yellow orange purple violet&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">:</span>
    <span class="nb">globals</span><span class="p">()[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ColorFont</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># If you really don&#39;t want to make a new class, you can</span>
<span class="c"># fake it somewhat by passing in default args.</span>
<span class="n">colors</span> <span class="o">=</span> <span class="s">&quot;red blue green yellow orange purple violet&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">temp</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&lt;FONT COLOR=&#39;</span><span class="si">%s</span><span class="s">&#39;&gt;</span><span class="si">%s</span><span class="s">&lt;/FONT&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="nb">globals</span><span class="p">()[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>

<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN581"
>Trapping Undefined Function Calls with AUTOLOAD</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>
<span class="c"># Python has the ability to derive from ModuleType and add</span>
<span class="c"># new __getattr__ and __setattr__ methods.  I don&#39;t know the</span>
<span class="c"># expected way to use them to emulate Perl&#39;s AUTOLOAD.  Instead,</span>
<span class="c"># here&#39;s how something similar would be done in Python.  This</span>
<span class="c"># uses the ColorFont defined above.</span>

<span class="c">#-----------------------------</span>
<span class="k">class</span> <span class="nc">AnyColor</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ColorFont</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="n">AnyColor</span><span class="p">()</span>

<span class="k">print</span> <span class="n">colors</span><span class="o">.</span><span class="n">chartreuse</span><span class="p">(</span><span class="s">&quot;stuff&quot;</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="c">## Skipping this translation because &#39;local&#39; is too Perl</span>
<span class="c">## specific, and there isn&#39;t enough context to figure out</span>
<span class="c">## what this is supposed to do.</span>
<span class="c">#{</span>
<span class="c">#    local *yellow = \&amp;violet;</span>
<span class="c">#    local (*red, *green) = (\&amp;green, \&amp;red);</span>
<span class="c">#    print_stuff();</span>
<span class="c">#}</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN584"
>Nesting Subroutines</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">outer</span><span class="p">(</span><span class="n">arg1</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">arg1</span> <span class="o">+</span> <span class="mi">35</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">19</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">inner</span><span class="p">()</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN587"
>Program: Sorting Your Mail</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span><span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">mailbox</span><span class="o">,</span> <span class="nn">sys</span>
<span class="n">mbox</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">PortableUnixMailbox</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">extract_data</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="s">&quot;Subject&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">subject</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;re:&quot;</span><span class="p">:</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="n">subject</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">subject</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">text</span>
<span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">extract_data</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mbox</span><span class="p">)]</span>

<span class="c">#-----------------------------</span>
<span class="c"># Sorts by subject then by original position in the list</span>
<span class="k">for</span> <span class="n">subject</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">messages</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="c"># Sorts by subject then date then original position</span>
<span class="k">def</span> <span class="nf">subject_date_position</span><span class="p">(</span><span class="n">elem</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">elem</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">getdate</span><span class="p">(</span><span class="s">&quot;Date&quot;</span><span class="p">),</span> <span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">messages</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">subject_date_position</span><span class="p">)</span>

<span class="c"># Pre 2.4:</span>
<span class="n">messages</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">subject_date_position</span><span class="p">)</span>
<span class="c">#-----------------------------</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="directories.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="referencesandrecords.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Directories</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>References and Records</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>