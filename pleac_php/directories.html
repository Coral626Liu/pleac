<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Directories</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-PHP"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="File Contents"
HREF="filecontents.html"><LINK
REL="NEXT"
TITLE="Subroutines"
HREF="subroutines.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-PHP</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="filecontents.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="subroutines.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DIRECTORIES"
>9. Directories</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN495"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="nv">$entry</span> <span class="o">=</span> <span class="nb">stat</span><span class="p">(</span><span class="s1">&#39;/bin/vi&#39;</span><span class="p">);</span>
<span class="nv">$entry</span> <span class="o">=</span> <span class="nb">stat</span><span class="p">(</span><span class="s1">&#39;/usr/bin&#39;</span><span class="p">);</span>
<span class="nv">$entry</span> <span class="o">=</span> <span class="nb">stat</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

<span class="c1">// ------------</span>

<span class="nv">$entry</span> <span class="o">=</span> <span class="nb">stat</span><span class="p">(</span><span class="s1">&#39;/bin/vi&#39;</span><span class="p">);</span>

<span class="nv">$ctime</span> <span class="o">=</span> <span class="nv">$entry</span><span class="p">[</span><span class="s1">&#39;ctime&#39;</span><span class="p">];</span>
<span class="nv">$size</span> <span class="o">=</span> <span class="nv">$entry</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">];</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// For the simple task of determining whether a file contains, text&#39;, a simple</span>
<span class="c1">// function that searches for a newline could be implemented. Not exactly</span>
<span class="c1">// foolproof, but very simple, low overhead, no installation headaches ...</span>
<span class="k">function</span> <span class="nf">containsText</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$status</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">((</span><span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)))</span>
  <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="k">FALSE</span> <span class="o">!==</span> <span class="p">(</span><span class="nv">$char</span> <span class="o">=</span> <span class="nb">fgetc</span><span class="p">(</span><span class="nv">$fp</span><span class="p">)))</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$char</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$status</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fp</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nv">$status</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// PHP offers the [currently experimental] Fileinfo group of functions to</span>
<span class="c1">// determine file types based on their contents / &#39;magic numbers&#39;. This</span>
<span class="c1">// is functionality similar to the *NIX, &#39;file&#39; utility. Note that it must</span>
<span class="c1">// first be installed using the PEAR utility [see PHP documentation] </span>
<span class="k">function</span> <span class="nf">isTextFile</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Note: untested code, but I believe this is how it is supposed to work</span>
  <span class="nv">$finfo</span> <span class="o">=</span> <span class="nb">finfo_open</span><span class="p">(</span><span class="nx">FILEINFO_NONE</span><span class="p">);</span>
  <span class="nv">$status</span> <span class="o">=</span> <span class="p">(</span><span class="nb">finfo_file</span><span class="p">(</span><span class="nv">$finfo</span><span class="p">,</span> <span class="nv">$file</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ASCII text&#39;</span><span class="p">);</span>
  <span class="nb">finfo_close</span><span class="p">(</span><span class="nv">$finfo</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$status</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Alternatively, use the *NIX utility, &#39;file&#39;, directly</span>
<span class="k">function</span> <span class="nf">isTextFile</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="nb">exec</span><span class="p">(</span><span class="nx">trim</span><span class="p">(</span><span class="s1">&#39;file -bN &#39;</span> <span class="o">.</span> <span class="nb">escapeshellarg</span><span class="p">(</span><span class="nv">$file</span><span class="p">)))</span> <span class="o">==</span> <span class="s1">&#39;ASCII text&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ----</span>

<span class="nx">containsText</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;File </span><span class="si">{</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> doesn&#39;t have any text in it</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="nx">isTextFile</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;File </span><span class="si">{</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> doesn&#39;t have any text in it</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$dirname</span> <span class="o">=</span> <span class="s1">&#39;/usr/bin/&#39;</span><span class="p">;</span>

<span class="p">(</span><span class="nv">$dirhdl</span> <span class="o">=</span> <span class="nb">opendir</span><span class="p">(</span><span class="nv">$dirname</span><span class="p">))</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t open </span><span class="si">{</span><span class="nv">$dirname</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="k">while</span> <span class="p">((</span><span class="nv">$file</span> <span class="o">=</span> <span class="nb">readdir</span><span class="p">(</span><span class="nv">$dirhdl</span><span class="p">))</span> <span class="o">!==</span> <span class="k">FALSE</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Inside %s is something called: %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$dirname</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">closedir</span><span class="p">(</span><span class="nv">$dirhdl</span><span class="p">);</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN498"
>Getting and Setting Timestamps</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="nv">$filename</span> <span class="o">=</span> <span class="s1">&#39;example.txt&#39;</span><span class="p">;</span>

<span class="c1">// Get the file&#39;s current access and modification time, respectively</span>
<span class="nv">$fs</span> <span class="o">=</span> <span class="nb">stat</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>

<span class="nv">$readtime</span> <span class="o">=</span> <span class="nv">$fs</span><span class="p">[</span><span class="s1">&#39;atime&#39;</span><span class="p">];</span>
<span class="nv">$writetime</span> <span class="o">=</span> <span class="nv">$fs</span><span class="p">[</span><span class="s1">&#39;mtime&#39;</span><span class="p">];</span>

<span class="c1">// Alter $writetime, and $readtime ...</span>

<span class="c1">// Update file timestamp</span>
<span class="nb">touch</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$writetime</span><span class="p">,</span> <span class="nv">$readtime</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$filename</span> <span class="o">=</span> <span class="s1">&#39;example.txt&#39;</span><span class="p">;</span>

<span class="c1">// Get the file&#39;s current access and modification time, respectively</span>
<span class="nv">$fs</span> <span class="o">=</span> <span class="nb">stat</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>

<span class="nv">$atime</span> <span class="o">=</span> <span class="nv">$fs</span><span class="p">[</span><span class="s1">&#39;atime&#39;</span><span class="p">];</span>
<span class="nv">$mtime</span> <span class="o">=</span> <span class="nv">$fs</span><span class="p">[</span><span class="s1">&#39;mtime&#39;</span><span class="p">];</span>

<span class="c1">// Dedicated functions also exist to retrieve this information:</span>
<span class="c1">//</span>
<span class="c1">// $atime = $fileatime($filename);</span>
<span class="c1">// $mtime = $filemtime($filename);</span>
<span class="c1">//</span>

<span class="c1">// Perform date arithmetic. Traditional approach where arithmetic is performed</span>
<span class="c1">// directly with Epoch Seconds [i.e. the *NIX time stamp value] will work ...</span>

<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;SECONDS_PER_DAY&#39;</span><span class="p">,</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">);</span>

<span class="c1">// Set file&#39;s access and modification times to 1 week ago</span>
<span class="nv">$atime</span> <span class="o">-=</span> <span class="mi">7</span> <span class="o">*</span> <span class="nx">SECONDS_PER_DAY</span><span class="p">;</span>
<span class="nv">$mtime</span> <span class="o">-=</span> <span class="mi">7</span> <span class="o">*</span> <span class="nx">SECONDS_PER_DAY</span><span class="p">;</span>

<span class="c1">// ... but care must be taken to account for daylight saving. Therefore, the</span>
<span class="c1">// recommended approach is to use library functions to perform such tasks:</span>

<span class="nv">$atime</span> <span class="o">=</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;-7 days&#39;</span><span class="p">,</span> <span class="nv">$atime</span><span class="p">);</span>
<span class="nv">$mtime</span> <span class="o">=</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;-7 days&#39;</span><span class="p">,</span> <span class="nv">$mtime</span><span class="p">);</span>

<span class="c1">// Update file timestamp</span>
<span class="nb">touch</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$mtime</span><span class="p">,</span> <span class="nv">$atime</span><span class="p">);</span>

<span class="c1">// Good idea to clear the cache after such updates have occurred so fresh</span>
<span class="c1">// values will be retrieved on next access</span>
<span class="nb">clearstatcache</span><span class="p">();</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$argc</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;usage: </span><span class="si">{</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> filename</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="nv">$filename</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="nv">$fs</span> <span class="o">=</span> <span class="nb">stat</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>

<span class="nv">$atime</span> <span class="o">=</span> <span class="nv">$fs</span><span class="p">[</span><span class="s1">&#39;atime&#39;</span><span class="p">];</span>
<span class="nv">$mtime</span> <span class="o">=</span> <span class="nv">$fs</span><span class="p">[</span><span class="s1">&#39;mtime&#39;</span><span class="p">];</span>

<span class="c1">// Careful here: since interactive, use, &#39;system&#39;, not &#39;exec&#39;, to launch [latter</span>
<span class="c1">// does not work under *NIX - at least, not for me :)]</span>
<span class="nb">system</span><span class="p">(</span><span class="nx">trim</span><span class="p">(</span><span class="nb">getenv</span><span class="p">(</span><span class="s1">&#39;EDITOR&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39; vi &#39;</span> <span class="o">.</span> <span class="nb">escapeshellarg</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)),</span> <span class="nv">$retcode</span><span class="p">);</span>

<span class="nb">touch</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$mtime</span><span class="p">,</span> <span class="nv">$atime</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Error updating timestamp on file, </span><span class="si">{</span><span class="nv">$filename</span><span class="si">}</span><span class="s2">!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN501"
>Deleting a File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">// The &#39;unlink&#39; function is used to delete regular files, whilst the &#39;rmdir&#39; function</span>
<span class="c1">// does the same on non-empty directories. AFAIK, no recursive-deletion facility</span>
<span class="c1">// exists, and must be manually programmed</span>

<span class="nv">$filename</span> <span class="o">=</span> <span class="s1">&#39;...&#39;</span><span class="p">;</span>

<span class="o">@</span><span class="nb">unlink</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Can&#39;t delete, </span><span class="si">{</span><span class="nv">$filename</span><span class="si">}</span><span class="s2">!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nv">$files</span> <span class="o">=</span> <span class="nb">glob</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">);</span>
<span class="nv">$problem</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span>

<span class="c1">// Could simply use a foreach loop</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$filename</span><span class="p">)</span> <span class="p">{</span> <span class="o">@</span><span class="nb">unlink</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$problem</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span> <span class="p">}</span>

<span class="c1">//</span>
<span class="c1">// Alternatively, an applicative approach could be used, one closer in spirit to</span>
<span class="c1">// largely-functional languages like Scheme</span>
<span class="c1">//</span>
<span class="c1">// function is_all_deleted($deleted, $filename) { return @unlink($filename) &amp;&amp; $deleted; }</span>
<span class="c1">// $problem = !array_reduce($files, &#39;is_all_deleted&#39;, TRUE);</span>
<span class="c1">//</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$problem</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDERR</span><span class="p">,</span> <span class="s1">&#39;Could not delete all of:&#39;</span><span class="p">);</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$filename</span><span class="p">)</span> <span class="p">{</span> <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDERR</span><span class="p">,</span> <span class="s1">&#39; &#39;</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">);</span> <span class="p">}</span>
  <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDERR</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span> <span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span> 

<span class="c1">// ------------</span>

<span class="k">function</span> <span class="nf">rmAll</span><span class="p">(</span><span class="nv">$files</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">foreach</span><span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$filename</span><span class="p">)</span> <span class="p">{</span> <span class="o">@</span><span class="nb">unlink</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$count</span><span class="o">++</span><span class="p">;</span> <span class="p">};</span>

  <span class="k">return</span> <span class="nv">$count</span><span class="p">;</span>

<span class="c1">// An applicative alternative using &#39;create_function&#39;, PHP&#39;s rough equivalent of &#39;lambda&#39; ...</span>
<span class="c1">//</span>
<span class="c1">//  return array_reduce($files,</span>
<span class="c1">//    create_function(&#39;$count, $filename&#39;, &#39;return @unlink($filename) &amp;&amp; $count++;&#39;), 0);</span>
<span class="p">}</span>

<span class="c1">// ----</span>

<span class="nv">$files</span> <span class="o">=</span> <span class="nb">glob</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">);</span>
<span class="nv">$toBeDeleted</span> <span class="o">=</span> <span class="nb">sizeof</span><span class="p">(</span><span class="nv">$files</span><span class="p">);</span>
<span class="nv">$count</span> <span class="o">=</span> <span class="nx">rmAll</span><span class="p">(</span><span class="nv">$files</span><span class="p">);</span>

<span class="p">(</span><span class="nv">$count</span> <span class="o">==</span> <span class="nv">$toBeDeleted</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Could only delete </span><span class="si">{</span><span class="nv">$count</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="nv">$toBeDeleted</span><span class="si">}</span><span class="s2"> files</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN504"
>Copying or Moving a File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="nv">$oldfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/old&#39;</span><span class="p">;</span> <span class="nv">$newfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/new&#39;</span><span class="p">;</span>

<span class="nb">copy</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">,</span> <span class="nv">$newfile</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Error copying file</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// All the following copy a file by copying its contents. Examples do so in a single</span>
<span class="c1">// operation, but it is also possible to copy arbitrary blocks, or, line-by-line in </span>
<span class="c1">// the case of &#39;text&#39; files</span>
<span class="nv">$oldfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/old&#39;</span><span class="p">;</span> <span class="nv">$newfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/new&#39;</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">is_file</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">))</span>
  <span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">,</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">));</span>
<span class="k">else</span>
  <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Problem copying file </span><span class="si">{</span><span class="nv">$oldfile</span><span class="si">}</span><span class="s2"> to file </span><span class="si">{</span><span class="nv">$newfile</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nv">$oldfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/old&#39;</span><span class="p">;</span> <span class="nv">$newfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/new&#39;</span><span class="p">;</span>

<span class="nb">fwrite</span><span class="p">((</span><span class="nv">$nh</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)),</span> <span class="nb">fread</span><span class="p">((</span><span class="nv">$oh</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)),</span> <span class="nb">filesize</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">)));</span>
<span class="nb">fclose</span><span class="p">(</span><span class="nv">$oh</span><span class="p">);</span>
<span class="nb">fclose</span><span class="p">(</span><span class="nv">$nh</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="c1">// As above, but with some error checking / handling</span>
<span class="nv">$oldfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/old&#39;</span><span class="p">;</span> <span class="nv">$newfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/new&#39;</span><span class="p">;</span>

<span class="p">(</span><span class="nv">$oh</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Problem opening input file </span><span class="si">{</span><span class="nv">$oldfile</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">(</span><span class="nv">$nh</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Problem opening output file </span><span class="si">{</span><span class="nv">$newfile</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">((</span><span class="nv">$filesize</span> <span class="o">=</span> <span class="nb">filesize</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$nh</span><span class="p">,</span> <span class="nb">fread</span><span class="p">(</span><span class="nv">$oh</span><span class="p">,</span> <span class="nv">$filesize</span><span class="p">))</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Problem reading / writing file data</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">fclose</span><span class="p">(</span><span class="nv">$oh</span><span class="p">);</span>
<span class="nb">fclose</span><span class="p">(</span><span class="nv">$nh</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Should there be platform-specfic problems copying &#39;very large&#39; files, it is</span>
<span class="c1">// a simple matter to call a system command utility via, &#39;exec&#39;</span>

<span class="c1">// *NIX-specific example. Could check whether, &#39;exec&#39;, succeeded, but checking whether</span>
<span class="c1">// a file exists after the operation might be a better approach</span>
<span class="nv">$oldfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/old&#39;</span><span class="p">;</span> <span class="nv">$newfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/new&#39;</span><span class="p">;</span>

<span class="nb">is_file</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">unlink</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">);</span>

<span class="nb">exec</span><span class="p">(</span><span class="nx">trim</span><span class="p">(</span><span class="s1">&#39;cp --force &#39;</span> <span class="o">.</span> <span class="nb">escapeshellarg</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39; &#39;</span> <span class="o">.</span> <span class="nb">escapeshellarg</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">)));</span>

<span class="nb">is_file</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Problem copying file </span><span class="si">{</span><span class="nv">$oldfile</span><span class="si">}</span><span class="s2"> to file </span><span class="si">{</span><span class="nv">$newfile</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// For other operating systems just change:</span>
<span class="c1">// * filenames</span>
<span class="c1">// * command being &#39;exec&#39;ed</span>
<span class="c1">// as the rest of the code is platform independant</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN507"
>Recognizing Two Names for the Same File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="k">function</span> <span class="nf">makeDevInodePair</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$fs</span> <span class="o">=</span> <span class="o">@</span><span class="nb">stat</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)))</span> <span class="k">return</span> <span class="k">FALSE</span><span class="p">;</span>
  <span class="k">return</span> <span class="nb">strval</span><span class="p">(</span><span class="nv">$fs</span><span class="p">[</span><span class="s1">&#39;dev&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="nv">$fs</span><span class="p">[</span><span class="s1">&#39;ino&#39;</span><span class="p">]);</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="k">function</span> <span class="nf">do_my_thing</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Using a global variable to mimic Perl example, but could easily have passed</span>
  <span class="c1">// &#39;$seen&#39; as an argument</span>
  <span class="k">global</span> <span class="nv">$seen</span><span class="p">;</span>

  <span class="nv">$devino</span> <span class="o">=</span> <span class="nx">makeDevInodePair</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>

  <span class="c1">// Process $filename if it has not previously been seen, else just increment</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$seen</span><span class="p">[</span><span class="nv">$devino</span><span class="p">]))</span>
  <span class="p">{</span>
    <span class="c1">// ... process $filename ...</span>

    <span class="c1">// Set initial count</span>
    <span class="nv">$seen</span><span class="p">[</span><span class="nv">$devino</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="c1">// Otherwise, just increment the count</span>
    <span class="nv">$seen</span><span class="p">[</span><span class="nv">$devino</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ----</span>

<span class="c1">// Simple example</span>
<span class="nv">$seen</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

<span class="nx">do_my_thing</span><span class="p">(</span><span class="s1">&#39;/tmp/old&#39;</span><span class="p">);</span>
<span class="nx">do_my_thing</span><span class="p">(</span><span class="s1">&#39;/tmp/old&#39;</span><span class="p">);</span>
<span class="nx">do_my_thing</span><span class="p">(</span><span class="s1">&#39;/tmp/old&#39;</span><span class="p">);</span>
<span class="nx">do_my_thing</span><span class="p">(</span><span class="s1">&#39;/tmp/new&#39;</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$seen</span> <span class="k">as</span> <span class="nv">$devino</span> <span class="o">=&gt;</span> <span class="nv">$count</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$devino</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="nv">$count</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="c1">// A variation on the above avoiding use of global variables, and illustrating use of</span>
<span class="c1">// easily-implemented &#39;higher order&#39; techniques</span>

<span class="c1">// Helper function loosely modelled on, &#39;array_reduce&#39;, but using an array as</span>
<span class="c1">// &#39;accumulator&#39;, which is returned on completion</span>
<span class="k">function</span> <span class="nf">array_update</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="nv">$lambda</span><span class="p">,</span> <span class="nv">$updarr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nv">$arr</span> <span class="k">as</span> <span class="nv">$key</span><span class="p">)</span> <span class="nv">$lambda</span><span class="p">(</span><span class="nv">$updarr</span><span class="p">,</span> <span class="nv">$key</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$updarr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">do_my_thing</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$seen</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">array_key_exists</span><span class="p">((</span><span class="nv">$devino</span> <span class="o">=</span> <span class="nx">makeDevInodePair</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)),</span> <span class="nv">$seen</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="c1">// ... processing $filename ...</span>

    <span class="c1">// Update $seen</span>
    <span class="nv">$seen</span><span class="p">[</span><span class="nv">$devino</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="c1">// Update $seen</span>
    <span class="nv">$seen</span><span class="p">[</span><span class="nv">$devino</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ----</span>

<span class="c1">// Simple example</span>
<span class="nv">$files</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;/tmp/old&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/old&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/old&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/new&#39;</span><span class="p">);</span>

<span class="c1">// Could do this ...</span>
<span class="nv">$seen</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="nx">array_update</span><span class="p">(</span><span class="nv">$files</span><span class="p">,</span> <span class="s1">&#39;do_my_thing&#39;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$seen</span><span class="p">);</span>

<span class="c1">// or this:</span>
<span class="nv">$seen</span> <span class="o">=</span> <span class="nx">array_update</span><span class="p">(</span><span class="nv">$files</span><span class="p">,</span> <span class="s1">&#39;do_my_thing&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>

<span class="c1">// or a &#39;lambda&#39; could be used:</span>
<span class="nx">array_update</span><span class="p">(</span><span class="nv">$files</span><span class="p">,</span>
             <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$seen, $filename&#39;</span><span class="p">,</span> <span class="s1">&#39;... code not shown ...&#39;</span><span class="p">),</span>
             <span class="o">&amp;</span><span class="nv">$seen</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$seen</span> <span class="k">as</span> <span class="nv">$devino</span> <span class="o">=&gt;</span> <span class="nv">$count</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$devino</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="nv">$count</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$files</span> <span class="o">=</span> <span class="nb">glob</span><span class="p">(</span><span class="s1">&#39;/tmp/*&#39;</span><span class="p">);</span>

<span class="nb">define</span><span class="p">(</span><span class="nx">SEP</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">);</span>
<span class="nv">$seen</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$filename</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">array_key_exists</span><span class="p">((</span><span class="nv">$devino</span> <span class="o">=</span> <span class="nx">makeDevInodePair</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)),</span> <span class="nv">$seen</span><span class="p">))</span>
    <span class="nv">$seen</span><span class="p">[</span><span class="nv">$devino</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$filename</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="nv">$seen</span><span class="p">[</span><span class="nv">$devino</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$seen</span><span class="p">[</span><span class="nv">$devino</span><span class="p">]</span> <span class="o">.</span> <span class="nx">SEP</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$devino</span> <span class="o">=</span> <span class="nb">array_keys</span><span class="p">(</span><span class="nv">$seen</span><span class="p">);</span>
<span class="nb">sort</span><span class="p">(</span><span class="nv">$devino</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$devino</span> <span class="k">as</span> <span class="nv">$key</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="nv">$key</span> <span class="o">.</span> <span class="s1">&#39;:&#39;</span><span class="p">;</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nb">split</span><span class="p">(</span><span class="nx">SEP</span><span class="p">,</span> <span class="nv">$seen</span><span class="p">[</span><span class="nv">$key</span><span class="p">])</span> <span class="k">as</span> <span class="nv">$filename</span><span class="p">)</span> <span class="k">echo</span> <span class="s1">&#39; &#39;</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN510"
>Processing All Files in a Directory</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">// Conventional POSIX-like approach to directory traversal</span>
<span class="nv">$dirname</span> <span class="o">=</span> <span class="s1">&#39;/usr/bin/&#39;</span><span class="p">;</span>

<span class="p">(</span><span class="nv">$dirhdl</span> <span class="o">=</span> <span class="nb">opendir</span><span class="p">(</span><span class="nv">$dirname</span><span class="p">))</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t open </span><span class="si">{</span><span class="nv">$dirname</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="k">while</span> <span class="p">((</span><span class="nv">$file</span> <span class="o">=</span> <span class="nb">readdir</span><span class="p">(</span><span class="nv">$dirhdl</span><span class="p">))</span> <span class="o">!==</span> <span class="k">FALSE</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ... do something with $dirname/$file</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="nb">closedir</span><span class="p">(</span><span class="nv">$dirhdl</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="c1">// Newer [post PHP 4], &#39;applicative&#39; approach - an array of filenames is</span>
<span class="c1">// generated that may be processed via external loop ...</span>

<span class="nv">$dirname</span> <span class="o">=</span> <span class="s1">&#39;/usr/bin/&#39;</span><span class="p">;</span>

<span class="k">foreach</span><span class="p">(</span><span class="nb">scandir</span><span class="p">(</span><span class="nv">$dirname</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ... do something with $dirname/$file</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// .. or, via callback application, perhaps after massaging by one of the</span>
<span class="c1">// &#39;array&#39; family of functions [also uses, &#39;array_update&#39;, from earlier section]</span>

<span class="nv">$newlist</span> <span class="o">=</span> <span class="nx">array_update</span><span class="p">(</span><span class="nb">array_reverse</span><span class="p">(</span><span class="nb">scandir</span><span class="p">(</span><span class="nv">$dirname</span><span class="p">)),</span>
                        <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$filelist, $file&#39;</span><span class="p">,</span>  <span class="s1">&#39; ; &#39;</span><span class="p">),</span>
                        <span class="k">array</span><span class="p">());</span>

<span class="c1">// And don&#39;t forget that the old standby, &#39;glob&#39;, that returns an array of</span>
<span class="c1">// paths filtered using the Bourne Shell-based wildcards, &#39;?&#39; and &#39;*&#39;, is</span>
<span class="c1">// also available</span>

<span class="k">foreach</span><span class="p">(</span><span class="nb">glob</span><span class="p">(</span><span class="nv">$dirname</span> <span class="o">.</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$path</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ... do something with $path</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Uses, &#39;isTextFile&#39;, from an earlier section</span>
<span class="nv">$dirname</span> <span class="o">=</span> <span class="s1">&#39;/usr/bin/&#39;</span><span class="p">;</span>

<span class="k">echo</span> <span class="s2">&quot;Text files in </span><span class="si">{</span><span class="nv">$dirname</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="k">foreach</span><span class="p">(</span><span class="nb">scandir</span><span class="p">(</span><span class="nv">$dirname</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Take care when constructing paths to ensure cross-platform operability </span>
  <span class="nv">$path</span> <span class="o">=</span> <span class="nv">$dirname</span> <span class="o">.</span> <span class="nv">$file</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nb">is_file</span><span class="p">(</span><span class="nv">$path</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isTextFile</span><span class="p">(</span><span class="nv">$path</span><span class="p">))</span> <span class="k">echo</span> <span class="nv">$path</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">plain_files</span><span class="p">(</span><span class="nv">$dirname</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">(</span><span class="nv">$dirlist</span> <span class="o">=</span> <span class="nb">glob</span><span class="p">(</span><span class="nv">$dirname</span> <span class="o">.</span> <span class="s1">&#39;*&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t glob </span><span class="si">{</span><span class="nv">$dirname</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

  <span class="c1">// Pass function name directly if only a single function performs filter test</span>
  <span class="k">return</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$dirlist</span><span class="p">,</span> <span class="s1">&#39;is_file&#39;</span><span class="p">);</span>

  <span class="c1">// Use, &#39;create_function&#39;, if a multi-function test is needed</span>
  <span class="c1">//</span>
  <span class="c1">// return array_filter($dirlist, create_function(&#39;$path&#39;, &#39;return is_file($path);&#39;));</span>
  <span class="c1">//</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="k">foreach</span><span class="p">(</span><span class="nx">plain_files</span><span class="p">(</span><span class="s1">&#39;/tmp/&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$path</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="nv">$path</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN513"
>Globbing, or Getting a List of Filenames Matching a Pattern</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="nv">$dirname</span> <span class="o">=</span> <span class="s1">&#39;/tmp/&#39;</span><span class="p">;</span>

<span class="c1">// Full paths</span>
<span class="nv">$pathlist</span> <span class="o">=</span> <span class="nb">glob</span><span class="p">(</span><span class="nv">$dirname</span> <span class="o">.</span> <span class="s1">&#39;*.c&#39;</span><span class="p">);</span>

<span class="c1">// File names only - glob-based matching</span>
<span class="nv">$filelist</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nb">scandir</span><span class="p">(</span><span class="nv">$dirname</span><span class="p">),</span>
                         <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$file&#39;</span><span class="p">,</span> <span class="s1">&#39;return fnmatch(&quot;*.c&quot;, $file);&#39;</span><span class="p">));</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$dirname</span> <span class="o">=</span> <span class="s1">&#39;/tmp/&#39;</span><span class="p">;</span>

<span class="c1">// File names only - regex-based matching [case-insensitive]</span>
<span class="nv">$filelist</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nb">scandir</span><span class="p">(</span><span class="nv">$dirname</span><span class="p">),</span>
                         <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$file&#39;</span><span class="p">,</span> <span class="s1">&#39;return eregi(&quot;\.[ch]$&quot;, $file);&#39;</span><span class="p">));</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$dirname</span> <span class="o">=</span> <span class="s1">&#39;/tmp/&#39;</span><span class="p">;</span>

<span class="c1">// Directory names - all-digit names</span>
<span class="nv">$dirs</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nb">glob</span><span class="p">(</span><span class="nv">$dirname</span> <span class="o">.</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="nx">GLOB_ONLYDIR</span><span class="p">),</span>
                     <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$path&#39;</span><span class="p">,</span> <span class="s1">&#39;return ereg(&quot;^[0-9]+$&quot;, basename($path));&#39;</span><span class="p">));</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN516"
>Processing All Files in a Directory Recursively</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">// Recursive directory traversal function and helper: traverses a directory tree</span>
<span class="c1">// applying a function [and a variable number of accompanying arguments] to each</span>
<span class="c1">// file</span>

<span class="k">class</span> <span class="nc">Accumulator</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="nv">$value</span><span class="p">;</span>
  <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$start_value</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">value</span> <span class="o">=</span> <span class="nv">$start_value</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="k">function</span> <span class="nf">process_directory_</span><span class="p">(</span><span class="nv">$op</span><span class="p">,</span> <span class="nv">$func_args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$func_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
  <span class="p">{</span>
    <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$func_args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nb">scandir</span><span class="p">(</span><span class="nv">$current</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$entry</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$entry</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span> <span class="o">||</span> <span class="nv">$entry</span> <span class="o">==</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="nv">$func_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$current</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$entry</span><span class="p">;</span>
      <span class="nx">process_directory_</span><span class="p">(</span><span class="nv">$op</span><span class="p">,</span> <span class="nv">$func_args</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="nb">call_user_func_array</span><span class="p">(</span><span class="nv">$op</span><span class="p">,</span> <span class="nv">$func_args</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">process_directory</span><span class="p">(</span><span class="nv">$op</span><span class="p">,</span> <span class="nv">$dir</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">))</span> <span class="k">return</span> <span class="k">FALSE</span><span class="p">;</span>
  <span class="nv">$func_args</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nb">func_get_args</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span>
  <span class="nx">process_directory_</span><span class="p">(</span><span class="nv">$op</span><span class="p">,</span> <span class="nv">$func_args</span><span class="p">);</span>
  <span class="k">return</span> <span class="k">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$dirlist</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;/tmp/d1&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/d2&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/d3&#39;</span><span class="p">);</span>

<span class="c1">// Do something with each directory in the list</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$dirlist</span> <span class="k">as</span> <span class="nv">$dir</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span>
  <span class="c1">// Delete directory [if empty]     -&gt; rmdir($dir); </span>
  <span class="c1">// Make it the &#39;current directory&#39; -&gt; chdir($dir);</span>
  <span class="c1">// Get list of files it contains   -&gt; $filelist = scandir($dir);</span>
  <span class="c1">// Get directory metadata          -&gt; $ds = stat($dir);</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$dirlist</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;/tmp/d1&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/d2&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/d3&#39;</span><span class="p">);</span>

<span class="k">function</span> <span class="nf">pf</span><span class="p">(</span><span class="nv">$path</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// ... do something to the file or directory ...</span>
  <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$path</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// For each directory in the list ...</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$dirlist</span> <span class="k">as</span> <span class="nv">$dir</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Is this a valid directory ?</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">))</span> <span class="p">{</span> <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%s does not exist</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$dir</span><span class="p">);</span> <span class="k">continue</span><span class="p">;</span> <span class="p">}</span>

  <span class="c1">// Ok, so get all the directory&#39;s entries</span>
  <span class="nv">$filelist</span> <span class="o">=</span> <span class="nb">scandir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">);</span>

  <span class="c1">// An &#39;empty&#39; directory will contain at least two entries: &#39;..&#39; and &#39;.&#39;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$filelist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%s is empty</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$dir</span><span class="p">);</span> <span class="k">continue</span><span class="p">;</span> <span class="p">}</span>

  <span class="c1">// For each file / directory in the directory ...</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nv">$filelist</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="c1">// Ignore &#39;..&#39; and &#39;.&#39; entries</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span> <span class="o">||</span> <span class="nv">$file</span> <span class="o">==</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>

    <span class="c1">// Apply function to process the file / directory</span>
    <span class="nx">pf</span><span class="p">(</span><span class="nv">$dir</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$file</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">accum_filesize</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$accum</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nb">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$accum</span><span class="o">-&gt;</span><span class="na">value</span> <span class="o">+=</span> <span class="nb">filesize</span><span class="p">(</span><span class="nv">$file</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="c1">// Verify arguments ...</span>
<span class="nv">$argc</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;usage: </span><span class="si">{</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> dir</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="nv">$dir</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

<span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{</span><span class="nv">$dir</span><span class="si">}</span><span class="s2"> does not exist / not a directory</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// Collect data [use an object to accumulate results]</span>
<span class="nv">$dirsize</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Accumulator</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="nx">process_directory</span><span class="p">(</span><span class="s1">&#39;accum_filesize&#39;</span><span class="p">,</span> <span class="nv">$dir</span><span class="p">,</span> <span class="nv">$dirsize</span><span class="p">);</span> 

<span class="c1">// Report results</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%s contains %d bytes</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$dir</span><span class="p">,</span> <span class="nv">$dirsize</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">biggest_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$accum</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="nv">$fs</span> <span class="o">=</span> <span class="nb">filesize</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$accum</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nv">$fs</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$accum</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">;</span> <span class="nv">$accum</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$fs</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="c1">// Verify arguments ...</span>
<span class="nv">$argc</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;usage: </span><span class="si">{</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> dir</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="nv">$dir</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

<span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{</span><span class="nv">$dir</span><span class="si">}</span><span class="s2"> does not exist / not a directory</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// Collect data [use an object to accumulate results]</span>
<span class="nv">$biggest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Accumulator</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
<span class="nx">process_directory</span><span class="p">(</span><span class="s1">&#39;biggest_file&#39;</span><span class="p">,</span> <span class="nv">$dir</span><span class="p">,</span> <span class="nv">$biggest</span><span class="p">);</span> 

<span class="c1">// Report results</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Biggest file is %s containing %d bytes</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$biggest</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nv">$biggest</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">youngest_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$accum</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="nv">$fct</span> <span class="o">=</span> <span class="nb">filectime</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$accum</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nv">$fct</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$accum</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">;</span> <span class="nv">$accum</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$fct</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="c1">// Verify arguments ...</span>
<span class="nv">$argc</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;usage: </span><span class="si">{</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> dir</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="nv">$dir</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

<span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{</span><span class="nv">$dir</span><span class="si">}</span><span class="s2"> does not exist / not a directory</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// Collect data [use an object to accumulate results]</span>
<span class="nv">$youngest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Accumulator</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">2147483647</span><span class="p">));</span>
<span class="nx">process_directory</span><span class="p">(</span><span class="s1">&#39;youngest_file&#39;</span><span class="p">,</span> <span class="nv">$dir</span><span class="p">,</span> <span class="nv">$youngest</span><span class="p">);</span> 

<span class="c1">// Report results</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Youngest file is %s dating %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$youngest</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">date</span><span class="p">(</span><span class="nx">DATE_ATOM</span><span class="p">,</span> <span class="nv">$youngest</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN519"
>Removing a Directory and Its Contents</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">// AFAICT, there is currently no library function that recursively removes a</span>
<span class="c1">// directory tree [i.e. a directory, it&#39;s subdirectories, and any other files]</span>
<span class="c1">// with a single call. Such a function needs to be custom built. PHP tools</span>
<span class="c1">// with which to do this:</span>
<span class="c1">// * &#39;unlink&#39;, &#39;rmdir&#39;, &#39;is_dir&#39;, and &#39;is_file&#39; functions, will all take care</span>
<span class="c1">//   of the file testing and deletion</span>
<span class="c1">// * Actual directory traversal requires obtaining directory / subdirectory</span>
<span class="c1">//   lists, and here there is much choice available, though care must be taken</span>
<span class="c1">//   as each has it&#39;s own quirks</span>
<span class="c1">//   - &#39;opendir&#39;, &#39;readdir&#39;, &#39;closedir&#39;</span>
<span class="c1">//   - &#39;scandir&#39;</span>
<span class="c1">//   - &#39;glob&#39;</span>
<span class="c1">//   - SPL &#39;directory iterator&#39; classes [newish / experimental - not shown here]</span>
<span class="c1">//</span>
<span class="c1">// The PHP documentation for &#39;rmdir&#39; contains several examples, each illustrating</span>
<span class="c1">// one of each approach; the example shown here is loosely based on one of these</span>
<span class="c1">// examples</span>

<span class="c1">// Recursor - recursively traverses directory tree</span>
<span class="k">function</span> <span class="nf">rmtree_</span><span class="p">(</span><span class="nv">$dir</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">$dir</span><span class="s2">&quot;</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nv">$dh</span> <span class="o">=</span> <span class="nb">opendir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="k">FALSE</span> <span class="o">!==</span> <span class="p">(</span><span class="nv">$item</span> <span class="o">=</span> <span class="nb">readdir</span><span class="p">(</span><span class="nv">$dh</span><span class="p">)))</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$item</span> <span class="o">!=</span> <span class="s1">&#39;.&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$item</span> <span class="o">!=</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="nv">$subdir</span> <span class="o">=</span> <span class="nv">$dir</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="si">$item</span><span class="s2">&quot;</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$subdir</span><span class="p">))</span> <span class="nx">rmtree_</span><span class="p">(</span><span class="nv">$subdir</span><span class="p">);</span>
        <span class="k">else</span> <span class="o">@</span><span class="nb">unlink</span><span class="p">(</span><span class="nv">$subdir</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="nb">closedir</span><span class="p">(</span><span class="nv">$dh</span><span class="p">);</span> <span class="o">@</span><span class="nb">rmdir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Launcher - performs validation then starts recursive routine</span>
<span class="k">function</span> <span class="nf">rmtree</span><span class="p">(</span><span class="nv">$dir</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$dir</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$dir</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$dir</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
    <span class="nx">rmtree_</span><span class="p">(</span><span class="nv">$dir</span><span class="p">);</span> <span class="k">return</span> <span class="o">!</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="k">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$argc</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;usage: rmtree dir</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="nx">rmtree</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Could not remove directory </span><span class="si">{</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN522"
>Renaming Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="nv">$filepairs</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;x.txt&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;x2.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;y.txt&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;y.doc&#39;</span><span class="p">,</span> <span class="s1">&#39;zxc.txt&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;cxz.txt&#39;</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$filepairs</span> <span class="k">as</span> <span class="nv">$oldfile</span> <span class="o">=&gt;</span> <span class="nv">$newfile</span><span class="p">)</span>
<span class="p">{</span>
  <span class="o">@</span><span class="nb">rename</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">,</span> <span class="nv">$newfile</span><span class="p">)</span> <span class="o">||</span> <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDERR</span><span class="p">,</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;Could not rename %s to %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$oldfile</span><span class="p">,</span> <span class="nv">$newfile</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Call a system command utility via, &#39;exec&#39;. *NIX-specific example. Could check whether,</span>
<span class="c1">// &#39;exec&#39;, succeeded, but checking whether a renamed file exists after the operation might</span>
<span class="c1">// be a better approach</span>

<span class="nv">$oldfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/old&#39;</span><span class="p">;</span> <span class="nv">$newfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/new&#39;</span><span class="p">;</span>

<span class="nb">is_file</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">unlink</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">);</span>

<span class="nb">exec</span><span class="p">(</span><span class="nx">trim</span><span class="p">(</span><span class="s1">&#39;mv --force &#39;</span> <span class="o">.</span> <span class="nb">escapeshellarg</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39; &#39;</span> <span class="o">.</span> <span class="nb">escapeshellarg</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">)));</span>

<span class="nb">is_file</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Problem renaming file </span><span class="si">{</span><span class="nv">$oldfile</span><span class="si">}</span><span class="s2"> to file </span><span class="si">{</span><span class="nv">$newfile</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// For other operating systems just change:</span>
<span class="c1">// * filenames</span>
<span class="c1">// * command being &#39;exec&#39;ed</span>
<span class="c1">// as the rest of the code is platform independant</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// A modified implementation of Larry&#39;s Filename Fixer. Rather than passing</span>
<span class="c1">// a single expression, a &#39;from&#39; regexp is passed; each match in the file</span>
<span class="c1">// name(s) is changed to the value of &#39;to&#39;. It otherwise behaves the same</span>
<span class="c1">//</span>

<span class="nv">$argc</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;usage: rename from to [file ...]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="nv">$from</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="nv">$to</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> 

<span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">((</span><span class="nv">$argv</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$argv</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">))</span> <span class="nv">$argv</span><span class="p">[]</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nb">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$argv</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$was</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">;</span>
  <span class="nv">$file</span> <span class="o">=</span> <span class="nb">ereg_replace</span><span class="p">(</span><span class="nv">$from</span><span class="p">,</span> <span class="nv">$to</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nb">strcmp</span><span class="p">(</span><span class="nv">$was</span><span class="p">,</span> <span class="nv">$file</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="o">@</span><span class="nb">rename</span><span class="p">(</span><span class="nv">$was</span><span class="p">,</span> <span class="nv">$file</span><span class="p">)</span> <span class="o">||</span> <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDERR</span><span class="p">,</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;Could not rename %s to %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$was</span><span class="p">,</span> <span class="nv">$file</span><span class="p">));</span>
<span class="p">}</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN525"
>Splitting a Filename into Its Component Parts</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="nv">$base</span> <span class="o">=</span> <span class="nb">basename</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>
<span class="nv">$dir</span> <span class="o">=</span> <span class="nb">dirname</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>

<span class="c1">// PHP&#39;s equivalent to Perl&#39;s &#39;fileparse&#39;</span>
<span class="nv">$pathinfo</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>

<span class="nv">$base</span> <span class="o">=</span> <span class="nv">$pathinfo</span><span class="p">[</span><span class="s1">&#39;basename&#39;</span><span class="p">];</span>
<span class="nv">$dir</span> <span class="o">=</span> <span class="nv">$pathinfo</span><span class="p">[</span><span class="s1">&#39;dirname&#39;</span><span class="p">];</span>
<span class="nv">$ext</span> <span class="o">=</span> <span class="nv">$pathinfo</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">];</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$path</span> <span class="o">=</span> <span class="s1">&#39;/usr/lib/libc.a&#39;</span><span class="p">;</span>

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;dir is %s, file is %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">dirname</span><span class="p">(</span><span class="nv">$path</span><span class="p">),</span> <span class="nb">basename</span><span class="p">(</span><span class="nv">$path</span><span class="p">));</span>

<span class="c1">// ------------</span>

<span class="nv">$path</span> <span class="o">=</span> <span class="s1">&#39;/usr/lib/libc.a&#39;</span><span class="p">;</span>

<span class="nv">$pathinfo</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;dir is %s, name is %s, extension is %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$pathinfo</span><span class="p">[</span><span class="s1">&#39;dirname&#39;</span><span class="p">],</span> <span class="nv">$pathinfo</span><span class="p">[</span><span class="s1">&#39;basename&#39;</span><span class="p">],</span> <span class="nv">$pathinfo</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">]);</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Handle Mac example as a simple parse task. However, AFAIK, &#39;pathinfo&#39; is cross-platform,</span>
<span class="c1">// so should handle file path format differences transparently</span>
<span class="nv">$path</span> <span class="o">=</span> <span class="s1">&#39;Hard%20Drive:System%20Folder:README.txt&#39;</span><span class="p">;</span>

<span class="nv">$macp</span> <span class="o">=</span> <span class="nb">array_combine</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;drive&#39;</span><span class="p">,</span> <span class="s1">&#39;folder&#39;</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">),</span> <span class="nb">split</span><span class="p">(</span><span class="s2">&quot;\:&quot;</span><span class="p">,</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;%20&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nv">$path</span><span class="p">)));</span>
<span class="nv">$macf</span> <span class="o">=</span> <span class="nb">array_combine</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;extension&#39;</span><span class="p">),</span> <span class="nb">split</span><span class="p">(</span><span class="s2">&quot;\.&quot;</span><span class="p">,</span> <span class="nv">$macp</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]));</span> 

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;dir is %s, name is %s, extension is %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nv">$macp</span><span class="p">[</span><span class="s1">&#39;drive&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;:&#39;</span> <span class="o">.</span> <span class="nv">$macp</span><span class="p">[</span><span class="s1">&#39;folder&#39;</span><span class="p">]),</span> <span class="nv">$macf</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="p">(</span><span class="s1">&#39;.&#39;</span> <span class="o">.</span> <span class="nv">$macf</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">]));</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Not really necessary since we have, &#39;pathinfo&#39;, but better matches Perl example</span>
<span class="k">function</span> <span class="nf">file_extension</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$separator</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="nb">end</span><span class="p">(</span><span class="nb">split</span><span class="p">((</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">.</span> <span class="nv">$separator</span><span class="p">),</span> <span class="nv">$filename</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// ----</span>

<span class="k">echo</span> <span class="nx">file_extension</span><span class="p">(</span><span class="s1">&#39;readme.txt&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN528"
>Program: symirror</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">// @@INCOMPLETE@@</span>
<span class="c1">// @@INCOMPLETE@@</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN531"
>Program: lst</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">// @@INCOMPLETE@@</span>
<span class="c1">// @@INCOMPLETE@@</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="filecontents.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="subroutines.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>File Contents</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Subroutines</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>