<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=latin1">
  <style type="text/css">
td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }
body .hll { background-color: #ffffcc }
body  { background: #f8f8f8; }
body .c { color: #408080; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #008000; font-weight: bold } /* Keyword */
body .o { color: #666666 } /* Operator */
body .cm { color: #408080; font-style: italic } /* Comment.Multiline */
body .cp { color: #BC7A00 } /* Comment.Preproc */
body .c1 { color: #408080; font-style: italic } /* Comment.Single */
body .cs { color: #408080; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #FF0000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #00A000 } /* Generic.Inserted */
body .go { color: #888888 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #008000 } /* Keyword.Pseudo */
body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #BA2121 } /* Literal.String */
body .na { color: #7D9029 } /* Name.Attribute */
body .nb { color: #008000 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #999999; font-weight: bold } /* Name.Entity */
body .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #A0A000 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #19177C } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sb { color: #BA2121 } /* Literal.String.Backtick */
body .sc { color: #BA2121 } /* Literal.String.Char */
body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #BA2121 } /* Literal.String.Double */
body .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #BA2121 } /* Literal.String.Heredoc */
body .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #BB6688 } /* Literal.String.Regex */
body .s1 { color: #BA2121 } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #008000 } /* Name.Builtin.Pseudo */
body .vc { color: #19177C } /* Name.Variable.Class */
body .vg { color: #19177C } /* Name.Variable.Global */
body .vi { color: #19177C } /* Name.Variable.Instance */
body .il { color: #666666 } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><pre><span class="x"># -*- php -*-</span>
<span class="x"># The examples are taken from the Perl Cookbook</span>
<span class="x"># By Tom Christiansen &amp; Nathan Torkington</span>
<span class="x"># see http://www.oreilly.com/catalog/cookbook for more</span>

<span class="x"># @@PLEAC@@_NAME</span>
<span class="x"># @@SKIP@@ PHP</span>

<span class="x"># @@PLEAC@@_WEB</span>
<span class="x"># @@SKIP@@ http://php.net/</span>

<span class="x"># @@PLEAC@@_1.0</span>
<span class="x">#-----------------------------</span>
<span class="x">$string = &#39;\n&#39;;                     # two characters, \ and an n</span>
<span class="x">$string = &#39;Jon \&#39;Maddog\&#39; Orwant&#39;;  # literal single quotes</span>
<span class="x">$string = &#39;Jon &quot;Maddog&quot; Orwant&#39;;    # literal double quotes</span>
<span class="x">#-----------------------------</span>
<span class="x">$string = &quot;\n&quot;;                     # a &quot;newline&quot; character</span>
<span class="x">$string = &quot;Jon \&quot;Maddog\&quot; Orwant&quot;;  # literal double quotes</span>
<span class="x">$string = &quot;Jon &#39;Maddog&#39; Orwant&quot;;    # literal single quotes</span>
<span class="x">#-----------------------------</span>
<span class="x">$a = </span>
<span class="x">&quot;This is a multiline</span>
<span class="x">here document&quot;;</span>

<span class="x">$a = &lt;&lt;&lt;EOF</span>
<span class="x">This is a multiline here document</span>
<span class="x">terminated by EOF on a line by itself</span>
<span class="x">EOF;</span>
<span class="x">#-----------------------------</span>

<span class="x"># @@PLEAC@@_1.1</span>
<span class="x">#-----------------------------</span>
<span class="x">$value = substr($string, $offset, $count);</span>
<span class="x">$value = substr($string, $offset);</span>

<span class="x">$string = substr_replace($string, $newstring, $offset, $count);</span>
<span class="x">$string = substr_replace($string, $newtail, $offset);</span>
<span class="x">#-----------------------------</span>
<span class="x"># get a 5-byte string, skip 3, then grab 2 8-byte strings, then the rest</span>
<span class="x">list($leading, $s1, $s2, $trailing) =</span>
<span class="x">    array_values(unpack(&quot;A5a/x3/A8b/A8c/A*d&quot;, $data);</span>

<span class="x"># split at five byte boundaries</span>
<span class="x">preg_match_all (&quot;/.{5}/&quot;, $data, $f, PREG_PATTERN_ORDER);</span>
<span class="x">$fivers = $f[0];</span>

<span class="x"># chop string into individual characters</span>
<span class="x">$chars  = $string;</span>
<span class="x">#-----------------------------</span>
<span class="x">$string = &quot;This is what you have&quot;;</span>
<span class="x">#         +012345678901234567890  Indexing forwards  (left to right)</span>
<span class="x">#          109876543210987654321- Indexing backwards (right to left)</span>
<span class="x">#           note that 0 means 10 or 20, etc. above</span>

<span class="x">$first  = substr($string, 0, 1);  # &quot;T&quot;</span>
<span class="x">$start  = substr($string, 5, 2);  # &quot;is&quot;</span>
<span class="x">$rest   = substr($string, 13);    # &quot;you have&quot;</span>
<span class="x">$last   = substr($string, -1);    # &quot;e&quot;</span>
<span class="x">$end    = substr($string, -4);    # &quot;have&quot;</span>
<span class="x">$piece  = substr($string, -8, 3); # &quot;you&quot;</span>
<span class="x">#-----------------------------</span>
<span class="x">$string = &quot;This is what you have&quot;;</span>
<span class="x">print $string;</span>
<span class="x">#This is what you have</span>

<span class="x">$string = substr_replace($string, &quot;wasn&#39;t&quot;, 5, 2);  # change &quot;is&quot; to &quot;wasn&#39;t&quot;</span>
<span class="x">#This wasn&#39;t what you have</span>

<span class="x">$string = substr_replace($string, &quot;ondrous&quot;, -12);  # &quot;This wasn&#39;t wondrous&quot;</span>
<span class="x">#This wasn&#39;t wondrous</span>

<span class="x">$string = substr_replace($string, &quot;&quot;, 0, 1);        # delete first character</span>
<span class="x">#his wasn&#39;t wondrous</span>

<span class="x">$string = substr_replace($string, &quot;&quot;, -10);         # delete last 10 characters</span>
<span class="x">#his wasn&#39;</span>
<span class="x">#-----------------------------</span>
<span class="x">if (preg_match(&quot;/pattern/&quot;, substr($string, -10)) {</span>
<span class="x">    print &quot;Pattern matches in last 10 characters\n&quot;;</span>
<span class="x">}</span>

<span class="x"># substitute &quot;at&quot; for &quot;is&quot;, restricted to first five characters</span>
<span class="x">$string=(substr_replace(preg_replace(&quot;/is/&quot;, &quot;at&quot;, substr($string,0,5)),0,5);</span>
<span class="x">#-----------------------------</span>
<span class="x"># exchange the first and last letters in a string</span>
<span class="x">$a = &quot;make a hat&quot;;</span>
<span class="x">list($a[0], $a[strlen($a)-1]) = Array(substr($a,-1), substr($a,0,1));</span>
<span class="x">print $a;</span>

<span class="x">#-----------------------------</span>
<span class="x"># extract column with unpack</span>
<span class="x">$a = &quot;To be or not to be&quot;;</span>
<span class="x">$b = unpack(&quot;x6/A6a&quot;, $a);  # skip 6, grab 6</span>
<span class="x">print $b[&#39;a&#39;];</span>


<span class="x">$b = unpack(&quot;x6/A2b/X5/A2c&quot;, $a); # forward 6, grab 2; backward 5, grab 2</span>
<span class="x">print $b[&#39;b&#39;].&quot;\n&quot;.$b[&#39;c&#39;].&quot;\n&quot;;</span>

<span class="x">#-----------------------------</span>
<span class="x">function cut2fmt() {</span>
<span class="x">    $positions = func_get_args();</span>
<span class="x">    $template  = &#39;&#39;;</span>
<span class="x">    $lastpos   = 1;</span>
<span class="x">    foreach($positions as $place) {</span>
<span class="x">        $template .= &quot;A&quot; . ($place - $lastpos) . &quot; &quot;;</span>
<span class="x">        $lastpos   = $place;</span>
<span class="x">    }</span>
<span class="x">    $template .= &quot;A*&quot;;</span>
<span class="x">    return $template;</span>
<span class="x">}</span>

<span class="x">$fmt = cut2fmt(8, 14, 20, 26, 30);</span>
<span class="x">print &quot;$fmt\n&quot;;</span>
<span class="x">#A7 A6 A6 A6 A4 A*</span>
<span class="x">#-----------------------------</span>

<span class="x"># @@PLEAC@@_1.2</span>
<span class="x">#-----------------------------</span>
<span class="x"># use $b if $b is true, else $c</span>
<span class="x">$a = $b?$b:$c;</span>

<span class="x"># set $x to $y unless $x is already true</span>
<span class="x">$x || $x=$y;</span>
<span class="x">#-----------------------------</span>
<span class="x"># use $b if $b is defined, else $c</span>
<span class="x">$a = defined($b) ? $b : $c;</span>
<span class="x">#-----------------------------</span>
<span class="x">$foo = $bar || $foo = &quot;DEFAULT VALUE&quot;;</span>
<span class="x">#-----------------------------</span>
<span class="x">$dir = array_shift($_SERVER[&#39;argv&#39;]) || $dir = &quot;/tmp&quot;;</span>
<span class="x">#-----------------------------</span>
<span class="x">$dir = $_SERVER[&#39;argv&#39;][0] || $dir = &quot;/tmp&quot;;</span>
<span class="x">#-----------------------------</span>
<span class="x">$dir = defined($_SERVER[&#39;argv&#39;][0]) ? array_shift($_SERVER[&#39;argv&#39;]) : &quot;/tmp&quot;;</span>
<span class="x">#-----------------------------</span>
<span class="x">$dir = count($_SERVER[&#39;argv&#39;]) ? $_SERVER[&#39;argv&#39;][0] : &quot;/tmp&quot;;</span>
<span class="x">#-----------------------------</span>
<span class="x">$count[$shell?$shell:&quot;/bin/sh&quot;]++;</span>
<span class="x">#-----------------------------</span>
<span class="x"># find the user name on Unix systems</span>
<span class="x">$user = $_ENV[&#39;USER&#39;]</span>
<span class="x">     || $user = $_ENV[&#39;LOGNAME&#39;]</span>
<span class="x">     || $user = posix_getlogin()</span>
<span class="x">     || $user = posix_getpwuid(posix_getuid())[0]</span>
<span class="x">     || $user = &quot;Unknown uid number $&lt;&quot;;</span>
<span class="x">#-----------------------------</span>
<span class="x">$starting_point || $starting_point = &quot;Greenwich&quot;;</span>
<span class="x">#-----------------------------</span>
<span class="x">count($a) || $a = $b;          # copy only if empty</span>
<span class="x">$a = count($b) ? $b : $c;          # assign @b if nonempty, else @c</span>
<span class="x">#-----------------------------</span>

<span class="x"># @@PLEAC@@_1.3</span>
<span class="x">#-----------------------------</span>
<span class="x">list($VAR1, $VAR2) = array($VAR2, $VAR1);</span>
<span class="x">#-----------------------------</span>
<span class="x">$temp    = $a;</span>
<span class="x">$a       = $b;</span>
<span class="x">$b       = $temp;</span>
<span class="x">#-----------------------------</span>
<span class="x">$a       = &quot;alpha&quot;;</span>
<span class="x">$b       = &quot;omega&quot;;</span>
<span class="x">list($a, $b) = array($b, $a);        # the first shall be last -- and versa vice</span>
<span class="x">#-----------------------------</span>
<span class="x">list($alpha, $beta, $production) = Array(&quot;January&quot;,&quot;March&quot;,&quot;August&quot;);</span>
<span class="x"># move beta       to alpha,</span>
<span class="x"># move production to beta,</span>
<span class="x"># move alpha      to production</span>
<span class="x">list($alpha, $beta, $production) = array($beta, $production, $alpha);</span>
<span class="x">#-----------------------------</span>

<span class="x"># @@PLEAC@@_1.4</span>
<span class="x">#-----------------------------</span>
<span class="x">$num  = ord($char);</span>
<span class="x">$char = chr($num);</span>
<span class="x">#-----------------------------</span>
<span class="x">$char = sprintf(&quot;%c&quot;, $num);                # slower than chr($num)</span>
<span class="x">printf(&quot;Number %d is character %c\n&quot;, $num, $num);</span>
<span class="x">#-----------------------------</span>
<span class="x">$ASCII = unpack(&quot;C*&quot;, $string);</span>
<span class="x">eval(&#39;$STRING = pack(&quot;C*&quot;, &#39;.implode(&#39;,&#39;,$ASCII).&#39;);&#39;);</span>
<span class="x">#-----------------------------</span>
<span class="x">$ascii_value = ord(&quot;e&quot;);    # now 101</span>
<span class="x">$character   = chr(101);    # now &quot;e&quot;</span>
<span class="x">#-----------------------------</span>
<span class="x">printf(&quot;Number %d is character %c\n&quot;, 101, 101);</span>
<span class="x">#-----------------------------</span>
<span class="x">$ascii_character_numbers = unpack(&quot;C*&quot;, &quot;sample&quot;);</span>
<span class="x">print explode(&quot; &quot;,$ascii_character_numbers).&quot;\n&quot;;</span>

<span class="x">eval(&#39;$word = pack(&quot;C*&quot;, &#39;.implode(&#39;,&#39;,$ascii_character_numbers).&#39;);&#39;);</span>
<span class="x">$word = pack(&quot;C*&quot;, 115, 97, 109, 112, 108, 101);   # same</span>
<span class="x">print &quot;$word\n&quot;;</span>
<span class="x">#-----------------------------</span>
<span class="x">$hal = &quot;HAL&quot;;</span>
<span class="x">$ascii = unpack(&quot;C*&quot;, $hal);</span>
<span class="x">foreach ($ascii as $val) {</span>
<span class="x">    $val++;                 # add one to each ASCII value</span>
<span class="x">}</span>
<span class="x">eval(&#39;$ibm = pack(&quot;C*&quot;, &#39;.implode(&#39;,&#39;,$ascii).&#39;);&#39;);</span>
<span class="x">print &quot;$ibm\n&quot;;             # prints &quot;IBM&quot;</span>
<span class="x">#-----------------------------</span>

<span class="x"># @@PLEAC@@_1.5</span>
<span class="x">#-----------------------------</span>
<span class="x">// using perl regexp</span>
<span class="x">$array = preg_split(&#39;//&#39;, $string ,-1, PREG_SPLIT_NO_EMPTY);</span>
<span class="x">// using PHP function: $array = str_split($string);</span>

<span class="x">// Cannot use unpack with a format of &#39;U*&#39; in PHP.</span>
<span class="x">#-----------------------------</span>
<span class="x">for ($offset = 0; preg_match(&#39;/(.)/&#39;, $string, $matches, 0, $offset) &gt; 0; $offset++) {</span>
<span class="x">    // $matches[1] has charcter, ord($matches[1]) its number</span>
<span class="x">}</span>
<span class="x">#-----------------------------</span>
<span class="x">$seen = array();</span>
<span class="x">$string = &quot;an apple a day&quot;;</span>
<span class="x">foreach (str_split($string) as $char) {</span>
<span class="x">    $seen[$char] = 1;</span>
<span class="x">}</span>
<span class="x">$keys = array_keys($seen);</span>
<span class="x">sort($keys);</span>
<span class="x">print &quot;unique chars are: &quot; . implode(&#39;&#39;, $keys)) . &quot;\n&quot;;</span>
<span class="x">unique chars are:  adelnpy</span>
<span class="x">#-----------------------------</span>
<span class="x">$seen = array();</span>
<span class="x">$string = &quot;an apple a day&quot;;</span>
<span class="x">for ($offset = 0; preg_match(&#39;/(.)/&#39;, $string, $matches, 0, $offset) &gt; 0; $offset++) {</span>
<span class="x">    $seen[$matches[1]] = 1;</span>
<span class="x">}</span>
<span class="x">$keys = array_keys($seen);</span>
<span class="x">sort($keys);</span>
<span class="x">print &quot;unique chars are: &quot; . implode(&#39;&#39;, $keys) . &quot;\n&quot;;</span>
<span class="x">unique chars are:  adelnpy</span>
<span class="x">#-----------------------------</span>
<span class="x">$sum = 0;</span>
<span class="x">foreach (unpack(&quot;C*&quot;, $string) as $byteval) {</span>
<span class="x">    $sum += $byteval;</span>
<span class="x">}</span>
<span class="x">print &quot;sum is $sum\n&quot;;</span>
<span class="x">// prints &quot;1248&quot; if $string was &quot;an apple a day&quot;</span>
<span class="x">#-----------------------------</span>
<span class="x">$sum = array_sum(unpack(&quot;C*&quot;, $string));</span>
<span class="x">#-----------------------------</span>

<span class="x">// sum - compute 16-bit checksum of all input files</span>
<span class="x">$handle = @fopen($argv[1], &#39;r&#39;);</span>
<span class="x">$checksum = 0;</span>
<span class="x">while (!feof($handle)) {</span>
<span class="x">    $checksum += (array_sum(unpack(&quot;C*&quot;, fgets($handle))));</span>
<span class="x">}</span>
<span class="x">$checksum %= pow(2,16) - 1;</span>
<span class="x">print &quot;$checksum\n&quot;;</span>

<span class="x"># <font size="-1"><a href="http://pleac.sourceforge.net/include/php/slowcat.php</span>">download the following standalone program</a></font>
<span class="x">#!/usr/bin/php</span>
<span class="cp">&lt;?php</span>
<span class="c1">// slowcat - emulate a   s l o w   line printer</span>
<span class="c1">// usage: php slowcat.php [-DELAY] file</span>
<span class="nv">$delay</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/(.)/&#39;</span><span class="p">,</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nv">$matches</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$delay</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="nb">array_shift</span><span class="p">(</span><span class="nv">$argv</span><span class="p">);</span>
<span class="p">};</span>
<span class="nv">$handle</span> <span class="o">=</span> <span class="o">@</span><span class="nb">fopen</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">);</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$handle</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nb">str_split</span><span class="p">(</span><span class="nb">fgets</span><span class="p">(</span><span class="nv">$handle</span><span class="p">))</span> <span class="k">as</span> <span class="nv">$char</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">print</span> <span class="nv">$char</span><span class="p">;</span>
        <span class="nb">usleep</span><span class="p">(</span><span class="mi">5000</span> <span class="o">*</span> <span class="nv">$delay</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">#-----------------------------</span>

<span class="c1"># @@PLEAC@@_1.6</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$revchars</span> <span class="o">=</span> <span class="nb">strrev</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$revwords</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="nb">array_reverse</span><span class="p">(</span><span class="nb">explode</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">)));</span>
<span class="c1">#-----------------------------</span>
<span class="c1">// reverse word order</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="s1">&#39;Yoda said, &quot;can you see this?&quot;&#39;</span><span class="p">;</span>
<span class="nv">$allwords</span>    <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>
<span class="nv">$revwords</span>    <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="nb">array_reverse</span><span class="p">(</span><span class="nv">$allwords</span><span class="p">));</span>
<span class="k">print</span> <span class="nv">$revwords</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">this</span><span class="o">?</span><span class="s2">&quot; see you &quot;</span><span class="nx">can</span> <span class="nx">said</span><span class="p">,</span> <span class="nx">Yoda</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$revwords</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="nb">array_reverse</span><span class="p">(</span><span class="nb">explode</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">)));</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$revwords</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="nb">array_reverse</span><span class="p">(</span><span class="nb">preg_split</span><span class="p">(</span><span class="s2">&quot;/(\s+)/&quot;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">)));</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$word</span> <span class="o">=</span> <span class="s2">&quot;reviver&quot;</span><span class="p">;</span>
<span class="nv">$is_palindrome</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$word</span> <span class="o">===</span> <span class="nb">strrev</span><span class="p">(</span><span class="nv">$word</span><span class="p">));</span>
<span class="c1">#-----------------------------</span>
<span class="c1">// quite a one-liner since &quot;php&quot; does not have a -n switch</span>
<span class="o">%</span> <span class="nx">php</span> <span class="o">-</span><span class="nx">r</span> <span class="s1">&#39;while (!feof(STDIN)) { $word = rtrim(fgets(STDIN)); if ($word == strrev($word) &amp;&amp; strlen($word) &gt; 5) print $word; }&#39;</span> <span class="o">&lt;</span> <span class="o">/</span><span class="nx">usr</span><span class="o">/</span><span class="nx">dict</span><span class="o">/</span><span class="nx">words</span>
<span class="c1">#-----------------------------</span>

<span class="c1"># @@PLEAC@@_1.8</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$text</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/\$(\w+)/e&#39;</span><span class="p">,</span> <span class="s1">&#39;$$1&#39;</span><span class="p">,</span> <span class="nv">$text</span><span class="p">);</span>
<span class="c1">#-----------------------------</span>
<span class="k">list</span><span class="p">(</span><span class="nv">$rows</span><span class="p">,</span> <span class="nv">$cols</span><span class="p">)</span> <span class="o">=</span> <span class="k">Array</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">80</span><span class="p">);</span>
<span class="nv">$text</span> <span class="o">=</span> <span class="s1">&#39;I am $rows high and $cols long&#39;</span><span class="p">;</span>
<span class="nv">$text</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/\$(\w+)/e&#39;</span><span class="p">,</span> <span class="s1">&#39;$$1&#39;</span><span class="p">,</span> <span class="nv">$text</span><span class="p">);</span>
<span class="k">print</span> <span class="nv">$text</span><span class="p">;</span>

<span class="c1">#-----------------------------</span>
<span class="nv">$text</span> <span class="o">=</span> <span class="s2">&quot;I am 17 years old&quot;</span><span class="p">;</span>
<span class="nv">$text</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/(\d+)/e&#39;</span><span class="p">,</span> <span class="s1">&#39;2*$1&#39;</span><span class="p">,</span> <span class="nv">$text</span><span class="p">);</span>
<span class="c1">#-----------------------------</span>
<span class="c1"># expand variables in $text, but put an error message in</span>
<span class="c1"># if the variable isn&#39;t defined</span>
<span class="nv">$text</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/\$(\w+)/e&#39;</span><span class="p">,</span><span class="s1">&#39;isset($$1)?$$1:\&#39;[NO VARIABLE: $$1]\&#39;&#39;</span><span class="p">,</span> <span class="nv">$text</span><span class="p">);</span>
<span class="c1">#-----------------------------</span>

<span class="c1">// As PHP arrays are used as hashes too, separation of section 4</span>
<span class="c1">// and section 5 makes little sense.</span>

<span class="c1"># @@PLEAC@@_1.9</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$big</span> <span class="o">=</span> <span class="nx">strtoupper</span><span class="p">(</span><span class="nv">$little</span><span class="p">);</span>
<span class="nv">$little</span> <span class="o">=</span> <span class="nx">strtolower</span><span class="p">(</span><span class="nv">$big</span><span class="p">);</span>
<span class="c1">// PHP does not have the\L and\U string escapes.</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$big</span> <span class="o">=</span> <span class="nx">ucfirst</span><span class="p">(</span><span class="nv">$little</span><span class="p">);</span>
<span class="nv">$little</span> <span class="o">=</span> <span class="nx">strtolower</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$big</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">.</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$big</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$beast</span>   <span class="o">=</span> <span class="s2">&quot;dromedary&quot;</span><span class="p">;</span>
<span class="c1">// capitalize various parts of $beast</span>
<span class="nv">$capit</span>   <span class="o">=</span> <span class="nx">ucfirst</span><span class="p">(</span><span class="nv">$beast</span><span class="p">);</span> <span class="c1">// Dromedar</span>
<span class="c1">// PHP does not have the\L and\U string escapes.</span>
<span class="nv">$capall</span>  <span class="o">=</span> <span class="nx">strtoupper</span><span class="p">(</span><span class="nv">$beast</span><span class="p">);</span> <span class="c1">// DROMEDAR</span>
<span class="c1">// PHP does not have the\L and\U string escapes.</span>
<span class="nv">$caprest</span> <span class="o">=</span> <span class="nx">strtolower</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$beast</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">.</span> <span class="nx">substr</span><span class="p">(</span><span class="nx">strtoupper</span><span class="p">(</span><span class="nv">$beast</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// dROMEDAR</span>
<span class="c1">// PHP does not have the\L and\U string escapes.</span>
<span class="c1">#-----------------------------</span>
<span class="c1">// titlecase each word&#39;s first character, lowercase the rest</span>
<span class="nv">$text</span> <span class="o">=</span> <span class="s2">&quot;thIS is a loNG liNE&quot;</span><span class="p">;</span>
<span class="nv">$text</span> <span class="o">=</span> <span class="nx">ucwords</span><span class="p">(</span><span class="nx">strtolower</span><span class="p">(</span><span class="nv">$text</span><span class="p">));</span>
<span class="k">print</span> <span class="nv">$text</span><span class="p">;</span>
<span class="k">This</span> <span class="nx">Is</span> <span class="nx">A</span> <span class="nx">Long</span> <span class="nx">Line</span>
<span class="c1">#-----------------------------</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">strtoupper</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="o">==</span> <span class="nx">strtoupper</span><span class="p">(</span><span class="nv">$b</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// or strcasecmp($a, $b) == 0</span>
    <span class="k">print</span> <span class="s2">&quot;a and b are the same</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">#-----------------------------</span>
<span class="c1"># <font size="-1"><a href="http://pleac.sourceforge.net/include/php/randcap.php</span>">download the following standalone program</a></font>
<span class="c1">#!/usr/bin/php</span>
<span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// randcap: filter to randomly capitalize 20% of the letters</span>
<span class="k">function</span> <span class="nf">randcase</span><span class="p">(</span><span class="nv">$word</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">20</span> <span class="o">?</span> <span class="nx">ucfirst</span><span class="p">(</span><span class="nv">$word</span><span class="p">)</span> <span class="o">:</span> <span class="nb">lcfirst</span><span class="p">(</span><span class="nv">$word</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">function</span> <span class="nf">lcfirst</span><span class="p">(</span><span class="nv">$word</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">strtolower</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$word</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">.</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$word</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">print</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s2">&quot;/(\w)/e&quot;</span><span class="p">,</span> <span class="s2">&quot;randcase(&#39;</span><span class="se">\\</span><span class="s2">1&#39;)&quot;</span><span class="p">,</span> <span class="nb">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// % php randcap.php &lt; genesis | head -9</span>
<span class="c1">#-----------------------------</span>

<span class="c1"># @@PLEAC@@_1.10</span>
<span class="c1">#-----------------------------</span>
<span class="k">echo</span> <span class="nv">$var1</span> <span class="o">.</span> <span class="nx">func</span><span class="p">()</span> <span class="o">.</span> <span class="nv">$var2</span><span class="p">;</span> <span class="c1">// scalar only</span>
<span class="c1">#-----------------------------</span>
<span class="c1">// PHP can only handle variable expression without operators</span>
<span class="nv">$answer</span> <span class="o">=</span> <span class="s2">&quot;STRING ${[ VAR EXPR ]} MORE STRING&quot;</span><span class="p">;</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$phrase</span> <span class="o">=</span> <span class="s2">&quot;I have &quot;</span> <span class="o">.</span> <span class="p">(</span><span class="nv">$n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot; guanacos.&quot;</span><span class="p">;</span>
<span class="c1">// PHP cannot handle the complex exression: ${\($n + 1)}</span>
<span class="c1">#-----------------------------</span>
<span class="c1">// Rest of Discussion is not applicable to PHP</span>
<span class="c1">#-----------------------------</span>
<span class="c1">// Interpolating functions not available in PHP</span>
<span class="c1">#-----------------------------</span>

<span class="c1"># @@PLEAC@@_1.11</span>
<span class="c1"># @@INCOMPLETE@@</span>
<span class="c1"># @@INCOMPLETE@@</span>

<span class="c1"># @@PLEAC@@_1.12</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$output</span> <span class="o">=</span> <span class="nx">wordwrap</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span> <span class="nv">$width</span><span class="p">,</span> <span class="nv">$break</span><span class="p">,</span> <span class="nv">$cut</span><span class="p">);</span>
<span class="c1">#-----------------------------</span>
<span class="c1"># <font size="-1"><a href="http://pleac.sourceforge.net/include/php/wrapdemo.php</span>">download the following standalone program</a></font>
<span class="c1">#!/usr/bin/php</span>
<span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// wrapdemo - show how wordwrap works</span>
<span class="nv">$input</span> <span class="o">=</span> <span class="s2">&quot;Folding and splicing is the work of an editor, &quot;</span> <span class="o">.</span>
         <span class="s2">&quot;not a mere collection of silicon &quot;</span> <span class="o">.</span>
         <span class="s2">&quot;and &quot;</span> <span class="o">.</span>
         <span class="s2">&quot;mobile electrons!&quot;</span><span class="p">;</span>
<span class="nv">$columns</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
<span class="k">print</span> <span class="nb">str_repeat</span><span class="p">(</span><span class="s2">&quot;0123456789&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">print</span> <span class="nx">wordwrap</span><span class="p">(</span><span class="s1">&#39;    &#39;</span> <span class="o">.</span> <span class="nv">$input</span><span class="p">,</span> <span class="nv">$columns</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  &quot;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="c1">#-----------------------------</span>
<span class="c1">// merge multiple lines into one, then wrap one long line</span>
<span class="k">print</span> <span class="nx">wordwrap</span><span class="p">(</span><span class="nb">str_replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">&#39;php://stdin&#39;</span><span class="p">)));</span>
<span class="c1">#-----------------------------</span>
<span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">print</span> <span class="nx">wordwrap</span><span class="p">(</span><span class="nb">str_replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="nb">stream_get_line</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)));</span>
    <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">#-----------------------------</span>

<span class="c1"># @@PLEAC@@_1.13</span>
<span class="c1">#-----------------------------</span>
<span class="c1">//backslash</span>
<span class="nv">$var</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/([CHARLIST])/&#39;</span><span class="p">,</span> <span class="s1">&#39;\\\$1&#39;</span><span class="p">,</span> <span class="nv">$var</span><span class="p">);</span>
<span class="c1">// double</span>
<span class="nv">$var</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/([CHARLIST])/&#39;</span><span class="p">,</span> <span class="s1">&#39;$1$1&#39;</span><span class="p">,</span> <span class="nv">$var</span><span class="p">);</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$var</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/%/&#39;</span><span class="p">,</span> <span class="s1">&#39;%%&#39;</span><span class="p">,</span> <span class="nv">$var</span><span class="p">);</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="s1">&#39;Mom said, &quot;Don\&#39;t do that.&quot;&#39;</span><span class="p">;</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/([\&#39;&quot;])/&#39;</span><span class="p">,</span> <span class="s1">&#39;\\\$1&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>
<span class="c1">// in PHP you can also use the addslashes() function</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="s1">&#39;Mom said, &quot;Don\&#39;t do that.&quot;&#39;</span><span class="p">;</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/([\&#39;&quot;])/&#39;</span><span class="p">,</span> <span class="s1">&#39;$1$1&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/([^A-Z])/&#39;</span><span class="p">,</span> <span class="s1">&#39;\\\$1&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>
<span class="c1">#-----------------------------</span>
<span class="c1">// PHP does not have the \Q and \E string metacharacters</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="s2">&quot;this is</span><span class="se">\\</span><span class="s2"> a</span><span class="se">\\</span><span class="s2"> test</span><span class="se">\\</span><span class="s2">!&quot;</span><span class="p">;</span>
<span class="c1">// PHP&#39;s quotemeta() function is not the same as perl&#39;s quotemeta() function</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/(\W)/&#39;</span><span class="p">,</span> <span class="s1">&#39;\\\$1&#39;</span><span class="p">,</span> <span class="s1">&#39;is a test!&#39;</span><span class="p">);</span>
<span class="c1">#-----------------------------</span>

<span class="c1"># @@PLEAC@@_1.14</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="nx">trim</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
<span class="c1">#-----------------------------</span>
<span class="c1">// print what&#39;s typed, but surrounded by &gt; &lt; symbols</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">print</span> <span class="s2">&quot;&gt;&quot;</span> <span class="o">.</span> <span class="nx">substr</span><span class="p">(</span><span class="nb">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;&lt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/\s+/&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span> <span class="c1">// finally, collapse middle</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="nx">trim</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/\s+/&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>
<span class="c1">#-----------------------------</span>
<span class="c1">// 1. trim leading and trailing white space</span>
<span class="c1">// 2. collapse internal whitespace to single space each</span>
<span class="k">function</span> <span class="nf">sub_trim</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$string</span> <span class="o">=</span> <span class="nx">trim</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
    <span class="nv">$string</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/\s+/&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$string</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">#-----------------------------</span>

<span class="c1"># @@PLEAC@@_1.15</span>
<span class="c1"># @@INCOMPLETE@@</span>
<span class="c1"># @@INCOMPLETE@@</span>

<span class="c1"># @@PLEAC@@_1.16</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$code</span> <span class="o">=</span> <span class="nb">soundex</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
<span class="c1">#-----------------------------</span>
<span class="nv">$phoned_words</span> <span class="o">=</span> <span class="nb">metaphone</span><span class="p">(</span><span class="s2">&quot;Schwern&quot;</span><span class="p">);</span>
<span class="c1">#-----------------------------</span>
<span class="c1">// substitution function for getpwent():</span>
<span class="c1">// returns an array of user entries,</span>
<span class="c1">// each entry contains the username and the full name</span>
<span class="k">function</span> <span class="nf">getpwent</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$pwents</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    <span class="nv">$handle</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s2">&quot;passwd&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$handle</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$handle</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/^#/&quot;</span><span class="p">,</span> <span class="nv">$line</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
        <span class="nv">$cols</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="nv">$line</span><span class="p">);</span>
        <span class="nv">$pwents</span><span class="p">[</span><span class="nv">$cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nv">$cols</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$pwents</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">print</span> <span class="s2">&quot;Lookup user: &quot;</span><span class="p">;</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nb">rtrim</span><span class="p">(</span><span class="nb">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">));</span>
<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$user</span><span class="p">))</span> <span class="k">exit</span><span class="p">;</span>
<span class="nv">$name_code</span> <span class="o">=</span> <span class="nb">soundex</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
<span class="nv">$pwents</span> <span class="o">=</span> <span class="nx">getpwent</span><span class="p">();</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$pwents</span> <span class="k">as</span> <span class="nv">$username</span> <span class="o">=&gt;</span> <span class="nv">$fullname</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/(\w+)[^,]*\b(\w+)/&quot;</span><span class="p">,</span> <span class="nv">$fullname</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">);</span>
    <span class="k">list</span><span class="p">(,</span> <span class="nv">$firstname</span><span class="p">,</span> <span class="nv">$lastname</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">;</span>
  
    <span class="k">if</span> <span class="p">(</span><span class="nv">$name_code</span> <span class="o">==</span> <span class="nb">soundex</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span> <span class="o">||</span>
        <span class="nv">$name_code</span> <span class="o">==</span> <span class="nb">soundex</span><span class="p">(</span><span class="nv">$lastname</span><span class="p">)</span> <span class="o">||</span>
        <span class="nv">$name_code</span> <span class="o">==</span> <span class="nb">soundex</span><span class="p">(</span><span class="nv">$firstname</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%s: %s %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$firstname</span><span class="p">,</span> <span class="nv">$lastname</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">#-----------------------------</span>

<span class="c1"># @@PLEAC@@_1.17</span>
<span class="c1">#-----------------------------</span>
<span class="c1"># <font size="-1"><a href="http://pleac.sourceforge.net/include/php/fixstyle.php</span>">download the following standalone program</a></font>
<span class="c1">#!/usr/bin/php</span>
<span class="o">&lt;?</span><span class="nx">php</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;DATA</span>
<span class="s">  analysed=&gt; analyzed</span>
<span class="s">  built-in=&gt; builtin</span>
<span class="s">  chastized   =&gt; chastised</span>
<span class="s">  commandline =&gt; command-line</span>
<span class="s">  de-allocate =&gt; deallocate</span>
<span class="s">  dropin  =&gt; drop-in</span>
<span class="s">  hardcode=&gt; hard-code</span>
<span class="s">  meta-data   =&gt; metadata</span>
<span class="s">  multicharacter  =&gt; multi-character</span>
<span class="s">  multiway=&gt; multi-way</span>
<span class="s">  non-empty   =&gt; nonempty</span>
<span class="s">  non-profit  =&gt; nonprofit</span>
<span class="s">  non-trappable   =&gt; nontrappable</span>
<span class="s">  pre-define  =&gt; predefine</span>
<span class="s">  preextend   =&gt; pre-extend</span>
<span class="s">  re-compiling=&gt; recompiling</span>
<span class="s">  reenter =&gt; re-enter</span>
<span class="s">  turnkey =&gt; turn-key</span>
<span class="s">DATA;</span>

<span class="nv">$scriptName</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="nv">$verbose</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$argc</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-v&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">array_shift</span><span class="p">(</span><span class="nv">$argv</span><span class="p">));</span>
<span class="nv">$change</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nb">preg_split</span><span class="p">(</span><span class="s2">&quot;/</span><span class="se">\n</span><span class="s2">/&quot;</span><span class="p">,</span> <span class="nv">$data</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$pair</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">list</span><span class="p">(</span><span class="nv">$in</span><span class="p">,</span> <span class="nv">$out</span><span class="p">)</span> <span class="o">=</span> <span class="nb">preg_split</span><span class="p">(</span><span class="s2">&quot;/\s*=&gt;\s*/&quot;</span><span class="p">,</span> <span class="nx">trim</span><span class="p">(</span><span class="nv">$pair</span><span class="p">));</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$in</span> <span class="o">||</span> <span class="o">!</span><span class="nv">$out</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
  <span class="nv">$change</span><span class="p">[</span><span class="nv">$in</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$out</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>  <span class="p">{</span>
  <span class="c1">// no in-place edit in PHP</span>
  <span class="c1">// preserve old files</span>
  <span class="nv">$orig</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;.orig&quot;</span><span class="p">;</span>
  <span class="nb">copy</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nv">$orig</span><span class="p">);</span>
  <span class="nv">$input</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$orig</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">);</span>
  <span class="nv">$output</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;w&quot;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$scriptName</span> <span class="o">!=</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$input</span> <span class="o">=</span> <span class="nx">STDIN</span><span class="p">;</span>
  <span class="nb">trigger_error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$scriptName</span><span class="s2">: Reading from stdin</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nx">E_USER_WARNING</span><span class="p">);</span>
<span class="p">}</span>
<span class="nv">$ln</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$input</span><span class="p">))</span> <span class="p">{</span>
  <span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$input</span><span class="p">);</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$change</span> <span class="k">as</span> <span class="nv">$in</span> <span class="o">=&gt;</span> <span class="nv">$out</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$line</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">$in</span><span class="s2">/&quot;</span><span class="p">,</span> <span class="nv">$out</span><span class="p">,</span> <span class="nv">$line</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$count</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nv">$verbose</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDERR</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">$in</span><span class="s2"> =&gt; </span><span class="si">$out</span><span class="s2"> at </span><span class="si">$argv[1]</span><span class="s2"> line </span><span class="si">$ln</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="o">@</span><span class="nb">fwrite</span><span class="p">(</span><span class="nv">$output</span><span class="p">,</span> <span class="nv">$line</span><span class="p">);</span>
  <span class="nv">$ln</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">#-----------------------------</span>
<span class="c1"># <font size="-1"><a href="http://pleac.sourceforge.net/include/php/fixstyle2.php</span>">download the following standalone program</a></font>
<span class="c1">#!/usr/bin/php</span>
<span class="o">&lt;?</span><span class="nx">php</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;DATA</span>
<span class="s">  analysed=&gt; analyzed</span>
<span class="s">  built-in=&gt; builtin</span>
<span class="s">  chastized   =&gt; chastised</span>
<span class="s">  commandline =&gt; command-line</span>
<span class="s">  de-allocate =&gt; deallocate</span>
<span class="s">  dropin  =&gt; drop-in</span>
<span class="s">  hardcode=&gt; hard-code</span>
<span class="s">  meta-data   =&gt; metadata</span>
<span class="s">  multicharacter  =&gt; multi-character</span>
<span class="s">  multiway=&gt; multi-way</span>
<span class="s">  non-empty   =&gt; nonempty</span>
<span class="s">  non-profit  =&gt; nonprofit</span>
<span class="s">  non-trappable   =&gt; nontrappable</span>
<span class="s">  pre-define  =&gt; predefine</span>
<span class="s">  preextend   =&gt; pre-extend</span>
<span class="s">  re-compiling=&gt; recompiling</span>
<span class="s">  reenter =&gt; re-enter</span>
<span class="s">  turnkey =&gt; turn-key</span>
<span class="s">DATA;</span>

<span class="nv">$scriptName</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="nv">$verbose</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$argc</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-v&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">array_shift</span><span class="p">(</span><span class="nv">$argv</span><span class="p">));</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>  <span class="p">{</span>
  <span class="c1">// no in-place edit in PHP</span>
  <span class="c1">// preserve old files</span>
  <span class="nv">$orig</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;.orig&quot;</span><span class="p">;</span>
  <span class="nb">copy</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nv">$orig</span><span class="p">);</span>
  <span class="nv">$input</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$orig</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">);</span>
  <span class="nv">$output</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;w&quot;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$scriptName</span> <span class="o">!=</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$input</span> <span class="o">=</span> <span class="nx">STDIN</span><span class="p">;</span>
  <span class="nb">trigger_error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$scriptName</span><span class="s2">: Reading from stdin</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nx">E_USER_WARNING</span><span class="p">);</span>
<span class="p">}</span>

<span class="nv">$config</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nb">preg_split</span><span class="p">(</span><span class="s2">&quot;/</span><span class="se">\n</span><span class="s2">/&quot;</span><span class="p">,</span> <span class="nv">$data</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$pair</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">list</span><span class="p">(</span><span class="nv">$in</span><span class="p">,</span> <span class="nv">$out</span><span class="p">)</span> <span class="o">=</span> <span class="nb">preg_split</span><span class="p">(</span><span class="s2">&quot;/\s*=&gt;\s*/&quot;</span><span class="p">,</span> <span class="nx">trim</span><span class="p">(</span><span class="nv">$pair</span><span class="p">));</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$in</span> <span class="o">||</span> <span class="o">!</span><span class="nv">$out</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
  <span class="nv">$config</span><span class="p">[</span><span class="nv">$in</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$out</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$ln</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$input</span><span class="p">))</span> <span class="p">{</span>
  <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/^(\s*)(.*)/&quot;</span><span class="p">,</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$input</span><span class="p">),</span> <span class="nv">$matches</span><span class="p">);</span> <span class="c1">// emit leading whitespace</span>
  <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$output</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nb">preg_split</span><span class="p">(</span><span class="s2">&quot;/(\s+)/&quot;</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">PREG_SPLIT_DELIM_CAPTURE</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$token</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// preserve trailing whitespace</span>
    <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$output</span><span class="p">,</span> <span class="p">(</span><span class="nv">$i</span><span class="o">++</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$token</span> <span class="o">:</span> <span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$token</span><span class="p">,</span> <span class="nv">$config</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$config</span><span class="p">[</span><span class="nv">$token</span><span class="p">]</span> <span class="o">:</span> <span class="nv">$token</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1">#-----------------------------</span>
<span class="c1">// very fast, but whitespace collapse</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$input</span><span class="p">))</span> <span class="p">{</span>
  <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/^(\s*)(.*)/&quot;</span><span class="p">,</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$input</span><span class="p">),</span> <span class="nv">$matches</span><span class="p">);</span> <span class="c1">// emit leading whitespace</span>
  <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$output</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nb">preg_split</span><span class="p">(</span><span class="s2">&quot;/(\s+)/&quot;</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">as</span> <span class="nv">$token</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// preserve trailing whitespace</span>
    <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$output</span><span class="p">,</span> <span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$token</span><span class="p">,</span> <span class="nv">$config</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$config</span><span class="p">[</span><span class="nv">$token</span><span class="p">]</span> <span class="o">:</span> <span class="nv">$token</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot; &quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$output</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">#-----------------------------</span>

<span class="c1">// @@PLEAC@@_2.0</span>
<span class="c1">// As is the case under so many other languages floating point use under PHP is fraught</span>
<span class="c1">// with dangers. Although the basic techniques shown below are valid, please refer to</span>
<span class="c1">// the official PHP documentation for known issues, bugs, and alternate approaches </span>

<span class="c1">// @@PLEAC@@_2.1</span>
<span class="c1">// Two basic approaches to numeric validation:</span>
<span class="c1">// * Built-in functions like &#39;is_numeric&#39;, &#39;is_int&#39;, &#39;is_float&#39; etc</span>
<span class="c1">// * Regexes, as shown below</span>

<span class="nv">$s</span> <span class="o">=</span> <span class="s1">&#39;12.345&#39;</span><span class="p">;</span>

<span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/\D/&#39;</span><span class="p">,</span> <span class="nv">$s</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;has nondigits</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/^\d+$/&#39;</span><span class="p">,</span> <span class="nv">$s</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;not a natural number</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/^-?\d+$/&#39;</span><span class="p">,</span> <span class="nv">$s</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;not an integer</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/^[+-]?\d+$/&#39;</span><span class="p">,</span> <span class="nv">$s</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;not an integer</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/^-?\d+\.?\d*$/&#39;</span><span class="p">,</span> <span class="nv">$s</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;not a decimal</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/^-?(?:\d+(?:\.\d*)?|\.\d+)$/&#39;</span><span class="p">,</span> <span class="nv">$s</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;not a decimal</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/&#39;</span><span class="p">,</span> <span class="nv">$s</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;not a C float</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">getnum</span><span class="p">(</span><span class="nv">$s</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nb">sscanf</span><span class="p">(</span><span class="nv">$s</span><span class="p">,</span> <span class="s2">&quot;%D&quot;</span><span class="p">,</span> <span class="nv">$number</span><span class="p">);</span> <span class="k">return</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$number</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$number</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">echo</span> <span class="nx">getnum</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>   <span class="c1">// ok</span>
<span class="k">echo</span> <span class="nx">getnum</span><span class="p">(</span><span class="mh">0xff</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>  <span class="c1">// ..</span>
<span class="k">echo</span> <span class="nx">getnum</span><span class="p">(</span><span class="mo">044</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>   <span class="c1">// ..</span>

<span class="k">echo</span> <span class="nx">getnum</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>   <span class="c1">// fail</span>

<span class="c1">// @@PLEAC@@_2.2</span>
<span class="c1">// In PHP floating point comparisions are &#39;safe&#39; [meaning the &#39;==&#39; comparison operator</span>
<span class="c1">// can be used] as long as the value consists of 14 digits or less [total digits, either</span>
<span class="c1">// side of the decimal point e.g. xxxxxxx.xxxxxxx, xxxxxxxxxxxxxx., .xxxxxxxxxxxxxx]. If</span>
<span class="c1">// values with more digits must be compared, then:</span>
<span class="c1">//</span>
<span class="c1">// * Represent as strings, and take care to avoid any implicit conversions e.g. don&#39;t pass</span>
<span class="c1">//   a float as a float to a function and expect all digits to be retained - they won&#39;t be -</span>
<span class="c1">//   then use &#39;strcmp&#39; to compare the strings</span>
<span class="c1">//</span>
<span class="c1">// * Avoid float use; perhaps use arbitrary precision arithmetic. In this case, the</span>
<span class="c1">//   &#39;bccomp&#39; function is relevant</span>

<span class="c1">// Will work as long as each floating point value is 14 digits or less</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$float_1</span> <span class="o">==</span> <span class="nv">$float_2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// Compare as strings</span>
<span class="nv">$cmp</span> <span class="o">=</span> <span class="nb">strcmp</span><span class="p">(</span><span class="s1">&#39;123456789.123456789123456789&#39;</span><span class="p">,</span> <span class="s1">&#39;123456789.123456789123456788&#39;</span><span class="p">);</span>

<span class="c1">// Use &#39;bccomp&#39;</span>
<span class="nv">$precision</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// Number of significant comparison digits after decimal point</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">bccomp</span><span class="p">(</span><span class="s1">&#39;1.111117&#39;</span><span class="p">,</span> <span class="s1">&#39;1.111116&#39;</span><span class="p">,</span> <span class="nv">$precision</span><span class="p">))</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ...</span>
<span class="p">}</span>

<span class="nv">$precision</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">bccomp</span><span class="p">(</span><span class="s1">&#39;1.111117&#39;</span><span class="p">,</span> <span class="s1">&#39;1.111116&#39;</span><span class="p">,</span> <span class="nv">$precision</span><span class="p">))</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$wage</span> <span class="o">=</span> <span class="mi">536</span><span class="p">;</span>
<span class="nv">$week</span> <span class="o">=</span> <span class="nv">$wage</span> <span class="o">*</span> <span class="mi">40</span><span class="p">;</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;One week&#39;s wage is: $%.2f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$week</span> <span class="o">/</span> <span class="mi">100</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_2.3</span>
<span class="c1">// Preferred approach</span>
<span class="nv">$rounded</span> <span class="o">=</span> <span class="nx">round</span><span class="p">(</span><span class="nv">$unrounded</span><span class="p">,</span> <span class="nv">$precision</span><span class="p">);</span>

<span class="c1">// Possible alternate approach</span>
<span class="nv">$format</span> <span class="o">=</span> <span class="s1">&#39;%[width].[prec]f&#39;</span><span class="p">;</span>
<span class="nv">$rounded</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="nv">$format</span><span class="p">,</span> <span class="nv">$unrounded</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="mf">0.255</span><span class="p">;</span> <span class="nv">$b</span> <span class="o">=</span> <span class="nx">round</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="k">echo</span> <span class="s2">&quot;Unrounded: </span><span class="si">{</span><span class="nv">$a</span><span class="si">}</span><span class="se">\n</span><span class="s2">Rounded: </span><span class="si">{</span><span class="nv">$b</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="mf">0.255</span><span class="p">;</span> <span class="nv">$b</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;%.2f&#39;</span><span class="p">,</span> <span class="nv">$a</span><span class="p">);</span>
<span class="k">echo</span> <span class="s2">&quot;Unrounded: </span><span class="si">{</span><span class="nv">$a</span><span class="si">}</span><span class="se">\n</span><span class="s2">Rounded: </span><span class="si">{</span><span class="nv">$b</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="mf">0.255</span><span class="p">;</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Unrounded: %.f</span><span class="se">\n</span><span class="s2">Rounded: %.2f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$a</span><span class="p">,</span> <span class="nv">$a</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="k">echo</span> <span class="s2">&quot;number</span><span class="se">\t</span><span class="s2">int</span><span class="se">\t</span><span class="s2">floor</span><span class="se">\t</span><span class="s2">ceil</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="k">foreach</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="mf">3.3</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">3.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.3</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$number</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%.1f</span><span class="se">\t</span><span class="s2">%.1f</span><span class="se">\t</span><span class="s2">%.1f</span><span class="se">\t</span><span class="s2">%.1f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$number</span><span class="p">,</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$number</span><span class="p">,</span> <span class="nx">floor</span><span class="p">(</span><span class="nv">$number</span><span class="p">),</span> <span class="nb">ceil</span><span class="p">(</span><span class="nv">$number</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_2.4</span>
<span class="c1">// PHP offers the &#39;bindec&#39; and &#39;decbin&#39; functions to converting between binary and decimal</span>

<span class="nv">$num</span> <span class="o">=</span> <span class="nb">bindec</span><span class="p">(</span><span class="s1">&#39;0110110&#39;</span><span class="p">);</span>

<span class="nv">$binstr</span> <span class="o">=</span> <span class="nb">decbin</span><span class="p">(</span><span class="mi">54</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_2.5</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nv">$X</span><span class="p">,</span> <span class="nv">$Y</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$i</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nv">$X</span><span class="p">,</span> <span class="nv">$Y</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$i</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="nv">$X</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;=</span> <span class="nv">$Y</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="nv">$X</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;=</span> <span class="nv">$Y</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">+=</span> <span class="mi">7</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="k">echo</span> <span class="s1">&#39;Infancy is:&#39;</span><span class="p">;</span> <span class="k">foreach</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$i</span><span class="p">)</span> <span class="k">echo</span> <span class="s2">&quot; </span><span class="si">{</span><span class="nv">$i</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;Toddling is:&#39;</span><span class="p">;</span> <span class="k">foreach</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$i</span><span class="p">)</span> <span class="k">echo</span> <span class="s2">&quot; </span><span class="si">{</span><span class="nv">$i</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;Childhood is:&#39;</span><span class="p">;</span> <span class="k">foreach</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$i</span><span class="p">)</span> <span class="k">echo</span> <span class="s2">&quot; </span><span class="si">{</span><span class="nv">$i</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// @@PLEAC@@_2.6</span>
<span class="c1">// PHP offers no native support for Roman Numerals. However, a &#39;Numbers_Roman&#39; class</span>
<span class="c1">// is available for download from PEAR: [http://pear.php.net/package/Numbers_Roman].</span>
<span class="c1">// Note the following &#39;include&#39; directives are required:</span>
<span class="c1">//</span>
<span class="c1">//   include_once(&#39;Numbers/Roman.php&#39;);</span>

<span class="nv">$roman</span> <span class="o">=</span> <span class="nx">Numbers_Roman</span><span class="o">::</span><span class="na">toNumeral</span><span class="p">(</span><span class="nv">$arabic</span><span class="p">);</span>
<span class="nv">$arabic</span> <span class="o">=</span> <span class="nx">Numbers_Roman</span><span class="o">::</span><span class="na">toNumber</span><span class="p">(</span><span class="nv">$roman</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$roman_fifteen</span> <span class="o">=</span> <span class="nx">Numbers_Roman</span><span class="o">::</span><span class="na">toNumeral</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>

<span class="nv">$arabic_fifteen</span> <span class="o">=</span> <span class="nx">Numbers_Roman</span><span class="o">::</span><span class="na">toNumber</span><span class="p">(</span><span class="nv">$roman_fifteen</span><span class="p">);</span>

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Roman for fifteen is: %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$roman_fifteen</span><span class="p">);</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Arabic for fifteen is: %d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$arabic_fifteen</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_2.7</span>
<span class="c1">// Techniques used here simply mirror Perl examples, and are not an endorsement</span>
<span class="c1">// of any particular RNG technique</span>

<span class="c1">// In PHP do this ...</span>
<span class="nv">$random</span> <span class="o">=</span> <span class="nx">rand</span><span class="p">(</span><span class="nv">$lowerbound</span><span class="p">,</span> <span class="nv">$upperbound</span><span class="p">);</span>
<span class="nv">$random</span> <span class="o">=</span> <span class="nx">rand</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">make_password</span><span class="p">(</span><span class="nv">$chars</span><span class="p">,</span> <span class="nv">$reqlen</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$len</span> <span class="o">=</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$chars</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$reqlen</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="nv">$password</span> <span class="o">.=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$chars</span><span class="p">,</span> <span class="nx">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$len</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$password</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$chars</span> <span class="o">=</span> <span class="s1">&#39;ABCDEfghijKLMNOpqrstUVWXYz&#39;</span><span class="p">;</span> <span class="nv">$reqlen</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>

<span class="nv">$password</span> <span class="o">=</span> <span class="nx">make_password</span><span class="p">(</span><span class="nv">$chars</span><span class="p">,</span> <span class="nv">$reqlen</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_2.8</span>
<span class="c1">// PHP sports a large number of C Standard Library routines including the &#39;srand&#39;</span>
<span class="c1">// function, used to re-seed the RNG used with calls to the &#39;rand&#39; function. Thus,</span>
<span class="c1">// as per Perl example:</span>

<span class="k">while</span> <span class="p">(</span><span class="k">TRUE</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$seed</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nb">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$seed</span><span class="p">))</span> <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">srand</span><span class="p">(</span><span class="nv">$seed</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_2.9</span>
<span class="c1">// The above is considered - for many reasons - a poor way of seeding the RNG. PHP</span>
<span class="c1">// also offers alternate versions of the functions, &#39;mt_srand&#39; and &#39;mt_rand&#39;,</span>
<span class="c1">// which are described as faster, and more &#39;random&#39;, though key to obtaining a</span>
<span class="c1">// more &#39;random&#39; distribution of generated numbers seems to be through using</span>
<span class="c1">// a combination of a previously saved random value in combination with an</span>
<span class="c1">// unrepeatable value [like the current time in microseconds] that is multiplied</span>
<span class="c1">// by a large prime number, or perhaps as part of a hash [examples available in</span>
<span class="c1">// PHP documentation for &#39;srand&#39; and &#39;mt_srand&#39;]</span>

<span class="nx">mt_srand</span><span class="p">(</span><span class="nv">$saved_random_value</span> <span class="o">+</span> <span class="nb">microtime</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000003</span><span class="p">);</span>

<span class="c1">// or</span>

<span class="nx">mt_srand</span><span class="p">((</span><span class="nv">$saved_random_value</span> <span class="o">+</span> <span class="nx">hexdec</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nb">md5</span><span class="p">(</span><span class="nb">microtime</span><span class="p">()),</span> <span class="o">-</span><span class="mi">8</span><span class="p">)))</span> <span class="o">&amp;</span> <span class="mh">0x7fffffff</span><span class="p">);</span>

<span class="c1">// Use of &#39;mt_rand&#39; together with an appropriate seeding approach should help better</span>
<span class="c1">// approximate the generation of a &#39;truly random value&#39;</span>
<span class="nv">$truly_random_value</span> <span class="o">=</span> <span class="nx">mt_rand</span><span class="p">();</span>

<span class="c1">// @@PLEAC@@_2.10</span>
<span class="k">function</span> <span class="nf">random</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="nx">float</span><span class="p">)</span> <span class="nx">rand</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="nx">float</span><span class="p">)</span> <span class="nx">getrandmax</span><span class="p">();</span> <span class="p">}</span>

<span class="k">function</span> <span class="nf">gaussian_rand</span><span class="p">()</span>
<span class="p">{</span>
  <span class="nv">$u1</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="nv">$u2</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="nv">$g1</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="nv">$g2</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="nv">$w</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  
  <span class="k">do</span>
  <span class="p">{</span>
    <span class="nv">$u1</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="nx">random</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">;</span> <span class="nv">$u2</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="nx">random</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">;</span>
    <span class="nv">$w</span> <span class="o">=</span> <span class="nv">$u1</span> <span class="o">*</span> <span class="nv">$u1</span> <span class="o">+</span> <span class="nv">$u2</span> <span class="o">*</span> <span class="nv">$u2</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nv">$w</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">);</span>
  
  <span class="nv">$w</span> <span class="o">=</span> <span class="nx">sqrt</span><span class="p">((</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="nx">log</span><span class="p">(</span><span class="nv">$w</span><span class="p">))</span> <span class="o">/</span> <span class="nv">$w</span><span class="p">);</span> <span class="nv">$g2</span> <span class="o">=</span> <span class="nv">$u1</span> <span class="o">*</span> <span class="nv">$w</span><span class="p">;</span> <span class="nv">$g1</span> <span class="o">=</span> <span class="nv">$u2</span> <span class="o">*</span> <span class="nv">$w</span><span class="p">;</span>

  <span class="k">return</span> <span class="nv">$g1</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$mean</span> <span class="o">=</span> <span class="mf">25.0</span><span class="p">;</span> <span class="nv">$sdev</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span>
<span class="nv">$salary</span> <span class="o">=</span> <span class="nx">gaussian_rand</span><span class="p">()</span> <span class="o">*</span> <span class="nv">$mean</span> <span class="o">+</span> <span class="nv">$sdev</span><span class="p">;</span>

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;You have been hired at: %.2f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$salary</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_2.11</span>
<span class="c1">// &#39;deg2rad&#39; and &#39;rad2deg&#39; are actually PHP built-ins, but here is how you might implement</span>
<span class="o">/</span>  <span class="nx">them</span> <span class="k">if</span> <span class="nx">needed</span>
<span class="k">function</span> <span class="nf">deg2rad_</span><span class="p">(</span><span class="nv">$deg</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="nv">$deg</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span> <span class="o">*</span> <span class="nx">M_PI</span><span class="p">;</span> <span class="p">}</span>
<span class="k">function</span> <span class="nf">rad2deg_</span><span class="p">(</span><span class="nv">$rad</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="nv">$rad</span> <span class="o">/</span> <span class="nx">M_PI</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span><span class="p">;</span> <span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nx">deg2rad_</span><span class="p">(</span><span class="mf">180.0</span><span class="p">));</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">deg2rad</span><span class="p">(</span><span class="mf">180.0</span><span class="p">));</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">degree_sin</span><span class="p">(</span><span class="nv">$deg</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">sin</span><span class="p">(</span><span class="nb">deg2rad</span><span class="p">(</span><span class="nv">$deg</span><span class="p">));</span> <span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$rad</span> <span class="o">=</span> <span class="nb">deg2rad</span><span class="p">(</span><span class="mf">380.0</span><span class="p">);</span>

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nx">sin</span><span class="p">(</span><span class="nv">$rad</span><span class="p">));</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nx">degree_sin</span><span class="p">(</span><span class="mf">380.0</span><span class="p">));</span>

<span class="c1">// @@PLEAC@@_2.12</span>
<span class="k">function</span> <span class="nf">my_tan</span><span class="p">(</span><span class="nv">$theta</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">sin</span><span class="p">(</span><span class="nv">$theta</span><span class="p">)</span> <span class="o">/</span> <span class="nb">cos</span><span class="p">(</span><span class="nv">$theta</span><span class="p">);</span> <span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$theta</span> <span class="o">=</span> <span class="mf">3.7</span><span class="p">;</span>

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nx">my_tan</span><span class="p">(</span><span class="nv">$theta</span><span class="p">));</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nx">tan</span><span class="p">(</span><span class="nv">$theta</span><span class="p">));</span>

<span class="c1">// @@PLEAC@@_2.13</span>
<span class="nv">$value</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>

<span class="nv">$log_e</span> <span class="o">=</span> <span class="nx">log</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
<span class="nv">$log_10</span> <span class="o">=</span> <span class="nx">log10</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">log_base</span><span class="p">(</span><span class="nv">$base</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">log</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="o">/</span> <span class="nx">log</span><span class="p">(</span><span class="nv">$base</span><span class="p">);</span> <span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$answer</span> <span class="o">=</span> <span class="nx">log_base</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10000.0</span><span class="p">);</span>

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;log(10, 10,000) = %f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$answer</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_2.14</span>
<span class="c1">// PHP offers no native support for matrices. However, a &#39;Math_Matrix&#39; class</span>
<span class="c1">// is available for download from PEAR: [http://pear.php.net/package/Math_Matrix].</span>
<span class="c1">// Note the following &#39;include&#39; directives are required:</span>
<span class="c1">//</span>
<span class="c1">//  include_once(&#39;Math/Matrix.php&#39;);</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Math_Matrix</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">)));</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Math_Matrix</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)));</span>

<span class="k">echo</span> <span class="nv">$a</span><span class="o">-&gt;</span><span class="na">toString</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="nv">$b</span><span class="o">-&gt;</span><span class="na">toString</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// NOTE: When I installed this package I had to rename the &#39;clone&#39; method else</span>
<span class="c1">// it would not load, so I chose to rename it to &#39;clone_&#39;, and this usage is</span>
<span class="c1">// shown below. This bug may well be fixed by the time you obtain this package</span>

<span class="nv">$c</span> <span class="o">=</span> <span class="nv">$a</span><span class="o">-&gt;</span><span class="na">clone_</span><span class="p">();</span>
<span class="nv">$c</span><span class="o">-&gt;</span><span class="na">multiply</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$c</span><span class="o">-&gt;</span><span class="na">toString</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// @@PLEAC@@_2.15</span>
<span class="c1">// PHP offers no native support for complex numbers. However, a &#39;Math_Complex&#39; class</span>
<span class="c1">// is available for download from PEAR: [http://pear.php.net/package/Math_Complex].</span>
<span class="c1">// Note the following &#39;include&#39; directives are required:</span>
<span class="c1">//</span>
<span class="c1">//   include_once(&#39;Math/Complex.php&#39;);</span>
<span class="c1">//   include_once(&#39;Math/TrigOp.php&#39;);</span>
<span class="c1">//   include_once(&#39;Math/ComplexOp.php&#39;);</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Math_Complex</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Math_Complex</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">);</span>

<span class="nv">$c</span> <span class="o">=</span> <span class="nx">Math_ComplexOp</span><span class="o">::</span><span class="na">mult</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$c</span><span class="o">-&gt;</span><span class="na">toString</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$d</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Math_Complex</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="nv">$r</span> <span class="o">=</span> <span class="nx">Math_ComplexOp</span><span class="o">::</span><span class="na">sqrt</span><span class="p">(</span><span class="nv">$d</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$r</span><span class="o">-&gt;</span><span class="na">toString</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// @@PLEAC@@_2.16</span>
<span class="c1">// Like C, PHP supports decimal-alternate notations. Thus, for example, the integer</span>
<span class="c1">// value, 867, is expressable in literal form as:</span>
<span class="c1">//</span>
<span class="c1">//   Hexadecimal -&gt; 0x363</span>
<span class="c1">//   Octal       -&gt; 01543</span>
<span class="c1">//</span>
<span class="c1">// For effecting such conversions using strings there is &#39;sprintf&#39; and &#39;sscanf&#39;.</span>

<span class="nv">$dec</span> <span class="o">=</span> <span class="mi">867</span><span class="p">;</span>
<span class="nv">$hex</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;%x&#39;</span><span class="p">,</span> <span class="nv">$dec</span><span class="p">);</span>
<span class="nv">$oct</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;%o&#39;</span><span class="p">,</span> <span class="nv">$dec</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nv">$dec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nv">$hex</span> <span class="o">=</span> <span class="s1">&#39;363&#39;</span><span class="p">;</span>

<span class="nb">sscanf</span><span class="p">(</span><span class="nv">$hex</span><span class="p">,</span> <span class="s1">&#39;%x&#39;</span><span class="p">,</span> <span class="nv">$dec</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nv">$dec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nv">$oct</span> <span class="o">=</span> <span class="s1">&#39;1543&#39;</span><span class="p">;</span>

<span class="nb">sscanf</span><span class="p">(</span><span class="nv">$oct</span><span class="p">,</span> <span class="s1">&#39;%o&#39;</span><span class="p">,</span> <span class="nv">$dec</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="nb">printf</span><span class="p">(</span><span class="s1">&#39;Gimme a number in decimal, octal, or hex: &#39;</span><span class="p">);</span>
<span class="nb">sscanf</span><span class="p">(</span><span class="nb">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">),</span> <span class="s1">&#39;%D&#39;</span><span class="p">,</span> <span class="nv">$number</span><span class="p">);</span>

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%d %x %o</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$number</span><span class="p">,</span> <span class="nv">$number</span><span class="p">,</span> <span class="nv">$number</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_2.17</span>
<span class="c1">// PHP offers the &#39;number_format&#39; built-in function to, among many other format tasks, </span>
<span class="c1">// commify numbers. Perl-compatible [as well as extended] regexes are also available</span>

<span class="k">function</span> <span class="nf">commify_series</span><span class="p">(</span><span class="nv">$s</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">number_format</span><span class="p">(</span><span class="nv">$s</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">);</span> <span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$hits</span> <span class="o">=</span> <span class="mi">3456789</span><span class="p">;</span>

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Your website received %s accesses last month</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nx">commify_series</span><span class="p">(</span><span class="nv">$hits</span><span class="p">));</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">commify</span><span class="p">(</span><span class="nv">$s</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="nb">strrev</span><span class="p">(</span><span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/(\d\d\d)(?=\d)(?!\d*\.)/&#39;</span><span class="p">,</span> <span class="s1">&#39;${1},&#39;</span><span class="p">,</span> <span class="nb">strrev</span><span class="p">(</span><span class="nv">$s</span><span class="p">)));</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$hits</span> <span class="o">=</span> <span class="mi">3456789</span><span class="p">;</span>

<span class="k">echo</span> <span class="nx">commify</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;Your website received %d accesses last month</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$hits</span><span class="p">));</span>

<span class="c1">// @@PLEAC@@_2.18</span>
<span class="k">function</span> <span class="nf">pluralise</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$root</span><span class="p">,</span> <span class="nv">$singular</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="p">,</span> <span class="nv">$plural</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="nv">$root</span> <span class="o">.</span> <span class="p">((</span><span class="nv">$value</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$plural</span> <span class="o">:</span> <span class="nv">$singular</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$duration</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;It took %d %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$duration</span><span class="p">,</span> <span class="nx">pluralise</span><span class="p">(</span><span class="nv">$duration</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">));</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%d %s %s enough.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$duration</span><span class="p">,</span> <span class="nx">pluralise</span><span class="p">(</span><span class="nv">$duration</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">),</span>
      <span class="nx">pluralise</span><span class="p">(</span><span class="nv">$duration</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;are&#39;</span><span class="p">));</span>

<span class="nv">$duration</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;It took %d %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$duration</span><span class="p">,</span> <span class="nx">pluralise</span><span class="p">(</span><span class="nv">$duration</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">));</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%d %s %s enough.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$duration</span><span class="p">,</span> <span class="nx">pluralise</span><span class="p">(</span><span class="nv">$duration</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">),</span>
      <span class="nx">pluralise</span><span class="p">(</span><span class="nv">$duration</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;are&#39;</span><span class="p">));</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">plural</span><span class="p">(</span><span class="nv">$singular</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$s2p</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;/ss$/&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;sses&#39;</span><span class="p">,</span> <span class="s1">&#39;/([psc]h)$/&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;${1}es&#39;</span><span class="p">,</span> <span class="s1">&#39;/z$/&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;zes&#39;</span><span class="p">,</span>
               <span class="s1">&#39;/ff$/&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ffs&#39;</span><span class="p">,</span> <span class="s1">&#39;/f$/&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ves&#39;</span><span class="p">,</span> <span class="s1">&#39;/ey$/&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;eys&#39;</span><span class="p">,</span>
               <span class="s1">&#39;/y$/&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ies&#39;</span><span class="p">,</span> <span class="s1">&#39;/ix$/&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ices&#39;</span><span class="p">,</span> <span class="s1">&#39;/([sx])$/&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;$1es&#39;</span><span class="p">,</span>
               <span class="s1">&#39;$&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;s&#39;</span><span class="p">);</span>

  <span class="k">foreach</span><span class="p">(</span><span class="nv">$s2p</span> <span class="k">as</span> <span class="nv">$s</span> <span class="o">=&gt;</span> <span class="nv">$p</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="nv">$s</span><span class="p">,</span> <span class="nv">$singular</span><span class="p">))</span> <span class="k">return</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="nv">$s</span><span class="p">,</span> <span class="nv">$p</span><span class="p">,</span> <span class="nv">$singular</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="k">foreach</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;mess&#39;</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;leaf&#39;</span><span class="p">,</span> <span class="s1">&#39;puppy&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$word</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%6s -&gt; %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$word</span><span class="p">,</span> <span class="nx">plural</span><span class="p">(</span><span class="nv">$word</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_2.19</span>
<span class="c1">// @@INCOMPLETE@@</span>
<span class="c1">// @@INCOMPLETE@@</span>

<span class="c1">// @@PLEAC@@_3.0</span>
<span class="c1">// PHP&#39;s date / time suport is quite extensive, and appears grouped into three areas of</span>
<span class="c1">// functionality:</span>
<span class="c1">//</span>
<span class="c1">// * UNIX / C Library [libc]-based routines, which include [among others]:</span>
<span class="c1">//   - localtime, gmtime</span>
<span class="c1">//   - strftime, strptime, mktime</span>
<span class="c1">//   - time, getdate, gettimeofday, </span>
<span class="c1">//</span>
<span class="c1">// * PHP &#39;native&#39; functions, those date / time routines released in earlier versions,</span>
<span class="c1">//   and which otherwise provide &#39;convenience&#39; functionality; these include:</span>
<span class="c1">//   - date</span>
<span class="c1">//   - strtotime</span>
<span class="c1">//</span>
<span class="c1">// * &#39;DateTime&#39; class-based. This facility appears [according to the PHP documentation]</span>
<span class="c1">//   to be extremely new / experimental, so whilst usage examples will be provided, they</span>
<span class="c1">//   should not be taken to be &#39;official&#39; examples, and obviously, subject to change.</span>
<span class="c1">//   My own impression is that this facility is currently only partially implemented,</span>
<span class="c1">//   so there is limited use for these functions. The functions included in this group</span>
<span class="c1">//   are some of the &#39;date_&#39;-prefixed functions; they are, however, not used standalone,</span>
<span class="c1">//   but as methods in conjunction with an object. Typical usage:</span>
<span class="c1">//</span>
<span class="c1">//     $today = new DateTime();             // actually calls: date_create($today, ...);</span>
<span class="c1">//     echo $today-&gt;format(&#39;U&#39;) . &quot;\n&quot;;     // actually calls: date_format($today, ...);</span>
<span class="c1">//</span>
<span class="c1">// Also worth mentioning is the PEAR [PHP Extension and Repository] package, &#39;Calendar&#39;,</span>
<span class="c1">// which offers a rich set of date / time manipulation facilities. However, since it is</span>
<span class="c1">// not currently shipped with PHP, no examples appear</span>

<span class="c1">// Helper functions for performing date arithmetic </span>

<span class="k">function</span> <span class="nf">dateOffset</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="nv">$tbl</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;sec&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span> <span class="o">=&gt;</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;hou&#39;</span> <span class="o">=&gt;</span> <span class="mi">3600</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span> <span class="o">=&gt;</span> <span class="mi">86400</span><span class="p">,</span> <span class="s1">&#39;wee&#39;</span> <span class="o">=&gt;</span> <span class="mi">604800</span><span class="p">);</span>
  <span class="nv">$delta</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">foreach</span> <span class="p">(</span><span class="nb">func_get_args</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$arg</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nv">$kv</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nv">$arg</span><span class="p">);</span>
    <span class="nv">$delta</span> <span class="o">+=</span> <span class="nv">$kv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nv">$tbl</span><span class="p">[</span><span class="nx">strtolower</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$kv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))];</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nv">$delta</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">dateInterval</span><span class="p">(</span><span class="nv">$intvltype</span><span class="p">,</span> <span class="nv">$timevalue</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="nv">$tbl</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;sec&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span> <span class="o">=&gt;</span> <span class="mi">60</span><span class="p">,</span> <span class="s1">&#39;hou&#39;</span> <span class="o">=&gt;</span> <span class="mi">3600</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span> <span class="o">=&gt;</span> <span class="mi">86400</span><span class="p">,</span> <span class="s1">&#39;wee&#39;</span> <span class="o">=&gt;</span> <span class="mi">604800</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nx">round</span><span class="p">(</span><span class="nv">$timevalue</span> <span class="o">/</span> <span class="nv">$tbl</span><span class="p">[</span><span class="nx">strtolower</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$intvltype</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))]);</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Extract indexed array from &#39;getdate&#39;</span>
<span class="nv">$today</span> <span class="o">=</span> <span class="nb">getdate</span><span class="p">();</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Today is day %d of the current year</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$today</span><span class="p">[</span><span class="s1">&#39;yday&#39;</span><span class="p">]);</span>

<span class="c1">// Extract indexed, and associative arrays, respectively, from &#39;localtime&#39;</span>
<span class="nv">$today</span> <span class="o">=</span> <span class="nb">localtime</span><span class="p">();</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Today is day %d of the current year</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$today</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>

<span class="nv">$today</span> <span class="o">=</span> <span class="nb">localtime</span><span class="p">(</span><span class="nb">time</span><span class="p">(),</span> <span class="k">TRUE</span><span class="p">);</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Today is day %d of the current year</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$today</span><span class="p">[</span><span class="s1">&#39;tm_yday&#39;</span><span class="p">]);</span>

<span class="c1">// @@PLEAC@@_3.1</span>
<span class="nb">define</span><span class="p">(</span><span class="nx">SEP</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nv">$today</span> <span class="o">=</span> <span class="nb">getdate</span><span class="p">();</span>

<span class="nv">$day</span> <span class="o">=</span> <span class="nv">$today</span><span class="p">[</span><span class="s1">&#39;mday&#39;</span><span class="p">];</span>
<span class="nv">$month</span> <span class="o">=</span> <span class="nv">$today</span><span class="p">[</span><span class="s1">&#39;mon&#39;</span><span class="p">];</span>
<span class="nv">$year</span> <span class="o">=</span> <span class="nv">$today</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">];</span>

<span class="c1">// Either do this to use interpolation:</span>
<span class="nv">$sep</span> <span class="o">=</span> <span class="nx">SEP</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">&quot;Current date is: </span><span class="si">{</span><span class="nv">$year</span><span class="si">}{</span><span class="nv">$sep</span><span class="si">}{</span><span class="nv">$month</span><span class="si">}{</span><span class="nv">$sep</span><span class="si">}{</span><span class="nv">$day</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// or simply concatenate:</span>
<span class="k">echo</span> <span class="s1">&#39;Current date is: &#39;</span> <span class="o">.</span> <span class="nv">$year</span> <span class="o">.</span> <span class="nx">SEP</span> <span class="o">.</span> <span class="nv">$month</span> <span class="o">.</span> <span class="nx">SEP</span> <span class="o">.</span> <span class="nv">$day</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// ------------</span>

<span class="nv">$today</span> <span class="o">=</span> <span class="nb">localtime</span><span class="p">(</span><span class="nb">time</span><span class="p">(),</span> <span class="k">TRUE</span><span class="p">);</span>

<span class="nv">$day</span> <span class="o">=</span> <span class="nv">$today</span><span class="p">[</span><span class="s1">&#39;tm_mday&#39;</span><span class="p">];</span>
<span class="nv">$month</span> <span class="o">=</span> <span class="nv">$today</span><span class="p">[</span><span class="s1">&#39;tm_mon&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$year</span> <span class="o">=</span> <span class="nv">$today</span><span class="p">[</span><span class="s1">&#39;tm_year&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1900</span><span class="p">;</span>

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Current date is: %4d%s%2d%s%2d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$year</span><span class="p">,</span> <span class="nx">SEP</span><span class="p">,</span> <span class="nv">$month</span><span class="p">,</span> <span class="nx">SEP</span><span class="p">,</span> <span class="nv">$day</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nv">$format</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span> <span class="o">.</span> <span class="nx">SEP</span> <span class="o">.</span> <span class="s1">&#39;n&#39;</span> <span class="o">.</span> <span class="nx">SEP</span> <span class="o">.</span> <span class="s1">&#39;d&#39;</span><span class="p">;</span>

<span class="nv">$today</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="nv">$format</span><span class="p">);</span>

<span class="k">echo</span> <span class="s2">&quot;Current date is: </span><span class="si">{</span><span class="nv">$today</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// ------------</span>

<span class="nv">$sep</span> <span class="o">=</span> <span class="nx">SEP</span><span class="p">;</span>

<span class="nv">$today</span> <span class="o">=</span> <span class="nb">strftime</span><span class="p">(</span><span class="s2">&quot;%Y</span><span class="si">$sep</span><span class="s2">%m</span><span class="si">$sep</span><span class="s2">%d&quot;</span><span class="p">);</span>

<span class="k">echo</span> <span class="s2">&quot;Current date is: </span><span class="si">{</span><span class="nv">$today</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// @@PLEAC@@_3.2</span>
<span class="nv">$timestamp</span> <span class="o">=</span> <span class="nb">mktime</span><span class="p">(</span><span class="nv">$hour</span><span class="p">,</span> <span class="nv">$min</span><span class="p">,</span> <span class="nv">$sec</span><span class="p">,</span> <span class="nv">$month</span><span class="p">,</span> <span class="nv">$day</span><span class="p">,</span> <span class="nv">$year</span><span class="p">);</span>

<span class="nv">$timestamp</span> <span class="o">=</span> <span class="nb">gmmktime</span><span class="p">(</span><span class="nv">$hour</span><span class="p">,</span> <span class="nv">$min</span><span class="p">,</span> <span class="nv">$sec</span><span class="p">,</span> <span class="nv">$month</span><span class="p">,</span> <span class="nv">$day</span><span class="p">,</span> <span class="nv">$year</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_3.3</span>
<span class="nv">$dmyhms</span> <span class="o">=</span> <span class="nb">getdate</span><span class="p">();</span>            <span class="c1">// timestamp: current date / time</span>

<span class="nv">$dmyhms</span> <span class="o">=</span> <span class="nb">getdate</span><span class="p">(</span><span class="nv">$timestamp</span><span class="p">);</span>  <span class="c1">// timestamp: arbitrary</span>

<span class="nv">$day</span> <span class="o">=</span> <span class="nv">$dmyhms</span><span class="p">[</span><span class="s1">&#39;mday&#39;</span><span class="p">];</span>
<span class="nv">$month</span> <span class="o">=</span> <span class="nv">$dmyhms</span><span class="p">[</span><span class="s1">&#39;mon&#39;</span><span class="p">];</span>
<span class="nv">$year</span> <span class="o">=</span> <span class="nv">$dmyhms</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">];</span>

<span class="nv">$hours</span> <span class="o">=</span> <span class="nv">$dmyhms</span><span class="p">[</span><span class="s1">&#39;hours&#39;</span><span class="p">];</span>
<span class="nv">$minutes</span> <span class="o">=</span> <span class="nv">$dmyhms</span><span class="p">[</span><span class="s1">&#39;minutes&#39;</span><span class="p">];</span>
<span class="nv">$seconds</span> <span class="o">=</span> <span class="nv">$dmyhms</span><span class="p">[</span><span class="s1">&#39;seconds&#39;</span><span class="p">];</span>

<span class="c1">// @@PLEAC@@_3.4</span>
<span class="c1">// Date arithmetic is probably most easily performed using timestamps [i.e. *NIX Epoch</span>
<span class="c1">// Seconds]. Dates - in whatever form - are converted to timestamps, these are</span>
<span class="c1">// arithmetically manipulated, and the result converted to whatever form required.</span>
<span class="c1">// Note: use &#39;mktime&#39; to create timestamps properly adjusted for daylight saving; whilst</span>
<span class="c1">// &#39;strtotime&#39; is more convenient to use, it does not, AFAIK, include this adjustment</span>

<span class="nv">$when</span> <span class="o">=</span> <span class="nv">$now</span> <span class="o">+</span> <span class="nv">$difference</span><span class="p">;</span>
<span class="nv">$then</span> <span class="o">=</span> <span class="nv">$now</span> <span class="o">-</span> <span class="nv">$difference</span><span class="p">;</span>

<span class="c1">// ------------</span>

<span class="nv">$now</span> <span class="o">=</span> <span class="nb">mktime</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2003</span><span class="p">);</span>

<span class="nv">$diff1</span> <span class="o">=</span> <span class="nx">dateOffset</span><span class="p">(</span><span class="s1">&#39;day=1&#39;</span><span class="p">);</span> <span class="nv">$diff2</span> <span class="o">=</span> <span class="nx">dateOffset</span><span class="p">(</span><span class="s1">&#39;weeks=2&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="s1">&#39;Today is:                 &#39;</span> <span class="o">.</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">,</span> <span class="nv">$now</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;One day in the future is: &#39;</span> <span class="o">.</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">,</span> <span class="nv">$now</span> <span class="o">+</span> <span class="nv">$diff1</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;Two weeks in the past is: &#39;</span> <span class="o">.</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">,</span> <span class="nv">$now</span> <span class="o">-</span> <span class="nv">$diff2</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Date arithmetic performed using a custom function, &#39;dateOffset&#39;. Internally, offset may</span>
<span class="c1">// be computed in one of several ways:</span>
<span class="c1">// * Direct timestamp manipulation - fastest, but no daylight saving adjustment </span>
<span class="c1">// * Via &#39;date&#39; built-in function - slower [?], needs a base time from which to</span>
<span class="c1">//   compute values, but has daylight saving adjustment </span>
<span class="c1">// * Via &#39;strtotime&#39; built-in function - as for &#39;date&#39;</span>
<span class="c1">// * Via &#39;DateTime&#39; class</span>
<span class="c1">//</span>
<span class="c1">// Approach used here is to utilise direct timestamp manipulation in &#39;dateOffset&#39; [it&#39;s</span>
<span class="c1">// performance can also be improved by replacing $tbl with a global definition etc],</span>
<span class="c1">// and to illustrate how the other approaches might be used </span>

<span class="c1">// 1. &#39;dateOffset&#39;</span>

<span class="nv">$birthtime</span> <span class="o">=</span> <span class="nb">mktime</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">1973</span><span class="p">);</span>

<span class="nv">$interval</span> <span class="o">=</span> <span class="nx">dateOffset</span><span class="p">(</span><span class="s1">&#39;day=55&#39;</span><span class="p">,</span> <span class="s1">&#39;hours=2&#39;</span><span class="p">,</span> <span class="s1">&#39;min=17&#39;</span><span class="p">,</span> <span class="s1">&#39;sec=5&#39;</span><span class="p">);</span>

<span class="nv">$then</span> <span class="o">=</span> <span class="nv">$birthtime</span> <span class="o">+</span> <span class="nv">$interval</span><span class="p">;</span>

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Birthtime is: %s</span><span class="se">\n</span><span class="s2">then is:      %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">date</span><span class="p">(</span><span class="nx">DATE_RFC1123</span><span class="p">,</span> <span class="nv">$birthtime</span><span class="p">),</span> <span class="nb">date</span><span class="p">(</span><span class="nx">DATE_RFC1123</span><span class="p">,</span> <span class="nv">$then</span><span class="p">));</span>

<span class="c1">// ------------</span>

<span class="c1">// 2. &#39;date&#39;</span>

<span class="c1">// Base values, and offsets, respectively</span>
<span class="nv">$hr</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="nv">$min</span> <span class="o">=</span> <span class="mi">45</span><span class="p">;</span> <span class="nv">$sec</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span> <span class="nv">$mon</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$day</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span> <span class="nv">$year</span> <span class="o">=</span> <span class="mi">1973</span><span class="p">;</span>

<span class="nv">$yroff</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$monoff</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$dayoff</span> <span class="o">=</span> <span class="mi">55</span><span class="p">;</span> <span class="nv">$hroff</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="nv">$minoff</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span> <span class="nv">$secoff</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

<span class="c1">// Base date</span>
<span class="nv">$birthtime</span> <span class="o">=</span> <span class="nb">mktime</span><span class="p">(</span><span class="nv">$hr</span><span class="p">,</span> <span class="nv">$min</span><span class="p">,</span> <span class="nv">$sec</span><span class="p">,</span> <span class="nv">$mon</span><span class="p">,</span> <span class="nv">$day</span><span class="p">,</span> <span class="nv">$year</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">);</span>

<span class="nv">$year</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="nv">$birthtime</span><span class="p">)</span> <span class="o">+</span> <span class="nv">$yroff</span><span class="p">;</span>
<span class="nv">$mon</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="nv">$birthtime</span><span class="p">)</span> <span class="o">+</span> <span class="nv">$monoff</span><span class="p">;</span>
<span class="nv">$day</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="nv">$birthtime</span><span class="p">)</span> <span class="o">+</span> <span class="nv">$dayoff</span><span class="p">;</span>

<span class="nv">$hr</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="nv">$birthtime</span><span class="p">)</span> <span class="o">+</span> <span class="nv">$hroff</span><span class="p">;</span>
<span class="nv">$min</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="nv">$birthtime</span><span class="p">)</span> <span class="o">+</span> <span class="nv">$minoff</span><span class="p">;</span>
<span class="nv">$sec</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="nv">$birthtime</span><span class="p">)</span> <span class="o">+</span> <span class="nv">$secoff</span><span class="p">;</span>

<span class="c1">// Offset date</span>
<span class="nv">$then</span> <span class="o">=</span> <span class="nb">mktime</span><span class="p">(</span><span class="nv">$hr</span><span class="p">,</span> <span class="nv">$min</span><span class="p">,</span> <span class="nv">$sec</span><span class="p">,</span> <span class="nv">$mon</span><span class="p">,</span> <span class="nv">$day</span><span class="p">,</span> <span class="nv">$year</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">);</span>

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Birthtime is: %s</span><span class="se">\n</span><span class="s2">then is:      %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">date</span><span class="p">(</span><span class="nx">DATE_RFC1123</span><span class="p">,</span> <span class="nv">$birthtime</span><span class="p">),</span> <span class="nb">date</span><span class="p">(</span><span class="nx">DATE_RFC1123</span><span class="p">,</span> <span class="nv">$then</span><span class="p">));</span>

<span class="c1">// ------------</span>

<span class="c1">// 3. &#39;strtotime&#39;</span>

<span class="c1">// Generate timestamp whatever way is preferable</span>
<span class="nv">$birthtime</span> <span class="o">=</span> <span class="nb">mktime</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">1973</span><span class="p">);</span>
<span class="nv">$birthtime</span> <span class="o">=</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;1/18/1973 03:45:50&#39;</span><span class="p">);</span>

<span class="nv">$then</span> <span class="o">=</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;+55 days 2 hours 17 minutes 2 seconds&#39;</span><span class="p">,</span> <span class="nv">$birthtime</span><span class="p">);</span>

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Birthtime is: %s</span><span class="se">\n</span><span class="s2">then is:      %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">date</span><span class="p">(</span><span class="nx">DATE_RFC1123</span><span class="p">,</span> <span class="nv">$birthtime</span><span class="p">),</span> <span class="nb">date</span><span class="p">(</span><span class="nx">DATE_RFC1123</span><span class="p">,</span> <span class="nv">$then</span><span class="p">));</span>

<span class="c1">// ------------</span>

<span class="c1">// 4. &#39;DateTime&#39; class</span>

<span class="nv">$birthtime</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="s1">&#39;1/18/1973 03:45:50&#39;</span><span class="p">);</span>
<span class="nv">$then</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="s1">&#39;1/18/1973 03:45:50&#39;</span><span class="p">);</span>
<span class="nv">$then</span><span class="o">-&gt;</span><span class="na">modify</span><span class="p">(</span><span class="s1">&#39;+55 days 2 hours 17 minutes 2 seconds&#39;</span><span class="p">);</span>

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Birthtime is: %s</span><span class="se">\n</span><span class="s2">then is:      %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$birthtime</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="nx">DATE_RFC1123</span><span class="p">),</span> <span class="nv">$then</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="nx">DATE_RFC1123</span><span class="p">));</span>

<span class="c1">// @@PLEAC@@_3.5</span>
<span class="c1">// Date intervals are most easily computed using timestamps [i.e. *NIX Epoch</span>
<span class="c1">// Seconds] which, of course, gives the interval result is seconds from which</span>
<span class="c1">// all other interval measures [days, weeks, months, years] may be derived.</span>
<span class="c1">// Refer to previous section for discussion of daylight saving and other related</span>
<span class="c1">// problems</span>

<span class="nv">$interval_seconds</span> <span class="o">=</span> <span class="nv">$recent</span> <span class="o">-</span> <span class="nv">$earlier</span><span class="p">;</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Conventional approach ...</span>
<span class="nv">$bree</span> <span class="o">=</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;16 Jun 1981, 4:35:25&#39;</span><span class="p">);</span>
<span class="nv">$nat</span> <span class="o">=</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;18 Jan 1973, 3:45:50&#39;</span><span class="p">);</span>

<span class="c1">// ... or, with daylight saving adjustment</span>
<span class="nv">$bree</span> <span class="o">=</span> <span class="nb">mktime</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1981</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">);</span>
<span class="nv">$nat</span> <span class="o">=</span> <span class="nb">mktime</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">1973</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">);</span>

<span class="nv">$difference</span> <span class="o">=</span> <span class="nv">$bree</span> <span class="o">-</span> <span class="nv">$nat</span><span class="p">;</span>

<span class="c1">// &#39;dateInterval&#39; custom function computes intervals in several measures given an</span>
<span class="c1">// interval in seconds. Note, &#39;month&#39; and &#39;year&#39; measures not provided</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;There were %d seconds between Nat and Bree</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$difference</span><span class="p">);</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;There were %d weeks between Nat and Bree</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nx">dateInterval</span><span class="p">(</span><span class="s1">&#39;weeks&#39;</span><span class="p">,</span> <span class="nv">$difference</span><span class="p">));</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;There were %d days between Nat and Bree</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nx">dateInterval</span><span class="p">(</span><span class="s1">&#39;days&#39;</span><span class="p">,</span> <span class="nv">$difference</span><span class="p">));</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;There were %d hours between Nat and Bree</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nx">dateInterval</span><span class="p">(</span><span class="s1">&#39;hours&#39;</span><span class="p">,</span> <span class="nv">$difference</span><span class="p">));</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;There were %d minutes between Nat and Bree</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nx">dateInterval</span><span class="p">(</span><span class="s1">&#39;mins&#39;</span><span class="p">,</span> <span class="nv">$difference</span><span class="p">));</span>

<span class="c1">// @@PLEAC@@_3.6</span>
<span class="c1">// &#39;getdate&#39; accepts a timestamp [or implicitly calls &#39;time&#39;] and returns an array of</span>
<span class="c1">// date components. It returns much the same information as &#39;strptime&#39; except that</span>
<span class="c1">// the component names are different</span>

<span class="nv">$today</span> <span class="o">=</span> <span class="nb">getdate</span><span class="p">();</span>

<span class="nv">$weekday</span> <span class="o">=</span> <span class="nv">$today</span><span class="p">[</span><span class="s1">&#39;wday&#39;</span><span class="p">];</span>
<span class="nv">$monthday</span> <span class="o">=</span> <span class="nv">$today</span><span class="p">[</span><span class="s1">&#39;mday&#39;</span><span class="p">];</span>
<span class="nv">$yearday</span> <span class="o">=</span> <span class="nv">$today</span><span class="p">[</span><span class="s1">&#39;yday&#39;</span><span class="p">];</span>

<span class="nv">$weeknumber</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nx">round</span><span class="p">(</span><span class="nv">$yearday</span> <span class="o">/</span> <span class="mf">7.0</span><span class="p">);</span>

<span class="c1">// Safter method of obtaining week number</span>
<span class="nv">$weeknumber</span> <span class="o">=</span> <span class="nb">strftime</span><span class="p">(</span><span class="s1">&#39;%U&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">// ----------------------------</span>

<span class="nb">define</span><span class="p">(</span><span class="nx">SEP</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>

<span class="nv">$day</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
<span class="nv">$month</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
<span class="nv">$year</span> <span class="o">=</span> <span class="mi">1981</span><span class="p">;</span>

<span class="nv">$timestamp</span> <span class="o">=</span> <span class="nb">mktime</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$month</span><span class="p">,</span> <span class="nv">$day</span><span class="p">,</span> <span class="nv">$year</span><span class="p">);</span>

<span class="nv">$date</span> <span class="o">=</span> <span class="nb">getdate</span><span class="p">(</span><span class="nv">$timestamp</span><span class="p">);</span>

<span class="nv">$weekday</span> <span class="o">=</span> <span class="nv">$date</span><span class="p">[</span><span class="s1">&#39;wday&#39;</span><span class="p">];</span>
<span class="nv">$monthday</span> <span class="o">=</span> <span class="nv">$date</span><span class="p">[</span><span class="s1">&#39;mday&#39;</span><span class="p">];</span>
<span class="nv">$yearday</span> <span class="o">=</span> <span class="nv">$date</span><span class="p">[</span><span class="s1">&#39;yday&#39;</span><span class="p">];</span>

<span class="nv">$weeknumber</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nx">round</span><span class="p">(</span><span class="nv">$yearday</span> <span class="o">/</span> <span class="mf">7.0</span><span class="p">);</span>

<span class="nv">$weeknumber</span> <span class="o">=</span> <span class="nb">strftime</span><span class="p">(</span><span class="s1">&#39;%U&#39;</span><span class="p">,</span> <span class="nv">$timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">// Interpolate ...</span>
<span class="nv">$sep</span> <span class="o">=</span> <span class="nx">SEP</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$month</span><span class="si">}{</span><span class="nv">$sep</span><span class="si">}{</span><span class="nv">$day</span><span class="si">}{</span><span class="nv">$sep</span><span class="si">}{</span><span class="nv">$year</span><span class="si">}</span><span class="s2"> was a </span><span class="si">{</span><span class="nv">$date</span><span class="p">[</span><span class="s1">&#39;weekday&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> in week </span><span class="si">{</span><span class="nv">$weeknumber</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// ... or, concatenate</span>
<span class="k">echo</span> <span class="nv">$month</span> <span class="o">.</span> <span class="nx">SEP</span> <span class="o">.</span> <span class="nv">$day</span> <span class="o">.</span> <span class="nx">SEP</span> <span class="o">.</span> <span class="nv">$year</span> <span class="o">.</span> <span class="s1">&#39; was a &#39;</span> <span class="o">.</span> <span class="nv">$date</span><span class="p">[</span><span class="s1">&#39;weekday&#39;</span><span class="p">]</span>
     <span class="o">.</span> <span class="s1">&#39; in week &#39;</span> <span class="o">.</span> <span class="nv">$weeknumber</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// @@PLEAC@@_3.7</span>
<span class="c1">// &#39;strtotime&#39; parses a textual date expression by attempting a &#39;best guess&#39; at</span>
<span class="c1">// the format, and either fails, or generates a timestamp. Timestamp could be fed</span>
<span class="c1">// into any one of the various functions; example:</span>
<span class="nv">$timestamp</span> <span class="o">=</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;1998-06-03&#39;</span><span class="p">);</span> <span class="k">echo</span> <span class="nb">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%d&#39;</span><span class="p">,</span> <span class="nv">$timestamp</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// &#39;strptime&#39; parses a textual date expression according to a specified format,</span>
<span class="c1">// and returns an array of date components; components can be easily dumped</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nb">strptime</span><span class="p">(</span><span class="s1">&#39;1998-06-03&#39;</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-%d&#39;</span><span class="p">));</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Parse date string according to format</span>
<span class="nv">$darr</span> <span class="o">=</span> <span class="nb">strptime</span><span class="p">(</span><span class="s1">&#39;1998-06-03&#39;</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-%d&#39;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$darr</span><span class="p">))</span>
<span class="p">{</span>
  <span class="c1">// Show date components in &#39;debug&#39; form</span>
  <span class="nb">print_r</span><span class="p">(</span><span class="nv">$darr</span><span class="p">);</span>

  <span class="c1">// Check whether there was a parse error i.e. one or more components could not</span>
  <span class="c1">// be extracted from the string</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$darr</span><span class="p">[</span><span class="s1">&#39;unparsed&#39;</span><span class="p">]))</span>
  <span class="p">{</span>
    <span class="c1">// Properly parsed date, so validate required components using, &#39;checkdate&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">checkdate</span><span class="p">(</span><span class="nv">$darr</span><span class="p">[</span><span class="s1">&#39;tm_mon&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">$darr</span><span class="p">[</span><span class="s1">&#39;tm_mday&#39;</span><span class="p">],</span> <span class="nv">$darr</span><span class="p">[</span><span class="s1">&#39;tm_year&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1900</span><span class="p">))</span>
      <span class="k">echo</span> <span class="s2">&quot;Parsed date verified as correct</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">echo</span> <span class="s2">&quot;Parsed date failed verification</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;Date string parse not complete; failed components: </span><span class="si">{</span><span class="nv">$darr</span><span class="p">[</span><span class="s1">&#39;unparsed&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;Date string could not be parsed</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_3.8</span>
<span class="c1">// &#39;date&#39; and &#39;strftime&#39; both print a date string based on:</span>
<span class="c1">// * Format String, describing layout of date components</span>
<span class="c1">// * Timestamp [*NIX Epoch Seconds], either given explicitly, or implictly</span>
<span class="c1">//   via a call to &#39;time&#39; which retrieves current time value</span>

<span class="nv">$ts</span> <span class="o">=</span> <span class="mi">1234567890</span><span class="p">;</span>

<span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y/m/d&#39;</span><span class="p">,</span> <span class="nv">$ts</span><span class="p">);</span> 
<span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y/m/d&#39;</span><span class="p">,</span> <span class="nb">mktime</span><span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="nv">$m</span><span class="p">,</span> <span class="nv">$s</span><span class="p">,</span> <span class="nv">$mth</span><span class="p">,</span> <span class="nv">$d</span><span class="p">,</span> <span class="nv">$y</span><span class="p">,</span> <span class="nv">$is_dst</span><span class="p">));</span> 

<span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y/m/d&#39;</span><span class="p">);</span>         <span class="c1">// same as: date(&#39;Y/m/d&#39;, time());</span>

<span class="c1">// ------------</span>

<span class="nv">$ts</span> <span class="o">=</span> <span class="mi">1234567890</span><span class="p">;</span>

<span class="nb">strftime</span><span class="p">(</span><span class="s1">&#39;%Y/%m/%d&#39;</span><span class="p">,</span> <span class="nv">$ts</span><span class="p">);</span>
<span class="nb">strftime</span><span class="p">(</span><span class="s1">&#39;%Y/%m/%d&#39;</span><span class="p">,</span> <span class="nb">mktime</span><span class="p">(</span><span class="nv">$h</span><span class="p">,</span> <span class="nv">$m</span><span class="p">,</span> <span class="nv">$s</span><span class="p">,</span> <span class="nv">$mth</span><span class="p">,</span> <span class="nv">$d</span><span class="p">,</span> <span class="nv">$y</span><span class="p">,</span> <span class="nv">$is_dst</span><span class="p">));</span>

<span class="nb">strftime</span><span class="p">(</span><span class="s1">&#39;%Y/%m/%d&#39;</span><span class="p">);</span>  <span class="c1">// same as: strftime(&#39;%Y/%m/%d&#39;, time());</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// &#39;mktime&#39; creates a local time timestamp</span>
<span class="nv">$t</span> <span class="o">=</span> <span class="nb">strftime</span><span class="p">(</span><span class="s1">&#39;%a %b %e %H:%M:%S %z %Y&#39;</span><span class="p">,</span> <span class="nb">mktime</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">));</span>
<span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$t</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// &#39;gmmktime&#39; creates a GMT time timestamp</span>
<span class="nv">$t</span> <span class="o">=</span> <span class="nb">strftime</span><span class="p">(</span><span class="s1">&#39;%a %b %e %H:%M:%S %z %Y&#39;</span><span class="p">,</span> <span class="nb">gmmktime</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">73</span><span class="p">));</span>
<span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$t</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// &#39;strtotime&#39; parses a textual date expression, and generates a timestamp </span>
<span class="nv">$t</span> <span class="o">=</span> <span class="nb">strftime</span><span class="p">(</span><span class="s1">&#39;%A %D&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;18 Jan 1973, 3:45:50&#39;</span><span class="p">));</span>
<span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$t</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// This should generate output identical to previous example</span>
<span class="nv">$t</span> <span class="o">=</span> <span class="nb">strftime</span><span class="p">(</span><span class="s1">&#39;%A %D&#39;</span><span class="p">,</span> <span class="nb">mktime</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">));</span>
<span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$t</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// @@PLEAC@@_3.9</span>
<span class="c1">// PHP 5 and above can use the built-in, &#39;microtime&#39;. Crude implementation for ealier versions:</span>
<span class="c1">// function microtime() { $t = gettimeofday(); return (float) ($t[&#39;sec&#39;] + $t[&#39;usec&#39;] / 1000000.0); } </span>

<span class="c1">// ------------</span>

<span class="nv">$before</span> <span class="o">=</span> <span class="nb">microtime</span><span class="p">();</span>

<span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">);</span>

<span class="nv">$elapsed</span> <span class="o">=</span> <span class="nb">microtime</span><span class="p">()</span> <span class="o">-</span> <span class="nv">$before</span><span class="p">;</span>

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;You took %.3f seconds</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$elapsed</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nb">define</span><span class="p">(</span><span class="nx">NUMBER_OF_TIMES</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="nx">SIZE</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>

<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nx">NUMBER_OF_TIMES</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$arr</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="nv">$j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span> <span class="nx">SIZE</span><span class="p">;</span> <span class="nv">$j</span><span class="o">++</span><span class="p">)</span> <span class="nv">$arr</span><span class="p">[]</span> <span class="o">=</span> <span class="nx">rand</span><span class="p">();</span>

  <span class="nv">$begin</span> <span class="o">=</span> <span class="nb">microtime</span><span class="p">();</span>
  <span class="nb">sort</span><span class="p">(</span><span class="nv">$arr</span><span class="p">);</span>
  <span class="nv">$elapsed</span> <span class="o">=</span> <span class="nb">microtime</span><span class="p">()</span> <span class="o">-</span> <span class="nv">$begin</span><span class="p">;</span>

  <span class="nv">$total_time</span> <span class="o">+=</span> <span class="nv">$elapsed</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;On average, sorting %d random numbers takes %.5f seconds</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nx">SIZE</span><span class="p">,</span> <span class="nv">$total_time</span> <span class="o">/</span> <span class="p">(</span><span class="nx">float</span><span class="p">)</span> <span class="nx">NUMBER_OF_TIMES</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_3.10</span>
<span class="c1">// Low-resolution: sleep time specified in seconds</span>
<span class="nb">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// High-resolution: sleep time specified in microseconds [not reliable under Windows]</span>
<span class="nb">usleep</span><span class="p">(</span><span class="mi">250000</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_3.11</span>
<span class="c1">// @@INCOMPLETE@@</span>
<span class="c1">// @@INCOMPLETE@@</span>

<span class="c1">// @@PLEAC@@_4.0</span>
<span class="c1">// Nested arrays are supported, and may be easily printed using &#39;print_r&#39;</span>

<span class="nv">$nested</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;this&#39;</span><span class="p">,</span> <span class="s1">&#39;that&#39;</span><span class="p">,</span> <span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;other&#39;</span><span class="p">);</span>

<span class="nv">$nested</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;this&#39;</span><span class="p">,</span> <span class="s1">&#39;that&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;other&#39;</span><span class="p">));</span> <span class="nb">print_r</span><span class="p">(</span><span class="nv">$nested</span><span class="p">);</span>

<span class="nv">$tune</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;The&#39;</span><span class="p">,</span> <span class="s1">&#39;Star-Spangled&#39;</span><span class="p">,</span> <span class="s1">&#39;Banner&#39;</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_4.1</span>
<span class="c1">// PHP offers only the &#39;array&#39; type which is actually an associative array, though</span>
<span class="c1">// may be numerically indexed, to mimic vectors and matrices; there is no separate</span>
<span class="c1">// &#39;list&#39; type</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;quick&#39;</span><span class="p">,</span> <span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="s1">&#39;fox&#39;</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="nb">escapeshellarg</span><span class="p">(</span><span class="s1">&#39;Why are you teasing me?&#39;</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nv">$lines</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;END_OF_HERE_DOC</span>
<span class="s">    The boy stood on the burning deck,</span>
<span class="s">    it was as hot as glass.</span>
<span class="s">END_OF_HERE_DOC;</span>

<span class="c1">// ------------</span>

<span class="nv">$bigarray</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="s1">&#39;rtrim&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">(</span><span class="s1">&#39;mydatafile&#39;</span><span class="p">));</span>

<span class="c1">// ------------</span>

<span class="nv">$banner</span> <span class="o">=</span> <span class="s1">&#39;The mines of Moria&#39;</span><span class="p">;</span>

<span class="nv">$banner</span> <span class="o">=</span> <span class="nb">escapeshellarg</span><span class="p">(</span><span class="s1">&#39;The mines of Moria&#39;</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nv">$name</span> <span class="o">=</span> <span class="s1">&#39;Gandalf&#39;</span><span class="p">;</span>

<span class="nv">$banner</span> <span class="o">=</span> <span class="s2">&quot;Speak </span><span class="si">{</span><span class="nv">$name</span><span class="si">}</span><span class="s2">, and enter!&quot;</span><span class="p">;</span>

<span class="nv">$banner</span> <span class="o">=</span> <span class="s1">&#39;Speak &#39;</span> <span class="o">.</span> <span class="nb">escapeshellarg</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39; and welcome!&#39;</span><span class="p">;</span>

<span class="c1">// ------------</span>

<span class="nv">$his_host</span> <span class="o">=</span> <span class="s1">&#39;www.perl.com&#39;</span><span class="p">;</span>

<span class="nv">$host_info</span> <span class="o">=</span> <span class="sb">`nslookup $his_host`</span><span class="p">;</span>

<span class="nv">$cmd</span> <span class="o">=</span> <span class="s1">&#39;ps &#39;</span> <span class="o">.</span> <span class="nb">posix_getpid</span><span class="p">();</span> <span class="nv">$perl_info</span> <span class="o">=</span> <span class="sb">`$cmd`</span><span class="p">;</span>

<span class="nv">$shell_info</span> <span class="o">=</span> <span class="sb">`ps $$`</span><span class="p">;</span>

<span class="c1">// ------------</span>

<span class="nv">$banner</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Costs&#39;</span><span class="p">,</span> <span class="s1">&#39;only&#39;</span><span class="p">,</span> <span class="s1">&#39;$4.95&#39;</span><span class="p">);</span>

<span class="nv">$banner</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="s1">&#39;escapeshellarg&#39;</span><span class="p">,</span> <span class="nb">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;Costs only $4.95&#39;</span><span class="p">));</span>

<span class="c1">// ------------</span>

<span class="c1">// AFAIK PHP doesn&#39;t support non-quoted strings ala Perl&#39;s &#39;q&#39;, &#39;qq&#39; and &#39;qw&#39;, so arrays</span>
<span class="c1">// created from strings must use quoted strings, and make use of &#39;split&#39; [or equivalent].</span>
<span class="c1">// A slew of functions exist for performing string quoting, including &#39;escapeshellarg&#39;,</span>
<span class="c1">// &#39;quotemeta&#39;, and &#39;preg_quote&#39;</span>

<span class="nv">$brax</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;( ) &lt; &gt; { } [ ]&#39;</span><span class="p">);</span>

<span class="c1">// Do this to quote each element within &#39;..&#39;</span>
<span class="c1">// $brax = array_map(&#39;escapeshellarg&#39;, split(&#39; &#39;, &#39;( ) &lt; &gt; { } [ ]&#39;));</span>

<span class="nv">$rings</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;Nenya Narya Vilya&#39;</span><span class="p">);</span>

<span class="nv">$tags</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;LI TABLE TR TD A IMG H1 P&#39;</span><span class="p">);</span>

<span class="nv">$sample</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;The vertical bar | looks and behaves like a pipe.&#39;</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_4.2</span>
<span class="k">function</span> <span class="nf">commify_series</span><span class="p">(</span><span class="nv">$list</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$n</span> <span class="o">=</span> <span class="nb">str_word_count</span><span class="p">(</span><span class="nv">$list</span><span class="p">);</span> <span class="nv">$series</span> <span class="o">=</span> <span class="nb">str_word_count</span><span class="p">(</span><span class="nv">$list</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nv">$n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="k">NULL</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nv">$series</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="nv">$series</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39; and &#39;</span> <span class="o">.</span> <span class="nv">$series</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
  
  <span class="k">return</span> <span class="nb">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$series</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">.</span> <span class="s1">&#39;, and &#39;</span> <span class="o">.</span> <span class="nv">$series</span><span class="p">[</span><span class="nv">$n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="k">echo</span> <span class="nx">commify_series</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="nx">commify_series</span><span class="p">(</span><span class="s1">&#39;red yellow&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="nx">commify_series</span><span class="p">(</span><span class="s1">&#39;red yellow green&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="nv">$mylist</span> <span class="o">=</span> <span class="s1">&#39;red yellow green&#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;I have &#39;</span> <span class="o">.</span> <span class="nx">commify_series</span><span class="p">(</span><span class="nv">$mylist</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot; marbles.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">commify_series</span><span class="p">(</span><span class="nv">$arr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$n</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$arr</span><span class="p">);</span> <span class="nv">$sepchar</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">;</span>

  <span class="k">foreach</span><span class="p">(</span><span class="nv">$arr</span> <span class="k">as</span> <span class="nv">$str</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
    <span class="nv">$sepchar</span> <span class="o">=</span> <span class="s1">&#39;;&#39;</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span> 
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nv">$n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="k">NULL</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nv">$arr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="nv">$arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39; and &#39;</span> <span class="o">.</span> <span class="nv">$arr</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
  
  <span class="k">return</span> <span class="nb">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{</span><span class="nv">$sepchar</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$sepchar</span><span class="si">}</span><span class="s2"> and &quot;</span> <span class="o">.</span> <span class="nv">$arr</span><span class="p">[</span><span class="nv">$n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$lists</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
  <span class="k">array</span><span class="p">(</span><span class="s1">&#39;just one thing&#39;</span><span class="p">),</span>
  <span class="nb">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;Mutt Jeff&#39;</span><span class="p">),</span>
  <span class="nb">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;Peter Paul Mary&#39;</span><span class="p">),</span>
  <span class="k">array</span><span class="p">(</span><span class="s1">&#39;To our parents&#39;</span><span class="p">,</span> <span class="s1">&#39;Mother Theresa&#39;</span><span class="p">,</span> <span class="s1">&#39;God&#39;</span><span class="p">),</span>
  <span class="k">array</span><span class="p">(</span><span class="s1">&#39;pastrami&#39;</span><span class="p">,</span> <span class="s1">&#39;ham and cheese&#39;</span><span class="p">,</span> <span class="s1">&#39;peanut butter and jelly&#39;</span><span class="p">,</span> <span class="s1">&#39;tuna&#39;</span><span class="p">),</span>
  <span class="k">array</span><span class="p">(</span><span class="s1">&#39;recycle tired, old phrases&#39;</span><span class="p">,</span> <span class="s1">&#39;ponder big, happy thoughts&#39;</span><span class="p">),</span>
  <span class="k">array</span><span class="p">(</span><span class="s1">&#39;recycle tired, old phrases&#39;</span><span class="p">,</span> <span class="s1">&#39;ponder big, happy thoughts&#39;</span><span class="p">,</span> <span class="s1">&#39;sleep and dream peacefully&#39;</span><span class="p">));</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$lists</span> <span class="k">as</span> <span class="nv">$arr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s1">&#39;The list is: &#39;</span> <span class="o">.</span> <span class="nx">commify_series</span><span class="p">(</span><span class="nv">$arr</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_4.3</span>
<span class="c1">// AFAICT you cannot grow / shrink an array to an arbitrary size. However, you can:</span>
<span class="c1">// * Grow an array by appending an element using subscrip notation, or using</span>
<span class="c1">//   either &#39;array_unshift&#39; or &#39;array_push&#39; to add one or more elements</span>

<span class="nv">$arr</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">&#39;one&#39;</span><span class="p">;</span>
<span class="nb">array_unshift</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">);</span>
<span class="nb">array_push</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">);</span>

<span class="c1">// * Shrink an array by using &#39;unset&#39; to remove one or more specific elements, or</span>
<span class="c1">//   either &#39;array_shift&#39; or &#39;array_pop&#39; to remove an element from the ends</span>

<span class="nb">unset</span><span class="p">(</span><span class="nv">$arr</span><span class="p">[</span><span class="nv">$idx1</span><span class="p">],</span> <span class="nv">$arr</span><span class="p">[</span><span class="nv">$idx2</span><span class="p">],</span> <span class="nv">$arr</span><span class="p">[</span><span class="nv">$idx3</span><span class="p">]);</span>
<span class="nv">$item</span> <span class="o">=</span> <span class="nb">array_shift</span><span class="p">(</span><span class="nv">$arr</span><span class="p">);</span>
<span class="nv">$item</span> <span class="o">=</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$arr</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">what_about_the_array</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">global</span> <span class="nv">$people</span><span class="p">;</span>

  <span class="k">echo</span> <span class="s1">&#39;The array now has &#39;</span> <span class="o">.</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$people</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot; elements</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s1">&#39;The index value of the last element is &#39;</span> <span class="o">.</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$people</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s1">&#39;Element #3 is &#39;</span> <span class="o">.</span> <span class="nv">$people</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$people</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Crosby&#39;</span><span class="p">,</span> <span class="s1">&#39;Stills&#39;</span><span class="p">,</span> <span class="s1">&#39;Nash&#39;</span><span class="p">,</span> <span class="s1">&#39;Young&#39;</span><span class="p">);</span>
<span class="nx">what_about_the_array</span><span class="p">();</span>

<span class="nb">array_pop</span><span class="p">(</span><span class="nv">$people</span><span class="p">);</span>
<span class="nx">what_about_the_array</span><span class="p">();</span>

<span class="c1">// Cannot, AFAICT, resize the array to an arbitrary size</span>

<span class="c1"># @@PLEAC@@_4.4</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$list</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something with $item</span>
<span class="p">}</span>

<span class="c1">// Environment listing example</span>

<span class="c1">// PHP defines a superglobal $_ENV to provide access to environment</span>
<span class="c1">// variables.</span>

<span class="c1">// Beware, array assignment means copying in PHP. You need to use</span>
<span class="c1">// the reference operator to avoid copying. But we want a copy here.</span>
<span class="nv">$env</span> <span class="o">=</span> <span class="nv">$_ENV</span><span class="p">;</span>

<span class="c1">// PHP can sort an array by key, so you don&#39;t need to get keys,</span>
<span class="c1">// and then sort.</span>
<span class="nb">ksort</span><span class="p">(</span><span class="nv">$env</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$env</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$key</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="nv">$value</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Literal translation of Perl example would be:</span>
<span class="nv">$keys</span> <span class="o">=</span> <span class="nb">array_keys</span><span class="p">(</span><span class="nv">$_ENV</span><span class="p">);</span>
<span class="nb">sort</span><span class="p">(</span><span class="nv">$keys</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$keys</span> <span class="k">as</span> <span class="nv">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$key</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="nv">$_ENV</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// This assumes that MAX_QUOTA is a named constant.</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$all_users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$disk_space</span> <span class="o">=</span> <span class="nx">get_usage</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$disk_space</span> <span class="o">&gt;</span> <span class="nx">MAX_QUOTA</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">complain</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// You can&#39;t modify array&#39;s elements in-place.</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="nv">$newarray</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$newarray</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$item</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$newarray</span><span class="p">);</span>

<span class="c1">// Before PHP 5, that is. You can precede the reference operator</span>
<span class="c1">// before $item to get reference instead of copy.</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$item</span><span class="o">--</span><span class="p">;</span>
<span class="p">}</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>

<span class="c1">// TODO: explain the old each() and list() iteration construct.</span>
<span class="c1">// foreach is new in PHP 4, and there are subtle differences.</span>

<span class="c1">// @@PLEAC@@_4.5</span>
<span class="c1">// Conventional &#39;read-only&#39; access</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// Can access, but not update, array element referred to by &#39;$item&#39;</span>
<span class="p">}</span>

<span class="c1">// ----</span>

<span class="c1">// &#39;&amp;&#39; makes &#39;$item&#39; a reference</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$item</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// Update array element referred to by &#39;$item&#39;</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$arraylen</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>

<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$arraylen</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// &#39;$array&#39; is updateable via subscript notation</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$fruits</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Apple&#39;</span><span class="p">,</span> <span class="s1">&#39;Raspberry&#39;</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$fruits</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$fruit</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$fruit</span><span class="si">}</span><span class="s2"> tastes good in a pie.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$fruitlen</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$fruits</span><span class="p">);</span>

<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$fruitlen</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$fruits</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="si">}</span><span class="s2"> tastes good in a pie.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$rogue_cats</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Blackie&#39;</span><span class="p">,</span> <span class="s1">&#39;Goldie&#39;</span><span class="p">,</span> <span class="s1">&#39;Silkie&#39;</span><span class="p">);</span>

<span class="c1">// Take care to assign reference to &#39;$rogue_cats&#39; array via &#39;=&amp;&#39;</span>
<span class="nv">$namelist</span><span class="p">[</span><span class="s1">&#39;felines&#39;</span><span class="p">]</span> <span class="o">=&amp;</span> <span class="nv">$rogue_cats</span><span class="p">;</span>

<span class="c1">// Take care to make &#39;$cat&#39; a reference via &#39;&amp;$&#39; to allow updating</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$namelist</span><span class="p">[</span><span class="s1">&#39;felines&#39;</span><span class="p">]</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$cat</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$cat</span> <span class="o">.=</span> <span class="s1">&#39; [meow]&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Via array reference</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$namelist</span><span class="p">[</span><span class="s1">&#39;felines&#39;</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$cat</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$cat</span><span class="si">}</span><span class="s2"> purrs hypnotically.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">echo</span> <span class="s2">&quot;---</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// Original array</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$rogue_cats</span> <span class="k">as</span> <span class="nv">$cat</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$cat</span><span class="si">}</span><span class="s2"> purrs hypnotically.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_4.6</span>
<span class="c1">// PHP offers the &#39;array_unique&#39; function to perform this task. It works with both keyed,</span>
<span class="c1">// and numerically-indexed arrays; keys / indexes are preserved; use of &#39;array_values&#39; </span>
<span class="c1">// is recommended to reindex numerically-indexed arrays since there will likely be missing</span>
<span class="c1">// indexes</span>

<span class="c1">// Remove duplicate values</span>
<span class="nv">$unique</span> <span class="o">=</span> <span class="nb">array_unique</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>

<span class="c1">// Remove duplicates, and reindex [for numerically-indexed arrays only]</span>
<span class="nv">$unique</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nb">array_unique</span><span class="p">(</span><span class="nv">$array</span><span class="p">));</span>

<span class="c1">// or use:</span>
<span class="nv">$unique</span> <span class="o">=</span> <span class="nb">array_keys</span><span class="p">(</span><span class="nb">array_flip</span><span class="p">(</span><span class="nv">$array</span><span class="p">));</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Selected Perl &#39;seen&#39; examples</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$list</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$seen</span><span class="p">[</span><span class="nv">$item</span><span class="p">]))</span>
  <span class="p">{</span>
    <span class="nv">$seen</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span>
    <span class="nv">$unique</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$item</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$list</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$seen</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">||</span> <span class="p">(</span><span class="o">++</span><span class="nv">$seen</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$unique</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$item</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="k">function</span> <span class="nf">some_func</span><span class="p">(</span><span class="nv">$item</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// Do something with &#39;$item&#39;</span>
<span class="p">}</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$list</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$seen</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">||</span> <span class="p">(</span><span class="o">++</span><span class="nv">$seen</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">some_func</span><span class="p">(</span><span class="nv">$item</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="k">foreach</span><span class="p">(</span><span class="nb">array_slice</span><span class="p">(</span><span class="nb">preg_split</span><span class="p">(</span><span class="s1">&#39;/\n/&#39;</span><span class="p">,</span> <span class="sb">`who`</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$user_entry</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$user</span> <span class="o">=</span> <span class="nb">preg_split</span><span class="p">(</span><span class="s1">&#39;/\s/&#39;</span><span class="p">,</span> <span class="nv">$user_entry</span><span class="p">);</span>
  <span class="nv">$ucnt</span><span class="p">[</span><span class="nv">$user</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">ksort</span><span class="p">(</span><span class="nv">$ucnt</span><span class="p">);</span>

<span class="k">echo</span> <span class="s2">&quot;users logged in:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$ucnt</span> <span class="k">as</span> <span class="nv">$user</span> <span class="o">=&gt;</span> <span class="nv">$cnt</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="si">{</span><span class="nv">$user</span><span class="si">}</span><span class="s2"> =&gt; </span><span class="si">{</span><span class="nv">$cnt</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_4.7</span>
<span class="c1">// PHP offers the &#39;array_diff&#39; and &#39;array_diff_assoc&#39; functions to perform this task. Same</span>
<span class="c1">// points as made about &#39;array_unique&#39; apply here also</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">);</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">);</span>

<span class="nv">$diff</span> <span class="o">=</span> <span class="nb">array_diff</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>                 <span class="c1">// $diff -&gt; [3] &#39;d&#39;</span>
<span class="nv">$diff</span> <span class="o">=</span> <span class="nb">array_diff</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$a</span><span class="p">);</span>                 <span class="c1">// $diff -&gt; [3] &#39;e&#39;</span>

<span class="c1">// Numerically-indexed array, reindexed</span>
<span class="nv">$diff</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nb">array_diff</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">));</span>   <span class="c1">// $diff -&gt; [0] &#39;d&#39;</span>
<span class="nv">$diff</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nb">array_diff</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$a</span><span class="p">));</span>   <span class="c1">// $diff -&gt; [0] &#39;e&#39;</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// 1st Perl &#39;seen&#39; example only</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;k1&#39;</span> <span class="o">=&gt;</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;k2&#39;</span> <span class="o">=&gt;</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;k4&#39;</span> <span class="o">=&gt;</span> <span class="mi">14</span><span class="p">);</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;k1&#39;</span> <span class="o">=&gt;</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;k2&#39;</span> <span class="o">=&gt;</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;k3&#39;</span> <span class="o">=&gt;</span> <span class="mi">13</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$b</span> <span class="k">as</span> <span class="nv">$item</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$seen</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>

<span class="c1">// Stores key only e.g. $aonly[0] contains &#39;k4&#39;, same as Perl example</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span> <span class="k">as</span> <span class="nv">$item</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$seen</span><span class="p">[</span><span class="nv">$item</span><span class="p">])</span> <span class="nv">$aonly</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$item</span><span class="p">;</span> <span class="p">}</span>

<span class="c1">// Stores key and value e.g. $aonly[&#39;k4&#39;] contains 14, same entry as in $a</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span> <span class="k">as</span> <span class="nv">$item</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$seen</span><span class="p">[</span><span class="nv">$item</span><span class="p">])</span> <span class="nv">$aonly</span><span class="p">[</span><span class="nv">$item</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span> <span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Conventional way: $hash = array(&#39;key1&#39; =&gt; 1, &#39;key2&#39; =&gt; 2);</span>

<span class="nv">$hash</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$hash</span><span class="p">[</span><span class="s1">&#39;key2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="nv">$hash</span> <span class="o">=</span> <span class="nb">array_combine</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>

<span class="c1">// ------------</span>

<span class="nv">$seen</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="nv">$seen</span> <span class="o">=</span> <span class="nb">array_combine</span><span class="p">(</span><span class="nb">array_keys</span><span class="p">(</span><span class="nv">$b</span><span class="p">),</span> <span class="nb">array_fill</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$b</span><span class="p">),</span> <span class="mi">1</span><span class="p">));</span>

<span class="c1">// @@PLEAC@@_4.8</span>
<span class="c1">// PHP offers a number of array-based &#39;set operation&#39; functions:</span>
<span class="c1">// * union:        array_unique(array_merge(...))</span>
<span class="c1">// * intersection: array_intersect and family</span>
<span class="c1">// * difference:   array_diff and family</span>
<span class="c1">// which may be used for this type of task. Also, if returned arrays need to be</span>
<span class="c1">// reindexed, &#39;array_slice($array, 0)&#39;, or &#39;array_values($array)&#39; are useful</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>

<span class="nv">$union</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nb">array_unique</span><span class="p">(</span><span class="nb">array_merge</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)));</span> <span class="c1">// 1, 2, 3, 5, 6, 7, 8, 9</span>
<span class="nv">$isect</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nb">array_intersect</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">));</span>           <span class="c1">// 3, 5, 7</span>
<span class="nv">$diff</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nb">array_diff</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">));</span>                 <span class="c1">// 1, 8</span>

<span class="c1">// @@PLEAC@@_4.9</span>
<span class="c1">// PHP offers the &#39;array_merge&#39; function to perform this task. Duplicate values are retained,</span>
<span class="c1">// but if arrays are numerically-indexed, resulting array is reindexed</span>

<span class="nv">$arr1</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">);</span>
<span class="nv">$arr2</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">);</span>

<span class="nv">$new</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$arr1</span><span class="p">,</span> <span class="nv">$arr2</span><span class="p">);</span>     <span class="c1">// $new -&gt; &#39;c&#39;, &#39;a&#39;, &#39;b&#39;, &#39;d&#39;, &#39;c&#39;, &#39;a&#39;, &#39;b&#39;, &#39;d&#39;</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$members</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Flies&#39;</span><span class="p">);</span>
<span class="nv">$initiates</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;An&#39;</span><span class="p">,</span> <span class="s1">&#39;Arrow&#39;</span><span class="p">);</span>

<span class="nv">$members</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$members</span><span class="p">,</span> <span class="nv">$initiates</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nv">$members</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Flies&#39;</span><span class="p">);</span>
<span class="nv">$initiates</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;An&#39;</span><span class="p">,</span> <span class="s1">&#39;Arrow&#39;</span><span class="p">);</span>

<span class="c1">// &#39;array_splice&#39; is the PHP equivalent to Perl&#39;s &#39;splice&#39;</span>
<span class="nb">array_splice</span><span class="p">(</span><span class="nv">$members</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">array_merge</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;Like&#39;</span><span class="p">),</span> <span class="nv">$initiates</span><span class="p">));</span>
<span class="k">echo</span> <span class="nb">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nv">$members</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="nb">array_splice</span><span class="p">(</span><span class="nv">$members</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Fruit&#39;</span><span class="p">));</span>
<span class="nb">array_splice</span><span class="p">(</span><span class="nv">$members</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;Banana&#39;</span><span class="p">));</span>
<span class="k">echo</span> <span class="nb">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nv">$members</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// @@PLEAC@@_4.10</span>
<span class="nv">$reversed</span> <span class="o">=</span> <span class="nb">array_reverse</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="k">foreach</span><span class="p">(</span><span class="nb">array_reverse</span><span class="p">(</span><span class="nv">$array</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ... do something with &#39;$item&#39; ...</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$array</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span><span class="o">--</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ... do something with &#39;$array[$i]&#39; ...</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="nb">sort</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="nb">array_reverse</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nb">rsort</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_4.11</span>
<span class="c1">// Array elements can be deleted using &#39;unset&#39;; removing several elements would require applying</span>
<span class="c1">// &#39;unset&#39; several times, probably in a loop. However, they would most likely also need to be</span>
<span class="c1">// reindexed, so a better approach would be to use &#39;array_slice&#39; which avoids explicit looping.</span>
<span class="c1">// Where elements need to be removed, and those elements also returned, it is probably best to</span>
<span class="c1">// combine both operations in a function. This is the approach taken here in implementing both</span>
<span class="c1">// &#39;shiftN&#39; and &#39;popN&#39;, and it is these functions that are used in the examples</span>

<span class="k">function</span> <span class="nf">popN</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$arr</span><span class="p">,</span> <span class="nv">$n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$ret</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="nv">$n</span><span class="p">),</span> <span class="nv">$n</span><span class="p">);</span>
  <span class="nv">$arr</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$arr</span><span class="p">)</span> <span class="o">-</span> <span class="nv">$n</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">shiftN</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$arr</span><span class="p">,</span> <span class="nv">$n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$ret</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$n</span><span class="p">);</span>
  <span class="nv">$arr</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="nv">$n</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="c1">// Remove $n elements from the front of $array; return them in $fron</span>
<span class="nv">$front</span> <span class="o">=</span> <span class="nx">shiftN</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="nv">$n</span><span class="p">);</span>

<span class="c1">// Remove $n elements from the end of $array; return them in $end</span>
<span class="nv">$end</span> <span class="o">=</span> <span class="nx">popN</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="nv">$n</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nv">$friends</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Peter&#39;</span><span class="p">,</span> <span class="s1">&#39;Paul&#39;</span><span class="p">,</span> <span class="s1">&#39;Mary&#39;</span><span class="p">,</span> <span class="s1">&#39;Jim&#39;</span><span class="p">,</span> <span class="s1">&#39;Tim&#39;</span><span class="p">);</span>

<span class="k">list</span><span class="p">(</span><span class="nv">$this_</span><span class="p">,</span> <span class="nv">$that</span><span class="p">)</span> <span class="o">=</span> <span class="nx">shiftN</span><span class="p">(</span><span class="nv">$friends</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$this_</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nv">$that</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// ------------</span>

<span class="nv">$beverages</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Dew&#39;</span><span class="p">,</span> <span class="s1">&#39;Jolt&#39;</span><span class="p">,</span> <span class="s1">&#39;Cola&#39;</span><span class="p">,</span> <span class="s1">&#39;Sprite&#39;</span><span class="p">,</span> <span class="s1">&#39;Fresca&#39;</span><span class="p">);</span>

<span class="nv">$pair</span> <span class="o">=</span> <span class="nx">popN</span><span class="p">(</span><span class="nv">$beverages</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="k">echo</span> <span class="nb">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nv">$pair</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// @@PLEAC@@_4.12</span>
<span class="c1">// This section illustrates various &#39;find first&#39; techniques. The Perl examples all use an</span>
<span class="c1">// explicit loop and condition testing [also repeated here]. This is the simplest, and</span>
<span class="c1">// [potentially] most efficient approach because the search can be terminated as soon as a</span>
<span class="c1">// match is found. However, it is worth mentioning a few alternatives:</span>
<span class="c1">// * &#39;array_search&#39; performs a &#39;find first&#39; using the element value rather than a condition</span>
<span class="c1">//    check, so isn&#39;t really applicable here</span>
<span class="c1">// * &#39;array_filter&#39;, whilst using a condition check, actually performs a &#39;find all&#39;, though</span>
<span class="c1">//   all but the first returned element can be discarded. This approach is actually less error</span>
<span class="c1">//   prone than using a loop, but the disadvantage is that each element is visited: there is no</span>
<span class="c1">//   means of terminating the search once a match has been found. It would be nice if this</span>
<span class="c1">//   function were to have a third parameter, a Boolean flag indicating whether to traverse</span>
<span class="c1">//   the whole array, or quit after first match [next version, maybe :) ?]</span>

<span class="nv">$found</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Not found - skip to next item</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$criterion</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>

  <span class="c1">// Found - save and leave</span>
  <span class="nv">$match</span> <span class="o">=</span> <span class="nv">$item</span><span class="p">;</span>
  <span class="nv">$found</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span>
  <span class="k">break</span><span class="p">;</span>  
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$found</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// do something with $match</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// not found</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="k">function</span> <span class="nf">predicate</span><span class="p">(</span><span class="nv">$element</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">criterion</span><span class="p">)</span> <span class="k">return</span> <span class="k">TRUE</span><span class="p">;</span>
  <span class="k">return</span> <span class="k">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$match</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nb">array_filter</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="s1">&#39;predicate&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$match</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// do something with $match[0]</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// $match is empty - not found</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="k">class</span> <span class="nc">Employee</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="nv">$name</span><span class="p">,</span> <span class="nv">$age</span><span class="p">,</span> <span class="nv">$ssn</span><span class="p">,</span> <span class="nv">$salary</span><span class="p">;</span>

  <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$age</span><span class="p">,</span> <span class="nv">$ssn</span><span class="p">,</span> <span class="nv">$salary</span><span class="p">,</span> <span class="nv">$category</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">age</span> <span class="o">=</span> <span class="nv">$age</span><span class="p">;</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ssn</span> <span class="o">=</span> <span class="nv">$ssn</span><span class="p">;</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">salary</span> <span class="o">=</span> <span class="nv">$salary</span><span class="p">;</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">category</span> <span class="o">=</span> <span class="nv">$category</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$employees</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
  <span class="k">new</span> <span class="nx">Employee</span><span class="p">(</span><span class="s1">&#39;sdf&#39;</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">12345</span><span class="p">,</span> <span class="mi">47000</span><span class="p">,</span> <span class="s1">&#39;Engineer&#39;</span><span class="p">),</span>
  <span class="k">new</span> <span class="nx">Employee</span><span class="p">(</span><span class="s1">&#39;ajb&#39;</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">12376</span><span class="p">,</span> <span class="mi">51000</span><span class="p">,</span> <span class="s1">&#39;Programmer&#39;</span><span class="p">),</span>
  <span class="k">new</span> <span class="nx">Employee</span><span class="p">(</span><span class="s1">&#39;dgh&#39;</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">12355</span><span class="p">,</span> <span class="mi">45000</span><span class="p">,</span> <span class="s1">&#39;Engineer&#39;</span><span class="p">));</span>

<span class="c1">// ------------</span>

<span class="k">function</span> <span class="nf">array_update</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="nv">$lambda</span><span class="p">,</span> <span class="nv">$updarr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nv">$arr</span> <span class="k">as</span> <span class="nv">$key</span><span class="p">)</span> <span class="nv">$lambda</span><span class="p">(</span><span class="nv">$updarr</span><span class="p">,</span> <span class="nv">$key</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$updarr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">highest_salaried_engineer</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$arr</span><span class="p">,</span> <span class="nv">$employee</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="nv">$highest_salary</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nv">$employee</span><span class="o">-&gt;</span><span class="na">category</span> <span class="o">==</span> <span class="s1">&#39;Engineer&#39;</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$employee</span><span class="o">-&gt;</span><span class="na">salary</span> <span class="o">&gt;</span> <span class="nv">$highest_salary</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="nv">$highest_salary</span> <span class="o">=</span> <span class="nv">$employee</span><span class="o">-&gt;</span><span class="na">salary</span><span class="p">;</span>
      <span class="nv">$arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$employee</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="c1">// &#39;array_update&#39; custom function is modelled on &#39;array_reduce&#39; except that it allows the</span>
<span class="c1">// return of an array, contents and length of which are entirely dependant on what the</span>
<span class="c1">// callback function does. Here, it is logically working in a &#39;find first&#39; capacity</span>
<span class="nv">$highest_salaried_engineer</span> <span class="o">=</span> <span class="nx">array_update</span><span class="p">(</span><span class="nv">$employees</span><span class="p">,</span> <span class="s1">&#39;highest_salaried_engineer&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>

<span class="k">echo</span> <span class="s1">&#39;Highest paid engineer is: &#39;</span> <span class="o">.</span> <span class="nv">$highest_salaried_engineer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// @@PLEAC@@_4.13</span>
<span class="c1">// PHP implements &#39;grep&#39; functionality [as embodied in the current section] in the &#39;array_filter&#39;</span>
<span class="c1">// function</span>

<span class="k">function</span> <span class="nf">predicate</span><span class="p">(</span><span class="nv">$element</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">criterion</span><span class="p">)</span> <span class="k">return</span> <span class="k">TRUE</span><span class="p">;</span>
  <span class="k">return</span> <span class="k">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$matching</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$list</span><span class="p">,</span> <span class="s1">&#39;predicate&#39;</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nv">$bigs</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$nums</span><span class="p">,</span> <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$n&#39;</span><span class="p">,</span> <span class="s1">&#39;return $n &gt; 1000000;&#39;</span><span class="p">));</span>

<span class="c1">// ------------</span>

<span class="k">function</span> <span class="nf">is_pig</span><span class="p">(</span><span class="nv">$user</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$user_details</span> <span class="o">=</span> <span class="nb">preg_split</span><span class="p">(</span><span class="s1">&#39;/(\s)+/&#39;</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>
  <span class="c1">// Assuming field 5 is the resource being compared</span>
  <span class="k">return</span> <span class="nv">$user_details</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1e7</span><span class="p">;</span>  
<span class="p">}</span>

<span class="nv">$pigs</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nb">array_slice</span><span class="p">(</span><span class="nb">preg_split</span><span class="p">(</span><span class="s1">&#39;/\n/&#39;</span><span class="p">,</span> <span class="sb">`who -u`</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;is_pig&#39;</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nv">$matching</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nb">array_slice</span><span class="p">(</span><span class="nb">preg_split</span><span class="p">(</span><span class="s1">&#39;/\n/&#39;</span><span class="p">,</span> <span class="sb">`who`</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                         <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$user&#39;</span><span class="p">,</span> <span class="s1">&#39;return preg_match(\&#39;/^gnat /\&#39;, $user);&#39;</span><span class="p">));</span>

<span class="c1">// ------------</span>

<span class="k">class</span> <span class="nc">Employee</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="nv">$name</span><span class="p">,</span> <span class="nv">$age</span><span class="p">,</span> <span class="nv">$ssn</span><span class="p">,</span> <span class="nv">$salary</span><span class="p">;</span>

  <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$age</span><span class="p">,</span> <span class="nv">$ssn</span><span class="p">,</span> <span class="nv">$salary</span><span class="p">,</span> <span class="nv">$category</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">age</span> <span class="o">=</span> <span class="nv">$age</span><span class="p">;</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ssn</span> <span class="o">=</span> <span class="nv">$ssn</span><span class="p">;</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">salary</span> <span class="o">=</span> <span class="nv">$salary</span><span class="p">;</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">category</span> <span class="o">=</span> <span class="nv">$category</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$employees</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
  <span class="k">new</span> <span class="nx">Employee</span><span class="p">(</span><span class="s1">&#39;sdf&#39;</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">12345</span><span class="p">,</span> <span class="mi">47000</span><span class="p">,</span> <span class="s1">&#39;Engineer&#39;</span><span class="p">),</span>
  <span class="k">new</span> <span class="nx">Employee</span><span class="p">(</span><span class="s1">&#39;ajb&#39;</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">12376</span><span class="p">,</span> <span class="mi">51000</span><span class="p">,</span> <span class="s1">&#39;Programmer&#39;</span><span class="p">),</span>
  <span class="k">new</span> <span class="nx">Employee</span><span class="p">(</span><span class="s1">&#39;dgh&#39;</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">12355</span><span class="p">,</span> <span class="mi">45000</span><span class="p">,</span> <span class="s1">&#39;Engineer&#39;</span><span class="p">));</span>

<span class="c1">// ------------</span>

<span class="nv">$engineers</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$employees</span><span class="p">,</span>
                          <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$employee&#39;</span><span class="p">,</span> <span class="s1">&#39;return $employee-&gt;category == &quot;Engineer&quot;;&#39;</span><span class="p">));</span>

<span class="c1">// @@PLEAC@@_4.14</span>
<span class="c1">// PHP offers a rich set of sorting functions. Key features:</span>
<span class="c1">// * Inplace sorts; the original array, not a a copy, is sorted</span>
<span class="c1">// * Separate functions exist for sorting [both ascending and descending order]:</span>
<span class="c1">//   - By value, assign new keys / indices [sort, rsort]</span>
<span class="c1">//   - By key   [ksort, krsort] (for non-numerically indexed arrays)</span>
<span class="c1">//   - By value [asort, arsort]</span>
<span class="c1">//   - As above, but using a user-defined comparator [i.e. callback function]</span>
<span class="c1">//     [usort, uasort, uksort]</span>
<span class="c1">//   - Natural order sort [natsort]</span>
<span class="c1">// * Significantly, if sorting digit-only elements, whether strings or numbers,</span>
<span class="c1">//   &#39;natural order&#39; [i.e. 1 before 10 before 100 (ascending)] is retained. If</span>
<span class="c1">//   the elements are alphanumeric e.g. &#39;z1&#39;, &#39;z10&#39; then &#39;natsort&#39; should be</span>
<span class="c1">//   used [note: beware of &#39;natsort&#39; with negative numbers; prefer &#39;sort&#39; or &#39;asort&#39;]</span>

<span class="nv">$unsorted</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">13</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

<span class="nb">sort</span><span class="p">(</span><span class="nv">$unsorted</span><span class="p">);</span>                 <span class="c1">// -13, -2, 1, 2, 3, 4, 5, 6, 7, 12, 23, 100</span>
<span class="nb">rsort</span><span class="p">(</span><span class="nv">$unsorted</span><span class="p">);</span>                <span class="c1">// 100, 23, 12, 7, 6, 5, 4, 3, 2, 1, -2, -13</span>

<span class="nb">asort</span><span class="p">(</span><span class="nv">$unsorted</span><span class="p">);</span>                <span class="c1">// -13, -2, 1, 2, 3, 4, 5, 6, 7, 12, 23, 100</span>
<span class="nb">arsort</span><span class="p">(</span><span class="nv">$unsorted</span><span class="p">);</span>               <span class="c1">// 100, 23, 12, 7, 6, 5, 4, 3, 2, 1, -2, -13</span>

<span class="nb">natsort</span><span class="p">(</span><span class="nv">$unsorted</span><span class="p">);</span>              <span class="c1">// -2, -13, 1, 2, 3, 4, 5, 6, 7, 12, 23, 100</span>

<span class="c1">// ------------</span>

<span class="k">function</span> <span class="nf">ascend</span><span class="p">(</span><span class="nv">$left</span><span class="p">,</span> <span class="nv">$right</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$left</span> <span class="o">&gt;</span> <span class="nv">$right</span><span class="p">;</span> <span class="p">}</span>
<span class="k">function</span> <span class="nf">descend</span><span class="p">(</span><span class="nv">$left</span><span class="p">,</span> <span class="nv">$right</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$left</span> <span class="o">&lt;</span> <span class="nv">$right</span><span class="p">;</span> <span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nb">usort</span><span class="p">(</span><span class="nv">$unsorted</span><span class="p">,</span> <span class="s1">&#39;ascend&#39;</span><span class="p">);</span>      <span class="c1">// -13, -2, 1, 2, 3, 4, 5, 6, 7, 12, 23, 100</span>
<span class="nb">usort</span><span class="p">(</span><span class="nv">$unsorted</span><span class="p">,</span> <span class="s1">&#39;descend&#39;</span><span class="p">);</span>     <span class="c1">// 100, 23, 12, 7, 6, 5, 4, 3, 2, 1, -2, -13</span>

<span class="nb">uasort</span><span class="p">(</span><span class="nv">$unsorted</span><span class="p">,</span> <span class="s1">&#39;ascend&#39;</span><span class="p">);</span>     <span class="c1">// -13, -2, 1, 2, 3, 4, 5, 6, 7, 12, 23, 100</span>
<span class="nb">uasort</span><span class="p">(</span><span class="nv">$unsorted</span><span class="p">,</span> <span class="s1">&#39;descend&#39;</span><span class="p">);</span>    <span class="c1">// 100, 23, 12, 7, 6, 5, 4, 3, 2, 1, -2, -13</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">kill_process</span><span class="p">(</span><span class="nv">$pid</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Is &#39;killable&#39; ?</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">posix_kill</span><span class="p">(</span><span class="nv">$pid</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>

  <span class="c1">// Ok, so kill in two stages</span>
  <span class="nb">posix_kill</span><span class="p">(</span><span class="nv">$pid</span><span class="p">,</span> <span class="mi">15</span><span class="p">);</span> <span class="c1">// SIGTERM</span>
  <span class="nb">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="nb">posix_kill</span><span class="p">(</span><span class="nv">$pid</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>  <span class="c1">// SIGKILL</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">pid</span><span class="p">(</span><span class="nv">$pentry</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$p</span> <span class="o">=</span> <span class="nb">preg_split</span><span class="p">(</span><span class="s1">&#39;/\s/&#39;</span><span class="p">,</span> <span class="nx">trim</span><span class="p">(</span><span class="nv">$pentry</span><span class="p">));</span>
  <span class="k">return</span> <span class="nv">$p</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span>

<span class="nv">$processes</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="s1">&#39;pid&#39;</span><span class="p">,</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nb">preg_split</span><span class="p">(</span><span class="s1">&#39;/\n/&#39;</span><span class="p">,</span> <span class="sb">`ps ax`</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
<span class="nb">sort</span><span class="p">(</span><span class="nv">$processes</span><span class="p">);</span>

<span class="k">echo</span> <span class="nb">join</span><span class="p">(</span><span class="s1">&#39; ,&#39;</span><span class="p">,</span> <span class="nv">$processes</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="k">echo</span> <span class="s1">&#39;Enter a pid to kill: &#39;</span><span class="p">;</span>
<span class="k">if</span> <span class="p">((</span><span class="nv">$pid</span> <span class="o">=</span> <span class="nx">trim</span><span class="p">(</span><span class="nb">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">))))</span>
  <span class="nx">kill_process</span><span class="p">(</span><span class="nv">$pid</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_4.15</span>
<span class="c1">// Tasks in this section would typically use the PHP &#39;usort&#39; family of functions</span>
<span class="c1">// which are used with a comparator function so as to perform custom comparisions.</span>
<span class="c1">// A significant difference from the Perl examples is that these functions are</span>
<span class="c1">// inplace sorters, so it is the original array that is modified. Where this must</span>
<span class="c1">// be prevented a copy of the array can be made and sorted</span>

<span class="k">function</span> <span class="nf">comparator</span><span class="p">(</span><span class="nv">$left</span><span class="p">,</span> <span class="nv">$right</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// Compare &#39;$left&#39; with &#39;$right&#39; returning result</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$ordered</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$unordered</span><span class="p">);</span>
<span class="nb">usort</span><span class="p">(</span><span class="nv">$ordered</span><span class="p">,</span> <span class="s1">&#39;comparator&#39;</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// The Perl example looks like it is creating a hash using computed values as the key,</span>
<span class="c1">// array values as the value, sorting on the computed key, then extracting the sorted</span>
<span class="c1">// values and placing them back into an array</span>

<span class="k">function</span> <span class="nf">compute</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// Return computed value utilising &#39;$value&#39;</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="c1">// Original numerically-indexed array [sample data used]</span>
<span class="nv">$unordered</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>

<span class="c1">// Create hash using &#39;compute&#39; function to generate the keys. This example assumes that</span>
<span class="c1">// each value in the &#39;$unordered&#39; array is used in generating the corresponding &#39;$key&#39;</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$unordered</span> <span class="k">as</span> <span class="nv">$value</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$precomputed</span><span class="p">[</span><span class="nx">compute</span><span class="p">(</span><span class="nv">$value</span><span class="p">)]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Copy the hash, and sort it by key</span>
<span class="nv">$ordered_precomputed</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$precomputed</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="nb">ksort</span><span class="p">(</span><span class="nv">$ordered_precomputed</span><span class="p">);</span>

<span class="c1">// Extract the values of the hash in current order placing them in a new numerically-indexed</span>
<span class="c1">// array</span>
<span class="nv">$ordered</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nv">$ordered_precomputed</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// As above, except uses &#39;array_update&#39; and &#39;accum&#39; to help create hash</span>

<span class="k">function</span> <span class="nf">array_update</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="nv">$lambda</span><span class="p">,</span> <span class="nv">$updarr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nv">$arr</span> <span class="k">as</span> <span class="nv">$key</span><span class="p">)</span> <span class="nv">$lambda</span><span class="p">(</span><span class="nv">$updarr</span><span class="p">,</span> <span class="nv">$key</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$updarr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">accum</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$arr</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$arr</span><span class="p">[</span><span class="nx">compute</span><span class="p">(</span><span class="nv">$value</span><span class="p">)]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="k">function</span> <span class="nf">compute</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// Return computed value utilising &#39;$value&#39;</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="c1">// Original numerically-indexed array [sample data used]</span>
<span class="nv">$unordered</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>

<span class="c1">// Create hash</span>
<span class="nv">$precomputed</span> <span class="o">=</span> <span class="nx">array_update</span><span class="p">(</span><span class="nv">$unordered</span><span class="p">,</span> <span class="s1">&#39;accum&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>

<span class="c1">// Copy the hash, and sort it by key</span>
<span class="nv">$ordered_precomputed</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$precomputed</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="nb">ksort</span><span class="p">(</span><span class="nv">$ordered_precomputed</span><span class="p">);</span>

<span class="c1">// Extract the values of the hash in current order placing them in a new numerically-indexed</span>
<span class="c1">// array</span>
<span class="nv">$ordered</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nv">$ordered_precomputed</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="k">class</span> <span class="nc">Employee</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="nv">$name</span><span class="p">,</span> <span class="nv">$age</span><span class="p">,</span> <span class="nv">$ssn</span><span class="p">,</span> <span class="nv">$salary</span><span class="p">;</span>

  <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$age</span><span class="p">,</span> <span class="nv">$ssn</span><span class="p">,</span> <span class="nv">$salary</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">age</span> <span class="o">=</span> <span class="nv">$age</span><span class="p">;</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ssn</span> <span class="o">=</span> <span class="nv">$ssn</span><span class="p">;</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">salary</span> <span class="o">=</span> <span class="nv">$salary</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$employees</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
  <span class="k">new</span> <span class="nx">Employee</span><span class="p">(</span><span class="s1">&#39;sdf&#39;</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">12345</span><span class="p">,</span> <span class="mi">47000</span><span class="p">),</span>
  <span class="k">new</span> <span class="nx">Employee</span><span class="p">(</span><span class="s1">&#39;ajb&#39;</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">12376</span><span class="p">,</span> <span class="mi">51000</span><span class="p">),</span>
  <span class="k">new</span> <span class="nx">Employee</span><span class="p">(</span><span class="s1">&#39;dgh&#39;</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">12355</span><span class="p">,</span> <span class="mi">45000</span><span class="p">));</span>

<span class="c1">// ------------</span>

<span class="nv">$ordered</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$employees</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="nb">usort</span><span class="p">(</span><span class="nv">$ordered</span><span class="p">,</span> <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$left, $right&#39;</span><span class="p">,</span> <span class="s1">&#39;return $left-&gt;name &gt; $right-&gt;name;&#39;</span><span class="p">));</span>

<span class="c1">// ------------</span>

<span class="nv">$sorted_employees</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$employees</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="nb">usort</span><span class="p">(</span><span class="nv">$sorted_employees</span><span class="p">,</span> <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$left, $right&#39;</span><span class="p">,</span> <span class="s1">&#39;return $left-&gt;name &gt; $right-&gt;name;&#39;</span><span class="p">));</span>

<span class="nv">$bonus</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">12376</span> <span class="o">=&gt;</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">12345</span> <span class="o">=&gt;</span> <span class="mi">6000</span><span class="p">,</span> <span class="mi">12355</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$sorted_employees</span> <span class="k">as</span> <span class="nv">$employee</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$employee</span><span class="o">-&gt;</span><span class="na">name</span><span class="si">}</span><span class="s2"> earns </span><span class="se">\$</span><span class="si">{</span><span class="nv">$employee</span><span class="o">-&gt;</span><span class="na">salary</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$sorted_employees</span> <span class="k">as</span> <span class="nv">$employee</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">((</span><span class="nv">$amount</span> <span class="o">=</span> <span class="nv">$bonus</span><span class="p">[</span><span class="nv">$employee</span><span class="o">-&gt;</span><span class="na">ssn</span><span class="p">]))</span>
    <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$employee</span><span class="o">-&gt;</span><span class="na">name</span><span class="si">}</span><span class="s2"> got a bonus of: </span><span class="se">\$</span><span class="si">{</span><span class="nv">$amount</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$sorted</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$employees</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="nb">usort</span><span class="p">(</span><span class="nv">$sorted</span><span class="p">,</span> <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$left, $right&#39;</span><span class="p">,</span> <span class="s1">&#39;return $left-&gt;name &gt; $right-&gt;name || $left-&gt;age != $right-&gt;age;&#39;</span><span class="p">));</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// PHP offers a swag of POSIX functions for obtaining user information [i.e. they all read</span>
<span class="c1">// the &#39;/etc/passwd&#39; file for the relevant infroamtion], and it is these that should rightly</span>
<span class="c1">// be used for this purpose. However, since the intent of this section is to illustrate array</span>
<span class="c1">// manipulation, these functions won&#39;t be used. Instead a custom function mimicing Perl&#39;s</span>
<span class="c1">// &#39;getpwent&#39; function will be implemented so the code presented here can more faithfully match</span>
<span class="c1">// the Perl code</span>

<span class="k">function</span> <span class="nf">get_pw_entries</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">function</span> <span class="nf">normal_users_only</span><span class="p">(</span><span class="nv">$e</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nv">$entry</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="nv">$e</span><span class="p">);</span> <span class="k">return</span> <span class="nv">$entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="o">&amp;&amp;</span> <span class="nv">$entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">32768</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">foreach</span><span class="p">(</span><span class="nb">array_filter</span><span class="p">(</span><span class="nb">file</span><span class="p">(</span><span class="s1">&#39;/etc/passwd&#39;</span><span class="p">),</span> <span class="s1">&#39;normal_users_only&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$entry</span><span class="p">)</span>
    <span class="nv">$users</span><span class="p">[]</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="nx">trim</span><span class="p">(</span><span class="nv">$entry</span><span class="p">));</span>

  <span class="k">return</span> <span class="nv">$users</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$users</span> <span class="o">=</span> <span class="nx">get_pw_entries</span><span class="p">();</span>

<span class="nb">usort</span><span class="p">(</span><span class="nv">$users</span><span class="p">,</span> <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$left, $right&#39;</span><span class="p">,</span> <span class="s1">&#39;return $left[0] &gt; $right[0];&#39;</span><span class="p">));</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$user</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$names</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;sdf&#39;</span><span class="p">,</span> <span class="s1">&#39;ajb&#39;</span><span class="p">,</span> <span class="s1">&#39;dgh&#39;</span><span class="p">);</span>

<span class="nv">$sorted</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$names</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="nb">usort</span><span class="p">(</span><span class="nv">$sorted</span><span class="p">,</span> <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$left, $right&#39;</span><span class="p">,</span> <span class="s1">&#39;return substr($left, 1, 1) &gt; substr($right, 1, 1);&#39;</span><span class="p">));</span>

<span class="c1">// ------------</span>

<span class="nv">$strings</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;bbb&#39;</span><span class="p">,</span> <span class="s1">&#39;aa&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">);</span>

<span class="nv">$sorted</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$strings</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="nb">usort</span><span class="p">(</span><span class="nv">$sorted</span><span class="p">,</span> <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$left, $right&#39;</span><span class="p">,</span> <span class="s1">&#39;return strlen($left) &gt; strlen($right);&#39;</span><span class="p">));</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">array_update</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="nv">$lambda</span><span class="p">,</span> <span class="nv">$updarr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nv">$arr</span> <span class="k">as</span> <span class="nv">$key</span><span class="p">)</span> <span class="nv">$lambda</span><span class="p">(</span><span class="nv">$updarr</span><span class="p">,</span> <span class="nv">$key</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$updarr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">accum</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$arr</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$arr</span><span class="p">[</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$value</span><span class="p">)]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ----</span>

<span class="nv">$strings</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;bbb&#39;</span><span class="p">,</span> <span class="s1">&#39;aa&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">);</span>

<span class="nv">$temp</span> <span class="o">=</span> <span class="nx">array_update</span><span class="p">(</span><span class="nv">$strings</span><span class="p">,</span> <span class="s1">&#39;accum&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="nb">ksort</span><span class="p">(</span><span class="nv">$temp</span><span class="p">);</span>
<span class="nv">$sorted</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nv">$temp</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">array_update</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="nv">$lambda</span><span class="p">,</span> <span class="nv">$updarr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nv">$arr</span> <span class="k">as</span> <span class="nv">$key</span><span class="p">)</span> <span class="nv">$lambda</span><span class="p">(</span><span class="nv">$updarr</span><span class="p">,</span> <span class="nv">$key</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$updarr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">accum</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$arr</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/(\d+)/&#39;</span><span class="p">,</span> <span class="nv">$value</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">))</span>
    <span class="nv">$arr</span><span class="p">[</span><span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ----</span>

<span class="nv">$fields</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;b1b2b&#39;</span><span class="p">,</span> <span class="s1">&#39;a4a&#39;</span><span class="p">,</span> <span class="s1">&#39;c9&#39;</span><span class="p">,</span> <span class="s1">&#39;ddd&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">);</span>

<span class="nv">$temp</span> <span class="o">=</span> <span class="nx">array_update</span><span class="p">(</span><span class="nv">$fields</span><span class="p">,</span> <span class="s1">&#39;accum&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="nb">ksort</span><span class="p">(</span><span class="nv">$temp</span><span class="p">);</span>
<span class="nv">$sorted_fields</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nv">$temp</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_4.16</span>
<span class="nb">array_unshift</span><span class="p">(</span><span class="nv">$a1</span><span class="p">,</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$a1</span><span class="p">));</span>  <span class="c1">// last -&gt; first</span>
<span class="nb">array_push</span><span class="p">(</span><span class="nv">$a1</span><span class="p">,</span> <span class="nb">array_shift</span><span class="p">(</span><span class="nv">$a1</span><span class="p">));</span>   <span class="c1">// first -&gt; last</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">grab_and_rotate</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$arr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$item</span> <span class="o">=</span> <span class="nv">$arr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="nb">array_push</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="nb">array_shift</span><span class="p">(</span><span class="nv">$arr</span><span class="p">));</span>
  <span class="k">return</span> <span class="nv">$item</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$processes</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

<span class="k">while</span> <span class="p">(</span><span class="k">TRUE</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$process</span> <span class="o">=</span> <span class="nx">grab_and_rotate</span><span class="p">(</span><span class="nv">$processes</span><span class="p">);</span>
  <span class="k">echo</span> <span class="s2">&quot;Handling process </span><span class="si">{</span><span class="nv">$process</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
  <span class="nb">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_4.17</span>
<span class="c1">// PHP offers the &#39;shuffle&#39; function to perform this task</span>

<span class="nv">$arr</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>

<span class="nb">shuffle</span><span class="p">(</span><span class="nv">$arr</span><span class="p">);</span>

<span class="k">echo</span> <span class="nb">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nv">$arr</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Perl example equivalents</span>
<span class="k">function</span> <span class="nf">fisher_yates_shuffle</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$a</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$size</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

  <span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="nv">$size</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span><span class="o">--</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">((</span><span class="nv">$j</span> <span class="o">=</span> <span class="nx">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$i</span><span class="p">))</span> <span class="o">!=</span> <span class="nv">$i</span><span class="p">)</span>
      <span class="k">list</span><span class="p">(</span><span class="nv">$a</span><span class="p">[</span><span class="nv">$i</span><span class="p">],</span> <span class="nv">$a</span><span class="p">[</span><span class="nv">$j</span><span class="p">])</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$a</span><span class="p">[</span><span class="nv">$j</span><span class="p">],</span> <span class="nv">$a</span><span class="p">[</span><span class="nv">$i</span><span class="p">]);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">naive_shuffle</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$a</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$size</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>

  <span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$size</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nv">$j</span> <span class="o">=</span> <span class="nx">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">list</span><span class="p">(</span><span class="nv">$a</span><span class="p">[</span><span class="nv">$i</span><span class="p">],</span> <span class="nv">$a</span><span class="p">[</span><span class="nv">$j</span><span class="p">])</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$a</span><span class="p">[</span><span class="nv">$j</span><span class="p">],</span> <span class="nv">$a</span><span class="p">[</span><span class="nv">$i</span><span class="p">]);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$arr</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>

<span class="nx">fisher_yates_shuffle</span><span class="p">(</span><span class="nv">$arr</span><span class="p">);</span>
<span class="k">echo</span> <span class="nb">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nv">$arr</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="nx">naive_shuffle</span><span class="p">(</span><span class="nv">$arr</span><span class="p">);</span>
<span class="k">echo</span> <span class="nb">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nv">$arr</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// @@PLEAC@@_4.18</span>
<span class="c1">// @@INCOMPLETE@@</span>
<span class="c1">// @@INCOMPLETE@@</span>

<span class="c1">// @@PLEAC@@_4.19</span>
<span class="c1">// @@INCOMPLETE@@</span>
<span class="c1">// @@INCOMPLETE@@</span>

<span class="c1">// @@PLEAC@@_5.0</span>
<span class="c1">// PHP uses the term &#39;array&#39; to refer to associative arrays - referred to in Perl</span>
<span class="c1">// as &#39;hashes&#39; - and for the sake of avoiding confusion, the Perl terminology will</span>
<span class="c1">// be used. As a matter of interest, PHP does not sport a vector, matrix, or list</span>
<span class="c1">// type: the &#39;array&#39; [Perl &#39;hash&#39;] serves all these roles</span>

<span class="nv">$age</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Nat&#39;</span> <span class="o">=&gt;</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;Jules&#39;</span> <span class="o">=&gt;</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">&#39;Josh&#39;</span> <span class="o">=&gt;</span> <span class="mi">17</span><span class="p">);</span>

<span class="nv">$age</span><span class="p">[</span><span class="s1">&#39;Nat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span>
<span class="nv">$age</span><span class="p">[</span><span class="s1">&#39;Jules&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>
<span class="nv">$age</span><span class="p">[</span><span class="s1">&#39;Josh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span>

<span class="nv">$age</span> <span class="o">=</span> <span class="nb">array_combine</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;Nat&#39;</span><span class="p">,</span> <span class="s1">&#39;Jules&#39;</span><span class="p">,</span> <span class="s1">&#39;Josh&#39;</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">17</span><span class="p">));</span>

<span class="c1">// ------------</span>

<span class="nv">$food_colour</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Apple&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;Banana&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Lemon&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;Carrot&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;orange&#39;</span><span class="p">);</span>

<span class="nv">$food_colour</span><span class="p">[</span><span class="s1">&#39;Apple&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">;</span> <span class="nv">$food_colour</span><span class="p">[</span><span class="s1">&#39;Banana&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span><span class="p">;</span>
<span class="nv">$food_colour</span><span class="p">[</span><span class="s1">&#39;Lemon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span><span class="p">;</span> <span class="nv">$food_colour</span><span class="p">[</span><span class="s1">&#39;Carrot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">;</span>

<span class="nv">$food_colour</span> <span class="o">=</span> <span class="nb">array_combine</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;Apple&#39;</span><span class="p">,</span> <span class="s1">&#39;Banana&#39;</span><span class="p">,</span> <span class="s1">&#39;Lemon&#39;</span><span class="p">,</span> <span class="s1">&#39;Carrot&#39;</span><span class="p">),</span>
                             <span class="k">array</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">));</span>

<span class="c1">// @@PLEAC@@_5.1</span>
<span class="nv">$hash</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>

<span class="c1">// ------------</span>

<span class="nv">$food_colour</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Apple&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;Banana&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Lemon&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;Carrot&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;orange&#39;</span><span class="p">);</span>

<span class="nv">$food_colour</span><span class="p">[</span><span class="s1">&#39;Raspberry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;pink&#39;</span><span class="p">;</span>

<span class="k">echo</span> <span class="s2">&quot;Known foods:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$food_colour</span> <span class="k">as</span> <span class="nv">$food</span> <span class="o">=&gt;</span> <span class="nv">$colour</span><span class="p">)</span> <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$food</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// @@PLEAC@@_5.2</span>
<span class="c1">// Returns TRUE on all existing entries with non-NULL values</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$hash</span><span class="p">[</span><span class="nv">$key</span><span class="p">]))</span>
  <span class="p">;</span> <span class="c1">// entry exists  </span>
<span class="k">else</span>
  <span class="p">;</span> <span class="c1">// no such entry </span>

<span class="c1">// ------------</span>

<span class="c1">// Returns TRUE on all existing entries regardless of attached value</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$hash</span><span class="p">))</span>
  <span class="p">;</span> <span class="c1">// entry exists  </span>
<span class="k">else</span>
  <span class="p">;</span> <span class="c1">// no such entry </span>

<span class="c1">// ----------------------------</span>

<span class="nv">$food_colour</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Apple&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;Banana&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Lemon&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;Carrot&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;orange&#39;</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;Banana&#39;</span><span class="p">,</span> <span class="s1">&#39;Martini&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$name</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$food_colour</span><span class="p">[</span><span class="nv">$name</span><span class="p">]))</span>
    <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$name</span><span class="si">}</span><span class="s2"> is a food.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$name</span><span class="si">}</span><span class="s2"> is a drink.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$age</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Toddler&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Unborn&#39;</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Phantasm&#39;</span> <span class="o">=&gt;</span> <span class="k">NULL</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;Toddler&#39;</span><span class="p">,</span> <span class="s1">&#39;Unborn&#39;</span><span class="p">,</span> <span class="s1">&#39;Phantasm&#39;</span><span class="p">,</span> <span class="s1">&#39;Relic&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$thing</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$thing</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$thing</span><span class="p">,</span> <span class="nv">$age</span><span class="p">))</span> <span class="k">echo</span> <span class="s1">&#39; exists&#39;</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$age</span><span class="p">[</span><span class="nv">$thing</span><span class="p">]))</span> <span class="k">echo</span> <span class="s1">&#39; non-NULL&#39;</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$age</span><span class="p">[</span><span class="nv">$thing</span><span class="p">])</span> <span class="k">echo</span> <span class="s1">&#39; TRUE&#39;</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_5.3</span>
<span class="c1">// Remove one, or more, hash entries</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$hash</span><span class="p">[</span><span class="nv">$key</span><span class="p">]);</span>

<span class="nb">unset</span><span class="p">(</span><span class="nv">$hash</span><span class="p">[</span><span class="nv">$key1</span><span class="p">],</span> <span class="nv">$hash</span><span class="p">[</span><span class="nv">$key2</span><span class="p">],</span> <span class="nv">$hash</span><span class="p">[</span><span class="nv">$key3</span><span class="p">]);</span>

<span class="c1">// Remove entire hash</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$hash</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">print_foods</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// Perl example uses a global variable</span>
  <span class="k">global</span> <span class="nv">$food_colour</span><span class="p">;</span>

  <span class="nv">$foods</span> <span class="o">=</span> <span class="nb">array_keys</span><span class="p">(</span><span class="nv">$food_colour</span><span class="p">);</span>

  <span class="k">echo</span> <span class="s1">&#39;Foods:&#39;</span><span class="p">;</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nv">$foods</span> <span class="k">as</span> <span class="nv">$food</span><span class="p">)</span> <span class="k">echo</span> <span class="s2">&quot; </span><span class="si">{</span><span class="nv">$food</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>

  <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Values:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nv">$foods</span> <span class="k">as</span> <span class="nv">$food</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nv">$colour</span> <span class="o">=</span> <span class="nv">$food_colour</span><span class="p">[</span><span class="nv">$food</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$colour</span><span class="p">))</span>
      <span class="k">echo</span> <span class="s2">&quot;  </span><span class="si">{</span><span class="nv">$colour</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">echo</span> <span class="s2">&quot;  nullified or removed</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$food_colour</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Apple&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;Banana&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Lemon&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;Carrot&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;orange&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="s2">&quot;Initially:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> <span class="nx">print_foods</span><span class="p">();</span>

<span class="c1">// Nullify an entry</span>
<span class="nv">$food_colour</span><span class="p">[</span><span class="s1">&#39;Banana&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">With &#39;Banana&#39; nullified</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="nx">print_foods</span><span class="p">();</span>

<span class="c1">// Remove an entry</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$food_colour</span><span class="p">[</span><span class="s1">&#39;Banana&#39;</span><span class="p">]);</span>
<span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">With &#39;Banana&#39; removed</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="nx">print_foods</span><span class="p">();</span>

<span class="c1">// Destroy the hash</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$food_colour</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_5.4</span>
<span class="c1">// Access keys and values</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$hash</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// Access keys only</span>
<span class="k">foreach</span><span class="p">(</span><span class="nb">array_keys</span><span class="p">(</span><span class="nv">$hash</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$key</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// Access values only</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$hash</span> <span class="k">as</span> <span class="nv">$value</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$food_colour</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Apple&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;Banana&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Lemon&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;Carrot&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;orange&#39;</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$food_colour</span> <span class="k">as</span> <span class="nv">$food</span> <span class="o">=&gt;</span> <span class="nv">$colour</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$food</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="nv">$colour</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">foreach</span><span class="p">(</span><span class="nb">array_keys</span><span class="p">(</span><span class="nv">$food_colour</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$food</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$food</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="nv">$food_colour</span><span class="p">[</span><span class="nv">$food</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// &#39;countfrom&#39; - count number of messages from each sender</span>

<span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">);</span>

<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">))</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/^From: (.*)/&#39;</span><span class="p">,</span> <span class="nv">$line</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$from</span><span class="p">[</span><span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span>
      <span class="nv">$from</span><span class="p">[</span><span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="nv">$from</span><span class="p">[</span><span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$from</span><span class="p">))</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;Senders:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>  
  <span class="k">foreach</span><span class="p">(</span><span class="nv">$from</span> <span class="k">as</span> <span class="nv">$sender</span> <span class="o">=&gt;</span> <span class="nv">$count</span><span class="p">)</span> <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$sender</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="nv">$count</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;No valid data entered</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_5.5</span>
<span class="c1">// PHP offers, &#39;print_r&#39;, which prints hash contents in &#39;debug&#39; form; it also</span>
<span class="c1">// works recursively, printing any contained arrays in similar form</span>
<span class="c1">//     Array</span>
<span class="c1">//     (</span>
<span class="c1">//         [key1] =&gt; value1 </span>
<span class="c1">//         [key2] =&gt; value2</span>
<span class="c1">//         ...</span>
<span class="c1">//     )</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nv">$hash</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="c1">// Based on Perl example; non-recursive, so contained arrays not printed correctly</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$hash</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$key</span><span class="si">}</span><span class="s2"> =&gt; </span><span class="si">$value</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Sorted by keys</span>

<span class="c1">// 1. Sort the original hash</span>
<span class="nb">ksort</span><span class="p">(</span><span class="nv">$hash</span><span class="p">);</span>

<span class="c1">// 2. Extract keys, sort, traverse original in key order</span>
<span class="nv">$keys</span> <span class="o">=</span> <span class="nb">array_keys</span><span class="p">(</span><span class="nv">$hash</span><span class="p">);</span> <span class="nb">sort</span><span class="p">(</span><span class="nv">$keys</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$keys</span> <span class="k">as</span> <span class="nv">$key</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$key</span><span class="si">}</span><span class="s2"> =&gt; </span><span class="si">{</span><span class="nv">$hash</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Sorted by values</span>

<span class="c1">// 1. Sort the original hash</span>
<span class="nb">asort</span><span class="p">(</span><span class="nv">$hash</span><span class="p">);</span>

<span class="c1">// 2. Extract values, sort, traverse original in value order [warning: finds </span>
<span class="c1">//    only first matching key in the case where duplicate values exist]</span>
<span class="nv">$values</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nv">$hash</span><span class="p">);</span> <span class="nb">sort</span><span class="p">(</span><span class="nv">$values</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$values</span> <span class="k">as</span> <span class="nv">$value</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="nv">$value</span> <span class="o">.</span> <span class="s1">&#39; &lt;= &#39;</span> <span class="o">.</span> <span class="nb">array_search</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$hash</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_5.6</span>
<span class="c1">// Unless sorted, hash elements remain in the order of insertion. If care is taken to</span>
<span class="c1">// always add a new element to the end of the hash, then element order is the order</span>
<span class="c1">// of insertion. The following function, &#39;array_push_associative&#39; [modified from original</span>
<span class="c1">// found at &#39;array_push&#39; section of PHP documentation], does just that</span>
<span class="k">function</span> <span class="nf">array_push_associative</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$arr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nb">func_get_args</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$arg</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$arg</span><span class="p">))</span>
      <span class="k">foreach</span> <span class="p">(</span><span class="nv">$arg</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$arr</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span> <span class="nv">$ret</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">else</span>
      <span class="nv">$arr</span><span class="p">[</span><span class="nv">$arg</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nv">$ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$food_colour</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

<span class="c1">// Individual calls, or ...</span>
<span class="nx">array_push_associative</span><span class="p">(</span><span class="nv">$food_colour</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Banana&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Yellow&#39;</span><span class="p">));</span>
<span class="nx">array_push_associative</span><span class="p">(</span><span class="nv">$food_colour</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Apple&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Green&#39;</span><span class="p">));</span>
<span class="nx">array_push_associative</span><span class="p">(</span><span class="nv">$food_colour</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Lemon&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Yellow&#39;</span><span class="p">));</span>

<span class="c1">// ... one call, one array; physical order retained</span>
<span class="c1">// array_push_associative($food_colour, array(&#39;Banana&#39; =&gt; &#39;Yellow&#39;, &#39;Apple&#39; =&gt; &#39;Green&#39;, &#39;Lemon&#39; =&gt; &#39;Yellow&#39;));</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nv">$food_colour</span><span class="p">);</span>

<span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">In insertion order:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$food_colour</span> <span class="k">as</span> <span class="nv">$food</span> <span class="o">=&gt;</span> <span class="nv">$colour</span><span class="p">)</span> <span class="k">echo</span> <span class="s2">&quot;  </span><span class="si">{</span><span class="nv">$food</span><span class="si">}</span><span class="s2"> =&gt; </span><span class="si">{</span><span class="nv">$colour</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="nv">$foods</span> <span class="o">=</span> <span class="nb">array_keys</span><span class="p">(</span><span class="nv">$food_colour</span><span class="p">);</span>

<span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Still in insertion order:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$foods</span> <span class="k">as</span> <span class="nv">$food</span><span class="p">)</span> <span class="k">echo</span> <span class="s2">&quot;  </span><span class="si">{</span><span class="nv">$food</span><span class="si">}</span><span class="s2"> =&gt; </span><span class="si">{</span><span class="nv">$food_colour</span><span class="p">[</span><span class="nv">$food</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// @@PLEAC@@_5.7</span>
<span class="k">foreach</span><span class="p">(</span><span class="nb">array_slice</span><span class="p">(</span><span class="nb">preg_split</span><span class="p">(</span><span class="s1">&#39;/\n/&#39;</span><span class="p">,</span> <span class="sb">`who`</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$entry</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">list</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$tty</span><span class="p">)</span> <span class="o">=</span> <span class="nb">preg_split</span><span class="p">(</span><span class="s1">&#39;/\s/&#39;</span><span class="p">,</span> <span class="nv">$entry</span><span class="p">);</span>
  <span class="nv">$ttys</span><span class="p">[</span><span class="nv">$user</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$tty</span><span class="p">;</span>

  <span class="c1">// Could instead do this:</span>
  <span class="c1">// $user = array_slice(preg_split(&#39;/\s/&#39;, $entry), 0, 2);</span>
  <span class="c1">// $ttys[$user[0]][] = $user[1];</span>
<span class="p">}</span>

<span class="nb">ksort</span><span class="p">(</span><span class="nv">$ttys</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$ttys</span> <span class="k">as</span> <span class="nv">$user</span> <span class="o">=&gt;</span> <span class="nv">$all_ttys</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$user</span><span class="si">}</span><span class="s2">: &quot;</span> <span class="o">.</span> <span class="nb">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nv">$all_ttys</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$ttys</span> <span class="k">as</span> <span class="nv">$user</span> <span class="o">=&gt;</span> <span class="nv">$all_ttys</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$user</span><span class="si">}</span><span class="s2">: &quot;</span> <span class="o">.</span> <span class="nb">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nv">$all_ttys</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

  <span class="k">foreach</span><span class="p">(</span><span class="nv">$all_ttys</span> <span class="k">as</span> <span class="nv">$tty</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nv">$stat</span> <span class="o">=</span> <span class="nb">stat</span><span class="p">(</span><span class="s1">&#39;/dev/$tty&#39;</span><span class="p">);</span>
    <span class="nv">$pwent</span> <span class="o">=</span> <span class="nb">posix_getpwuid</span><span class="p">(</span><span class="nv">$stat</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]);</span>
    <span class="nv">$user</span> <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$pwent</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$pwent</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;Not available&#39;</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$tty</span><span class="si">}</span><span class="s2"> owned by: </span><span class="si">{</span><span class="nv">$user</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_5.8</span>
<span class="c1">// PHP offers the &#39;array_flip&#39; function to perform the task of exchanging the keys / values</span>
<span class="c1">// of a hash i.e. invert or &#39;flip&#39; a hash</span>

<span class="nv">$reverse</span> <span class="o">=</span> <span class="nb">array_flip</span><span class="p">(</span><span class="nv">$hash</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$surname</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Babe&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Ruth&#39;</span><span class="p">,</span> <span class="s1">&#39;Mickey&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Mantle&#39;</span><span class="p">);</span> 
<span class="nv">$first_name</span> <span class="o">=</span> <span class="nb">array_flip</span><span class="p">(</span><span class="nv">$surname</span><span class="p">);</span>

<span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$first_name</span><span class="p">[</span><span class="s1">&#39;Mantle&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$argc</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;usage: </span><span class="si">{</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> food|colour</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="nv">$given</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

<span class="nv">$colour</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Apple&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;Banana&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Lemon&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;Carrot&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;orange&#39;</span><span class="p">);</span>

<span class="nv">$food</span> <span class="o">=</span> <span class="nb">array_flip</span><span class="p">(</span><span class="nv">$colour</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$colour</span><span class="p">[</span><span class="nv">$given</span><span class="p">]))</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$given</span><span class="si">}</span><span class="s2"> is a food with colour: </span><span class="si">{</span><span class="nv">$colour</span><span class="p">[</span><span class="nv">$given</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$food</span><span class="p">[</span><span class="nv">$given</span><span class="p">]))</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$food</span><span class="p">[</span><span class="nv">$given</span><span class="p">]</span><span class="si">}</span><span class="s2"> is a food with colour: </span><span class="si">{</span><span class="nv">$given</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$food_colour</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Apple&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;Banana&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Lemon&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;Carrot&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;orange&#39;</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$food_colour</span> <span class="k">as</span> <span class="nv">$food</span> <span class="o">=&gt;</span> <span class="nv">$colour</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$foods_with_colour</span><span class="p">[</span><span class="nv">$colour</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$food</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$colour</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">&quot;foods with colour </span><span class="si">{</span><span class="nv">$colour</span><span class="si">}</span><span class="s2"> were: &quot;</span> <span class="o">.</span> <span class="nb">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nv">$foods_with_colour</span><span class="p">[</span><span class="nv">$colour</span><span class="p">])</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// @@PLEAC@@_5.9</span>
<span class="c1">// PHP implements a swag of sorting functions, most designed to work with numerically-indexed</span>
<span class="c1">// arrays. For sorting hashes, the &#39;key&#39; sorting functions are required:</span>
<span class="c1">// * &#39;ksort&#39;, &#39;krsort&#39;, &#39;uksort&#39;</span>

<span class="c1">// Ascending order</span>
<span class="nb">ksort</span><span class="p">(</span><span class="nv">$hash</span><span class="p">);</span>

<span class="c1">// Descending order [i.e. reverse sort]</span>
<span class="nb">krsort</span><span class="p">(</span><span class="nv">$hash</span><span class="p">);</span>

<span class="c1">// Comparator-based sort</span>

<span class="k">function</span> <span class="nf">comparator</span><span class="p">(</span><span class="nv">$left</span><span class="p">,</span> <span class="nv">$right</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Compare left key with right key</span>
  <span class="k">return</span> <span class="nv">$left</span> <span class="o">&gt;</span> <span class="nv">$right</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">uksort</span><span class="p">(</span><span class="nv">$hash</span><span class="p">,</span> <span class="s1">&#39;comparator&#39;</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$food_colour</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Apple&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;Banana&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Lemon&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;Carrot&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;orange&#39;</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nb">ksort</span><span class="p">(</span><span class="nv">$food_colour</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$food_colour</span> <span class="k">as</span> <span class="nv">$food</span> <span class="o">=&gt;</span> <span class="nv">$colour</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$food</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="nv">$colour</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nb">uksort</span><span class="p">(</span><span class="nv">$food_colour</span><span class="p">,</span> <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$left, $right&#39;</span><span class="p">,</span> <span class="s1">&#39;return $left &gt; $right;&#39;</span><span class="p">));</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$food_colour</span> <span class="k">as</span> <span class="nv">$food</span> <span class="o">=&gt;</span> <span class="nv">$colour</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$food</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="nv">$colour</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_5.10</span>
<span class="c1">// PHP offers the &#39;array_merge&#39; function for this task [a related function, &#39;array_combine&#39;,</span>
<span class="c1">// may be used to create a hash from an array of keys, and one of values, respectively]</span>

<span class="c1">// Merge two, or more, arrays</span>
<span class="nv">$merged</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$c</span><span class="p">);</span>

<span class="c1">// Create a hash from array of keys, and of values, respectively</span>
<span class="nv">$hash</span> <span class="o">=</span> <span class="nb">array_combine</span><span class="p">(</span><span class="nv">$keys</span><span class="p">,</span> <span class="nv">$values</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="c1">// Can always merge arrays manually </span>
<span class="k">foreach</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$h1</span><span class="p">,</span> <span class="nv">$h2</span><span class="p">,</span> <span class="nv">$h3</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$hash</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nv">$hash</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="c1">// If same-key values differ, only latest retained</span>
    <span class="nv">$merged</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>

    <span class="c1">// Do this to append values for that key</span>
    <span class="c1">// $merged[$key][] = $value;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$food_colour</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Apple&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;Banana&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Lemon&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;Carrot&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;orange&#39;</span><span class="p">);</span>

<span class="nv">$drink_colour</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Galliano&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;Mai Tai&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;blue&#39;</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nv">$ingested_colour</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$food_colour</span><span class="p">,</span> <span class="nv">$drink_colour</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nv">$substance_colour</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

<span class="k">foreach</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$food_colour</span><span class="p">,</span> <span class="nv">$drink_colour</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$hash</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nv">$hash</span> <span class="k">as</span> <span class="nv">$substance</span> <span class="o">=&gt;</span> <span class="nv">$colour</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$substance</span><span class="p">,</span> <span class="nv">$substance_colour</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="k">echo</span> <span class="s2">&quot;Warning </span><span class="si">{</span><span class="nv">$substance_colour</span><span class="p">[</span><span class="nv">$substance</span><span class="p">]</span><span class="si">}</span><span class="s2"> seen twice. Using first definition.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$substance_colour</span><span class="p">[</span><span class="nv">$substance</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$colour</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_5.11</span>
<span class="c1">// PHP offers a number of array-based &#39;set operation&#39; functions:</span>
<span class="c1">// * union:        array_merge</span>
<span class="c1">// * intersection: array_intersect and family</span>
<span class="c1">// * difference:   array_diff and family</span>
<span class="c1">// which may be used for this type of task</span>

<span class="c1">// Keys occurring in both hashes</span>
<span class="nv">$common</span> <span class="o">=</span> <span class="nb">array_intersect_key</span><span class="p">(</span><span class="nv">$h1</span><span class="p">,</span> <span class="nv">$h2</span><span class="p">);</span>

<span class="c1">// Keys occurring in the first hash [left side], but not in the second hash</span>
<span class="nv">$this_not_that</span> <span class="o">=</span> <span class="nb">array_diff_key</span><span class="p">(</span><span class="nv">$h1</span><span class="p">,</span> <span class="nv">$h2</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$food_colour</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Apple&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;Banana&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Lemon&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;Carrot&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;orange&#39;</span><span class="p">);</span>

<span class="nv">$citrus_colour</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Lemon&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;Orange&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;Lime&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;green&#39;</span><span class="p">);</span>

<span class="nv">$non_citrus</span> <span class="o">=</span> <span class="nb">array_diff_key</span><span class="p">(</span><span class="nv">$food_colour</span><span class="p">,</span> <span class="nv">$citrus_colour</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_5.12</span>
<span class="c1">// PHP implements a special type known as a &#39;resource&#39; that encompasses things like file handles,</span>
<span class="c1">// sockets, database connections, and many others. The &#39;resource&#39; type is, essentially, a</span>
<span class="c1">// reference variable that is not readily serialisable. That is to say:</span>
<span class="c1">// * A &#39;resource&#39; may be converted to a string representation via the &#39;var_export&#39; function</span>
<span class="c1">// * That same string cannot be converted back into a &#39;resource&#39;</span>
<span class="c1">// So, in terms of array handling, &#39;resource&#39; types may be stored as array reference values,</span>
<span class="c1">// but cannot be used as keys. </span>
<span class="c1">//</span>
<span class="c1">// I suspect it is this type of problem that the Perl::Tie package helps resolve. However, since</span>
<span class="c1">// PHP doesn&#39;t, AFAIK, sport a similar facility, the examples in this section cannot be</span>
<span class="c1">// implemented using file handles as keys</span>

<span class="nv">$filenames</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;/etc/termcap&#39;</span><span class="p">,</span> <span class="s1">&#39;/vmlinux&#39;</span><span class="p">,</span> <span class="s1">&#39;/bin/cat&#39;</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$filenames</span> <span class="k">as</span> <span class="nv">$filename</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$fh</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)))</span> <span class="k">continue</span><span class="p">;</span>

  <span class="c1">// Cannot do this as required by the Perl code:</span>
  <span class="c1">// $name[$fh] = $filename;</span>

  <span class="c1">// Ok</span>
  <span class="nv">$name</span><span class="p">[</span><span class="nv">$filename</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$fh</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Would traverse array via:</span>
<span class="c1">//</span>
<span class="c1">// foreach(array_keys($name) as $fh)</span>
<span class="c1">// ...</span>
<span class="c1">// or</span>
<span class="c1">//</span>
<span class="c1">// foreach($name as $fh =&gt; $filename)</span>
<span class="c1">// ...</span>
<span class="c1">// but since &#39;$fh&#39; cannot be a key, either of these will work:</span>
<span class="c1">//</span>
<span class="c1">// foreach($name as $filename =&gt; $fh)</span>
<span class="c1">// or</span>
<span class="k">foreach</span><span class="p">(</span><span class="nb">array_values</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$fh</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fh</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_5.13</span>
<span class="c1">// PHP hashes are dynamic expanding and contracting as entries are added, and removed,</span>
<span class="c1">// respectively. Thus, there is no need to presize a hash, nor is there, AFAIK, any</span>
<span class="c1">// means of doing so except by the number of datums used when defining the hash</span>

<span class="c1">// zero elements</span>
<span class="nv">$hash</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>            

<span class="c1">// ------------</span>

<span class="c1">// three elements</span>
<span class="nv">$hash</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Apple&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;Lemon&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;Carrot&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;orange&#39;</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_5.14</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$element</span><span class="p">)</span> <span class="nv">$count</span><span class="p">[</span><span class="nv">$element</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">// @@PLEAC@@_5.15</span>
<span class="nv">$father</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;Cain&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Adam&#39;</span><span class="p">,</span> <span class="s1">&#39;Abel&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Adam&#39;</span><span class="p">,</span> <span class="s1">&#39;Seth&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Adam&#39;</span><span class="p">,</span> <span class="s1">&#39;Enoch&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Cain&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Irad&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Enoch&#39;</span><span class="p">,</span> <span class="s1">&#39;Mehujael&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Irad&#39;</span><span class="p">,</span> <span class="s1">&#39;Methusael&#39;</span><span class="o">=&gt;</span> <span class="s1">&#39;Mehujael&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Lamech&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Methusael&#39;</span><span class="p">,</span> <span class="s1">&#39;Jabal&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Lamech&#39;</span><span class="p">,</span> <span class="s1">&#39;Jubal&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Lamech&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Tubalcain&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Lamech&#39;</span><span class="p">,</span> <span class="s1">&#39;Enos&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Seth&#39;</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nv">$name</span> <span class="o">=</span> <span class="nx">trim</span><span class="p">(</span><span class="nb">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">));</span>

<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">))</span>
<span class="p">{</span>
  <span class="k">while</span> <span class="p">(</span><span class="k">TRUE</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">$name</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

    <span class="c1">// Can use either:</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$father</span><span class="p">[</span><span class="nv">$name</span><span class="p">]))</span> <span class="k">break</span><span class="p">;</span>
    <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$father</span><span class="p">[</span><span class="nv">$name</span><span class="p">];</span>

    <span class="c1">// or:</span>
    <span class="c1">// if (!key_exists($name, $father)) break;</span>
    <span class="c1">// $name = $father[$name];</span>

    <span class="c1">// or combine the two lines:</span>
    <span class="c1">// if (!($name = $father[$name])) break;</span>
  <span class="p">}</span>

  <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
  <span class="nv">$name</span> <span class="o">=</span> <span class="nx">trim</span><span class="p">(</span><span class="nb">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="nb">define</span><span class="p">(</span><span class="nx">SEP</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$father</span> <span class="k">as</span> <span class="nv">$child</span> <span class="o">=&gt;</span> <span class="nv">$parent</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$children</span><span class="p">[</span><span class="nv">$parent</span><span class="p">])</span>
    <span class="nv">$children</span><span class="p">[</span><span class="nv">$parent</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$child</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="nv">$children</span><span class="p">[</span><span class="nv">$parent</span><span class="p">]</span> <span class="o">.=</span> <span class="nx">SEP</span> <span class="o">.</span> <span class="nv">$child</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$name</span> <span class="o">=</span> <span class="nx">trim</span><span class="p">(</span><span class="nb">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">));</span>

<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">))</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="nv">$name</span> <span class="o">.</span> <span class="s1">&#39; begat &#39;</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$children</span><span class="p">[</span><span class="nv">$name</span><span class="p">])</span>
    <span class="k">echo</span> <span class="s2">&quot;Nothing</span><span class="se">\n</span><span class="s2">&quot;</span>
  <span class="k">else</span>
    <span class="k">echo</span> <span class="nb">str_replace</span><span class="p">(</span><span class="nx">SEP</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="nv">$children</span><span class="p">[</span><span class="nv">$name</span><span class="p">])</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

  <span class="nv">$name</span> <span class="o">=</span> <span class="nx">trim</span><span class="p">(</span><span class="nb">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="nb">define</span><span class="p">(</span><span class="nx">SEP</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">);</span>

<span class="nv">$files</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;/tmp/a&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/b&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/c&#39;</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">))</span> <span class="p">{</span> <span class="k">echo</span> <span class="s2">&quot;Skipping </span><span class="si">{</span><span class="nv">$file</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">continue</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$fh</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)))</span> <span class="p">{</span> <span class="k">echo</span> <span class="s2">&quot;Skipping </span><span class="si">{</span><span class="nv">$file</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">continue</span><span class="p">;</span> <span class="p">}</span>

  <span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$fh</span><span class="p">);</span>

  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$fh</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/^\s*#\s*include\s*&lt;([^&gt;]+)&gt;/&#39;</span><span class="p">,</span> <span class="nv">$line</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$includes</span><span class="p">[</span><span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span>
        <span class="nv">$includes</span><span class="p">[</span><span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">.=</span> <span class="nx">SEP</span> <span class="o">.</span> <span class="nv">$file</span><span class="p">;</span>
      <span class="k">else</span>
        <span class="nv">$includes</span><span class="p">[</span><span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$fh</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fh</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nv">$includes</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_5.16</span>
<span class="c1">// @@INCOMPLETE@@</span>
<span class="c1">// @@INCOMPLETE@@</span>

<span class="c1">// @@PLEAC@@_9.0</span>
<span class="nv">$entry</span> <span class="o">=</span> <span class="nb">stat</span><span class="p">(</span><span class="s1">&#39;/bin/vi&#39;</span><span class="p">);</span>
<span class="nv">$entry</span> <span class="o">=</span> <span class="nb">stat</span><span class="p">(</span><span class="s1">&#39;/usr/bin&#39;</span><span class="p">);</span>
<span class="nv">$entry</span> <span class="o">=</span> <span class="nb">stat</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

<span class="c1">// ------------</span>

<span class="nv">$entry</span> <span class="o">=</span> <span class="nb">stat</span><span class="p">(</span><span class="s1">&#39;/bin/vi&#39;</span><span class="p">);</span>

<span class="nv">$ctime</span> <span class="o">=</span> <span class="nv">$entry</span><span class="p">[</span><span class="s1">&#39;ctime&#39;</span><span class="p">];</span>
<span class="nv">$size</span> <span class="o">=</span> <span class="nv">$entry</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">];</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// For the simple task of determining whether a file contains, text&#39;, a simple</span>
<span class="c1">// function that searches for a newline could be implemented. Not exactly</span>
<span class="c1">// foolproof, but very simple, low overhead, no installation headaches ...</span>
<span class="k">function</span> <span class="nf">containsText</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$status</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">((</span><span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)))</span>
  <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="k">FALSE</span> <span class="o">!==</span> <span class="p">(</span><span class="nv">$char</span> <span class="o">=</span> <span class="nb">fgetc</span><span class="p">(</span><span class="nv">$fp</span><span class="p">)))</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$char</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$status</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fp</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nv">$status</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// PHP offers the [currently experimental] Fileinfo group of functions to</span>
<span class="c1">// determine file types based on their contents / &#39;magic numbers&#39;. This</span>
<span class="c1">// is functionality similar to the *NIX, &#39;file&#39; utility. Note that it must</span>
<span class="c1">// first be installed using the PEAR utility [see PHP documentation] </span>
<span class="k">function</span> <span class="nf">isTextFile</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Note: untested code, but I believe this is how it is supposed to work</span>
  <span class="nv">$finfo</span> <span class="o">=</span> <span class="nb">finfo_open</span><span class="p">(</span><span class="nx">FILEINFO_NONE</span><span class="p">);</span>
  <span class="nv">$status</span> <span class="o">=</span> <span class="p">(</span><span class="nb">finfo_file</span><span class="p">(</span><span class="nv">$finfo</span><span class="p">,</span> <span class="nv">$file</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ASCII text&#39;</span><span class="p">);</span>
  <span class="nb">finfo_close</span><span class="p">(</span><span class="nv">$finfo</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$status</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Alternatively, use the *NIX utility, &#39;file&#39;, directly</span>
<span class="k">function</span> <span class="nf">isTextFile</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="nb">exec</span><span class="p">(</span><span class="nx">trim</span><span class="p">(</span><span class="s1">&#39;file -bN &#39;</span> <span class="o">.</span> <span class="nb">escapeshellarg</span><span class="p">(</span><span class="nv">$file</span><span class="p">)))</span> <span class="o">==</span> <span class="s1">&#39;ASCII text&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ----</span>

<span class="nx">containsText</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;File </span><span class="si">{</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> doesn&#39;t have any text in it</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="nx">isTextFile</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;File </span><span class="si">{</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> doesn&#39;t have any text in it</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$dirname</span> <span class="o">=</span> <span class="s1">&#39;/usr/bin/&#39;</span><span class="p">;</span>

<span class="p">(</span><span class="nv">$dirhdl</span> <span class="o">=</span> <span class="nb">opendir</span><span class="p">(</span><span class="nv">$dirname</span><span class="p">))</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t open </span><span class="si">{</span><span class="nv">$dirname</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="k">while</span> <span class="p">((</span><span class="nv">$file</span> <span class="o">=</span> <span class="nb">readdir</span><span class="p">(</span><span class="nv">$dirhdl</span><span class="p">))</span> <span class="o">!==</span> <span class="k">FALSE</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Inside %s is something called: %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$dirname</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">closedir</span><span class="p">(</span><span class="nv">$dirhdl</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_9.1</span>
<span class="nv">$filename</span> <span class="o">=</span> <span class="s1">&#39;example.txt&#39;</span><span class="p">;</span>

<span class="c1">// Get the file&#39;s current access and modification time, respectively</span>
<span class="nv">$fs</span> <span class="o">=</span> <span class="nb">stat</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>

<span class="nv">$readtime</span> <span class="o">=</span> <span class="nv">$fs</span><span class="p">[</span><span class="s1">&#39;atime&#39;</span><span class="p">];</span>
<span class="nv">$writetime</span> <span class="o">=</span> <span class="nv">$fs</span><span class="p">[</span><span class="s1">&#39;mtime&#39;</span><span class="p">];</span>

<span class="c1">// Alter $writetime, and $readtime ...</span>

<span class="c1">// Update file timestamp</span>
<span class="nb">touch</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$writetime</span><span class="p">,</span> <span class="nv">$readtime</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$filename</span> <span class="o">=</span> <span class="s1">&#39;example.txt&#39;</span><span class="p">;</span>

<span class="c1">// Get the file&#39;s current access and modification time, respectively</span>
<span class="nv">$fs</span> <span class="o">=</span> <span class="nb">stat</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>

<span class="nv">$atime</span> <span class="o">=</span> <span class="nv">$fs</span><span class="p">[</span><span class="s1">&#39;atime&#39;</span><span class="p">];</span>
<span class="nv">$mtime</span> <span class="o">=</span> <span class="nv">$fs</span><span class="p">[</span><span class="s1">&#39;mtime&#39;</span><span class="p">];</span>

<span class="c1">// Dedicated functions also exist to retrieve this information:</span>
<span class="c1">//</span>
<span class="c1">// $atime = $fileatime($filename);</span>
<span class="c1">// $mtime = $filemtime($filename);</span>
<span class="c1">//</span>

<span class="c1">// Perform date arithmetic. Traditional approach where arithmetic is performed</span>
<span class="c1">// directly with Epoch Seconds [i.e. the *NIX time stamp value] will work ...</span>

<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;SECONDS_PER_DAY&#39;</span><span class="p">,</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">);</span>

<span class="c1">// Set file&#39;s access and modification times to 1 week ago</span>
<span class="nv">$atime</span> <span class="o">-=</span> <span class="mi">7</span> <span class="o">*</span> <span class="nx">SECONDS_PER_DAY</span><span class="p">;</span>
<span class="nv">$mtime</span> <span class="o">-=</span> <span class="mi">7</span> <span class="o">*</span> <span class="nx">SECONDS_PER_DAY</span><span class="p">;</span>

<span class="c1">// ... but care must be taken to account for daylight saving. Therefore, the</span>
<span class="c1">// recommended approach is to use library functions to perform such tasks:</span>

<span class="nv">$atime</span> <span class="o">=</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;-7 days&#39;</span><span class="p">,</span> <span class="nv">$atime</span><span class="p">);</span>
<span class="nv">$mtime</span> <span class="o">=</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;-7 days&#39;</span><span class="p">,</span> <span class="nv">$mtime</span><span class="p">);</span>

<span class="c1">// Update file timestamp</span>
<span class="nb">touch</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$mtime</span><span class="p">,</span> <span class="nv">$atime</span><span class="p">);</span>

<span class="c1">// Good idea to clear the cache after such updates have occurred so fresh</span>
<span class="c1">// values will be retrieved on next access</span>
<span class="nb">clearstatcache</span><span class="p">();</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$argc</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;usage: </span><span class="si">{</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> filename</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="nv">$filename</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="nv">$fs</span> <span class="o">=</span> <span class="nb">stat</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>

<span class="nv">$atime</span> <span class="o">=</span> <span class="nv">$fs</span><span class="p">[</span><span class="s1">&#39;atime&#39;</span><span class="p">];</span>
<span class="nv">$mtime</span> <span class="o">=</span> <span class="nv">$fs</span><span class="p">[</span><span class="s1">&#39;mtime&#39;</span><span class="p">];</span>

<span class="c1">// Careful here: since interactive, use, &#39;system&#39;, not &#39;exec&#39;, to launch [latter</span>
<span class="c1">// does not work under *NIX - at least, not for me :)]</span>
<span class="nb">system</span><span class="p">(</span><span class="nx">trim</span><span class="p">(</span><span class="nb">getenv</span><span class="p">(</span><span class="s1">&#39;EDITOR&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39; vi &#39;</span> <span class="o">.</span> <span class="nb">escapeshellarg</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)),</span> <span class="nv">$retcode</span><span class="p">);</span>

<span class="nb">touch</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$mtime</span><span class="p">,</span> <span class="nv">$atime</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Error updating timestamp on file, </span><span class="si">{</span><span class="nv">$filename</span><span class="si">}</span><span class="s2">!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_9.2</span>
<span class="c1">// The &#39;unlink&#39; function is used to delete regular files, whilst the &#39;rmdir&#39; function</span>
<span class="c1">// does the same on non-empty directories. AFAIK, no recursive-deletion facility</span>
<span class="c1">// exists, and must be manually programmed</span>

<span class="nv">$filename</span> <span class="o">=</span> <span class="s1">&#39;...&#39;</span><span class="p">;</span>

<span class="o">@</span><span class="nb">unlink</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Can&#39;t delete, </span><span class="si">{</span><span class="nv">$filename</span><span class="si">}</span><span class="s2">!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nv">$files</span> <span class="o">=</span> <span class="nb">glob</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">);</span>
<span class="nv">$problem</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span>

<span class="c1">// Could simply use a foreach loop</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$filename</span><span class="p">)</span> <span class="p">{</span> <span class="o">@</span><span class="nb">unlink</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span> <span class="o">||</span> <span class="nv">$problem</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span> <span class="p">}</span>

<span class="c1">//</span>
<span class="c1">// Alternatively, an applicative approach could be used, one closer in spirit to</span>
<span class="c1">// largely-functional languages like Scheme</span>
<span class="c1">//</span>
<span class="c1">// function is_all_deleted($deleted, $filename) { return @unlink($filename) &amp;&amp; $deleted; }</span>
<span class="c1">// $problem = !array_reduce($files, &#39;is_all_deleted&#39;, TRUE);</span>
<span class="c1">//</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$problem</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDERR</span><span class="p">,</span> <span class="s1">&#39;Could not delete all of:&#39;</span><span class="p">);</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$filename</span><span class="p">)</span> <span class="p">{</span> <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDERR</span><span class="p">,</span> <span class="s1">&#39; &#39;</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">);</span> <span class="p">}</span>
  <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDERR</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span> <span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span> 

<span class="c1">// ------------</span>

<span class="k">function</span> <span class="nf">rmAll</span><span class="p">(</span><span class="nv">$files</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">foreach</span><span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$filename</span><span class="p">)</span> <span class="p">{</span> <span class="o">@</span><span class="nb">unlink</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$count</span><span class="o">++</span><span class="p">;</span> <span class="p">};</span>

  <span class="k">return</span> <span class="nv">$count</span><span class="p">;</span>

<span class="c1">// An applicative alternative using &#39;create_function&#39;, PHP&#39;s rough equivalent of &#39;lambda&#39; ...</span>
<span class="c1">//</span>
<span class="c1">//  return array_reduce($files,</span>
<span class="c1">//    create_function(&#39;$count, $filename&#39;, &#39;return @unlink($filename) &amp;&amp; $count++;&#39;), 0);</span>
<span class="p">}</span>

<span class="c1">// ----</span>

<span class="nv">$files</span> <span class="o">=</span> <span class="nb">glob</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">);</span>
<span class="nv">$toBeDeleted</span> <span class="o">=</span> <span class="nb">sizeof</span><span class="p">(</span><span class="nv">$files</span><span class="p">);</span>
<span class="nv">$count</span> <span class="o">=</span> <span class="nx">rmAll</span><span class="p">(</span><span class="nv">$files</span><span class="p">);</span>

<span class="p">(</span><span class="nv">$count</span> <span class="o">==</span> <span class="nv">$toBeDeleted</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Could only delete </span><span class="si">{</span><span class="nv">$count</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="nv">$toBeDeleted</span><span class="si">}</span><span class="s2"> files</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_9.3</span>
<span class="nv">$oldfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/old&#39;</span><span class="p">;</span> <span class="nv">$newfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/new&#39;</span><span class="p">;</span>

<span class="nb">copy</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">,</span> <span class="nv">$newfile</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Error copying file</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// All the following copy a file by copying its contents. Examples do so in a single</span>
<span class="c1">// operation, but it is also possible to copy arbitrary blocks, or, line-by-line in </span>
<span class="c1">// the case of &#39;text&#39; files</span>
<span class="nv">$oldfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/old&#39;</span><span class="p">;</span> <span class="nv">$newfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/new&#39;</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">is_file</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">))</span>
  <span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">,</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">));</span>
<span class="k">else</span>
  <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Problem copying file </span><span class="si">{</span><span class="nv">$oldfile</span><span class="si">}</span><span class="s2"> to file </span><span class="si">{</span><span class="nv">$newfile</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="nv">$oldfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/old&#39;</span><span class="p">;</span> <span class="nv">$newfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/new&#39;</span><span class="p">;</span>

<span class="nb">fwrite</span><span class="p">((</span><span class="nv">$nh</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)),</span> <span class="nb">fread</span><span class="p">((</span><span class="nv">$oh</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)),</span> <span class="nb">filesize</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">)));</span>
<span class="nb">fclose</span><span class="p">(</span><span class="nv">$oh</span><span class="p">);</span>
<span class="nb">fclose</span><span class="p">(</span><span class="nv">$nh</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="c1">// As above, but with some error checking / handling</span>
<span class="nv">$oldfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/old&#39;</span><span class="p">;</span> <span class="nv">$newfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/new&#39;</span><span class="p">;</span>

<span class="p">(</span><span class="nv">$oh</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Problem opening input file </span><span class="si">{</span><span class="nv">$oldfile</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">(</span><span class="nv">$nh</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Problem opening output file </span><span class="si">{</span><span class="nv">$newfile</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">((</span><span class="nv">$filesize</span> <span class="o">=</span> <span class="nb">filesize</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$nh</span><span class="p">,</span> <span class="nb">fread</span><span class="p">(</span><span class="nv">$oh</span><span class="p">,</span> <span class="nv">$filesize</span><span class="p">))</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Problem reading / writing file data</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">fclose</span><span class="p">(</span><span class="nv">$oh</span><span class="p">);</span>
<span class="nb">fclose</span><span class="p">(</span><span class="nv">$nh</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Should there be platform-specfic problems copying &#39;very large&#39; files, it is</span>
<span class="c1">// a simple matter to call a system command utility via, &#39;exec&#39;</span>

<span class="c1">// *NIX-specific example. Could check whether, &#39;exec&#39;, succeeded, but checking whether</span>
<span class="c1">// a file exists after the operation might be a better approach</span>
<span class="nv">$oldfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/old&#39;</span><span class="p">;</span> <span class="nv">$newfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/new&#39;</span><span class="p">;</span>

<span class="nb">is_file</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">unlink</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">);</span>

<span class="nb">exec</span><span class="p">(</span><span class="nx">trim</span><span class="p">(</span><span class="s1">&#39;cp --force &#39;</span> <span class="o">.</span> <span class="nb">escapeshellarg</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39; &#39;</span> <span class="o">.</span> <span class="nb">escapeshellarg</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">)));</span>

<span class="nb">is_file</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Problem copying file </span><span class="si">{</span><span class="nv">$oldfile</span><span class="si">}</span><span class="s2"> to file </span><span class="si">{</span><span class="nv">$newfile</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// For other operating systems just change:</span>
<span class="c1">// * filenames</span>
<span class="c1">// * command being &#39;exec&#39;ed</span>
<span class="c1">// as the rest of the code is platform independant</span>

<span class="c1">// @@PLEAC@@_9.4</span>
<span class="k">function</span> <span class="nf">makeDevInodePair</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$fs</span> <span class="o">=</span> <span class="o">@</span><span class="nb">stat</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)))</span> <span class="k">return</span> <span class="k">FALSE</span><span class="p">;</span>
  <span class="k">return</span> <span class="nb">strval</span><span class="p">(</span><span class="nv">$fs</span><span class="p">[</span><span class="s1">&#39;dev&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="nv">$fs</span><span class="p">[</span><span class="s1">&#39;ino&#39;</span><span class="p">]);</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="k">function</span> <span class="nf">do_my_thing</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Using a global variable to mimic Perl example, but could easily have passed</span>
  <span class="c1">// &#39;$seen&#39; as an argument</span>
  <span class="k">global</span> <span class="nv">$seen</span><span class="p">;</span>

  <span class="nv">$devino</span> <span class="o">=</span> <span class="nx">makeDevInodePair</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>

  <span class="c1">// Process $filename if it has not previously been seen, else just increment</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$seen</span><span class="p">[</span><span class="nv">$devino</span><span class="p">]))</span>
  <span class="p">{</span>
    <span class="c1">// ... process $filename ...</span>

    <span class="c1">// Set initial count</span>
    <span class="nv">$seen</span><span class="p">[</span><span class="nv">$devino</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="c1">// Otherwise, just increment the count</span>
    <span class="nv">$seen</span><span class="p">[</span><span class="nv">$devino</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ----</span>

<span class="c1">// Simple example</span>
<span class="nv">$seen</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

<span class="nx">do_my_thing</span><span class="p">(</span><span class="s1">&#39;/tmp/old&#39;</span><span class="p">);</span>
<span class="nx">do_my_thing</span><span class="p">(</span><span class="s1">&#39;/tmp/old&#39;</span><span class="p">);</span>
<span class="nx">do_my_thing</span><span class="p">(</span><span class="s1">&#39;/tmp/old&#39;</span><span class="p">);</span>
<span class="nx">do_my_thing</span><span class="p">(</span><span class="s1">&#39;/tmp/new&#39;</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$seen</span> <span class="k">as</span> <span class="nv">$devino</span> <span class="o">=&gt;</span> <span class="nv">$count</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$devino</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="nv">$count</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="c1">// A variation on the above avoiding use of global variables, and illustrating use of</span>
<span class="c1">// easily-implemented &#39;higher order&#39; techniques</span>

<span class="c1">// Helper function loosely modelled on, &#39;array_reduce&#39;, but using an array as</span>
<span class="c1">// &#39;accumulator&#39;, which is returned on completion</span>
<span class="k">function</span> <span class="nf">array_update</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="nv">$lambda</span><span class="p">,</span> <span class="nv">$updarr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nv">$arr</span> <span class="k">as</span> <span class="nv">$key</span><span class="p">)</span> <span class="nv">$lambda</span><span class="p">(</span><span class="nv">$updarr</span><span class="p">,</span> <span class="nv">$key</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$updarr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">do_my_thing</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$seen</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">array_key_exists</span><span class="p">((</span><span class="nv">$devino</span> <span class="o">=</span> <span class="nx">makeDevInodePair</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)),</span> <span class="nv">$seen</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="c1">// ... processing $filename ...</span>

    <span class="c1">// Update $seen</span>
    <span class="nv">$seen</span><span class="p">[</span><span class="nv">$devino</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="c1">// Update $seen</span>
    <span class="nv">$seen</span><span class="p">[</span><span class="nv">$devino</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ----</span>

<span class="c1">// Simple example</span>
<span class="nv">$files</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;/tmp/old&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/old&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/old&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/new&#39;</span><span class="p">);</span>

<span class="c1">// Could do this ...</span>
<span class="nv">$seen</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="nx">array_update</span><span class="p">(</span><span class="nv">$files</span><span class="p">,</span> <span class="s1">&#39;do_my_thing&#39;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$seen</span><span class="p">);</span>

<span class="c1">// or this:</span>
<span class="nv">$seen</span> <span class="o">=</span> <span class="nx">array_update</span><span class="p">(</span><span class="nv">$files</span><span class="p">,</span> <span class="s1">&#39;do_my_thing&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>

<span class="c1">// or a &#39;lambda&#39; could be used:</span>
<span class="nx">array_update</span><span class="p">(</span><span class="nv">$files</span><span class="p">,</span>
             <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$seen, $filename&#39;</span><span class="p">,</span> <span class="s1">&#39;... code not shown ...&#39;</span><span class="p">),</span>
             <span class="o">&amp;</span><span class="nv">$seen</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$seen</span> <span class="k">as</span> <span class="nv">$devino</span> <span class="o">=&gt;</span> <span class="nv">$count</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$devino</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="nv">$count</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$files</span> <span class="o">=</span> <span class="nb">glob</span><span class="p">(</span><span class="s1">&#39;/tmp/*&#39;</span><span class="p">);</span>

<span class="nb">define</span><span class="p">(</span><span class="nx">SEP</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">);</span>
<span class="nv">$seen</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$filename</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">array_key_exists</span><span class="p">((</span><span class="nv">$devino</span> <span class="o">=</span> <span class="nx">makeDevInodePair</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)),</span> <span class="nv">$seen</span><span class="p">))</span>
    <span class="nv">$seen</span><span class="p">[</span><span class="nv">$devino</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$filename</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="nv">$seen</span><span class="p">[</span><span class="nv">$devino</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$seen</span><span class="p">[</span><span class="nv">$devino</span><span class="p">]</span> <span class="o">.</span> <span class="nx">SEP</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$devino</span> <span class="o">=</span> <span class="nb">array_keys</span><span class="p">(</span><span class="nv">$seen</span><span class="p">);</span>
<span class="nb">sort</span><span class="p">(</span><span class="nv">$devino</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$devino</span> <span class="k">as</span> <span class="nv">$key</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="nv">$key</span> <span class="o">.</span> <span class="s1">&#39;:&#39;</span><span class="p">;</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nb">split</span><span class="p">(</span><span class="nx">SEP</span><span class="p">,</span> <span class="nv">$seen</span><span class="p">[</span><span class="nv">$key</span><span class="p">])</span> <span class="k">as</span> <span class="nv">$filename</span><span class="p">)</span> <span class="k">echo</span> <span class="s1">&#39; &#39;</span> <span class="o">.</span> <span class="nv">$filename</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_9.5</span>
<span class="c1">// Conventional POSIX-like approach to directory traversal</span>
<span class="nv">$dirname</span> <span class="o">=</span> <span class="s1">&#39;/usr/bin/&#39;</span><span class="p">;</span>

<span class="p">(</span><span class="nv">$dirhdl</span> <span class="o">=</span> <span class="nb">opendir</span><span class="p">(</span><span class="nv">$dirname</span><span class="p">))</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t open </span><span class="si">{</span><span class="nv">$dirname</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="k">while</span> <span class="p">((</span><span class="nv">$file</span> <span class="o">=</span> <span class="nb">readdir</span><span class="p">(</span><span class="nv">$dirhdl</span><span class="p">))</span> <span class="o">!==</span> <span class="k">FALSE</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ... do something with $dirname/$file</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="nb">closedir</span><span class="p">(</span><span class="nv">$dirhdl</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="c1">// Newer [post PHP 4], &#39;applicative&#39; approach - an array of filenames is</span>
<span class="c1">// generated that may be processed via external loop ...</span>

<span class="nv">$dirname</span> <span class="o">=</span> <span class="s1">&#39;/usr/bin/&#39;</span><span class="p">;</span>

<span class="k">foreach</span><span class="p">(</span><span class="nb">scandir</span><span class="p">(</span><span class="nv">$dirname</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ... do something with $dirname/$file</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// .. or, via callback application, perhaps after massaging by one of the</span>
<span class="c1">// &#39;array&#39; family of functions [also uses, &#39;array_update&#39;, from earlier section]</span>

<span class="nv">$newlist</span> <span class="o">=</span> <span class="nx">array_update</span><span class="p">(</span><span class="nb">array_reverse</span><span class="p">(</span><span class="nb">scandir</span><span class="p">(</span><span class="nv">$dirname</span><span class="p">)),</span>
                        <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$filelist, $file&#39;</span><span class="p">,</span>  <span class="s1">&#39; ; &#39;</span><span class="p">),</span>
                        <span class="k">array</span><span class="p">());</span>

<span class="c1">// And don&#39;t forget that the old standby, &#39;glob&#39;, that returns an array of</span>
<span class="c1">// paths filtered using the Bourne Shell-based wildcards, &#39;?&#39; and &#39;*&#39;, is</span>
<span class="c1">// also available</span>

<span class="k">foreach</span><span class="p">(</span><span class="nb">glob</span><span class="p">(</span><span class="nv">$dirname</span> <span class="o">.</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$path</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ... do something with $path</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Uses, &#39;isTextFile&#39;, from an earlier section</span>
<span class="nv">$dirname</span> <span class="o">=</span> <span class="s1">&#39;/usr/bin/&#39;</span><span class="p">;</span>

<span class="k">echo</span> <span class="s2">&quot;Text files in </span><span class="si">{</span><span class="nv">$dirname</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="k">foreach</span><span class="p">(</span><span class="nb">scandir</span><span class="p">(</span><span class="nv">$dirname</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Take care when constructing paths to ensure cross-platform operability </span>
  <span class="nv">$path</span> <span class="o">=</span> <span class="nv">$dirname</span> <span class="o">.</span> <span class="nv">$file</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nb">is_file</span><span class="p">(</span><span class="nv">$path</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isTextFile</span><span class="p">(</span><span class="nv">$path</span><span class="p">))</span> <span class="k">echo</span> <span class="nv">$path</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">plain_files</span><span class="p">(</span><span class="nv">$dirname</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">(</span><span class="nv">$dirlist</span> <span class="o">=</span> <span class="nb">glob</span><span class="p">(</span><span class="nv">$dirname</span> <span class="o">.</span> <span class="s1">&#39;*&#39;</span><span class="p">))</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t glob </span><span class="si">{</span><span class="nv">$dirname</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

  <span class="c1">// Pass function name directly if only a single function performs filter test</span>
  <span class="k">return</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$dirlist</span><span class="p">,</span> <span class="s1">&#39;is_file&#39;</span><span class="p">);</span>

  <span class="c1">// Use, &#39;create_function&#39;, if a multi-function test is needed</span>
  <span class="c1">//</span>
  <span class="c1">// return array_filter($dirlist, create_function(&#39;$path&#39;, &#39;return is_file($path);&#39;));</span>
  <span class="c1">//</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="k">foreach</span><span class="p">(</span><span class="nx">plain_files</span><span class="p">(</span><span class="s1">&#39;/tmp/&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$path</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">echo</span> <span class="nv">$path</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_9.6</span>
<span class="nv">$dirname</span> <span class="o">=</span> <span class="s1">&#39;/tmp/&#39;</span><span class="p">;</span>

<span class="c1">// Full paths</span>
<span class="nv">$pathlist</span> <span class="o">=</span> <span class="nb">glob</span><span class="p">(</span><span class="nv">$dirname</span> <span class="o">.</span> <span class="s1">&#39;*.c&#39;</span><span class="p">);</span>

<span class="c1">// File names only - glob-based matching</span>
<span class="nv">$filelist</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nb">scandir</span><span class="p">(</span><span class="nv">$dirname</span><span class="p">),</span>
                         <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$file&#39;</span><span class="p">,</span> <span class="s1">&#39;return fnmatch(&quot;*.c&quot;, $file);&#39;</span><span class="p">));</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$dirname</span> <span class="o">=</span> <span class="s1">&#39;/tmp/&#39;</span><span class="p">;</span>

<span class="c1">// File names only - regex-based matching [case-insensitive]</span>
<span class="nv">$filelist</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nb">scandir</span><span class="p">(</span><span class="nv">$dirname</span><span class="p">),</span>
                         <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$file&#39;</span><span class="p">,</span> <span class="s1">&#39;return eregi(&quot;\.[ch]$&quot;, $file);&#39;</span><span class="p">));</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$dirname</span> <span class="o">=</span> <span class="s1">&#39;/tmp/&#39;</span><span class="p">;</span>

<span class="c1">// Directory names - all-digit names</span>
<span class="nv">$dirs</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nb">glob</span><span class="p">(</span><span class="nv">$dirname</span> <span class="o">.</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="nx">GLOB_ONLYDIR</span><span class="p">),</span>
                     <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$path&#39;</span><span class="p">,</span> <span class="s1">&#39;return ereg(&quot;^[0-9]+$&quot;, basename($path));&#39;</span><span class="p">));</span>

<span class="c1">// @@PLEAC@@_9.7</span>
<span class="c1">// Recursive directory traversal function and helper: traverses a directory tree</span>
<span class="c1">// applying a function [and a variable number of accompanying arguments] to each</span>
<span class="c1">// file</span>

<span class="k">class</span> <span class="nc">Accumulator</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="nv">$value</span><span class="p">;</span>
  <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$start_value</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">value</span> <span class="o">=</span> <span class="nv">$start_value</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="k">function</span> <span class="nf">process_directory_</span><span class="p">(</span><span class="nv">$op</span><span class="p">,</span> <span class="nv">$func_args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$func_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
  <span class="p">{</span>
    <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$func_args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nb">scandir</span><span class="p">(</span><span class="nv">$current</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$entry</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$entry</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span> <span class="o">||</span> <span class="nv">$entry</span> <span class="o">==</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="nv">$func_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$current</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$entry</span><span class="p">;</span>
      <span class="nx">process_directory_</span><span class="p">(</span><span class="nv">$op</span><span class="p">,</span> <span class="nv">$func_args</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="nb">call_user_func_array</span><span class="p">(</span><span class="nv">$op</span><span class="p">,</span> <span class="nv">$func_args</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">process_directory</span><span class="p">(</span><span class="nv">$op</span><span class="p">,</span> <span class="nv">$dir</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">))</span> <span class="k">return</span> <span class="k">FALSE</span><span class="p">;</span>
  <span class="nv">$func_args</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nb">func_get_args</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span>
  <span class="nx">process_directory_</span><span class="p">(</span><span class="nv">$op</span><span class="p">,</span> <span class="nv">$func_args</span><span class="p">);</span>
  <span class="k">return</span> <span class="k">TRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$dirlist</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;/tmp/d1&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/d2&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/d3&#39;</span><span class="p">);</span>

<span class="c1">// Do something with each directory in the list</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$dirlist</span> <span class="k">as</span> <span class="nv">$dir</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span>
  <span class="c1">// Delete directory [if empty]     -&gt; rmdir($dir); </span>
  <span class="c1">// Make it the &#39;current directory&#39; -&gt; chdir($dir);</span>
  <span class="c1">// Get list of files it contains   -&gt; $filelist = scandir($dir);</span>
  <span class="c1">// Get directory metadata          -&gt; $ds = stat($dir);</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$dirlist</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;/tmp/d1&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/d2&#39;</span><span class="p">,</span> <span class="s1">&#39;/tmp/d3&#39;</span><span class="p">);</span>

<span class="k">function</span> <span class="nf">pf</span><span class="p">(</span><span class="nv">$path</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// ... do something to the file or directory ...</span>
  <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$path</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// For each directory in the list ...</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$dirlist</span> <span class="k">as</span> <span class="nv">$dir</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Is this a valid directory ?</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">))</span> <span class="p">{</span> <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%s does not exist</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$dir</span><span class="p">);</span> <span class="k">continue</span><span class="p">;</span> <span class="p">}</span>

  <span class="c1">// Ok, so get all the directory&#39;s entries</span>
  <span class="nv">$filelist</span> <span class="o">=</span> <span class="nb">scandir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">);</span>

  <span class="c1">// An &#39;empty&#39; directory will contain at least two entries: &#39;..&#39; and &#39;.&#39;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$filelist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%s is empty</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$dir</span><span class="p">);</span> <span class="k">continue</span><span class="p">;</span> <span class="p">}</span>

  <span class="c1">// For each file / directory in the directory ...</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nv">$filelist</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="c1">// Ignore &#39;..&#39; and &#39;.&#39; entries</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span> <span class="o">||</span> <span class="nv">$file</span> <span class="o">==</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>

    <span class="c1">// Apply function to process the file / directory</span>
    <span class="nx">pf</span><span class="p">(</span><span class="nv">$dir</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$file</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">accum_filesize</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$accum</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nb">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$accum</span><span class="o">-&gt;</span><span class="na">value</span> <span class="o">+=</span> <span class="nb">filesize</span><span class="p">(</span><span class="nv">$file</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="c1">// Verify arguments ...</span>
<span class="nv">$argc</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;usage: </span><span class="si">{</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> dir</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="nv">$dir</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

<span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{</span><span class="nv">$dir</span><span class="si">}</span><span class="s2"> does not exist / not a directory</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// Collect data [use an object to accumulate results]</span>
<span class="nv">$dirsize</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Accumulator</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="nx">process_directory</span><span class="p">(</span><span class="s1">&#39;accum_filesize&#39;</span><span class="p">,</span> <span class="nv">$dir</span><span class="p">,</span> <span class="nv">$dirsize</span><span class="p">);</span> 

<span class="c1">// Report results</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;%s contains %d bytes</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$dir</span><span class="p">,</span> <span class="nv">$dirsize</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">biggest_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$accum</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="nv">$fs</span> <span class="o">=</span> <span class="nb">filesize</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$accum</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nv">$fs</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$accum</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">;</span> <span class="nv">$accum</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$fs</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="c1">// Verify arguments ...</span>
<span class="nv">$argc</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;usage: </span><span class="si">{</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> dir</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="nv">$dir</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

<span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{</span><span class="nv">$dir</span><span class="si">}</span><span class="s2"> does not exist / not a directory</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// Collect data [use an object to accumulate results]</span>
<span class="nv">$biggest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Accumulator</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
<span class="nx">process_directory</span><span class="p">(</span><span class="s1">&#39;biggest_file&#39;</span><span class="p">,</span> <span class="nv">$dir</span><span class="p">,</span> <span class="nv">$biggest</span><span class="p">);</span> 

<span class="c1">// Report results</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Biggest file is %s containing %d bytes</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$biggest</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nv">$biggest</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">youngest_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$accum</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="nv">$fct</span> <span class="o">=</span> <span class="nb">filectime</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$accum</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nv">$fct</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$accum</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">;</span> <span class="nv">$accum</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$fct</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="c1">// Verify arguments ...</span>
<span class="nv">$argc</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;usage: </span><span class="si">{</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> dir</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="nv">$dir</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

<span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{</span><span class="nv">$dir</span><span class="si">}</span><span class="s2"> does not exist / not a directory</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// Collect data [use an object to accumulate results]</span>
<span class="nv">$youngest</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Accumulator</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">2147483647</span><span class="p">));</span>
<span class="nx">process_directory</span><span class="p">(</span><span class="s1">&#39;youngest_file&#39;</span><span class="p">,</span> <span class="nv">$dir</span><span class="p">,</span> <span class="nv">$youngest</span><span class="p">);</span> 

<span class="c1">// Report results</span>
<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Youngest file is %s dating %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$youngest</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">date</span><span class="p">(</span><span class="nx">DATE_ATOM</span><span class="p">,</span> <span class="nv">$youngest</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>

<span class="c1">// @@PLEAC@@_9.8</span>
<span class="c1">// AFAICT, there is currently no library function that recursively removes a</span>
<span class="c1">// directory tree [i.e. a directory, it&#39;s subdirectories, and any other files]</span>
<span class="c1">// with a single call. Such a function needs to be custom built. PHP tools</span>
<span class="c1">// with which to do this:</span>
<span class="c1">// * &#39;unlink&#39;, &#39;rmdir&#39;, &#39;is_dir&#39;, and &#39;is_file&#39; functions, will all take care</span>
<span class="c1">//   of the file testing and deletion</span>
<span class="c1">// * Actual directory traversal requires obtaining directory / subdirectory</span>
<span class="c1">//   lists, and here there is much choice available, though care must be taken</span>
<span class="c1">//   as each has it&#39;s own quirks</span>
<span class="c1">//   - &#39;opendir&#39;, &#39;readdir&#39;, &#39;closedir&#39;</span>
<span class="c1">//   - &#39;scandir&#39;</span>
<span class="c1">//   - &#39;glob&#39;</span>
<span class="c1">//   - SPL &#39;directory iterator&#39; classes [newish / experimental - not shown here]</span>
<span class="c1">//</span>
<span class="c1">// The PHP documentation for &#39;rmdir&#39; contains several examples, each illustrating</span>
<span class="c1">// one of each approach; the example shown here is loosely based on one of these</span>
<span class="c1">// examples</span>

<span class="c1">// Recursor - recursively traverses directory tree</span>
<span class="k">function</span> <span class="nf">rmtree_</span><span class="p">(</span><span class="nv">$dir</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">$dir</span><span class="s2">&quot;</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nv">$dh</span> <span class="o">=</span> <span class="nb">opendir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="k">FALSE</span> <span class="o">!==</span> <span class="p">(</span><span class="nv">$item</span> <span class="o">=</span> <span class="nb">readdir</span><span class="p">(</span><span class="nv">$dh</span><span class="p">)))</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$item</span> <span class="o">!=</span> <span class="s1">&#39;.&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$item</span> <span class="o">!=</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="nv">$subdir</span> <span class="o">=</span> <span class="nv">$dir</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="si">$item</span><span class="s2">&quot;</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$subdir</span><span class="p">))</span> <span class="nx">rmtree_</span><span class="p">(</span><span class="nv">$subdir</span><span class="p">);</span>
        <span class="k">else</span> <span class="o">@</span><span class="nb">unlink</span><span class="p">(</span><span class="nv">$subdir</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="nb">closedir</span><span class="p">(</span><span class="nv">$dh</span><span class="p">);</span> <span class="o">@</span><span class="nb">rmdir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Launcher - performs validation then starts recursive routine</span>
<span class="k">function</span> <span class="nf">rmtree</span><span class="p">(</span><span class="nv">$dir</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$dir</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$dir</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$dir</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
    <span class="nx">rmtree_</span><span class="p">(</span><span class="nv">$dir</span><span class="p">);</span> <span class="k">return</span> <span class="o">!</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="k">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$argc</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;usage: rmtree dir</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="nx">rmtree</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Could not remove directory </span><span class="si">{</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_9.9</span>
<span class="nv">$filepairs</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;x.txt&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;x2.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;y.txt&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;y.doc&#39;</span><span class="p">,</span> <span class="s1">&#39;zxc.txt&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;cxz.txt&#39;</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$filepairs</span> <span class="k">as</span> <span class="nv">$oldfile</span> <span class="o">=&gt;</span> <span class="nv">$newfile</span><span class="p">)</span>
<span class="p">{</span>
  <span class="o">@</span><span class="nb">rename</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">,</span> <span class="nv">$newfile</span><span class="p">)</span> <span class="o">||</span> <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDERR</span><span class="p">,</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;Could not rename %s to %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$oldfile</span><span class="p">,</span> <span class="nv">$newfile</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Call a system command utility via, &#39;exec&#39;. *NIX-specific example. Could check whether,</span>
<span class="c1">// &#39;exec&#39;, succeeded, but checking whether a renamed file exists after the operation might</span>
<span class="c1">// be a better approach</span>

<span class="nv">$oldfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/old&#39;</span><span class="p">;</span> <span class="nv">$newfile</span> <span class="o">=</span> <span class="s1">&#39;/tmp/new&#39;</span><span class="p">;</span>

<span class="nb">is_file</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">unlink</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">);</span>

<span class="nb">exec</span><span class="p">(</span><span class="nx">trim</span><span class="p">(</span><span class="s1">&#39;mv --force &#39;</span> <span class="o">.</span> <span class="nb">escapeshellarg</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39; &#39;</span> <span class="o">.</span> <span class="nb">escapeshellarg</span><span class="p">(</span><span class="nv">$newfile</span><span class="p">)));</span>

<span class="nb">is_file</span><span class="p">(</span><span class="nv">$oldfile</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Problem renaming file </span><span class="si">{</span><span class="nv">$oldfile</span><span class="si">}</span><span class="s2"> to file </span><span class="si">{</span><span class="nv">$newfile</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// For other operating systems just change:</span>
<span class="c1">// * filenames</span>
<span class="c1">// * command being &#39;exec&#39;ed</span>
<span class="c1">// as the rest of the code is platform independant</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// A modified implementation of Larry&#39;s Filename Fixer. Rather than passing</span>
<span class="c1">// a single expression, a &#39;from&#39; regexp is passed; each match in the file</span>
<span class="c1">// name(s) is changed to the value of &#39;to&#39;. It otherwise behaves the same</span>
<span class="c1">//</span>

<span class="nv">$argc</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;usage: rename from to [file ...]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="nv">$from</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="nv">$to</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> 

<span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">((</span><span class="nv">$argv</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$argv</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">))</span> <span class="nv">$argv</span><span class="p">[]</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nb">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$argv</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$was</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">;</span>
  <span class="nv">$file</span> <span class="o">=</span> <span class="nb">ereg_replace</span><span class="p">(</span><span class="nv">$from</span><span class="p">,</span> <span class="nv">$to</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nb">strcmp</span><span class="p">(</span><span class="nv">$was</span><span class="p">,</span> <span class="nv">$file</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="o">@</span><span class="nb">rename</span><span class="p">(</span><span class="nv">$was</span><span class="p">,</span> <span class="nv">$file</span><span class="p">)</span> <span class="o">||</span> <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDERR</span><span class="p">,</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;Could not rename %s to %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$was</span><span class="p">,</span> <span class="nv">$file</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_9.10</span>
<span class="nv">$base</span> <span class="o">=</span> <span class="nb">basename</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>
<span class="nv">$dir</span> <span class="o">=</span> <span class="nb">dirname</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>

<span class="c1">// PHP&#39;s equivalent to Perl&#39;s &#39;fileparse&#39;</span>
<span class="nv">$pathinfo</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>

<span class="nv">$base</span> <span class="o">=</span> <span class="nv">$pathinfo</span><span class="p">[</span><span class="s1">&#39;basename&#39;</span><span class="p">];</span>
<span class="nv">$dir</span> <span class="o">=</span> <span class="nv">$pathinfo</span><span class="p">[</span><span class="s1">&#39;dirname&#39;</span><span class="p">];</span>
<span class="nv">$ext</span> <span class="o">=</span> <span class="nv">$pathinfo</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">];</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$path</span> <span class="o">=</span> <span class="s1">&#39;/usr/lib/libc.a&#39;</span><span class="p">;</span>

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;dir is %s, file is %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">dirname</span><span class="p">(</span><span class="nv">$path</span><span class="p">),</span> <span class="nb">basename</span><span class="p">(</span><span class="nv">$path</span><span class="p">));</span>

<span class="c1">// ------------</span>

<span class="nv">$path</span> <span class="o">=</span> <span class="s1">&#39;/usr/lib/libc.a&#39;</span><span class="p">;</span>

<span class="nv">$pathinfo</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;dir is %s, name is %s, extension is %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$pathinfo</span><span class="p">[</span><span class="s1">&#39;dirname&#39;</span><span class="p">],</span> <span class="nv">$pathinfo</span><span class="p">[</span><span class="s1">&#39;basename&#39;</span><span class="p">],</span> <span class="nv">$pathinfo</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">]);</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Handle Mac example as a simple parse task. However, AFAIK, &#39;pathinfo&#39; is cross-platform,</span>
<span class="c1">// so should handle file path format differences transparently</span>
<span class="nv">$path</span> <span class="o">=</span> <span class="s1">&#39;Hard%20Drive:System%20Folder:README.txt&#39;</span><span class="p">;</span>

<span class="nv">$macp</span> <span class="o">=</span> <span class="nb">array_combine</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;drive&#39;</span><span class="p">,</span> <span class="s1">&#39;folder&#39;</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">),</span> <span class="nb">split</span><span class="p">(</span><span class="s2">&quot;\:&quot;</span><span class="p">,</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;%20&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nv">$path</span><span class="p">)));</span>
<span class="nv">$macf</span> <span class="o">=</span> <span class="nb">array_combine</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;extension&#39;</span><span class="p">),</span> <span class="nb">split</span><span class="p">(</span><span class="s2">&quot;\.&quot;</span><span class="p">,</span> <span class="nv">$macp</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]));</span> 

<span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;dir is %s, name is %s, extension is %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nv">$macp</span><span class="p">[</span><span class="s1">&#39;drive&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;:&#39;</span> <span class="o">.</span> <span class="nv">$macp</span><span class="p">[</span><span class="s1">&#39;folder&#39;</span><span class="p">]),</span> <span class="nv">$macf</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="p">(</span><span class="s1">&#39;.&#39;</span> <span class="o">.</span> <span class="nv">$macf</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">]));</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Not really necessary since we have, &#39;pathinfo&#39;, but better matches Perl example</span>
<span class="k">function</span> <span class="nf">file_extension</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$separator</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="nb">end</span><span class="p">(</span><span class="nb">split</span><span class="p">((</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">.</span> <span class="nv">$separator</span><span class="p">),</span> <span class="nv">$filename</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// ----</span>

<span class="k">echo</span> <span class="nx">file_extension</span><span class="p">(</span><span class="s1">&#39;readme.txt&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// @@PLEAC@@_9.11</span>
<span class="c1">// @@INCOMPLETE@@</span>
<span class="c1">// @@INCOMPLETE@@</span>

<span class="c1">// @@PLEAC@@_9.12</span>
<span class="c1">// @@INCOMPLETE@@</span>
<span class="c1">// @@INCOMPLETE@@</span>

<span class="c1">// @@PLEAC@@_10.0</span>
<span class="c1">// Since defined at outermost scope, $greeted may be considered a global variable</span>
<span class="nv">$greeted</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// ------------</span>

<span class="c1">// Must use, &#39;global&#39;, keyword to inform functions that $greeted already exists as</span>
<span class="c1">// a global variable. If this is not done, a local variable of that name is implicitly</span>
<span class="c1">// defined</span>
<span class="k">function</span> <span class="nf">howManyGreetings</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">global</span> <span class="nv">$greeted</span><span class="p">;</span>
  <span class="k">return</span> <span class="nv">$greeted</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">hello</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">global</span> <span class="nv">$greeted</span><span class="p">;</span>
  <span class="nv">$greeted</span><span class="o">++</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s2">&quot;high there!, this procedure has been called </span><span class="si">{</span><span class="nv">$greeted</span><span class="si">}</span><span class="s2"> times</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nx">hello</span><span class="p">();</span>
<span class="nv">$greetings</span> <span class="o">=</span> <span class="nx">howManyGreetings</span><span class="p">();</span>
<span class="k">echo</span> <span class="s2">&quot;bye there!, there have been </span><span class="si">{</span><span class="nv">$greetings</span><span class="si">}</span><span class="s2"> greetings so far</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// @@PLEAC@@_10.1</span>
<span class="c1">// Conventionally-defined function together with parameter list</span>
<span class="k">function</span> <span class="nf">hypotenuse</span><span class="p">(</span><span class="nv">$side1</span><span class="p">,</span> <span class="nv">$side2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="nx">sqrt</span><span class="p">(</span><span class="nx">pow</span><span class="p">(</span><span class="nv">$side1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nx">pow</span><span class="p">(</span><span class="nv">$side2</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// ----</span>

<span class="c1">// Alternative is to define the function without parameter list, then use</span>
<span class="c1">// &#39;func_get_arg&#39; to extract arguments</span>
<span class="k">function</span> <span class="nf">hypotenuse</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// Could check number of arguments passed with: &#39;func_num_args&#39;, which</span>
  <span class="c1">// would be the approach used if dealing with variable number of arguments</span>
  <span class="nv">$side1</span> <span class="o">=</span> <span class="nb">func_get_arg</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="nv">$side2</span> <span class="o">=</span> <span class="nb">func_get_arg</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">sqrt</span><span class="p">(</span><span class="nx">pow</span><span class="p">(</span><span class="nv">$side1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nx">pow</span><span class="p">(</span><span class="nv">$side2</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="c1">// 1. Conventional function call</span>
<span class="nv">$diag</span> <span class="o">=</span> <span class="nx">hypotenuse</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="c1">// 2. Function call using, &#39;call_user_func&#39; library routines</span>
<span class="nv">$funcname</span> <span class="o">=</span> <span class="s1">&#39;hypotenuse&#39;</span><span class="p">;</span>

<span class="c1">// a. Pass function name, and variable number of arguments</span>
<span class="nv">$diag</span> <span class="o">=</span> <span class="nb">call_user_func</span><span class="p">(</span><span class="nv">$funcname</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

<span class="c1">// b. Package arguments as array, pass together with function name</span>
<span class="nv">$args</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span> 
<span class="nv">$diag</span> <span class="o">=</span> <span class="nb">call_user_func_array</span><span class="p">(</span><span class="nv">$funcname</span><span class="p">,</span> <span class="nv">$args</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="nv">$nums</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">6.7</span><span class="p">);</span>

<span class="c1">// ------------</span>

<span class="c1">// Pass-by-value</span>
<span class="k">function</span> <span class="nf">int_all</span><span class="p">(</span><span class="nv">$arr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="nb">array_map</span><span class="p">(</span><span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$n&#39;</span><span class="p">,</span> <span class="s1">&#39;return (int) $n;&#39;</span><span class="p">),</span> <span class="nv">$arr</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Pass-by-reference</span>
<span class="k">function</span> <span class="nf">trunc_em</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nv">$n</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$value</span><span class="p">)</span> <span class="nv">$value</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$value</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="c1">// $nums untouched; $ints is new array</span>
<span class="nv">$ints</span> <span class="o">=</span> <span class="nx">int_all</span><span class="p">(</span><span class="nv">$nums</span><span class="p">);</span>

<span class="c1">// $nums updated</span>
<span class="nx">trunc_em</span><span class="p">(</span><span class="nv">$nums</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_10.2</span>
<span class="c1">// Strictly-speaking, PHP is neither lexically [no environment capture] nor</span>
<span class="c1">// dynamically [no variable shadowing] scoped. A script in which several</span>
<span class="c1">// functions have been defined has two, entirely separate, scopes:</span>
<span class="c1">//</span>
<span class="c1">// * A &#39;top-level&#39; scope i.e. everything outside each function</span>
<span class="c1">//</span>
<span class="c1">// * A &#39;local scope&#39; within each function; each function is a self-contained</span>
<span class="c1">//   entity and cannot [via conventional means] access variables outside its</span>
<span class="c1">//   local scope. Accessing a variable that has not been locally defined</span>
<span class="c1">//   serves to define it i.e. accessing a variable assumed to be global</span>
<span class="c1">//   sees a local variable of that name defined</span>
<span class="c1">//</span>
<span class="c1">// The way &#39;global&#39; variables are provided is via a predefined array of</span>
<span class="c1">// variable names, $GLOBALS [it is one of a special set of variables known</span>
<span class="c1">// as &#39;superglobals&#39;; such variables *are* accessable in all scopes]. Each</span>
<span class="c1">// entry in this array is a &#39;global&#39; variable name, and may be freely</span>
<span class="c1">// accessed / updated. A more convenient means of accessing such variables</span>
<span class="c1">// is via the &#39;global&#39; keyword: one or more variables within a function is</span>
<span class="c1">// declared &#39;global&#39;, and those names are then taken to refer to entries</span>
<span class="c1">// in the $GLOBALS array rather than seeing local variables of that name</span>
<span class="c1">// accessed or defined</span>

<span class="k">function</span> <span class="nf">some_func</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// Variables declared within a function are local to that function</span>
  <span class="nv">$variable</span> <span class="o">=</span> <span class="s1">&#39;something&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Top-level declared variables</span>
<span class="nv">$name</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="nv">$age</span> <span class="o">=</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

<span class="nv">$c</span> <span class="o">=</span> <span class="nx">fetch_time</span><span class="p">();</span>

<span class="nv">$condition</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// ------------</span>

<span class="k">function</span> <span class="nf">run_check</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// The globally-declared variable, &#39;$condition&#39;, is not accessable within</span>
  <span class="c1">// the function unless it declared as &#39;global. Had this not been done then</span>
  <span class="c1">// attempts to access, &#39;$condition&#39;, would have seen a local variable</span>
  <span class="c1">// of that name declared and updated. Same applies to other variables</span>
  <span class="k">global</span> <span class="nv">$condition</span><span class="p">,</span> <span class="nv">$name</span><span class="p">,</span> <span class="nv">$age</span><span class="p">,</span> <span class="nv">$c</span><span class="p">;</span>

  <span class="nv">$condition</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">check_x</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$y</span> <span class="o">=</span> <span class="s1">&#39;whatever&#39;</span><span class="p">;</span>

  <span class="c1">// This function only has access to the parameter, &#39;$x&#39;, and the locally</span>
  <span class="c1">// declared variable, &#39;$y&#39;.</span>

  <span class="c1">// Whilst &#39;run_check&#39; has access to several global variables, the current</span>
  <span class="c1">// function does not. For it to access the global variable, &#39;$condition&#39;,</span>
  <span class="c1">// it must be declared &#39;global&#39;</span>
  <span class="nx">run_check</span><span class="p">();</span>

  <span class="k">global</span> <span class="nv">$condition</span><span class="p">;</span>

  <span class="c1">// &#39;run_check&#39; will have updated, &#39;$condition&#39;, and since it has been</span>
  <span class="c1">// declared &#39;global&#39; here, it is accessable</span>

  <span class="k">if</span> <span class="p">(</span><span class="nv">$condition</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="p">;</span> <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_10.3</span>
<span class="c1">// Local scopes are not created in the same way as in Perl [by simply enclosing</span>
<span class="c1">// within braces]: only via the creation of functions are local scopes created</span>

<span class="c1">// Doesn&#39;t create a local scope; &#39;$myvariable&#39; is created at top-level</span>
<span class="p">{</span>
  <span class="nv">$myvariable</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// &#39;$myvariable&#39; is accessable here</span>
<span class="k">echo</span> <span class="nv">$myvariable</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// ------------</span>

<span class="p">{</span>
  <span class="nv">$counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="c1">// Local scope created within function, but not within surrounding braces</span>
  <span class="c1">// so:</span>
  <span class="c1">// * &#39;$counter&#39; is actually a top-level variable, so globally accessable</span>
  <span class="c1">// * &#39;next_counter&#39; has no implict access to &#39;$counter&#39;; must be granted</span>
  <span class="c1">//   via &#39;global&#39; keyword</span>

  <span class="k">function</span> <span class="nf">next_counter</span><span class="p">()</span> <span class="p">{</span> <span class="k">global</span> <span class="nv">$counter</span><span class="p">;</span> <span class="nv">$counter</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// PHP doesn&#39;t, AFAIK, offer an equivalent to Perl&#39;s BEGIN block. Similar</span>
<span class="c1">// behaviour may be obtained by defining a class, and including such code</span>
<span class="c1">// in its constructor</span>

<span class="k">class</span> <span class="nc">BEGIN</span>
<span class="p">{</span>
  <span class="k">private</span> <span class="nv">$myvariable</span><span class="p">;</span>

  <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">myvariable</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="nf">othersub</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">myvariable</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$b</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BEGIN</span><span class="p">();</span>

<span class="nv">$b</span><span class="o">-&gt;</span><span class="na">othersub</span><span class="p">();</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// PHP, like C, supports &#39;static&#39; local variables, that is, those that upon</span>
<span class="c1">// first access are initialised, and thence retain their value between function</span>
<span class="c1">// calls. However, the &#39;counter&#39; example is better implemented as a class</span>

<span class="k">class</span> <span class="nc">Counter</span>
<span class="p">{</span>
  <span class="k">private</span> <span class="nv">$counter</span><span class="p">;</span>

  <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$counter_init</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">counter</span> <span class="o">=</span> <span class="nv">$counter_init</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="nf">next_counter</span><span class="p">()</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">counter</span><span class="o">++</span><span class="p">;</span> <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">counter</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">function</span> <span class="nf">prev_counter</span><span class="p">()</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">counter</span><span class="p">;</span> <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">counter</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$counter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Counter</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
<span class="k">echo</span> <span class="nv">$counter</span><span class="o">-&gt;</span><span class="na">next_counter</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="nv">$counter</span><span class="o">-&gt;</span><span class="na">next_counter</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="k">echo</span> <span class="nv">$counter</span><span class="o">-&gt;</span><span class="na">prev_counter</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// @@PLEAC@@_10.4</span>
<span class="c1">// AFAICT there is no means of obtaining the name of the currently executing</span>
<span class="c1">// function, or, for that matter, perform any stack / activation record,</span>
<span class="c1">// inspection. It *is* possible to:</span>
<span class="c1">//</span>
<span class="c1">// * Obtain a list of the currently-defined functions [&#39;get_defined_functions&#39;]</span>
<span class="c1">// * Check whether a specific function exists [&#39;function_exists&#39;]</span>
<span class="c1">// * Use the &#39;Reflection API&#39;</span>
<span class="c1">//</span>
<span class="c1">// So, to solve this problem would seem to require adopting a convention where</span>
<span class="c1">// a string representing the function name is passed as an argument, or a local</span>
<span class="c1">// variable [perhaps called, &#39;$name&#39;] is so set [contrived, and of limited use]</span>

<span class="k">function</span> <span class="nf">whoami</span><span class="p">()</span>
<span class="p">{</span>
  <span class="nv">$name</span> <span class="o">=</span> <span class="s1">&#39;whoami&#39;</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s2">&quot;I am: </span><span class="si">{</span><span class="nv">$name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nx">whoami</span><span class="p">();</span>

<span class="c1">// @@PLEAC@@_10.5</span>
<span class="c1">// In PHP all items exist as &#39;memory references&#39; [i.e. non-modifiable pointers],</span>
<span class="c1">// so when passing an item as a function argument, or returning an item from</span>
<span class="c1">// a function, it is this &#39;memory reference&#39; that is passed, and *not* the</span>
<span class="c1">// contents of that item. Should several references to an item exist [e.g. if</span>
<span class="c1">// passed to a function then at least two such references would exist in</span>
<span class="c1">// different scopes] they would all be refering to the same copy of the item.</span>
<span class="c1">// However, if an attempt is made to alter the item is made, a copy is made</span>
<span class="c1">// and it is the copy that is altered, leaving the original intact.</span>
<span class="c1">// </span>
<span class="c1">// The PHP reference mechanism is used to selectively prevent this behaviour,</span>
<span class="c1">// and ensure that if a change is made to an item that no copy is made, and that</span>
<span class="c1">// it is the original item that is changed. Importantly, there is no efficiency</span>
<span class="c1">// gain from passing function parameters using references if the parameter item</span>
<span class="c1">// is not altered.</span>

<span class="c1">// A copy of the item referred to by, &#39;$arr&#39;, is made, and altered; original</span>
<span class="c1">// remains intact</span>
<span class="k">function</span> <span class="nf">array_by_value</span><span class="p">(</span><span class="nv">$arr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
  <span class="k">echo</span> <span class="nv">$arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> 
<span class="p">}</span>

<span class="c1">// No copy is made; original item referred to by, &#39;$arr&#39;, is altered</span>
<span class="k">function</span> <span class="nf">array_by_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$arr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
  <span class="k">echo</span> <span class="nv">$arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> 
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$arr</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>         <span class="c1">// output: 1 </span>
<span class="nx">array_by_value</span><span class="p">(</span><span class="nv">$arr</span><span class="p">);</span>        <span class="c1">// output: 7</span>
<span class="k">echo</span> <span class="nv">$arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>         <span class="c1">// output: 1 </span>

<span class="nv">$arr</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>         <span class="c1">// output: 1 </span>
<span class="nx">array_by_ref</span><span class="p">(</span><span class="nv">$arr</span><span class="p">);</span>          <span class="c1">// output: 7</span>
<span class="k">echo</span> <span class="nv">$arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>         <span class="c1">// output: 7 </span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Since, &#39;add_vecpair&#39;, does not attempt to alter either, &#39;$x&#39; or &#39;$y&#39;, it makes</span>
<span class="c1">// no difference whether they are &#39;passed by value&#39;, or &#39;passed by reference&#39;</span>
<span class="k">function</span> <span class="nf">add_vecpair</span><span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$r</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
  <span class="nv">$length</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$length</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="nv">$r</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$x</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="o">+</span> <span class="nv">$y</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>
  <span class="k">return</span> <span class="nv">$r</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ...</span>
<span class="nb">count</span><span class="p">(</span><span class="nv">$arr1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$arr2</span><span class="p">)</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;usage: add_vecpair ARR1 ARR2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// &#39;passed by value&#39;</span>
<span class="nv">$arr3</span> <span class="o">=</span> <span class="nx">add_vecpair</span><span class="p">(</span><span class="nv">$arr1</span><span class="p">,</span> <span class="nv">$arr2</span><span class="p">);</span>

<span class="c1">// &#39;passed by reference&#39; [also possible to override default &#39;passed by value&#39;</span>
<span class="c1">// if required]</span>
<span class="nv">$arr3</span> <span class="o">=</span> <span class="nx">add_vecpair</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$arr1</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$arr2</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_10.6</span>
<span class="c1">// PHP can be described as a dynamically typed language because variables serve</span>
<span class="c1">// as identifiers, and the same variable may refer to data of various types.</span>
<span class="c1">// As such, the set of arguments passed to a function may vary in type between</span>
<span class="c1">// calls, as can the type of return value. Where this is likely to occur type</span>
<span class="c1">// checking should be performed either / both within the function body, and</span>
<span class="c1">// when obtaining it&#39;s return value. As for Perl-style &#39;return context&#39;, I</span>
<span class="c1">// don&#39;t believe it is supported by PHP</span>

<span class="c1">// Can return any type</span>
<span class="k">function</span> <span class="nf">mysub</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="k">return</span> <span class="mi">5</span><span class="p">;</span>
  <span class="c1">// ...</span>
  <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
  <span class="c1">// ...</span>
  <span class="k">return</span> <span class="s1">&#39;5&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Throw away return type [i.e. returns a &#39;void&#39; type ?]</span>
<span class="nx">mysub</span><span class="p">();</span>

<span class="c1">// Check return type. Can do via:</span>
<span class="c1">// * gettype($var)</span>
<span class="c1">// * is_xxx e.g. is_array($var), is_muneric($var), ...</span>
<span class="nv">$ret</span> <span class="o">=</span> <span class="nx">mysub</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">is_numeric</span><span class="p">(</span><span class="nv">$ret</span><span class="p">))</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$ret</span><span class="p">))</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$ret</span><span class="p">))</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_10.7</span>
<span class="c1">// PHP doesn&#39;t directly support named / keyword parameters, but these can be</span>
<span class="c1">// easily mimiced using a class of key / value pairs, and passing a variable</span>
<span class="c1">// number of arguments</span>

<span class="k">class</span> <span class="nc">KeyedValue</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">;</span>
  <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">key</span> <span class="o">=</span> <span class="nv">$key</span><span class="p">;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">value</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">the_func</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">foreach</span> <span class="p">(</span><span class="nb">func_get_args</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$arg</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Key: %10s|Value:%10s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$arg</span><span class="o">-&gt;</span><span class="na">key</span><span class="p">,</span> <span class="nv">$arg</span><span class="o">-&gt;</span><span class="na">value</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ----</span>

<span class="nx">the_func</span><span class="p">(</span><span class="k">new</span> <span class="nx">KeyedValue</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Bob&#39;</span><span class="p">),</span>
         <span class="k">new</span> <span class="nx">KeyedValue</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="mi">36</span><span class="p">),</span>
         <span class="k">new</span> <span class="nx">KeyedValue</span><span class="p">(</span><span class="s1">&#39;income&#39;</span><span class="p">,</span> <span class="mi">51000</span><span class="p">));</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Alternatively, an associative array of key / value pairs may be constructed.</span>
<span class="c1">// With the aid of the &#39;extract&#39; built-in function, the key part of this array</span>
<span class="c1">// may be intsntiated to a variable name, thus more closely approximating the</span>
<span class="c1">// behaviour of true named parameters</span>

<span class="k">function</span> <span class="nf">the_func</span><span class="p">(</span><span class="nv">$var_array</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nb">extract</span><span class="p">(</span><span class="nv">$var_array</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$name</span><span class="p">))</span> <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Name:   %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$name</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$age</span><span class="p">))</span> <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Age:    %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$age</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$income</span><span class="p">))</span> <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Income: %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$income</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ----</span>

<span class="nx">the_func</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span> <span class="o">=&gt;</span> <span class="mi">36</span><span class="p">,</span> <span class="s1">&#39;income&#39;</span> <span class="o">=&gt;</span> <span class="mi">51000</span><span class="p">));</span>

<span class="c1">// ----------------------------</span>

<span class="k">class</span> <span class="nc">RaceTime</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="nv">$time</span><span class="p">,</span> <span class="nv">$dim</span><span class="p">;</span>
  <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$time</span><span class="p">,</span> <span class="nv">$dim</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">time</span> <span class="o">=</span> <span class="nv">$time</span><span class="p">;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dim</span> <span class="o">=</span> <span class="nv">$dim</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">the_func</span><span class="p">(</span><span class="nv">$var_array</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nb">extract</span><span class="p">(</span><span class="nv">$var_array</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$start_time</span><span class="p">))</span> <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;start:  %d - %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$start_time</span><span class="o">-&gt;</span><span class="na">time</span><span class="p">,</span> <span class="nv">$start_time</span><span class="o">-&gt;</span><span class="na">dim</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$finish_time</span><span class="p">))</span> <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;finish: %d - %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$finish_time</span><span class="o">-&gt;</span><span class="na">time</span><span class="p">,</span> <span class="nv">$finish_time</span><span class="o">-&gt;</span><span class="na">dim</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$incr_time</span><span class="p">))</span> <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;incr:   %d - %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$incr_time</span><span class="o">-&gt;</span><span class="na">time</span><span class="p">,</span> <span class="nv">$incr_time</span><span class="o">-&gt;</span><span class="na">dim</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ----</span>

<span class="nx">the_func</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;start_time&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">RaceTime</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">),</span>
               <span class="s1">&#39;finish_time&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">RaceTime</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">),</span>
               <span class="s1">&#39;incr_time&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">RaceTime</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)));</span>

<span class="nx">the_func</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;start_time&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">RaceTime</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">),</span>
               <span class="s1">&#39;finish_time&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">RaceTime</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)));</span>

<span class="nx">the_func</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;start_time&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">RaceTime</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)));</span>

<span class="c1">// @@PLEAC@@_10.8</span>
<span class="c1">// The &#39;list&#39; keyword [looks like a function but is actually a special language</span>
<span class="c1">// construct] may be used to perform multiple assignments from a numerically</span>
<span class="c1">// indexed array of values, and offers the added bonus of being able to skip</span>
<span class="c1">// assignment of one, or more, of those values</span>

<span class="k">function</span> <span class="nf">func</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span> <span class="p">}</span>

<span class="c1">// ------------</span>

<span class="k">list</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>

<span class="c1">// Provided &#39;func&#39; returns an numerically-indexed array, the following</span>
<span class="c1">// multiple assignment will work</span>
<span class="k">list</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)</span> <span class="o">=</span> <span class="nx">func</span><span class="p">();</span>

<span class="c1">// Any existing variables no longer wanted would need to be &#39;unset&#39;</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>

<span class="c1">// As above, but second element of return array discarded</span>
<span class="k">list</span><span class="p">(</span><span class="nv">$a</span><span class="p">,,</span><span class="nv">$c</span><span class="p">)</span> <span class="o">=</span> <span class="nx">func</span><span class="p">();</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// Care needed to ensure returned array is numerically-indexed</span>
<span class="k">list</span><span class="p">(</span><span class="nv">$dev</span><span class="p">,</span> <span class="nv">$ino</span><span class="p">,,,</span><span class="nv">$uid</span><span class="p">)</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nb">array_values</span><span class="p">(</span><span class="nb">stat</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">13</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_10.9</span>
<span class="c1">// Multiple return values are possible via packing a set of values within a</span>
<span class="c1">// numerically-indexed array and using &#39;list&#39; to extract them</span>

<span class="k">function</span> <span class="nf">some_func</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;a&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">));</span> <span class="p">}</span>

<span class="c1">// ------------</span>

<span class="k">list</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="nv">$hash</span><span class="p">)</span> <span class="o">=</span> <span class="nx">some_func</span><span class="p">();</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">some_func</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$arr</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$hash</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="nv">$hash</span><span class="p">);</span> <span class="p">}</span>

<span class="c1">// ------------</span>

<span class="nv">$arrin</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="nv">$hashin</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;a&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">);</span>

<span class="k">list</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="nv">$hash</span><span class="p">)</span> <span class="o">=</span> <span class="nx">some_func</span><span class="p">(</span><span class="nv">$arrin</span><span class="p">,</span> <span class="nv">$hashin</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_10.10</span>
<span class="c1">// AFAICT, most of the PHP library functions are designed to return some required </span>
<span class="c1">// value on success, and FALSE on exit. Whilst it is possible to return NULL, or</span>
<span class="c1">// one of the recognised &#39;empty&#39; values [e.g. &#39;&#39; or 0 or an empty array etc],</span>
<span class="c1">// FALSE actually seems to be the preferred means of indicating failure</span>

<span class="k">function</span> <span class="nf">a_func</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">FALSE</span><span class="p">;</span> <span class="p">}</span>

<span class="nx">a_func</span><span class="p">()</span> <span class="o">||</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Function failed</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">a_func</span><span class="p">())</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Function failed</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_10.11</span>
<span class="c1">// Whether PHP is seen to support prototyping depends on the accepted</span>
<span class="c1">// definition of this term:</span>
<span class="c1">//</span>
<span class="c1">// * Prototyping along the lines used in Ada, Modula X, and even C / C++,</span>
<span class="c1">//   in which a function&#39;s interface is declared separately from its</span>
<span class="c1">//   implementation, is *not* supported</span>
<span class="c1">//</span>
<span class="c1">// * Prototyping in which, as part of the function definition, parameter</span>
<span class="c1">//   information must be supplied. In PHP a function definition neither</span>
<span class="c1">//   parameter, nor return type, information needs to be supplied, though</span>
<span class="c1">//   it is usual to see a parameter list supplied [indicates the number,</span>
<span class="c1">//   positional order, and optionally, whether a parameter is passed by</span>
<span class="c1">//   reference; no type information is present]. In short, prototyping in</span>
<span class="c1">//   PHP is optional, and limited</span>

<span class="k">function</span> <span class="nf">func_with_one_arg</span><span class="p">(</span><span class="nv">$arg1</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">func_with_two_arg</span><span class="p">(</span><span class="nv">$arg1</span><span class="p">,</span> <span class="nv">$arg2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">func_with_three_arg</span><span class="p">(</span><span class="nv">$arg1</span><span class="p">,</span> <span class="nv">$arg2</span><span class="p">,</span> <span class="nv">$arg3</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// The following may be interpreted as meaning a function accepting no</span>
<span class="c1">// arguments:</span>
<span class="k">function</span> <span class="nf">func_with_no_arg</span><span class="p">()</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// whilst the following may mean a function taking zero or more arguments</span>
<span class="k">function</span> <span class="nf">func_with_no_arg_information</span><span class="p">()</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_10.12</span>
<span class="c1">// Unlike in Perl, PHP&#39;s &#39;die&#39; [actually an alias for &#39;exit&#39;] doesn&#39;t throw</span>
<span class="c1">// an exception, but instead terminates the script, optionally either</span>
<span class="c1">// returning an integer value to the operating system, or printing a message.</span>
<span class="c1">// So, the following, does not exhibit the same behaviour as the Perl example</span>

<span class="k">die</span><span class="p">(</span><span class="s2">&quot;some message</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span> 

<span class="c1">// Instead, like so many modern languages, PHP implements exception handling</span>
<span class="c1">// via the &#39;catch&#39; and &#39;throw&#39; keywords. Furthermore, a C++ or Java programmer</span>
<span class="c1">// would find PHP&#39;s exception handling facility remarkably similar to those</span>
<span class="c1">// of their respective languages. A simple, canonical example follows:</span>

<span class="c1">// Usual to derive new exception classes from the built-in, &#39;Exception&#39;,</span>
<span class="c1">// class</span>
<span class="k">class</span> <span class="nc">MyException</span> <span class="k">extends</span> <span class="nx">Exception</span>
<span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// ...</span>

<span class="k">try</span>
<span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$some_problem_detected</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nx">MyException</span><span class="p">(</span><span class="s1">&#39;some message&#39;</span><span class="p">,</span> <span class="nv">$some_error_code</span><span class="p">);</span>
  <span class="c1">// ..</span>
<span class="p">}</span>

<span class="k">catch</span> <span class="p">(</span><span class="nx">MyException</span> <span class="nv">$e</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">;</span> <span class="c1">// ... handle the problem ...</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="k">class</span> <span class="nc">FullMoonException</span> <span class="k">extends</span> <span class="nx">Exception</span>
<span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// ...</span>

<span class="k">try</span>
<span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$some_problem_detected</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nx">FullMoonException</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">,</span> <span class="nv">$full_moon_error_code</span><span class="p">);</span>
  <span class="c1">// ..</span>
<span class="p">}</span>

<span class="k">catch</span> <span class="p">(</span><span class="nx">FullMoonException</span> <span class="nv">$e</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// ... rethrow the exception - will propagate to higher level ...</span>
  <span class="k">throw</span> <span class="nv">$e</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_10.13</span>
<span class="c1">// Please refer to discussion about PHP scope in section two of this chapter.</span>
<span class="c1">// Briefly, PHP assumes a variable name within a function to be local unless</span>
<span class="c1">// it has been specifically declared with the, &#39;global&#39;, keyword, in which</span>
<span class="c1">// case it refers to a variable in the &#39;superglobal&#39; array, &#39;$GLOBALS&#39;. Thus,</span>
<span class="c1">// inadvertant variable name shadowing cannot occur since it is it not possible </span>
<span class="c1">// to use the same name to refer to both a local and a global variable. If</span>
<span class="c1">// accessing a global variable care should be taken to not accidentally update</span>
<span class="c1">// it. The techniques used in this section are simply not required.</span>

<span class="c1">// *** NOT TRANSLATED ***</span>

<span class="c1">// @@PLEAC@@_10.14</span>
<span class="c1">// In PHP once a function has been defined it remains defined. In other words,</span>
<span class="c1">// it cannot be undefined / deleted, nor can that particular function name be</span>
<span class="c1">// reused to reference another function body. Even the lambda-like functions</span>
<span class="c1">// created via the &#39;create_function&#39; built-in, cannot be undefined [they exist</span>
<span class="c1">// until script termination, thus creating too many of these can actually</span>
<span class="c1">// exhaust memory !]. However, since the latter can be assigned to variables,</span>
<span class="c1">// the same variable name can be used to reference difference functions [and</span>
<span class="c1">// when this is done the reference to the previous function is lost (unless</span>
<span class="c1">// deliberately saved), though the function itself continues to exist].</span>
<span class="c1">//</span>
<span class="c1">// If, however, all that is needed is a simple function aliasing facility,</span>
<span class="c1">// then just assign the function name to a variable, and execute using the</span>
<span class="c1">// variable name</span>

<span class="c1">// Original function</span>
<span class="k">function</span> <span class="nf">expand</span><span class="p">()</span> <span class="p">{</span> <span class="k">echo</span> <span class="s2">&quot;expand</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> <span class="p">}</span>

<span class="c1">// Prove that function exists</span>
<span class="k">echo</span> <span class="p">(</span><span class="nb">function_exists</span><span class="p">(</span><span class="s1">&#39;expand&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;yes&#39;</span> <span class="o">:</span> <span class="s1">&#39;no&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// Use a variable to alias it</span>
<span class="nv">$grow</span> <span class="o">=</span> <span class="s1">&#39;expand&#39;</span><span class="p">;</span>

<span class="c1">// Call function via original name, and variable, respectively</span>
<span class="nx">expand</span><span class="p">();</span>

<span class="nv">$grow</span><span class="p">();</span> 

<span class="c1">// Remove alias variable</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$grow</span><span class="p">);</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">fred</span><span class="p">()</span> <span class="p">{</span> <span class="k">echo</span> <span class="s2">&quot;fred</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> <span class="p">}</span>

<span class="nv">$barney</span> <span class="o">=</span> <span class="s1">&#39;fred&#39;</span><span class="p">;</span>

<span class="nv">$barney</span><span class="p">();</span>

<span class="nb">unset</span><span class="p">(</span><span class="nv">$barney</span><span class="p">);</span>

<span class="nx">fred</span><span class="p">();</span>

<span class="c1">// ------------</span>

<span class="nv">$fred</span> <span class="o">=</span> <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;echo &quot;fred\n&quot;;&#39;</span><span class="p">);</span>

<span class="nv">$barney</span> <span class="o">=</span> <span class="nv">$fred</span><span class="p">;</span>

<span class="nv">$barney</span><span class="p">();</span>

<span class="nb">unset</span><span class="p">(</span><span class="nv">$barney</span><span class="p">);</span>

<span class="nv">$fred</span><span class="p">();</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">red</span><span class="p">(</span><span class="nv">$text</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="s2">&quot;&lt;FONT COLOR=&#39;red&#39;&gt;</span><span class="si">$text</span><span class="s2">&lt;/FONT&gt;&quot;</span><span class="p">;</span> <span class="p">}</span>

<span class="k">echo</span> <span class="nx">red</span><span class="p">(</span><span class="s1">&#39;careful here&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="c1">// ------------</span>

<span class="nv">$colour</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">;</span>

<span class="nv">$$colour</span> <span class="o">=</span> <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$text&#39;</span><span class="p">,</span> <span class="s1">&#39;global $colour;</span>
<span class="s1">return &quot;&lt;FONT COLOR=\&#39;$colour\&#39;&gt;$text&lt;/FONT&gt;&quot;;&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$$colour</span><span class="p">(</span><span class="s1">&#39;careful here&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="nb">unset</span><span class="p">(</span><span class="nv">$$colour</span><span class="p">);</span>

<span class="c1">// ----</span>

<span class="nv">$colours</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;red blue green yellow orange purple violet&#39;</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$colours</span> <span class="k">as</span> <span class="nv">$colour</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$$colour</span> <span class="o">=</span> <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$text&#39;</span><span class="p">,</span> <span class="s1">&#39;global $colour;</span>
<span class="s1">  return &quot;&lt;FONT COLOR=\&#39;$colour\&#39;&gt;$text&lt;/FONT&gt;&quot;;&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$colours</span> <span class="k">as</span> <span class="nv">$colour</span><span class="p">)</span> <span class="p">{</span> <span class="k">echo</span> <span class="nv">$$colour</span><span class="p">(</span><span class="s2">&quot;Careful with this </span><span class="si">$colour</span><span class="s2">, James&quot;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span> <span class="p">}</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$colours</span> <span class="k">as</span> <span class="nv">$colour</span><span class="p">)</span> <span class="p">{</span> <span class="nb">unset</span><span class="p">(</span><span class="nv">$$colour</span><span class="p">);</span> <span class="p">}</span>

<span class="c1">// @@PLEAC@@_10.15</span>
<span class="c1">// PHP sports an AUTOLOAD facility that is quite easy to use, but, AFAICT, is geared</span>
<span class="c1">// towards the detection of unavailable classes rather than for individual functions.</span>
<span class="c1">// Here is a rudimentary example:</span>

<span class="k">function</span> <span class="nf">__autoload</span><span class="p">(</span><span class="nv">$classname</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$classname</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="c1">// Class file does not exist, so handle situation; in this case,</span>
    <span class="c1">// issue error message, and exit program</span>
    <span class="k">die</span><span class="p">(</span><span class="s2">&quot;File for class: </span><span class="si">{</span><span class="nv">$classname</span><span class="si">}</span><span class="s2"> not found - aborting</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="c1">// Class file exists, so load it</span>
    <span class="k">require_once</span> <span class="nv">$classname</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ------------</span>

<span class="c1">// Attempt to instantiate object of undefined class </span>
<span class="k">new</span> <span class="nx">UnknownClassObject</span><span class="p">();</span>

<span class="c1">// Execution continues here if class exists</span>
<span class="c1">// ...</span>

<span class="c1">// ----------------------------</span>

<span class="c1">// It is also possible to perform [quite extensive] introspection on functions,</span>
<span class="c1">// variables etc, so it is possible to check whether a function exists before</span>
<span class="c1">// executing it, thus allowing a non-existent functions to be searched for and</span>
<span class="c1">// loaded from a source file, or perhaps dynamically defined. An example of what</span>
<span class="c1">// could be described as a custom autoload facility appears below.</span>

<span class="nv">$colours</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="s1">&#39;violet&#39;</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$colours</span> <span class="k">as</span> <span class="nv">$colour</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$$colour</span> <span class="o">=</span> <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$text&#39;</span><span class="p">,</span> <span class="s1">&#39;global $colour;</span>
<span class="s1">  return &quot;&lt;FONT COLOR=\&#39;$colour\&#39;&gt;$text&lt;/FONT&gt;&quot;;&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Let&#39;s add a new colour to the list</span>
<span class="nb">array_push</span><span class="p">(</span><span class="nv">$colours</span><span class="p">,</span> <span class="s1">&#39;chartreuse&#39;</span><span class="p">);</span> 

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$colours</span> <span class="k">as</span> <span class="nv">$colour</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Checking whether function is defined</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">function_exists</span><span class="p">(</span><span class="nv">$$colour</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="c1">// Doesn&#39;t exist, so dynamically define it</span>
    <span class="nv">$$colour</span> <span class="o">=</span> <span class="nb">create_function</span><span class="p">(</span><span class="s1">&#39;$text&#39;</span><span class="p">,</span> <span class="s1">&#39;global $colour;</span>
<span class="s1">    return &quot;&lt;FONT COLOR=\&#39;$colour\&#39;&gt;$text&lt;/FONT&gt;&quot;;&#39;</span><span class="p">);</span>

    <span class="c1">// Alternatively, if it exists in a source file, &#39;include&#39; the file:</span>
    <span class="c1">// include &#39;newcolours.php&#39;</span>
  <span class="p">}</span>

  <span class="k">echo</span> <span class="nv">$$colour</span><span class="p">(</span><span class="s2">&quot;Careful with this </span><span class="si">$colour</span><span class="s2">, James&quot;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$colours</span> <span class="k">as</span> <span class="nv">$colour</span><span class="p">)</span> <span class="nb">unset</span><span class="p">(</span><span class="nv">$$colour</span><span class="p">);</span> 

<span class="c1">// @@PLEAC@@_10.16</span>
<span class="c1">// *** Warning *** Whilst PHP *does* allow functions to be defined within other</span>
<span class="c1">// functions it needs to be clearly understood that these &#39;inner&#39; functions:</span>
<span class="c1">// * Do not exist until the outer function is called a first time, at which time</span>
<span class="c1">//   they then remain defined</span>
<span class="c1">// * Are global in scope, so are accessable outside the function by their name;</span>
<span class="c1">//   the fact that they are nested within another function has, AFAICT, no bearing</span>
<span class="c1">//   on name resolution</span>
<span class="c1">// * Do not form a closure: the inner function is merely &#39;parked&#39; within the</span>
<span class="c1">//   outer function, and has no implicit access to the outer function&#39;s variables</span>
<span class="c1">//   or other inner functions</span>

<span class="k">function</span> <span class="nf">outer</span><span class="p">(</span><span class="nv">$arg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$x</span> <span class="o">=</span> <span class="nv">$arg</span> <span class="o">+</span> <span class="mi">35</span><span class="p">;</span>
  <span class="k">function</span> <span class="nf">inner</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$x</span> <span class="o">*</span> <span class="mi">19</span><span class="p">;</span> <span class="p">}</span>

  <span class="c1">// *** wrong *** &#39;inner&#39; returns 0 * 19, not ($arg + 35) * 19</span>
  <span class="k">return</span> <span class="nv">$x</span> <span class="o">+</span> <span class="nx">inner</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// ----------------------------</span>

<span class="k">function</span> <span class="nf">outer</span><span class="p">(</span><span class="nv">$arg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$x</span> <span class="o">=</span> <span class="nv">$arg</span> <span class="o">+</span> <span class="mi">35</span><span class="p">;</span>

  <span class="c1">// No implicit access to outer function scope; any required data must be</span>
  <span class="c1">// explicity passed</span>
  <span class="k">function</span> <span class="nf">inner</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$x</span> <span class="o">*</span> <span class="mi">19</span><span class="p">;</span> <span class="p">}</span>

  <span class="k">return</span> <span class="nv">$x</span> <span class="o">+</span> <span class="nx">inner</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ------------ </span>

<span class="c1">// Equivalent to previously-shown code</span>
<span class="k">function</span> <span class="nf">inner</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="nv">$x</span> <span class="o">*</span> <span class="mi">19</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">outer</span><span class="p">(</span><span class="nv">$arg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nv">$x</span> <span class="o">=</span> <span class="nv">$arg</span> <span class="o">+</span> <span class="mi">35</span><span class="p">;</span>
  <span class="k">return</span> <span class="nv">$x</span> <span class="o">+</span> <span class="nx">inner</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_10.17</span>
<span class="c1">// @@INCOMPLETE@@</span>
<span class="c1">// @@INCOMPLETE@@</span>

<span class="c1">// @@PLEAC@@_16.1</span>
<span class="c1">// Run a command and return its results as a string.</span>
<span class="nv">$output_string</span> <span class="o">=</span> <span class="nb">shell_exec</span><span class="p">(</span><span class="s1">&#39;program args&#39;</span><span class="p">);</span>

<span class="c1">// Same as above, using backtick operator.</span>
<span class="nv">$output_string</span> <span class="o">=</span> <span class="sb">`program args`</span><span class="p">;</span>

<span class="c1">// Run a command and return its results as a list of strings,</span>
<span class="c1">// one per line.</span>
<span class="nv">$output_lines</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="nb">exec</span><span class="p">(</span><span class="s1">&#39;program args&#39;</span><span class="p">,</span> <span class="nv">$output_lines</span><span class="p">);</span>

<span class="c1">// -----------------------------</span>

<span class="c1">// The only way to execute a program without using the shell is to</span>
<span class="c1">// use pcntl_exec(). However, there is no way to do redirection, so</span>
<span class="c1">// you can&#39;t capture its output.</span>

<span class="nv">$pid</span> <span class="o">=</span> <span class="nb">pcntl_fork</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$pid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;cannot fork&#39;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$pid</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">pcntl_waitpid</span><span class="p">(</span><span class="nv">$pid</span><span class="p">,</span> <span class="nv">$status</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Note that pcntl_exec() automatically prepends the program name</span>
    <span class="c1">// to the array of arguments; the program name cannot be spoofed.</span>
    <span class="nb">pcntl_exec</span><span class="p">(</span><span class="nv">$program</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nv">$arg1</span><span class="p">,</span> <span class="nv">$arg2</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_16.2</span>
<span class="c1">// Run a simple command and retrieve its result code.</span>
<span class="nb">exec</span><span class="p">(</span><span class="s2">&quot;vi </span><span class="si">$myfile</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$output</span><span class="p">,</span> <span class="nv">$result_code</span><span class="p">);</span>

<span class="c1">// -----------------------------</span>

<span class="c1">// Use the shell to perform redirection.</span>
<span class="nb">exec</span><span class="p">(</span><span class="s1">&#39;cmd1 args | cmd2 | cmd3 &gt;outfile&#39;</span><span class="p">);</span>
<span class="nb">exec</span><span class="p">(</span><span class="s1">&#39;cmd args &lt;infile &gt;outfile 2&gt;errfile&#39;</span><span class="p">);</span>

<span class="c1">// -----------------------------</span>

<span class="c1">// Run a command, handling its result code or signal.</span>
<span class="nv">$pid</span> <span class="o">=</span> <span class="nb">pcntl_fork</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$pid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;cannot fork&#39;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$pid</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">pcntl_waitpid</span><span class="p">(</span><span class="nv">$pid</span><span class="p">,</span> <span class="nv">$status</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">pcntl_wifexited</span><span class="p">(</span><span class="nv">$status</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$status</span> <span class="o">=</span> <span class="nb">pcntl_wexitstatus</span><span class="p">(</span><span class="nv">$status</span><span class="p">);</span>
        <span class="k">echo</span> <span class="s2">&quot;program exited with status </span><span class="si">$status</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">pcntl_wifsignaled</span><span class="p">(</span><span class="nv">$status</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$signal</span> <span class="o">=</span> <span class="nb">pcntl_wtermsig</span><span class="p">(</span><span class="nv">$status</span><span class="p">);</span>
        <span class="k">echo</span> <span class="s2">&quot;program killed by signal </span><span class="si">$signal</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">pcntl_wifstopped</span><span class="p">(</span><span class="nv">$status</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$signal</span> <span class="o">=</span> <span class="nb">pcntl_wstopsig</span><span class="p">(</span><span class="nv">$status</span><span class="p">);</span>
        <span class="k">echo</span> <span class="s2">&quot;program stopped by signal </span><span class="si">$signal</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">pcntl_exec</span><span class="p">(</span><span class="nv">$program</span><span class="p">,</span> <span class="nv">$args</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// -----------------------------</span>

<span class="c1">// Run a command while blocking interrupt signals.</span>
<span class="nv">$pid</span> <span class="o">=</span> <span class="nb">pcntl_fork</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$pid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;cannot fork&#39;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$pid</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// parent catches INT and berates user</span>
    <span class="k">declare</span><span class="p">(</span><span class="nx">ticks</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">function</span> <span class="nf">handle_sigint</span><span class="p">(</span><span class="nv">$signal</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;Tsk tsk, no process interruptus</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGINT</span><span class="p">,</span> <span class="s1">&#39;handle_sigint&#39;</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">pcntl_waitpid</span><span class="p">(</span><span class="nv">$pid</span><span class="p">,</span> <span class="nv">$status</span><span class="p">,</span> <span class="nx">WNOHANG</span><span class="p">))</span> <span class="p">{}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// child ignores INT and does its thing</span>
    <span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGINT</span><span class="p">,</span> <span class="nx">SIG_IGN</span><span class="p">);</span>
    <span class="nb">pcntl_exec</span><span class="p">(</span><span class="s1">&#39;/bin/sleep&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;10&#39;</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// -----------------------------</span>

<span class="c1">// Since there is no direct access to execv() and friends, and</span>
<span class="c1">// pcntl_exec() won&#39;t let us supply an alternate program name</span>
<span class="c1">// in the argument list, there is no way to run a command with</span>
<span class="c1">// a different name in the process table.</span>

<span class="c1">// @@PLEAC@@_16.3</span>
<span class="c1">// Transfer control to the shell to run another program.</span>
<span class="nb">pcntl_exec</span><span class="p">(</span><span class="s1">&#39;/bin/sh&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;archive *.data&#39;</span><span class="p">));</span>
<span class="c1">// Transfer control directly to another program.</span>
<span class="nb">pcntl_exec</span><span class="p">(</span><span class="s1">&#39;/path/to/archive&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;accounting.data&#39;</span><span class="p">));</span>

<span class="c1">// @@PLEAC@@_16.4</span>
<span class="c1">// Handle each line in the output of a process.</span>
<span class="nv">$readme</span> <span class="o">=</span> <span class="nb">popen</span><span class="p">(</span><span class="s1">&#39;program arguments&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">);</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$readme</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$readme</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
<span class="nb">pclose</span><span class="p">(</span><span class="nv">$readme</span><span class="p">);</span>

<span class="c1">// -----------------------------</span>

<span class="c1">// Write to the input of a process.</span>
<span class="nv">$writeme</span> <span class="o">=</span> <span class="nb">popen</span><span class="p">(</span><span class="s1">&#39;program arguments&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">);</span>
<span class="nb">fwrite</span><span class="p">(</span><span class="nv">$writeme</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">);</span>
<span class="nb">pclose</span><span class="p">(</span><span class="nv">$writeme</span><span class="p">);</span>

<span class="c1">// -----------------------------</span>

<span class="c1">// Wait for a process to complete.</span>
<span class="nv">$f</span> <span class="o">=</span> <span class="nb">popen</span><span class="p">(</span><span class="s1">&#39;sleep 1000000&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">);</span>  <span class="c1">// child goes to sleep</span>
<span class="nb">pclose</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span>                        <span class="c1">// and parent goes to lala land</span>

<span class="c1">// -----------------------------</span>

<span class="nv">$writeme</span> <span class="o">=</span> <span class="nb">popen</span><span class="p">(</span><span class="s1">&#39;program arguments&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">);</span>
<span class="nb">fwrite</span><span class="p">(</span><span class="nv">$writeme</span><span class="p">,</span> <span class="s2">&quot;hello</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>  <span class="c1">// program will get hello\n on STDIN</span>
<span class="nb">pclose</span><span class="p">(</span><span class="nv">$writeme</span><span class="p">);</span>             <span class="c1">// program will get EOF on STDIN</span>

<span class="c1">// -----------------------------</span>

<span class="c1">// Output buffering callback that sends output to the pager.</span>
<span class="k">function</span> <span class="nf">ob_pager</span><span class="p">(</span><span class="nv">$output</span><span class="p">,</span> <span class="nv">$mode</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">static</span> <span class="nv">$pipe</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$mode</span> <span class="o">&amp;</span> <span class="nx">PHP_OUTPUT_HANDLER_START</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$pager</span> <span class="o">=</span> <span class="nb">getenv</span><span class="p">(</span><span class="s1">&#39;PAGER&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$pager</span><span class="p">)</span> <span class="nv">$pager</span> <span class="o">=</span> <span class="s1">&#39;/usr/bin/less&#39;</span><span class="p">;</span>  <span class="c1">// XXX: might not exist</span>
        <span class="nv">$pipe</span> <span class="o">=</span> <span class="nb">popen</span><span class="p">(</span><span class="nv">$pager</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$pipe</span><span class="p">,</span> <span class="nv">$output</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$mode</span> <span class="o">&amp;</span> <span class="nx">PHP_OUTPUT_HANDLER_END</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">pclose</span><span class="p">(</span><span class="nv">$pipe</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Redirect standard output to the pager.</span>
<span class="nb">ob_start</span><span class="p">(</span><span class="s1">&#39;ob_pager&#39;</span><span class="p">);</span>

<span class="c1">// Do something useful that writes to standard output, then</span>
<span class="c1">// close the output buffer.</span>
<span class="c1">// ...</span>
<span class="nb">ob_end_flush</span><span class="p">();</span>

<span class="c1">// @@PLEAC@@_16.5</span>
<span class="c1">// Output buffering: Only display a certain number of lines of output.</span>
<span class="k">class</span> <span class="nc">Head</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">Head</span><span class="p">(</span><span class="nv">$lines</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lines</span> <span class="o">=</span> <span class="nv">$lines</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">filter</span><span class="p">(</span><span class="nv">$output</span><span class="p">,</span> <span class="nv">$mode</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
        <span class="nv">$newline</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$output</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nv">$output</span><span class="p">[</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$output</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$newline</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
            <span class="nv">$output</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$output</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nb">explode</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$output</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$i</span> <span class="o">=&gt;</span> <span class="nv">$line</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lines</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">lines</span><span class="o">--</span><span class="p">;</span>
                <span class="nv">$result</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$line</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$result</span> <span class="o">?</span> <span class="nb">implode</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$result</span><span class="p">)</span> <span class="o">.</span> <span class="nv">$newline</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Output buffering: Prepend line numbers to each line of output.</span>
<span class="k">class</span> <span class="nc">Number</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">Number</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">line_number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">filter</span><span class="p">(</span><span class="nv">$output</span><span class="p">,</span> <span class="nv">$mode</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
        <span class="nv">$newline</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$output</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nv">$output</span><span class="p">[</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$output</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$newline</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
            <span class="nv">$output</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$output</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nb">explode</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$output</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$i</span> <span class="o">=&gt;</span> <span class="nv">$line</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">line_number</span><span class="o">++</span><span class="p">;</span>
            <span class="nv">$result</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">line_number</span> <span class="o">.</span> <span class="s1">&#39;: &#39;</span> <span class="o">.</span> <span class="nv">$line</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nb">implode</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$result</span><span class="p">)</span> <span class="o">.</span> <span class="nv">$newline</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Output buffering: Prepend &quot;&gt; &quot; to each line of output.</span>
<span class="k">class</span> <span class="nc">Quote</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">Quote</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">filter</span><span class="p">(</span><span class="nv">$output</span><span class="p">,</span> <span class="nv">$mode</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
        <span class="nv">$newline</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$output</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nv">$output</span><span class="p">[</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$output</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$newline</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
            <span class="nv">$output</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$output</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nb">explode</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$output</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$i</span> <span class="o">=&gt;</span> <span class="nv">$line</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$result</span><span class="p">[]</span> <span class="o">=</span> <span class="s2">&quot;&gt; </span><span class="si">$line</span><span class="s2">&quot;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nb">implode</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$result</span><span class="p">)</span> <span class="o">.</span> <span class="nv">$newline</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Use arrays as callbacks to register filter methods.</span>
<span class="nb">ob_start</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="k">new</span> <span class="nx">Head</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="s1">&#39;filter&#39;</span><span class="p">));</span>
<span class="nb">ob_start</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="k">new</span> <span class="nx">Number</span><span class="p">(),</span> <span class="s1">&#39;filter&#39;</span><span class="p">));</span>
<span class="nb">ob_start</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="k">new</span> <span class="nx">Quote</span><span class="p">(),</span> <span class="s1">&#39;filter&#39;</span><span class="p">));</span>

<span class="c1">// Act like /bin/cat.</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">echo</span> <span class="nv">$line</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Should match number of calls to ob_start().</span>
<span class="nb">ob_end_flush</span><span class="p">();</span>
<span class="nb">ob_end_flush</span><span class="p">();</span>
<span class="nb">ob_end_flush</span><span class="p">();</span>

<span class="c1">// @@PLEAC@@_16.6</span>
<span class="c1">// Process command-line arguments using fopen(). PHP supports URLs for</span>
<span class="c1">// filenames as long as the &quot;allow_url_fopen&quot; configuration option is set.</span>
<span class="c1">//</span>
<span class="c1">// Valid URL protocols include:</span>
<span class="c1">//   - http://www.myserver.com/myfile.html</span>
<span class="c1">//   - ftp://ftp.myserver.com/myfile.txt</span>
<span class="c1">//   - compress.zlib://myfile.gz</span>
<span class="c1">//   - php://stdin</span>
<span class="c1">//</span>
<span class="c1">// See http://www.php.net/manual/en/wrappers.php for details.</span>
<span class="c1">//</span>
<span class="nv">$filenames</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$argv</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$filenames</span><span class="p">)</span> <span class="nv">$filenames</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;php://stdin&#39;</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$filenames</span> <span class="k">as</span> <span class="nv">$filename</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$handle</span> <span class="o">=</span> <span class="o">@</span><span class="nb">fopen</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$handle</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$handle</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$handle</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
            <span class="c1">// ...</span>
        <span class="p">}</span>
        <span class="nb">fclose</span><span class="p">(</span><span class="nv">$handle</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">die</span><span class="p">(</span><span class="s2">&quot;can&#39;t open </span><span class="si">$filename</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_16.7</span>
<span class="nv">$output</span> <span class="o">=</span> <span class="sb">`cmd 2&gt;&amp;1`</span><span class="p">;</span>                          <span class="c1">// with backticks</span>
<span class="c1">// or</span>
<span class="nv">$ph</span> <span class="o">=</span> <span class="nb">popen</span><span class="p">(</span><span class="s1">&#39;cmd 2&gt;&amp;1&#39;</span><span class="p">);</span>                       <span class="c1">// with an open pipe</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$ph</span><span class="p">))</span> <span class="p">{</span> <span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$ph</span><span class="p">);</span> <span class="p">}</span>     <span class="c1">// plus a read</span>
<span class="c1">// -----------------------------</span>
<span class="nv">$output</span> <span class="o">=</span> <span class="sb">`cmd 2&gt;/dev/null`</span><span class="p">;</span>                   <span class="c1">// with backticks</span>
<span class="c1">// or</span>
<span class="nv">$ph</span> <span class="o">=</span> <span class="nb">popen</span><span class="p">(</span><span class="s1">&#39;cmd 2&gt;/dev/null&#39;</span><span class="p">);</span>                <span class="c1">// with an open pipe</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$ph</span><span class="p">))</span> <span class="p">{</span> <span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$ph</span><span class="p">);</span> <span class="p">}</span>     <span class="c1">// plus a read</span>
<span class="c1">// -----------------------------</span>
<span class="nv">$output</span> <span class="o">=</span> <span class="sb">`cmd 2&gt;&amp;1 1&gt;/dev/null`</span><span class="p">;</span>              <span class="c1">// with backticks</span>
<span class="c1">// or</span>
<span class="nv">$ph</span> <span class="o">=</span> <span class="nb">popen</span><span class="p">(</span><span class="s1">&#39;cmd 2&gt;&amp;1 1&gt;/dev/null&#39;</span><span class="p">);</span>           <span class="c1">// with an open pipe</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$ph</span><span class="p">))</span> <span class="p">{</span> <span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$ph</span><span class="p">);</span> <span class="p">}</span>     <span class="c1">// plus a read</span>
<span class="c1">// -----------------------------</span>
<span class="nv">$output</span> <span class="o">=</span> <span class="sb">`cmd 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3 3&gt;&amp;-`</span><span class="p">;</span>           <span class="c1">// with backticks</span>
<span class="c1">// or</span>
<span class="nv">$ph</span> <span class="o">=</span> <span class="nb">popen</span><span class="p">(</span><span class="s1">&#39;cmd 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3 3&gt;&amp;-|&#39;</span><span class="p">);</span>       <span class="c1">// with an open pipe</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$ph</span><span class="p">))</span> <span class="p">{</span> <span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$ph</span><span class="p">);</span> <span class="p">}</span>     <span class="c1">// plus a read</span>
<span class="c1">// -----------------------------</span>
<span class="nb">exec</span><span class="p">(</span><span class="s1">&#39;program args 1&gt;/tmp/program.stdout 2&gt;/tmp/program.stderr&#39;</span><span class="p">);</span>
<span class="c1">// -----------------------------</span>
<span class="nv">$output</span> <span class="o">=</span> <span class="sb">`cmd 3&gt;&amp;1 1&gt;&amp;2 2&gt;&amp;3 3&gt;&amp;-`</span><span class="p">;</span>
<span class="c1">// -----------------------------</span>
<span class="nv">$fd3</span> <span class="o">=</span> <span class="nv">$fd1</span><span class="p">;</span>
<span class="nv">$fd1</span> <span class="o">=</span> <span class="nv">$fd2</span><span class="p">;</span>
<span class="nv">$fd2</span> <span class="o">=</span> <span class="nv">$fd3</span><span class="p">;</span>
<span class="nv">$fd3</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
<span class="c1">// -----------------------------</span>
<span class="nb">exec</span><span class="p">(</span><span class="s1">&#39;prog args 1&gt;tmpfile 2&gt;&amp;1&#39;</span><span class="p">);</span>
<span class="nb">exec</span><span class="p">(</span><span class="s1">&#39;prog args 2&gt;&amp;1 1&gt;tmpfile&#39;</span><span class="p">);</span>
<span class="c1">// -----------------------------</span>
<span class="c1">// exec(&#39;prog args 1&gt;tmpfile 2&gt;&amp;1&#39;);</span>
<span class="nv">$fd1</span> <span class="o">=</span> <span class="s2">&quot;tmpfile&quot;</span><span class="p">;</span>        <span class="c1">// change stdout destination first</span>
<span class="nv">$fd2</span> <span class="o">=</span> <span class="nv">$fd1</span><span class="p">;</span>             <span class="c1">// now point stderr there, too</span>
<span class="c1">// -----------------------------</span>
<span class="c1">// exec(&#39;prog args 2&gt;&amp;1 1&gt;tmpfile&#39;);</span>
<span class="nv">$fd2</span> <span class="o">=</span> <span class="nv">$fd1</span><span class="p">;</span>             <span class="c1">// stderr same destination as stdout</span>
<span class="nv">$fd1</span> <span class="o">=</span> <span class="s2">&quot;tmpfile&quot;</span><span class="p">;</span>        <span class="c1">// but change stdout destination</span>

<span class="c1">// @@PLEAC@@_16.8</span>
<span class="c1">// Connect to input and output of a process.</span>
<span class="nv">$proc</span> <span class="o">=</span> <span class="nb">proc_open</span><span class="p">(</span><span class="nv">$program</span><span class="p">,</span>
                  <span class="k">array</span><span class="p">(</span><span class="mi">0</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;pipe&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">),</span>
                        <span class="mi">1</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;pipe&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)),</span>
                  <span class="nv">$pipes</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">is_resource</span><span class="p">(</span><span class="nv">$proc</span><span class="p">))</span> <span class="p">{</span>
    <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;here&#39;s your input</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="k">echo</span> <span class="nb">stream_get_contents</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="nv">$result_code</span> <span class="o">=</span> <span class="nb">proc_close</span><span class="p">(</span><span class="nv">$proc</span><span class="p">);</span>
    <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">$result_code</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// -----------------------------</span>

<span class="nv">$all</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="nv">$outlines</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="nv">$errlines</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="nb">exec</span><span class="p">(</span><span class="s2">&quot;( </span><span class="si">$cmd</span><span class="s2"> | sed -e &#39;s/^/stdout: /&#39; ) 2&gt;&amp;1&quot;</span><span class="p">,</span> <span class="nv">$all</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$all</span> <span class="k">as</span> <span class="nv">$line</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$pos</span> <span class="o">=</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span> <span class="s1">&#39;stdout: &#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$pos</span> <span class="o">!==</span> <span class="k">false</span> <span class="o">&amp;&amp;</span> <span class="nv">$pos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$outlines</span><span class="p">[]</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$errlines</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$line</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;STDOUT:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$outlines</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;STDERR:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$errlines</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_16.9</span>
<span class="nv">$proc</span> <span class="o">=</span> <span class="nb">proc_open</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">,</span>
                  <span class="k">array</span><span class="p">(</span><span class="mi">0</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;pipe&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">),</span>
                        <span class="mi">1</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;pipe&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">),</span>
                        <span class="mi">2</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;pipe&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)),</span>
                  <span class="nv">$pipes</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">is_resource</span><span class="p">(</span><span class="nv">$proc</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// give end of file to kid, or feed him</span>
    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

    <span class="c1">// read till EOF</span>
    <span class="nv">$outlines</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="nv">$outlines</span><span class="p">[]</span> <span class="o">=</span> <span class="nb">rtrim</span><span class="p">(</span><span class="nv">$line</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// XXX: block potential if massive</span>
    <span class="nv">$errlines</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="nv">$errlines</span><span class="p">[]</span> <span class="o">=</span> <span class="nb">rtrim</span><span class="p">(</span><span class="nv">$line</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="nb">proc_close</span><span class="p">(</span><span class="nv">$proc</span><span class="p">);</span>

    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;STDOUT:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$outlines</span><span class="p">);</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;STDERR:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$errlines</span><span class="p">);</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// -----------------------------</span>

<span class="c1">// cmd3sel - control all three of kids in, out, and error.</span>
<span class="nv">$cmd</span> <span class="o">=</span> <span class="s2">&quot;grep vt33 /none/such - /etc/termcap&quot;</span><span class="p">;</span>
<span class="nv">$proc</span> <span class="o">=</span> <span class="nb">proc_open</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">,</span>
                  <span class="k">array</span><span class="p">(</span><span class="mi">0</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;pipe&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">),</span>
                        <span class="mi">1</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;pipe&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">),</span>
                        <span class="mi">2</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;pipe&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)),</span>
                  <span class="nv">$pipes</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">is_resource</span><span class="p">(</span><span class="nv">$proc</span><span class="p">))</span> <span class="p">{</span>
    <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;This line has a vt33 lurking in it</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

    <span class="nv">$readers</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nv">$pipes</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">stream_select</span><span class="p">(</span><span class="nv">$read</span><span class="o">=</span><span class="nv">$readers</span><span class="p">,</span>
                         <span class="nv">$write</span><span class="o">=</span><span class="k">null</span><span class="p">,</span>
                         <span class="nv">$except</span><span class="o">=</span><span class="k">null</span><span class="p">,</span>
                         <span class="mi">0</span><span class="p">,</span> <span class="mi">200000</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$read</span> <span class="k">as</span> <span class="nv">$stream</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$stream</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$stream</span> <span class="o">===</span> <span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
                    <span class="k">print</span> <span class="s2">&quot;STDOUT: </span><span class="si">$line</span><span class="s2">&quot;</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">print</span> <span class="s2">&quot;STDERR: </span><span class="si">$line</span><span class="s2">&quot;</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$stream</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$readers</span> <span class="o">=</span> <span class="nb">array_diff</span><span class="p">(</span><span class="nv">$readers</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nv">$stream</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="nb">proc_close</span><span class="p">(</span><span class="nv">$proc</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_16.10</span>
<span class="c1">// PHP supports fork/exec/wait but not pipe. However, it does</span>
<span class="c1">// support socketpair, which can do everything pipes can as well</span>
<span class="c1">// as bidirectional communication. The original recipes have been</span>
<span class="c1">// modified here to use socketpair only.</span>

<span class="c1">// -----------------------------</span>

<span class="c1">// pipe1 - use socketpair and fork so parent can send to child</span>
<span class="nv">$sockets</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">socket_create_pair</span><span class="p">(</span><span class="nx">AF_UNIX</span><span class="p">,</span> <span class="nx">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$sockets</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="nb">socket_strerror</span><span class="p">(</span><span class="nb">socket_last_error</span><span class="p">()));</span>
<span class="p">}</span>
<span class="k">list</span><span class="p">(</span><span class="nv">$reader</span><span class="p">,</span> <span class="nv">$writer</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$sockets</span><span class="p">;</span>

<span class="nv">$pid</span> <span class="o">=</span> <span class="nb">pcntl_fork</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$pid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;cannot fork&#39;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$pid</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">socket_close</span><span class="p">(</span><span class="nv">$reader</span><span class="p">);</span>
    <span class="nv">$line</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;Parent Pid %d is sending this</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">getmypid</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">socket_write</span><span class="p">(</span><span class="nv">$writer</span><span class="p">,</span> <span class="nv">$line</span><span class="p">,</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$line</span><span class="p">)))</span> <span class="p">{</span>
        <span class="nb">socket_close</span><span class="p">(</span><span class="nv">$writer</span><span class="p">);</span>
        <span class="k">die</span><span class="p">(</span><span class="nb">socket_strerror</span><span class="p">(</span><span class="nb">socket_last_error</span><span class="p">()));</span>
    <span class="p">}</span>
    <span class="nb">socket_close</span><span class="p">(</span><span class="nv">$writer</span><span class="p">);</span>
    <span class="nb">pcntl_waitpid</span><span class="p">(</span><span class="nv">$pid</span><span class="p">,</span> <span class="nv">$status</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">socket_close</span><span class="p">(</span><span class="nv">$writer</span><span class="p">);</span>
    <span class="nv">$line</span> <span class="o">=</span> <span class="nb">socket_read</span><span class="p">(</span><span class="nv">$reader</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="nx">PHP_NORMAL_READ</span><span class="p">);</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Child Pid %d just read this: `%s&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">getmypid</span><span class="p">(),</span> <span class="nb">rtrim</span><span class="p">(</span><span class="nv">$line</span><span class="p">));</span>
    <span class="nb">socket_close</span><span class="p">(</span><span class="nv">$reader</span><span class="p">);</span>  <span class="c1">// this will happen anyway</span>
    <span class="k">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// -----------------------------</span>

<span class="c1">// pipe2 - use socketpair and fork so child can send to parent</span>
<span class="nv">$sockets</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">socket_create_pair</span><span class="p">(</span><span class="nx">AF_UNIX</span><span class="p">,</span> <span class="nx">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$sockets</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="nb">socket_strerror</span><span class="p">(</span><span class="nb">socket_last_error</span><span class="p">()));</span>
<span class="p">}</span>
<span class="k">list</span><span class="p">(</span><span class="nv">$reader</span><span class="p">,</span> <span class="nv">$writer</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$sockets</span><span class="p">;</span>

<span class="nv">$pid</span> <span class="o">=</span> <span class="nb">pcntl_fork</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$pid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;cannot fork&#39;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$pid</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">socket_close</span><span class="p">(</span><span class="nv">$writer</span><span class="p">);</span>
    <span class="nv">$line</span> <span class="o">=</span> <span class="nb">socket_read</span><span class="p">(</span><span class="nv">$reader</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="nx">PHP_NORMAL_READ</span><span class="p">);</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Parent Pid %d just read this: `%s&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">getmypid</span><span class="p">(),</span> <span class="nb">rtrim</span><span class="p">(</span><span class="nv">$line</span><span class="p">));</span>
    <span class="nb">socket_close</span><span class="p">(</span><span class="nv">$reader</span><span class="p">);</span>
    <span class="nb">pcntl_waitpid</span><span class="p">(</span><span class="nv">$pid</span><span class="p">,</span> <span class="nv">$status</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">socket_close</span><span class="p">(</span><span class="nv">$reader</span><span class="p">);</span>
    <span class="nv">$line</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;Child Pid %d is sending this</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">getmypid</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">socket_write</span><span class="p">(</span><span class="nv">$writer</span><span class="p">,</span> <span class="nv">$line</span><span class="p">,</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$line</span><span class="p">)))</span> <span class="p">{</span>
        <span class="nb">socket_close</span><span class="p">(</span><span class="nv">$writer</span><span class="p">);</span>
        <span class="k">die</span><span class="p">(</span><span class="nb">socket_strerror</span><span class="p">(</span><span class="nb">socket_last_error</span><span class="p">()));</span>
    <span class="p">}</span>
    <span class="nb">socket_close</span><span class="p">(</span><span class="nv">$writer</span><span class="p">);</span>  <span class="c1">// this will happen anyway</span>
    <span class="k">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// -----------------------------</span>

<span class="c1">// pipe3 and pipe4 demonstrate the use of perl&#39;s &quot;forking open&quot;</span>
<span class="c1">// feature to reimplement pipe1 and pipe2. pipe5 uses two pipes</span>
<span class="c1">// to simulate socketpair. Since PHP supports socketpair but not</span>
<span class="c1">// pipe, and does not have a &quot;forking open&quot; feature, these</span>
<span class="c1">// examples are skipped here.</span>

<span class="c1">// -----------------------------</span>

<span class="c1">// pipe6 - bidirectional communication using socketpair</span>
<span class="nv">$sockets</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">socket_create_pair</span><span class="p">(</span><span class="nx">AF_UNIX</span><span class="p">,</span> <span class="nx">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$sockets</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="nb">socket_strerror</span><span class="p">(</span><span class="nb">socket_last_error</span><span class="p">()));</span>
<span class="p">}</span>
<span class="k">list</span><span class="p">(</span><span class="nv">$child</span><span class="p">,</span> <span class="nv">$parent</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$sockets</span><span class="p">;</span>

<span class="nv">$pid</span> <span class="o">=</span> <span class="nb">pcntl_fork</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$pid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;cannot fork&#39;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$pid</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">socket_close</span><span class="p">(</span><span class="nv">$parent</span><span class="p">);</span>
    <span class="nv">$line</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;Parent Pid %d is sending this</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">getmypid</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">socket_write</span><span class="p">(</span><span class="nv">$child</span><span class="p">,</span> <span class="nv">$line</span><span class="p">,</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$line</span><span class="p">)))</span> <span class="p">{</span>
        <span class="nb">socket_close</span><span class="p">(</span><span class="nv">$child</span><span class="p">);</span>
        <span class="k">die</span><span class="p">(</span><span class="nb">socket_strerror</span><span class="p">(</span><span class="nb">socket_last_error</span><span class="p">()));</span>
    <span class="p">}</span>
    <span class="nv">$line</span> <span class="o">=</span> <span class="nb">socket_read</span><span class="p">(</span><span class="nv">$child</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="nx">PHP_NORMAL_READ</span><span class="p">);</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Parent Pid %d just read this: `%s&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">getmypid</span><span class="p">(),</span> <span class="nb">rtrim</span><span class="p">(</span><span class="nv">$line</span><span class="p">));</span>
    <span class="nb">socket_close</span><span class="p">(</span><span class="nv">$child</span><span class="p">);</span>
    <span class="nb">pcntl_waitpid</span><span class="p">(</span><span class="nv">$pid</span><span class="p">,</span> <span class="nv">$status</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">socket_close</span><span class="p">(</span><span class="nv">$child</span><span class="p">);</span>
    <span class="nv">$line</span> <span class="o">=</span> <span class="nb">socket_read</span><span class="p">(</span><span class="nv">$parent</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="nx">PHP_NORMAL_READ</span><span class="p">);</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Child Pid %d just read this: `%s&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">getmypid</span><span class="p">(),</span> <span class="nb">rtrim</span><span class="p">(</span><span class="nv">$line</span><span class="p">));</span>
    <span class="nv">$line</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;Child Pid %d is sending this</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">getmypid</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">socket_write</span><span class="p">(</span><span class="nv">$parent</span><span class="p">,</span> <span class="nv">$line</span><span class="p">,</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$line</span><span class="p">)))</span> <span class="p">{</span>
        <span class="nb">socket_close</span><span class="p">(</span><span class="nv">$parent</span><span class="p">);</span>
        <span class="k">die</span><span class="p">(</span><span class="nb">socket_strerror</span><span class="p">(</span><span class="nb">socket_last_error</span><span class="p">()));</span>
    <span class="p">}</span>
    <span class="nb">socket_close</span><span class="p">(</span><span class="nv">$parent</span><span class="p">);</span>
    <span class="k">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_16.11</span>
<span class="c1">// -----------------------------</span>
<span class="c1">// % mkfifo /path/to/named.pipe</span>
<span class="c1">// -----------------------------</span>

<span class="nv">$fifo</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;/path/to/named.pipe&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$fifo</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nb">feof</span><span class="p">(</span><span class="nv">$fifo</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$fifo</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s2">&quot;Got: </span><span class="si">$line</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fifo</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;could not open fifo for read&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// -----------------------------</span>

<span class="nv">$fifo</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;/path/to/named.pipe&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$fifo</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$fifo</span><span class="p">,</span> <span class="s2">&quot;Smoke this.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fifo</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;could not open fifo for write&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// -----------------------------</span>
<span class="c1">// % mkfifo ~/.plan                    #  isn&#39;t this everywhere yet?</span>
<span class="c1">// % mknod  ~/.plan p                  #  in case you don&#39;t have mkfifo</span>
<span class="c1">// -----------------------------</span>

<span class="c1">// dateplan - place current date and time in .plan file</span>
<span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$home</span> <span class="o">=</span> <span class="nb">getenv</span><span class="p">(</span><span class="s1">&#39;HOME&#39;</span><span class="p">);</span>
    <span class="nv">$fifo</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$home</span><span class="s2">/.plan&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$fifo</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t open </span><span class="si">$home</span><span class="s2">/.plan for writing.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$fifo</span><span class="p">,</span>
           <span class="s1">&#39;The current time is &#39;</span>
           <span class="o">.</span> <span class="nb">strftime</span><span class="p">(</span><span class="s1">&#39;%a, %d %b %Y %H:%M:%S %z&#39;</span><span class="p">)</span>
           <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fifo</span><span class="p">);</span>
    <span class="nb">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// -----------------------------</span>

<span class="c1">// fifolog - read and record log msgs from fifo</span>

<span class="nv">$fifo</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

<span class="k">declare</span><span class="p">(</span><span class="nx">ticks</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">function</span> <span class="nf">handle_alarm</span><span class="p">(</span><span class="nv">$signal</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">global</span> <span class="nv">$fifo</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$fifo</span><span class="p">)</span> <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fifo</span><span class="p">);</span>   <span class="c1">// move on to the next queued process</span>
<span class="p">}</span>
<span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGALRM</span><span class="p">,</span> <span class="s1">&#39;handle_alarm&#39;</span><span class="p">);</span>

<span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">pcntl_alarm</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>             <span class="c1">// turn off alarm for blocking open</span>
    <span class="nv">$fifo</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;/tmp/log&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$fifo</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">die</span><span class="p">(</span><span class="s2">&quot;can&#39;t open /tmp/log&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nb">pcntl_alarm</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>             <span class="c1">// you have 1 second to log</span>

    <span class="nv">$service</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$fifo</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$service</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span> <span class="c1">// interrupt or nothing logged</span>
    <span class="nv">$service</span> <span class="o">=</span> <span class="nb">rtrim</span><span class="p">(</span><span class="nv">$service</span><span class="p">);</span>

    <span class="nv">$message</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$fifo</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$message</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span> <span class="c1">// interrupt or nothing logged</span>
    <span class="nv">$message</span> <span class="o">=</span> <span class="nb">rtrim</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>

    <span class="nb">pcntl_alarm</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>             <span class="c1">// turn off alarms for message processing</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$service</span> <span class="o">==</span> <span class="s1">&#39;http&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ignoring</span>
    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$service</span> <span class="o">==</span> <span class="s1">&#39;login&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// log to /var/log/login</span>
        <span class="nv">$log</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;/var/log/login&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$log</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$log</span><span class="p">,</span>
                   <span class="nb">strftime</span><span class="p">(</span><span class="s1">&#39;%a, %d %b %Y %H:%M:%S %z&#39;</span><span class="p">)</span>
                   <span class="o">.</span> <span class="s2">&quot; </span><span class="si">$service</span><span class="s2"> </span><span class="si">$message</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
            <span class="nb">fclose</span><span class="p">(</span><span class="nv">$log</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nb">trigger_error</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t log </span><span class="si">$service</span><span class="s2"> </span><span class="si">$message</span><span class="s2"> to /var/log/login</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                          <span class="nx">E_USER_WARNING</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_16.12</span>
<span class="c1">// sharetest - test shared variables across forks</span>

<span class="nv">$SHM_KEY</span> <span class="o">=</span> <span class="nb">ftok</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="nv">$handle</span> <span class="o">=</span> <span class="nb">sem_get</span><span class="p">(</span><span class="nv">$SHM_KEY</span><span class="p">);</span>
<span class="nv">$buffer</span> <span class="o">=</span> <span class="nb">shm_attach</span><span class="p">(</span><span class="nv">$handle</span><span class="p">,</span> <span class="mi">1024</span><span class="p">);</span>

<span class="c1">// The original recipe has an INT signal handler here. However, it</span>
<span class="c1">// causes erratic behavior with PHP, and PHP seems to do the right</span>
<span class="c1">// thing without it.</span>

<span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$child</span> <span class="o">=</span> <span class="nb">pcntl_fork</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$child</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;cannot fork&#39;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$child</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$kids</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$child</span><span class="p">;</span> <span class="c1">// in case we care about their pids</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">squabble</span><span class="p">();</span>
        <span class="k">exit</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">print</span> <span class="s1">&#39;Buffer is &#39;</span> <span class="o">.</span> <span class="nb">shm_get_var</span><span class="p">(</span><span class="nv">$buffer</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="nb">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">die</span><span class="p">(</span><span class="s1">&#39;Not reached&#39;</span><span class="p">);</span>

<span class="k">function</span> <span class="nf">squabble</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">global</span> <span class="nv">$handle</span><span class="p">;</span>
    <span class="k">global</span> <span class="nv">$buffer</span><span class="p">;</span>
    <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nv">$pid</span> <span class="o">=</span> <span class="nb">getmypid</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/^</span><span class="si">$pid</span><span class="se">\\</span><span class="s2">b/&quot;</span><span class="p">,</span> <span class="nb">shm_get_var</span><span class="p">(</span><span class="nv">$buffer</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span> <span class="k">continue</span><span class="p">;</span>
        <span class="nb">sem_acquire</span><span class="p">(</span><span class="nv">$handle</span><span class="p">);</span>
        <span class="nv">$i</span><span class="o">++</span><span class="p">;</span>
        <span class="nb">shm_put_var</span><span class="p">(</span><span class="nv">$buffer</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">$pid</span><span class="s2"> </span><span class="si">$i</span><span class="s2">&quot;</span><span class="p">);</span>
        <span class="nb">sem_release</span><span class="p">(</span><span class="nv">$handle</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Buffer is 14357 1</span>
<span class="c1">// Buffer is 14355 3</span>
<span class="c1">// Buffer is 14355 4</span>
<span class="c1">// Buffer is 14354 5</span>
<span class="c1">// Buffer is 14353 6</span>
<span class="c1">// Buffer is 14351 8</span>
<span class="c1">// Buffer is 14351 9</span>
<span class="c1">// Buffer is 14350 10</span>
<span class="c1">// Buffer is 14348 11</span>
<span class="c1">// Buffer is 14348 12</span>
<span class="c1">// Buffer is 14357 10</span>
<span class="c1">// Buffer is 14357 11</span>
<span class="c1">// Buffer is 14355 13</span>
<span class="c1">// ...</span>

<span class="c1">// @@PLEAC@@_16.13</span>
<span class="c1">// Available signal constants</span>
<span class="o">%</span> <span class="nx">php</span> <span class="o">-</span><span class="nx">r</span> <span class="s1">&#39;print_r(get_defined_constants());&#39;</span> <span class="o">|</span> <span class="nx">grep</span> <span class="s1">&#39;\[SIG&#39;</span> <span class="o">|</span> <span class="nx">grep</span> <span class="o">-</span><span class="nx">v</span> <span class="nx">_</span>
    <span class="p">[</span><span class="nx">SIGHUP</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">1</span>
    <span class="p">[</span><span class="nx">SIGINT</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">2</span>
    <span class="p">[</span><span class="nx">SIGQUIT</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">3</span>
    <span class="p">[</span><span class="nx">SIGILL</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">4</span>
    <span class="p">[</span><span class="nx">SIGTRAP</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">5</span>
    <span class="p">[</span><span class="nx">SIGABRT</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">6</span>
    <span class="p">[</span><span class="nx">SIGIOT</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">6</span>
    <span class="p">[</span><span class="nx">SIGBUS</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">7</span>
    <span class="p">[</span><span class="nx">SIGFPE</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">8</span>
    <span class="p">[</span><span class="nx">SIGKILL</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">9</span>
    <span class="p">[</span><span class="nx">SIGUSR1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">10</span>
    <span class="p">[</span><span class="nx">SIGSEGV</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">11</span>
    <span class="p">[</span><span class="nx">SIGUSR2</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">12</span>
    <span class="p">[</span><span class="nx">SIGPIPE</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">13</span>
    <span class="p">[</span><span class="nx">SIGALRM</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">14</span>
    <span class="p">[</span><span class="nx">SIGTERM</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">15</span>
    <span class="p">[</span><span class="nx">SIGSTKFLT</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">16</span>
    <span class="p">[</span><span class="nx">SIGCLD</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">17</span>
    <span class="p">[</span><span class="nx">SIGCHLD</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">17</span>
    <span class="p">[</span><span class="nx">SIGCONT</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">18</span>
    <span class="p">[</span><span class="nx">SIGSTOP</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">19</span>
    <span class="p">[</span><span class="nx">SIGTSTP</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">20</span>
    <span class="p">[</span><span class="nx">SIGTTIN</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">21</span>
    <span class="p">[</span><span class="nx">SIGTTOU</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">22</span>
    <span class="p">[</span><span class="nx">SIGURG</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">23</span>
    <span class="p">[</span><span class="nx">SIGXCPU</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">24</span>
    <span class="p">[</span><span class="nx">SIGXFSZ</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">25</span>
    <span class="p">[</span><span class="nx">SIGVTALRM</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">26</span>
    <span class="p">[</span><span class="nx">SIGPROF</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">27</span>
    <span class="p">[</span><span class="nx">SIGWINCH</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">28</span>
    <span class="p">[</span><span class="nx">SIGPOLL</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">29</span>
    <span class="p">[</span><span class="nx">SIGIO</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">29</span>
    <span class="p">[</span><span class="nx">SIGPWR</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">30</span>
    <span class="p">[</span><span class="nx">SIGSYS</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">31</span>
    <span class="p">[</span><span class="nx">SIGBABY</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">31</span>

<span class="c1">// Predefined signal handler constants</span>
<span class="o">%</span> <span class="nx">php</span> <span class="o">-</span><span class="nx">r</span> <span class="s1">&#39;print_r(get_defined_constants());&#39;</span> <span class="o">|</span> <span class="nx">grep</span> <span class="s1">&#39;\[SIG&#39;</span> <span class="o">|</span> <span class="nx">grep</span> <span class="nx">_</span>
    <span class="p">[</span><span class="nx">SIG_IGN</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">1</span>
    <span class="p">[</span><span class="nx">SIG_DFL</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">0</span>
    <span class="p">[</span><span class="nx">SIG_ERR</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="o">-</span><span class="mi">1</span>

<span class="c1">// @@PLEAC@@_16.14</span>
<span class="c1">// send pid a signal 9</span>
<span class="nb">posix_kill</span><span class="p">(</span><span class="nv">$pid</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
<span class="c1">// send whole job a signal 1</span>
<span class="nb">posix_kill</span><span class="p">(</span><span class="nv">$pgrp</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="c1">// send myself a SIGUSR1</span>
<span class="nb">posix_kill</span><span class="p">(</span><span class="nb">getmypid</span><span class="p">(),</span> <span class="nx">SIGUSR1</span><span class="p">);</span>
<span class="c1">// send a SIGHUP to processes in pids</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$pids</span> <span class="k">as</span> <span class="nv">$pid</span><span class="p">)</span> <span class="nb">posix_kill</span><span class="p">(</span><span class="nv">$pid</span><span class="p">,</span> <span class="nx">SIGHUP</span><span class="p">);</span>

<span class="c1">// -----------------------------</span>

<span class="c1">// Use kill with pseudo-signal 0 to see if process is alive.</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">posix_kill</span><span class="p">(</span><span class="nv">$minion</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">$minion</span><span class="s2"> is alive!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">$minion</span><span class="s2"> is deceased.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_16.15</span>
<span class="c1">// call got_sig_quit for every SIGQUIT</span>
<span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGQUIT</span><span class="p">,</span> <span class="s1">&#39;got_sig_quit&#39;</span><span class="p">);</span>
<span class="c1">// call got_sig_pipe for every SIGPIPE</span>
<span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGPIPE</span><span class="p">,</span> <span class="s1">&#39;got_sig_pipe&#39;</span><span class="p">);</span>
<span class="c1">// increment ouch for every SIGINT</span>
<span class="k">function</span> <span class="nf">got_sig_int</span><span class="p">(</span><span class="nv">$signal</span><span class="p">)</span> <span class="p">{</span> <span class="k">global</span> <span class="nv">$ouch</span><span class="p">;</span> <span class="nv">$ouch</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
<span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGINT</span><span class="p">,</span> <span class="s1">&#39;got_sig_int&#39;</span><span class="p">);</span>
<span class="c1">// ignore the signal INT</span>
<span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGINT</span><span class="p">,</span> <span class="nx">SIG_IGN</span><span class="p">);</span>
<span class="c1">// restore default STOP signal handling</span>
<span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGSTOP</span><span class="p">,</span> <span class="nx">SIG_DFL</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_16.16</span>
<span class="c1">// the signal handler</span>
<span class="k">function</span> <span class="nf">ding</span><span class="p">(</span><span class="nv">$signal</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDERR</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\x07</span><span class="s2">Enter your name!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// prompt for name, overriding SIGINT</span>
<span class="k">function</span> <span class="nf">get_name</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">declare</span><span class="p">(</span><span class="nx">ticks</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGINT</span><span class="p">,</span> <span class="s1">&#39;ding&#39;</span><span class="p">);</span>

    <span class="k">echo</span> <span class="s2">&quot;Kindly Stranger, please enter your name: &quot;</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!@</span><span class="nb">stream_select</span><span class="p">(</span><span class="nv">$read</span><span class="o">=</span><span class="k">array</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">),</span>
                           <span class="nv">$write</span><span class="o">=</span><span class="k">null</span><span class="p">,</span>
                           <span class="nv">$except</span><span class="o">=</span><span class="k">null</span><span class="p">,</span>
                           <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// allow signals to be observed</span>
    <span class="p">}</span>
    <span class="nv">$name</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">);</span>

    <span class="c1">// Since pcntl_signal() doesn&#39;t return the old signal handler, the</span>
    <span class="c1">// best we can do here is set it back to the default behavior.</span>
    <span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGINT</span><span class="p">,</span> <span class="nx">SIG_DFL</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$name</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_16.17</span>
<span class="k">function</span> <span class="nf">got_int</span><span class="p">(</span><span class="nv">$signal</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGINT</span><span class="p">,</span> <span class="s1">&#39;got_int&#39;</span><span class="p">);</span>  <span class="c1">// but not for SIGCHLD!</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
<span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGINT</span><span class="p">,</span> <span class="s1">&#39;got_int&#39;</span><span class="p">);</span>

<span class="c1">// -----------------------------</span>

<span class="k">declare</span><span class="p">(</span><span class="nx">ticks</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
<span class="nv">$interrupted</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

<span class="k">function</span> <span class="nf">got_int</span><span class="p">(</span><span class="nv">$signal</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">global</span> <span class="nv">$interrupted</span><span class="p">;</span>
    <span class="nv">$interrupted</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="c1">// The third argument to pcntl_signal() determines if system calls</span>
    <span class="c1">// should be restarted after a signal. It defaults to true.</span>
    <span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGINT</span><span class="p">,</span> <span class="s1">&#39;got_int&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>  <span class="c1">// or SIG_IGN</span>
<span class="p">}</span>
<span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGINT</span><span class="p">,</span> <span class="s1">&#39;got_int&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>

<span class="c1">// ... long-running code that you don&#39;t want to restart</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$interrupted</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// deal with the signal</span>
<span class="p">}</span>

<span class="c1">// @@PLEAC@@_16.18</span>
<span class="c1">// ignore signal INT</span>
<span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGINT</span><span class="p">,</span> <span class="nx">SIG_IGN</span><span class="p">);</span>

<span class="c1">// install signal handler</span>
<span class="k">declare</span><span class="p">(</span><span class="nx">ticks</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">function</span> <span class="nf">tsktsk</span><span class="p">(</span><span class="nv">$signal</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">fwrite</span><span class="p">(</span><span class="nx">STDERR</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\x07</span><span class="s2">The long habit of living indisposeth us for dying.&quot;</span><span class="p">);</span>
    <span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGINT</span><span class="p">,</span> <span class="s1">&#39;tsktsk&#39;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGINT</span><span class="p">,</span> <span class="s1">&#39;tsktsk&#39;</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_16.19</span>
<span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGCHLD</span><span class="p">,</span> <span class="nx">SIG_IGN</span><span class="p">);</span>

<span class="c1">// -----------------------------</span>

<span class="k">declare</span><span class="p">(</span><span class="nx">ticks</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">function</span> <span class="nf">reaper</span><span class="p">(</span><span class="nv">$signal</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$pid</span> <span class="o">=</span> <span class="nb">pcntl_waitpid</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$status</span><span class="p">,</span> <span class="nx">WNOHANG</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$pid</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="nx">reaper</span><span class="p">(</span><span class="nv">$signal</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// install *after* calling waitpid</span>
    <span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGCHLD</span><span class="p">,</span> <span class="s1">&#39;reaper&#39;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGCHLD</span><span class="p">,</span> <span class="s1">&#39;reaper&#39;</span><span class="p">);</span>

<span class="c1">// -----------------------------</span>

<span class="k">declare</span><span class="p">(</span><span class="nx">ticks</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">function</span> <span class="nf">reaper</span><span class="p">(</span><span class="nv">$signal</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$pid</span> <span class="o">=</span> <span class="nb">pcntl_waitpid</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$status</span><span class="p">,</span> <span class="nx">WNOHANG</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$pid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// No child waiting. Ignore it.</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">pcntl_wifexited</span><span class="p">(</span><span class="nv">$signal</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="s2">&quot;Process </span><span class="si">$pid</span><span class="s2"> exited.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="s2">&quot;False alarm on </span><span class="si">$pid</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">reaper</span><span class="p">(</span><span class="nv">$signal</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGCHLD</span><span class="p">,</span> <span class="s1">&#39;reaper&#39;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGCHLD</span><span class="p">,</span> <span class="s1">&#39;reaper&#39;</span><span class="p">);</span>

<span class="c1">// @@PLEAC@@_16.20</span>
<span class="c1">// PHP does not support sigprocmask().</span>

<span class="c1">// @@PLEAC@@_16.21</span>
<span class="k">declare</span><span class="p">(</span><span class="nx">ticks</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
<span class="nv">$aborted</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

<span class="k">function</span> <span class="nf">handle_alarm</span><span class="p">(</span><span class="nv">$signal</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">global</span> <span class="nv">$aborted</span><span class="p">;</span>
    <span class="nv">$aborted</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
<span class="p">}</span>
<span class="nb">pcntl_signal</span><span class="p">(</span><span class="nx">SIGALRM</span><span class="p">,</span> <span class="s1">&#39;handle_alarm&#39;</span><span class="p">);</span>

<span class="nb">pcntl_alarm</span><span class="p">(</span><span class="mi">3600</span><span class="p">);</span>
<span class="c1">// long-time operations here</span>
<span class="nb">pcntl_alarm</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$aborted</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// timed out - do what you will here</span>
<span class="p">}</span>
</pre></div>
</body>
</html>
