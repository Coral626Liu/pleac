<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Strings</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Tcl"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="PLEAC-Tcl"
HREF="index.html"><LINK
REL="NEXT"
TITLE="Numbers"
HREF="numbers.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Tcl</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="index.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="numbers.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="STRINGS"
>1. Strings</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN14"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>

<span class="c"># Tcl&#39;s &quot;...&quot; corresponds to Perl&#39;s &quot;...&quot;, while the other</span>
<span class="c"># quoting construct {...} is more similar to Perl&#39;s q{...}</span>
<span class="c"># operator.</span>

<span class="c"># It&#39;s not necessary to quote text data in Tcl as long as</span>
<span class="c"># it doesn&#39;t contain whitespace.</span>



<span class="k">set</span> string <span class="k">{</span><span class="err">\</span><span class="nv">n</span><span class="k">}</span>                     <span class="k">;</span><span class="c"># two characters, \ and n</span>

<span class="k">set</span> string <span class="s2">&quot;jon &#39;maddog&#39; orwant&quot;</span>    <span class="k">;</span><span class="c"># literal single quotes</span>

<span class="k">set</span> string <span class="err">\</span>n                       <span class="k">;</span><span class="c"># a &quot;newline&quot; character</span>

<span class="k">set</span> string <span class="s2">&quot;jon \&quot;crosby\&quot; orwant&quot;</span>  <span class="k">;</span><span class="c"># literal double quotes</span>

<span class="k">set</span> string <span class="k">{</span><span class="nv">jon</span> <span class="s2">&quot;stills&quot;</span> orwant<span class="k">}</span>    <span class="k">;</span><span class="c"># literal double quotes</span>

<span class="k">set</span> string <span class="s2">&quot;jon {nash} orwant&quot;</span>      <span class="k">;</span><span class="c"># literal braces</span>

<span class="k">set</span> string <span class="k">{</span><span class="nv">jon</span> <span class="k">{</span><span class="nv">young</span><span class="k">}</span> orwant<span class="k">}</span>     <span class="k">;</span><span class="c"># literal braces</span>

<span class="k">set</span> a <span class="k">{</span>
<span class="nv">this</span> is a multiline string
<span class="nv">terminated</span> by an unescaped and
<span class="k">{</span><span class="nv">unnested</span><span class="k">}</span> <span class="nv">right</span> brace <span class="k">(</span><span class="err">\}</span><span class="k">)</span>
<span class="k">}</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN17"
>Accessing Substrings</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>

<span class="k">set</span> value <span class="k">[</span><span class="nb">string</span> range <span class="nv">$string</span> <span class="nv">$first</span> <span class="nv">$last</span><span class="k">]</span>

<span class="k">set</span> value <span class="k">[</span><span class="nb">string</span> range <span class="nv">$string</span> <span class="nv">$first</span> <span class="k">[expr</span> <span class="k">{</span><span class="nv">$first</span><span class="o">+</span><span class="nv">$count-1</span><span class="k">}]]</span>

<span class="k">set</span> value <span class="k">[</span><span class="nb">string</span> range <span class="nv">$string</span> <span class="nv">$first</span> end<span class="k">]</span>


<span class="k">set</span> string <span class="k">[</span><span class="nb">string</span> replace <span class="nv">$string</span> <span class="nv">$first</span> <span class="nv">$last</span> <span class="nv">$newstring</span><span class="k">]</span>

<span class="k">set</span> string <span class="k">[</span><span class="nb">string</span> replace <span class="nv">$string</span> <span class="nv">$first</span> <span class="k">[expr</span> <span class="k">{</span><span class="nv">$first</span><span class="o">+</span><span class="nv">$count-1</span><span class="k">}]</span> <span class="nv">$newstring</span><span class="k">]</span>

<span class="k">set</span> string <span class="k">[</span><span class="nb">string</span> replace <span class="nv">$string</span> <span class="nv">$first</span> end <span class="nv">$newtail</span><span class="k">]</span>


<span class="c"># get a 5-byte string, skip 3, then grab 2 8-byte strings, then the rest</span>
<span class="nb">binary</span> scan <span class="nv">$data</span> <span class="s2">&quot;A5 x3 A8 A8 A*&quot;</span> leading s1 s2 trailing


<span class="c"># Important note: the above was all well and good when the Cookbook was </span>
<span class="c"># written and a character and a byte were the same size.  They still</span>
<span class="c"># are for some programming languages, but Tcl for one uses 16-bit</span>
<span class="c"># Unicode characters to encode strings.</span>

<span class="c">#   The above unpack/scan works for strings containing only character</span>
<span class="c"># codes in the range 0--255, but distorts other strings by truncating</span>
<span class="c"># all codes to 8 bits.</span>

<span class="c">#   To avoid this, the input string can be converted to an 8-bit</span>
<span class="c"># encoding before scanning:</span>


<span class="nb">encoding</span> convertto utf-8 <span class="s2">&quot;H\u2082O is the chemical formula for water&quot;</span>
<span class="c"># =&gt; HÐ²??O is the chemical formula for water</span>


<span class="c"># split at five-byte boundaries (16-bit safe)</span>
<span class="k">set</span> fivers <span class="k">[</span><span class="nb">list</span><span class="k">]</span>
<span class="k">set</span> temp <span class="k">[</span><span class="nb">encoding</span> convertto utf-8 <span class="nv">$string</span><span class="k">]</span>
<span class="k">while</span> <span class="k">{[</span><span class="nb">binary</span> scan <span class="nv">$temp</span> a5a<span class="o">*</span> group tail<span class="k">]}</span> <span class="k">{</span>
    <span class="nb">lappend</span> fivers <span class="nv">$group</span>
    <span class="k">set</span> temp <span class="nv">$tail</span>
<span class="k">}</span>
<span class="k">if</span> <span class="k">{[</span><span class="nb">string</span> length <span class="nv">$tail</span><span class="k">]}</span> <span class="k">{</span> <span class="nb">lappend</span> fivers <span class="nv">$tail</span> <span class="k">}</span>
<span class="k">set</span> fivers


<span class="c"># split at five-char boundaries (16-bit safe)</span>
<span class="k">set</span> fivers <span class="k">[</span><span class="nb">regexp</span> <span class="o">-</span>all <span class="o">-</span>inline <span class="k">{</span><span class="nv">.</span><span class="k">{</span><span class="nv">1</span><span class="err">,</span><span class="mi">5</span><span class="k">}}</span> <span class="nv">$data</span><span class="k">]</span>


<span class="c"># chop string into individual characters:</span>
<span class="k">set</span> chars <span class="k">[</span><span class="nb">split</span> <span class="nv">$data</span> <span class="k">{}]</span>


<span class="c"># &quot;This is what you have&quot;</span>
<span class="c"># +012345678901234567890  Indexing forwards (left to right)</span>
<span class="c">#  098765432109876543210- Indexing from end (right to left)</span>
<span class="c"># note that 0 means 10 or 20, etc. above</span>

<span class="c"># end is a special value that is available in list and string </span>
<span class="c"># commands.  It is defined as the index of the last element (in </span>
<span class="c"># lists), or character (in strings).</span>
<span class="c">#   Likewise, end-1 is defined as the element/character</span>
<span class="c"># preceding the last, and so on.</span>


<span class="k">set</span> first <span class="k">[</span><span class="nb">string</span> index <span class="s2">&quot;This is what you have&quot;</span> <span class="mi">0</span><span class="k">]</span>
<span class="c"># =&gt; T</span>

 
<span class="k">set</span> start <span class="k">[</span><span class="nb">string</span> range <span class="s2">&quot;This is what you have&quot;</span> <span class="mi">5</span> <span class="mi">6</span><span class="k">]</span>
<span class="c"># =&gt; is</span>

 
<span class="k">set</span> rest <span class="k">[</span><span class="nb">string</span> range <span class="s2">&quot;This is what you have&quot;</span> <span class="mi">13</span> end<span class="k">]</span>
<span class="c"># =&gt; you have</span>

 
<span class="k">set</span> last <span class="k">[</span><span class="nb">string</span> index <span class="s2">&quot;This is what you have&quot;</span> end<span class="k">]</span>
<span class="c"># =&gt; e</span>

 
<span class="k">set</span> end <span class="k">[</span><span class="nb">string</span> range <span class="s2">&quot;This is what you have&quot;</span> end-3 end<span class="k">]</span>
<span class="c"># =&gt; have</span>

 
<span class="k">set</span> piece <span class="k">[</span><span class="nb">string</span> range <span class="s2">&quot;This is what you have&quot;</span> end-7 end-5<span class="k">]</span>
<span class="c"># =&gt; you</span>


<span class="c"># The general technique here is to mutate a string and then assign</span>
<span class="c"># it back to the variable.  One can [replace] a segment of the string</span>
<span class="c"># with another string or with an empty string (deleting the segment)</span>
<span class="c"># or simply select a segment using [range].</span>


 
<span class="k">set</span> string <span class="k">[</span><span class="nb">string</span> replace <span class="s2">&quot;This is what you have&quot;</span> <span class="mi">5</span> <span class="mi">6</span> wasn<span class="err">&#39;</span>t<span class="k">]</span>
<span class="c"># =&gt; This wasn&#39;t what you have</span>

 
<span class="k">set</span> string <span class="k">[</span><span class="nb">string</span> replace <span class="s2">&quot;This wasn&#39;t what you have&quot;</span> end-11 end ondrous<span class="k">]</span>
<span class="c"># =&gt; This wasn&#39;t wondrous</span>

 
<span class="k">set</span> string <span class="k">[</span><span class="nb">string</span> range <span class="s2">&quot;This wasn&#39;t wondrous&quot;</span> <span class="mi">1</span> end<span class="k">]</span>
<span class="c"># =&gt; his wasn&#39;t wondrous</span>

 
<span class="k">set</span> string <span class="k">[</span><span class="nb">string</span> range <span class="s2">&quot;his wasn&#39;t wondrous&quot;</span> <span class="mi">0</span> end-10<span class="k">]</span>
<span class="c"># =&gt; his wasn&#39;</span>


<span class="k">if</span> <span class="k">{[</span><span class="nb">regexp</span> <span class="nv">$pattern</span> <span class="k">[</span><span class="nb">string</span> range <span class="nv">$string</span> end-9 end<span class="k">]]}</span> <span class="k">{</span>
    <span class="k">return</span> <span class="s2">&quot;Pattern matches in last 10 characters&quot;</span>
<span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
    <span class="k">return</span> <span class="s2">&quot;Match failed&quot;</span>
<span class="k">}</span>


<span class="c"># substitute &quot;at&quot; for &quot;is&quot;, restricted to first five characters</span>
<span class="nb">regsub</span> <span class="o">-</span>all is <span class="k">[</span><span class="nb">string</span> range <span class="nv">$string</span> <span class="mi">0</span> <span class="mi">4</span><span class="k">]</span> at newstring
<span class="k">set</span> string <span class="k">[</span><span class="nb">string</span> replace <span class="nv">$string</span> <span class="mi">0</span> <span class="mi">4</span> <span class="nv">$newstring</span><span class="k">]</span>


<span class="nb">regsub</span> <span class="k">{(</span><span class="nv">.</span><span class="k">)(</span><span class="nv">.</span><span class="o">*</span><span class="k">)(</span><span class="nv">.</span><span class="k">)}</span> <span class="s2">&quot;make a hat&quot;</span> <span class="k">{</span><span class="err">\</span><span class="nv">3</span><span class="err">\</span><span class="mi">2</span><span class="err">\</span><span class="mi">1</span><span class="k">}</span> a
<span class="nb">puts</span> <span class="nv">$a</span>
<span class="c"># =&gt; take a ham</span>


<span class="k">set</span> b <span class="k">[</span><span class="nb">string</span> range <span class="s2">&quot;To be or not to be&quot;</span> <span class="mi">6</span> <span class="mi">11</span><span class="k">]</span>
<span class="c"># =&gt; or not</span>

 
<span class="k">set</span> a <span class="s2">&quot;To be or not to be&quot;</span>
<span class="k">set</span> b <span class="k">[</span><span class="nb">string</span> range <span class="nv">$a</span> <span class="mi">6</span> <span class="mi">7</span><span class="k">]</span>
<span class="nb">append</span> b <span class="o">:</span> <span class="k">[</span><span class="nb">string</span> range <span class="nv">$a</span> <span class="mi">3</span> <span class="mi">4</span><span class="k">]</span>
<span class="c"># =&gt; or:be</span>


<span class="k">proc</span> cut2fmt <span class="k">{</span><span class="nv">args</span><span class="k">}</span> <span class="k">{</span>
    <span class="k">set</span> positions <span class="nv">$args</span>
    <span class="k">set</span> template  <span class="k">{}</span>
    <span class="k">set</span> lastpos   <span class="mi">1</span>
    <span class="k">foreach</span> <span class="k">{</span><span class="nv">place</span><span class="k">}</span> <span class="nv">$positions</span> <span class="k">{</span>
        <span class="nb">append</span> template <span class="s2">&quot;A[expr {$place-$lastpos}] &quot;</span>
        <span class="k">set</span> lastpos <span class="nv">$place</span>
    <span class="k">}</span>
    <span class="nb">append</span> template A<span class="o">*</span>
    <span class="k">return</span> <span class="nv">$template</span>
<span class="k">}</span>
    
<span class="k">set</span> fmt <span class="k">[</span><span class="nv">cut2fmt</span> <span class="mi">8</span> <span class="mi">14</span> <span class="mi">20</span> <span class="mi">26</span> <span class="mi">30</span><span class="k">]</span>
<span class="c"># =&gt; A7 A6 A6 A6 A4 A*</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN20"
>Establishing a Default Value</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>

<span class="c"># In Tcl, commands such as if or while require the value of the</span>
<span class="c"># condition expression to be a proper boolean value.  If the </span>
<span class="c"># value is numeric, 0 is false and anything else is true.  For</span>
<span class="c"># non-numeric strings, &quot;true&quot;, &quot;on&quot;, or &quot;yes&quot; is true and </span>
<span class="c"># &quot;false&quot;, &quot;off&quot;, or &quot;no&quot; is false.  Any other value for the</span>
<span class="c"># condition expression raises an error.</span>
<span class="c">#   The `boolean operators&#39; return either &quot;1&quot; or &quot;0&quot;.</span>



<span class="c"># use $b if b has characters, else $c</span>
<span class="k">if</span> <span class="k">{[</span><span class="nb">string</span> length <span class="nv">$b</span><span class="k">]}</span> <span class="k">{</span>
    <span class="k">set</span> a <span class="nv">$b</span>
<span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
    <span class="k">set</span> a <span class="nv">$c</span>
<span class="k">}</span>

 
<span class="c"># use $b if b is non-zero, else $c</span>
<span class="k">if</span> <span class="k">{</span><span class="nv">$b</span> <span class="o">!=</span> <span class="nv">0</span><span class="k">}</span> <span class="k">{</span>
    <span class="k">set</span> a <span class="nv">$b</span>
<span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
    <span class="k">set</span> a <span class="nv">$c</span>
<span class="k">}</span>


<span class="c"># set x to $y if $x has no characters</span>
<span class="k">if</span> <span class="k">{</span><span class="o">!</span><span class="k">[</span><span class="nb">string</span> length <span class="nv">$x</span><span class="k">]}</span> <span class="k">{</span>
    <span class="k">set</span> x <span class="nv">$y</span>
<span class="k">}</span>

 
<span class="c"># set x to $y if $x is zero</span>
<span class="k">if</span> <span class="k">{</span><span class="nv">$x</span> <span class="o">==</span> <span class="nv">0</span><span class="k">}</span> <span class="k">{</span>
    <span class="k">set</span> x <span class="nv">$y</span>
<span class="k">}</span>


<span class="c"># set a to $b if b exists, else to $c</span>
<span class="k">if</span> <span class="k">{[</span><span class="nb">info</span> exists b<span class="k">]}</span> <span class="k">{</span>
    <span class="k">set</span> a <span class="nv">$b</span>
<span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
    <span class="k">set</span> a <span class="nv">$c</span>
<span class="k">}</span>


<span class="c"># Perl: $dir = shift(@ARGV) || &quot;/tmp&quot;;</span>
<span class="k">set</span> arg <span class="k">[</span><span class="nb">lindex</span> <span class="nv">$argv</span> <span class="mi">0</span><span class="k">]</span>
<span class="k">set</span> argv <span class="k">[</span><span class="nb">lrange</span> <span class="nv">$argv</span> <span class="mi">1</span> end<span class="k">]</span>
<span class="k">if</span> <span class="k">{[</span><span class="nb">string</span> length <span class="nv">$arg</span><span class="k">]}</span> <span class="k">{</span>
    <span class="k">set</span> dir <span class="nv">$arg</span>
<span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
    <span class="k">set</span> dir <span class="o">/</span>tmp
<span class="k">}</span>


<span class="c"># Perl: $dir = $ARGV[0] || &quot;/tmp&quot;;</span>
<span class="k">set</span> arg <span class="k">[</span><span class="nb">lindex</span> <span class="nv">$argv</span> <span class="mi">0</span><span class="k">]</span>
<span class="k">if</span> <span class="k">{[</span><span class="nb">string</span> length <span class="nv">$arg</span><span class="k">]}</span> <span class="k">{</span>
    <span class="k">set</span> dir <span class="nv">$arg</span>
<span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
    <span class="k">set</span> dir <span class="o">/</span>tmp
<span class="k">}</span>


<span class="c"># Perl: $dir = defined($ARGV[0]) ? shift(@ARGV) : &quot;/tmp&quot;;</span>
<span class="k">if</span> <span class="k">{[</span><span class="nb">info</span> exists argv<span class="k">]</span> <span class="o">&amp;&amp;</span> <span class="k">[</span><span class="nb">llength</span> <span class="nv">$argv</span><span class="k">]}</span> <span class="k">{</span>
    <span class="k">set</span> dir <span class="k">[</span><span class="nb">lindex</span> <span class="nv">$argv</span> <span class="mi">0</span><span class="k">]</span>
    <span class="k">set</span> argv <span class="k">[</span><span class="nb">lrange</span> <span class="nv">$argv</span> <span class="mi">1</span> end<span class="k">]</span>
<span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
    <span class="k">set</span> dir <span class="o">/</span>tmp
<span class="k">}</span>

 
<span class="c"># Perl: $dir = @ARGV ? $ARGV[0] : &quot;/tmp&quot;;</span>
<span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$argv</span><span class="k">]}</span> <span class="k">{</span>
    <span class="k">set</span> dir <span class="k">[</span><span class="nb">lindex</span> <span class="nv">$argv</span> <span class="mi">0</span><span class="k">]</span>
<span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
    <span class="k">set</span> dir <span class="o">/</span>tmp
<span class="k">}</span>


<span class="c"># Perl: $count{ $shell || &quot;/bin/sh&quot; }++;</span>
<span class="k">if</span> <span class="k">{</span><span class="o">!</span><span class="k">[</span><span class="nb">string</span> length <span class="nv">$shell</span><span class="k">]}</span> <span class="k">{</span>
    <span class="k">set</span> shell <span class="o">/</span>bin<span class="o">/</span>sh
<span class="k">}</span>
<span class="k">if</span> <span class="k">{[</span><span class="nb">info</span> exist count<span class="k">(</span><span class="nv">$shell</span><span class="k">)]}</span> <span class="k">{</span>
    <span class="nb">incr</span> count<span class="k">(</span><span class="nv">$shell</span><span class="k">)</span>
<span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
    <span class="k">set</span> count<span class="k">(</span><span class="nv">$shell</span><span class="k">)</span> <span class="mi">1</span>
<span class="k">}</span>


<span class="c"># The catch command intercepts errors raised.  In this</span>
<span class="c"># case catch is used as an alternative idiom to </span>
<span class="c"># [info exists var].</span>
<span class="c"># The pros and cons of the different idioms is </span>
<span class="c"># discussed at &lt;URL: http://mini.net/tcl/1322.html&gt;.</span>



<span class="c"># find the user name on Unix systems; needs extension to</span>
<span class="c"># check getlogin() and getpwuid()</span>
<span class="k">if</span> <span class="k">{</span><span class="o">!</span><span class="k">[catch</span> <span class="k">{</span><span class="nb">string</span> length <span class="nv">$env</span><span class="k">(</span><span class="nv">USER</span><span class="k">)}]}</span> <span class="k">{</span>
    <span class="k">set</span> user <span class="nv">$env</span><span class="k">(</span><span class="nv">USER</span><span class="k">)</span>
<span class="k">}</span> <span class="k">elseif</span> <span class="k">{</span><span class="o">!</span><span class="k">[catch</span> <span class="k">{</span><span class="nb">string</span> length <span class="nv">$env</span><span class="k">(</span><span class="nv">LOGIN</span><span class="k">)}]}</span> <span class="k">{</span>
    <span class="k">set</span> user <span class="nv">$env</span><span class="k">(</span><span class="nv">LOGIN</span><span class="k">)</span>
<span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
    <span class="k">set</span> user <span class="s2">&quot;Unknown user&quot;</span>
<span class="k">}</span>

<span class="c"># The most obvious way to do the above in Tcl is</span>
<span class="k">set</span> <span class="o">::</span>tcl_platform<span class="k">(</span><span class="nv">user</span><span class="k">)</span>

<span class="k">if</span> <span class="k">{</span><span class="o">!</span><span class="k">[</span><span class="nb">string</span> length <span class="nv">$startingPoint</span><span class="k">]}</span> <span class="k">{</span>
    <span class="k">set</span> startingPoint Greenwich
<span class="k">}</span>


<span class="c"># if x has no elements, assign $y to it</span>
<span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$x</span><span class="k">]</span> <span class="o">==</span> <span class="nv">0</span><span class="k">}</span> <span class="k">{</span>
    <span class="k">set</span> x <span class="nv">$y</span>
<span class="k">}</span>

<span class="c"># if y has elements, assign it to x, otherwise assign $z to x</span>
<span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$y</span><span class="k">]}</span> <span class="k">{</span>
    <span class="k">set</span> x <span class="nv">$y</span>
<span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
    <span class="k">set</span> x <span class="nv">$z</span>
<span class="k">}</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN23"
>Exchanging Values Without Using Temporary Variables</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>

<span class="c"># cross-assignment</span>
<span class="k">foreach</span> <span class="k">{</span><span class="nv">b</span> a<span class="k">}</span> <span class="nv">$args</span> break


<span class="c"># cross-assignment with temp</span>
<span class="k">set</span> temp <span class="nv">$a</span>
<span class="k">set</span> a <span class="nv">$b</span>
<span class="k">set</span> b <span class="nv">$temp</span>
<span class="k">unset</span> temp


<span class="k">foreach</span> <span class="k">{</span><span class="nv">alpha</span> beta production<span class="k">}</span> <span class="k">[</span><span class="nb">list</span> January March August<span class="k">]</span> break
<span class="c"># move beta       to alpha,</span>
<span class="c"># move production to beta,</span>
<span class="c"># move alpha      to production</span>
<span class="k">foreach</span> <span class="k">{</span><span class="nv">alpha</span> beta production<span class="k">}</span> <span class="k">[</span><span class="nb">list</span> <span class="nv">$beta</span> <span class="nv">$production</span> <span class="nv">$alpha</span><span class="k">]</span> break</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN26"
>Converting Between ASCII Characters and Values</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>

<span class="k">set</span> num <span class="k">[</span><span class="nb">scan</span> <span class="nv">$char</span> <span class="o">%</span>c<span class="k">]</span>


<span class="k">set</span> char <span class="k">[</span><span class="nb">format</span> <span class="o">%</span>c <span class="nv">$num</span><span class="k">]</span>

<span class="nb">format</span> <span class="s2">&quot;Number %d is character %c&quot;</span> <span class="mi">101</span> <span class="mi">101</span>
<span class="c"># =&gt; Number 101 is character e</span>


<span class="k">set</span> utf8data <span class="k">[</span><span class="nb">encoding</span> convertto utf-8 <span class="nv">$string</span><span class="k">]</span>
<span class="nb">binary</span> scan <span class="nv">$utf8data</span> c<span class="o">*</span> codelist


<span class="k">set</span> utf8data <span class="k">[</span><span class="nb">binary</span> format c<span class="o">*</span> <span class="nv">$codelist</span><span class="k">]</span>
<span class="k">set</span> string <span class="k">[</span><span class="nb">encoding</span> convertfrom utf-8 <span class="nv">$utf8data</span><span class="k">]</span>


<span class="k">proc</span> hal2ibm <span class="k">{}</span> <span class="k">{</span>
    <span class="k">set</span> hal HAL
    <span class="nb">binary</span> scan <span class="nv">$hal</span> c<span class="o">*</span> codes
    <span class="k">foreach</span> <span class="k">{</span><span class="nv">num</span><span class="k">}</span> <span class="nv">$codes</span> <span class="k">{</span>
        <span class="nb">lappend</span> newcodes <span class="k">[</span><span class="nb">incr</span> num<span class="k">]</span>
    <span class="k">}</span>
    <span class="k">set</span> ibm <span class="k">[</span><span class="nb">binary</span> format c<span class="o">*</span> <span class="nv">$newcodes</span><span class="k">]</span>
<span class="k">}</span>
<span class="nv">hal2ibm</span>
<span class="c"># =&gt; IBM</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN29"
>Processing a String One Character at a Time</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>

<span class="k">set</span> a <span class="k">[</span><span class="nb">split</span> <span class="nv">$string</span> <span class="k">{}]</span>


<span class="k">set</span> utf8data <span class="k">[</span><span class="nb">encoding</span> convertto utf-8 <span class="nv">$string</span><span class="k">]</span>
<span class="nb">binary</span> scan <span class="nv">$utf8data</span> c<span class="o">*</span> a


<span class="c"># with -line, . never matches newline</span>
<span class="k">foreach</span> <span class="mi">1</span> <span class="k">[</span><span class="nb">regexp</span> <span class="o">-</span>inline <span class="o">-</span>all <span class="o">-</span>line . <span class="nv">$string</span><span class="k">]</span> <span class="k">{</span>
    <span class="c"># do something with $1</span>
<span class="k">}</span>


<span class="k">proc</span> indChars-1 <span class="k">{</span><span class="nv">s</span><span class="k">}</span> <span class="k">{</span>
    <span class="k">array</span> set seen <span class="k">[</span><span class="nb">list</span><span class="k">]</span>
    <span class="k">set</span> string <span class="nv">$s</span>
    <span class="k">foreach</span> <span class="k">{</span><span class="nv">char</span><span class="k">}</span> <span class="k">[</span><span class="nb">split</span> <span class="nv">$string</span> <span class="k">{}]</span> <span class="k">{</span>
        <span class="k">if</span> <span class="k">{[</span><span class="nb">info</span> exists seen<span class="k">(</span><span class="nv">$char</span><span class="k">)]}</span> <span class="k">{</span>
            <span class="nb">incr</span> seen<span class="k">(</span><span class="nv">$char</span><span class="k">)</span>
        <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
            <span class="k">set</span> seen<span class="k">(</span><span class="nv">$char</span><span class="k">)</span> <span class="mi">1</span>
        <span class="k">}</span>
    <span class="k">}</span>
    <span class="nb">puts</span> <span class="s2">&quot;unique chars are: {[join [lsort [array names seen]] {}]}&quot;</span>
<span class="k">}</span>
<span class="nv">indChars-1</span> <span class="s2">&quot;an apple a day&quot;</span>
<span class="c"># =&gt; unique chars are: { adelnpy}</span>


<span class="c"># Of course, if all you care about are which unique </span>
<span class="c"># characters appear, it&#39;s much easier:</span>



<span class="k">proc</span> uniqueChars-1 <span class="k">{</span><span class="nv">s</span><span class="k">}</span> <span class="k">{</span>
    <span class="nb">puts</span> <span class="s2">&quot;unique chars are: {[join [lsort -unique [split $s {}]] {}]}&quot;</span>
<span class="k">}</span>
<span class="nv">uniqueChars-1</span> <span class="s2">&quot;an apple a day&quot;</span>
<span class="c"># =&gt; unique chars are: { adelnpy}</span>


<span class="c"># simplistic checksum calculation</span>
<span class="k">proc</span> simpleChecksum <span class="k">{</span><span class="nb">string</span><span class="k">}</span> <span class="k">{</span>
    <span class="k">set</span> sum <span class="mi">0</span>
    <span class="nb">binary</span> scan <span class="nv">$string</span> c<span class="o">*</span> codes
    <span class="k">foreach</span> <span class="k">{</span><span class="nv">code</span><span class="k">}</span> <span class="nv">$codes</span> <span class="k">{</span>
        <span class="nb">incr</span> sum <span class="nv">$code</span>
    <span class="k">}</span>
    <span class="k">return</span> <span class="nv">$sum</span>
<span class="k">}</span>
<span class="nv">simpleChecksum</span> <span class="s2">&quot;an apple a day&quot;</span>
<span class="c"># =&gt; 1248</span>


<span class="c"># The Trf package, which is available at</span>
<span class="c"># &lt;URL: http://www.oche.de/~akupries/soft/trf/&gt;,</span>
<span class="c"># has several utilities for transforming data,</span>
<span class="c"># including message digests such as CRC and MD5.</span>



<span class="nb">package</span> require Trf
<span class="nb">binary</span> scan <span class="k">[</span><span class="nv">crc</span> <span class="k">{</span><span class="nv">an</span> apple a day<span class="k">}]</span> H<span class="o">*</span> checksum
<span class="k">set</span> checksum
<span class="c"># =&gt; 325295</span>


<span class="c"># slowcat - emulate a   s l o w   line printer</span>
<span class="c"># usage: slowcat [-DELAY] [files ...]</span>
<span class="k">proc</span> slowcat <span class="k">{</span><span class="nv">args</span><span class="k">}</span> <span class="k">{</span>
    <span class="k">set</span> delay <span class="mi">1</span>
    <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$args</span><span class="k">]}</span> <span class="k">{</span>
        <span class="k">if</span> <span class="k">{[</span><span class="nb">regexp</span> <span class="k">{</span><span class="o">^</span><span class="nv">-</span><span class="k">([</span><span class="nv">.</span><span class="err">\</span>d<span class="k">]</span><span class="o">+</span><span class="k">)}</span> <span class="k">[</span><span class="nb">lindex</span> <span class="nv">$args</span> <span class="mi">0</span><span class="k">]</span> match delay<span class="k">]}</span> <span class="k">{</span>
            <span class="k">set</span> args <span class="k">[</span><span class="nb">lrange</span> <span class="nv">$args</span> <span class="mi">1</span> end<span class="k">]</span>
        <span class="k">}</span>
    <span class="k">}</span>
    <span class="nb">fconfigure</span> stdout <span class="o">-</span>buffering no
    <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$args</span><span class="k">]}</span> <span class="k">{</span>
        <span class="k">foreach</span> <span class="k">{</span><span class="nv">arg</span><span class="k">}</span> <span class="nv">$args</span> <span class="k">{</span>
            <span class="k">set</span> f <span class="k">[</span><span class="nb">open</span> <span class="nv">$arg</span><span class="k">]</span>
            <span class="nb">lappend</span> channels <span class="nv">$f</span>
        <span class="k">}</span>
    <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
        <span class="k">set</span> channels stdin
    <span class="k">}</span>
    <span class="k">foreach</span> <span class="k">{</span><span class="nb">chan</span><span class="k">}</span> <span class="nv">$channels</span> <span class="k">{</span>
        <span class="k">while</span> <span class="k">{[</span><span class="nb">gets</span> <span class="nv">$chan</span> line<span class="k">]</span> <span class="o">&gt;</span> <span class="nv">-1</span><span class="k">}</span> <span class="k">{</span>
            <span class="k">foreach</span> <span class="k">{</span><span class="nv">ch</span><span class="k">}</span> <span class="k">[</span><span class="nb">split</span> <span class="nv">$line</span> <span class="k">{}]</span> <span class="k">{</span>
                <span class="nb">puts</span> <span class="o">-</span>nonewline <span class="nv">$ch</span>
                <span class="k">after</span> <span class="k">[expr</span> <span class="k">{</span><span class="nv">int</span><span class="k">(</span><span class="nv">5</span> <span class="o">*</span> <span class="nv">$delay</span><span class="k">)}]</span>
            <span class="k">}</span>
            <span class="nb">puts</span> <span class="k">{}</span>
        <span class="k">}</span>
    <span class="k">}</span>
<span class="k">}</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN32"
>Reversing a String by Word or Character</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>

<span class="k">proc</span> reverse <span class="k">{</span><span class="nv">args</span><span class="k">}</span> <span class="k">{</span>
    <span class="k">set</span> res <span class="k">[</span><span class="nb">list</span><span class="k">]</span>
    <span class="k">if</span> <span class="k">{[</span><span class="nb">llength</span> <span class="nv">$args</span><span class="k">]</span> <span class="o">==</span> <span class="nv">1</span><span class="k">}</span> <span class="k">{</span>
        <span class="k">set</span> args <span class="k">[</span><span class="nb">lindex</span> <span class="nv">$args</span> <span class="mi">0</span><span class="k">]</span>
    <span class="k">}</span>
    <span class="k">foreach</span> elem <span class="nv">$args</span> <span class="k">{</span>
        <span class="k">set</span> res <span class="k">[</span><span class="nb">linsert</span> <span class="nv">$res</span> <span class="mi">0</span> <span class="nv">$elem</span><span class="k">]</span>
    <span class="k">}</span>
    <span class="k">return</span> <span class="nv">$res</span>
<span class="k">}</span>


<span class="c"># reverse characters</span>
<span class="nb">join</span> <span class="k">[</span><span class="nv">reverse</span> <span class="k">[</span><span class="nb">split</span> <span class="nv">$string</span> <span class="k">{}]]</span> <span class="k">{}</span>


<span class="c"># reverse words</span>
<span class="nb">join</span> <span class="k">[</span><span class="nv">reverse</span> <span class="k">[</span><span class="nb">split</span> <span class="nv">$string</span><span class="k">]]</span>

<span class="c"># reverse quoted words</span>
<span class="nb">join</span> <span class="k">[</span><span class="nv">reverse</span> <span class="k">[</span><span class="nb">split</span> <span class="k">{</span><span class="nv">Yoda</span> said<span class="err">,</span> <span class="s2">&quot;can you see this?&quot;</span><span class="k">}]]</span>
<span class="c"># =&gt; this?&quot; see you &quot;can said, Yoda</span>


<span class="k">set</span> word reviver
<span class="k">set</span> is_palindrome <span class="k">[</span><span class="nb">string</span> equal <span class="nv">$word</span> <span class="k">[</span><span class="nb">join</span> <span class="k">[</span><span class="nv">reverse</span> <span class="k">[</span><span class="nb">split</span> <span class="nv">$word</span><span class="k">]]]]</span>
<span class="c"># =&gt; 1</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN35"
>Expanding and Compressing Tabs</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>

<span class="nb">package</span> require textutil
<span class="k">namespace</span> import <span class="o">::</span>textutil::tabify::<span class="o">*</span>
<span class="nv">tabify</span> <span class="s2">&quot;...     zzz        xxx&quot;</span>
<span class="c"># =&gt; ...     zzz	xxx</span>


<span class="nv">untabify</span> <span class="s2">&quot;...\tzzz\txxx&quot;</span>
<span class="c"># =&gt; ...        zzz        xxx</span>


<span class="nv">tabify2</span> <span class="s2">&quot;...     zzz     xxx&quot;</span>
<span class="c"># =&gt; ...	zzz	xxx</span>


<span class="nv">untabify2</span> <span class="s2">&quot;...\tzzz\txxx&quot;</span>
<span class="c"># =&gt; ...     zzz     xxx</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN38"
>Expanding Variables in User Input</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>

<span class="k">set</span> debt <span class="mi">100</span>
<span class="nb">subst</span> <span class="s2">&quot;You owe $debt to me.&quot;</span>
<span class="c"># =&gt; You owe 100 to me.</span>


<span class="k">set</span> debt <span class="mi">100</span>
<span class="k">proc</span> writeIt <span class="k">{</span><span class="nb">string</span><span class="k">}</span> <span class="k">{</span>
    <span class="k">uplevel</span> subst <span class="k">[</span><span class="nb">list</span> <span class="nv">$string</span><span class="k">]</span>
<span class="k">}</span>
<span class="c"># braces prevent immediate substitution</span>
<span class="nv">writeIt</span> <span class="k">{</span><span class="nv">You</span> owe <span class="nv">$debt</span> to me.<span class="k">}</span>
<span class="c"># =&gt; You owe 100 to me.</span>


<span class="k">foreach</span> <span class="k">{</span><span class="nv">rows</span> cols<span class="k">}</span> <span class="k">{</span><span class="nv">24</span> <span class="mi">80</span><span class="k">}</span> break
<span class="k">set</span> text <span class="k">{</span><span class="nv">I</span> am <span class="nv">$rows</span> high and <span class="nv">$cols</span> long<span class="k">}</span>
<span class="nb">subst</span> <span class="nv">$text</span>
<span class="c"># =&gt; I am 24 high and 80 long</span>


<span class="k">set</span> string <span class="s2">&quot;I am 17 years old&quot;</span>
<span class="nb">regsub</span> <span class="o">-</span>all <span class="k">{(</span><span class="err">\</span><span class="nv">d</span><span class="o">+</span><span class="k">)}</span> <span class="nv">$string</span> <span class="k">{[expr</span> <span class="k">{</span><span class="err">\</span><span class="nv">1</span><span class="o">*</span><span class="mi">2</span><span class="k">}]}</span> string
<span class="nb">subst</span> <span class="nv">$string</span>
<span class="c"># =&gt; I am 34 years old</span>


<span class="c"># expand variables in $text, but put an error message in</span>
<span class="c"># if the variable isn&#39;t defined.</span>
<span class="k">proc</span> expandOrError-1 <span class="k">{</span><span class="err">@</span><span class="nv">text</span><span class="k">}</span> <span class="k">{</span>
    <span class="k">upvar</span> <span class="err">$</span><span class="k">{</span><span class="err">@</span><span class="nv">text</span><span class="k">}</span> text
    <span class="k">while</span> <span class="k">{[</span><span class="nb">regexp</span> <span class="k">{</span><span class="err">\$</span><span class="k">(</span><span class="err">\</span><span class="nv">w</span><span class="o">+</span><span class="k">)}</span> <span class="nv">$text</span> match var<span class="k">]}</span> <span class="k">{</span>
        <span class="k">if</span> <span class="k">{[uplevel</span> info exists <span class="nv">$var</span><span class="k">]}</span> <span class="k">{</span>
            <span class="nb">regsub</span> <span class="err">\\</span><span class="nv">$match</span> <span class="nv">$text</span> <span class="k">[uplevel</span> set <span class="nv">$var</span><span class="k">]</span> text
        <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
            <span class="nb">regsub</span> <span class="err">\\</span><span class="nv">$match</span> <span class="nv">$text</span> <span class="s2">&quot;\[NO VARIABLE: $var\]&quot;</span> text
        <span class="k">}</span>
    <span class="k">}</span>
    <span class="k">set</span> text
<span class="k">}</span>


<span class="c"># Tcl allows commands to embedded in text data as well as variables. </span>
<span class="c"># If the string is taken from user input, this may be a security</span>
<span class="c"># hazard.  The solution is to let a &quot;safe interpreter&quot; (which has a</span>
<span class="c"># reduced set of commands by default) interpret the text data.  In</span>
<span class="c"># case the interpreted script text contains illegal commands the</span>
<span class="c"># interpreter raises an error.</span>



<span class="k">proc</span> safeExpand-1 <span class="k">{</span><span class="nb">string</span><span class="k">}</span> <span class="k">{</span>
    <span class="k">set</span> si <span class="k">[</span><span class="nb">interp</span> create <span class="o">-</span>safe<span class="k">]</span>
    <span class="k">set</span> res <span class="k">[uplevel</span> <span class="nv">$si</span> eval <span class="k">[</span><span class="nb">list</span> subst <span class="k">[</span><span class="nb">list</span> <span class="nv">$string</span><span class="k">]]]</span>
    <span class="nb">interp</span> delete <span class="nv">$si</span>
    <span class="k">set</span> res
<span class="k">}</span>
<span class="nv">safeExpand-1</span> <span class="k">{[</span><span class="nb">exec</span> rm foo.bar<span class="k">]}</span>
<span class="c"># =&gt; invalid command name &quot;exec&quot;</span>


<span class="c"># It is also possible to further reduce the command set of an</span>
<span class="c"># interpreter, or to add new commands, or to change the meaning</span>
<span class="c"># of commands (i.e. exec would perform *some* system commands</span>
<span class="c"># but not all, etc).</span>

<span class="c"># But I digress...</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN41"
>Controlling Case</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>

<span class="k">set</span> little <span class="s2">&quot;bo peep&quot;</span>
<span class="k">set</span> big <span class="k">[</span><span class="nb">string</span> toupper <span class="nv">$little</span><span class="k">]</span>
<span class="c"># =&gt; BO PEEP</span>


<span class="k">set</span> big <span class="s2">&quot;BO PEEP&quot;</span>
<span class="k">set</span> little <span class="k">[</span><span class="nb">string</span> tolower <span class="nv">$big</span><span class="k">]</span>
<span class="c"># =&gt; bo peep</span>


<span class="k">set</span> little <span class="s2">&quot;bo peep&quot;</span>
<span class="k">set</span> title <span class="k">[</span><span class="nb">string</span> totitle <span class="nv">$little</span><span class="k">]</span>
<span class="c"># =&gt; Bo peep</span>


<span class="k">set</span> little <span class="s2">&quot;bo peep&quot;</span>
<span class="k">set</span> big <span class="k">[</span><span class="nb">string</span> toupper <span class="nv">$little</span> <span class="mi">0</span><span class="k">]</span>
<span class="c"># =&gt; Bo peep</span>


<span class="k">set</span> big <span class="s2">&quot;BO PEEP&quot;</span>
<span class="k">set</span> little <span class="k">[</span><span class="nb">string</span> tolower <span class="nv">$big</span> <span class="mi">0</span><span class="k">]</span>
<span class="c"># =&gt; bO PEEP</span>


<span class="c"># convert case within a string</span>
<span class="k">set</span> name <span class="k">{</span><span class="nv">kirk</span><span class="k">}</span>
<span class="k">set</span> string <span class="s2">&quot;Ship&#39;s Captain: [string totitle $name].&quot;</span>
<span class="c"># =&gt; Ship&#39;s Captain: Kirk.</span>


<span class="c"># capitalize each word&#39;s first character, downcase the rest</span>
<span class="k">set</span> text <span class="s2">&quot;thIS is a loNG liNE&quot;</span>
<span class="k">set</span> pos <span class="mi">0</span>
<span class="k">while</span> <span class="k">{[</span><span class="nb">regexp</span> <span class="o">-</span>indices <span class="o">-</span>start <span class="nv">$pos</span> <span class="k">{(</span><span class="err">\</span><span class="nv">w</span><span class="o">+</span><span class="k">)}</span> <span class="nv">$text</span> where<span class="k">]}</span> <span class="k">{</span>
    <span class="k">foreach</span> <span class="k">{</span><span class="nv">first</span> last<span class="k">}</span> <span class="nv">$where</span> break
    <span class="k">set</span> text <span class="k">[</span><span class="nb">string</span> totitle <span class="nv">$text</span> <span class="nv">$first</span> <span class="nv">$last</span><span class="k">]</span>
    <span class="k">set</span> pos <span class="nv">$last</span>
    <span class="nb">incr</span> pos
<span class="k">}</span>
<span class="nb">puts</span> <span class="nv">$text</span>
<span class="c"># =&gt; This Is A Long Line</span>

<span class="c"># capitalize each word&#39;s first character, downcase the rest</span>
<span class="c"># (another solution)</span>
<span class="k">foreach</span> word <span class="s2">&quot;thIS is a loNG liNE&quot;</span> <span class="k">{</span>
    <span class="nb">lappend</span> words <span class="k">[</span><span class="nb">string</span> totitle <span class="nv">$word</span><span class="k">]</span>
<span class="k">}</span>
<span class="nb">puts</span> <span class="nv">$words</span>
<span class="c"># =&gt; This Is A Long Line</span>


<span class="c"># case insensitive string comparison</span>
<span class="nb">string</span> equal <span class="o">-</span>nocase foo Foo
<span class="c"># =&gt; 1</span>


<span class="c"># randcap: filter to randomly capitalize 20% of the letters</span>
<span class="k">set</span> text <span class="k">{</span>
<span class="nv">001</span><span class="o">:</span><span class="mo">001</span> In the beginning God created the heaven and the earth.
<span class="nv">001</span><span class="o">:</span><span class="mo">002</span> And the earth was without form<span class="err">,</span> and void<span class="k">;</span> <span class="nv">and</span> darkness was
        <span class="nv">upon</span> the face of the deep. And the spirit of God moved upon
        <span class="nv">the</span> face of the waters.
<span class="nv">001</span><span class="o">:</span><span class="mo">003</span> And God said<span class="err">,</span> let there be light: and there was light.
<span class="k">}</span>
<span class="k">set</span> pos <span class="mi">0</span>
<span class="k">while</span> <span class="k">{[</span><span class="nb">regexp</span> <span class="o">-</span>indices <span class="o">-</span>start <span class="nv">$pos</span> <span class="k">{(</span><span class="err">\</span><span class="nv">w</span><span class="k">)}</span> <span class="nv">$text</span> where<span class="k">]}</span> <span class="k">{</span>
    <span class="k">foreach</span> <span class="k">{</span><span class="nv">first</span> last<span class="k">}</span> <span class="nv">$where</span> break
    <span class="k">if</span> <span class="k">{</span><span class="nv">rand</span><span class="k">()</span><span class="o">&lt;=</span><span class="mf">0.2</span><span class="k">}</span> <span class="k">{</span>
        <span class="k">set</span> text <span class="k">[</span><span class="nb">string</span> toupper <span class="nv">$text</span> <span class="nv">$first</span><span class="k">]</span>
    <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
        <span class="k">set</span> text <span class="k">[</span><span class="nb">string</span> tolower <span class="nv">$text</span> <span class="nv">$first</span><span class="k">]</span>
    <span class="k">}</span>
    <span class="k">set</span> pos <span class="nv">$last</span>
    <span class="nb">incr</span> pos
<span class="k">}</span>
<span class="nb">puts</span> <span class="nv">$text</span>
<span class="c"># =&gt; </span>
<span class="c"># =&gt;         001:001 iN The begInNing god crEaTed tHe HeAven And thE earTh.</span>
<span class="c"># =&gt; </span>
<span class="c"># =&gt;         001:002 and tHe earth was wiThout form, aNd void; and darknESs Was</span>
<span class="c"># =&gt;                 upOn tHe faCe OF the deep. and the sPirIt Of goD moved upOn</span>
<span class="c"># =&gt;                 the fACE oF the wATers.</span>
<span class="c"># =&gt; </span>
<span class="c"># =&gt;         001:003 AnD goD said, lEt there be light: aND there wAs LighT.</span>
<span class="c"># =&gt;         </span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN44"
>Interpolating Functions and Expressions Within Strings</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>

<span class="c"># Interpolating functions and expressions within strings</span>
<span class="k">set</span> var1 Tool
<span class="k">proc</span> func <span class="k">{</span><span class="nv">s</span><span class="k">}</span> <span class="k">{</span><span class="nb">string</span> totitle <span class="nv">$s</span><span class="k">}</span>
<span class="k">set</span> var2 Language
<span class="k">set</span> answer <span class="s2">&quot;$var1 [func command] $var2&quot;</span>
<span class="c"># =&gt; Tool Command Language</span>


<span class="k">set</span> n <span class="mi">5</span>
<span class="k">set</span> phrase <span class="s2">&quot;I have [expr {$n + 1}] guanacos.&quot;</span>
<span class="c"># =&gt; I have 6 guanacos.</span>


<span class="k">set</span> rec foo:bar:baz
<span class="nb">interp</span> alias <span class="k">{}</span> some_cmd <span class="k">{}</span> join
<span class="nv">some_cmd</span> <span class="s2">&quot;What you want is [llength [split $rec :]] items&quot;</span>
<span class="c"># =&gt; What you want is 3 items</span>


<span class="k">set</span> text <span class="k">{</span>
<span class="nv">To</span><span class="o">:</span> <span class="nv">$naughty</span>
<span class="nv">From</span><span class="o">:</span> Your Bank
<span class="nv">Cc</span><span class="o">:</span> <span class="k">[</span><span class="nv">getManagerList</span> <span class="nv">$naughty</span><span class="k">]</span>
<span class="nv">Date</span><span class="o">:</span> <span class="k">[</span><span class="nb">clock</span> format <span class="k">[</span><span class="nb">clock</span> seconds<span class="k">]]</span> <span class="k">(</span><span class="nv">today</span><span class="k">)</span>
<span class="nv">Dear</span> <span class="nv">$naughty</span><span class="err">,</span>
<span class="nv">Today</span><span class="err">,</span> you bounced check number <span class="k">[expr</span> <span class="k">{</span><span class="nv">500</span> <span class="o">+</span> int<span class="k">(</span><span class="nv">rand</span><span class="k">()</span><span class="o">*</span><span class="mi">100</span><span class="k">)}]</span> to us.
<span class="nv">Your</span> account is now closed.
<span class="nv">Sincerely</span><span class="err">,</span>
<span class="nv">the</span> management
<span class="k">}</span>
<span class="k">if</span> <span class="k">{</span><span class="o">!</span><span class="k">[</span><span class="nv">sendMail</span> <span class="nv">$text</span> <span class="nv">$target</span><span class="k">]}</span> <span class="k">{</span>
    <span class="k">error</span> <span class="s2">&quot;Couldn&#39;t send mail&quot;</span>
<span class="k">}</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN47"
>Indenting Here Documents</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>

<span class="c"># all in one</span>
<span class="nb">regsub</span> <span class="o">-</span>line <span class="o">-</span>all <span class="k">{</span><span class="o">^</span><span class="err">\</span><span class="nv">s</span><span class="o">+</span><span class="k">}</span> <span class="k">{</span>
    <span class="nv">your</span> text
    <span class="nv">goes</span> here
<span class="k">}</span> <span class="k">{}</span> var
<span class="nb">format</span> <span class="o">%</span>s <span class="err">\</span>n<span class="nv">$var</span>
<span class="c"># =&gt; </span>
<span class="c"># =&gt; your text</span>
<span class="c"># =&gt; goes here</span>


<span class="c"># or with two steps</span>
<span class="k">set</span> var <span class="k">{</span>
    <span class="nv">your</span> text
    <span class="nv">goes</span> here
<span class="k">}</span>
<span class="nb">regsub</span> <span class="o">-</span>line <span class="o">-</span>all <span class="k">{</span><span class="o">^</span><span class="err">\</span><span class="nv">s</span><span class="o">+</span><span class="k">}</span> <span class="nv">$var</span> <span class="k">{}</span> var
<span class="nb">format</span> <span class="o">%</span>s <span class="err">\</span>n<span class="nv">$var</span>
<span class="c"># =&gt; </span>
<span class="c"># =&gt; your text</span>
<span class="c"># =&gt; goes here</span>

<span class="c"># one more time</span>
<span class="nb">regsub</span> <span class="o">-</span>line <span class="o">-</span>all <span class="k">{</span><span class="o">^</span><span class="err">\</span><span class="nv">s</span><span class="o">+</span><span class="k">}</span> <span class="k">{</span>
    <span class="nv">The</span> five varieties of camelids
    <span class="nv">are</span> the familiar camel<span class="err">,</span> his friends
    <span class="nv">the</span> llama and the alpaca<span class="err">,</span> and the
    <span class="nv">rather</span> less well-known guanaco
    <span class="nv">and</span> vicu<span class="err">Ñ</span>a.
<span class="k">}</span> <span class="k">{}</span> definition
<span class="c"># =&gt; 6</span>


<span class="k">proc</span> fix <span class="k">{</span><span class="nb">string</span><span class="k">}</span> <span class="k">{</span>
    <span class="nb">regsub</span> <span class="o">-</span>line <span class="o">-</span>all <span class="k">{</span><span class="o">^</span><span class="err">\</span><span class="nv">s</span><span class="o">+</span><span class="k">}</span> <span class="nv">$string</span> <span class="k">{}</span> string
    <span class="k">return</span> <span class="nv">$string</span>
<span class="k">}</span>

<span class="nv">fix</span> <span class="k">{</span>
    <span class="nv">My</span> stuff goes here
<span class="k">}</span>
<span class="c"># =&gt; My stuff goes here</span>


<span class="c"># the end-of-string right brace doesn&#39;t have to be flush left</span>
<span class="nb">regsub</span> <span class="o">-</span>line <span class="o">-</span>all <span class="k">{</span><span class="o">^</span><span class="err">\</span><span class="nv">s</span><span class="o">+</span><span class="k">}</span> <span class="k">{</span>
    <span class="nv">...we</span> will have peace<span class="err">,</span> when you and all your works have
    <span class="nv">perished--and</span> the works of your dark master to whom you would
    <span class="nv">deliver</span> us. You are a liar<span class="err">,</span> Saruman<span class="err">,</span> and a corrupter of men<span class="err">&#39;</span>s
    <span class="nv">hearts.</span>  <span class="o">--</span>Theoden <span class="ow">in</span> <span class="o">/</span>usr<span class="o">/</span>src<span class="o">/</span>perl<span class="o">/</span>taint.c
                         <span class="k">}</span> <span class="k">{}</span> quote       <span class="k">;</span><span class="c"># &lt;-- looki looki</span>
<span class="c"># move attribution to line of its own</span>
<span class="nb">regsub</span> <span class="k">{</span><span class="err">\</span><span class="nv">s</span><span class="o">+--</span><span class="k">}</span> <span class="nv">$quote</span> <span class="err">\</span>n-- quote
<span class="nb">format</span> <span class="o">%</span>s <span class="err">\</span>n<span class="nv">$quote</span>
<span class="c"># =&gt; </span>
<span class="c"># =&gt; ...we will have peace, when you and all your works have</span>
<span class="c"># =&gt; perished--and the works of your dark master to whom you would</span>
<span class="c"># =&gt; deliver us. You are a liar, Saruman, and a corrupter of men&#39;s</span>
<span class="c"># =&gt; hearts.</span>
<span class="c"># =&gt; --Theoden in /usr/src/perl/taint.c</span>

<span class="k">proc</span> rememberTheMain <span class="k">{}</span> <span class="k">{</span>
    <span class="nv">dequote</span> <span class="k">{</span>
        <span class="err">@@@</span> <span class="nv">int</span>
        <span class="err">@@@</span> <span class="nv">runops</span><span class="k">()</span> <span class="k">{</span>
        <span class="err">@@@</span>     <span class="nv">SAVEI32</span><span class="k">(</span><span class="nv">runlevel</span><span class="k">);</span>
        <span class="err">@@@</span>     <span class="nv">runlevel</span><span class="o">++</span><span class="k">;</span>
        <span class="err">@@@</span>     <span class="k">while</span> <span class="k">(</span> <span class="nv">op</span> <span class="err">=</span> <span class="k">(</span><span class="o">*</span><span class="nv">op-</span><span class="o">&gt;</span>op_ppaddr<span class="k">)()</span> <span class="k">)</span> <span class="k">;</span>
        <span class="err">@@@</span>     <span class="nv">TAINT_NOT</span><span class="k">;</span>
        <span class="err">@@@</span>     <span class="k">return</span> <span class="mi">0</span><span class="k">;</span>
        <span class="err">@@@</span> <span class="k">}</span>
    <span class="k">}</span>
    <span class="c"># add more code here if you want</span>
<span class="k">}</span>
 
<span class="k">proc</span> roadGoesEverOn <span class="k">{}</span> <span class="k">{</span>
    <span class="nv">dequote</span> <span class="k">{</span>
       <span class="nv">Now</span> far ahead the Road has gone<span class="err">,</span>
          <span class="nv">And</span> I must follow<span class="err">,</span> if I can<span class="err">,</span>
       <span class="nv">Pursuing</span> it with eager feet<span class="err">,</span>
          <span class="nv">Until</span> it joins some larger way
       <span class="nv">Where</span> many paths and errands meet.
          <span class="nv">And</span> whither <span class="k">then</span><span class="o">?</span> I cannot say.
                <span class="nv">--Bilbo</span> <span class="ow">in</span> <span class="o">/</span>usr<span class="o">/</span>src<span class="o">/</span>perl<span class="o">/</span>pp_ctl.c
    <span class="k">}</span>
<span class="k">}</span>
<span class="k">proc</span> quotemeta <span class="k">{</span><span class="nb">string</span><span class="k">}</span> <span class="k">{</span>
    <span class="nb">regsub</span> <span class="o">-</span>all <span class="k">{(</span><span class="err">\</span><span class="nv">W</span><span class="k">)}</span> <span class="nv">$string</span> <span class="k">{</span><span class="err">\\\</span><span class="nv">1</span><span class="k">}</span> string
    <span class="k">return</span> <span class="nv">$string</span>
<span class="k">}</span>
<span class="k">proc</span> dequote <span class="k">{</span><span class="nv">text</span><span class="k">}</span> <span class="k">{</span>
    <span class="k">if</span> <span class="k">{[</span><span class="nb">regexp</span> <span class="o">-</span>line <span class="k">{</span><span class="o">^</span><span class="err">\</span><span class="nv">s</span><span class="o">*</span><span class="k">(</span><span class="o">?:</span><span class="k">([</span><span class="o">^</span><span class="err">\</span><span class="nv">w</span><span class="err">\</span>s<span class="k">]</span><span class="o">+</span><span class="k">)(</span><span class="err">\</span><span class="nv">s</span><span class="o">*</span><span class="k">)</span><span class="nv">.</span><span class="o">*</span><span class="err">\</span>n<span class="k">)(</span><span class="o">?:</span><span class="err">\</span><span class="nv">s</span><span class="o">*</span><span class="err">\</span><span class="mi">1</span><span class="err">\</span><span class="mi">2</span><span class="o">?</span>.<span class="o">*</span><span class="err">\</span>n<span class="k">)</span><span class="o">+</span><span class="k">(</span><span class="o">?:</span><span class="err">\</span><span class="nv">s</span><span class="o">*</span><span class="k">)</span><span class="err">$</span><span class="k">}</span> <span class="nv">$text</span> m <span class="mi">1</span> <span class="mi">2</span><span class="k">]}</span> <span class="k">{</span>
        <span class="k">set</span> white <span class="nv">$2</span>
        <span class="k">set</span> leader <span class="k">[</span><span class="nv">quotemeta</span> <span class="nv">$1</span><span class="k">]</span>
    <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
        <span class="nb">regexp</span> <span class="o">-</span>line <span class="k">{</span><span class="o">^</span><span class="err">\</span><span class="nv">n</span><span class="o">?</span><span class="k">(</span><span class="err">\</span><span class="nv">s</span><span class="o">+</span><span class="k">)}</span> <span class="nv">$text</span> m white
        <span class="k">set</span> leader <span class="k">{}</span>
    <span class="k">}</span>
    <span class="nb">regsub</span> <span class="o">-</span>line <span class="o">-</span>all <span class="o">^</span><span class="err">\\</span>s<span class="o">*?</span><span class="nv">$leader</span><span class="err">\</span><span class="k">(</span><span class="o">?:</span><span class="nv">$white</span><span class="err">\</span><span class="k">)</span> <span class="nv">$text</span> <span class="k">{}</span> text
    <span class="k">return</span> <span class="k">[</span><span class="nb">string</span> trimright <span class="nv">$text</span><span class="k">]</span><span class="err">\</span>n
<span class="k">}</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN50"
>Reformatting Paragraphs</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>

<span class="c"># The tcllib 1.0 textutil module can adjust text</span>
<span class="c"># to a specified line length, justify left, right,</span>
<span class="c"># and plain, and fill lines to the right margin.</span>
<span class="c"># However, it can&#39;t add indentation.</span>



<span class="c"># A naive implementation of wrap.  Arguments:</span>
<span class="c"># text	the text</span>
<span class="c"># col	the line length (default 72)</span>
<span class="c"># lead	first line indentation (def empty string)</span>
<span class="c"># follow	indentation for following lines (def empty string)</span>
<span class="k">proc</span> wrap <span class="k">{</span><span class="nv">text</span> <span class="k">{</span><span class="nv">col</span> <span class="mi">72</span><span class="k">}</span> <span class="k">{</span><span class="nv">lead</span> <span class="k">{}}</span> <span class="k">{</span><span class="nv">follow</span> <span class="k">{}}}</span> <span class="k">{</span>
    <span class="k">set</span> newtext <span class="k">{}</span>
    <span class="k">set</span> text <span class="nv">$lead</span><span class="k">[</span><span class="nb">string</span> trimleft <span class="nv">$text</span><span class="k">]</span>
    <span class="k">set</span> upto <span class="nv">$col</span>
    <span class="k">while</span> <span class="k">{</span><span class="o">!</span><span class="k">[</span><span class="nb">string</span> is wordchar <span class="k">[</span><span class="nb">string</span> index <span class="nv">$text</span> <span class="nv">$upto</span><span class="k">]]}</span> <span class="k">{</span><span class="nb">incr</span> upto <span class="o">-</span><span class="mi">1</span><span class="k">}</span>
    <span class="k">set</span> upto <span class="k">[</span><span class="nb">string</span> wordstart <span class="nv">$text</span> <span class="nv">$upto</span><span class="k">]</span>
    <span class="k">if</span> <span class="k">{</span><span class="nv">$upto</span> <span class="o">==</span> <span class="nv">0</span><span class="k">}</span> <span class="k">{</span>
        <span class="k">set</span> upto <span class="k">[</span><span class="nb">string</span> wordend <span class="nv">$text</span> <span class="nv">$upto</span><span class="k">]</span>
    <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
        <span class="nb">incr</span> upto <span class="o">-</span><span class="mi">1</span>
    <span class="k">}</span>
    <span class="nb">append</span> newtext <span class="k">[</span><span class="nb">string</span> range <span class="nv">$text</span> <span class="mi">0</span> <span class="nv">$upto</span><span class="k">]</span><span class="err">\</span>n
    <span class="k">set</span> text <span class="k">[</span><span class="nb">string</span> replace <span class="nv">$text</span> <span class="mi">0</span> <span class="nv">$upto</span><span class="k">]</span>
    <span class="k">while</span> <span class="k">{[</span><span class="nb">string</span> length <span class="nv">$text</span><span class="k">]}</span> <span class="k">{</span>
        <span class="k">set</span> text <span class="nv">$follow</span><span class="k">[</span><span class="nb">string</span> trimleft <span class="nv">$text</span><span class="k">]</span>
        <span class="k">if</span> <span class="k">{[</span><span class="nb">string</span> length <span class="nv">$text</span><span class="k">]</span> <span class="o">&gt;</span> <span class="nv">$col</span><span class="k">}</span> <span class="k">{</span>
            <span class="k">set</span> upto <span class="nv">$col</span>
            <span class="k">while</span> <span class="k">{</span><span class="o">!</span><span class="k">[</span><span class="nb">string</span> is wordchar <span class="k">[</span><span class="nb">string</span> index <span class="nv">$text</span> <span class="nv">$upto</span><span class="k">]]}</span> <span class="k">{</span><span class="nb">incr</span> upto <span class="o">-</span><span class="mi">1</span><span class="k">}</span>
            <span class="k">set</span> upto <span class="k">[</span><span class="nb">string</span> wordstart <span class="nv">$text</span> <span class="nv">$upto</span><span class="k">]</span>
            <span class="k">if</span> <span class="k">{</span><span class="nv">$upto</span> <span class="o">==</span> <span class="nv">0</span><span class="k">}</span> <span class="k">{</span>
                <span class="k">set</span> upto <span class="k">[</span><span class="nb">string</span> wordend <span class="nv">$text</span> <span class="nv">$upto</span><span class="k">]</span>
            <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                <span class="nb">incr</span> upto <span class="o">-</span><span class="mi">1</span>
            <span class="k">}</span>
            <span class="nb">append</span> newtext <span class="k">[</span><span class="nb">string</span> range <span class="nv">$text</span> <span class="mi">0</span> <span class="nv">$upto</span><span class="k">]</span><span class="err">\</span>n
            <span class="k">set</span> text <span class="k">[</span><span class="nb">string</span> replace <span class="nv">$text</span> <span class="mi">0</span> <span class="nv">$upto</span><span class="k">]</span>
        <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
            <span class="nb">append</span> newtext <span class="nv">$text</span>
            <span class="k">set</span> text <span class="k">{}</span>
        <span class="k">}</span>       
    <span class="k">}</span>
    <span class="k">return</span> <span class="nv">$newtext</span>
<span class="k">}</span>

<span class="k">set</span> input <span class="k">{</span><span class="s2">&quot;Folding and splicing is the work of an editor,&quot;</span>
      <span class="s2">&quot;not a mere collection of silicon&quot;</span>
      <span class="s2">&quot;and&quot;</span>
      <span class="s2">&quot;mobile electrons!&quot;</span><span class="k">}</span>
<span class="nb">append</span> res <span class="err">\</span>n <span class="k">[</span><span class="nb">string</span> repeat <span class="mo">01234567</span><span class="mi">89</span> <span class="mi">2</span><span class="k">]</span> <span class="err">\</span>n
<span class="nb">append</span> res <span class="k">[</span><span class="nv">wrap</span> <span class="k">[</span><span class="nb">join</span> <span class="nv">$input</span><span class="k">]</span> <span class="mi">20</span> <span class="k">{</span>    <span class="k">}</span> <span class="k">{</span>  <span class="k">}]</span> <span class="err">\</span>n
<span class="c"># =&gt; </span>
<span class="c"># =&gt; 01234567890123456789</span>
<span class="c"># =&gt;     Folding and </span>
<span class="c"># =&gt;   splicing is the </span>
<span class="c"># =&gt;   work of an </span>
<span class="c"># =&gt;   editor, not a </span>
<span class="c"># =&gt;   mere collection </span>
<span class="c"># =&gt;   of silicon and </span>
<span class="c"># =&gt;   mobile electrons!</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN53"
>Escaping Characters</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c"></span>

<span class="c"># backslash</span>
<span class="nb">regsub</span> <span class="o">-</span>all <span class="k">(</span><span class="err">\</span><span class="k">[</span><span class="nv">$charlist</span><span class="k">])</span> <span class="nv">$var</span> <span class="k">{</span><span class="err">\\\</span><span class="nv">1</span><span class="k">}</span> var


<span class="c"># double</span>
<span class="nb">regsub</span> <span class="o">-</span>all <span class="k">(</span><span class="err">\</span><span class="k">[</span><span class="nv">$charlist</span><span class="k">])</span> <span class="nv">$var</span> <span class="k">{</span><span class="err">\</span><span class="nv">1</span><span class="err">\</span><span class="mi">1</span><span class="k">}</span> var


<span class="k">set</span> string <span class="k">{</span><span class="nv">Mom</span> said<span class="err">,</span> <span class="s2">&quot;Don&#39;t do that.&quot;</span><span class="k">}</span>
<span class="nb">regsub</span> <span class="o">-</span>all <span class="k">{([</span><span class="err">&#39;</span><span class="s2">&quot;])} $string {\\\1} string</span>
<span class="s2">puts $string</span>
<span class="s2"># =&gt; Mom said, \&quot;Don\&#39;t do that.\&quot;</span>

<span class="s2">set string {Mom said, &quot;</span><span class="nv">Don</span><span class="err">&#39;</span>t do that.<span class="s2">&quot;}</span>
<span class="s2">regsub -all {([&#39;&quot;])} $string {\1\1} string</span>
<span class="s2">puts $string</span>
<span class="s2"># =&gt; Mom said, &quot;&quot;Don&#39;&#39;t do that.&quot;&quot;</span>

<span class="s2">set string {Mom said, &quot;</span>Don<span class="err">&#39;</span>t do that.<span class="s2">&quot;}</span>
<span class="s2">regsub -all {([^A-Z])} $string {\\\1} string    ;# or: ([^[:upper:]])</span>
<span class="s2">puts $string</span>
<span class="s2"># =&gt; M\o\m\ \s\a\i\d\,\ \&quot;D\o\n\&#39;\t\ \d\o\ \t\h\a\t\.\&quot;</span>

<span class="s2">regsub -all {([^[:alnum:]])} &quot;</span>is a test<span class="o">!</span><span class="s2">&quot; {\\\1} string</span>
<span class="s2">puts &quot;</span>this <span class="nv">$string</span><span class="s2">&quot;</span>
<span class="s2"># =&gt; this is\ a\ test\!</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN56"
>Trimming Blanks from the Ends of a String</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s2"></span>

<span class="s2">string trim &quot;</span><span class="err">\</span>n<span class="err">\</span>t Tcl <span class="err">\</span>t<span class="err">\</span>n<span class="s2">&quot;</span>
<span class="s2"># =&gt; Tcl</span>


<span class="s2">set string {</span>
<span class="s2">    foo bar</span>
<span class="s2">    baz</span>
<span class="s2">    </span>
<span class="s2">}</span>
<span class="s2">set res [list]</span>
<span class="s2">foreach {s} [split $string \n] {</span>
<span class="s2">    lappend res [string trim $s]</span>
<span class="s2">}</span>
<span class="s2">string trim [join $res]</span>
<span class="s2"># =&gt; foo bar baz</span>


<span class="s2"># The [gets] (get string) command always strips off the EOL</span>
<span class="s2"># sequence, be it CR, LF, or CRLF (configurable for the stream).</span>

<span class="s2"># Anyway, if you have a string that *might* have one or more</span>
<span class="s2"># \n characters at the end, and in case it does, you want to</span>
<span class="s2"># remove them:</span>



<span class="s2">string trimright &quot;</span>foo bar<span class="err">\</span>n<span class="err">\</span>n<span class="s2">&quot; \n</span>
<span class="s2"># =&gt; foo bar</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN59"
>Parsing Comma-Separated Data</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s2"></span>

<span class="s2"># csv is a part of the standard ActiveTcl distribution</span>
<span class="s2">package require csv</span>
<span class="s2">set line {XYZZY,,&quot;</span>O<span class="err">&#39;</span>Reilly<span class="err">,</span> Inc<span class="s2">&quot;,&quot;</span>Wall<span class="err">,</span> Larry<span class="s2">&quot;,&quot;</span>a <span class="s2">&quot;&quot;</span>glug<span class="s2">&quot;&quot;</span> bit<span class="s2">&quot;,5,&quot;</span>Error<span class="err">,</span> Core Dumped<span class="s2">&quot;}</span>
<span class="s2">set fields [::csv::split $line]</span>
<span class="s2">set res {}</span>
<span class="s2">for {set i 0} {$i &lt; [llength $fields]} {incr i} {</span>
<span class="s2">    append res \n &quot;</span><span class="nv">$i</span> <span class="o">:</span> <span class="k">[</span><span class="nb">lindex</span> <span class="nv">$fields</span> <span class="nv">$i</span><span class="k">]</span><span class="s2">&quot;</span>
<span class="s2">}</span>
<span class="s2">puts $res</span>
<span class="s2"># =&gt; </span>
<span class="s2"># =&gt; 0 : XYZZY</span>
<span class="s2"># =&gt; 1 : </span>
<span class="s2"># =&gt; 2 : O&#39;Reilly, Inc</span>
<span class="s2"># =&gt; 3 : Wall, Larry</span>
<span class="s2"># =&gt; 4 : a &quot;</span>glug<span class="s2">&quot; bit</span>
<span class="s2"># =&gt; 5 : 5</span>
<span class="s2"># =&gt; 6 : Error, Core Dumped</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN62"
>Soundex Matching</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN65"
>Program: fixstyle</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s2"></span>

<span class="s2"># fixstyle - switch one set of strings to another set</span>
<span class="s2">#   usage: &lt;scriptname&gt; [-v] [files ...]</span>
<span class="s2">array set ::data {</span>
<span class="s2">    analysed         analyzed</span>
<span class="s2">    built-in         builtin</span>
<span class="s2">    chastized        chastised</span>
<span class="s2">    commandline      command-line</span>
<span class="s2">    de-allocate      deallocate</span>
<span class="s2">    dropin           drop-in</span>
<span class="s2">    hardcode         hard-code</span>
<span class="s2">    meta-data        metadata</span>
<span class="s2">    multicharacter   multi-character</span>
<span class="s2">    multiway         multi-way</span>
<span class="s2">    non-empty        nonempty</span>
<span class="s2">    non-profit       nonprofit</span>
<span class="s2">    non-trappable    nontrappable</span>
<span class="s2">    pre-define       predefine</span>
<span class="s2">    preextend        pre-extend</span>
<span class="s2">    re-compiling     recompiling</span>
<span class="s2">    reenter          re-enter</span>
<span class="s2">    turnkey          turn-key</span>
<span class="s2">}</span>
<span class="s2"> </span>
<span class="s2">set testtext {</span>
<span class="s2">    Yesterday we analysed the efficiency of the </span>
<span class="s2">    built-in thingummies and were considerably </span>
<span class="s2">    chastized by the results.  It seems that </span>
<span class="s2">    commandline invocation forced the </span>
<span class="s2">    whatchamacallit to de-allocate dropin </span>
<span class="s2">    maguffins.  First, we tested instead to </span>
<span class="s2">    hardcode meta-data -- especially when in </span>
<span class="s2">    multicharacter and multiway format</span>
<span class="s2">    (obviously only for non-empty data sets).  </span>
<span class="s2">    However, that turned out to be a non-profit </span>
<span class="s2">    improvement.  Dr Egnarts then demonstrated </span>
<span class="s2">    using non-trappable signals in pre-define </span>
<span class="s2">    mode to preextend save rates.  When </span>
<span class="s2">    re-compiling we saw the application reenter </span>
<span class="s2">    acceptable ratings on turnkey operations.</span>
<span class="s2">}</span>
<span class="s2"># verbose or non-verbose?</span>
<span class="s2">if {[llength $argv] &amp;&amp; [string equal [lindex $argv 0] -v]} {</span>
<span class="s2">    set ::verbose yes</span>
<span class="s2">    set argv [lrange $argv 1 end]</span>
<span class="s2">} else {</span>
<span class="s2">    set ::verbose no</span>
<span class="s2">}</span>
<span class="s2"># prepare text to be read</span>
<span class="s2">set text {}</span>
<span class="s2">if {[string match *test [info script]]} {</span>
<span class="s2">    # if we&#39;re running a test:</span>
<span class="s2">    set text $testtext</span>
<span class="s2">} else {</span>
<span class="s2">    # Try to assemble text from input.  Do we have arguments?</span>
<span class="s2">    if {[info exists argv]} {</span>
<span class="s2">        # Yes; try to open each and read contents:</span>
<span class="s2">        foreach {fn} [lrange $argv 0 end] {</span>
<span class="s2">            if {![catch {open $fn} chan]} {</span>
<span class="s2">                append text [read $chan]</span>
<span class="s2">                close $chan</span>
<span class="s2">            }</span>
<span class="s2">        }</span>
<span class="s2">    }</span>
<span class="s2">    if {![string length $text]} {</span>
<span class="s2">        # we still don&#39;t have any text; try standard input</span>
<span class="s2">        # (inform user first)</span>
<span class="s2">        if {[tell stdin] == -1} {</span>
<span class="s2">            puts stderr &quot;</span><span class="k">[</span><span class="nb">info</span> script<span class="k">]</span><span class="o">:</span> Reading from stdin<span class="s2">&quot;</span>
<span class="s2">        }</span>
<span class="s2">        set text [read stdin]</span>
<span class="s2">    }</span>
<span class="s2">}</span>
<span class="s2"> </span>
<span class="s2">proc fixstyle {text} {</span>
<span class="s2">    global data verbose</span>
<span class="s2">    set newtext [list]</span>
<span class="s2">    foreach w $text {</span>
<span class="s2">        if {[catch {set word $data($w)}]} {</span>
<span class="s2">            set word $w</span>
<span class="s2">        } else {</span>
<span class="s2">            if {$verbose} {</span>
<span class="s2">                puts stderr &quot;</span><span class="nv">$w</span> <span class="err">=</span><span class="o">&gt;</span> <span class="nv">$word</span><span class="s2">&quot;</span>
<span class="s2">            }</span>
<span class="s2">        }</span>
<span class="s2">        lappend newtext $word</span>
<span class="s2">    }</span>
<span class="s2">    return $newtext</span>
<span class="s2">}</span>
<span class="s2"> </span>
<span class="s2">fixstyle $text</span>
<span class="s2"># =&gt; Yesterday we analyzed the efficiency of the builtin thingummies and were considerably chastised by the results. It seems that command-line invocation forced the whatchamacallit to deallocate drop-in maguffins. First, we tested instead to hard-code metadata -- especially when in multi-character and multi-way format (obviously only for nonempty data sets). However, that turned out to be a nonprofit improvement. Dr Egnarts then demonstrated using nontrappable signals in predefine mode to pre-extend save rates. When recompiling we saw the application re-enter acceptable ratings on turn-key operations.</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN68"
>Program: psgrep</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="numbers.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>PLEAC-Tcl</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Numbers</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>