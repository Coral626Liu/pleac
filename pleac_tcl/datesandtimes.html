<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Dates and Times</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Tcl"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Numbers"
HREF="numbers.html"><LINK
REL="NEXT"
TITLE="Arrays"
HREF="arrays.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Tcl</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="numbers.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="arrays.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DATESANDTIMES"
>3. Dates and Times</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN132"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s2"></span>

<span class="s2"># A single command, [clock], is used for a wide range</span>
<span class="s2"># of date/time-related tasks.  Subcommands include</span>
<span class="s2"># seconds, which returns a seconds-since-epoch value,</span>
<span class="s2"># and format, which formats a date/time-string like</span>
<span class="s2"># the result of POSIX strftime.</span>



<span class="s2"># get current time in epoch seconds</span>
<span class="s2">set now [clock seconds]</span>
<span class="s2"># print default-formatted time</span>
<span class="s2">puts [clock format $now]</span>
<span class="s2"># print custom formatted time</span>
<span class="s2">set fmt &quot;Today is day %j of the current year.&quot;</span>
<span class="s2">puts [clock format $now -format $fmt]</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN135"
>Finding Today's Date</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s2"></span>

<span class="s2">set now [clock seconds]</span>
<span class="s2">foreach {day month year} [clock format $now -format &quot;%d %m %Y&quot;] break</span>

<span class="s2">set now [clock seconds]</span>
<span class="s2">set fmt &quot;%Y-%m-%d&quot;</span>
<span class="s2">puts &quot;The current date is [clock format $now -format $fmt].&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN138"
>Converting DMYHMS to Epoch Seconds</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s2"></span>

<span class="s2"># this is one of several possible variants of scannable</span>
<span class="s2"># date/time strings; clock scan is considerably more</span>
<span class="s2"># versatile than the Perl functions in this recipe.</span>
<span class="s2">set time [clock scan &quot;$hours:$min:$sec $year-$mon-$mday&quot;]</span>
<span class="s2"># =&gt; 999955820</span>


<span class="s2">set time [clock scan &quot;$hours:$min:$sec $year-$mon-$mday&quot; -gmt yes]</span>
<span class="s2"># =&gt; 999963020</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN141"
>Converting Epoch Seconds to DMYHMS</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s2"></span>

<span class="s2">if {[string match *.test [info script]]} {</span>
<span class="s2">    # we are testing, supply a known value</span>
<span class="s2">    set now 1000000000</span>
<span class="s2">} else {</span>
<span class="s2">    set now [clock seconds]</span>
<span class="s2">}</span>
<span class="s2">set vars [list seconds minutes hours dayOfMonth month year wday yday]</span>
<span class="s2">set desc [list S       M       H     d          m     Y    w    j]</span>
<span class="s2">foreach v $vars d $desc {</span>
<span class="s2">    set $v [clock format $now -format %$d]</span>
<span class="s2">}</span>
<span class="s2">format %s-%s-%sT%s:%s:%s $year $month $dayOfMonth $hours $minutes $seconds</span>
<span class="s2"># =&gt; 2001-09-09T03:46:40</span>


<span class="s2">if {[string match *.test [info script]]} {</span>
<span class="s2">    # we are testing, supply a known value</span>
<span class="s2">    set now 1000000000</span>
<span class="s2">} else {</span>
<span class="s2">    set now [clock seconds]</span>
<span class="s2">}</span>
<span class="s2">set vars [list seconds minutes hours dayOfMonth month year wday yday]</span>
<span class="s2">set desc [list S       M       H     d          m     Y    w    j]</span>
<span class="s2">foreach v $vars d $desc {</span>
<span class="s2">    set $v [clock format $now -format %$d -gmt yes]</span>
<span class="s2">}</span>
<span class="s2">format %s-%s-%sT%s:%s:%s $year $month $dayOfMonth $hours $minutes $seconds</span>
<span class="s2"># =&gt; 2001-09-09T01:46:40</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN144"
>Adding to or Subtracting from a Date</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s2"></span>

<span class="s2">#     set when [expr {$now + $difference}]</span>
<span class="s2">#     set when [expr {$now - $difference}]</span>

<span class="s2"># The following is slightly more idiomatic:</span>

<span class="s2">#     set when [clock scan &quot;$difference seconds&quot;]</span>
<span class="s2">#     set when [clock scan &quot;$difference seconds ago&quot;]</span>
<span class="s2">#     set when [clock scan &quot;-$difference seconds&quot;] ;# same as previous</span>



<span class="s2">set newTime [clock scan &quot;$y-$m-$d $offset days&quot;]</span>
<span class="s2">foreach {y2 m2 d2} [clock format $newTime -format &quot;%Y %m %d&quot;] break</span>
<span class="s2">return [list $y2 $m2 $d2]</span>


<span class="s2">set oldTime [clock scan $time]</span>
<span class="s2">set newTime [clock scan &quot;</span>
<span class="s2">    $daysOffset days</span>
<span class="s2">    $hourOffset hours</span>
<span class="s2">    $minuteOffset minutes</span>
<span class="s2">    $secondOffset seconds</span>
<span class="s2">&quot; -base $oldTime]</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN147"
>Difference of Two Dates</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s2"></span>

<span class="s2">set bree [clock scan &quot;16 Jun 1981 4:35:25&quot;]</span>
<span class="s2">set nat  [clock scan &quot;18 Jan 1973 3:45:50&quot;]</span>
<span class="s2">set difference [expr {$bree - $nat}]</span>
<span class="s2">format &quot;There were $difference seconds between Nat and Bree&quot;</span>
<span class="s2"># =&gt; There were 265333775 seconds between Nat and Bree</span>


<span class="s2">set bree [clock scan &quot;16 Jun 1981 4:35:25&quot;]</span>
<span class="s2">set nat  [clock scan &quot;18 Jan 1973 3:45:50&quot;]</span>
<span class="s2">set difference [expr {$bree - $nat}]</span>
<span class="s2">set vars    {seconds minutes hours days}</span>
<span class="s2">set factors {60      60      24    7}</span>
<span class="s2">foreach v $vars f $factors {</span>
<span class="s2">    set $v [expr {$difference % $f}]</span>
<span class="s2">    set difference [expr {($difference-[set $v]) / $f}]</span>
<span class="s2">}</span>
<span class="s2">set weeks $difference</span>
<span class="s2">format &quot;($weeks weeks, $days days, $hours:$minutes:$seconds)&quot;</span>
<span class="s2"># =&gt; (438 weeks, 4 days, 23:49:35)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN150"
>Day in a Week/Month/Year or Week Number</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s2"></span>

<span class="s2">set then [clock scan 6/16/1981]</span>
<span class="s2">set format {</span>
<span class="s2">%Y-%m-%d was a %A</span>
<span class="s2">in week number %W,</span>
<span class="s2">and day %j of the year.</span>
<span class="s2">}</span>
<span class="s2">clock format $then -format $format</span>
<span class="s2"># =&gt; </span>
<span class="s2"># =&gt;         1981-06-16 was a Tuesday</span>
<span class="s2"># =&gt;         in week number 24,</span>
<span class="s2"># =&gt;         and day 167 of the year.</span>
<span class="s2"># =&gt;         </span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN153"
>Parsing Dates and Times from Strings</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s2"></span>

<span class="s2"># The [clock scan] command parses a wide variety of date/time</span>
<span class="s2"># strings, converting them to epoch seconds.</span>

<span class="s2"># Examples:</span>

<span class="s2">#     set t [clock scan &quot;1998-06-03&quot;]</span>
<span class="s2">#     set t [clock scan &quot;2 weeks ago Friday&quot;]</span>
<span class="s2">#     set t [clock scan &quot;today&quot;]</span>

<span class="s2">#     # second Sunday of 1996:</span>
<span class="s2">#     set t [clock scan &quot;Sunday&quot; -base [clock scan &quot;1996-01-01 1 week&quot;]]</span>

<span class="s2"># The result can be converted to lists of year, month, etc</span>
<span class="s2"># values or to other date/time strings by the [clock format]</span>
<span class="s2"># command.</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN156"
>Printing a Date</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s2"></span>

<span class="s2">puts [clock format [clock scan 01/18/73] -gmt yes]</span>
<span class="s2"># =&gt; Wed Jan 17 23:00:00 GMT 1973</span>

<span class="s2">puts [clock format [clock scan 01/18/73] -format &quot;%A %D&quot;]</span>
<span class="s2"># =&gt; Thursday 01/18/73</span>

<span class="s2">set format &quot;%a %b %e %H:%M:%S %Z %Y&quot;</span>
<span class="s2">puts [clock format [clock scan &quot;18 Jan 1973 3:45:50 GMT&quot;] -format $format -gmt yes]</span>
<span class="s2"># =&gt; Thu Jan 18 03:45:50 GMT 1973</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN159"
>High-Resolution Timers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s2"></span>

<span class="s2">puts &quot;Press return when ready&quot;</span>
<span class="s2">set before [clock clicks -milliseconds]</span>
<span class="s2">gets stdin</span>
<span class="s2">set elapsed [expr {([clock clicks -milliseconds] - $before) / 1000.0}]</span>
<span class="s2">puts &quot;You took $elapsed seconds&quot;</span>

<span class="s2">set size 500</span>
<span class="s2">set numberOfTimes 100</span>
<span class="s2">set a [list]</span>
<span class="s2">for {set j 0} {$j &lt; $size} {incr j} {</span>
<span class="s2">    lappend a [expr {rand()}]</span>
<span class="s2">}</span>
<span class="s2">puts &quot;Sorting $size random numbers:&quot;</span>
<span class="s2">puts [time {</span>
<span class="s2">    set a [lsort -real $a]</span>
<span class="s2">} $numberOfTimes]</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN162"
>Short Sleeps</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s2"></span>

<span class="s2"># wait 25 milliseconds</span>
<span class="s2">after 25</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN165"
>Program: hopdelta</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="s2"></span><span class="s2"># @@INCOMPLETE@@</span>
<span class="s2"># @@INCOMPLETE@@</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="numbers.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="arrays.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Numbers</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Arrays</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>