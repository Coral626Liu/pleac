<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=latin1">
  <style type="text/css">
td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }
body .hll { background-color: #ffffcc }
body  { background: #f8f8f8; }
body .c { color: #408080; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #008000; font-weight: bold } /* Keyword */
body .o { color: #666666 } /* Operator */
body .cm { color: #408080; font-style: italic } /* Comment.Multiline */
body .cp { color: #BC7A00 } /* Comment.Preproc */
body .c1 { color: #408080; font-style: italic } /* Comment.Single */
body .cs { color: #408080; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #FF0000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #00A000 } /* Generic.Inserted */
body .go { color: #888888 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #008000 } /* Keyword.Pseudo */
body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #BA2121 } /* Literal.String */
body .na { color: #7D9029 } /* Name.Attribute */
body .nb { color: #008000 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #999999; font-weight: bold } /* Name.Entity */
body .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #A0A000 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #19177C } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sb { color: #BA2121 } /* Literal.String.Backtick */
body .sc { color: #BA2121 } /* Literal.String.Char */
body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #BA2121 } /* Literal.String.Double */
body .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #BA2121 } /* Literal.String.Heredoc */
body .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #BB6688 } /* Literal.String.Regex */
body .s1 { color: #BA2121 } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #008000 } /* Name.Builtin.Pseudo */
body .vc { color: #19177C } /* Name.Variable.Class */
body .vg { color: #19177C } /* Name.Variable.Global */
body .vi { color: #19177C } /* Name.Variable.Instance */
body .il { color: #666666 } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><pre><span class="c1">-- -*- haskell -*-</span>

<span class="c1">-- @@PLEAC@@_NAME</span>
<span class="c1">-- @@SKIP@@ Haskell</span>

<span class="c1">-- @@PLEAC@@_WEB</span>
<span class="c1">-- @@SKIP@@ http://www.haskell.org/</span>

<span class="c1">-- @@PLEAC@@_INTRO</span>
<span class="c1">-- @@SKIP@@ Many auxiliary functions can be found in appendix (Helpers).</span>
<span class="c1">-- @@SKIP@@ You need hugs98 or ghc (tested with 5.002) and the external library: </span>
<span class="c1">-- @@SKIP@@ http://www.dcs.gla.ac.uk/~meurig/regexp/</span>
<span class="c1">-- @@SKIP@@ The time section only work with ghc, s/--ghc // if you have ghc.</span>
<span class="c1">-- @@SKIP@@ You need to enable multi-parameter class and functionnal depedencies</span>
<span class="c1">-- @@SKIP@@  -98 with hugs, and -fglasgow-exts with ghc</span>

<span class="c1">-- @@PLEAC@@_APPENDIX</span>
<span class="kr">module</span> <span class="nn">Pleac</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="nn">Prelude</span> <span class="k">hiding</span> <span class="p">((</span><span class="o">$</span><span class="p">),(</span><span class="o">^</span><span class="p">),(</span><span class="o">.</span><span class="p">),(</span><span class="o">!!</span><span class="p">),</span><span class="nf">map</span><span class="p">,</span><span class="nf">take</span><span class="p">,</span><span class="nf">lookup</span><span class="p">,</span><span class="nf">drop</span><span class="p">,</span><span class="nf">splitAt</span><span class="p">,</span><span class="nf">reverse</span><span class="p">,</span><span class="nf">filter</span><span class="p">,</span><span class="nf">takeWhile</span><span class="p">,</span><span class="nf">dropWhile</span><span class="p">,</span><span class="nf">null</span><span class="p">,</span><span class="nf">foldl</span><span class="p">)</span>

<span class="kr">import</span> <span class="nn">Common</span>

<span class="c1">----------------------------------------------------------------------------------------------------</span>
<span class="c1">-- @@PLEAC@@_1.0</span>

<span class="nf">str</span>  <span class="ow">=</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">n&quot;</span>                             <span class="c1">-- two characters, \ and an n</span>
<span class="nf">str2</span> <span class="ow">=</span> <span class="s">&quot;Jon &#39;Maddog&#39; Orwant&quot;</span>             <span class="c1">-- in haskell we can do string only with &quot;, no single quote</span>
<span class="nf">str3</span> <span class="ow">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>                              <span class="c1">-- a &quot;newline&quot; character</span>
<span class="nf">str4</span> <span class="ow">=</span> <span class="s">&quot;Jon </span><span class="se">\&quot;</span><span class="s">Maddog</span><span class="se">\&quot;</span><span class="s"> Orwant&quot;</span>           <span class="c1">-- literal double quotes</span>
<span class="c1">-- no q/qq/qw/.. stuff in haskell</span>
<span class="c1">-- no multiline, you can emulate it with ++ and \n, or unlines</span>
<span class="nf">str5</span> <span class="ow">=</span> <span class="s">&quot;This is a multiline here document</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">++</span>
       <span class="s">&quot;terminated by  on a line by itself</span><span class="se">\n</span><span class="s">&quot;</span>


<span class="c1">-- @@PLEAC@@_1.1</span>
<span class="nf">s</span>     <span class="ow">=</span> <span class="s">&quot;This is what you have&quot;</span>
<span class="nf">first</span> <span class="ow">=</span> <span class="n">s</span><span class="o">!!</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                            <span class="c1">-- &quot;T&quot;</span>
<span class="nf">start</span> <span class="ow">=</span> <span class="n">s</span><span class="o">!!</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>                          <span class="c1">-- &quot;is&quot;</span>
<span class="nf">rest</span>  <span class="ow">=</span> <span class="n">s</span><span class="o">!!</span><span class="p">[</span><span class="mi">13</span><span class="o">..</span><span class="p">]</span>                         <span class="c1">-- &quot;you have&quot;</span>
<span class="nf">las</span>   <span class="ow">=</span> <span class="n">s</span><span class="o">!!</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>                           <span class="c1">-- &quot;e&quot;</span>
<span class="nf">las2</span>  <span class="ow">=</span> <span class="n">s</span><span class="o">.</span><span class="n">last</span>                            <span class="c1">-- &#39;e&#39;</span>
<span class="nf">end</span>   <span class="ow">=</span> <span class="n">s</span><span class="o">!!</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span> <span class="o">..</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>                     <span class="c1">-- &quot;have&quot;</span>
<span class="nf">piece</span> <span class="ow">=</span> <span class="n">s</span><span class="o">!!</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span> <span class="o">..</span> <span class="o">-</span><span class="mi">5</span><span class="p">]</span>                     <span class="c1">-- &quot;you&quot;</span>


<span class="p">[</span><span class="n">lead</span><span class="p">,</span><span class="n">ss1</span><span class="p">,</span><span class="n">ss2</span><span class="p">,</span><span class="n">trailing</span><span class="p">]</span>     <span class="ow">=</span> <span class="n">s</span><span class="o">.</span><span class="n">unpack</span> <span class="p">[</span><span class="kt">Grab</span> <span class="mi">2</span><span class="p">,</span> <span class="kt">Forward</span> <span class="mi">3</span><span class="p">,</span> <span class="kt">Grab</span> <span class="mi">1</span><span class="p">,</span> <span class="kt">Grab</span> <span class="mi">2</span><span class="p">,</span> <span class="kt">GrabAll</span><span class="p">]</span> 
<span class="c1">-- Regexp are better for this, why introduce extra concept (unpack)</span>
<span class="p">[</span><span class="n">lead2</span><span class="p">,</span><span class="n">ss12</span><span class="p">,</span><span class="n">ss22</span><span class="p">,</span><span class="n">trailing2</span><span class="p">]</span> <span class="ow">=</span> <span class="n">s</span><span class="o">.</span><span class="n">match</span> <span class="s">&quot;^(..)...(.)(..)(.*)&quot;</span>
<span class="p">[</span><span class="n">lead3</span><span class="p">,</span><span class="n">ss13</span><span class="p">,</span><span class="n">ss23</span><span class="p">,</span><span class="n">trailing3</span><span class="p">]</span> <span class="ow">=</span> <span class="n">s</span><span class="o">.</span><span class="n">match</span> <span class="s">&quot;^(.{2}).{3}(.)(.{2})(.*)&quot;</span> <span class="c1">-- just to show how to use repetition</span>

<span class="nf">fivers</span>                      <span class="ow">=</span> <span class="n">s</span><span class="o">.</span><span class="n">unpack</span> <span class="p">((</span><span class="kt">Grab</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">replicate</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">length</span> <span class="p">`</span><span class="n">div</span><span class="p">`</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1">-- in haskell string == [Char] =&gt; no need to do  unpack(&quot;A1&quot; x length($string), $string)</span>
<span class="nf">characters</span> <span class="ow">=</span> <span class="n">s</span>

<span class="c1">-- can&#39;t modify string in haskell</span>
<span class="nf">s&#39;</span>    <span class="ow">=</span> <span class="n">s</span><span class="o">.</span><span class="n">substr</span> <span class="mi">5</span> <span class="mi">2</span> <span class="s">&quot;wasn&#39;t&quot;</span>       <span class="c1">-- &quot;This wasn&#39;t what you have&quot;</span>
<span class="nf">s&#39;&#39;</span>   <span class="ow">=</span> <span class="n">s&#39;</span><span class="o">.</span><span class="n">substr2</span> <span class="p">(</span><span class="o">-</span><span class="mi">12</span><span class="p">)</span> <span class="s">&quot;ondrous&quot;</span>  <span class="c1">-- &quot;This wasn&#39;t wondrous&quot;,note the () arount negative number :(</span>
<span class="nf">s&#39;&#39;&#39;</span>  <span class="ow">=</span> <span class="n">s&#39;&#39;</span><span class="o">.</span><span class="n">substr</span> <span class="mi">0</span> <span class="mi">1</span> <span class="s">&quot;&quot;</span>           <span class="c1">-- &quot;his wasn&#39;t wondrous&quot;, delete first character &lt;=&gt; tail</span>
<span class="nf">s&#39;&#39;&#39;&#39;</span> <span class="ow">=</span> <span class="n">s&#39;&#39;&#39;</span><span class="o">.</span><span class="n">substr2</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span> <span class="s">&quot;&quot;</span>       <span class="c1">-- &quot;his wasn&#39;&quot;  ,delete last 10 characters &lt;=&gt; reverse . drop 10 . reverse</span>

<span class="nf">m</span>     <span class="ow">=</span> <span class="kr">if</span> <span class="n">s</span><span class="o">!!</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span> <span class="o">..</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=~</span> <span class="s">&quot;have&quot;</span> 
	<span class="kr">then</span> <span class="n">putStrLn</span> <span class="s">&quot;Pattern matches in last 10 characters&quot;</span> 
	<span class="kr">else</span> <span class="n">return</span> <span class="nb">()</span>
<span class="nf">m&#39;</span>    <span class="ow">=</span> <span class="n">putStrLn</span> <span class="s">&quot;Pattern matches in last 10 characters&quot;</span> <span class="p">`</span><span class="n">when</span><span class="p">`</span> <span class="p">(</span><span class="n">s</span><span class="o">!!</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span> <span class="o">..</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=~</span> <span class="s">&quot;have&quot;</span> <span class="p">)</span>

<span class="c1">-- cant do as short as in perl cos cant use affection in haskell</span>
<span class="nf">news</span> <span class="ow">=</span> <span class="n">s</span><span class="o">!!</span><span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="p">(</span><span class="n">substS</span> <span class="s">&quot;is&quot;</span> <span class="s">&quot;at&quot;</span> <span class="p">[</span><span class="kt">Global_Match</span><span class="p">])</span> <span class="o">++</span> <span class="n">s</span><span class="o">!!</span><span class="p">[</span><span class="mi">6</span><span class="o">..</span><span class="p">]</span> <span class="c1">-- &quot;That at what you have&quot;</span>

<span class="nf">a1</span>  <span class="ow">=</span> <span class="s">&quot;make a hat&quot;</span>
<span class="nf">a1&#39;</span> <span class="ow">=</span> <span class="n">a1</span><span class="o">!!</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">++</span> <span class="n">a1</span><span class="o">!!</span><span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="p">(</span><span class="n">a1</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span><span class="mi">2</span><span class="p">)]</span> <span class="o">++</span> <span class="n">a1</span><span class="o">!!</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">-- &quot;take a ham&quot;</span>

<span class="nf">b1</span> <span class="ow">=</span> <span class="s">&quot;to be or not to be&quot;</span>
<span class="nf">b2</span>      <span class="ow">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">unpack</span> <span class="p">[</span><span class="kt">Forward</span> <span class="mi">6</span><span class="p">,</span> <span class="kt">Grab</span> <span class="mi">6</span><span class="p">]</span>  <span class="c1">-- &quot;or not&quot;</span>
<span class="p">[</span><span class="n">b3</span><span class="p">,</span><span class="n">c3</span><span class="p">]</span> <span class="ow">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">unpack</span> <span class="p">[</span><span class="kt">Forward</span> <span class="mi">6</span><span class="p">,</span> <span class="kt">Grab</span> <span class="mi">2</span><span class="p">,</span> <span class="kt">Backward</span> <span class="mi">5</span><span class="p">,</span> <span class="kt">Grab</span> <span class="mi">2</span><span class="p">]</span> <span class="c1">-- [&quot;or&quot;,&quot;be&quot;]</span>

<span class="nf">cut2fmt</span> <span class="n">xs</span> <span class="ow">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">foldl</span> <span class="n">aux</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kt">[]</span><span class="p">)</span><span class="o">.</span><span class="n">snd</span><span class="o">.</span><span class="p">(</span><span class="kt">GrabAll:</span><span class="p">)</span><span class="o">.</span><span class="n">reverse</span> 
    <span class="kr">where</span> <span class="n">aux</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="n">i</span> <span class="ow">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,(</span><span class="kt">Grab</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">n</span><span class="p">))</span> <span class="kt">:</span> <span class="n">l</span><span class="p">)</span>
<span class="nf">fmt</span> <span class="ow">=</span> <span class="n">cut2fmt</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">30</span><span class="p">]</span> <span class="c1">-- [Grab 7,Grab 6,Grab 6,Grab 6,Grab 4,GrabAll]</span>


<span class="c1">-- @@PLEAC@@_1.2</span>

<span class="nf">v3</span> <span class="ow">=</span> <span class="s">&quot;a&quot;</span> <span class="o">|||</span> <span class="s">&quot;b&quot;</span> <span class="c1">-- -&gt; &quot;a&quot;</span>
<span class="nf">v4</span> <span class="ow">=</span> <span class="s">&quot;&quot;</span>  <span class="o">|||</span> <span class="s">&quot;b&quot;</span> <span class="c1">-- -&gt; &quot;b&quot;</span>

<span class="c1">-- force to put the type :(</span>
<span class="nf">v5</span> <span class="ow">=</span> <span class="p">(</span><span class="mi">2</span><span class="ow">::</span><span class="kt">Int</span><span class="p">)</span> <span class="o">&amp;&amp;&amp;</span> <span class="s">&quot;ee&quot;</span> <span class="c1">-- -&gt; &quot;ee&quot;</span>
<span class="nf">v6</span> <span class="ow">=</span> <span class="p">(</span><span class="mi">0</span><span class="ow">::</span><span class="kt">Int</span><span class="p">)</span> <span class="o">&amp;&amp;&amp;</span> <span class="s">&quot;ee&quot;</span> <span class="c1">-- -&gt; &quot;&quot;</span>

<span class="c1">-- no x ||= y</span>
<span class="nf">v3&#39;</span> <span class="ow">=</span> <span class="n">v3</span> <span class="o">|||</span> <span class="n">v4</span>

<span class="nf">dir</span>  <span class="ow">=</span> <span class="n">argv</span> <span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">x</span> <span class="o">|||</span> <span class="p">[</span><span class="s">&quot;/tmp&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">)</span>
<span class="nf">dir&#39;</span> <span class="ow">=</span> <span class="n">argv</span> <span class="o">&gt;&gt;&gt;</span> <span class="p">((</span><span class="o">|||</span> <span class="p">[</span><span class="s">&quot;/tmp&quot;</span><span class="p">])</span> <span class="o">$</span> <span class="n">head</span><span class="p">)</span> <span class="c1">-- or even more cryptic</span>

<span class="c1">-- @@PLEAC@@_1.3</span>
<span class="c1">-- no side effect in haskell =&gt; swap is a nosense</span>

<span class="c1">-- @@PLEAC@@_1.4</span>
<span class="nf">i1</span> <span class="ow">=</span> <span class="n">ord</span> <span class="n">&#39;a&#39;</span>
<span class="nf">c1</span> <span class="ow">=</span> <span class="n">chr</span> <span class="mi">97</span>

<span class="c1">-- ascii = string.unpack(&quot;C*&quot;), string = ascii.pack(&quot;C*&quot;), no need in haskell, String = [Char]</span>
<span class="c1">--  there is also packedString that are more efficient but less cool cos not list anymore</span>
<span class="nf">ibm</span> <span class="ow">=</span> <span class="s">&quot;HAL&quot;</span><span class="o">.</span><span class="n">map</span> <span class="n">next_char</span>                   <span class="c1">-- &quot;IBM&quot;</span>

<span class="c1">-- @@PLEAC@@_1.5</span>
<span class="nf">s1</span> <span class="ow">=</span> <span class="s">&quot;unique chars are: &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="s">&quot;an apple a day&quot;</span><span class="o">.</span><span class="n">unique</span><span class="o">.</span><span class="n">sort</span><span class="p">)</span>
<span class="nf">sum1</span> <span class="ow">=</span> <span class="p">(</span><span class="s">&quot;sum is &quot;</span> <span class="o">^</span> <span class="n">s1</span><span class="o">.</span><span class="n">map</span> <span class="n">ord</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span><span class="o">.</span><span class="n">putStrLn</span>

<span class="c1">-- TODO, script.hs HERE</span>


<span class="c1">-- @@PLEAC@@_1.6</span>
<span class="nf">s2</span> <span class="ow">=</span> <span class="n">s1</span><span class="o">.</span><span class="n">reverse</span>

<span class="c1">-- can do: s3 = (unwords . reverse . words) s1</span>
<span class="c1">--         s3 = (words $ reverse $ unwords) s1</span>
<span class="nf">s3</span> <span class="ow">=</span> <span class="n">s1</span><span class="o">.</span><span class="n">words</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">unwords</span> 

<span class="nf">s3&#39;</span> <span class="ow">=</span> <span class="n">s1</span><span class="o">.</span><span class="n">split</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">join</span> <span class="s">&quot; &quot;</span> <span class="c1">-- not the same, cos words = split &quot;\s+&quot;</span>
<span class="nf">s3&#39;&#39;</span><span class="ow">=</span> <span class="n">s1</span><span class="o">.</span><span class="n">split</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">s+&quot;</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">join</span> <span class="s">&quot; &quot;</span> 

<span class="c1">-- eval long_palindromes or long_palindromes &gt;&gt;= (mapM putStrLn)</span>
<span class="nf">long_palindromes</span> <span class="ow">=</span> <span class="n">cat</span> <span class="s">&quot;/usr/share/dict/words&quot;</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">filter</span><span class="p">(</span><span class="nf">\</span><span class="n">s</span> <span class="ow">-&gt;</span> <span class="n">s</span> <span class="o">==</span> <span class="n">s</span><span class="o">.</span><span class="n">reverse</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> 

<span class="c1">-- @@PLEAC@@_1.7</span>
<span class="c1">-- TODO, must do: \s if s == [] then [] else foldr1 .... ? must make a foldr1sure</span>
<span class="nf">expand_tabs</span> <span class="ow">=</span> <span class="n">split</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">$</span> <span class="p">(</span><span class="n">foldr1</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="o">++</span> <span class="p">(</span><span class="n">times</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="n">a</span><span class="o">.</span><span class="n">length</span> <span class="p">`</span><span class="n">mod</span><span class="p">`</span> <span class="mi">8</span><span class="p">)</span> <span class="sc">&#39; &#39;</span><span class="p">)</span> <span class="o">++</span> <span class="n">b</span><span class="p">))</span> <span class="c1">-- more efficient</span>
<span class="c1">-- expand_tabs = fixpoint (break_char &#39;\t&#39; (\a b -&gt; a ++ (&#39; &#39;.times (8 - a.length `mod` 8)) ++ b))</span>
				
<span class="c1">-- @@PLEAC@@_1.8</span>
<span class="c1">-- cant do eval in haskell, too meta, too reflexif</span>

<span class="nf">s4</span> <span class="ow">=</span> <span class="s">&quot;I am 17 years old&quot;</span><span class="o">.</span><span class="n">subst</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">d+&quot;</span> <span class="p">(</span><span class="nf">\</span><span class="n">n</span> <span class="ow">-&gt;</span> <span class="n">show</span> <span class="p">((</span><span class="n">read</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1">-- @@PLEAC@@_1.9</span>
<span class="nf">s5</span> <span class="ow">=</span> <span class="s">&quot;bo beep&quot;</span><span class="o">.</span><span class="n">upcase</span>
<span class="nf">s6</span> <span class="ow">=</span> <span class="n">s5</span><span class="o">.</span><span class="n">downcase</span>
<span class="nf">s7</span> <span class="ow">=</span> <span class="n">s6</span><span class="o">.</span><span class="n">capitalize</span>

<span class="nf">s8</span> <span class="ow">=</span> <span class="s">&quot;thIS is a loNG liNE&quot;</span><span class="o">.</span><span class="n">words</span><span class="o">.</span><span class="n">map</span> <span class="n">capitalize</span>

<span class="c1">-- @@PLEAC@@_1.10</span>
<span class="c1">-- s9 = &quot;I have &quot; ++ (show (10+1)) ++ &quot; guanacos.&quot;</span>
<span class="nf">s9</span> <span class="ow">=</span> <span class="s">&quot;I have &quot;</span><span class="o">^</span><span class="mi">10</span><span class="o">+</span><span class="mi">1</span><span class="o">^</span><span class="s">&quot; guanacos.&quot;</span>

<span class="c1">-- @@PLEAC@@_1.11</span>
<span class="c1">-- cant put lines at beginning of line cos of layout pb</span>
<span class="c1">-- Multi_line is to say that ^ match beginning of every line, not of the string</span>
<span class="nf">multi</span> <span class="ow">=</span> <span class="p">(</span><span class="n">substS</span> <span class="s">&quot;^</span><span class="se">\\</span><span class="s">s+&quot;</span> <span class="s">&quot;&quot;</span> <span class="p">[</span><span class="kt">Global_Match</span><span class="p">,</span><span class="kt">Multi_Line</span><span class="p">]</span> <span class="err">°</span> <span class="n">unlines</span><span class="p">)</span> <span class="p">[</span>
 <span class="s">&quot;       This is a multiline here document&quot;</span><span class="p">,</span>
 <span class="s">&quot;       terminated by nothing&quot;</span>
 <span class="p">]</span>

<span class="c1">-- @@PLEAC@@_1.12</span>
<span class="c1">-- in fact this fonction is wrong, cos it insert a space at the front of the sentence (must use a foldl1)</span>
<span class="nf">wrap</span> <span class="n">width</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">let</span> <span class="p">(</span><span class="n">all</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">words</span> <span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">foldl</span> <span class="p">(</span><span class="nf">\</span> <span class="p">(</span><span class="n">all</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="n">w</span> <span class="ow">-&gt;</span> 
					    <span class="kr">if</span> <span class="p">(</span><span class="n">line</span><span class="o">++</span><span class="s">&quot; &quot;</span><span class="o">++</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="n">width</span> 
					    <span class="kr">then</span> <span class="p">(</span><span class="n">all</span><span class="o">++</span><span class="p">[</span><span class="n">line</span><span class="p">],</span> <span class="n">w</span><span class="p">)</span>
					    <span class="kr">else</span> <span class="p">(</span><span class="n">all</span><span class="p">,</span> <span class="n">line</span><span class="o">++</span><span class="s">&quot; &quot;</span><span class="o">++</span><span class="n">w</span><span class="p">)</span>
					    <span class="p">)</span> <span class="p">(</span><span class="kt">[]</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="kr">in</span>
	       <span class="n">join</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">(</span><span class="n">all</span><span class="o">++</span><span class="p">[</span><span class="n">line</span><span class="p">])</span>

<span class="c1">-- @@PLEAC@@_1.13</span>
<span class="nf">escaping</span> <span class="ow">=</span> <span class="s">&quot;Mom Said, </span><span class="se">\&quot;</span><span class="s">Don&#39;t do that.</span><span class="se">\&quot;</span><span class="s">&quot;</span>
<span class="nf">esc1</span> <span class="ow">=</span> <span class="n">escaping</span><span class="o">.</span><span class="n">gsubst</span> <span class="s">&quot;[&#39;</span><span class="se">\&quot;</span><span class="s">]&quot;</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="o">++</span><span class="p">)</span> <span class="c1">-- section, &lt;=&gt; (\x -&gt; &quot;\\&quot; ++ x)</span>
<span class="nf">esc3</span> <span class="ow">=</span> <span class="n">escaping</span><span class="o">.</span><span class="n">gsubst</span> <span class="s">&quot;[^A-Z]&quot;</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="o">++</span><span class="p">)</span>
<span class="nf">esc4</span> <span class="ow">=</span> <span class="n">escaping</span><span class="o">.</span><span class="n">gsubst</span> <span class="s">&quot;[^</span><span class="se">\\</span><span class="s">w]&quot;</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="o">++</span><span class="p">)</span>

<span class="c1">-- @@PLEAC@@_1.14</span>
<span class="nf">s10</span> <span class="ow">=</span> <span class="s">&quot;    titi&quot;</span><span class="o">.</span><span class="n">substS</span> <span class="s">&quot;^</span><span class="se">\\</span><span class="s">s+&quot;</span> <span class="s">&quot;&quot;</span> <span class="kt">[]</span>
<span class="nf">s11</span> <span class="ow">=</span> <span class="s">&quot;  titi  &quot;</span><span class="o">.</span><span class="n">substS</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">s+$&quot;</span> <span class="s">&quot;&quot;</span> <span class="kt">[]</span>

<span class="nf">trim</span> <span class="ow">=</span> <span class="n">substS</span> <span class="s">&quot;^</span><span class="se">\\</span><span class="s">s+&quot;</span> <span class="s">&quot;&quot;</span> <span class="kt">[]</span> <span class="err">°</span> <span class="n">substS</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">s+$&quot;</span> <span class="s">&quot;&quot;</span> <span class="kt">[]</span>

<span class="c1">-- @@PLEAC@@_1.15</span>
<span class="nf">parse_csv</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">let</span> <span class="n">re</span> <span class="ow">=</span> <span class="p">[</span><span class="s">&quot;</span><span class="se">\&quot;</span><span class="s">([^</span><span class="se">\&quot;\\\\</span><span class="s">]*(</span><span class="se">\\\\</span><span class="s">.[^</span><span class="se">\&quot;\\\\</span><span class="s">]*)*)</span><span class="se">\&quot;</span><span class="s">,?&quot;</span> <span class="c1">-- &quot;toto,titi&quot;</span>
		       <span class="p">,</span><span class="s">&quot;([^,]+),?&quot;</span> <span class="c1">-- something that not start with &quot; can not contain any , =&gt; go until next ,</span>
		       <span class="p">,</span><span class="s">&quot;,&quot;</span>
                       <span class="p">]</span><span class="o">.</span><span class="n">join</span> <span class="s">&quot;|&quot;</span>
                  <span class="n">xxs</span>  <span class="ow">=</span> <span class="n">s</span><span class="o">.</span><span class="n">gmatch</span> <span class="n">re</span> <span class="kr">in</span>
	       <span class="n">xxs</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">xs</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">xs</span><span class="o">!</span><span class="p">(</span><span class="mi">0</span><span class="ow">::</span><span class="kt">Int</span><span class="p">))</span> <span class="o">|||</span> <span class="p">(</span><span class="n">xs</span><span class="o">!</span><span class="p">(</span><span class="mi">2</span><span class="ow">::</span><span class="kt">Int</span><span class="p">)))</span>
			 
<span class="nf">testline</span> <span class="ow">=</span> <span class="s">&quot;XYZZY,</span><span class="se">\&quot;\&quot;</span><span class="s">,</span><span class="se">\&quot;</span><span class="s">O&#39;Reilly, Inc</span><span class="se">\&quot;</span><span class="s">,</span><span class="se">\&quot;</span><span class="s">Wall, Larry</span><span class="se">\&quot;</span><span class="s">,</span><span class="se">\&quot;</span><span class="s">a </span><span class="se">\\\&quot;</span><span class="s">glug</span><span class="se">\\\&quot;</span><span class="s"> bit,</span><span class="se">\&quot;</span><span class="s">,5,</span><span class="se">\&quot;</span><span class="s">Error, Core Dumped</span><span class="se">\&quot;</span><span class="s">&quot;</span>
<span class="nf">mparse</span> <span class="ow">=</span> <span class="n">testline</span><span class="o">.</span><span class="n">parse_csv</span><span class="o">.</span><span class="n">foldM</span><span class="p">(</span><span class="nf">\</span><span class="n">i</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="n">i</span><span class="o">^</span><span class="s">&quot; : &quot;</span><span class="o">^</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="nf">\</span><span class="kr">_</span> <span class="ow">-&gt;</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="mi">0</span>

<span class="c1">-- @@PLEAC@@_1.16</span>
<span class="c1">-- from explanation from http://www.myatt.demon.co.uk/sxalg.htm</span>
<span class="nf">soundex</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">x</span><span class="kt">:</span><span class="sc">&#39;-&#39;</span><span class="kt">:</span><span class="p">((</span><span class="n">res</span><span class="o">++</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">take</span> <span class="mi">3</span><span class="o">.</span><span class="n">map</span> <span class="n">show</span><span class="o">.</span><span class="n">concat</span><span class="p">)</span> <span class="c1">-- note that as haskell is lazy, this code is efficient</span>
    <span class="kr">where</span> <span class="n">group</span>      <span class="ow">=</span>  <span class="p">[(</span><span class="s">&quot;AEIOUYHW&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
			<span class="p">,(</span><span class="s">&quot;BFPV&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
			<span class="p">,(</span><span class="s">&quot;CGJKQSXZ&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
			<span class="p">,(</span><span class="s">&quot;DT&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
			<span class="p">,(</span><span class="s">&quot;L&quot;</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
			<span class="p">,(</span><span class="s">&quot;MN&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
			<span class="p">,(</span><span class="s">&quot;R&quot;</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
			<span class="p">]</span>
	  <span class="n">code</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">group</span><span class="o">.</span><span class="n">find</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">letters</span><span class="p">,</span><span class="kr">_</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">x</span> <span class="p">`</span><span class="n">elem</span><span class="p">`</span> <span class="n">letters</span><span class="p">)</span><span class="o">.</span><span class="n">just</span><span class="o">.</span><span class="n">snd</span>
	  <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">s</span><span class="o">.</span><span class="n">upcase</span><span class="o">.</span><span class="n">substS</span> <span class="s">&quot;[^</span><span class="se">\\</span><span class="s">w]&quot;</span> <span class="s">&quot;&quot;</span> <span class="p">[</span><span class="kt">Global_Match</span><span class="p">]</span>
	  <span class="c1">-- A consonant immediately following an initial letter from the same code group is ignored</span>
	  <span class="n">xs&#39;</span>    <span class="ow">=</span> <span class="kr">if</span> <span class="n">xs</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">xs</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">code</span> <span class="o">&amp;&amp;</span> <span class="n">x</span><span class="o">.</span><span class="n">code</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span> <span class="n">xs</span><span class="o">.</span><span class="n">tail</span> <span class="kr">else</span> <span class="n">xs</span>
	  <span class="n">trim</span> <span class="n">xs</span> <span class="ow">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">dropWhile</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
	  <span class="n">next_code</span> <span class="n">xs</span> <span class="ow">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">trim</span><span class="o">.</span><span class="p">(</span><span class="nf">\</span><span class="n">xs</span> <span class="ow">-&gt;</span> <span class="kr">if</span> <span class="n">length</span> <span class="n">xs</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span> <span class="n">xs</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">code</span> <span class="kr">else</span> <span class="mi">0</span><span class="p">)</span>
	  <span class="n">aux</span> <span class="n">xs</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">trim</span> <span class="n">xs</span> <span class="kr">of</span>
		   <span class="kt">[]</span>     <span class="ow">-&gt;</span> <span class="kt">[]</span>
		   <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kr">if</span> <span class="n">x</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">xs</span><span class="o">.</span><span class="n">next_code</span> <span class="kr">then</span> <span class="n">aux</span> <span class="n">xs</span> <span class="kr">else</span> <span class="n">x</span><span class="o">.</span><span class="n">code</span><span class="kt">:</span><span class="n">aux</span> <span class="n">xs</span>
	  <span class="n">res</span>    <span class="ow">=</span> <span class="n">aux</span> <span class="n">xs&#39;</span>
	  
<span class="nf">soundexes</span>     <span class="ow">=</span>  <span class="p">[</span><span class="s">&quot;holmes&quot;</span>           <span class="c1">-- H-452</span>
		  <span class="p">,</span><span class="s">&quot;adomomi&quot;</span>         <span class="c1">-- A-350 -- 355</span>
		  <span class="p">,</span><span class="s">&quot;vonderlehr&quot;</span>      <span class="c1">-- V-536</span>
		  <span class="p">,</span><span class="s">&quot;ball&quot;</span>            <span class="c1">-- B-400</span>
		  <span class="p">,</span><span class="s">&quot;shaw&quot;</span>            <span class="c1">-- S-000</span>
		  <span class="p">,</span><span class="s">&quot;jackson&quot;</span>         <span class="c1">-- J-250</span>
		  <span class="p">,</span><span class="s">&quot;scanlon&quot;</span>         <span class="c1">-- S-545</span>
		  <span class="p">,</span><span class="s">&quot;saintjohn&quot;</span>       <span class="c1">-- S-532</span>
		  <span class="p">,</span><span class="s">&quot;kingsmith&quot;</span>       <span class="c1">-- K-525</span>
		  <span class="p">,</span><span class="s">&quot;booth-davis&quot;</span>     <span class="c1">-- B-312</span>
		  <span class="p">,</span><span class="s">&quot;Knuth&quot;</span>           <span class="c1">-- K-530</span>
		  <span class="p">,</span><span class="s">&quot;Kant&quot;</span>            <span class="c1">-- K-530</span>
		  <span class="p">,</span><span class="s">&quot;Lloyd&quot;</span>           <span class="c1">-- L-300</span>
		  <span class="p">,</span><span class="s">&quot;Ladd&quot;</span>            <span class="c1">-- L-300</span>
		  <span class="p">]</span><span class="o">.</span><span class="n">map</span> <span class="n">soundex</span>	     
<span class="c1">-- TODO, not complete ($quota,$comment,$gcos,$expire) = getpw*</span>
<span class="kr">data</span> <span class="kt">Passwd_entry</span> <span class="ow">=</span> <span class="kt">Passwd_entry</span> <span class="p">{</span><span class="n">pw_name</span><span class="p">,</span><span class="n">pw_passwd</span><span class="p">,</span><span class="n">pw_comment</span><span class="p">,</span><span class="n">pw_dir</span><span class="p">,</span><span class="n">pw_shell</span><span class="ow">::</span><span class="kt">String</span><span class="p">,</span> <span class="n">pw_uid</span><span class="p">,</span><span class="n">pw_gid</span><span class="ow">::</span><span class="kt">Int</span><span class="p">}</span>
		  <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Eq</span><span class="p">,</span><span class="kt">Show</span><span class="p">)</span>
<span class="nf">getpwent</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">let</span> <span class="p">[</span><span class="n">name1</span><span class="p">,</span><span class="n">passwd1</span><span class="p">,</span><span class="n">uid1</span><span class="p">,</span><span class="n">gid1</span><span class="p">,</span><span class="n">comment1</span><span class="p">,</span><span class="n">dir1</span><span class="p">,</span><span class="n">shell1</span><span class="p">]</span> <span class="ow">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span> <span class="s">&quot;:&quot;</span> <span class="kr">in</span>
		 <span class="kt">Passwd_entry</span> <span class="p">{</span><span class="n">pw_name</span><span class="ow">=</span><span class="n">name1</span><span class="p">,</span><span class="n">pw_passwd</span><span class="ow">=</span><span class="n">passwd1</span><span class="p">,</span><span class="n">pw_uid</span><span class="ow">=</span><span class="n">read</span> <span class="n">uid1</span><span class="p">,</span><span class="n">pw_gid</span><span class="ow">=</span><span class="n">read</span> <span class="n">gid1</span><span class="p">,</span>
			       <span class="n">pw_comment</span><span class="ow">=</span><span class="n">comment1</span><span class="p">,</span><span class="n">pw_dir</span><span class="ow">=</span><span class="n">dir1</span><span class="p">,</span><span class="n">pw_shell</span><span class="ow">=</span><span class="n">shell1</span><span class="p">}</span> 

<span class="nf">msoundex</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">putStr</span> <span class="s">&quot;Lookup user: &quot;</span>
	      <span class="n">user</span>  <span class="ow">&lt;-</span> <span class="n">getLine</span>
	      <span class="n">cat</span> <span class="s">&quot;/etc/passwd&quot;</span> <span class="o">&gt;&gt;=</span>
		  <span class="n">each</span> <span class="p">(</span><span class="nf">\</span><span class="n">l</span> <span class="ow">-&gt;</span> <span class="kr">let</span> <span class="kt">Passwd_entry</span> <span class="p">{</span><span class="n">pw_name</span><span class="ow">=</span><span class="n">name</span><span class="p">,</span><span class="n">pw_comment</span><span class="ow">=</span><span class="n">comment</span><span class="p">}</span> <span class="ow">=</span> <span class="n">l</span><span class="o">.</span><span class="n">getpwent</span>
			          <span class="p">[</span><span class="n">firstname</span><span class="p">,</span><span class="n">lastname</span><span class="p">]</span> <span class="ow">=</span> <span class="n">comment</span><span class="o">.</span><span class="n">match</span> <span class="s">&quot;(</span><span class="se">\\</span><span class="s">w+)[^,]*</span><span class="se">\\</span><span class="s">b(</span><span class="se">\\</span><span class="s">w+)&quot;</span>
			          <span class="n">soundex&#39;</span> <span class="n">xs</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">xs</span> <span class="o">==</span> <span class="kt">[]</span> <span class="kr">then</span> <span class="s">&quot;&quot;</span> <span class="kr">else</span> <span class="n">xs</span><span class="o">.</span><span class="n">soundex</span> <span class="kr">in</span>
			       <span class="kr">if</span> <span class="n">user</span><span class="o">.</span><span class="n">soundex&#39;</span> <span class="p">`</span><span class="n">elem</span><span class="p">`</span> <span class="p">(</span><span class="n">map</span> <span class="n">soundex&#39;</span> <span class="p">[</span><span class="n">name</span><span class="p">,</span><span class="n">firstname</span><span class="p">,</span><span class="n">lastname</span><span class="p">])</span>
			       <span class="kr">then</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="n">name</span><span class="o">++</span><span class="s">&quot;: &quot;</span><span class="o">++</span><span class="n">firstname</span><span class="o">++</span><span class="s">&quot; &quot;</span><span class="o">++</span><span class="n">lastname</span><span class="p">)</span>
			       <span class="kr">else</span> <span class="n">return</span> <span class="nb">()</span>
			<span class="p">)</span>
			 
<span class="c1">-- TODO, pstyle and psgrep			 </span>
			 
<span class="c1">----------------------------------------------------------------------------------------------------</span>
<span class="c1">-- @@PLEAC@@_2.1</span>
<span class="nf">is_integer</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">s</span> <span class="o">=~</span> <span class="s">&quot;^[+-]?</span><span class="se">\\</span><span class="s">d+$&quot;</span> 
	       <span class="kr">then</span> <span class="n">putStrLn</span> <span class="s">&quot;is an integer&quot;</span>
	       <span class="kr">else</span> <span class="n">putStrLn</span> <span class="s">&quot;is not&quot;</span>
<span class="nf">m0</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">putStrLn</span> <span class="s">&quot;has non digits&quot;</span> <span class="p">`</span><span class="n">when</span><span class="p">`</span>   <span class="p">(</span><span class="n">s</span> <span class="o">=~</span> <span class="s">&quot;[^</span><span class="se">\\</span><span class="s">d]&quot;</span><span class="p">)</span> <span class="c1">-- no \D</span>
	  <span class="n">putStrLn</span> <span class="s">&quot;not a natural&quot;</span>  <span class="p">`</span><span class="n">unless</span><span class="p">`</span> <span class="p">(</span><span class="n">s</span> <span class="o">=~</span> <span class="s">&quot;^</span><span class="se">\\</span><span class="s">d+$&quot;</span><span class="p">)</span>
	  <span class="n">putStrLn</span> <span class="s">&quot;not an integer&quot;</span> <span class="p">`</span><span class="n">unless</span><span class="p">`</span> <span class="p">(</span><span class="n">s</span> <span class="o">=~</span> <span class="s">&quot;^-?</span><span class="se">\\</span><span class="s">d+$&quot;</span><span class="p">)</span>
	  <span class="n">putStrLn</span> <span class="s">&quot;not an integer&quot;</span> <span class="p">`</span><span class="n">unless</span><span class="p">`</span> <span class="p">(</span><span class="n">s</span> <span class="o">=~</span> <span class="s">&quot;^[+-]?</span><span class="se">\\</span><span class="s">d+$&quot;</span><span class="p">)</span>
	  <span class="n">putStrLn</span> <span class="s">&quot;not a decimal&quot;</span>  <span class="p">`</span><span class="n">unless</span><span class="p">`</span> <span class="p">(</span><span class="n">s</span> <span class="o">=~</span> <span class="s">&quot;^-?</span><span class="se">\\</span><span class="s">d+</span><span class="se">\\</span><span class="s">.</span><span class="se">\\</span><span class="s">d*$&quot;</span><span class="p">)</span>
	  <span class="n">putStrLn</span> <span class="s">&quot;not a float&quot;</span>    <span class="p">`</span><span class="n">unless</span><span class="p">`</span> <span class="p">(</span><span class="n">s</span> <span class="o">=~</span> <span class="s">&quot;^[+-]?</span><span class="se">\\</span><span class="s">d+((</span><span class="se">\\</span><span class="s">.</span><span class="se">\\</span><span class="s">d+([eE]-?</span><span class="se">\\</span><span class="s">d+)?)|([eE]-?</span><span class="se">\\</span><span class="s">d+))$&quot;</span><span class="p">)</span>
<span class="c1">-- in haskell, regexp are first class, then can be appended, sometimes easier to read</span>
<span class="nf">m0&#39;</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">let</span> <span class="n">sign</span>       <span class="ow">=</span> <span class="s">&quot;-&quot;</span>
	    <span class="n">opt_sign</span>   <span class="ow">=</span> <span class="n">sign</span> <span class="o">++</span> <span class="s">&quot;?&quot;</span>
	    <span class="n">dec_number</span> <span class="ow">=</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">d+&quot;</span>
	    <span class="n">integer</span>    <span class="ow">=</span> <span class="n">opt_sign</span> <span class="o">++</span> <span class="n">dec_number</span>
	    <span class="n">exp</span>        <span class="ow">=</span> <span class="s">&quot;eE&quot;</span> <span class="o">++</span> <span class="n">opt_sign</span> <span class="o">++</span> <span class="n">dec_number</span>
	    <span class="n">real</span>       <span class="ow">=</span> <span class="s">&quot;(&quot;</span> <span class="o">++</span> <span class="n">opt_sign</span> <span class="o">++</span> <span class="n">dec_number</span> <span class="o">++</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">.&quot;</span> <span class="o">++</span> <span class="n">dec_number</span> <span class="o">++</span> <span class="n">exp</span> <span class="o">++</span><span class="s">&quot;?&quot;</span> <span class="o">++</span> <span class="s">&quot;)&quot;</span> <span class="o">++</span>
			 <span class="s">&quot;|&quot;</span> <span class="o">++</span> <span class="s">&quot;(&quot;</span> <span class="o">++</span> <span class="n">opt_sign</span> <span class="o">++</span> <span class="n">dec_number</span> <span class="o">++</span> <span class="n">exp</span> <span class="o">++</span> <span class="s">&quot;)&quot;</span> <span class="kr">in</span>
	    <span class="kr">do</span> <span class="n">putStrLn</span> <span class="s">&quot;not a natural&quot;</span>  <span class="p">`</span><span class="n">unless</span><span class="p">`</span> <span class="p">(</span><span class="n">s</span> <span class="o">==~</span> <span class="n">dec_number</span><span class="p">)</span>
	       <span class="n">putStrLn</span> <span class="s">&quot;not an integer&quot;</span> <span class="p">`</span><span class="n">unless</span><span class="p">`</span> <span class="p">(</span><span class="n">s</span> <span class="o">==~</span> <span class="n">integer</span><span class="p">)</span>
	       <span class="n">putStrLn</span> <span class="s">&quot;not a decimal&quot;</span>  <span class="p">`</span><span class="n">unless</span><span class="p">`</span> <span class="p">(</span><span class="n">s</span> <span class="o">==~</span> <span class="p">(</span><span class="n">integer</span> <span class="o">++</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">.&quot;</span> <span class="o">++</span> <span class="n">dec_number</span><span class="p">))</span>
	       <span class="n">putStrLn</span> <span class="s">&quot;not a float&quot;</span>    <span class="p">`</span><span class="n">unless</span><span class="p">`</span> <span class="p">(</span><span class="n">s</span> <span class="o">==~</span> <span class="n">real</span><span class="p">)</span>

<span class="nf">m0test</span> <span class="ow">=</span> <span class="n">m0</span> <span class="s">&quot;124&quot;</span>      

<span class="c1">-- @@PLEAC@@_2.2</span>
<span class="nf">equal_num</span> <span class="n">n1</span> <span class="n">n2</span> <span class="n">nbdecimal</span> <span class="ow">=</span> <span class="p">(</span><span class="n">abs</span> <span class="p">(</span><span class="n">n1</span> <span class="o">-</span> <span class="n">n2</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">^^</span> <span class="n">nbdecimal</span><span class="p">)</span>
<span class="nf">eqnum</span> <span class="ow">=</span> <span class="n">equal_num</span> <span class="mf">10.001</span> <span class="mf">10.002</span> <span class="mi">4</span> <span class="c1">-- with 3 give True cos 10.001 - 10.002 != 0.001 but 0.000999</span>

<span class="nf">wage</span> <span class="ow">=</span> <span class="mi">536</span>          <span class="c1">-- $5.36/hour</span>
<span class="nf">week</span> <span class="ow">=</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">wage</span>    <span class="c1">-- $214.40</span>
<span class="nf">weekwage</span> <span class="ow">=</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;One week&#39;s wage is: $&quot;</span><span class="o">++</span><span class="n">show_float</span> <span class="mi">2</span> <span class="p">(</span><span class="n">tonum</span> <span class="n">week</span><span class="o">/</span><span class="mf">100.0</span><span class="p">))</span>

<span class="c1">-- @@PLEAC@@_2.3</span>
<span class="nf">i</span> <span class="ow">=</span> <span class="mf">2.3</span><span class="o">.</span><span class="n">round</span>
<span class="nf">a2</span>  <span class="ow">=</span> <span class="mf">0.255</span>
<span class="nf">sa2</span> <span class="ow">=</span> <span class="n">show_float</span> <span class="mi">2</span> <span class="n">a2</span>
<span class="nf">mprinta</span> <span class="ow">=</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;Unrounded: &quot;</span><span class="o">^</span><span class="n">a2</span><span class="o">^</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Rounded: &quot;</span><span class="o">^</span><span class="n">sa2</span><span class="p">)</span>

<span class="c1">-- TODO, i dont exactly produce the good ouput, negative number are not centered</span>
<span class="nf">mprintfloat</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">putStrLn</span> <span class="s">&quot;number</span><span class="se">\t</span><span class="s">int</span><span class="se">\t</span><span class="s">floor</span><span class="se">\t</span><span class="s">ceil&quot;</span>
		 <span class="p">[</span><span class="mf">3.3</span> <span class="p">,</span> <span class="mf">3.5</span> <span class="p">,</span> <span class="mf">3.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.3</span><span class="p">]</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="nf">\</span><span class="n">n</span> <span class="ow">-&gt;</span> <span class="n">putStrLn</span> <span class="p">((</span><span class="n">show_float</span> <span class="mi">1</span> <span class="n">n</span><span class="p">)</span><span class="o">^</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">^</span>
							      <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">round</span><span class="p">)</span><span class="o">^</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">^</span>
							      <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">floor</span><span class="p">)</span><span class="o">^</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">^</span>
							      <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">ceiling</span><span class="p">)))</span>

<span class="c1">-- @@PLEAC@@_2.4</span>
<span class="c1">-- TODO? not exacly this, as 54 = 110 110 we dont see the pb of big endian</span>
<span class="nf">bin2i</span> <span class="n">xs</span> <span class="ow">=</span> <span class="n">aux</span> <span class="mi">1</span> <span class="p">(</span><span class="n">reverse</span> <span class="n">xs</span><span class="p">)</span>
    <span class="kr">where</span> <span class="n">aux</span> <span class="n">power</span> <span class="kt">[]</span>     <span class="ow">=</span> <span class="mi">0</span>
	  <span class="n">aux</span> <span class="n">power</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">aux</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">power</span><span class="p">)</span> <span class="n">xs</span><span class="o">+</span><span class="p">(</span><span class="kr">if</span> <span class="n">x</span> <span class="o">==</span> <span class="sc">&#39;0&#39;</span> <span class="kr">then</span> <span class="mi">0</span> <span class="kr">else</span> <span class="n">power</span><span class="p">)</span>
<span class="nf">bin2i&#39;</span> <span class="n">xs</span> <span class="ow">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">c</span> <span class="ow">-&gt;</span> <span class="n">read</span> <span class="p">[</span><span class="n">c</span><span class="p">])</span><span class="o">.</span><span class="n">zipWith</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">^^</span><span class="n">a</span><span class="p">))</span> <span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span>
<span class="nf">i10</span> <span class="ow">=</span> <span class="n">bin2i&#39;</span> <span class="s">&quot;0110110&quot;</span> <span class="c1">-- 54</span>

<span class="nf">i2bin</span> <span class="n">i</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span> <span class="s">&quot;0&quot;</span> <span class="kr">else</span> <span class="n">aux</span> <span class="n">i</span>
	  <span class="kr">where</span> <span class="n">aux</span> <span class="n">i</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span>  <span class="kr">then</span> <span class="s">&quot;&quot;</span> <span class="kr">else</span> <span class="n">aux</span> <span class="p">(</span><span class="n">i</span> <span class="p">`</span><span class="n">div</span><span class="p">`</span> <span class="mi">2</span><span class="p">)</span> <span class="o">++</span> <span class="n">show</span> <span class="p">(</span><span class="n">i</span> <span class="p">`</span><span class="n">mod</span><span class="p">`</span> <span class="mi">2</span><span class="p">)</span>
<span class="nf">bin10</span> <span class="ow">=</span> <span class="n">i2bin</span> <span class="mi">54</span> <span class="c1">-- &quot;110110&quot;</span>

<span class="c1">-- @@PLEAC@@_2.5</span>
<span class="nf">m1</span> <span class="ow">=</span> <span class="n">putStr</span> <span class="s">&quot;Infancy is: &quot;</span> <span class="o">&gt;&gt;</span> <span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="nf">\</span><span class="n">e</span> <span class="ow">-&gt;</span> <span class="n">putStr</span> <span class="p">(</span><span class="n">e</span><span class="o">^</span><span class="s">&quot; &quot;</span><span class="p">))</span>
<span class="nf">m2</span> <span class="ow">=</span> <span class="n">putStr</span> <span class="s">&quot;Infancy is: &quot;</span> <span class="o">&gt;&gt;</span> <span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">map</span> <span class="n">show</span><span class="o">.</span><span class="n">unwords</span><span class="o">.</span><span class="n">putStr</span>

<span class="c1">-- @@PLEAC@@_2.6</span>
<span class="c1">-- code from comp.lang.functionnal</span>
<span class="nf">inttorom</span> <span class="n">n</span> <span class="ow">=</span> <span class="p">(</span><span class="n">concat</span>  <span class="err">°</span> <span class="n">reverse</span><span class="p">)</span> <span class="p">(</span><span class="n">zipWith</span> <span class="n">roman</span> <span class="n">sets</span> <span class="n">digits</span><span class="p">)</span>  <span class="kr">where</span>
     <span class="n">digits</span> <span class="ow">=</span> <span class="n">reverse</span> <span class="p">(</span><span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="n">fromInt</span> <span class="p">(</span><span class="n">read</span> <span class="p">[</span><span class="n">x</span><span class="p">]))</span> <span class="p">(</span><span class="n">show</span> <span class="n">n</span><span class="p">))</span>
     <span class="n">roman</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="n">n</span> <span class="ow">=</span> <span class="kr">case</span> <span class="n">n</span> <span class="kr">of</span> <span class="p">{</span> 
         <span class="mi">0</span> <span class="ow">-&gt;</span> <span class="kt">[]</span><span class="p">;</span>  <span class="mi">1</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">i</span><span class="p">];</span>   <span class="mi">2</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">];</span>   <span class="mi">3</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">];</span>   <span class="mi">4</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">v</span><span class="p">];</span> 
         <span class="mi">5</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">v</span><span class="p">];</span> <span class="mi">6</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span><span class="n">i</span><span class="p">];</span> <span class="mi">7</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">];</span> <span class="mi">8</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">];</span> <span class="mi">9</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">]</span> <span class="p">}</span>
     <span class="n">sets</span> <span class="ow">=</span> <span class="p">[(</span><span class="sc">&#39;I&#39;</span><span class="p">,</span><span class="sc">&#39;V&#39;</span><span class="p">,</span><span class="sc">&#39;X&#39;</span><span class="p">),</span> <span class="p">(</span><span class="sc">&#39;X&#39;</span><span class="p">,</span><span class="sc">&#39;L&#39;</span><span class="p">,</span><span class="sc">&#39;C&#39;</span><span class="p">),</span> <span class="p">(</span><span class="sc">&#39;C&#39;</span><span class="p">,</span><span class="sc">&#39;D&#39;</span><span class="p">,</span><span class="sc">&#39;M&#39;</span><span class="p">),</span> <span class="p">(</span><span class="sc">&#39;M&#39;</span><span class="p">,</span><span class="sc">&#39;?&#39;</span><span class="p">,</span><span class="sc">&#39;?&#39;</span><span class="p">)]</span> 

<span class="nf">mroman</span> <span class="ow">=</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;Roman for &quot;</span><span class="o">^</span><span class="mi">15</span><span class="o">^</span><span class="s">&quot; is :&quot;</span><span class="o">^</span><span class="n">inttorom</span> <span class="mi">15</span><span class="p">)</span>

<span class="c1">-- @@PLEAC@@_2.7</span>
<span class="nf">ran</span> <span class="ow">=</span> <span class="n">rand</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span> <span class="c1">-- [25,75]</span>

<span class="nf">chars</span> <span class="ow">=</span> <span class="n">concat</span> <span class="p">[[</span><span class="sc">&#39;A&#39;</span><span class="o">..</span><span class="sc">&#39;Z&#39;</span><span class="p">],[</span><span class="n">&#39;a&#39;</span><span class="o">..</span><span class="n">&#39;z&#39;</span><span class="p">],[</span><span class="sc">&#39;0&#39;</span><span class="o">..</span><span class="sc">&#39;9&#39;</span><span class="p">],</span><span class="s">&quot;!@$%^&amp;*&quot;</span><span class="p">]</span>

<span class="c1">--password = [1..8].foldM (\a _ -&gt; rand (0, chars.length -1) &gt;&gt;= (\i -&gt; return (a++chars![i]))) &quot;&quot; </span>
<span class="c1">--password = [1..8].mapM (\_ -&gt; rand (0, chars.length -1) &gt;&gt;= (\i -&gt; return (chars!!i)))</span>
<span class="nf">password</span> <span class="ow">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">mapM</span> <span class="p">(</span><span class="nf">\</span><span class="kr">_</span> <span class="ow">-&gt;</span> <span class="n">rand</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">chars</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="n">chars</span><span class="o">!</span><span class="p">))</span> <span class="c1">-- no join, string = [Char] :) hihi section :)</span>

<span class="c1">-- @@PLEAC@@_2.8</span>
<span class="nf">randfixed</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">srand</span> <span class="mi">2</span>
	       <span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

<span class="c1">-- @@PLEAC@@_2.9</span>
<span class="c1">-- uses a Perl module.., in haskell too you can provide your own random generator by</span>
<span class="c1">-- playing with the StdGen type</span>

<span class="c1">-- @@PLEAC@@_2.10</span>
<span class="nf">gaussian_rand</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">r1</span> <span class="ow">&lt;-</span> <span class="n">stdrand</span>
		   <span class="n">r2</span> <span class="ow">&lt;-</span> <span class="n">stdrand</span>
		   <span class="kr">let</span> <span class="n">u1</span> <span class="ow">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">-</span> <span class="mi">1</span>
		       <span class="n">u2</span> <span class="ow">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">-</span> <span class="mi">1</span>
		       <span class="n">w</span>  <span class="ow">=</span> <span class="n">u1</span><span class="o">*</span><span class="n">u1</span> <span class="o">+</span> <span class="n">u2</span><span class="o">*</span><span class="n">u2</span> <span class="kr">in</span>
		       <span class="kr">if</span> <span class="n">w</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="kr">then</span> <span class="n">gaussian_rand</span>
		       <span class="kr">else</span> <span class="kr">let</span> <span class="n">w2</span> <span class="ow">=</span> <span class="n">sqrt</span> <span class="p">((</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">log</span> <span class="n">w</span><span class="p">)</span><span class="o">/</span><span class="n">w</span><span class="p">)</span> <span class="kr">in</span>
				<span class="n">return</span> <span class="p">[</span><span class="n">u2</span><span class="o">*</span><span class="n">w2</span><span class="p">,</span> <span class="n">u1</span><span class="o">*</span><span class="n">w2</span><span class="p">]</span>

<span class="nf">mean</span> <span class="ow">=</span> <span class="mi">25</span>
<span class="nf">sdev</span> <span class="ow">=</span> <span class="mi">2</span>
<span class="nf">salary</span> <span class="ow">=</span> <span class="n">gaussian_rand</span> <span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="nf">\</span><span class="n">l</span> <span class="ow">-&gt;</span> <span class="n">l</span><span class="o">.</span><span class="n">head</span> <span class="o">*</span> <span class="p">(</span><span class="n">tonum</span> <span class="n">sdev</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">tonum</span> <span class="n">mean</span><span class="p">))</span>
<span class="nf">msalary</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">r</span> <span class="ow">&lt;-</span> <span class="n">salary</span>
	     <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;You have been hired at $&quot;</span><span class="o">^</span><span class="n">show_float</span> <span class="mi">2</span> <span class="n">r</span><span class="p">)</span>

<span class="c1">-- @@PLEAC@@_2.11</span>
<span class="nf">deg2rad</span> <span class="n">d</span> <span class="ow">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
<span class="nf">rad2deg</span> <span class="n">r</span> <span class="ow">=</span> <span class="n">r</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">pi</span>

<span class="c1">-- @@PLEAC@@_2.12</span>
<span class="nf">sin_val</span> <span class="ow">=</span> <span class="n">sin</span> <span class="n">pi</span>
<span class="nf">cos_val</span> <span class="ow">=</span> <span class="n">cos</span> <span class="n">pi</span>
<span class="nf">tan_val</span> <span class="ow">=</span> <span class="n">tan</span> <span class="n">pi</span>

<span class="nf">asin_val</span> <span class="ow">=</span> <span class="n">asin</span> <span class="mi">1</span>
<span class="nf">acos_val</span> <span class="ow">=</span> <span class="n">acos</span> <span class="mi">1</span>

<span class="c1">-- @@PLEAC@@_2.13</span>
<span class="nf">log_e</span> <span class="ow">=</span> <span class="n">log</span> <span class="mi">10</span>
<span class="nf">log_10</span> <span class="ow">=</span> <span class="n">log10</span> <span class="mi">100</span> <span class="c1">-- 2</span>

<span class="c1">-- in haskell we dont have by default log10 but we have logBase</span>
<span class="nf">log10</span> <span class="ow">=</span> <span class="n">logBase</span> <span class="mi">10</span>

<span class="nf">answer</span> <span class="ow">=</span> <span class="n">logBase</span> <span class="mi">10</span> <span class="mi">10000</span>
<span class="nf">mlog</span> <span class="ow">=</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;log10(10,000)=&quot;</span><span class="o">^</span><span class="n">answer</span><span class="p">)</span>

<span class="c1">-- @@PLEAC@@_2.14</span>
<span class="nf">matrixa</span> <span class="ow">=</span> <span class="kt">Matrix</span><span class="p">[[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> 
		 <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">]]</span>
<span class="nf">matrixb</span> <span class="ow">=</span> <span class="kt">Matrix</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> 
		 <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> 
		 <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<span class="nf">matrixc</span> <span class="ow">=</span> <span class="n">matrixa</span> <span class="o">*</span> <span class="n">matrixb</span>

<span class="nf">masize</span> <span class="ow">=</span> <span class="n">matrixa</span><span class="o">.</span><span class="n">row_size</span>
<span class="nf">mbsize</span> <span class="ow">=</span> <span class="n">matrixa</span><span class="o">.</span><span class="n">column_size</span>

<span class="c1">--TODO,transposed = matrixc.transpose</span>
<span class="c1">--determined = matrixa.det</span>

<span class="c1">-- @@PLEAC@@_2.15</span>
<span class="nf">ca</span> <span class="ow">=</span> <span class="mi">3</span> <span class="kt">:+</span> <span class="mi">5</span>
<span class="nf">cb</span> <span class="ow">=</span> <span class="mi">2</span> <span class="kt">:+</span> <span class="o">-</span><span class="mi">2</span>
<span class="nf">mcomplex</span> <span class="ow">=</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;c = &quot;</span><span class="o">^</span><span class="p">(</span><span class="n">ca</span><span class="o">*</span><span class="n">cb</span><span class="p">))</span>
<span class="nf">cc</span> <span class="ow">=</span> <span class="n">ca</span><span class="o">*</span><span class="n">cb</span>
<span class="nf">cd</span> <span class="ow">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">complex_i</span>

<span class="nf">mcomplex2</span> <span class="ow">=</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;sqrt(&quot;</span><span class="o">^</span><span class="n">cd</span><span class="o">^</span><span class="s">&quot;) = &quot;</span><span class="o">^</span><span class="n">sqrt</span> <span class="n">cd</span><span class="p">)</span>

<span class="c1">-- @@PLEAC@@_2.16</span>
<span class="nf">i2</span> <span class="ow">=</span> <span class="n">hex</span> <span class="s">&quot;0x45&quot;</span>
<span class="nf">i3</span> <span class="ow">=</span> <span class="n">oct</span> <span class="s">&quot;0o45&quot;</span>

<span class="nf">m3</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">putStrLn</span> <span class="s">&quot;Gimme a number in decimal, octal, or hex: &quot;</span>
	<span class="n">s</span> <span class="ow">&lt;-</span> <span class="n">getLine</span>
	<span class="kr">let</span> <span class="n">i</span> <span class="ow">=</span> <span class="n">s</span><span class="o">.</span><span class="n">pattern_matches</span> <span class="p">[(</span><span class="s">&quot;^0x&quot;</span><span class="p">,</span> <span class="n">hex</span> <span class="n">s</span><span class="p">),(</span><span class="s">&quot;^0o&quot;</span><span class="p">,</span> <span class="n">oct</span> <span class="n">s</span><span class="p">),(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">read</span> <span class="n">s</span><span class="p">)]</span> <span class="kr">in</span>
		<span class="n">putStrLn</span> <span class="p">(</span><span class="n">concat</span> <span class="p">[</span><span class="n">show</span> <span class="n">i</span><span class="p">,</span><span class="s">&quot; &quot;</span><span class="p">,</span><span class="n">tohex</span> <span class="n">i</span><span class="p">,</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="n">tooct</span> <span class="n">i</span><span class="p">,</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">])</span>
<span class="c1">-- no printf :((</span>

<span class="nf">m3&#39;</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">putStrLn</span> <span class="s">&quot;Enter file permission in octal: &quot;</span>
	 <span class="n">permissions</span> <span class="ow">&lt;-</span> <span class="n">getLine</span>
	 <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;The decimal value is &quot;</span><span class="o">^</span><span class="n">permissions</span><span class="o">.</span><span class="n">oct</span><span class="p">)</span>


<span class="c1">-- @@PLEAC@@_2.17</span>
<span class="nf">commify</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">s</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;=</span> <span class="mi">3</span> <span class="kr">then</span> <span class="n">s</span> <span class="kr">else</span> 
	    <span class="kr">let</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">=</span> <span class="n">splitAt</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="n">s</span> <span class="kr">in</span> <span class="n">commify</span> <span class="n">a</span> <span class="o">++</span> <span class="s">&quot;,&quot;</span> <span class="o">++</span> <span class="n">b</span>

<span class="c1">-- @@PLEAC@@_2.18</span>
<span class="nf">plurals</span> <span class="n">i</span>   <span class="ow">=</span> <span class="kr">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="kr">then</span> <span class="s">&quot;s&quot;</span> <span class="kr">else</span> <span class="s">&quot;&quot;</span>
<span class="nf">pluralies</span> <span class="n">i</span> <span class="ow">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="s">&quot;ies&quot;</span><span class="p">,</span><span class="s">&quot;y&quot;</span><span class="p">)</span>

<span class="nf">hours</span> <span class="ow">=</span> <span class="mi">2</span>
<span class="nf">century</span> <span class="ow">=</span> <span class="mi">2</span>
<span class="nf">flies</span> <span class="ow">=</span> <span class="mi">3</span>
<span class="nf">mplural</span>  <span class="ow">=</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;It took &quot;</span><span class="o">^</span><span class="n">hours</span><span class="o">^</span><span class="s">&quot; hour&quot;</span><span class="o">^</span><span class="p">(</span><span class="n">plurals</span> <span class="n">hours</span><span class="p">))</span>
<span class="nf">mplural2</span> <span class="ow">=</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;It took &quot;</span><span class="o">^</span><span class="n">century</span><span class="o">^</span><span class="s">&quot; centur&quot;</span><span class="o">^</span><span class="p">(</span><span class="n">pluralies</span> <span class="n">century</span><span class="p">))</span>

<span class="c1">-- TODO, the suffix program and prime factor</span>

<span class="c1">----------------------------------------------------------------------------------------------------</span>
<span class="c1">--ghc -- @@PLEAC@@_3.0</span>
<span class="c1">--ghc mtime1 = now &gt;&gt;= (\d -&gt; putStrLn (calendarTimeToString d))</span>
<span class="c1">--ghc mtime2 = do d &lt;- now</span>
<span class="c1">--ghc 		  putStrLn (&quot;Today is day &quot;^d.ctYDay^&quot; of the current year&quot;)</span>
<span class="c1">--ghc 		  putStrLn (&quot;Today is day &quot;^d.ctDay^ &quot; of the current month&quot;)</span>
<span class="c1">--ghc </span>
<span class="c1">--ghc </span>
<span class="c1">--ghc -- @@PLEAC@@_3.1</span>
<span class="c1">--ghc (day,month,year) = (now &gt;&gt;&gt; ctDay, now &gt;&gt;&gt; ctMonth, now &gt;&gt;&gt; ctYear)</span>
<span class="c1">--ghc tl = now &gt;&gt;= localtime</span>
<span class="c1">--ghc </span>
<span class="c1">--ghc mtime3 = do date &lt;- tl</span>
<span class="c1">--ghc 		  putStrLn (&quot;The current date is &quot;^date.ctYear^&quot; &quot;^date.ctMonth^&quot; &quot;^date.ctDay)</span>
<span class="c1">--ghc </span>
<span class="c1">--ghc mtime4 = do d &lt;- now</span>
<span class="c1">--ghc 		  putStrLn (strftime &quot;%Y-%m-%d&quot; d)</span>
<span class="c1">--ghc </span>
<span class="c1">--ghc -- TODO 3.2, 3.3</span>
<span class="c1">--ghc </span>
<span class="c1">--ghc -- @@PLEAC@@_3.4</span>
<span class="c1">--ghc add_sec sec d = d.toClockTime.addToClockTime (nulltime {tdSec= sec})</span>
<span class="c1">--ghc when_ = now &gt;&gt;&gt; (\d -&gt; d.add_sec 100)</span>
<span class="c1">--ghc then_ = now &gt;&gt;&gt; (\d -&gt; d.add_sec (-100))</span>
<span class="c1">--ghc </span>
<span class="c1">--ghc -- @@PLEAC@@_3.5, TODO, not complete</span>
<span class="c1">--ghc bree = 361535725</span>
<span class="c1">--ghc nat  =  96201950</span>
<span class="c1">--ghc </span>
<span class="c1">--ghc differenc = bree - nat</span>
<span class="c1">--ghc mtime5 = putStrLn (&quot;there were &quot;^differenc^&quot;seconds between Nat and Bree&quot;)</span>
<span class="c1">--ghc </span>
<span class="c1">--ghc seconds = differenc `mod` 60</span>
<span class="c1">--ghc differenc&#39; = (differenc - seconds) `div` 60</span>
<span class="c1">--ghc minutes = differenc&#39; `mod` 60</span>
<span class="c1">--ghc differenc2 = (differenc&#39; - minutes) `div` 60</span>
<span class="c1">--ghc hours   = differenc2 `mod` 24</span>
<span class="c1">--ghc differenc3 = (differenc2 - hours) `div` 24</span>
<span class="c1">--ghc days    = differenc3 `mod` 7</span>
<span class="c1">--ghc weeks   = (differenc3 - days) `div` 7</span>
<span class="c1">--ghc </span>
<span class="c1">--ghc -- (438 weeks, 4 days, 23:49:35)</span>
<span class="c1">--ghc mtime6 = putStrLn (&quot;(&quot;^weeks^&quot; weeks, &quot;^days^&quot; days, &quot;^hours^&quot;:&quot;^minutes^&quot;:&quot;^seconds^&quot;)&quot;)</span>
<span class="c1">--ghc </span>
<span class="c1">--ghc -- @@PLEAC@@_3.6</span>
<span class="c1">--ghc (monthday, weekday, yearday) = (now &gt;&gt;&gt; ctDay, now &gt;&gt;&gt; ctWDay, now &gt;&gt;&gt; ctYDay)</span>
<span class="c1">--ghc </span>
<span class="c1">--ghc weeknum = now &gt;&gt;&gt; (\d -&gt; d.strftime &quot;%U&quot;.read + 1)</span>
<span class="c1">--ghc </span>
<span class="c1">--ghc -- TODO 3.9</span>
<span class="c1">--ghc usec = now &gt;&gt;&gt; ctPicosec -- is this ?</span>
<span class="c1">--ghc </span>
<span class="c1">--ghc -- TODO _3.10</span>
<span class="c1">--ghc -- have sleep::Int but not Double :(</span>

<span class="c1">----------------------------------------------------------------------------------------------------</span>
<span class="c1">-- @@PLEAC@@_4.0</span>
<span class="nf">single_level</span> <span class="ow">=</span> <span class="p">[</span> <span class="s">&quot;this&quot;</span><span class="p">,</span> <span class="s">&quot;that&quot;</span><span class="p">,</span> <span class="s">&quot;the&quot;</span><span class="p">,</span> <span class="s">&quot;other&quot;</span> <span class="p">]</span>
<span class="c1">-- can make nested list, but must all have the same depth</span>

<span class="c1">-- @@PLEAC@@_4.1</span>
<span class="nf">a</span>  <span class="ow">=</span> <span class="p">[</span><span class="s">&quot;quick&quot;</span><span class="p">,</span> <span class="s">&quot;brown&quot;</span><span class="p">,</span> <span class="s">&quot;fox&quot;</span><span class="p">]</span>
<span class="nf">a&#39;</span> <span class="ow">=</span> <span class="s">&quot;Why are you teasing me?&quot;</span><span class="o">.</span><span class="n">words</span>
<span class="c1">-- no multiline in haskell</span>

<span class="nf">big_array</span> <span class="ow">=</span> <span class="n">cat</span> <span class="s">&quot;pleac.hs&quot;</span> 
<span class="nf">name1</span> <span class="ow">=</span> <span class="s">&quot;toto&quot;</span>
<span class="nf">banner_scalar</span> <span class="ow">=</span> <span class="s">&quot;Speak, &quot;</span><span class="o">^</span><span class="n">name1</span><span class="o">^</span><span class="s">&quot; and welcome!&quot;</span>

<span class="nf">his_host</span> <span class="ow">=</span> <span class="s">&quot;www.haskell.org&quot;</span>
<span class="nf">host_info</span> <span class="ow">=</span> <span class="n">exec</span> <span class="p">(</span><span class="s">&quot;host &quot;</span><span class="o">^</span><span class="n">his_host</span><span class="p">)</span>

<span class="nf">psinfo1</span> <span class="ow">=</span> <span class="n">exec</span> <span class="p">(</span><span class="s">&quot;ps $$&quot;</span><span class="p">)</span> <span class="c1">-- that&#39;s the new shell&#39;s $$</span>
<span class="nf">banner_array1</span> <span class="ow">=</span> <span class="p">[</span><span class="s">&quot;Costs&quot;</span><span class="p">,</span><span class="s">&quot;only&quot;</span><span class="p">,</span><span class="s">&quot;$4.95&quot;</span><span class="p">]</span>
<span class="nf">banner_array2</span> <span class="ow">=</span> <span class="s">&quot;Costs only $4.95&quot;</span><span class="o">.</span><span class="n">words</span>
<span class="nf">banner_array3</span> <span class="ow">=</span> <span class="s">&quot;Costs only $4.95&quot;</span><span class="o">.</span><span class="n">split</span> <span class="s">&quot; &quot;</span>

<span class="c1">-- @@PLEAC@@_4.2</span>
<span class="nf">commify_series</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
<span class="nf">commify_series</span> <span class="kt">[]</span>  <span class="ow">=</span> <span class="s">&quot;&quot;</span>
<span class="nf">commify_series</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">=</span> <span class="n">x</span>
<span class="nf">commify_series</span> <span class="n">xs</span>  <span class="ow">=</span> <span class="n">join</span> <span class="s">&quot;, &quot;</span> <span class="p">(</span><span class="n">init</span> <span class="n">xs</span><span class="p">)</span>  <span class="o">++</span> <span class="s">&quot; and &quot;</span> <span class="o">++</span> <span class="p">(</span><span class="n">last</span> <span class="n">xs</span><span class="p">)</span>
<span class="c1">-- commify_series [&quot;cava&quot;, &quot;etoi&quot;,&quot;ouais&quot;] =&gt; &quot;cava, etoi and ouais&quot;</span>

<span class="nf">array</span> <span class="ow">=</span> <span class="p">[</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;yellow&quot;</span><span class="p">,</span> <span class="s">&quot;green&quot;</span><span class="p">]</span>
<span class="nf">s12</span> <span class="ow">=</span> <span class="s">&quot;I have &quot;</span><span class="o">++</span><span class="n">commify_series</span> <span class="n">array</span><span class="o">++</span><span class="s">&quot; marbles&quot;</span>
<span class="nf">marray1</span> <span class="ow">=</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;I have &quot;</span><span class="o">^</span><span class="p">(</span><span class="n">concat</span>  <span class="n">array</span><span class="p">)</span><span class="o">^</span><span class="s">&quot; marbles&quot;</span><span class="p">)</span> <span class="c1">-- I have redyellowgreen marbles</span>
<span class="nf">marray2</span> <span class="ow">=</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;I have &quot;</span><span class="o">^</span><span class="p">(</span><span class="n">unwords</span> <span class="n">array</span><span class="p">)</span><span class="o">^</span><span class="s">&quot; marbles&quot;</span><span class="p">)</span> <span class="c1">-- I have red yellow green marbles</span>



<span class="c1">-- @@PLEAC@@_4.3</span>
<span class="c1">-- grow/shring the array by assigning nil to past the end of array</span>
<span class="nf">change_size</span> <span class="n">n</span> <span class="n">xs</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">xs</span><span class="o">.</span><span class="n">length</span> <span class="kr">then</span> <span class="n">take</span> <span class="n">n</span> <span class="n">xs</span>
		   <span class="kr">else</span> <span class="n">xs</span><span class="o">++</span><span class="p">(</span><span class="n">null_val</span><span class="o">.</span><span class="n">replicate</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">xs</span><span class="o">.</span><span class="n">length</span><span class="p">))</span>

<span class="nf">change_val</span> <span class="n">ix</span> <span class="n">e</span> <span class="n">xs</span> <span class="ow">=</span> <span class="kr">let</span> <span class="n">xs&#39;</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">ix</span> <span class="o">&lt;=</span> <span class="n">xs</span><span class="o">.</span><span class="n">length</span> <span class="kr">then</span> <span class="n">xs</span> <span class="kr">else</span> <span class="n">change_size</span> <span class="n">ix</span> <span class="n">xs</span> <span class="kr">in</span>
			 <span class="n">xs&#39;</span><span class="o">!!</span><span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="n">ix</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">++</span><span class="p">[</span><span class="n">e</span><span class="p">]</span><span class="o">++</span><span class="n">xs&#39;</span><span class="o">!!</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="o">..</span><span class="p">]</span>
		     
<span class="nf">array2</span> <span class="ow">=</span> <span class="n">array</span><span class="o">.</span><span class="n">change_size</span> <span class="mi">5</span>
<span class="nf">array3</span> <span class="ow">=</span> <span class="n">array</span><span class="o">.</span><span class="n">change_val</span> <span class="mi">5</span> <span class="s">&quot;toto&quot;</span>

<span class="nf">array4</span> <span class="ow">=</span> <span class="s">&quot;toto&quot;</span><span class="o">.</span><span class="n">replicate</span> <span class="mi">5</span>

<span class="nf">what_about_that_array</span> <span class="n">x</span> <span class="ow">=</span> 
    <span class="s">&quot;The array now has &quot;</span><span class="o">^</span><span class="n">length</span> <span class="n">x</span><span class="o">^</span><span class="s">&quot;elements.</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">^</span>
    <span class="s">&quot;The index of the last element is &quot;</span><span class="o">^</span><span class="n">length</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="o">^</span><span class="s">&quot;.</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">^</span>
    <span class="s">&quot;Element .3 is`&quot;</span><span class="o">^</span><span class="n">x</span><span class="o">!</span><span class="p">(</span><span class="mi">3</span><span class="ow">::</span><span class="kt">Int</span><span class="p">)</span><span class="o">^</span><span class="s">&quot;&#39;.</span><span class="se">\n</span><span class="s">&quot;</span>

<span class="nf">s13</span> <span class="ow">=</span> <span class="s">&quot;Crosby Stills Nash Young&quot;</span><span class="o">.</span><span class="n">words</span><span class="o">.</span><span class="n">what_about_that_array</span>

<span class="c1">-- @@PLEAC@@_4.4</span>
<span class="c1">-- in hugs even this take time :), sort is insertion sort :) by default</span>
<span class="nf">m4</span> <span class="ow">=</span> <span class="n">env</span> <span class="o">&gt;&gt;=</span> <span class="p">(</span><span class="nf">\</span><span class="n">l</span> <span class="ow">-&gt;</span> <span class="n">l</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="nf">\</span><span class="n">var</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">var</span> <span class="o">^</span><span class="s">&quot;=&quot;</span> <span class="o">^</span> <span class="p">(</span><span class="n">l</span><span class="o">!</span><span class="n">var</span><span class="p">))</span><span class="o">.</span><span class="n">putStrLn</span><span class="p">))</span>
<span class="nf">m5</span> <span class="ow">=</span> <span class="n">env</span> <span class="o">&gt;&gt;=</span> <span class="p">(</span><span class="nf">\</span><span class="n">l</span> <span class="ow">-&gt;</span> <span class="n">l</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">val</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">var</span><span class="o">^</span><span class="s">&quot;=&quot;</span><span class="o">^</span><span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">putStrLn</span><span class="p">))</span> <span class="c1">-- but non-sorted</span>
<span class="nf">m6</span> <span class="ow">=</span> <span class="n">env</span> <span class="o">&gt;&gt;=</span> <span class="p">(</span><span class="nf">\</span><span class="n">l</span> <span class="ow">-&gt;</span> <span class="n">l</span><span class="o">.</span><span class="n">toList</span><span class="o">.</span><span class="n">sortBy</span><span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="kr">_</span><span class="p">)</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="kr">_</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="o">&lt;=&gt;</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">val</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">var</span><span class="o">^</span><span class="s">&quot;=&quot;</span><span class="o">^</span><span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">putStrLn</span><span class="p">))</span>

<span class="c1">-- @@PLEAC@@_4.5</span>
<span class="c1">-- not relevant in haskell since we have always kind of references</span>


<span class="c1">-- @@PLEAC@@_4.6</span>
<span class="nf">users</span>  <span class="ow">=</span> <span class="n">exec</span> <span class="s">&quot;who&quot;</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">map</span> <span class="p">(</span><span class="n">words</span> <span class="o">$</span> <span class="n">head</span><span class="p">)</span> <span class="o">$</span> <span class="n">sort</span> <span class="o">$</span> <span class="n">unique</span>
<span class="nf">users2</span> <span class="ow">=</span> <span class="n">exec</span> <span class="s">&quot;who&quot;</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">map</span> <span class="p">(</span><span class="n">match</span> <span class="s">&quot;(</span><span class="se">\\</span><span class="s">w+)&quot;</span> <span class="o">$</span> <span class="n">head</span><span class="p">)</span> <span class="o">$</span> <span class="n">sort</span> <span class="o">$</span> <span class="n">unique</span>
<span class="c1">-- cant do as short as ruby: puts(&quot;users logged in: .{commify_series(users)}&quot;)</span>
<span class="c1">--  monad are too intrusive and we need to introduce an extra var l, :(((  </span>
<span class="nf">m10</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">l</span> <span class="ow">&lt;-</span> <span class="n">users</span> 
         <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;users logged in:&quot;</span><span class="o">++</span><span class="p">(</span><span class="n">commify_series</span> <span class="n">l</span><span class="p">))</span>

<span class="c1">-- @@PLEAC@@_4.7</span>
<span class="nf">l1</span> <span class="ow">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">]</span> <span class="p">`</span><span class="n">difference</span><span class="p">`</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="c1">-- could make [1..5] - [2,5], just have to make an instance Num</span>

<span class="kr">instance</span> <span class="p">(</span><span class="kt">Eq</span> <span class="n">a</span><span class="p">,</span><span class="kt">Show</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Num</span> <span class="p">([</span><span class="n">a</span><span class="p">])</span> <span class="kr">where</span>
    <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="ow">=</span> <span class="n">a</span> <span class="p">`</span><span class="n">union</span><span class="p">`</span> <span class="n">b</span>
    <span class="p">(</span><span class="o">-</span><span class="p">)</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="n">a</span> <span class="p">`</span><span class="n">difference</span><span class="p">`</span> <span class="n">b</span> <span class="c1">-- we can write it like that</span>
    <span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="ow">=</span> <span class="n">intersect</span> <span class="c1">-- or even shorter</span>
<span class="c1">-- make this instance is very dangerous, cos now typechecker not detect the error [show 1,show 2]++[0,0], WHY ?</span>
<span class="nf">l1&#39;</span> <span class="ow">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>

<span class="c1">-- @@PLEAC@@_4.8</span>
<span class="nf">l2</span> <span class="ow">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">]</span>
<span class="nf">l3</span> <span class="ow">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span>
<span class="nf">l4</span> <span class="ow">=</span> <span class="n">l2</span> <span class="p">`</span><span class="n">union</span><span class="p">`</span> <span class="n">l3</span>
<span class="nf">l4&#39;</span> <span class="ow">=</span> <span class="n">l2</span> <span class="o">+</span> <span class="n">l3</span>
<span class="nf">l5</span> <span class="ow">=</span> <span class="n">l2</span> <span class="p">`</span><span class="n">intersect</span><span class="p">`</span> <span class="n">l3</span>
<span class="nf">l5&#39;</span> <span class="ow">=</span> <span class="n">l2</span> <span class="o">*</span> <span class="n">l3</span>
<span class="nf">l6</span> <span class="ow">=</span> <span class="n">difference</span> <span class="p">(</span><span class="n">union</span> <span class="n">l2</span> <span class="n">l3</span><span class="p">)</span> <span class="p">(</span><span class="n">intersect</span> <span class="n">l2</span> <span class="n">l3</span><span class="p">)</span>
<span class="nf">l6&#39;</span> <span class="ow">=</span> <span class="p">(</span><span class="n">l2</span> <span class="o">+</span> <span class="n">l3</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">l2</span> <span class="o">*</span> <span class="n">l3</span><span class="p">)</span>

<span class="c1">-- @@PLEAC@@_4.9</span>
<span class="nf">members</span> <span class="ow">=</span> <span class="p">[</span><span class="s">&quot;Times&quot;</span><span class="p">,</span><span class="s">&quot;Flies&quot;</span><span class="p">]</span>
<span class="nf">initiates</span> <span class="ow">=</span> <span class="p">[</span><span class="s">&quot;An&quot;</span><span class="p">,</span> <span class="s">&quot;Arrow&quot;</span><span class="p">]</span>
<span class="nf">newmembers</span>  <span class="ow">=</span> <span class="n">members</span> <span class="o">++</span> <span class="n">initiates</span>
<span class="nf">newmembers2</span> <span class="ow">=</span> <span class="n">members</span><span class="o">.</span><span class="n">insert_at</span> <span class="mi">2</span> <span class="p">(</span><span class="s">&quot;Like&quot;</span><span class="kt">:</span><span class="n">initiates</span><span class="p">)</span>

<span class="nf">newmembers3</span> <span class="ow">=</span> <span class="n">members</span><span class="o">.</span><span class="n">replace</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Fruit&quot;</span><span class="p">)]</span>
<span class="nf">newmembers4</span> <span class="ow">=</span> <span class="n">members</span><span class="o">.</span><span class="n">replace</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;Fruit&quot;</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="s">&quot;Banana&quot;</span><span class="p">)]</span>

<span class="c1">-- @@PLEAC@@_4.10</span>

<span class="nf">reversed</span> <span class="ow">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">reverse</span>
<span class="nf">array5</span> <span class="ow">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="nf">descending</span>  <span class="ow">=</span> <span class="n">array5</span><span class="o">.</span><span class="n">sort</span><span class="o">.</span><span class="n">reverse</span>
<span class="nf">descending&#39;</span> <span class="ow">=</span> <span class="n">array5</span><span class="o">.</span><span class="n">sortBy</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="o">&lt;=&gt;</span> <span class="n">a</span><span class="p">)</span>
<span class="nf">descending2</span> <span class="ow">=</span> <span class="n">array5</span><span class="o">.</span><span class="n">sortBy</span> <span class="p">(</span><span class="n">flip</span> <span class="p">(</span><span class="o">&lt;=&gt;</span><span class="p">))</span>

<span class="c1">-- @@PLEAC@@_4.11</span>
<span class="c1">-- remove n elements from front of ary (shift n)</span>
<span class="p">(</span><span class="n">front</span><span class="p">,</span><span class="n">newarray</span><span class="p">)</span> <span class="ow">=</span> <span class="n">array5</span><span class="o">.</span><span class="n">splitAt</span> <span class="mi">1</span>

<span class="c1">-- remove n elements from the end of ary (pop n)</span>
<span class="p">(</span><span class="n">newarray&#39;</span><span class="p">,</span><span class="n">end&#39;</span><span class="p">)</span>  <span class="ow">=</span> <span class="n">array5</span><span class="o">.</span><span class="n">splitAt</span> <span class="p">(</span><span class="n">array5</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>


<span class="nf">shift2</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">y</span><span class="kt">:</span><span class="n">ys</span><span class="p">)</span> <span class="ow">=</span> <span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">ys</span><span class="p">)</span> <span class="c1">-- shift2 = zip ... shift ... TODO</span>
<span class="nf">pop2</span> <span class="n">xs</span> <span class="ow">=</span> <span class="kr">let</span> <span class="p">(</span><span class="n">a</span><span class="p">,[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span> <span class="ow">=</span> <span class="n">splitAt</span> <span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="n">xs</span> <span class="kr">in</span> <span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">a</span><span class="p">)</span>


<span class="nf">friends</span> <span class="ow">=</span> <span class="s">&quot;Peter Paul Mary Jim Tim&quot;</span><span class="o">.</span><span class="n">words</span>
<span class="p">((</span><span class="n">this</span><span class="p">,</span> <span class="n">that</span><span class="p">),</span> <span class="n">newfriends</span><span class="p">)</span> <span class="ow">=</span> <span class="n">friends</span><span class="o">.</span><span class="n">shift2</span>

<span class="nf">beverages</span> <span class="ow">=</span> <span class="s">&quot;Dew Jolt Cola Sprite Fresca&quot;</span><span class="o">.</span><span class="n">words</span>
<span class="p">(</span><span class="n">pair</span><span class="p">,</span><span class="n">newbeverages</span><span class="p">)</span> <span class="ow">=</span> <span class="n">beverages</span><span class="o">.</span><span class="n">pop2</span>

<span class="c1">-- @@PLEAC@@_4.12</span>
<span class="kr">data</span> <span class="kt">Employee</span> <span class="ow">=</span> <span class="kt">Employee</span> <span class="p">{</span><span class="n">category</span><span class="p">,</span><span class="n">name</span><span class="ow">::</span> <span class="kt">String</span><span class="p">,</span> <span class="n">income</span><span class="ow">::</span><span class="kt">Int</span><span class="p">}</span> <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Show</span><span class="p">,</span><span class="kt">Eq</span><span class="p">)</span>
<span class="nf">employees</span> <span class="ow">=</span> <span class="p">[</span><span class="kt">Employee</span> <span class="p">{</span><span class="n">category</span><span class="ow">=</span><span class="s">&quot;neuneu&quot;</span><span class="p">,</span><span class="n">name</span><span class="ow">=</span><span class="s">&quot;ben&quot;</span><span class="p">,</span><span class="n">income</span><span class="ow">=</span><span class="mi">1000</span><span class="p">}</span>
	    <span class="p">,</span><span class="kt">Employee</span> <span class="p">{</span><span class="n">category</span><span class="ow">=</span><span class="s">&quot;neuneu&quot;</span><span class="p">,</span><span class="n">name</span><span class="ow">=</span><span class="s">&quot;pixel&quot;</span><span class="p">,</span><span class="n">income</span><span class="ow">=</span><span class="mi">1000</span><span class="p">}</span>
	    <span class="p">,</span><span class="kt">Employee</span> <span class="p">{</span><span class="n">category</span><span class="ow">=</span><span class="s">&quot;engineer&quot;</span><span class="p">,</span><span class="n">name</span><span class="ow">=</span><span class="s">&quot;pad&quot;</span><span class="p">,</span><span class="n">income</span><span class="ow">=</span><span class="mi">27000</span><span class="p">}</span>
	    <span class="p">,</span><span class="kt">Employee</span> <span class="p">{</span><span class="n">category</span><span class="ow">=</span><span class="s">&quot;engineer&quot;</span><span class="p">,</span><span class="n">name</span><span class="ow">=</span><span class="s">&quot;guit&quot;</span><span class="p">,</span><span class="n">income</span><span class="ow">=</span><span class="mi">100000</span><span class="p">}</span>
	     <span class="p">]</span>
<span class="c1">-- can do also with classic assoc list</span>
<span class="c1">-- employees = [(&quot;ben&quot;,&quot;neuneu1&quot;),(&quot;pixel&quot;,&quot;neuneu2&quot;),(&quot;pad&quot;,&quot;engineer&quot;),(&quot;guit&quot;,&quot;engineer&quot;)]</span>
<span class="c1">-- category = snd</span>
<span class="c1">-- name = fst</span>
<span class="p">(</span><span class="kt">Just</span> <span class="n">highest_engineer</span><span class="p">)</span> <span class="ow">=</span> <span class="n">employees</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nf">\</span><span class="n">employee</span> <span class="ow">-&gt;</span> <span class="n">employee</span><span class="o">.</span><span class="n">category</span> <span class="o">==</span> <span class="s">&quot;engineer&quot;</span><span class="p">)</span>

<span class="nf">s14</span> <span class="ow">=</span> <span class="s">&quot;Highest paid engineer is: &quot;</span><span class="o">++</span> <span class="n">highest_engineer</span><span class="o">.</span><span class="n">name</span>


<span class="c1">-- @@PLEAC@@_4.13</span>
<span class="nf">bigs</span> <span class="ow">=</span> <span class="p">[</span><span class="mi">5</span><span class="o">..</span><span class="mi">200</span><span class="p">]</span><span class="o">.</span><span class="n">filter</span> <span class="p">(</span><span class="o">&gt;</span><span class="mi">50</span><span class="p">)</span> <span class="c1">-- hihi section :)</span>

<span class="nf">matching</span>  <span class="ow">=</span> <span class="n">exec</span> <span class="s">&quot;who&quot;</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">filter</span> <span class="p">(</span><span class="o">=~</span> <span class="s">&quot;^gnat&quot;</span><span class="p">)</span>

<span class="nf">engineers</span>  <span class="ow">=</span> <span class="p">[</span> <span class="n">x</span> <span class="o">|</span> <span class="n">x</span> <span class="ow">&lt;-</span> <span class="n">employees</span><span class="p">,</span> <span class="n">category</span> <span class="n">x</span> <span class="o">==</span> <span class="s">&quot;engineer&quot;</span><span class="p">]</span>
<span class="nf">engineers&#39;</span> <span class="ow">=</span> <span class="n">employees</span><span class="o">.</span><span class="n">filter</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="n">category</span> <span class="n">x</span> <span class="o">==</span> <span class="s">&quot;engineer&quot;</span><span class="p">)</span>

<span class="nf">secondary_assistance</span> <span class="ow">=</span> <span class="n">employees</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">income</span> <span class="o">&gt;=</span> <span class="mi">26000</span> <span class="o">&amp;&amp;</span> <span class="n">x</span><span class="o">.</span><span class="n">income</span> <span class="o">&lt;</span> <span class="mi">30000</span><span class="p">)</span>

<span class="c1">-- @@PLEAC@@_4.14</span>
<span class="c1">-- normally you would have an array of Numeric (Float or</span>
<span class="c1">-- Fixnum or Bignum), so you would use:</span>
<span class="nf">sorted1</span> <span class="ow">=</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span>

<span class="c1">-- if you have strings representing Integers or Floats</span>
<span class="c1">-- you may specify another sort method (not lexicographic ordering):</span>
<span class="nf">sorted2</span>  <span class="ow">=</span> <span class="p">[</span><span class="s">&quot;11&quot;</span><span class="p">,</span><span class="s">&quot;5&quot;</span><span class="p">,</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="s">&quot;8&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span> <span class="c1">-- [&quot;1&quot;,&quot;11&quot;,&quot;5&quot;,&quot;8&quot;]</span>
<span class="nf">sorted2&#39;</span> <span class="ow">=</span> <span class="p">[</span><span class="s">&quot;11&quot;</span><span class="p">,</span><span class="s">&quot;5&quot;</span><span class="p">,</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="s">&quot;8&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sortBy</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="p">((</span><span class="n">read</span> <span class="n">a</span><span class="p">)</span><span class="ow">::</span><span class="kt">Int</span><span class="p">)</span> <span class="o">&lt;=&gt;</span> <span class="n">read</span> <span class="n">b</span><span class="p">)</span> <span class="c1">-- [&quot;1&quot;,&quot;5&quot;,&quot;8&quot;,&quot;11&quot;]</span>

<span class="c1">-- cant inline expression :(</span>
<span class="nf">pidsorted</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">ps</span> <span class="ow">&lt;-</span> <span class="n">exec</span> <span class="s">&quot;ps ux&quot;</span> 
	       <span class="n">myenv</span> <span class="ow">&lt;-</span> <span class="n">env</span>
	       <span class="n">ps</span><span class="o">!!</span><span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="p">]</span> <span class="c1">-- avoid the indication string: USER TTY ....</span>
		     <span class="o">.</span><span class="n">filter</span> <span class="p">(</span><span class="o">=~</span> <span class="p">(</span><span class="n">myenv</span><span class="o">!</span><span class="s">&quot;USER&quot;</span><span class="p">))</span>
		     <span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="n">words</span> <span class="o">$</span> <span class="p">(</span><span class="o">!</span><span class="mi">1</span><span class="p">))</span>
		     <span class="o">.</span><span class="n">sortBy</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="p">((</span><span class="n">read</span> <span class="n">a</span><span class="p">)</span><span class="ow">::</span><span class="kt">Int</span><span class="p">)</span> <span class="o">&lt;=&gt;</span> <span class="n">read</span> <span class="n">b</span><span class="p">)</span>
		     <span class="o">.</span><span class="n">each</span> <span class="n">putStrLn</span>
			 
<span class="nf">mkill</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">putStr</span> <span class="s">&quot;Select a process ID to kill:&quot;</span>	   
	   <span class="n">pids</span> <span class="ow">&lt;-</span> <span class="n">getLine</span>
	   <span class="p">(</span><span class="n">putStrLn</span> <span class="s">&quot;Exiting&quot;</span> <span class="o">&gt;&gt;</span> <span class="n">exit</span> <span class="mi">0</span><span class="p">)</span> <span class="p">`</span><span class="n">unless</span><span class="p">`</span> <span class="p">(</span><span class="n">pids</span> <span class="o">=~</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">d+&quot;</span><span class="p">)</span>
	   <span class="kr">_</span> <span class="ow">&lt;-</span> <span class="n">exec</span> <span class="p">(</span><span class="s">&quot;kill &quot;</span><span class="o">^</span><span class="n">pids</span><span class="p">)</span>
	   <span class="kr">_</span> <span class="ow">&lt;-</span> <span class="n">exec</span> <span class="p">(</span><span class="s">&quot;sleep 2&quot;</span><span class="p">)</span>
	   <span class="n">exec</span> <span class="p">(</span><span class="s">&quot;kill -9 &quot;</span><span class="o">^</span><span class="n">pids</span><span class="p">)</span>

<span class="c1">-- @@PLEAC@@_4.15</span>
<span class="nf">unordered</span> <span class="ow">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="nf">ordered</span> <span class="ow">=</span> <span class="n">unordered</span><span class="o">.</span><span class="n">sort</span>
<span class="nf">precomputed</span> <span class="ow">=</span> <span class="n">unordered</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">e</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">abs</span> <span class="n">e</span><span class="p">,</span> <span class="n">e</span><span class="p">])</span>
<span class="nf">ordered_precomputed</span> <span class="ow">=</span> <span class="n">precomputed</span><span class="o">.</span><span class="n">sortBy</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span><span class="o">!</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=&gt;</span> <span class="p">(</span><span class="n">b</span><span class="o">!</span><span class="mi">0</span><span class="p">))</span>
<span class="nf">ordered&#39;</span> <span class="ow">=</span> <span class="n">ordered_precomputed</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="o">!</span><span class="mi">1</span><span class="p">)</span>

<span class="nf">ordered&#39;&#39;</span> <span class="ow">=</span> <span class="n">unordered</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">e</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">abs</span> <span class="n">e</span><span class="p">,</span><span class="n">e</span><span class="p">])</span><span class="o">.</span><span class="n">sortBy</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span><span class="o">!</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=&gt;</span> <span class="p">(</span><span class="n">b</span><span class="o">!</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="o">!</span><span class="mi">1</span><span class="p">)</span>

<span class="nf">employee_sorted</span> <span class="ow">=</span> <span class="n">employees</span><span class="o">.</span><span class="n">sortBy</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">&lt;=&gt;</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

<span class="nf">musers</span>  <span class="ow">=</span> <span class="n">cat</span> <span class="s">&quot;/etc/passwd&quot;</span> <span class="o">&gt;&gt;=</span> <span class="p">(</span><span class="n">map</span> <span class="p">(</span><span class="n">split</span> <span class="s">&quot;:&quot;</span> <span class="o">$</span> <span class="n">head</span><span class="p">)</span> <span class="o">$</span> <span class="n">sort</span> <span class="o">$</span> <span class="n">mapM</span> <span class="n">putStrLn</span><span class="p">)</span>
<span class="nf">musers&#39;</span> <span class="ow">=</span> <span class="n">cat</span> <span class="s">&quot;/etc/passwd&quot;</span> <span class="o">&gt;&gt;=</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">l</span> <span class="ow">-&gt;</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span> <span class="s">&quot;:&quot;</span><span class="o">.</span><span class="n">head</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="o">.</span><span class="n">each</span> <span class="n">putStrLn</span><span class="p">)</span>

<span class="c1">-- @@PLEAC@@_4.16</span>
<span class="c1">-- in haskell we can use infinite list</span>
<span class="nf">circular</span> <span class="ow">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span><span class="o">++</span><span class="n">circular</span>

<span class="nf">grab_and_rotate</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xs</span><span class="o">++</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>

<span class="nf">mprocess1</span> <span class="ow">=</span> <span class="n">loop</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="kr">where</span>
	    <span class="n">loop</span> <span class="n">processes</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;Handling process&quot;</span><span class="o">^</span><span class="n">process</span><span class="p">)</span>
				<span class="n">system</span> <span class="s">&quot;sleep 1&quot;</span>
				<span class="n">loop</span> <span class="n">newprocess</span>
				<span class="n">return</span> <span class="nb">()</span> <span class="c1">-- forced, WHY?</span>
				<span class="kr">where</span> <span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="n">newprocess</span><span class="p">)</span> <span class="ow">=</span> <span class="n">grab_and_rotate</span> <span class="n">processes</span>
<span class="nf">mprocess2</span> <span class="ow">=</span> <span class="n">loop</span> <span class="n">circular</span> <span class="kr">where</span>
	    <span class="n">loop</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;Handling process&quot;</span><span class="o">^</span><span class="n">x</span><span class="p">)</span>
			     <span class="n">system</span> <span class="s">&quot;sleep 1&quot;</span>
			     <span class="n">loop</span> <span class="n">xs</span>
			     <span class="n">return</span> <span class="nb">()</span> <span class="c1">-- forced, WHY?</span>


<span class="c1">-- @@PLEAC@@_4.17</span>
<span class="c1">-- brute force</span>
<span class="nf">permut</span> <span class="kt">[]</span>     <span class="ow">=</span> <span class="kt">[]</span>
<span class="nf">permut</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>    <span class="ow">=</span> <span class="p">[[</span><span class="n">x</span><span class="p">]]</span>
<span class="nf">permut</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">permut</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="n">insert</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">concat</span>
    <span class="kr">where</span> <span class="n">insert</span> <span class="n">x</span> <span class="kt">[]</span>     <span class="ow">=</span> <span class="p">[[</span><span class="n">x</span><span class="p">]]</span>
	  <span class="n">insert</span> <span class="n">x</span> <span class="p">(</span><span class="n">y</span><span class="kt">:</span><span class="n">ys</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">y</span><span class="kt">:</span><span class="n">ys</span><span class="p">)</span> <span class="kt">:</span> <span class="n">map</span> <span class="p">(</span><span class="n">y</span><span class="kt">:</span><span class="p">)</span> <span class="p">(</span><span class="n">insert</span> <span class="n">x</span> <span class="n">ys</span><span class="p">)</span>

<span class="nf">fact</span> <span class="mi">0</span>     <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">fact</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">fact</span> <span class="n">n</span>

<span class="nf">randomizing</span> <span class="n">xs</span> <span class="ow">=</span> <span class="n">rand</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">fact</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="p">((</span><span class="n">xs</span><span class="o">.</span><span class="n">permut</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>

<span class="c1">-- @@PLEAC@@_4.19</span>
<span class="nf">bigint</span> <span class="ow">=</span> <span class="n">fact</span> <span class="mi">500</span>
<span class="c1">-- on hugs, i have 1134 digits</span>
<span class="nf">permute</span> <span class="ow">=</span> <span class="n">permut</span>
<span class="c1">----------------------------------</span>
<span class="o">#!/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">runhugs</span>
<span class="kr">module</span> <span class="nn">Main</span> <span class="kr">where</span>
<span class="kr">import</span> <span class="nn">Prelude</span> <span class="k">hiding</span> <span class="p">((</span><span class="o">.</span><span class="p">))</span>

<span class="c1">-- usage: echo dog eat cat | ./script.hs</span>
<span class="nf">permut</span> <span class="kt">[]</span>     <span class="ow">=</span> <span class="kt">[]</span>
<span class="nf">permut</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>    <span class="ow">=</span> <span class="p">[[</span><span class="n">x</span><span class="p">]]</span>
<span class="nf">permut</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">permut</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="n">insert</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">concat</span>
    <span class="kr">where</span> <span class="n">insert</span> <span class="n">x</span> <span class="kt">[]</span>     <span class="ow">=</span> <span class="p">[[</span><span class="n">x</span><span class="p">]]</span>
	  <span class="n">insert</span> <span class="n">x</span> <span class="p">(</span><span class="n">y</span><span class="kt">:</span><span class="n">ys</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">y</span><span class="kt">:</span><span class="n">ys</span><span class="p">)</span> <span class="kt">:</span> <span class="n">map</span> <span class="p">(</span><span class="n">y</span><span class="kt">:</span><span class="p">)</span> <span class="p">(</span><span class="n">insert</span> <span class="n">x</span> <span class="n">ys</span><span class="p">)</span>

<span class="nf">fact</span> <span class="mi">0</span>     <span class="ow">=</span> <span class="mi">1</span>
<span class="nf">fact</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">fact</span> <span class="n">n</span>

<span class="p">(</span><span class="o">.</span><span class="p">)</span> <span class="n">o</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">f</span> <span class="n">o</span> <span class="c1">-- object notation for object fan</span>
<span class="p">(</span><span class="err">°</span><span class="p">)</span> <span class="n">f</span> <span class="n">g</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">f</span> <span class="p">(</span><span class="n">g</span> <span class="n">x</span><span class="p">)</span>

<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">line</span> <span class="ow">&lt;-</span> <span class="n">getLine</span>
	  <span class="n">line</span><span class="o">.</span><span class="n">words</span><span class="o">.</span><span class="n">permut</span><span class="o">.</span><span class="n">mapM_</span><span class="p">(</span><span class="n">putStrLn</span> <span class="err">°</span> <span class="n">unwords</span><span class="p">)</span>

<span class="c1">----------------------------------</span>



<span class="c1">-- @@PLEAC@@_5.0</span>

<span class="c1">-- this choose for association the traditionnal assoc list representation</span>
<span class="nf">age</span> <span class="ow">=</span> <span class="p">[</span> <span class="p">(</span><span class="s">&quot;Nat&quot;</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span>
	<span class="p">,(</span><span class="s">&quot;Jules&quot;</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span>
	<span class="p">,(</span><span class="s">&quot;Josh&quot;</span><span class="p">,</span><span class="mi">17</span><span class="p">)]</span>
<span class="c1">-- if you preprend the list with fromList, then you can decide what representaion to choose by typing age</span>
<span class="nf">age&#39;</span><span class="ow">::</span> <span class="kt">Assoc</span> <span class="kt">String</span> <span class="kt">Int</span>
<span class="nf">age&#39;</span> <span class="ow">=</span> <span class="n">fromList</span> <span class="p">[</span> <span class="p">(</span><span class="s">&quot;Nat&quot;</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span>
		  <span class="p">,(</span><span class="s">&quot;Jules&quot;</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span>
		  <span class="p">,(</span><span class="s">&quot;Josh&quot;</span><span class="p">,</span><span class="mi">17</span><span class="p">)]</span>

<span class="nf">age1</span><span class="ow">::</span> <span class="kt">Assoc</span> <span class="kt">String</span> <span class="kt">Int</span>
<span class="nf">age1</span> <span class="ow">=</span> <span class="n">empty</span>
<span class="nf">age2</span> <span class="ow">=</span> <span class="n">age1</span><span class="o">.</span><span class="n">insert</span> <span class="p">(</span><span class="s">&quot;Nat&quot;</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span>
<span class="nf">age3</span> <span class="ow">=</span> <span class="n">age2</span><span class="o">.</span><span class="n">insert</span> <span class="p">(</span><span class="s">&quot;Jules&quot;</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span>
<span class="nf">age4</span> <span class="ow">=</span> <span class="n">age3</span><span class="o">.</span><span class="n">insert</span> <span class="p">(</span><span class="s">&quot;Josh&quot;</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span>

<span class="nf">food_color</span> <span class="ow">::</span> <span class="kt">Assoc</span> <span class="kt">String</span> <span class="kt">String</span>
<span class="nf">food_color</span> <span class="ow">=</span>  <span class="n">fromList</span> <span class="p">[</span> <span class="s">&quot;Apple&quot;</span>  <span class="o">==&gt;</span> <span class="s">&quot;red&quot;</span>
			<span class="p">,</span><span class="s">&quot;Banana&quot;</span> <span class="o">==&gt;</span> <span class="s">&quot;yellow&quot;</span>
			<span class="p">,</span><span class="s">&quot;Lemon&quot;</span>  <span class="o">==&gt;</span> <span class="s">&quot;yellow&quot;</span>
			<span class="p">,</span><span class="s">&quot;Carrot&quot;</span> <span class="o">==&gt;</span> <span class="s">&quot;orange&quot;</span>
			<span class="p">]</span>

<span class="c1">-- In haskell, you cannot avoid the double quoting while manipulatin hashes</span>

<span class="c1">-- @@PLEAC@@_5.1</span>
<span class="nf">food_color&#39;</span> <span class="ow">=</span> <span class="n">food_color</span><span class="o">.</span><span class="n">insert</span> <span class="p">(</span><span class="s">&quot;Raspberry&quot;</span> <span class="o">==&gt;</span> <span class="s">&quot;pink&quot;</span><span class="p">)</span>
<span class="nf">mfood_color</span> <span class="ow">=</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;Know foods: &quot;</span><span class="o">^</span><span class="p">(</span><span class="n">unwords</span> <span class="p">(</span><span class="n">food_color</span><span class="o">.</span><span class="n">keys</span><span class="p">)))</span>

<span class="c1">-- @@PLEAC@@_5.2</span>
<span class="c1">-- does hash have a value for key ?</span>

<span class="nf">mhash</span> <span class="ow">=</span> <span class="p">[</span><span class="s">&quot;Banana&quot;</span><span class="p">,</span> <span class="s">&quot;Martini&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mapM</span><span class="p">(</span><span class="nf">\</span><span class="n">name</span> <span class="ow">-&gt;</span> 
	<span class="n">putStrLn</span> <span class="p">(</span><span class="n">name</span><span class="o">^</span><span class="s">&quot; is a &quot;</span><span class="o">^</span><span class="p">(</span><span class="n">food_color</span><span class="o">.</span><span class="n">has_key</span> <span class="n">name</span> <span class="o">?</span> <span class="p">(</span><span class="s">&quot;food&quot;</span><span class="p">,</span><span class="s">&quot;drink&quot;</span><span class="p">)))</span>
				  <span class="p">)</span>
<span class="c1">-- @@PLEAC@@_5.3</span>
<span class="nf">food_color2</span> <span class="ow">=</span> <span class="n">food_color</span><span class="o">.</span><span class="n">delete_key</span> <span class="s">&quot;Banana&quot;</span>

<span class="c1">-- @@PLEAC@@_5.4</span>

<span class="nf">mhash2</span> <span class="ow">=</span> <span class="n">food_color</span><span class="o">.</span><span class="n">each</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">food</span><span class="p">,</span><span class="n">color</span><span class="p">)</span> <span class="ow">-&gt;</span>
	 <span class="n">putStrLn</span> <span class="p">(</span><span class="n">food</span><span class="o">^</span><span class="s">&quot; is &quot;</span><span class="o">^</span><span class="n">color</span><span class="p">)</span>
	 <span class="p">)</span>
<span class="nf">mhash3</span> <span class="ow">=</span> <span class="n">food_color</span><span class="o">.</span><span class="n">each_key</span><span class="p">(</span><span class="nf">\</span><span class="n">food</span> <span class="ow">-&gt;</span> 
	 <span class="n">putStrLn</span> <span class="p">(</span><span class="n">food</span><span class="o">^</span><span class="s">&quot; is &quot;</span><span class="o">^</span><span class="p">(</span><span class="n">food_color</span><span class="o">!</span><span class="n">food</span><span class="p">))</span>
	 <span class="p">)</span>

<span class="c1">-- IMO too (as gc), this demonstrates that OO style is by far more readable</span>
<span class="nf">mhash4</span> <span class="ow">=</span> <span class="n">food_color</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="nf">\</span><span class="n">food</span> <span class="ow">-&gt;</span>
	 <span class="n">putStrLn</span> <span class="p">(</span><span class="n">food</span><span class="o">^</span><span class="s">&quot; is &quot;</span><span class="o">^</span><span class="p">(</span><span class="n">food_color</span><span class="o">!</span><span class="n">food</span><span class="p">))</span>
         <span class="p">)</span>
<span class="c1">---------------------------------------</span>
<span class="o">#!/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">runhugs</span> <span class="o">-</span><span class="mi">98</span>
<span class="kr">module</span> <span class="nn">Main</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="nn">Prelude</span> <span class="k">hiding</span> <span class="p">((</span><span class="o">$</span><span class="p">),(</span><span class="o">^</span><span class="p">),(</span><span class="o">.</span><span class="p">),(</span><span class="o">!!</span><span class="p">),</span><span class="nf">map</span><span class="p">,</span><span class="nf">take</span><span class="p">,</span><span class="nf">lookup</span><span class="p">,</span><span class="nf">drop</span><span class="p">,</span><span class="nf">splitAt</span><span class="p">,</span><span class="nf">reverse</span><span class="p">,</span><span class="nf">filter</span><span class="p">,</span><span class="nf">takeWhile</span><span class="p">,</span><span class="nf">dropWhile</span><span class="p">,</span><span class="nf">null</span><span class="p">,</span><span class="nf">foldl</span><span class="p">,</span><span class="nf">length</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Common</span>
<span class="c1">-- TODO, very slow, try with ghc</span>

<span class="c1">-- countfrom - count number of messages from each sender</span>
<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">lines</span> <span class="ow">&lt;-</span> <span class="p">(</span><span class="o">&lt;&gt;</span><span class="p">)</span>
	  <span class="n">lines</span><span class="o">.</span><span class="n">foldl</span><span class="p">(</span><span class="nf">\</span><span class="n">from</span> <span class="n">l</span> <span class="ow">-&gt;</span> 
		     <span class="kr">if</span> <span class="n">l</span> <span class="o">=~</span> <span class="s">&quot;^From: &quot;</span> 
		     <span class="kr">then</span> <span class="kr">let</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="ow">=</span> <span class="n">l</span><span class="o">.</span><span class="n">match</span> <span class="s">&quot;^From: (.*)&quot;</span> <span class="kr">in</span> <span class="n">from</span><span class="o">.</span><span class="n">update</span> <span class="n">name</span> <span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
		     <span class="kr">else</span> <span class="n">from</span>
		     <span class="p">)</span> <span class="p">(</span><span class="n">empty</span><span class="ow">::</span><span class="kt">AssocDefault</span> <span class="kt">String</span> <span class="kt">Int</span><span class="p">)</span>
		<span class="o">.</span><span class="n">toList</span><span class="o">.</span><span class="n">sortBy</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="p">(</span><span class="kr">_</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="o">&lt;=&gt;</span> <span class="n">a</span><span class="p">)</span>
		<span class="o">.</span><span class="n">each</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="n">b</span><span class="o">^</span><span class="s">&quot;: &quot;</span><span class="o">^</span><span class="n">a</span><span class="p">))</span>
<span class="c1">---------------------------------------</span>
			      
			   
<span class="c1">-- @@PLEAC@@_5.5</span>
<span class="c1">-- You may use the not built-in &#39;show&#39; (poor ruby)</span>
<span class="nf">mhash5</span> <span class="ow">=</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="n">age4</span><span class="o">.</span><span class="n">show</span><span class="p">)</span>
	 
<span class="c1">-- Or do it the Cookbook way:</span>
<span class="nf">mhash5&#39;</span> <span class="ow">=</span> <span class="n">age4</span><span class="o">.</span><span class="n">each</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="n">k</span><span class="o">^</span><span class="s">&quot; =&gt; &quot;</span><span class="o">^</span><span class="n">v</span><span class="p">))</span>

<span class="c1">-- Sorted by keys</span>
<span class="nf">mhash6</span> <span class="ow">=</span> <span class="n">age4</span><span class="o">.</span><span class="n">toList</span><span class="o">.</span><span class="n">sortBy</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">fst</span><span class="p">)</span> <span class="o">&lt;=&gt;</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">fst</span><span class="p">))</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="n">k</span><span class="o">^</span><span class="s">&quot; =&gt; &quot;</span><span class="o">^</span><span class="n">v</span><span class="p">))</span>
<span class="c1">-- Sorted by values</span>
<span class="nf">mhash7</span> <span class="ow">=</span> <span class="n">age4</span><span class="o">.</span><span class="n">toList</span><span class="o">.</span><span class="n">sortBy</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">snd</span><span class="p">)</span> <span class="o">&lt;=&gt;</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">snd</span><span class="p">))</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="n">k</span><span class="o">^</span><span class="s">&quot; =&gt; &quot;</span><span class="o">^</span><span class="n">v</span><span class="p">))</span>

<span class="c1">-- @@PLEAC@@_5.7</span>
<span class="nf">mttys</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">who</span> <span class="ow">&lt;-</span> <span class="n">exec</span> <span class="s">&quot;who&quot;</span>
	   <span class="n">who</span><span class="o">.</span><span class="n">foldl</span><span class="p">(</span><span class="nf">\</span><span class="n">ttys</span> <span class="n">l</span> <span class="ow">-&gt;</span> 
		    <span class="kr">let</span> <span class="p">(</span><span class="n">user</span><span class="kt">:</span><span class="n">tty</span><span class="kt">:</span><span class="kr">_</span><span class="p">)</span><span class="ow">=</span> <span class="n">l</span><span class="o">.</span><span class="n">words</span> <span class="kr">in</span>
		    <span class="n">ttys</span><span class="o">.</span><span class="n">update</span> <span class="n">tty</span> <span class="p">(</span><span class="n">insert</span> <span class="n">user</span><span class="p">)</span>
		    <span class="p">)</span> <span class="p">(</span><span class="n">empty</span><span class="ow">::</span><span class="kt">AssocDefault</span> <span class="kt">String</span> <span class="p">(</span><span class="kt">SetList</span> <span class="kt">String</span><span class="p">))</span>
		<span class="o">.</span><span class="n">toList</span><span class="o">.</span><span class="n">sortBy</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="kr">_</span><span class="p">)</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="kr">_</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="o">&lt;=&gt;</span> <span class="n">a</span><span class="p">)</span>
		<span class="o">.</span><span class="n">each</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="n">a</span><span class="o">^</span><span class="s">&quot;: &quot;</span><span class="o">^</span><span class="n">commify_series</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">toList</span><span class="p">)))</span>

<span class="c1">-- @@PLEAC@@_5.8</span>
<span class="nf">surname</span><span class="ow">::</span> <span class="kt">Assoc</span> <span class="kt">String</span> <span class="kt">String</span>
<span class="nf">surname</span> <span class="ow">=</span> <span class="n">fromList</span> <span class="p">[</span><span class="s">&quot;Mickey&quot;</span> <span class="o">==&gt;</span> <span class="s">&quot;Mantle&quot;</span><span class="p">,</span> <span class="s">&quot;Babe&quot;</span>  <span class="o">==&gt;</span> <span class="s">&quot;Ruth&quot;</span><span class="p">]</span>
<span class="nf">mhash8</span> <span class="ow">=</span> <span class="n">surname</span><span class="o">.</span><span class="n">keyss</span> <span class="s">&quot;Mantle&quot;</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">putStrLn</span>

<span class="nf">invert_surname</span><span class="ow">::</span> <span class="kt">Assoc</span> <span class="kt">String</span> <span class="kt">String</span>
<span class="nf">invert_surname</span> <span class="ow">=</span> <span class="n">surname</span><span class="o">.</span><span class="n">toList</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">))</span><span class="o">.</span><span class="n">fromList</span>

<span class="c1">---------------------------------------</span>
<span class="o">#!/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">runhugs</span> <span class="o">-</span><span class="mi">98</span>
<span class="kr">module</span> <span class="nn">Main</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="nn">Prelude</span> <span class="k">hiding</span> <span class="p">((</span><span class="o">$</span><span class="p">),(</span><span class="o">^</span><span class="p">),(</span><span class="o">.</span><span class="p">),(</span><span class="o">!!</span><span class="p">),</span><span class="nf">map</span><span class="p">,</span><span class="nf">take</span><span class="p">,</span><span class="nf">lookup</span><span class="p">,</span><span class="nf">drop</span><span class="p">,</span><span class="nf">splitAt</span><span class="p">,</span><span class="nf">reverse</span><span class="p">,</span><span class="nf">filter</span><span class="p">,</span><span class="nf">takeWhile</span><span class="p">,</span><span class="nf">dropWhile</span><span class="p">,</span><span class="nf">null</span><span class="p">,</span><span class="nf">foldl</span><span class="p">,</span><span class="nf">length</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Common</span>

<span class="nf">color</span> <span class="ow">::</span> <span class="kt">Assoc</span> <span class="kt">String</span> <span class="kt">String</span>
<span class="nf">color</span> <span class="ow">=</span> <span class="n">fromList</span> <span class="p">[</span>
		 <span class="s">&quot;Apple&quot;</span>  <span class="o">==&gt;</span> <span class="s">&quot;red&quot;</span><span class="p">,</span>
		 <span class="s">&quot;Banana&quot;</span> <span class="o">==&gt;</span> <span class="s">&quot;yellow&quot;</span><span class="p">,</span>
		 <span class="s">&quot;Lemon&quot;</span>  <span class="o">==&gt;</span> <span class="s">&quot;yellow&quot;</span><span class="p">,</span>
		 <span class="s">&quot;Carrot&quot;</span> <span class="o">==&gt;</span> <span class="s">&quot;orange&quot;</span>
		 <span class="p">]</span>


<span class="c1">-- foodfind - find match for food or color</span>
<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">args</span> <span class="ow">&lt;-</span> <span class="n">argv</span>
	  <span class="n">usage</span> <span class="s">&quot;foodfind food_or_color&quot;</span> <span class="p">`</span><span class="n">when</span><span class="p">`</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">null</span><span class="p">)</span>
	  <span class="kr">let</span> <span class="n">given</span> <span class="ow">=</span> <span class="n">args</span><span class="o">.</span><span class="n">head</span> <span class="kr">in</span>
	      <span class="kr">do</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="n">given</span><span class="o">^</span><span class="s">&quot; is a good with color &quot;</span><span class="o">^</span><span class="p">(</span><span class="n">color</span><span class="o">!</span><span class="n">given</span><span class="p">))</span> 
			      <span class="p">`</span><span class="n">when</span><span class="p">`</span> <span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">has_key</span>   <span class="n">given</span><span class="p">)</span>
		 <span class="n">putStrLn</span> <span class="p">(</span><span class="n">given</span><span class="o">^</span><span class="s">&quot; is a color with food &quot;</span><span class="o">^</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">keyss</span> <span class="n">given</span><span class="o">.</span><span class="n">head</span><span class="p">))</span> 
			      <span class="p">`</span><span class="n">when</span><span class="p">`</span> <span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">has_value</span> <span class="n">given</span><span class="p">)</span>
<span class="c1">---------------------------------------</span>

<span class="c1">-- @@PLEAC@@_5.9</span>
<span class="c1">-- Sorted by keys</span>
<span class="nf">mhash9</span>  <span class="ow">=</span> <span class="n">age4</span><span class="o">.</span><span class="n">toList</span><span class="o">.</span><span class="n">sortBy</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">fst</span><span class="p">)</span> <span class="o">&lt;=&gt;</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">fst</span><span class="p">))</span><span class="o">.</span><span class="n">each</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">-&gt;</span> 
	  <span class="n">putStrLn</span> <span class="p">(</span><span class="n">k</span><span class="o">^</span><span class="s">&quot; is &quot;</span><span class="o">^</span><span class="n">v</span><span class="p">))</span>
<span class="c1">-- Sorted by values</span>
<span class="nf">mhash10</span> <span class="ow">=</span> <span class="n">age4</span><span class="o">.</span><span class="n">toList</span><span class="o">.</span><span class="n">sortBy</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">snd</span><span class="p">)</span> <span class="o">&lt;=&gt;</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">snd</span><span class="p">))</span><span class="o">.</span><span class="n">each</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">-&gt;</span> 
	  <span class="n">putStrLn</span> <span class="p">(</span><span class="n">k</span><span class="o">^</span><span class="s">&quot; is &quot;</span><span class="o">^</span><span class="n">v</span><span class="p">))</span>

<span class="c1">-- Sorted by length of values</span>
<span class="nf">mhash11</span> <span class="ow">=</span> <span class="n">food_color</span><span class="o">.</span><span class="n">toList</span><span class="o">.</span><span class="n">sortBy</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">snd</span><span class="o">.</span><span class="n">length</span><span class="p">)</span> <span class="o">&lt;=&gt;</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">snd</span><span class="o">.</span><span class="n">length</span><span class="p">))</span><span class="o">.</span><span class="n">each</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">-&gt;</span> 
	  <span class="n">putStrLn</span> <span class="p">(</span><span class="n">k</span><span class="o">^</span><span class="s">&quot; is &quot;</span><span class="o">^</span><span class="n">v</span><span class="p">))</span>

<span class="c1">-- @@PLEAC@@_5.10</span>
<span class="nf">drink_color</span><span class="ow">::</span> <span class="kt">Assoc</span> <span class="kt">String</span> <span class="kt">String</span>
<span class="nf">drink_color</span> <span class="ow">=</span> <span class="n">fromList</span> <span class="p">[</span><span class="s">&quot;Galliano&quot;</span> <span class="o">==&gt;</span> <span class="s">&quot;yellow&quot;</span><span class="p">,</span> <span class="s">&quot;Mai Tai&quot;</span> <span class="o">==&gt;</span> <span class="s">&quot;blue&quot;</span><span class="p">]</span>

<span class="c1">-- in haskell no clone, we do implictly always clone :)</span>
<span class="nf">ingested_color</span> <span class="ow">=</span> <span class="n">drink_color</span> <span class="p">`</span><span class="n">union</span><span class="p">`</span> <span class="n">food_color</span>

<span class="nf">substance_color</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="p">(</span><span class="kt">Assoc</span> <span class="kt">String</span> <span class="kt">Int</span><span class="p">)</span>
<span class="nf">substance_color</span> <span class="ow">=</span> <span class="p">[</span><span class="n">food_color</span><span class="p">,</span> <span class="n">drink_color</span><span class="p">]</span>
		  <span class="o">.</span><span class="n">foldM</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">i</span> <span class="ow">-&gt;</span> 
			  <span class="n">i</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">foldM</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">k</span> <span class="ow">-&gt;</span> 
					<span class="kr">if</span> <span class="n">a</span><span class="o">.</span><span class="n">has_key</span> <span class="n">k</span> 
					<span class="kr">then</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;Warning: &quot;</span><span class="o">^</span><span class="n">k</span><span class="o">^</span><span class="s">&quot; seen twice&quot;</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">return</span> <span class="n">a</span><span class="p">)</span>
					<span class="kr">else</span> <span class="n">return</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">insert</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
					<span class="p">)</span> <span class="n">a</span>
			  <span class="p">)</span> <span class="n">empty</span>

<span class="c1">-- @@PLEAC@@_5.11</span>
<span class="nf">common</span> <span class="ow">=</span> <span class="n">food_color</span><span class="o">.</span><span class="n">keys</span> <span class="o">*</span> <span class="n">drink_color</span><span class="o">.</span><span class="n">keys</span>

<span class="nf">this_not_that</span> <span class="ow">=</span> <span class="n">food_color</span><span class="o">.</span><span class="n">keys</span> <span class="o">-</span> <span class="n">drink_color</span><span class="o">.</span><span class="n">keys</span>

<span class="c1">-- @@PLEAC@@_5.12</span>
<span class="c1">-- no problem here, haskell handles any kind of object for key-ing</span>

<span class="c1">-- TODO 5.13 AFAIK, not possible in Ruby</span>

<span class="c1">-- @@PLEAC@@_5.14</span>
<span class="nf">count</span><span class="ow">::</span> <span class="kt">AssocDefault</span> <span class="kt">String</span> <span class="kt">Int</span>
<span class="nf">count</span> <span class="ow">=</span> <span class="p">[</span><span class="s">&quot;toto&quot;</span><span class="p">,</span><span class="s">&quot;toto&quot;</span><span class="p">,</span><span class="s">&quot;toto&quot;</span><span class="p">,</span><span class="s">&quot;tata&quot;</span><span class="p">,</span><span class="s">&quot;tata&quot;</span><span class="p">,</span><span class="s">&quot;tutu&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">foldl</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">s</span> <span class="ow">-&gt;</span> <span class="n">a</span><span class="o">.</span><span class="n">update</span> <span class="n">s</span> <span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="n">empty</span>

<span class="o">--@</span><span class="kt">PLEAC</span><span class="o">@@</span><span class="n">_5</span><span class="o">.</span><span class="mi">15</span>
<span class="nf">father</span><span class="ow">::</span> <span class="kt">Assoc</span> <span class="kt">String</span> <span class="kt">String</span>
<span class="nf">father</span> <span class="ow">=</span> <span class="n">fromList</span> <span class="p">[</span><span class="s">&quot;Cain&quot;</span>      <span class="o">==&gt;</span> <span class="s">&quot;Adam&quot;</span><span class="p">,</span>
		   <span class="s">&quot;Abel&quot;</span>      <span class="o">==&gt;</span> <span class="s">&quot;Adam&quot;</span><span class="p">,</span>
		   <span class="s">&quot;Seth&quot;</span>      <span class="o">==&gt;</span> <span class="s">&quot;Adam&quot;</span><span class="p">,</span>
		   <span class="s">&quot;Enoch&quot;</span>     <span class="o">==&gt;</span> <span class="s">&quot;Cain&quot;</span><span class="p">,</span>
		   <span class="s">&quot;Irad&quot;</span>      <span class="o">==&gt;</span> <span class="s">&quot;Enoch&quot;</span><span class="p">,</span>
		   <span class="s">&quot;Mehujael&quot;</span>  <span class="o">==&gt;</span> <span class="s">&quot;Irad&quot;</span><span class="p">,</span>
		   <span class="s">&quot;Methusael&quot;</span> <span class="o">==&gt;</span> <span class="s">&quot;Mehujael&quot;</span><span class="p">,</span>
		   <span class="s">&quot;Lamech&quot;</span>    <span class="o">==&gt;</span> <span class="s">&quot;Methusael&quot;</span><span class="p">,</span>
		   <span class="s">&quot;Jabal&quot;</span>     <span class="o">==&gt;</span> <span class="s">&quot;Lamech&quot;</span><span class="p">,</span>
		   <span class="s">&quot;Jubal&quot;</span>     <span class="o">==&gt;</span> <span class="s">&quot;Lamech&quot;</span><span class="p">,</span>
		   <span class="s">&quot;Tubalcain&quot;</span> <span class="o">==&gt;</span> <span class="s">&quot;Lamech&quot;</span><span class="p">,</span>
		   <span class="s">&quot;Enos&quot;</span>      <span class="o">==&gt;</span> <span class="s">&quot;Seth&quot;</span>
		   <span class="p">]</span>


<span class="nf">children</span> <span class="ow">::</span> <span class="kt">AssocDefault</span> <span class="kt">String</span> <span class="p">(</span><span class="kt">SetList</span> <span class="kt">String</span><span class="p">)</span>
<span class="nf">children</span> <span class="ow">=</span> <span class="n">father</span><span class="o">.</span><span class="n">foldl</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">a</span><span class="o">.</span><span class="n">update</span> <span class="n">v</span> <span class="p">(</span><span class="n">insert</span> <span class="n">k</span><span class="p">))</span> <span class="n">empty</span>

<span class="c1">-- TODO	   </span>

<span class="c1">-- @@PLEAC@@_APPENDIX</span>
<span class="c1">----------------------------------------------------------------------------------------------------</span>
<span class="kr">module</span> <span class="nn">Common</span> <span class="p">(</span> <span class="nf">module</span> <span class="kt">Common</span>
		<span class="p">,</span> <span class="nf">module</span> <span class="kt">Regexp</span>
		<span class="p">,</span> <span class="nf">module</span> <span class="kt">System</span>
		<span class="p">,</span> <span class="nf">module</span> <span class="kt">Complex</span>
		<span class="p">,</span> <span class="nf">module</span> <span class="kt">Char</span> 
		<span class="p">,</span> <span class="nf">module</span> <span class="kt">Numeric</span> 
		<span class="c1">-- Monad</span>
		<span class="p">,</span> <span class="nf">foldM</span>
		<span class="c1">-- List</span>
		<span class="p">,</span> <span class="nf">elemIndex</span><span class="p">,</span> <span class="nf">elemIndices</span><span class="p">,</span>
		<span class="nf">find</span><span class="p">,</span> <span class="nf">findIndex</span><span class="p">,</span> <span class="nf">findIndices</span><span class="p">,</span>
		<span class="nf">nub</span><span class="p">,</span> <span class="nf">nubBy</span><span class="p">,</span> <span class="nf">delete</span><span class="p">,</span> <span class="nf">deleteBy</span><span class="p">,</span> <span class="p">(</span><span class="o">\\</span><span class="p">),</span> <span class="nf">deleteFirstsBy</span><span class="p">,</span>
		<span class="nf">union</span><span class="p">,</span> <span class="nf">unionBy</span><span class="p">,</span> <span class="nf">intersect</span><span class="p">,</span> <span class="nf">intersectBy</span><span class="p">,</span>
		<span class="nf">intersperse</span><span class="p">,</span> <span class="nf">transpose</span><span class="p">,</span> <span class="nf">partition</span><span class="p">,</span> <span class="nf">group</span><span class="p">,</span> <span class="nf">groupBy</span><span class="p">,</span>
		<span class="nf">inits</span><span class="p">,</span> <span class="nf">tails</span><span class="p">,</span> <span class="nf">isPrefixOf</span><span class="p">,</span> <span class="nf">isSuffixOf</span><span class="p">,</span>
		<span class="nf">mapAccumL</span><span class="p">,</span> <span class="nf">mapAccumR</span><span class="p">,</span>
		<span class="nf">sort</span><span class="p">,</span> <span class="nf">sortBy</span><span class="p">,</span> <span class="nf">insert</span><span class="p">,</span> <span class="nf">insertBy</span><span class="p">,</span> <span class="nf">maximumBy</span><span class="p">,</span> <span class="nf">minimumBy</span><span class="p">,</span>
		<span class="nf">genericLength</span><span class="p">,</span> <span class="nf">genericTake</span><span class="p">,</span> <span class="nf">genericDrop</span><span class="p">,</span>
		<span class="nf">genericSplitAt</span><span class="p">,</span> <span class="nf">genericIndex</span><span class="p">,</span> <span class="nf">genericReplicate</span><span class="p">,</span>
		<span class="nf">zip4</span><span class="p">,</span> <span class="nf">zip5</span><span class="p">,</span> <span class="nf">zip6</span><span class="p">,</span> <span class="nf">zip7</span><span class="p">,</span>
		<span class="nf">zipWith4</span><span class="p">,</span> <span class="nf">zipWith5</span><span class="p">,</span> <span class="nf">zipWith6</span><span class="p">,</span> <span class="nf">zipWith7</span><span class="p">,</span>
		<span class="nf">unzip4</span><span class="p">,</span> <span class="nf">unzip5</span><span class="p">,</span> <span class="nf">unzip6</span><span class="p">,</span> <span class="nf">unzip7</span><span class="p">,</span> <span class="nf">unfoldr</span>
<span class="c1">--		,module Prelude</span>

<span class="p">)</span> <span class="kr">where</span>

<span class="c1">----------------------------------------------------------------------------------------------------</span>
<span class="kr">import</span> <span class="nn">Prelude</span> <span class="k">hiding</span> <span class="p">((</span><span class="o">$</span><span class="p">),(</span><span class="o">^</span><span class="p">),(</span><span class="o">.</span><span class="p">),(</span><span class="o">!!</span><span class="p">),</span><span class="nf">map</span><span class="p">,</span><span class="nf">take</span><span class="p">,</span><span class="nf">lookup</span><span class="p">,</span><span class="nf">drop</span><span class="p">,</span><span class="nf">splitAt</span><span class="p">,</span><span class="nf">reverse</span><span class="p">,</span><span class="nf">filter</span><span class="p">,</span><span class="nf">takeWhile</span><span class="p">,</span><span class="nf">dropWhile</span><span class="p">,</span><span class="nf">null</span><span class="p">,</span><span class="nf">foldl</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">List</span> <span class="k">hiding</span> <span class="p">((</span><span class="o">!!</span><span class="p">),</span><span class="nf">map</span><span class="p">,</span><span class="nf">take</span><span class="p">,</span><span class="nf">lookup</span><span class="p">,</span><span class="nf">drop</span><span class="p">,</span><span class="nf">splitAt</span><span class="p">,</span><span class="nf">reverse</span><span class="p">,</span><span class="nf">filter</span><span class="p">,</span><span class="nf">takeWhile</span><span class="p">,</span><span class="nf">dropWhile</span><span class="p">,</span><span class="nf">null</span><span class="p">,</span><span class="nf">insert</span><span class="p">,</span><span class="nf">union</span><span class="p">,</span><span class="nf">intersect</span><span class="p">,</span><span class="nf">delete</span><span class="p">,</span><span class="nf">partition</span><span class="p">,</span><span class="nf">foldl</span><span class="p">,</span><span class="nf">length</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Random</span> <span class="k">hiding</span> <span class="p">(</span><span class="nf">split</span><span class="p">)</span>
<span class="kr">import</span> <span class="nn">Monad</span> <span class="k">hiding</span> <span class="p">(</span><span class="nf">join</span><span class="p">,</span><span class="nf">when</span><span class="p">,</span><span class="nf">unless</span><span class="p">)</span>

<span class="kr">import</span> <span class="nn">Regexp</span>
<span class="kr">import</span> <span class="nn">System</span>
<span class="kr">import</span> <span class="nn">Complex</span>

<span class="c1">-- seems ghc need it for chr,ord, readHex, readOct</span>
<span class="kr">import</span> <span class="nn">Char</span> 
<span class="kr">import</span> <span class="nn">Numeric</span> 
<span class="c1">--ghc import Time</span>
<span class="c1">--ghc import Locale</span>

<span class="c1">--import Trace</span>

<span class="c1">----------------------------------------------------------------------------------------------------</span>
<span class="nf">substr</span> <span class="n">start</span> <span class="n">len</span> <span class="n">insert</span> <span class="n">s</span> <span class="ow">=</span> 
    <span class="kr">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="kr">then</span> <span class="n">s</span><span class="o">!!</span><span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="n">start</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">++</span> <span class="n">insert</span> <span class="o">++</span> <span class="n">s</span><span class="o">!!</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">len</span><span class="o">..</span><span class="p">]</span> <span class="c1">-- [0.. -1] -&gt; []</span>
    <span class="kr">else</span> <span class="n">s</span><span class="o">!!</span><span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="p">(</span><span class="n">length</span> <span class="n">s</span> <span class="o">+</span> <span class="n">start</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">++</span> <span class="n">insert</span> <span class="o">++</span> <span class="n">s</span><span class="o">!!</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">len</span><span class="o">..</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c1">--substr s start len insert = take s start ++ insert ++ s!![start+len..]</span>
<span class="nf">substr2</span> <span class="n">start</span> <span class="n">insert</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">substr</span> <span class="n">start</span> <span class="p">(</span><span class="kr">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="kr">then</span> <span class="p">(</span><span class="n">length</span> <span class="n">s</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="kr">else</span> <span class="o">-</span><span class="n">start</span><span class="p">)</span> <span class="n">insert</span> <span class="n">s</span>

<span class="kr">data</span> <span class="kt">Unpack_option</span> <span class="ow">=</span> <span class="kt">Grab</span> <span class="kt">Int</span> 
		   <span class="o">|</span> <span class="kt">Forward</span> <span class="kt">Int</span> 
		   <span class="o">|</span> <span class="kt">Backward</span> <span class="kt">Int</span> 
		   <span class="o">|</span> <span class="kt">GrabAll</span> 
		     <span class="kr">deriving</span> <span class="kt">Show</span>
<span class="nf">unpack</span> <span class="ow">::</span> <span class="p">[</span><span class="kt">Unpack_option</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="p">[[</span><span class="n">a</span><span class="p">]]</span>
<span class="nf">unpack</span> <span class="n">opt</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">foldl</span> <span class="n">aux</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kt">[]</span><span class="p">)</span><span class="o">.</span><span class="n">snd</span><span class="o">.</span><span class="n">reverse</span> <span class="c1">--(snd $ reverse) (foldl aux (0,[]) opt)</span>
    <span class="kr">where</span> <span class="n">aux</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="p">(</span><span class="kt">Grab</span> <span class="n">i</span><span class="p">)</span>      <span class="ow">=</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="o">!!</span><span class="p">[</span><span class="n">n</span><span class="o">..</span><span class="n">n</span><span class="o">+</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="kt">:</span> <span class="n">l</span><span class="p">)</span>
	  <span class="n">aux</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="p">(</span><span class="kt">Forward</span> <span class="n">i</span><span class="p">)</span>   <span class="ow">=</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
	  <span class="n">aux</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="p">(</span><span class="kt">Backward</span> <span class="n">i</span><span class="p">)</span>  <span class="ow">=</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
	  <span class="n">aux</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">l</span><span class="p">)</span> <span class="kt">GrabAll</span>       <span class="ow">=</span> <span class="p">(</span><span class="n">length</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">!!</span><span class="p">[</span><span class="n">n</span><span class="o">..</span><span class="p">]</span> <span class="kt">:</span> <span class="n">l</span><span class="p">)</span>
<span class="c1">-- could do a foldr so that no need reverse but need reverse opt</span>
<span class="c1">-- could to a str2Unpack_option so that str2Unpack_option &quot;A5 A*&quot; =&gt; [Grab 5,GrabAll]</span>
<span class="c1">----------------------------------------------------------------------------------------------------</span>

<span class="c1">-- use http://www.dcs.gla.ac.uk/~meurig/regexp/ for substS, ...</span>
<span class="c1">-- TODO, a subst that take group</span>
<span class="nf">subst</span> <span class="n">re</span> <span class="n">f</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">let</span> <span class="n">matchresult</span> <span class="ow">=</span> <span class="n">searchS</span> <span class="n">re</span> <span class="kt">[]</span> <span class="n">s</span> <span class="kr">in</span>
		   <span class="kr">if</span> <span class="n">matchedAny</span> <span class="n">matchresult</span> <span class="kr">then</span> 
		      <span class="n">beforeMatch</span> <span class="n">matchresult</span> <span class="o">++</span> 
		      <span class="n">f</span> <span class="p">(</span><span class="n">wholeMatch</span> <span class="n">matchresult</span><span class="p">)</span> <span class="o">++</span> 
		      <span class="n">afterMatch</span> <span class="n">matchresult</span>
		   <span class="kr">else</span> <span class="n">s</span>

<span class="nf">gsubst</span> <span class="n">re</span> <span class="n">f</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">let</span> <span class="n">matchresult</span> <span class="ow">=</span> <span class="n">searchS</span> <span class="n">re</span> <span class="kt">[]</span> <span class="n">s</span> <span class="kr">in</span>
		   <span class="kr">if</span> <span class="n">matchedAny</span> <span class="n">matchresult</span> <span class="kr">then</span> 
		      <span class="n">beforeMatch</span> <span class="n">matchresult</span> <span class="o">++</span> 
		      <span class="n">f</span> <span class="p">(</span><span class="n">wholeMatch</span> <span class="n">matchresult</span><span class="p">)</span> <span class="o">++</span> 
			<span class="p">(</span><span class="n">gsubst</span> <span class="n">re</span> <span class="n">f</span> <span class="p">(</span><span class="n">afterMatch</span> <span class="n">matchresult</span><span class="p">))</span>
		   <span class="kr">else</span> <span class="n">s</span>
<span class="c1">-- in perl, =~ do 2 things, first it returns a bool and bind $i</span>
<span class="c1">-- in haskell we are forced to do it in 2 steps</span>
<span class="p">(</span><span class="o">=~</span><span class="p">)</span> <span class="n">s</span> <span class="n">re</span> <span class="ow">=</span> <span class="kr">let</span> <span class="n">matchresult</span> <span class="ow">=</span> <span class="n">searchS</span> <span class="n">re</span> <span class="kt">[]</span> <span class="n">s</span> <span class="kr">in</span>
	    <span class="n">matchedAny</span> <span class="n">matchresult</span>
<span class="p">(</span><span class="o">==~</span><span class="p">)</span> <span class="n">s</span> <span class="n">re</span> <span class="ow">=</span> <span class="n">s</span> <span class="o">=~</span> <span class="p">(</span><span class="s">&quot;^&quot;</span><span class="o">++</span><span class="n">s</span><span class="o">++</span><span class="s">&quot;$&quot;</span><span class="p">)</span>

<span class="c1">-- the Regexp lib require regexp of the form   &quot; var@(...) var2@(...)&quot; i dont</span>
<span class="c1">-- like put name on this, prefer anonymous as in perl, that is &quot;(...) (...)&quot;</span>
<span class="c1">-- TODO, handle |, for example when match .(..)|.(..) i would like to return a list of one element</span>
<span class="c1">-- TODO, handle ?: of perl</span>
<span class="nf">match</span> <span class="n">re</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">let</span> <span class="p">(</span><span class="n">max</span><span class="p">,</span><span class="n">re2</span><span class="p">)</span> <span class="ow">=</span> <span class="n">re</span><span class="o">.</span><span class="n">foldl</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">acc</span><span class="p">)</span> <span class="n">c</span> <span class="ow">-&gt;</span> 
			    <span class="kr">if</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;(&#39;</span> <span class="kr">then</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">acc</span><span class="o">++</span><span class="s">&quot; &quot;</span><span class="o">++</span><span class="n">show</span> <span class="n">i</span><span class="o">++</span><span class="s">&quot;@(&quot;</span><span class="p">)</span> <span class="kr">else</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">acc</span><span class="o">++</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>
				   <span class="p">)</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kt">[]</span><span class="p">)</span>
		 <span class="n">matchresult</span> <span class="ow">=</span> <span class="n">s</span><span class="o">.</span><span class="n">searchS</span> <span class="n">re2</span> <span class="kt">[]</span>
		 <span class="c1">-- there is a pb cos in match &quot;(\\w+)=(.*)&quot; &quot;MAIL=&quot;, we dont get [&quot;MAIL&quot;,&quot;&quot;]</span>
		 <span class="c1">-- but only [&quot;MAIL&quot;], the lib does not handle well empty match</span>
		 <span class="n">subs</span>  <span class="ow">=</span> <span class="n">allSubexps</span> <span class="n">matchresult</span>
		 <span class="n">subs2</span> <span class="ow">=</span> <span class="kr">if</span>   <span class="p">(</span><span class="n">subs</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="o">&amp;&amp;</span> <span class="n">subs</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">fst</span> <span class="o">/=</span> <span class="n">show</span> <span class="p">(</span><span class="n">max</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
			     <span class="o">||</span><span class="p">(</span><span class="n">subs</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">max</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
			  <span class="kr">then</span> <span class="n">subs</span><span class="o">++</span><span class="p">[(</span><span class="n">show</span> <span class="p">(</span><span class="n">max</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="s">&quot;&quot;</span><span class="p">)]</span>
			  <span class="kr">else</span> <span class="n">subs</span>
		 <span class="n">subs3</span> <span class="ow">=</span> <span class="n">subs2</span><span class="o">.</span><span class="n">foldl</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">acc</span><span class="p">)</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">str</span><span class="p">)</span><span class="ow">-&gt;</span> 
			      <span class="kr">if</span> <span class="n">show</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span> <span class="kr">then</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">acc</span><span class="o">++</span><span class="p">[</span><span class="n">str</span><span class="p">])</span>
			      <span class="kr">else</span> <span class="p">((</span><span class="n">read</span> <span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">acc</span><span class="o">++</span><span class="n">replicate</span> <span class="p">((</span><span class="n">read</span> <span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="s">&quot;&quot;</span><span class="o">++</span><span class="p">[</span><span class="n">str</span><span class="p">])</span>
				       <span class="p">)</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kt">[]</span><span class="p">)</span> <span class="kr">in</span>
		 <span class="n">subs3</span><span class="o">.</span><span class="n">snd</span>
<span class="c1">-- cant make match and gmatch the same type, cos one give [] and gmatch give [[]]</span>
<span class="nf">gmatch</span> <span class="n">re</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">let</span> <span class="p">(</span><span class="n">max</span><span class="p">,</span><span class="n">re2</span><span class="p">)</span> <span class="ow">=</span> <span class="n">re</span><span class="o">.</span><span class="n">foldl</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">acc</span><span class="p">)</span> <span class="n">c</span> <span class="ow">-&gt;</span> 
			    <span class="kr">if</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;(&#39;</span> <span class="kr">then</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">acc</span><span class="o">++</span><span class="s">&quot; &quot;</span><span class="o">++</span><span class="n">show</span> <span class="n">i</span><span class="o">++</span><span class="s">&quot;@(&quot;</span><span class="p">)</span> <span class="kr">else</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">acc</span><span class="o">++</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>
				   <span class="p">)</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="kt">[]</span><span class="p">)</span>
		  <span class="n">matchresult</span> <span class="ow">=</span> <span class="n">s</span><span class="o">.</span><span class="n">searchS</span> <span class="n">re2</span> <span class="kt">[]</span> <span class="kr">in</span>
		  <span class="kr">if</span> <span class="n">matchedAny</span> <span class="n">matchresult</span> <span class="kr">then</span> <span class="p">(</span><span class="n">match</span> <span class="n">re</span> <span class="n">s</span><span class="p">)</span><span class="kt">:</span><span class="p">(</span><span class="n">gmatch</span> <span class="n">re</span> <span class="p">(</span><span class="n">afterMatch</span> <span class="n">matchresult</span><span class="p">))</span>
		  <span class="kr">else</span> <span class="kt">[]</span>


<span class="c1">--myl = &quot;cava et toi&quot;.match  &quot;(a..) et (t)oi&quot;</span>
<span class="c1">--myl = match &quot;(\\w+)&quot; &quot;pad tty etrre&quot;</span>
<span class="c1">--myl = match &quot;(\\w+)=&quot; &quot;PAD=/home/pad&quot;</span>
<span class="c1">--myl = match &quot;(\\w+)=(.*)&quot; &quot;PAD_MAIL=&quot;</span>

<span class="nf">pattern_matches</span> <span class="p">((</span><span class="n">re</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">s</span> <span class="o">=~</span> <span class="n">re</span> <span class="kr">then</span> <span class="n">v</span> <span class="kr">else</span> <span class="n">pattern_matches</span> <span class="n">xs</span> <span class="n">s</span>

<span class="c1">----------------------------------------------------------------------------------------------------</span>
<span class="c1">-- an imitation of the &#39;?&#39; C operator, could even define (:-) = (:) and then have bool ? v1 :- v2</span>
<span class="p">(</span><span class="o">?</span><span class="p">)</span> <span class="kt">True</span>  <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">=</span> <span class="n">a</span>
<span class="p">(</span><span class="o">?</span><span class="p">)</span> <span class="kt">False</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">=</span> <span class="n">b</span>

<span class="p">(</span><span class="o">==&gt;</span><span class="p">)</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>

<span class="c1">-- TODO, would like to overload . to behave as &gt;&gt;&gt; when monad, but hard to do (a -&gt; (a-&gt;b) -&gt; b) does</span>
<span class="c1">-- not unify with m a -&gt; (a -&gt; b) -&gt; m b, and want that ?</span>
<span class="c1">-- it is cool that record get autogenerated func, =&gt; we could do object.record_selector</span>
<span class="c1">-- consistency</span>

<span class="p">(</span><span class="o">.</span><span class="p">)</span> <span class="n">o</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">f</span> <span class="n">o</span> <span class="c1">-- object notation for object fan, use it if function have more than one parameter or</span>
	      <span class="c1">-- if you want make an &quot;oo-line&quot; (ex o.words.reverse.unwords)</span>
<span class="p">(</span><span class="o">.&gt;</span><span class="p">)</span> <span class="n">m</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">m</span> <span class="o">&gt;&gt;=</span> <span class="p">(</span><span class="nf">\</span><span class="n">o</span> <span class="ow">-&gt;</span> <span class="n">return</span> <span class="p">(</span><span class="n">f</span> <span class="n">o</span><span class="p">))</span> <span class="c1">-- &lt;=&gt; &gt;&gt;&gt;</span>

<span class="p">(</span><span class="err">°</span><span class="p">)</span> <span class="n">f</span> <span class="n">g</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">f</span> <span class="p">(</span><span class="n">g</span> <span class="n">x</span><span class="p">)</span>
<span class="p">(</span><span class="n">f</span> <span class="o">$</span> <span class="n">g</span><span class="p">)</span> <span class="n">x</span> <span class="ow">=</span> <span class="p">(</span><span class="n">g</span> <span class="err">°</span> <span class="n">f</span><span class="p">)</span> <span class="n">x</span>

<span class="nf">next_char</span> <span class="n">c</span> <span class="ow">=</span> <span class="n">chr</span> <span class="p">(</span><span class="n">ord</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="nf">show_float</span> <span class="n">i</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">showFFloat</span> <span class="p">(</span><span class="kt">Just</span> <span class="n">i</span><span class="p">)</span> <span class="n">f</span> <span class="s">&quot;&quot;</span>

<span class="nf">fixpoint</span> <span class="n">f</span> <span class="n">d</span> <span class="o">|</span> <span class="n">f</span> <span class="n">d</span> <span class="o">==</span> <span class="n">d</span>  <span class="ow">=</span> <span class="n">d</span>
	     <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="n">fixpoint</span> <span class="n">f</span> <span class="p">(</span><span class="n">f</span> <span class="n">d</span><span class="p">)</span>
<span class="nf">times</span> <span class="ow">=</span> <span class="n">replicate</span>

<span class="nf">join</span> <span class="n">e</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="kt">[]</span>
<span class="nf">join</span> <span class="n">e</span> <span class="n">xs</span> <span class="ow">=</span> <span class="n">foldr1</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">x</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="o">++</span> <span class="n">e</span> <span class="o">++</span> <span class="n">x</span><span class="p">)</span> <span class="n">xs</span> 
<span class="c1">-- join e []     = []</span>
<span class="c1">-- join e [x]    = x</span>
<span class="c1">-- join e (x:xs) = x ++ e ++ join e xs</span>
<span class="c1">-- ex: join &quot; &quot; [&quot;bi&quot;,&quot;te&quot;,&quot;di&quot;,&quot;ck&quot;] == &quot;bi te di ck&quot;</span>

<span class="c1">-- string only split</span>
<span class="c1">--split e xs = splitaux e [] xs</span>
<span class="c1">--splitaux e a xs | xs.length &lt; e.length     = [a ++ xs]</span>
<span class="c1">--		  | take (e.length) xs == e  = a:(splitaux e [] (drop (e.length) xs))</span>
<span class="c1">--		  | otherwise                = splitaux e (a++[head xs]) (tail xs)</span>
<span class="c1">-- better split, handle regexp</span>
<span class="nf">split</span> <span class="n">re</span> <span class="n">xs</span> <span class="ow">=</span> <span class="kr">let</span> <span class="n">matchresult</span> <span class="ow">=</span> <span class="n">searchS</span> <span class="n">re</span> <span class="kt">[]</span> <span class="n">xs</span> <span class="kr">in</span>
		   <span class="kr">if</span> <span class="n">matchedAny</span> <span class="n">matchresult</span> 
		   <span class="kr">then</span> <span class="p">(</span><span class="n">beforeMatch</span> <span class="n">matchresult</span><span class="p">)</span><span class="kt">:</span><span class="p">(</span><span class="n">split</span> <span class="n">re</span> <span class="p">(</span><span class="n">afterMatch</span> <span class="n">matchresult</span><span class="p">))</span>
		   <span class="kr">else</span> <span class="p">[</span><span class="n">xs</span><span class="p">]</span>
<span class="c1">--test=split &quot;\\s+&quot; &quot;toto titi  tia to&quot;</span>

<span class="nf">break_char</span> <span class="n">c</span> <span class="n">f</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">let</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">=</span> <span class="n">break</span> <span class="p">(</span><span class="o">==</span> <span class="n">c</span><span class="p">)</span> <span class="n">s</span> <span class="kr">in</span>
		   <span class="kr">if</span> <span class="n">b</span> <span class="o">==</span> <span class="kt">[]</span> <span class="kr">then</span> <span class="n">a</span> <span class="kr">else</span> <span class="n">f</span> <span class="n">a</span> <span class="p">(</span><span class="n">tail</span> <span class="n">b</span><span class="p">)</span>

<span class="nf">upcase</span> <span class="n">xs</span>     <span class="ow">=</span> <span class="n">map</span> <span class="n">toUpper</span> <span class="n">xs</span>
<span class="nf">downcase</span> <span class="n">xs</span>   <span class="ow">=</span> <span class="n">map</span> <span class="n">toLower</span> <span class="n">xs</span>
<span class="nf">capitalize</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">toUpper</span> <span class="n">x</span> <span class="kt">:</span> <span class="n">xs</span>

<span class="nf">tonum</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">fromInteger</span> <span class="n">x</span>

<span class="nf">hex</span> <span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="kt">:</span><span class="p">(</span><span class="n">&#39;x&#39;</span><span class="kt">:</span><span class="n">s</span><span class="p">))</span> <span class="ow">=</span> <span class="n">fst</span> <span class="p">(</span><span class="n">head</span> <span class="p">(</span><span class="n">readHex</span> <span class="n">s</span><span class="p">))</span> <span class="c1">-- TODO do some check</span>
<span class="nf">oct</span> <span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="kt">:</span><span class="p">(</span><span class="n">&#39;o&#39;</span><span class="kt">:</span><span class="n">s</span><span class="p">))</span> <span class="ow">=</span> <span class="n">fst</span> <span class="p">(</span><span class="n">head</span> <span class="p">(</span><span class="n">readOct</span> <span class="n">s</span><span class="p">))</span> <span class="c1">-- TODO do some check</span>
<span class="nf">tohex</span> <span class="n">i</span> <span class="ow">=</span> <span class="s">&quot;0x&quot;</span><span class="o">++</span><span class="n">aux</span> <span class="n">i</span> 
    <span class="kr">where</span> <span class="n">aux</span> <span class="n">i</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span> <span class="s">&quot;&quot;</span> <span class="kr">else</span> <span class="n">aux</span> <span class="p">(</span><span class="n">i</span> <span class="p">`</span><span class="n">div</span><span class="p">`</span> <span class="mi">16</span><span class="p">)</span><span class="o">++</span><span class="p">(([</span><span class="sc">&#39;0&#39;</span><span class="o">..</span><span class="sc">&#39;9&#39;</span><span class="p">]</span><span class="o">++</span><span class="p">[</span><span class="sc">&#39;A&#39;</span><span class="o">..</span><span class="sc">&#39;F&#39;</span><span class="p">])</span><span class="o">!!</span><span class="p">[</span><span class="n">i</span> <span class="p">`</span><span class="n">mod</span><span class="p">`</span> <span class="mi">16</span><span class="p">])</span>
<span class="nf">tooct</span> <span class="n">i</span> <span class="ow">=</span> <span class="s">&quot;0o&quot;</span><span class="o">++</span><span class="n">aux</span> <span class="n">i</span> 
    <span class="kr">where</span> <span class="n">aux</span> <span class="n">i</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span> <span class="s">&quot;&quot;</span> <span class="kr">else</span> <span class="n">aux</span> <span class="p">(</span><span class="n">i</span> <span class="p">`</span><span class="n">div</span><span class="p">`</span> <span class="mi">8</span><span class="p">)</span><span class="o">++</span><span class="p">([</span><span class="sc">&#39;0&#39;</span><span class="o">..</span><span class="sc">&#39;7&#39;</span><span class="p">]</span><span class="o">!!</span><span class="p">[</span><span class="n">i</span> <span class="p">`</span><span class="n">mod</span><span class="p">`</span> <span class="mi">8</span><span class="p">])</span>


<span class="nf">unique</span>                     <span class="ow">::</span> <span class="p">(</span><span class="kt">Eq</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="c1">-- dont know why but forced to put the type</span>
<span class="nf">unique</span> <span class="ow">=</span> <span class="n">nub</span>

<span class="nf">insert_at</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="nf">insert_at</span> <span class="n">i</span> <span class="n">toadd</span> <span class="n">xs</span> <span class="ow">=</span> <span class="kr">let</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">=</span> <span class="n">splitAt</span> <span class="n">i</span> <span class="n">xs</span> <span class="kr">in</span>
			   <span class="n">a</span><span class="o">++</span><span class="n">toadd</span><span class="o">++</span><span class="n">b</span>

<span class="nf">replace</span> <span class="ow">::</span> <span class="p">[(</span><span class="kt">Int</span><span class="p">,</span> <span class="n">a</span><span class="p">)]</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
<span class="nf">replace</span> <span class="n">assoc</span> <span class="n">xs</span> <span class="ow">=</span> <span class="n">assoc</span><span class="o">.</span><span class="n">foldl</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">e</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kr">let</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="ow">=</span> <span class="n">splitAt</span> <span class="n">i</span> <span class="n">a</span> <span class="kr">in</span> <span class="n">x</span><span class="o">++</span><span class="p">[</span><span class="n">e</span><span class="p">]</span><span class="o">++</span><span class="n">y</span> <span class="p">)</span> <span class="n">xs</span>

<span class="nf">shift</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">xs</span><span class="p">)</span>
<span class="nf">pop</span> <span class="n">xs</span> <span class="ow">=</span> <span class="p">(</span><span class="n">init</span> <span class="n">xs</span><span class="p">,</span> <span class="n">last</span> <span class="n">xs</span><span class="p">)</span> <span class="c1">-- more efficient let (a,[b]) = splitAt (xs.length - 1) xs in (a,b)</span>

<span class="nf">foldl_index</span> <span class="n">f</span> <span class="n">acc</span> <span class="n">xs</span> <span class="ow">=</span> <span class="n">foldl</span> <span class="n">f</span> <span class="n">acc</span> <span class="p">(</span><span class="n">zip</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="p">]</span> <span class="n">xs</span><span class="p">)</span>

<span class="nf">complex_i</span> <span class="ow">=</span> <span class="mi">0</span> <span class="kt">:+</span> <span class="mi">1</span>

<span class="p">(</span><span class="o">&lt;=&gt;</span><span class="p">)</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="n">compare</span> <span class="n">a</span> <span class="n">b</span>

<span class="c1">--debug expr = trace (&quot;Debug:&quot;++show expr++&quot;\n&quot;) expr</span>
<span class="c1">----------------------------------------------------------------------------------------------------</span>
<span class="kr">infixl</span> <span class="mi">1</span> <span class="o">&gt;&gt;&gt;</span>
<span class="p">(</span><span class="o">&gt;&gt;&gt;</span><span class="p">)</span> <span class="n">monad</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">monad</span> <span class="o">&gt;&gt;=</span> <span class="p">(</span><span class="n">return</span> <span class="err">°</span> <span class="n">f</span><span class="p">)</span>
<span class="nf">eval</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">x</span> <span class="o">&gt;&gt;=</span> <span class="p">(</span><span class="n">putStrLn</span> <span class="err">°</span> <span class="n">show</span><span class="p">)</span>

<span class="nf">action</span> <span class="p">`</span><span class="n">when</span><span class="p">`</span> <span class="n">bool</span>   <span class="ow">=</span> <span class="kr">if</span> <span class="n">bool</span> <span class="kr">then</span> <span class="n">action</span> <span class="kr">else</span> <span class="n">return</span> <span class="nb">()</span>
<span class="nf">action</span> <span class="p">`</span><span class="n">unless</span><span class="p">`</span> <span class="n">bool</span> <span class="ow">=</span> <span class="n">action</span> <span class="p">`</span><span class="n">when</span><span class="p">`</span> <span class="p">(</span><span class="n">not</span> <span class="n">bool</span><span class="p">)</span>
<span class="nf">cat</span> <span class="n">file</span> <span class="ow">=</span> <span class="n">readFile</span> <span class="n">file</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">lines</span>
<span class="nf">contents</span> <span class="ow">=</span> <span class="n">getContents</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">lines</span>

<span class="p">(</span><span class="o">&lt;&gt;</span><span class="p">)</span> <span class="ow">=</span> <span class="kr">do</span> <span class="n">l</span> <span class="ow">&lt;-</span> <span class="n">argv</span>
	  <span class="kr">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="kt">[]</span><span class="p">)</span> <span class="kr">then</span> <span class="n">contents</span> <span class="kr">else</span> <span class="n">foldM</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">e</span> <span class="ow">-&gt;</span> <span class="n">cat</span> <span class="n">e</span> <span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="n">a</span><span class="o">++</span><span class="p">))</span> <span class="kt">[]</span> <span class="n">l</span>

<span class="c1">-- i know it is just poor code, but haskell force me</span>
<span class="c1">-- TODO, dont work, seems monad are lazy too, dont understand io in haskell anymore :(</span>
<span class="c1">--  if do {l &lt;- exec &quot;ps ux&quot;; l2 &lt;- exec &quot;who&quot;; l.mapM putStrLn} print the contents of l2 !!</span>
<span class="nf">exec</span> <span class="n">s</span> <span class="ow">=</span> <span class="kr">do</span> <span class="kr">_</span> <span class="ow">&lt;-</span> <span class="n">system</span> <span class="p">(</span><span class="n">s</span><span class="o">++</span><span class="s">&quot; &gt; /tmp/file&quot;</span><span class="p">)</span>
	    <span class="n">cat</span> <span class="s">&quot;/tmp/file&quot;</span>

<span class="nf">rand</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="kt">Int</span> <span class="c1">-- force to do that to resolve overloading :(</span>
<span class="nf">rand</span> <span class="ow">=</span> <span class="n">getStdRandom</span> <span class="err">°</span> <span class="n">randomR</span>
<span class="nf">stdrand</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="kt">Double</span>
<span class="nf">stdrand</span> <span class="ow">=</span> <span class="n">getStdRandom</span> <span class="p">(</span><span class="n">randomR</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="nf">srand</span> <span class="n">val</span> <span class="ow">=</span> <span class="n">setStdGen</span> <span class="p">(</span><span class="n">mkStdGen</span> <span class="n">val</span><span class="p">)</span>

<span class="c1">-- in haskell we have getEnv::String -&gt; String, but not getEnvs :(</span>
<span class="nf">env</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="p">(</span><span class="kt">Assoc</span> <span class="kt">String</span> <span class="kt">String</span><span class="p">)</span>
<span class="nf">env</span> <span class="ow">=</span> <span class="n">exec</span> <span class="s">&quot;env&quot;</span> <span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">s</span> <span class="ow">-&gt;</span> <span class="kr">let</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span> <span class="ow">=</span> <span class="n">s</span><span class="o">.</span><span class="n">match</span> <span class="s">&quot;(</span><span class="se">\\</span><span class="s">w+)=(.*)&quot;</span> <span class="kr">in</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">))</span> <span class="o">$</span> <span class="n">fromList</span><span class="p">)</span>
<span class="c1">-- env = getEnvironment  -- for ghc</span>
<span class="nf">argv</span> <span class="ow">=</span> <span class="n">getArgs</span>

<span class="nf">just</span> <span class="p">(</span><span class="kt">Just</span> <span class="n">x</span><span class="p">)</span> <span class="ow">=</span> <span class="n">x</span>
<span class="nf">just</span> <span class="kr">_</span> <span class="ow">=</span> <span class="ne">error</span> <span class="s">&quot;Common:just&quot;</span>

<span class="nf">exit</span> <span class="n">i</span> <span class="ow">=</span> <span class="n">primExitWith</span> <span class="n">i</span>
<span class="nf">usage</span> <span class="n">s</span> <span class="ow">=</span> <span class="n">putStrLn</span> <span class="p">(</span><span class="s">&quot;usage:&quot;</span><span class="o">++</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">exit</span> <span class="mi">1</span>

<span class="c1">-- printf a la danvy</span>
<span class="c1">-- type fmt a = </span>
<span class="c1">----------------------------------------------------------------------------------------------------</span>
<span class="c1">--ghc now = do cl &lt;- getClockTime</span>
<span class="c1">--ghc 	       return (toUTCTime cl)</span>
<span class="c1">--ghc localtime = toCalendarTime . toClockTime </span>
<span class="c1">--ghc strftime fmt time = formatCalendarTime defaultTimeLocale  fmt time</span>
<span class="c1">--ghc nulltime = TimeDiff {tdYear=0, tdMonth=0, tdDay=0, tdHour=0, tdMin=0, tdSec=0, tdPicosec = 0}</span>

<span class="c1">----------------------------------------------------------------------------------------------------</span>

<span class="c1">-- Collects e [e] where ...</span>
<span class="c1">-- Collects e (e -&gt; Bool) where ...</span>
<span class="c1">-- Collects Char BitSet where ...</span>
<span class="c1">-- (Hashable e, Collects a ce) Collects e (Array Int ce)</span>
<span class="c1">-- type Assoc a b = [(a,b)]</span>
<span class="c1">--    </span>
<span class="c1">-- -- this class support only collection of kind/1 =&gt; :( cos assoc dont match this criteria</span>
<span class="c1">-- -- note that some new type variable are introduced (something impossible with ocaml oo, can not</span>
<span class="c1">-- --  define a list object and then a fold, cos the type of the accumulator is new</span>
<span class="c1">-- --  can do it in caml/C++ by making fold an external function of the class</span>
<span class="c1">-- class Collection1 c where</span>
<span class="c1">--     member1 :: Eq e =&gt; e -&gt; c e -&gt; Bool -- need Eq e, otherwise at instance declaration, when member = elem, pb (WHY?)</span>
<span class="c1">--     cmap1   :: (a -&gt; b) -&gt; c a -&gt; c b</span>
<span class="c1">--     insert1 :: e -&gt; c e -&gt; c e</span>
<span class="c1">-- instance Collection1 [] where</span>
<span class="c1">--     member1 = elem</span>
<span class="c1">--     cmap1   = map</span>
<span class="c1">--     insert1 = (:)</span>
<span class="c1">-- -- instance Collection1 Assoc ..., is not possible</span>
<span class="c1">-- </span>
<span class="c1">-- -- class Collection2 e c where, useless constructor class do the same job</span>

<span class="c1">-- edison is cool, but they dont use depedencies =&gt; cant make a superclass Collection of Assoc and Sequence</span>
<span class="c1">--  morover, there are too many classes, i prefer one class Collection, and then instance OrdSet,Bag,OrdBag,...</span>
<span class="c1">-- edison use constructor class =&gt; if a type is not of the form c a, then it does not work</span>
<span class="c1">-- as for the Functor class, this is a pb cos you cant make an instance Functor Assoc, cos Assoc is of kind/2</span>
<span class="c1">-- TODO, to allow default null, need Eq ce =&gt;, mais apres foldl need des Eq [b] =&gt;</span>
<span class="c1">--  must cut Collection in section CollectionEq, Collection</span>
<span class="kr">class</span> <span class="kt">Collection</span> <span class="n">e</span> <span class="n">ce</span> <span class="o">|</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="n">e</span> <span class="kr">where</span>
    <span class="c1">-- constructors</span>
    <span class="n">empty</span> <span class="ow">::</span> <span class="n">ce</span>
    <span class="n">single</span> <span class="ow">::</span> <span class="n">e</span> <span class="ow">-&gt;</span> <span class="n">ce</span>
    <span class="n">insert</span> <span class="ow">::</span> <span class="n">e</span> <span class="ow">-&gt;</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="n">ce</span>

    <span class="n">fromList</span> <span class="ow">::</span> <span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="n">ce</span>
    <span class="n">fromList</span> <span class="n">xs</span> <span class="ow">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">foldl</span> <span class="p">(</span><span class="n">flip</span> <span class="n">insert</span><span class="p">)</span> <span class="n">empty</span>
    <span class="n">copy</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="n">e</span> <span class="ow">-&gt;</span> <span class="n">ce</span>
<span class="c1">--    union, intersect, difference :: ce -&gt; ce -&gt; ce</span>
        <span class="c1">-- tabulate ?</span>

    <span class="c1">-- destructors</span>
     <span class="c1">-- simple</span>
    <span class="n">delete</span> <span class="ow">::</span> <span class="n">e</span> <span class="ow">-&gt;</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="n">ce</span>

    <span class="n">delete_all</span><span class="ow">::</span> <span class="n">e</span> <span class="ow">-&gt;</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="n">ce</span> <span class="c1">-- not relevant for Set	      </span>
     <span class="c1">-- predicate based</span>

    <span class="n">filter</span> <span class="ow">::</span> <span class="p">(</span><span class="n">e</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="n">ce</span>
    <span class="n">partition</span><span class="ow">::</span> <span class="p">(</span><span class="n">e</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">ce</span><span class="p">,</span><span class="n">ce</span><span class="p">)</span>
    <span class="c1">-- observers</span>
    <span class="n">toList</span> <span class="ow">::</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">e</span><span class="p">]</span>

    <span class="n">size</span> <span class="ow">::</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
<span class="c1">--    member :: e -&gt; ce -&gt; Bool</span>
<span class="c1">--    null :: ce -&gt; Bool</span>
<span class="c1">--    null ce = ce == empty</span>
    

    <span class="c1">-- iterators</span>

       <span class="c1">--    concatMap, cfoldr + 1, reducer* ?</span>
    <span class="n">foldl</span><span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">e</span> <span class="ow">-&gt;</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="n">a</span>
    <span class="n">each</span> <span class="ow">::</span> <span class="p">(</span><span class="n">e</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span>

    <span class="c1">-- find each</span>
    <span class="c1">-- zip unzip zippWith </span>
<span class="c1">--    map:: (e -&gt; b) -&gt; ce -&gt; cb -- cant define as is, would like a depedency constraint</span>
	                       <span class="c1">-- such as ce+b-&gt;cb</span>
	                       <span class="c1">-- can be put outside and use insert/observers</span>

<span class="c1">-- TODO make AssocOrd class, OrdColl, ...</span>
<span class="c1">-- goal: Set,Bag</span>
<span class="c1">-- implementation: list,ordlist, (if odererd =&gt; can use bintree), okasaki optimised</span>

<span class="nf">null</span> <span class="n">es</span> <span class="ow">=</span> <span class="n">es</span> <span class="o">==</span> <span class="n">empty</span>
<span class="nf">member</span> <span class="n">e</span> <span class="n">es</span> <span class="ow">=</span> <span class="n">e</span> <span class="p">`</span><span class="n">elem</span><span class="p">`</span> <span class="p">(</span><span class="n">es</span><span class="o">.</span><span class="n">toList</span><span class="p">)</span>

<span class="c1">-- TODO, could make union more cool, to allow each time different collection</span>
<span class="c1">-- could allow to do in place of a.insert e, [e]+a </span>
<span class="nf">union</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">Collection</span> <span class="n">a</span> <span class="n">c</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="n">c</span> <span class="ow">-&gt;</span> <span class="n">c</span> <span class="ow">-&gt;</span> <span class="n">c</span> <span class="c1">-- to force the same collection type</span>
<span class="nf">union</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="n">b</span><span class="o">.</span><span class="n">foldl</span> <span class="p">(</span><span class="n">flip</span> <span class="n">insert</span><span class="p">)</span> <span class="n">a</span>
<span class="nf">intersect</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">Collection</span> <span class="n">a</span> <span class="n">c</span><span class="p">,</span> <span class="kt">Eq</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="n">c</span> <span class="ow">-&gt;</span> <span class="n">c</span> <span class="ow">-&gt;</span> <span class="n">c</span> <span class="c1">-- to force the same collection type</span>
<span class="nf">intersect</span>  <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="n">a</span><span class="o">.</span><span class="n">foldl</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">e</span> <span class="ow">-&gt;</span> <span class="kr">if</span> <span class="n">e</span> <span class="p">`</span><span class="n">member</span><span class="p">`</span> <span class="n">b</span> <span class="kr">then</span> <span class="n">a</span><span class="o">.</span><span class="n">insert</span> <span class="n">e</span> <span class="kr">else</span> <span class="n">a</span><span class="p">)</span> <span class="n">empty</span>
<span class="nf">difference</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">Collection</span> <span class="n">a</span> <span class="n">c</span><span class="p">,</span> <span class="kt">Eq</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="n">c</span> <span class="ow">-&gt;</span> <span class="n">c</span> <span class="ow">-&gt;</span> <span class="n">c</span> <span class="c1">-- to force the same collection type</span>
<span class="nf">difference</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="n">a</span><span class="o">.</span><span class="n">foldl</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">e</span> <span class="ow">-&gt;</span> <span class="kr">if</span> <span class="n">e</span> <span class="p">`</span><span class="n">member</span><span class="p">`</span> <span class="n">b</span> <span class="kr">then</span> <span class="n">a</span> <span class="kr">else</span> <span class="n">a</span><span class="o">.</span><span class="n">insert</span> <span class="n">e</span><span class="p">)</span> <span class="n">empty</span>
    
<span class="kr">class</span> <span class="kt">Collection</span> <span class="n">e</span> <span class="n">ce</span> <span class="ow">=&gt;</span> <span class="kt">Sequence</span> <span class="n">e</span> <span class="n">ce</span> <span class="kr">where</span>
    <span class="c1">-- constructors</span>
    <span class="n">cons</span><span class="p">,</span><span class="n">snoc</span> <span class="ow">::</span> <span class="n">e</span> <span class="ow">-&gt;</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="n">ce</span>
    <span class="n">append</span> <span class="ow">::</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="n">ce</span>
    <span class="n">append</span> <span class="ow">=</span> <span class="n">union</span>
    <span class="c1">-- destructors</span>
     <span class="c1">--simple</span>
    <span class="n">lview</span><span class="p">,</span><span class="n">rview</span> <span class="ow">::</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">ce</span><span class="p">)</span>

    <span class="n">lhead</span><span class="p">,</span><span class="n">rhead</span> <span class="ow">::</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="n">e</span>
    <span class="n">ltail</span><span class="p">,</span><span class="n">rtail</span> <span class="ow">::</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="n">ce</span>
     <span class="c1">-- int based</span>
    <span class="n">take</span><span class="p">,</span><span class="n">drop</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="n">ce</span>
    <span class="n">splitAt</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">ce</span><span class="p">,</span><span class="n">ce</span><span class="p">)</span>
    <span class="n">subseq</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="n">ce</span>
    <span class="n">takeWhile</span><span class="p">,</span><span class="n">dropWhile</span><span class="ow">::</span> <span class="p">(</span><span class="n">e</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="n">ce</span>
    <span class="n">splitWhile</span> <span class="ow">::</span> <span class="p">(</span><span class="n">e</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">ce</span><span class="p">,</span><span class="n">ce</span><span class="p">)</span>
    <span class="c1">-- misc</span>
    <span class="n">reverse</span> <span class="ow">::</span> <span class="n">ce</span> <span class="ow">-&gt;</span> <span class="n">ce</span>
    <span class="c1">--    concat :: [ce] -&gt; ce; not [ce] but ce ce =&gt; how ?</span>
    <span class="c1">-- update, inbounds, adjust, [map|foldl|foldr]WithIndex</span>

<span class="c1">-- instance [a], Queue [a], okasaki optimised</span>

<span class="c1">-- TODO, make too strong condition, Eq b for example, could make keyss outside the class</span>
<span class="kr">class</span> <span class="p">(</span><span class="kt">Eq</span> <span class="n">a</span><span class="p">,</span> <span class="kt">Eq</span> <span class="n">b</span><span class="p">,</span> <span class="kt">Collection</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="n">cab</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Association</span> <span class="n">a</span> <span class="n">b</span> <span class="n">cab</span> <span class="o">|</span> <span class="n">cab</span> <span class="ow">-&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">cab</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="kr">where</span>
    <span class="n">keys</span> <span class="ow">::</span> <span class="n">cab</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
    <span class="n">values</span><span class="ow">::</span> <span class="n">cab</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span>
    <span class="n">has_key</span><span class="ow">::</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">cab</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
    <span class="n">has_key</span> <span class="n">k</span> <span class="n">xs</span> <span class="ow">=</span> <span class="n">k</span> <span class="p">`</span><span class="n">elem</span><span class="p">`</span> <span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span>
    <span class="n">delete_key</span> <span class="ow">::</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">cab</span> <span class="ow">-&gt;</span> <span class="n">cab</span>
    <span class="n">each_key</span> <span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">cab</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span>
    <span class="n">keyss</span> <span class="ow">::</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">cab</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
    <span class="n">keyss</span> <span class="n">v</span> <span class="n">cab</span> <span class="ow">=</span> <span class="n">cab</span><span class="o">.</span><span class="n">toList</span><span class="o">.</span><span class="n">filter</span> <span class="p">(</span><span class="n">snd</span> <span class="o">$</span> <span class="p">(</span><span class="o">==</span><span class="n">v</span><span class="p">))</span><span class="o">.</span><span class="n">map</span> <span class="n">fst</span>
    <span class="n">has_value</span><span class="ow">::</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">cab</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
    <span class="n">has_value</span> <span class="n">v</span> <span class="n">xs</span> <span class="ow">=</span> <span class="n">v</span> <span class="p">`</span><span class="n">elem</span><span class="p">`</span> <span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>		  

<span class="c1">-- instance Assoc, okasaki optimised (bintree, ...)</span>
<span class="c1">-- AssocMulti, key -&gt; list</span>

<span class="nf">map</span> <span class="n">f</span> <span class="kt">[]</span>     <span class="ow">=</span> <span class="kt">[]</span>
<span class="nf">map</span> <span class="n">f</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">f</span> <span class="n">x</span><span class="kt">:</span> <span class="n">map</span> <span class="n">f</span> <span class="n">xs</span>
<span class="nf">cmap</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">toList</span> <span class="err">°</span> <span class="n">map</span> <span class="n">f</span> <span class="err">°</span> <span class="n">fromList</span> <span class="c1">-- cant make in the type that this must be the same collection</span>

<span class="kr">class</span> <span class="kt">Indexable</span> <span class="n">i</span> <span class="n">ca</span> <span class="n">a</span> <span class="o">|</span> <span class="n">ca</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="kr">where</span>
    <span class="p">(</span><span class="o">!~</span><span class="p">)</span> <span class="ow">::</span> <span class="n">ca</span> <span class="ow">-&gt;</span> <span class="n">i</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="n">a</span> <span class="c1">-- lookupM</span>
    <span class="p">(</span><span class="o">!</span><span class="p">)</span> <span class="ow">::</span> <span class="n">ca</span> <span class="ow">-&gt;</span> <span class="n">i</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="c1">-- lookup, to be more esthetic do s!(0) rather than s!0</span>
    <span class="p">(</span><span class="o">!</span><span class="p">)</span> <span class="n">xs</span> <span class="n">i</span> <span class="ow">=</span> <span class="p">(</span><span class="n">xs</span><span class="o">!~</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">just</span>
    <span class="c1">-- lookupWithDefaul</span>
    <span class="p">(</span><span class="o">!!</span><span class="p">)</span> <span class="ow">::</span> <span class="n">ca</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
    <span class="p">(</span><span class="o">!!</span><span class="p">)</span> <span class="n">xs</span> <span class="n">is</span> <span class="ow">=</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">i</span> <span class="ow">-&gt;</span> <span class="n">xs</span> <span class="o">!</span> <span class="n">i</span><span class="p">)</span> <span class="n">is</span> <span class="c1">-- seems you can not define with infix notation default class value</span>

<span class="c1">-------------------------------</span>
<span class="kr">instance</span> <span class="p">(</span><span class="kt">Num</span> <span class="n">b</span><span class="p">,</span><span class="kt">Ord</span> <span class="n">b</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Indexable</span> <span class="n">b</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="n">a</span> <span class="kr">where</span>
<span class="c1">-- to allow s![1..]</span>
<span class="c1">-- note: a &#39;try (...) with&#39; would be more efficient that constantly check for array bound</span>
<span class="c1">-- note: we stop as soon as we have a big index =&gt; xs ! [1000, 2,3] if length xs &lt; 1000 will give [] </span>
<span class="c1">--   (to handle infinite list)</span>
<span class="c1">-- TODO allow s!![-4..]</span>
    <span class="p">(</span><span class="o">!!</span><span class="p">)</span> <span class="n">xs</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="kt">[]</span>
    <span class="p">(</span><span class="o">!!</span><span class="p">)</span> <span class="n">xs</span> <span class="p">(</span><span class="n">i</span><span class="kt">:</span><span class="n">is</span><span class="p">)</span> <span class="o">|</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">fromInt</span> <span class="p">(</span><span class="n">length</span> <span class="n">xs</span><span class="p">))</span> <span class="ow">=</span> <span class="kt">[]</span> <span class="c1">-- handle infinite list</span>
		   <span class="o">|</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span>          <span class="ow">=</span> <span class="n">xs</span><span class="o">!</span><span class="p">((</span><span class="n">fromInt</span> <span class="p">(</span><span class="n">length</span> <span class="n">xs</span><span class="p">))</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="kt">:</span> <span class="n">xs</span><span class="o">!!</span><span class="n">is</span>
		   <span class="o">|</span> <span class="n">otherwise</span>      <span class="ow">=</span> <span class="n">xs</span><span class="o">!</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="kt">:</span> <span class="n">xs</span><span class="o">!!</span><span class="n">is</span>


<span class="c1">--    (x:_)  !~ 0       = Just x</span>
    <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="kr">_</span><span class="p">)</span>  <span class="o">!~</span> <span class="n">n</span> <span class="o">|</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span>  <span class="ow">=</span> <span class="kt">Just</span> <span class="n">x</span> <span class="c1">-- allow s!3.2</span>
    <span class="p">(</span><span class="kr">_</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="o">!~</span> <span class="n">n</span> <span class="o">|</span> <span class="n">n</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">=</span> <span class="n">xs</span> <span class="o">!~</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="kr">_</span>  <span class="o">!~</span> <span class="kr">_</span>       <span class="ow">=</span> <span class="kt">Nothing</span>


<span class="kr">instance</span> <span class="kt">Collection</span> <span class="n">a</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="kr">where</span>
    <span class="n">insert</span> <span class="ow">=</span> <span class="p">(</span><span class="kt">:</span><span class="p">)</span>

    <span class="n">foldl</span> <span class="n">f</span> <span class="n">z</span> <span class="kt">[]</span>      <span class="ow">=</span> <span class="n">z</span>
    <span class="n">foldl</span> <span class="n">f</span> <span class="n">z</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span>  <span class="ow">=</span> <span class="n">foldl</span> <span class="n">f</span> <span class="p">(</span><span class="n">f</span> <span class="n">z</span> <span class="n">x</span><span class="p">)</span> <span class="n">xs</span>
    
    <span class="n">filter</span> <span class="n">p</span> <span class="n">xs</span>       <span class="ow">=</span> <span class="p">[</span> <span class="n">x</span> <span class="o">|</span> <span class="n">x</span> <span class="ow">&lt;-</span> <span class="n">xs</span><span class="p">,</span> <span class="n">p</span> <span class="n">x</span> <span class="p">]</span>
    <span class="n">each</span> <span class="ow">=</span> <span class="n">mapM_</span>
    <span class="n">toList</span> <span class="ow">=</span> <span class="n">id</span>
    <span class="n">fromList</span> <span class="ow">=</span> <span class="n">id</span> <span class="c1">-- default fromList dont respect the order</span>
    <span class="n">empty</span> <span class="ow">=</span> <span class="kt">[]</span>


<span class="kr">instance</span> <span class="kt">Sequence</span> <span class="n">a</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="kr">where</span>
    <span class="n">reverse</span>    <span class="ow">=</span> <span class="n">foldl</span> <span class="p">(</span><span class="n">flip</span> <span class="p">(</span><span class="kt">:</span><span class="p">))</span> <span class="kt">[]</span>

<span class="c1">-- this can be dangerous, cos insert for an Association is replace/add (key,val) whereas</span>
<span class="c1">-- for a list with simply add, and so use Assoc if you want to choose</span>
<span class="c1">-- same for each, each will print all the pair, even the obsolete</span>
<span class="kr">instance</span> <span class="p">(</span><span class="kt">Eq</span> <span class="n">a</span><span class="p">,</span><span class="kt">Eq</span> <span class="n">b</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Association</span> <span class="n">a</span> <span class="n">b</span> <span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)]</span> <span class="kr">where</span>    
    <span class="n">keys</span> <span class="n">xs</span> <span class="ow">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">map</span> <span class="n">fst</span>
    <span class="n">delete_key</span> <span class="n">k</span> <span class="n">xs</span> <span class="ow">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">filter</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="o">/=</span> <span class="n">k</span><span class="p">)</span>
    <span class="n">each_key</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">keys</span> <span class="o">$</span> <span class="n">each</span> <span class="n">f</span>
    
<span class="c1">-------------------------------</span>
<span class="kr">data</span> <span class="kt">SetList</span> <span class="n">a</span> <span class="ow">=</span> <span class="kt">SetList</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="kr">deriving</span> <span class="kt">Show</span>

<span class="kr">instance</span> <span class="kt">Eq</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="kt">Collection</span> <span class="n">a</span> <span class="p">(</span><span class="kt">SetList</span> <span class="n">a</span><span class="p">)</span> <span class="kr">where</span>
    <span class="n">insert</span> <span class="n">e</span> <span class="p">(</span><span class="kt">SetList</span> <span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">SetList</span> <span class="p">(</span><span class="n">e</span><span class="kt">:</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">filter</span> <span class="p">(</span><span class="o">/=</span> <span class="n">e</span><span class="p">)))</span>
    <span class="n">toList</span> <span class="p">(</span><span class="kt">SetList</span> <span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">xs</span>			    
    

<span class="kr">instance</span> <span class="kt">Eq</span> <span class="p">(</span><span class="kt">SetList</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Default_val</span> <span class="p">(</span><span class="kt">SetList</span> <span class="n">a</span><span class="p">)</span>  <span class="kr">where</span> <span class="n">null_val</span> <span class="ow">=</span> <span class="kt">SetList</span> <span class="kt">[]</span>

<span class="kr">instance</span> <span class="kt">Eq</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="kt">Eq</span> <span class="p">(</span><span class="kt">SetList</span> <span class="n">a</span><span class="p">)</span> <span class="kr">where</span>
    <span class="p">(</span><span class="kt">SetList</span> <span class="n">xs</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="kt">SetList</span> <span class="n">ys</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">all</span> <span class="p">(`</span><span class="n">elem</span><span class="p">`</span> <span class="n">ys</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="n">ys</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
<span class="c1">-------------------------------</span>
<span class="kr">data</span> <span class="kt">Assoc</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="kt">Assoc</span> <span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)]</span> <span class="kr">deriving</span> <span class="kt">Eq</span>
<span class="kr">instance</span> <span class="p">(</span><span class="kt">Show</span> <span class="n">a</span><span class="p">,</span> <span class="kt">Show</span> <span class="n">b</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Show</span> <span class="p">(</span><span class="kt">Assoc</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span> <span class="kr">where</span>
    <span class="n">show</span> <span class="p">(</span><span class="kt">Assoc</span> <span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">a</span><span class="o">^</span><span class="s">&quot; =&gt; &quot;</span><span class="o">^</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">unlines</span>


<span class="kr">instance</span> <span class="kt">Eq</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="kt">Collection</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="p">(</span><span class="kt">Assoc</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span> <span class="kr">where</span>
    <span class="n">empty</span> <span class="ow">=</span> <span class="kt">Assoc</span> <span class="kt">[]</span>
    <span class="n">insert</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="p">(</span><span class="kt">Assoc</span> <span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">Assoc</span> <span class="p">((</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span><span class="kt">:</span><span class="n">xs</span><span class="o">.</span><span class="n">filter</span> <span class="p">((</span><span class="o">/=</span> <span class="n">k</span><span class="p">)</span> <span class="err">°</span> <span class="n">fst</span><span class="p">))</span>  <span class="c1">-- [ (k&#39;,v&#39;) | (k&#39;,v&#39;) &lt;- xs, k /= k&#39;])</span>
    <span class="n">toList</span> <span class="p">(</span><span class="kt">Assoc</span> <span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">xs</span>
    <span class="n">each</span> <span class="n">f</span> <span class="p">(</span><span class="kt">Assoc</span> <span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">each</span> <span class="n">f</span>
    <span class="n">foldl</span> <span class="n">f</span> <span class="n">z</span> <span class="p">(</span><span class="kt">Assoc</span> <span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">foldl</span> <span class="n">f</span> <span class="n">z</span>


<span class="kr">instance</span> <span class="p">(</span><span class="kt">Eq</span> <span class="n">a</span><span class="p">,</span><span class="kt">Eq</span> <span class="n">b</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Association</span> <span class="n">a</span> <span class="n">b</span> <span class="p">(</span><span class="kt">Assoc</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span> <span class="kr">where</span>
    <span class="n">keys</span>   <span class="p">(</span><span class="kt">Assoc</span> <span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">map</span> <span class="n">fst</span>
    <span class="n">values</span> <span class="p">(</span><span class="kt">Assoc</span> <span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">map</span> <span class="n">snd</span>

<span class="kr">instance</span> <span class="kt">Eq</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="kt">Indexable</span> <span class="n">a</span> <span class="p">(</span><span class="kt">Assoc</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span> <span class="n">b</span> <span class="kr">where</span>
    <span class="p">(</span><span class="o">!~</span><span class="p">)</span> <span class="p">(</span><span class="kt">Assoc</span> <span class="kt">[]</span><span class="p">)</span> <span class="n">k</span> <span class="ow">=</span> <span class="kt">Nothing</span>
    <span class="p">(</span><span class="o">!~</span><span class="p">)</span> <span class="p">(</span><span class="kt">Assoc</span> <span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="kt">:</span><span class="n">xys</span><span class="p">))</span> <span class="n">k</span> <span class="o">|</span> <span class="n">k</span><span class="o">==</span><span class="n">x</span>      <span class="ow">=</span> <span class="kt">Just</span> <span class="n">y</span>
			       <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="p">(</span><span class="kt">Assoc</span> <span class="n">xys</span><span class="p">)</span><span class="o">!~</span><span class="n">k</span>

<span class="c1">-- to do assoc with default value to allow </span>
<span class="c1">--  from.update (name,+1), better than</span>
<span class="c1">--  from.insert(name,1+((from!~name ||| (Just 0)).just))</span>
<span class="kr">data</span> <span class="kt">AssocDefault</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="kt">AssocDefault</span> <span class="p">(</span><span class="n">b</span><span class="p">,[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)])</span> <span class="kr">deriving</span> <span class="kt">Eq</span>

<span class="kr">instance</span> <span class="p">(</span><span class="kt">Show</span> <span class="n">a</span><span class="p">,</span> <span class="kt">Show</span> <span class="n">b</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Show</span> <span class="p">(</span><span class="kt">AssocDefault</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span> <span class="kr">where</span>
    <span class="n">show</span> <span class="p">(</span><span class="kt">AssocDefault</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">xs</span><span class="p">))</span> <span class="ow">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">a</span><span class="o">^</span><span class="s">&quot; =&gt; &quot;</span><span class="o">^</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">unlines</span>

<span class="kr">instance</span> <span class="p">(</span><span class="kt">Eq</span> <span class="n">a</span><span class="p">,</span><span class="kt">Default_val</span> <span class="n">b</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Collection</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="p">(</span><span class="kt">AssocDefault</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span> <span class="kr">where</span>
    <span class="n">empty</span> <span class="ow">=</span> <span class="kt">AssocDefault</span> <span class="p">(</span><span class="n">null_val</span><span class="p">,</span><span class="kt">[]</span><span class="p">)</span> 
    <span class="n">insert</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="p">(</span><span class="kt">AssocDefault</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">xs</span><span class="p">))</span> <span class="ow">=</span> <span class="kt">AssocDefault</span> <span class="p">(</span><span class="n">b</span><span class="p">,((</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span><span class="kt">:</span><span class="n">xs</span><span class="o">.</span><span class="n">filter</span> <span class="p">((</span><span class="o">/=</span> <span class="n">k</span><span class="p">)</span> <span class="err">°</span> <span class="n">fst</span><span class="p">)))</span>  <span class="c1">-- [ (k&#39;,v&#39;) | (k&#39;,v&#39;) &lt;- xs, k /= k&#39;])</span>
    <span class="n">toList</span> <span class="p">(</span><span class="kt">AssocDefault</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">xs</span><span class="p">))</span> <span class="ow">=</span> <span class="n">xs</span>
    <span class="n">each</span> <span class="n">f</span> <span class="p">(</span><span class="kt">AssocDefault</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">xs</span><span class="p">))</span> <span class="ow">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">each</span> <span class="n">f</span>
    <span class="n">foldl</span> <span class="n">f</span> <span class="n">z</span> <span class="p">(</span><span class="kt">AssocDefault</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">xs</span><span class="p">))</span> <span class="ow">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">foldl</span> <span class="n">f</span> <span class="n">z</span>

<span class="kr">instance</span> <span class="p">(</span><span class="kt">Eq</span> <span class="n">a</span><span class="p">,</span><span class="kt">Default_val</span> <span class="n">b</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Association</span> <span class="n">a</span> <span class="n">b</span> <span class="p">(</span><span class="kt">AssocDefault</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span> <span class="kr">where</span>
    <span class="n">keys</span> <span class="p">(</span><span class="kt">AssocDefault</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">xs</span><span class="p">))</span> <span class="ow">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">map</span> <span class="n">fst</span>
<span class="kr">instance</span> <span class="kt">Eq</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="kt">Indexable</span> <span class="n">a</span> <span class="p">(</span><span class="kt">AssocDefault</span> <span class="n">a</span> <span class="n">b</span><span class="p">)</span> <span class="n">b</span> <span class="kr">where</span>
   <span class="p">(</span><span class="o">!~</span><span class="p">)</span> <span class="p">(</span><span class="kt">AssocDefault</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">xs</span><span class="p">))</span> <span class="n">k</span> <span class="ow">=</span> <span class="p">(</span><span class="kt">Assoc</span> <span class="n">xs</span><span class="p">)</span><span class="o">!~</span> <span class="n">k</span>

<span class="c1">-- TODO, could put update in classe Association ?</span>
<span class="nf">update</span> <span class="n">k</span> <span class="n">f</span> <span class="n">h</span><span class="o">@</span><span class="p">(</span><span class="kt">AssocDefault</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">xs</span><span class="p">))</span> <span class="ow">=</span> <span class="n">h</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">h</span><span class="o">!~</span><span class="n">k</span> <span class="o">|||</span> <span class="kt">Just</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">just</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
<span class="c1">----------------------------------------------------------------------------------------------------</span>

<span class="c1">-- make tuple indexable, oveload ! to work with all, but does not work</span>
<span class="c1">-- instance Indexable Int (a,b) a where</span>
<span class="c1">--     (!~) (a,b) 0 = Just a</span>
<span class="c1">-- instance Indexable Int (a,b) b where</span>
<span class="c1">--     (!~) (a,b) 1 = Just b</span>


    
<span class="c1">----------------------------------------------------------------------------------------------------</span>
<span class="c1">-- matrix, there exist some implementation on the web, TODO dont do list but fixed size vector =&gt;</span>
<span class="c1">-- could make compile-time check, ex *, we must have row_size a = column_size b</span>
<span class="c1">-- TODO, could be made a class of FinitMap, and that we could have a generic accessor</span>
<span class="kr">newtype</span> <span class="kt">Matrix</span> <span class="n">a</span> <span class="ow">=</span> <span class="kt">Matrix</span> <span class="p">[[</span><span class="n">a</span><span class="p">]]</span> <span class="c1">-- prefer a newtype, cos dont want to allow + on every list of list</span>
    <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Eq</span><span class="p">,</span><span class="kt">Show</span><span class="p">)</span> <span class="c1">-- newtype force you to redefine the deriving stuff</span>
<span class="nf">row_size</span>    <span class="p">(</span><span class="kt">Matrix</span> <span class="n">m</span><span class="p">)</span> <span class="ow">=</span> <span class="n">m</span><span class="o">.</span><span class="n">length</span>
<span class="nf">column_size</span> <span class="p">(</span><span class="kt">Matrix</span> <span class="n">m</span><span class="p">)</span> <span class="ow">=</span> <span class="n">m</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">length</span>
<span class="p">(</span><span class="o">%%</span><span class="p">)</span> <span class="p">(</span><span class="kt">Matrix</span> <span class="n">m</span><span class="p">)</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>  <span class="ow">=</span> <span class="n">m</span><span class="o">!</span><span class="n">i</span><span class="o">!</span><span class="n">j</span>

<span class="c1">-- could so straessen, this is very inefficient cos we dont have 0(1) access to element</span>
<span class="c1">-- TODO, use list comprehension, cf hugs demo</span>
<span class="kr">instance</span> <span class="kt">Num</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="kt">Num</span> <span class="p">(</span><span class="kt">Matrix</span> <span class="n">a</span><span class="p">)</span> <span class="kr">where</span>
    <span class="n">ma</span> <span class="o">*</span> <span class="n">mb</span> <span class="o">|</span> <span class="n">ma</span><span class="o">.</span><span class="n">column_size</span> <span class="o">==</span> <span class="n">mb</span><span class="o">.</span><span class="n">row_size</span> <span class="ow">=</span> <span class="kt">Matrix</span> <span class="n">aux</span>
	    <span class="kr">where</span> <span class="n">aux</span> <span class="ow">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="n">ma</span><span class="o">.</span><span class="n">row_size</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
			<span class="o">.</span><span class="n">foldl</span> <span class="p">(</span><span class="nf">\</span><span class="n">acc</span> <span class="n">i</span> <span class="ow">-&gt;</span> 
				<span class="n">acc</span><span class="o">++</span><span class="p">[</span>
				      <span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="n">mb</span><span class="o">.</span><span class="n">column_size</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
				      <span class="o">.</span><span class="n">foldl</span> <span class="p">(</span><span class="nf">\</span><span class="n">acc</span> <span class="n">j</span> <span class="ow">-&gt;</span>
					      <span class="n">acc</span><span class="o">++</span><span class="p">[</span>
						    <span class="p">[</span><span class="mi">0</span><span class="o">..</span><span class="n">ma</span><span class="o">.</span><span class="n">column_size</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
						    <span class="o">.</span><span class="n">foldl</span> <span class="p">(</span><span class="nf">\</span><span class="n">acc</span> <span class="n">k</span> <span class="ow">-&gt;</span>
							    <span class="n">acc</span><span class="o">+</span>
							    <span class="p">(</span><span class="n">ma</span><span class="o">%%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">mb</span> <span class="o">%%</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="p">))))</span>
						    <span class="mi">0</span><span class="p">]</span>
					      <span class="p">)</span> <span class="kt">[]</span>
				      <span class="p">]</span>
				<span class="p">)</span> <span class="kt">[]</span>


<span class="c1">----------------------------------------------------------------------------------------------------</span>
<span class="kr">class</span> <span class="kt">Eq</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="kt">Default_val</span> <span class="n">a</span> <span class="kr">where</span>
    <span class="n">null_val</span> <span class="ow">::</span> <span class="n">a</span>
    <span class="n">is_null</span> <span class="ow">::</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
    <span class="n">is_null</span> <span class="ow">=</span> <span class="p">(</span><span class="o">==</span> <span class="n">null_val</span><span class="p">)</span>

<span class="c1">-- not really logical, cos we dont really need to force Default_val a, we dont care about a</span>
<span class="c1">--instance Default_val a =&gt; Default_val [a]  where null_val = []</span>
<span class="c1">-- and need provide extra instance</span>
<span class="c1">--instance Default_val Char  where null_val = &#39;a&#39;</span>

<span class="c1">-- need -98 option, still dont know why we need to put the constraint Eq [a] for working</span>
<span class="kr">instance</span> <span class="kt">Eq</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="ow">=&gt;</span> <span class="kt">Default_val</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>  <span class="kr">where</span> <span class="n">null_val</span> <span class="ow">=</span> <span class="kt">[]</span>
<span class="kr">instance</span> <span class="kt">Eq</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="kt">Default_val</span> <span class="p">(</span><span class="kt">Maybe</span> <span class="n">a</span><span class="p">)</span> <span class="kr">where</span> <span class="n">null_val</span> <span class="ow">=</span> <span class="kt">Nothing</span>

<span class="c1">-- instance Num b =&gt; Default_val b    where null_val = 0; cant do that :( hugs say it overlaps</span>
<span class="c1">--  but it is not cos [a] is not member of the Num class</span>
<span class="kr">instance</span> <span class="kt">Default_val</span> <span class="kt">Int</span>  <span class="kr">where</span> <span class="n">null_val</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="kr">instance</span> <span class="kt">Default_val</span> <span class="kt">Float</span>  <span class="kr">where</span> <span class="n">null_val</span> <span class="ow">=</span> <span class="mf">0.0</span>
<span class="c1">-- would like to do that, but not possible cos Num is a class, not a type</span>
<span class="c1">--instance Default_val (Num a) where null_val = 0</span>

<span class="c1">-- v1 = (2::Int) &amp;&amp;&amp; &quot;ee&quot; --  &quot;ee&quot; -- need the type annotation :(</span>
<span class="c1">-- v2 = 0.0 &amp;&amp;&amp; &quot;ee&quot; --  &quot;&quot;</span>

<span class="c1">-- overloading on return value</span>
<span class="p">(</span><span class="o">&amp;&amp;&amp;</span><span class="p">)</span><span class="ow">::</span> <span class="p">(</span><span class="kt">Default_val</span> <span class="n">a</span><span class="p">,</span> <span class="kt">Default_val</span> <span class="n">b</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span>
<span class="nf">a</span> <span class="o">&amp;&amp;&amp;</span> <span class="n">b</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">a</span><span class="o">.</span><span class="n">is_null</span> <span class="kr">then</span> <span class="n">null_val</span> <span class="kr">else</span> <span class="n">b</span>

<span class="p">(</span><span class="o">|||</span><span class="p">)</span><span class="ow">::</span> <span class="kt">Default_val</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span>
<span class="nf">a</span> <span class="o">|||</span> <span class="n">b</span> <span class="ow">=</span> <span class="kr">if</span> <span class="n">a</span><span class="o">.</span><span class="n">is_null</span> <span class="kr">then</span> <span class="n">b</span> <span class="kr">else</span> <span class="n">a</span>

<span class="c1">----------------------------------------------------------------------------------------------------</span>
<span class="c1">-- class Show a =&gt; Showbis a where</span>
<span class="c1">--    showbis :: a -&gt; String</span>
<span class="c1">--    showbis x = show x</span>
<span class="c1">-- cant do instance Showbis [Char] where showbis x = x</span>
<span class="c1">--  cos we cant specialise so far in haskell, we specialise &quot;chacun son tour&quot; =&gt;</span>
<span class="c1">--  first [] then Char =&gt; to handle that, do as in the class Show, make 2 func</span>
<span class="c1">-- (as you may have note,  show &quot;123&quot; =&gt; &quot;123&quot; and show &#39;1&#39; =&gt; &#39;1&#39;, strange, might expect</span>
<span class="c1">--  [&#39;1&#39;,&#39;2&#39;,&#39;3&#39;] cos String = [Char]</span>
<span class="c1">--  in fact, show [a] is not a map show !! cf Prelude to understand the trick</span>
<span class="c1">--  they introduce another func in the class definition to allow specialisation for [a]</span>

<span class="c1">--    showbisList :: [a] -&gt; String</span>
<span class="c1">--    showbisList [] = &quot;[]&quot;</span>
<span class="c1">--    showbisList (x:xs) = &quot;[&quot; ++ join &quot;,&quot; (map show (x:xs)) ++ &quot;]&quot;</span>

<span class="c1">--instance Showbis a =&gt; Showbis [a] where showbis = showbisList</span>
<span class="c1">--instance Num a =&gt; Showbis a where showbis = show</span>

<span class="c1">-- the beautfile one, but hugs/ghc do special case with show; when </span>
<span class="c1">--   do 1 ~~ 2 then he wants (1::Int) ~~ (2::Int) :((</span>
<span class="c1">-- (~~) a b = showbis a ++ showbis b</span>

<span class="c1">-- the ugly one, if you have a type that when show put a &quot; at begin and end, then pb !!</span>
<span class="c1">--  but as it is rarely the case, no matter, same for \</span>
<span class="nf">update_anti_slash</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="kt">[]</span>
<span class="nf">update_anti_slash</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
<span class="nf">update_anti_slash</span> <span class="p">(</span><span class="sc">&#39;</span><span class="se">\\</span><span class="sc">&#39;</span><span class="kt">:</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> 
    <span class="p">(</span><span class="kr">case</span> <span class="n">x</span> <span class="kr">of</span> 
     <span class="n">&#39;n&#39;</span> <span class="ow">-&gt;</span> <span class="sc">&#39;</span><span class="se">\n</span><span class="sc">&#39;</span>
     <span class="n">&#39;t&#39;</span> <span class="ow">-&gt;</span> <span class="sc">&#39;</span><span class="se">\t</span><span class="sc">&#39;</span>
     <span class="n">x</span>   <span class="ow">-&gt;</span> <span class="n">x</span>
     <span class="p">)</span> <span class="kt">:</span> <span class="n">update_anti_slash</span> <span class="n">xs</span>
<span class="nf">update_anti_slash</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">x</span> <span class="kt">:</span> <span class="n">update_anti_slash</span> <span class="n">xs</span>

<span class="nf">del_enclose</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
<span class="nf">del_enclose</span> <span class="n">xs</span> <span class="o">|</span> <span class="n">length</span> <span class="n">xs</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">=</span> <span class="n">xs</span>
	       <span class="o">|</span> <span class="n">head</span> <span class="n">xs</span> <span class="o">==</span> <span class="sc">&#39;&quot;&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">last</span> <span class="n">xs</span> <span class="o">==</span> <span class="sc">&#39;&quot;&#39;</span> <span class="ow">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">tail</span><span class="o">.</span><span class="n">init</span>
	       <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="n">xs</span>
<span class="p">(</span><span class="o">^</span><span class="p">)</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">=</span> <span class="p">(</span><span class="n">update_anti_slash</span> <span class="err">°</span> <span class="n">del_enclose</span> <span class="err">°</span> <span class="n">show</span><span class="p">)</span> <span class="n">a</span> <span class="o">++</span> <span class="p">(</span><span class="n">update_anti_slash</span> <span class="err">°</span> <span class="n">del_enclose</span> <span class="err">°</span> <span class="n">show</span><span class="p">)</span> <span class="n">b</span> 
<span class="c1">-- (^) a b  = let op = update_anti_slash ° del_enclose ° show in op a ++ op b -- dont WORK !! AMAZING</span>
<span class="kr">infixl</span> <span class="mi">1</span> <span class="o">^</span>
</pre></div>
</body>
</html>
