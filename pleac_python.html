<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=latin1">
  <style type="text/css">
td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }
body .hll { background-color: #ffffcc }
body  { background: #f8f8f8; }
body .c { color: #408080; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #008000; font-weight: bold } /* Keyword */
body .o { color: #666666 } /* Operator */
body .cm { color: #408080; font-style: italic } /* Comment.Multiline */
body .cp { color: #BC7A00 } /* Comment.Preproc */
body .c1 { color: #408080; font-style: italic } /* Comment.Single */
body .cs { color: #408080; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #FF0000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #00A000 } /* Generic.Inserted */
body .go { color: #888888 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #008000 } /* Keyword.Pseudo */
body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #BA2121 } /* Literal.String */
body .na { color: #7D9029 } /* Name.Attribute */
body .nb { color: #008000 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #999999; font-weight: bold } /* Name.Entity */
body .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #A0A000 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #19177C } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sb { color: #BA2121 } /* Literal.String.Backtick */
body .sc { color: #BA2121 } /* Literal.String.Char */
body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #BA2121 } /* Literal.String.Double */
body .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #BA2121 } /* Literal.String.Heredoc */
body .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #BB6688 } /* Literal.String.Regex */
body .s1 { color: #BA2121 } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #008000 } /* Name.Builtin.Pseudo */
body .vc { color: #19177C } /* Name.Variable.Class */
body .vg { color: #19177C } /* Name.Variable.Global */
body .vi { color: #19177C } /* Name.Variable.Instance */
body .il { color: #666666 } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><pre><span class="c"># -*- python -*-</span>
<span class="c"># vim:set ft=python:</span>

<span class="c"># @@PLEAC@@_NAME</span>
<span class="c"># @@SKIP@@ Python</span>

<span class="c"># @@PLEAC@@_WEB</span>
<span class="c"># @@SKIP@@ http://www.python.org</span>

<span class="c"># @@PLEAC@@_INTRO</span>
<span class="c"># @@SKIP@@ The latest version of Python is 2.4 but users of 2.3 and 2.2 (and</span>
<span class="c"># @@SKIP@@ in some cases earlier versions) can use the code herein.</span>
<span class="c"># @@SKIP@@ Users of 2.2 and 2.3 should install or copy code from utils.py </span>
<span class="c"># @@SKIP@@ (http://aima.cs.berkeley.edu/python/utils.py)</span>
<span class="c"># @@SKIP@@ [the first section provides compatability code with 2.4]</span>
<span class="c"># @@SKIP@@ Users of 2.2 should install optik (http://optik.sourceforge.com) </span>
<span class="c"># @@SKIP@@ [for optparse and textwrap]</span>
<span class="c"># @@SKIP@@ Where a 2.3 or 2.4 feature is unable to be replicated, an effort</span>
<span class="c"># @@SKIP@@ has been made to provide a backward-compatible version in addition</span>
<span class="c"># @@SKIP@@ to one using modern idioms.</span>
<span class="c"># @@SKIP@@ Examples which translate the original Perl closely but which are</span>
<span class="c"># @@SKIP@@ unPythonic are prefixed with a comment stating &quot;DON&#39;T DO THIS&quot;.</span>
<span class="c"># @@SKIP@@ In some cases, it may be useful to know the techniques in these, </span>
<span class="c"># @@SKIP@@ though it&#39;s a bad solution for the specific problem.</span>

<span class="c"># @@PLEAC@@_1.0</span>
<span class="c">#-----------------------------</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>   <span class="c"># a newline character</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">r&quot;\n&quot;</span>  <span class="c"># two characters, \ and n</span>
<span class="c">#-----------------------------</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&quot;Jon &#39;Maddog&#39; Orwant&quot;</span>  <span class="c"># literal single quote inside double quotes</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&#39;Jon &quot;Maddog&quot; Orwant&#39;</span>  <span class="c"># literal double quote inside single quotes</span>
<span class="c">#-----------------------------</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&#39;Jon </span><span class="se">\&#39;</span><span class="s">Maddog</span><span class="se">\&#39;</span><span class="s"> Orwant&#39;</span>  <span class="c"># escaped single quote</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&quot;Jon </span><span class="se">\&quot;</span><span class="s">Maddog</span><span class="se">\&quot;</span><span class="s"> Orwant&quot;</span>  <span class="c"># escaped double quote</span>
<span class="c">#-----------------------------</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">This is a multiline string literal</span>
<span class="s">enclosed in triple double quotes.</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">And this is a multiline string literal</span>
<span class="s">enclosed in triple single quotes.</span>
<span class="s">&#39;&#39;&#39;</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_1.1</span>
<span class="c">#-----------------------------</span>

<span class="c"># get a 5-char string, skip 3, then grab 2 8-char strings, then the rest</span>
<span class="c"># Note that struct.unpack cannot use * for an unknown length.</span>
<span class="c"># See http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/65224</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="p">(</span><span class="n">lead</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">),</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&quot;5s 3x 8s 8s&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">24</span><span class="p">]),</span> <span class="n">data</span><span class="p">[</span><span class="mi">24</span><span class="p">:]</span>

<span class="c"># split at five-char boundaries</span>
<span class="n">fivers</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&quot;5s&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">//</span><span class="mi">5</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
<span class="n">fivers</span> <span class="o">=</span> <span class="k">print</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">5</span><span class="p">:</span><span class="n">i</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="p">)]</span>

<span class="c"># chop string into individual characters</span>
<span class="n">chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&quot;This is what you have&quot;</span>
<span class="c">#       +012345678901234567890  Indexing forwards  (left to right)</span>
<span class="c">#        109876543210987654321- Indexing backwards (right to left)</span>
<span class="c">#         note that 0 means 10 or 20, etc. above</span>

<span class="n">first</span> <span class="o">=</span> <span class="n">mystr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                            <span class="c"># &quot;T&quot;</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">mystr</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>                          <span class="c"># &quot;is&quot;</span>
<span class="n">rest</span> <span class="o">=</span> <span class="n">mystr</span><span class="p">[</span><span class="mi">13</span><span class="p">:]</span>                           <span class="c"># &quot;you have&quot;</span>
<span class="n">last</span> <span class="o">=</span> <span class="n">mystr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>                            <span class="c"># &quot;e&quot;</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">mystr</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>                            <span class="c"># &quot;have&quot;</span>
<span class="n">piece</span> <span class="o">=</span> <span class="n">mystr</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>                        <span class="c"># &quot;you&quot;</span>
<span class="c">#-----------------------------</span>
<span class="c"># Python strings are immutable.</span>
<span class="c"># In general, you should just do piecemeal reallocation:</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&quot;This is what you have&quot;</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="n">mystr</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;wasn&#39;t&quot;</span> <span class="o">+</span> <span class="n">mystr</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span>

<span class="c"># Or replace and reallocate</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&quot;This is what you have&quot;</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="n">mystr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot; is &quot;</span><span class="p">,</span> <span class="s">&quot; wasn&#39;t &quot;</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS: In-place modification could be done using character arrays</span>
<span class="kn">import</span> <span class="nn">array</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="s">&quot;This is what you have&quot;</span><span class="p">)</span>
<span class="n">mystr</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="s">&quot;wasn&#39;t&quot;</span><span class="p">)</span>
<span class="c"># mystr is now array(&#39;c&#39;, &quot;This wasn&#39;t what you have&quot;)</span>

<span class="c"># DON&#39;T DO THIS: It could also be done using MutableString </span>
<span class="kn">from</span> <span class="nn">UserString</span> <span class="kn">import</span> <span class="n">MutableString</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="n">MutableString</span><span class="p">(</span><span class="s">&quot;This is what you have&quot;</span><span class="p">)</span>
<span class="n">mystr</span><span class="p">[</span><span class="o">-</span><span class="mi">12</span><span class="p">:]</span> <span class="o">=</span> <span class="s">&quot;ondrous&quot;</span>
<span class="c"># mystr is now &quot;This is wondrous&quot;</span>
<span class="c">#-----------------------------</span>
<span class="c"># you can test simple substrings with &quot;in&quot; (for regex matching see ch.6):</span>
<span class="k">if</span> <span class="n">txt</span> <span class="ow">in</span> <span class="n">mystr</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]:</span>
    <span class="k">print</span> <span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; found in last 10 characters&quot;</span><span class="o">%</span><span class="n">txt</span>

<span class="c"># Or use the startswith() and endswith() string methods:</span>
<span class="k">if</span> <span class="n">mystr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">txt</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> starts with </span><span class="si">%s</span><span class="s">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">mystr</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="k">if</span> <span class="n">mystr</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">txt</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> ends with </span><span class="si">%s</span><span class="s">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">mystr</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>

<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_1.2</span>
<span class="c">#-----------------------------</span>
<span class="c"># Introductory Note: quite a bit of this section is not terribly Pythonic</span>
<span class="c"># as names must be set before being used. For instance, unless myvar has </span>
<span class="c"># been previously defined, these next lines will all raise NameError:</span>
<span class="n">myvar</span> <span class="o">=</span> <span class="n">myvar</span> <span class="ow">or</span> <span class="n">some_default</span>
<span class="n">myvar2</span> <span class="o">=</span> <span class="n">myvar</span> <span class="ow">or</span> <span class="n">some_default</span>
<span class="n">myvar</span> <span class="o">|=</span> <span class="n">some_default</span>          <span class="c"># bitwise-or, not logical-or - for demo</span>

<span class="c"># The standard way of setting a default is often:</span>
<span class="n">myvar</span> <span class="o">=</span> <span class="n">default_value</span>
<span class="k">if</span> <span class="n">some_condition</span><span class="p">:</span>
    <span class="k">pass</span>                     <span class="c"># code which may set myvar to something else</span>

<span class="c"># if myvar is returned from a function and may be empty/None, then use:</span>
<span class="n">myvar</span> <span class="o">=</span> <span class="n">somefunc</span><span class="p">()</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">myvar</span><span class="p">:</span>
    <span class="n">myvar</span> <span class="o">=</span> <span class="n">default_value</span>

<span class="c"># If you want a default value that can be overridden by the person calling </span>
<span class="c"># your code, you can often wrap it in a function with a named parameter:</span>
<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">myvar</span><span class="o">=</span><span class="s">&quot;a&quot;</span><span class="p">):</span>
   <span class="k">return</span> <span class="n">myvar</span> <span class="o">+</span> <span class="s">&quot;b&quot;</span>
<span class="k">print</span> <span class="n">myfunc</span><span class="p">(),</span> <span class="n">myfunc</span><span class="p">(</span><span class="s">&quot;c&quot;</span><span class="p">)</span>
<span class="c">#=&gt; ab cb</span>

<span class="c"># Note, though, that this won&#39;t work for mutable objects such as lists or</span>
<span class="c"># dicts that are mutated in the function as the object is only created once </span>
<span class="c"># and repeated calls to the same function will return the same object.  This</span>
<span class="c"># can be desired behaviour however - see section 10.3, for instance.</span>
<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">myvar</span><span class="o">=</span><span class="p">[]):</span>
    <span class="n">myvar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">myvar</span>
<span class="k">print</span> <span class="n">myfunc</span><span class="p">(),</span> <span class="n">myfunc</span><span class="p">()</span>
<span class="c">#=&gt; [&#39;x&#39;] [&#39;x&#39;, &#39;x&#39;]</span>

<span class="c"># You need to do:</span>
<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">myvar</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">myvar</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">myvar</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">myvar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">myvar</span>
<span class="k">print</span> <span class="n">myfunc</span><span class="p">(),</span> <span class="n">myfunc</span><span class="p">()</span>
<span class="c">#=&gt; [&#39;x&#39;] [&#39;x&#39;]</span>

<span class="c">#=== Perl Equivalencies start here</span>
<span class="c"># use b if b is true, otherwise use c</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="ow">or</span> <span class="n">c</span>

<span class="c"># as that is a little tricksy, the following may be preferred:</span>
<span class="k">if</span> <span class="n">b</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">b</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">c</span>

<span class="c"># set x to y unless x is already true</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">y</span>
<span class="c">#-----------------------------</span>
<span class="c"># use b if b is defined, else c</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">b</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">c</span>
<span class="c">#-----------------------------</span>
<span class="n">foo</span> <span class="o">=</span> <span class="n">bar</span> <span class="ow">or</span> <span class="s">&quot;DEFAULT VALUE&quot;</span>
<span class="c">#-----------------------------</span>
<span class="c"># To get a user (for both UNIX and Windows), use:</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span>

<span class="c"># DON&#39;T DO THIS: find the user name on Unix systems </span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;USER&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;LOGNAME&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">starting_point</span><span class="p">:</span>
    <span class="n">starting_point</span> <span class="o">=</span> <span class="s">&quot;Greenwich&quot;</span>
<span class="c">#-----------------------------</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="p">:</span>         <span class="c"># copy only if empty</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">b</span>

<span class="k">if</span> <span class="n">b</span><span class="p">:</span>             <span class="c"># assign b if nonempty, else c</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">b</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">c</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_1.3</span>
<span class="c">#-----------------------------</span>
<span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v1</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS:</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">a</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">b</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">temp</span>
<span class="c">#-----------------------------</span>
<span class="n">a</span> <span class="o">=</span> <span class="s">&quot;alpha&quot;</span>
<span class="n">b</span> <span class="o">=</span> <span class="s">&quot;omega&quot;</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>   <span class="c"># the first shall be last -- and versa vice </span>
<span class="c">#-----------------------------</span>
<span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">production</span> <span class="o">=</span> <span class="s">&quot;January March August&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">production</span> <span class="o">=</span> <span class="n">beta</span><span class="p">,</span> <span class="n">production</span><span class="p">,</span> <span class="n">alpha</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_1.4</span>
<span class="c">#-----------------------------</span>
<span class="n">num</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
<span class="n">char</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">char</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%c</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">num</span>
<span class="k">print</span> <span class="s">&quot;Number </span><span class="si">%d</span><span class="s"> is character </span><span class="si">%c</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Number </span><span class="si">%(n)d</span><span class="s"> is character </span><span class="si">%(n)c</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">{</span><span class="s">&quot;n&quot;</span><span class="p">:</span> <span class="n">num</span><span class="p">}</span>
<span class="k">print</span> <span class="s">&quot;Number </span><span class="si">%(num)d</span><span class="s"> is character </span><span class="si">%(num)c</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">locals</span><span class="p">()</span>
<span class="c">#=&gt; Number 101 is character e</span>
<span class="c">#-----------------------------</span>
<span class="n">ascii_character_numbers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="s">&quot;sample&quot;</span><span class="p">]</span>
<span class="k">print</span> <span class="n">ascii_character_numbers</span>
<span class="c">#=&gt; [115, 97, 109, 112, 108, 101]</span>

<span class="n">word</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ascii_character_numbers</span><span class="p">])</span>
<span class="n">word</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">115</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">101</span><span class="p">]])</span>
<span class="k">print</span> <span class="n">word</span>
<span class="c">#=&gt; sample</span>
<span class="c">#-----------------------------</span>
<span class="n">hal</span> <span class="o">=</span> <span class="s">&quot;HAL&quot;</span>
<span class="n">ibm</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">hal</span><span class="p">])</span> <span class="c"># add one to each ASCII value</span>
<span class="k">print</span> <span class="n">ibm</span>   
<span class="c">#=&gt; IBM</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_1.5</span>
<span class="c">#-----------------------------</span>
<span class="n">mylist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mystr</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">mystr</span><span class="p">:</span>
    <span class="k">pass</span> <span class="c"># do something with char</span>
<span class="c">#-----------------------------</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&quot;an apple a day&quot;</span>
<span class="n">uniq</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">mystr</span><span class="p">))</span>
<span class="k">print</span> <span class="s">&quot;unique chars are: &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniq</span><span class="p">)</span>
<span class="c">#=&gt; unique chars are: &#39; adelnpy&#39;</span>
<span class="c">#-----------------------------</span>
<span class="n">ascvals</span> <span class="o">=</span> <span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">mystr</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&quot;total is </span><span class="si">%s</span><span class="s"> for &#39;</span><span class="si">%s</span><span class="s">&#39;.&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">ascvals</span><span class="p">),</span> <span class="n">mystr</span><span class="p">)</span>
<span class="c">#=&gt; total is 1248 for &#39;an apple a day&#39;.</span>
<span class="c">#-----------------------------</span>
<span class="c"># sysv checksum</span>
<span class="k">def</span> <span class="nf">checksum</span><span class="p">(</span><span class="n">myfile</span><span class="p">):</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">myfile</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">line</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

<span class="kn">import</span> <span class="nn">fileinput</span>
<span class="k">print</span> <span class="n">checksum</span><span class="p">(</span><span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">())</span>   <span class="c"># data from sys.stdin</span>

<span class="c"># Using a function means any iterable can be checksummed:</span>
<span class="k">print</span> <span class="n">checksum</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&quot;C:/test.txt&quot;</span><span class="p">)</span>  <span class="c"># data from file</span>
<span class="k">print</span> <span class="n">checksum</span><span class="p">(</span><span class="s">&quot;sometext&quot;</span><span class="p">)</span>          <span class="c"># data from string</span>
<span class="c">#-----------------------------</span>
<span class="c">#!/usr/bin/python</span>
<span class="c"># slowcat - emulate a   s l o w  line printer</span>
<span class="c"># usage: slowcat [- DELAY] [files ...]</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">select</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">DELAY</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;^-\d+$&quot;</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">DELAY</span><span class="o">=-</span><span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ln</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">select</span><span class="o">.</span><span class="n">select</span><span class="p">([],[],[],</span> <span class="mf">0.005</span> <span class="o">*</span> <span class="n">DELAY</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_1.6</span>
<span class="c">#-----------------------------</span>
<span class="c"># 2.3+ only</span>
<span class="n">revchars</span> <span class="o">=</span> <span class="n">mystr</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c"># extended slice - step is -1</span>
<span class="n">revwords</span> <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mystr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="c"># pre 2.3 version:</span>
<span class="n">mylist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mystr</span><span class="p">)</span>
<span class="n">mylist</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
<span class="n">revbytes</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span>

<span class="n">mylist</span> <span class="o">=</span> <span class="n">mystr</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">mylist</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
<span class="n">revwords</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span>

<span class="c"># Alternative version using reversed():</span>
<span class="n">revchars</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">mystr</span><span class="p">))</span>
<span class="n">revwords</span> <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">mystr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)))</span>

<span class="c"># reversed() makes an iterator, which means that the reversal</span>
<span class="c"># happens as it is consumed.  This means that &quot;print reversed(mystr)&quot; is not</span>
<span class="c"># the same as mystr[::-1].  Standard usage is:</span>
<span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">mystr</span><span class="p">):</span>
   <span class="k">pass</span>  <span class="c"># ... do something</span>
<span class="c">#-----------------------------</span>
<span class="c"># 2.3+ only</span>
<span class="n">word</span> <span class="o">=</span> <span class="s">&quot;reviver&quot;</span>
<span class="n">is_palindrome</span> <span class="o">=</span> <span class="p">(</span><span class="n">word</span> <span class="o">==</span> <span class="n">word</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="c">#-----------------------------</span>
<span class="c"># Generator version</span>
<span class="k">def</span> <span class="nf">get_palindromes</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">word</span> <span class="o">==</span> <span class="n">word</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">yield</span> <span class="n">word</span>
<span class="n">long_palindromes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">get_palindromes</span><span class="p">(</span><span class="s">&quot;/usr/share/dict/words&quot;</span><span class="p">))</span>

<span class="c"># Simpler old-style version using 2.2 string reversal</span>
<span class="k">def</span> <span class="nf">rev_string</span><span class="p">(</span><span class="n">mystr</span><span class="p">):</span>
    <span class="n">mylist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mystr</span><span class="p">)</span>
    <span class="n">mylist</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span>

<span class="n">long_palindromes</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;/usr/share/dict/words&quot;</span><span class="p">):</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">word</span> <span class="o">==</span> <span class="n">rev_string</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
        <span class="n">long_palindromes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
<span class="k">print</span> <span class="n">long_palindromes</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_1.7</span>
<span class="c">#-----------------------------</span>
<span class="n">mystr</span><span class="o">.</span><span class="n">expandtabs</span><span class="p">()</span>
<span class="n">mystr</span><span class="o">.</span><span class="n">expandtabs</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_1.8</span>
<span class="c">#-----------------------------</span>
<span class="n">text</span> <span class="o">=</span> <span class="s">&quot;I am </span><span class="si">%(rows)s</span><span class="s"> high and </span><span class="si">%(cols)s</span><span class="s"> long&quot;</span><span class="o">%</span><span class="p">{</span><span class="s">&quot;rows&quot;</span><span class="p">:</span><span class="mi">24</span><span class="p">,</span> <span class="s">&quot;cols&quot;</span><span class="p">:</span><span class="mi">80</span><span class="p">)</span>
<span class="k">print</span> <span class="n">text</span>
<span class="c">#=&gt; I am 24 high and 80 long</span>

<span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">80</span>
<span class="n">text</span> <span class="o">=</span> <span class="s">&quot;I am </span><span class="si">%(rows)s</span><span class="s"> high and </span><span class="si">%(cols)s</span><span class="s"> long&quot;</span><span class="o">%</span><span class="nb">locals</span><span class="p">()</span>
<span class="k">print</span> <span class="n">text</span>
<span class="c">#=&gt; I am 24 high and 80 long</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="k">print</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;\d+&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))),</span> <span class="s">&quot;I am 17 years old&quot;</span><span class="p">)</span>
<span class="c">#=&gt; I am 34 years old</span>
<span class="c">#-----------------------------</span>
<span class="c"># expand variables in text, but put an error message in</span>
<span class="c"># if the variable isn&#39;t defined</span>
<span class="k">class</span> <span class="nc">SafeDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s">&quot;[No Variable: </span><span class="si">%s</span><span class="s">]&quot;</span><span class="o">%</span><span class="n">key</span><span class="p">)</span>
    
<span class="n">hi</span> <span class="o">=</span> <span class="s">&quot;Hello&quot;</span>
<span class="n">text</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%(hi)s</span><span class="s"> and </span><span class="si">%(bye)s</span><span class="s">!&quot;</span><span class="o">%</span><span class="n">SafeDict</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>
<span class="k">print</span> <span class="n">text</span>
<span class="c">#=&gt; Hello and [No Variable: bye]!</span>

<span class="c">#If you don&#39;t need a particular error message, just use the Template class:</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">Template</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;$hi and $bye!&quot;</span><span class="p">)</span>
<span class="n">hi</span> <span class="o">=</span> <span class="s">&quot;Hello&quot;</span>
<span class="k">print</span> <span class="n">x</span><span class="o">.</span><span class="n">safe_substitute</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>
<span class="c">#=&gt; Hello and $bye!</span>
<span class="k">print</span> <span class="n">x</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span> <span class="c"># will throw a KeyError</span>

<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_1.9</span>
<span class="c">#-----------------------------</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&quot;bo peep&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>  <span class="c"># BO PEEP</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="n">mystr</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>      <span class="c"># bo peep</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="n">mystr</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="c"># Bo peep</span>
<span class="c">#-----------------------------</span>
<span class="n">beast</span> <span class="o">=</span> <span class="s">&quot;python&quot;</span>
<span class="n">caprest</span> <span class="o">=</span> <span class="n">beast</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">.</span><span class="n">swapcase</span><span class="p">()</span> <span class="c"># pYTHON</span>
<span class="c">#-----------------------------</span>
<span class="k">print</span> <span class="s">&quot;thIS is a loNG liNE&quot;</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
<span class="c">#=&gt; This Is A Long Line</span>
<span class="c">#-----------------------------</span>
<span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">&quot;a and b are the same&quot;</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="k">def</span> <span class="nf">randcase_one</span><span class="p">(</span><span class="n">letter</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>   <span class="c"># True on 1, 2, 3, 4</span>
        <span class="k">return</span> <span class="n">letter</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">letter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">randcase</span><span class="p">(</span><span class="n">myfile</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">myfile</span><span class="p">:</span>
        <span class="k">yield</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">randcase_one</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span> <span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">randcase</span><span class="p">(</span><span class="n">myfile</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">line</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_1.10</span>
<span class="c">#-----------------------------</span>
<span class="s">&quot;I have </span><span class="si">%d</span><span class="s"> guanacos.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;I have&quot;</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;guanacos.&quot;</span>
<span class="c">#-----------------------------</span>
<span class="c">#Python templates disallow in-string calculations (see PEP 292)</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">Template</span>

<span class="n">email_template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">To: $address</span>
<span class="s">From: Your Bank</span>
<span class="s">CC: $cc_number</span>
<span class="s">Date: $date</span>

<span class="s">Dear $name,</span>

<span class="s">Today you bounced check number $checknum to us.</span>
<span class="s">Your account is now closed.</span>

<span class="s">Sincerely,</span>
<span class="s">the management</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">person</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;address&quot;</span><span class="p">:</span><span class="s">&quot;Joe@somewhere.com&quot;</span><span class="p">,</span>
          <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;Joe&quot;</span><span class="p">,</span>
          <span class="s">&quot;cc_number&quot;</span> <span class="p">:</span> <span class="mi">1234567890</span><span class="p">,</span>
          <span class="s">&quot;checknum&quot;</span> <span class="p">:</span> <span class="mi">500</span><span class="o">+</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">99</span><span class="p">)}</span>

<span class="k">print</span> <span class="n">email_template</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_1.11</span>
<span class="c">#-----------------------------</span>
<span class="c"># indenting here documents</span>
<span class="c">#</span>
<span class="c"># in python multiline strings can be used as here documents</span>
<span class="n">var</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">      your text</span>
<span class="s">      goes here</span>
<span class="s">      &quot;&quot;&quot;</span>

<span class="c"># using regular expressions</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">re_leading_blanks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;^\s+&quot;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)</span>
<span class="n">var1</span> <span class="o">=</span> <span class="n">re_leading_blanks</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">var</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c"># using string methods </span>
<span class="c"># split into lines, use every line except first and last, left strip and rejoin.</span>
<span class="n">var2</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">var</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

<span class="n">poem</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">       Here&#39;s your poem:</span>
<span class="s">       Now far ahead the Road has gone,</span>
<span class="s">          And I must follow, if I can,</span>
<span class="s">       Pursuing it with eager feet,</span>
<span class="s">          Until it joins some larger way</span>
<span class="s">       Where many paths and errand meet.</span>
<span class="s">          And whither then? I cannot say.</span>
<span class="s">               --Bilbo in /usr/src/perl/pp_ctl.c  </span>
<span class="s">       &quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="k">print</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">poem</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
    

<span class="c"># @@PLEAC@@_1.12</span>
<span class="c">#-----------------------------</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">wrap</span> 
<span class="n">output</span> <span class="o">=</span> <span class="n">wrap</span><span class="p">(</span><span class="n">para</span><span class="p">,</span>
              <span class="n">initial_indent</span><span class="o">=</span><span class="n">leadtab</span>
              <span class="n">subsequent_indent</span><span class="o">=</span><span class="n">nexttab</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># wrapdemo - show how textwrap works</span>

<span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">Folding and splicing is the work of an editor,</span>
<span class="s">not a mere collection of silicon</span>
<span class="s">and</span>
<span class="s">mobile electrons!</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">TextWrapper</span>

<span class="n">wrapper</span> <span class="o">=</span> <span class="n">TextWrapper</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                      <span class="n">initial_indent</span><span class="o">=</span><span class="s">&quot; &quot;</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span>
                      <span class="n">subsequent_indent</span><span class="o">=</span><span class="s">&quot; &quot;</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;0123456789&quot;</span> <span class="o">*</span> <span class="mi">2</span>
<span class="k">print</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="sd">&quot;&quot;&quot;Expected result:</span>

<span class="sd">01234567890123456789</span>
<span class="sd">    Folding and</span>
<span class="sd">  splicing is the</span>
<span class="sd">  work of an editor,</span>
<span class="sd">  not a mere</span>
<span class="sd">  collection of</span>
<span class="sd">  silicon and mobile</span>
<span class="sd">  electrons!</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c">#-----------------------------</span>
<span class="c"># merge multiple lines into one, then wrap one long line</span>

<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">fill</span>
<span class="kn">import</span> <span class="nn">fileinput</span>

<span class="k">print</span> <span class="n">fill</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">()))</span>

<span class="c">#-----------------------------</span>
<span class="c"># Term::ReadKey::GetTerminalSize() isn&#39;t in the Perl standard library. </span>
<span class="c"># It isn&#39;t in the Python standard library either. Michael Hudson&#39;s </span>
<span class="c"># recipe from python-list #530228 is shown here.</span>
<span class="c"># (http://aspn.activestate.com/ASPN/Mail/Message/python-list/530228)</span>
<span class="c"># Be aware that this will work on Unix but not on Windows.</span>

<span class="kn">from</span> <span class="nn">termwrap</span> <span class="kn">import</span> <span class="n">wrap</span>
<span class="kn">import</span> <span class="nn">struct</span><span class="o">,</span> <span class="nn">fcntl</span>
<span class="k">def</span> <span class="nf">getheightwidth</span><span class="p">():</span>
    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span>
        <span class="s">&quot;hhhh&quot;</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">ioctl</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">TERMIOS</span><span class="o">.</span><span class="n">TIOCGWINSZ</span> <span class="p">,</span><span class="s">&quot;</span><span class="se">\000</span><span class="s">&quot;</span><span class="o">*</span><span class="mi">8</span><span class="p">))[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span>

<span class="c"># PERL &lt;&gt;, $/, $\ emulation</span>
<span class="kn">import</span> <span class="nn">fileinput</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">_</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">getheightwidth</span><span class="p">()</span>
<span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&quot;\n{2,}&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">())):</span>
    <span class="k">print</span> <span class="n">fill</span><span class="p">(</span><span class="n">para</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>


<span class="c"># @@PLEAC@@_1.13</span>
<span class="c">#-----------------------------</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;Mom said, &quot;Don&#39;t do that.&quot;&#39;&#39;&#39;</span>  <span class="c">#&quot;</span>
<span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;[&#39;</span><span class="se">\&quot;</span><span class="s">]&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">mystr</span><span class="p">)</span>
<span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;[A-Z]&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">mystr</span><span class="p">)</span>
<span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;\W&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">&quot;is a test!&quot;</span><span class="p">)</span> <span class="c"># no function like quotemeta?</span>


<span class="c"># @@PLEAC@@_1.14</span>
<span class="c">#-----------------------------</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="n">mystr</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="c"># left</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="n">mystr</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="c"># right</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="n">mystr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c"># both ends</span>


<span class="c"># @@PLEAC@@_1.15</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="k">def</span> <span class="nf">parse_csv</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">([</span><span class="n">line</span><span class="p">],</span> <span class="n">escapechar</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">reader</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>

<span class="n">line</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;XYZZY,&quot;&quot;,&quot;O&#39;Reilly, Inc&quot;,&quot;Wall, Larry&quot;,&quot;a </span><span class="se">\\</span><span class="s">&quot;glug</span><span class="se">\\</span><span class="s">&quot; bit,&quot;,5,&quot;Error, Core Dumped,&quot;,&#39;&#39;&#39;</span> <span class="c">#&quot;</span>

<span class="n">fields</span> <span class="o">=</span> <span class="n">parse_csv</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fields</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s"> : </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>

<span class="c"># pre-2.3 version of parse_csv</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="k">def</span> <span class="nf">parse_csv</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;&#39;&#39;&quot;([^&quot;</span><span class="se">\\</span><span class="s">\]*(?:</span><span class="se">\\</span><span class="s">\.[^&quot;</span><span class="se">\\</span><span class="s">\]*)*)&quot;,?|([^,]+),?|,&#39;&#39;&#39;</span><span class="p">)</span>
    <span class="n">mylist</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> 
              <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">text</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;,&quot;</span><span class="p">:</span> 
        <span class="n">mylist</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">mylist</span>

<span class="c"># cvs.reader is meant to work for many lines, something like:</span>
<span class="c"># (NB: in Python default, quotechar is *not* escaped by backslash,</span>
<span class="c">#      but doubled instead. That&#39;s what Excel does.)</span>
<span class="k">for</span> <span class="n">fields</span> <span class="ow">in</span> <span class="n">cvs</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="s">&quot;some&quot;</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fields</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">num</span><span class="p">,</span> <span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="n">field</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_1.16</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">soundex</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; soundex module conforming to Knuth&#39;s algorithm</span>
<span class="sd">        implementation 2000-12-24 by Gregory Jorgensen</span>
<span class="sd">        public domain</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># digits holds the soundex values for the alphabet</span>
    <span class="n">digits</span> <span class="o">=</span> <span class="s">&#39;01230120022455012623010202&#39;</span>
    <span class="n">sndx</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">fc</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="c"># translate alpha chars in name to soundex digits</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fc</span><span class="p">:</span> 
                <span class="n">fc</span> <span class="o">=</span> <span class="n">c</span>   <span class="c"># remember first letter</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">digits</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">-</span><span class="nb">ord</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">)]</span>
            <span class="c"># duplicate consecutive soundex digits are skipped</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sndx</span> <span class="ow">or</span> <span class="p">(</span><span class="n">d</span> <span class="o">!=</span> <span class="n">sndx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">sndx</span> <span class="o">+=</span> <span class="n">d</span>

    <span class="c"># replace first digit with first alpha character</span>
    <span class="n">sndx</span> <span class="o">=</span> <span class="n">fc</span> <span class="o">+</span> <span class="n">sndx</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="c"># remove all 0s from the soundex code</span>
    <span class="n">sndx</span> <span class="o">=</span> <span class="n">sndx</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>

    <span class="c"># return soundex code padded to len characters</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">sndx</span> <span class="o">+</span> <span class="p">(</span><span class="nb">len</span> <span class="o">*</span> <span class="s">&#39;0&#39;</span><span class="p">))[:</span><span class="nb">len</span><span class="p">]</span>

<span class="n">user</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;Lookup user: &quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">user</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span>

<span class="n">name_code</span> <span class="o">=</span> <span class="n">soundex</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;/etc/passwd&quot;</span><span class="p">):</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">piece</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">name_code</span> <span class="o">==</span> <span class="n">soundex</span><span class="p">(</span><span class="n">piece</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_1.17</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">fileinput</span><span class="o">,</span> <span class="nn">re</span>

<span class="n">data</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">analysed        =&gt; analyzed</span>
<span class="s">built-in        =&gt; builtin</span>
<span class="s">chastized       =&gt; chastised</span>
<span class="s">commandline     =&gt; command-line</span>
<span class="s">de-allocate     =&gt; deallocate</span>
<span class="s">dropin          =&gt; drop-in</span>
<span class="s">hardcode        =&gt; hard-code</span>
<span class="s">meta-data       =&gt; metadata</span>
<span class="s">multicharacter  =&gt; multi-character</span>
<span class="s">multiway        =&gt; multi-way</span>
<span class="s">non-empty       =&gt; nonempty</span>
<span class="s">non-profit      =&gt; nonprofit</span>
<span class="s">non-trappable   =&gt; nontrappable</span>
<span class="s">pre-define      =&gt; predefine</span>
<span class="s">preextend       =&gt; pre-extend</span>
<span class="s">re-compiling    =&gt; recompiling</span>
<span class="s">reenter         =&gt; re-enter</span>
<span class="s">turnkey         =&gt; turn-key</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="n">mydict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">continue</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;=&gt;&quot;</span><span class="p">)]</span>
    <span class="n">mydict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<span class="n">pattern_text</span> <span class="o">=</span> <span class="s">&quot;(&quot;</span> <span class="o">+</span> <span class="s">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">mydict</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern_text</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">if</span> <span class="n">args</span> <span class="ow">and</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;-v&quot;</span><span class="p">:</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: Reading from stdin</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="s">&quot;.orig&quot;</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="n">line</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>
            <span class="k">break</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="n">line</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span> <span class="o">+</span> <span class="n">mydict</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_1.18</span>
<span class="c">#-----------------------------</span>
<span class="c">#!/usr/bin/python</span>
<span class="c"># psgrep - print selected lines of ps output by</span>
<span class="c">#          compiling user queries into code.</span>
<span class="c">#</span>
<span class="c"># examples :</span>
<span class="c"># psgrep &quot;uid&lt;10&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">re</span>

<span class="k">class</span> <span class="nc">PsLineMatch</span><span class="p">:</span>
    <span class="c"># each field from the PS header</span>
    <span class="n">fieldnames</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;flags&quot;</span><span class="p">,</span><span class="s">&quot;uid&quot;</span><span class="p">,</span><span class="s">&quot;pid&quot;</span><span class="p">,</span><span class="s">&quot;ppid&quot;</span><span class="p">,</span><span class="s">&quot;pri&quot;</span><span class="p">,</span><span class="s">&quot;nice&quot;</span><span class="p">,</span><span class="s">&quot;size&quot;</span><span class="p">,</span> \
                  <span class="s">&quot;rss&quot;</span><span class="p">,</span><span class="s">&quot;wchan&quot;</span><span class="p">,</span><span class="s">&quot;stat&quot;</span><span class="p">,</span><span class="s">&quot;tty&quot;</span><span class="p">,</span><span class="s">&quot;time&quot;</span><span class="p">,</span><span class="s">&quot;command&quot;</span><span class="p">)</span>
    <span class="n">numeric_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;flags&quot;</span><span class="p">,</span><span class="s">&quot;uid&quot;</span><span class="p">,</span><span class="s">&quot;pid&quot;</span><span class="p">,</span><span class="s">&quot;ppid&quot;</span><span class="p">,</span><span class="s">&quot;pri&quot;</span><span class="p">,</span><span class="s">&quot;nice&quot;</span><span class="p">,</span><span class="s">&quot;size&quot;</span><span class="p">,</span><span class="s">&quot;rss&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">new_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ln</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ln</span> <span class="o">=</span> <span class="n">ln</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="c"># ps header for option &quot;wwaxl&quot; (different than in the perl code)</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">          F   UID   PID  PPID PRI  NI   VSZ  RSS WCHAN  STAT TTY        TIME COMMAND&quot;</span>
<span class="sd">        004     0     1     0  15   0   448  236 schedu S    ?          0:07 init&quot;</span>
<span class="sd">        .   .     .     .     .   .   .     .    .      .    .    .          .</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># because only the last entry might contain blanks, splitting</span>
        <span class="c"># is safe</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ln</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fieldnames</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">numeric_fields</span><span class="p">:</span>  <span class="c"># make numbers integer </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span>

    <span class="k">def</span> <span class="nf">set_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="c"># assume args: &quot;uid==500&quot;, &quot;command ~ ^wm&quot;</span>
        <span class="n">conds</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;(\w+)([=&lt;&gt;]+)(.+)&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="p">(</span><span class="n">field</span><span class="p">,</span><span class="n">op</span><span class="p">,</span><span class="n">val</span><span class="p">)</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;can&#39;t understand query </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">SystemExit</span>
            <span class="k">if</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">numeric_fields</span><span class="p">:</span>
                <span class="n">conds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">conds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s%s</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span><span class="p">,(</span><span class="n">field</span><span class="p">,</span><span class="n">op</span><span class="p">,</span><span class="n">val</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_desirable</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s">&quot;((&quot;</span><span class="o">+</span><span class="s">&quot;)and(&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">conds</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;))&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;string&gt;&quot;</span><span class="p">,</span><span class="s">&quot;eval&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_desirable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_desirable</span><span class="p">,</span> <span class="p">{},</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># to allow &quot;print&quot;.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ln</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;&quot;&quot;usage: </span><span class="si">%s</span><span class="s"> criterion ...</span>
<span class="s">    Each criterion is a Perl expression involving: </span>
<span class="s">    </span><span class="si">%s</span><span class="s"></span>
<span class="s">    All criteria must be met for a line to be printed.&quot;&quot;&quot;</span> \
    <span class="o">%</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PsLineMatch</span><span class="p">()</span><span class="o">.</span><span class="n">fieldnames</span><span class="p">))</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span>

<span class="n">psln</span> <span class="o">=</span> <span class="n">PsLineMatch</span><span class="p">()</span>
<span class="n">psln</span><span class="o">.</span><span class="n">set_query</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;ps wwaxl&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">p</span><span class="o">.</span><span class="n">readline</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>        <span class="c"># emit header line</span>
<span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
    <span class="n">psln</span><span class="o">.</span><span class="n">new_line</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">psln</span><span class="o">.</span><span class="n">is_desirable</span><span class="p">():</span>
        <span class="k">print</span> <span class="n">psln</span>
<span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># alternatively one could consider every argument being a string and</span>
<span class="c"># support wildcards: &quot;uid==500&quot; &quot;command~^wm&quot; by means of re, but this</span>
<span class="c"># does not show dynamic python code generation, although re.compile</span>
<span class="c"># also precompiles.</span>
<span class="c">#-----------------------------</span>


<span class="c"># @@PLEAC@@_2.1</span>
<span class="c">#-----------------------------</span>
<span class="c"># The standard way of validating numbers is to convert them and catch</span>
<span class="c"># an exception on failure</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">myfloat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mystr</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;is a decimal number&quot;</span> 
<span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;is not a decimal number&quot;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">myint</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mystr</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;is an integer&quot;</span>
<span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;is not an integer&quot;</span>

<span class="c"># DON&#39;T DO THIS. Explicit checking is prone to errors:</span>
<span class="k">if</span> <span class="n">mystr</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>                         <span class="c"># Fails on &quot;+4&quot;</span>
    <span class="k">print</span> <span class="s">&#39;is a positive integer&#39;</span>   
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;is not&#39;</span>

<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;[+-]?\d+$&quot;</span><span class="p">,</span> <span class="n">mystr</span><span class="p">):</span>            <span class="c"># Fails on &quot;- 1&quot; </span>
    <span class="k">print</span> <span class="s">&#39;is an integer&#39;</span>           
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;is not&#39;</span>

<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;-?(?:\d+(?:\.\d*)?|\.\d+)$&quot;</span><span class="p">,</span> <span class="n">mystr</span><span class="p">):</span>  <span class="c"># Opaque, and fails on &quot;- 1&quot;</span>
    <span class="k">print</span> <span class="s">&#39;is a decimal number&#39;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;is not&#39;</span>

<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_2.2</span>
<span class="c">#-----------------------------</span>
<span class="c"># equal(num1, num2, accuracy) : returns true if num1 and num2 are</span>
<span class="c">#   equal to accuracy number of decimal places</span>

<span class="k">def</span> <span class="nf">equal</span><span class="p">(</span><span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">num1</span> <span class="o">-</span> <span class="n">num2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">accuracy</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>  <span class="c"># use / for float div and // for int div</span>

<span class="n">wage</span> <span class="o">=</span> <span class="mi">536</span>                                      <span class="c"># $5.36/hour</span>
<span class="n">week</span> <span class="o">=</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">wage</span>                                <span class="c"># $214.40</span>
<span class="k">print</span> <span class="s">&quot;One week&#39;s wage is: $</span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">week</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
<span class="c">#=&gt; One week&#39;s wage is: $214.40</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_2.3</span>
<span class="c">#-----------------------------</span>
<span class="n">rounded</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>            <span class="c"># rounds to integer</span>
<span class="c">#-----------------------------</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.255</span>
<span class="n">b</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">a</span>
<span class="k">print</span> <span class="s">&quot;Unrounded: </span><span class="si">%f</span><span class="se">\n</span><span class="s">Rounded: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Unrounded: </span><span class="si">%f</span><span class="se">\n</span><span class="s">Rounded: </span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="c">#=&gt; Unrounded: 0.255000</span>
<span class="c">#=&gt; Rounded: 0.26</span>
<span class="c">#=&gt; Unrounded: 0.255000</span>
<span class="c">#=&gt; Rounded: 0.26</span>
<span class="c">#-----------------------------</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">floor</span><span class="p">,</span> <span class="n">ceil</span>

<span class="k">print</span> <span class="s">&quot;number</span><span class="se">\t</span><span class="s">int</span><span class="se">\t</span><span class="s">floor</span><span class="se">\t</span><span class="s">ceil&quot;</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.3</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">3.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.3</span><span class="p">]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">% .1f</span><span class="se">\t</span><span class="si">% .1f</span><span class="se">\t</span><span class="si">% .1f</span><span class="se">\t</span><span class="si">% .1f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">floor</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">ceil</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="c">#=&gt; number  int   floor ceil</span>
<span class="c">#=&gt;  3.3     3.0   3.0   4.0</span>
<span class="c">#=&gt;  3.5     3.0   3.0   4.0</span>
<span class="c">#=&gt;  3.7     3.0   3.0   4.0</span>
<span class="c">#=&gt; -3.3    -3.0  -4.0  -3.0</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_2.4</span>
<span class="c">#-----------------------------</span>
<span class="c"># To convert a string in any base up to base 36, use the optional arg to int():</span>
<span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s">&#39;0110110&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>   <span class="c"># num is 54</span>

<span class="c"># To convert an int to an string representation in another base, you could use</span>
<span class="c"># &lt;http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/111286&gt;:</span>
<span class="kn">import</span> <span class="nn">baseconvert</span> 
<span class="k">def</span> <span class="nf">dec2bin</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">baseconvert</span><span class="o">.</span><span class="n">baseconvert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">baseconvert</span><span class="o">.</span><span class="n">BASE10</span><span class="p">,</span> <span class="n">baseconvert</span><span class="o">.</span><span class="n">BASE2</span><span class="p">)</span>

<span class="n">binstr</span> <span class="o">=</span> <span class="n">dec2bin</span><span class="p">(</span><span class="mi">54</span><span class="p">)</span>      <span class="c"># binstr is 110110</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_2.5</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="k">pass</span> <span class="c"># i is set to every integer from x to y, excluding y</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
    <span class="k">pass</span> <span class="c"># i is set to every integer from x to y, stepsize = 7</span>

<span class="k">print</span> <span class="s">&quot;Infancy is:&quot;</span><span class="p">,</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">i</span><span class="p">,</span>
<span class="k">print</span>

<span class="k">print</span> <span class="s">&quot;Toddling is:&quot;</span><span class="p">,</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">i</span><span class="p">,</span>
<span class="k">print</span>

<span class="c"># DON&#39;T DO THIS:</span>
<span class="k">print</span> <span class="s">&quot;Childhood is:&quot;</span><span class="p">,</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">12</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">i</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c">#=&gt; Infancy is: 0 1 2</span>
<span class="c">#=&gt; Toddling is: 3 4</span>
<span class="c">#=&gt; Childhood is: 5 6 7 8 9 10 11 12</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_2.6</span>
<span class="c">#-----------------------------</span>
<span class="c"># See http://www.faqts.com/knowledge_base/view.phtml/aid/4442</span>
<span class="c"># for a module that does this</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_2.7</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">random</span>          <span class="c"># use help(random) to see the (large) list of funcs</span>

<span class="n">rand</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">rand</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">76</span><span class="p">)</span>
<span class="k">print</span> <span class="n">rand</span>
<span class="c">#-----------------------------</span>
<span class="n">elt</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="n">chars</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span> <span class="o">+</span> <span class="s">&quot;!@$%^&amp;*&quot;</span>
<span class="n">password</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)])</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_2.8</span>
<span class="c">#-----------------------------</span>
<span class="c"># Changes the default RNG</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">()</span>

<span class="c"># Or you can create independent RNGs</span>
<span class="n">gen1</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="n">gen2</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="n">gen3</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">a1</span><span class="p">,</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">gen1</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="n">gen1</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
<span class="n">a2</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">gen2</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="n">gen2</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
<span class="n">a3</span><span class="p">,</span> <span class="n">b3</span> <span class="o">=</span> <span class="n">gen3</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="n">gen3</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
<span class="c"># a1 == a2 and b1 == b2</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_2.9</span>
<span class="c">#-----------------------------</span>
<span class="c"># see http://www.sbc.su.se/~per/crng/ or http://www.frohne.westhost.com/rv11reference.htm</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_2.10</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="n">mean</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">sdev</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">salary</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">sdev</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;You have been hired at </span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">salary</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_2.11</span>
<span class="c">#-----------------------------</span>
<span class="n">radians</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">degrees</span><span class="p">)</span>
<span class="n">degrees</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">radians</span><span class="p">)</span>

<span class="c"># pre-2.3:</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="k">def</span> <span class="nf">deg2rad</span><span class="p">(</span><span class="n">degrees</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">degrees</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
<span class="k">def</span> <span class="nf">rad2deg</span><span class="p">(</span><span class="n">radians</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">radians</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span>
<span class="c">#-----------------------------</span>
<span class="c"># Use deg2rad instead of math.radians if you have pre-2.3 Python.</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="k">def</span> <span class="nf">degree_sine</span><span class="p">(</span><span class="n">degrees</span><span class="p">):</span>
    <span class="n">radians</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">degrees</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">radians</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_2.12</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c"># DON&#39;T DO THIS.  Use math.tan() instead.</span>
<span class="k">def</span> <span class="nf">tan</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
<span class="c">#----------------</span>
<span class="c"># NOTE: this sets y to 16331239353195370.0</span>
<span class="k">try</span><span class="p">:</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
  <span class="n">y</span> <span class="o">=</span> <span class="bp">None</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_2.13</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="n">log_e</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">VALUE</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">log_10</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">VALUE</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">log_base</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># log_base defined as above</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">log_base</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;log10(10,000) =&quot;</span><span class="p">,</span> <span class="n">answer</span>
<span class="c">#=&gt; log10(10,000) = 4.0</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_2.14</span>
<span class="c">#-----------------------------</span>
<span class="c"># NOTE: must have NumPy installed.  See</span>
<span class="c">#   http://www.pfdubois.com/numpy/</span>

<span class="kn">import</span> <span class="nn">Numeric</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="p">),</span> <span class="s">&quot;d&quot;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                    <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                    <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">),</span> <span class="s">&quot;d&quot;</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">Numeric</span><span class="o">.</span><span class="n">matrixmultiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="k">print</span> <span class="n">c</span>
<span class="c">#=&gt; [[  54.   30.]</span>
<span class="c">#=&gt;  [ 165.   70.]]</span>

<span class="k">print</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">shape</span>
<span class="c">#=&gt; (2, 3) (3, 2) (2, 2)</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_2.15</span>
<span class="c">#-----------------------------</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="o">+</span><span class="mi">5j</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="o">-</span><span class="mi">2j</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
<span class="k">print</span> <span class="s">&quot;c =&quot;</span><span class="p">,</span> <span class="n">c</span>
<span class="c">#=&gt; c = (16+4j)</span>

<span class="k">print</span> <span class="n">c</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()</span>
<span class="c">#=&gt; 16.0 4.0 (16-4j)</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">cmath</span>
<span class="k">print</span> <span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">+</span><span class="mi">4j</span><span class="p">)</span>
<span class="c">#=&gt; (2+1j)</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_2.16</span>
<span class="c">#-----------------------------</span>
<span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hexadecimal</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">octal</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="nb">oct</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>

<span class="n">num</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;Gimme a number in decimal, octal, or hex: &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
<span class="k">if</span> <span class="n">num</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;0x&quot;</span><span class="p">):</span>
    <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="mi">16</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">num</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;0&quot;</span><span class="p">):</span>
    <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="mi">8</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;</span><span class="si">%(num)d</span><span class="s"> </span><span class="si">%(num)x</span><span class="s"> </span><span class="si">%(num)o</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">{</span> <span class="s">&quot;num&quot;</span><span class="p">:</span> <span class="n">num</span> <span class="p">}</span>
<span class="c">#-----------------------------</span>


<span class="c"># @@PLEAC@@_2.17</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">commify</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
    <span class="n">firstcomma</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span> <span class="ow">or</span> <span class="mi">3</span>  <span class="c"># set to 3 if would make a leading comma</span>
    <span class="n">first</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">amount</span><span class="p">[:</span><span class="n">firstcomma</span><span class="p">],</span> <span class="n">amount</span><span class="p">[</span><span class="n">firstcomma</span><span class="p">:]</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="p">[</span><span class="n">first</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">rest</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rest</span><span class="p">),</span> <span class="mi">3</span><span class="p">)]</span>
    <span class="k">return</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>

<span class="k">print</span> <span class="n">commify</span><span class="p">(</span><span class="mi">12345678</span><span class="p">)</span> 
<span class="c">#=&gt; 12,345,678</span>

<span class="c"># DON&#39;T DO THIS. It works on 2.3+ only and is slower and less straightforward</span>
<span class="c"># than the non-regex version above.</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="k">def</span> <span class="nf">commify</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;(\d\d\d)(?=\d)(?!\d*\.)&quot;</span><span class="p">,</span> <span class="s">r&quot;\1,&quot;</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">amount</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c"># @@PLEAC@@_2.18</span>
<span class="c"># Printing Correct Plurals</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">pluralise</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">singular</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">plural</span><span class="o">=</span><span class="s">&quot;s&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">root</span> <span class="o">+</span> <span class="n">singular</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">root</span> <span class="o">+</span> <span class="n">plural</span>

<span class="k">print</span> <span class="s">&quot;It took&quot;</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">pluralise</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="s">&#39;hour&#39;</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> enough.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">duration</span><span class="p">,</span> 
                            <span class="n">pluralise</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="s">&#39;hour&#39;</span><span class="p">),</span> 
                            <span class="n">pluralise</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;is&#39;</span><span class="p">,</span> <span class="s">&#39;are&#39;</span><span class="p">))</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="k">def</span> <span class="nf">noun_plural</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
    <span class="n">endings</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&quot;ss&quot;</span><span class="p">,</span> <span class="s">&quot;sses&quot;</span><span class="p">),</span>
               <span class="p">(</span><span class="s">&quot;([psc]h)&quot;</span><span class="p">,</span> <span class="s">r&quot;\1es&quot;</span><span class="p">),</span>
               <span class="p">(</span><span class="s">&quot;z&quot;</span><span class="p">,</span> <span class="s">&quot;zes&quot;</span><span class="p">),</span>
               <span class="p">(</span><span class="s">&quot;ff&quot;</span><span class="p">,</span> <span class="s">&quot;ffs&quot;</span><span class="p">),</span>
               <span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">,</span> <span class="s">&quot;ves&quot;</span><span class="p">),</span>
               <span class="p">(</span><span class="s">&quot;ey&quot;</span><span class="p">,</span> <span class="s">&quot;eys&quot;</span><span class="p">),</span>
               <span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="s">&quot;ies&quot;</span><span class="p">),</span>
               <span class="p">(</span><span class="s">&quot;ix&quot;</span><span class="p">,</span> <span class="s">&quot;ices&quot;</span><span class="p">),</span>
               <span class="p">(</span><span class="s">&quot;([sx])&quot;</span><span class="p">,</span> <span class="s">r&quot;\1es&quot;</span><span class="p">),</span>
               <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;s&quot;</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">singular</span><span class="p">,</span> <span class="n">plural</span> <span class="ow">in</span> <span class="n">endings</span><span class="p">:</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">found</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">subn</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">$&quot;</span><span class="o">%</span><span class="n">singular</span><span class="p">,</span> <span class="n">plural</span><span class="p">,</span> <span class="n">word</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span>
    
<span class="n">verb_singular</span> <span class="o">=</span> <span class="n">noun_plural</span><span class="p">;</span>       <span class="c"># make function alias</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_2.19</span>
<span class="c"># Program: Calculating Prime Factors</span>
<span class="c">#-----------------------------</span>
<span class="c">#% bigfact 8 9 96 2178</span>
<span class="c">#8          2**3</span>
<span class="c">#</span>
<span class="c">#9          3**2</span>
<span class="c">#</span>
<span class="c">#96         2**5 3</span>
<span class="c">#</span>
<span class="c">#2178       2 3**2 11**2</span>
<span class="c">#-----------------------------</span>
<span class="c">#% bigfact 239322000000000000000000</span>
<span class="c">#239322000000000000000000 2**19 3 5**18 39887 </span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#% bigfact 25000000000000000000000000</span>
<span class="c">#25000000000000000000000000 2**24 5**26</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">factorise</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="n">factors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">orig</span> <span class="o">=</span> <span class="n">num</span>
    <span class="k">print</span> <span class="n">num</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span>

    <span class="c"># we take advantage of the fact that (i +1)**2 = i**2 + 2*i +1</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">sqi</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span>
    <span class="k">while</span> <span class="n">sqi</span> <span class="o">&lt;=</span> <span class="n">num</span><span class="p">:</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">num</span><span class="o">%</span><span class="n">i</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">/=</span> <span class="n">i</span>
            <span class="n">factors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">factors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">sqi</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">num</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">num</span> <span class="o">!=</span> <span class="n">orig</span><span class="p">:</span>
        <span class="n">factors</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">factors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">factors</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;PRIME&quot;</span>

    <span class="k">for</span> <span class="n">factor</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">factors</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">factor</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">factors</span><span class="p">[</span><span class="n">factor</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">tmp</span> <span class="o">+=</span> <span class="s">&quot;**&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">factors</span><span class="p">[</span><span class="n">factor</span><span class="p">])</span>
            <span class="k">print</span> <span class="n">tmp</span><span class="p">,</span>
    <span class="k">print</span>
    
<span class="c">#--------</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Usage:&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot; number [number, ]&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">strnum</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">strnum</span><span class="p">)</span>
                <span class="n">factorise</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">strnum</span><span class="p">,</span> <span class="s">&quot;is not an integer&quot;</span>
<span class="c">#-----------------------------</span>
<span class="c"># A more Pythonic variant (which separates calculation from printing):</span>
<span class="k">def</span> <span class="nf">format_factor</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">exponent</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">exponent</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">**</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">exponent</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">factorise</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="n">factors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">orig</span> <span class="o">=</span> <span class="n">num</span>

    <span class="c"># we take advantage of the fact that (i+1)**2 = i**2 + 2*i +1</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">sqi</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span>
    <span class="k">while</span> <span class="n">sqi</span> <span class="o">&lt;=</span> <span class="n">num</span><span class="p">:</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">num</span><span class="o">%</span><span class="n">i</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">/=</span> <span class="n">i</span>
            <span class="n">factors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">factors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">sqi</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">orig</span><span class="p">):</span>
        <span class="n">factors</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">factors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">factors</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">&quot;PRIME&quot;</span><span class="p">]</span>

    <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">format_factor</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">exponent</span><span class="p">)</span>
           <span class="k">for</span> <span class="n">base</span><span class="p">,</span> <span class="n">exponent</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">factors</span><span class="o">.</span><span class="n">items</span><span class="p">())]</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="k">def</span> <span class="nf">print_factors</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can only factorise an integer&quot;</span><span class="p">)</span>
    <span class="n">factors</span> <span class="o">=</span> <span class="n">factorise</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> 
    <span class="k">print</span> <span class="n">num</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">factors</span><span class="p">)</span>

<span class="c"># @@PLEAC@@_3.0</span>
<span class="c">#----------------------------- </span>
<span class="c">#introduction</span>
<span class="c"># There are three common ways of manipulating dates in Python</span>
<span class="c"># mxDateTime - a popular third-party module (not discussed here) </span>
<span class="c"># time - a fairly low-level standard library module </span>
<span class="c"># datetime - a new library module for Python 2.3 and used for most of these samples </span>
<span class="c"># (I will use full names to show which module they are in, but you can also use</span>
<span class="c"># from datetime import datetime, timedelta and so on for convenience) </span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">print</span> <span class="s">&quot;Today is day&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()[</span><span class="mi">7</span><span class="p">],</span> <span class="s">&quot;of the current year&quot;</span> 
<span class="c"># Today is day 218 of the current year</span>

<span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;Today is day&quot;</span><span class="p">,</span> <span class="n">today</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()[</span><span class="mi">7</span><span class="p">],</span> <span class="s">&quot;of &quot;</span><span class="p">,</span> <span class="n">today</span><span class="o">.</span><span class="n">year</span>
<span class="c"># Today is day 218 of 2003</span>

<span class="k">print</span> <span class="s">&quot;Today is day&quot;</span><span class="p">,</span> <span class="n">today</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%j&quot;</span><span class="p">),</span> <span class="s">&quot;of the current year&quot;</span> 
<span class="c"># Today is day 218 of the current year</span>
 

<span class="c"># @@PLEAC@@_3.1</span>
<span class="c">#----------------------------- </span>
<span class="c"># Finding todays date</span>

<span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;The date is&quot;</span><span class="p">,</span> <span class="n">today</span> 
<span class="c">#=&gt; The date is 2003-08-06</span>

<span class="c"># the function strftime() (string-format time) produces nice formatting</span>
<span class="c"># All codes are detailed at http://www.python.org/doc/current/lib/module-time.html</span>
<span class="k">print</span> <span class="n">t</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;four-digit year: %Y, two-digit year: %y, month: %m, day: </span><span class="si">%d</span><span class="s">&quot;</span><span class="p">)</span> 
<span class="c">#=&gt; four-digit year: 2003, two-digit year: 03, month: 08, day: 06</span>


<span class="c"># @@PLEAC@@_3.2</span>
<span class="c">#----------------------------- </span>
<span class="c"># Converting DMYHMS to Epoch Seconds</span>
<span class="c"># To work with Epoch Seconds, you need to use the time module</span>

<span class="c"># For the local timezone</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;Epoch Seconds:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>
<span class="c">#=&gt; Epoch Seconds: 1060199000.0</span>

<span class="c"># For UTC</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;Epoch Seconds:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>
<span class="c">#=&gt; Epoch Seconds: 1060195503.0</span>


<span class="c"># @@PLEAC@@_3.3</span>
<span class="c">#----------------------------- </span>
<span class="c"># Converting Epoch Seconds to DMYHMS</span>

<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">EpochSeconds</span><span class="p">)</span>
<span class="c">#or use datetime.datetime.utcfromtimestamp()</span>
<span class="k">print</span> <span class="n">now</span>
<span class="c">#=&gt; datetime.datetime(2003, 8, 6, 20, 43, 20)</span>
<span class="k">print</span> <span class="n">now</span><span class="o">.</span><span class="n">ctime</span><span class="p">()</span>
<span class="c">#=&gt; Wed Aug  6 20:43:20 2003</span>

<span class="c"># or with the time module</span>
<span class="n">oldtimetuple</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">EpochSeconds</span><span class="p">)</span>
<span class="c"># oldtimetuple contains (year, month, day, hour, minute, second, weekday, yearday, daylightSavingAdjustment) </span>
<span class="k">print</span> <span class="n">oldtimetuple</span> 
<span class="c">#=&gt; (2003, 8, 6, 20, 43, 20, 2, 218, 1)</span>


<span class="c"># @@PLEAC@@_3.4</span>
<span class="c">#----------------------------- </span>
<span class="c"># Adding to or Subtracting from a Date</span>
<span class="c"># Use the rather nice datetime.timedelta objects</span>

<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2003</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">difference1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">difference2</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;One day in the future is:&quot;</span><span class="p">,</span> <span class="n">now</span> <span class="o">+</span> <span class="n">difference1</span>
<span class="c">#=&gt; One day in the future is: 2003-08-07</span>

<span class="k">print</span> <span class="s">&quot;Two weeks in the past is:&quot;</span><span class="p">,</span> <span class="n">now</span> <span class="o">+</span> <span class="n">difference2</span>
<span class="c">#=&gt; Two weeks in the past is: 2003-07-23</span>

<span class="k">print</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2003</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="c">#=&gt; 1095 days, 0:00:00</span>

<span class="c">#----------------------------- </span>
<span class="n">birthtime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1973</span><span class="p">,</span> <span class="mo">01</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>   <span class="c"># 1973-01-18 03:45:50</span>

<span class="n">interval</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">hours</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">55</span><span class="p">)</span> 
<span class="n">then</span> <span class="o">=</span> <span class="n">birthtime</span> <span class="o">+</span> <span class="n">interval</span>

<span class="k">print</span> <span class="s">&quot;Then is&quot;</span><span class="p">,</span> <span class="n">then</span><span class="o">.</span><span class="n">ctime</span><span class="p">()</span>
<span class="c">#=&gt; Then is Wed Mar 14 06:02:55 1973</span>

<span class="k">print</span> <span class="s">&quot;Then is&quot;</span><span class="p">,</span> <span class="n">then</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%A %B </span><span class="si">%d</span><span class="s"> %I:%M:%S %p %Y&quot;</span><span class="p">)</span>
<span class="c">#=&gt; Then is Wednesday March 14 06:02:55 AM 1973</span>

<span class="c">#-----------------------------</span>
<span class="n">when</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1973</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">55</span><span class="p">)</span> 
<span class="k">print</span> <span class="s">&quot;Nat was 55 days old on:&quot;</span><span class="p">,</span> <span class="n">when</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%m/</span><span class="si">%d</span><span class="s">/%Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
<span class="c">#=&gt; Nat was 55 days old on: 3/14/1973</span>


<span class="c"># @@PLEAC@@_3.5</span>
<span class="c">#----------------------------- </span>
<span class="c"># Dates produce timedeltas when subtracted.</span>

<span class="n">diff</span> <span class="o">=</span> <span class="n">date2</span> <span class="o">-</span> <span class="n">date1</span>
<span class="n">diff</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year1</span><span class="p">,</span> <span class="n">month1</span><span class="p">,</span> <span class="n">day1</span><span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year2</span><span class="p">,</span> <span class="n">month2</span><span class="p">,</span> <span class="n">day2</span><span class="p">)</span>
<span class="c">#----------------------------- </span>

<span class="n">bree</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1981</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">nat</span>  <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1973</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

<span class="n">difference</span> <span class="o">=</span> <span class="n">bree</span> <span class="o">-</span> <span class="n">nat</span>
<span class="k">print</span> <span class="s">&quot;There were&quot;</span><span class="p">,</span> <span class="n">difference</span><span class="p">,</span> <span class="s">&quot;minutes between Nat and Bree&quot;</span>
<span class="c">#=&gt; There were 3071 days, 0:49:35 between Nat and Bree</span>

<span class="n">weeks</span><span class="p">,</span> <span class="n">days</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">difference</span><span class="o">.</span><span class="n">days</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

<span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">difference</span><span class="o">.</span><span class="n">seconds</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
<span class="n">hours</span><span class="p">,</span> <span class="n">minutes</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">minutes</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s"> weeks, </span><span class="si">%d</span><span class="s"> days, </span><span class="si">%d</span><span class="s">:</span><span class="si">%d</span><span class="s">:</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">weeks</span><span class="p">,</span> <span class="n">days</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span><span class="p">)</span>
<span class="c">#=&gt; 438 weeks, 5 days, 0:49:35</span>

<span class="c">#----------------------------- </span>
<span class="k">print</span> <span class="s">&quot;There were&quot;</span><span class="p">,</span> <span class="n">difference</span><span class="o">.</span><span class="n">days</span><span class="p">,</span> <span class="s">&quot;days between Bree and Nat.&quot;</span> 
<span class="c">#=&gt; There were 3071 days between bree and nat</span>


<span class="c"># @@PLEAC@@_3.6</span>
<span class="c">#----------------------------- </span>
<span class="c"># Day in a Week/Month/Year or Week Number</span>

<span class="n">when</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">1981</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;16/6/1981 was:&quot;</span>
<span class="k">print</span> <span class="n">when</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;Day %w of the week (a %A). Day </span><span class="si">%d</span><span class="s"> of the month (%B).&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">when</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;Day %j of the year (%Y), in week %W of the year.&quot;</span><span class="p">)</span>

<span class="c">#=&gt; 16/6/1981 was:</span>
<span class="c">#=&gt; Day 2 of the week (a Tuesday). Day 16 of the month (June).</span>
<span class="c">#=&gt; Day 167 of the year (1981), in week 24 of the year.</span>


<span class="c"># @@PLEAC@@_3.7</span>
<span class="c">#----------------------------- </span>
<span class="c"># Parsing Dates and Times from Strings</span>

<span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s">&quot;Tue Jun 16 20:18:03 1981&quot;</span><span class="p">)</span>
<span class="c"># (1981, 6, 16, 20, 18, 3, 1, 167, -1)</span>

<span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s">&quot;16/6/1981&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">/%m/%Y&quot;</span><span class="p">)</span>
<span class="c"># (1981, 6, 16, 0, 0, 0, 1, 167, -1)</span>
<span class="c"># strptime() can use any of the formatting codes from time.strftime()</span>

<span class="c"># The easiest way to convert this to a datetime seems to be; </span>
<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s">&quot;16/6/1981&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">/%m/%Y&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>
<span class="c"># the &#39;*&#39; operator unpacks the tuple, producing the argument list.</span>


<span class="c"># @@PLEAC@@_3.8</span>
<span class="c">#----------------------------- </span>
<span class="c"># Printing a Date</span>
<span class="c"># Use datetime.strftime() - see helpfiles in distro or at python.org</span>

<span class="k">print</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;The date is %A (%a) </span><span class="si">%d</span><span class="s">/%m/%Y&quot;</span><span class="p">)</span> 
<span class="c">#=&gt; The date is Friday (Fri) 08/08/2003</span>

<span class="c"># @@PLEAC@@_3.9</span>
<span class="c">#----------------------------- </span>
<span class="c"># High Resolution Timers</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<span class="c"># Do Stuff Here</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<span class="k">print</span> <span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span>

<span class="c"># 2.27236813618</span>
<span class="c"># Accuracy will depend on platform and OS,</span>
<span class="c"># but time.clock() uses the most accurate timer it can</span>

<span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">();</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<span class="c"># 174485.51365466841</span>
<span class="c"># 174485.55702610247</span>

<span class="c">#----------------------------- </span>
<span class="c"># Also useful;</span>
<span class="kn">import</span> <span class="nn">timeit</span>
<span class="n">code</span> <span class="o">=</span> <span class="s">&#39;[x for x in range(10) if x % 2 == 0]&#39;</span>
<span class="nb">eval</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="c"># [0, 2, 4, 6, 8]</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;10,000 repeats of that code takes:&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="mi">10000</span><span class="p">),</span> <span class="s">&quot;seconds&quot;</span> 
<span class="k">print</span> <span class="s">&quot;1,000,000 repeats of that code takes:&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">timeit</span><span class="p">(),</span> <span class="s">&quot;seconds&quot;</span>

<span class="c"># 10,000 repeats of that code takes: 0.128238644856 seconds</span>
<span class="c"># 1,000,000 repeats of that code takes:  12.5396490336 seconds</span>

<span class="c">#----------------------------- </span>
<span class="kn">import</span> <span class="nn">timeit</span>
<span class="n">code</span> <span class="o">=</span> <span class="s">&#39;import random; l = random.sample(xrange(10000000), 1000); l.sort()&#39;</span> 
<span class="n">t</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;Create a list of a thousand random numbers. Sort the list. Repeated a thousand times.&quot;</span> 
<span class="k">print</span> <span class="s">&quot;Average Time:&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>
<span class="c"># Time taken: 5.24391507859</span>


<span class="c"># @@PLEAC@@_3.10</span>
<span class="c">#----------------------------- </span>
<span class="c"># Short Sleeps</span>

<span class="n">seconds</span> <span class="o">=</span> <span class="mf">3.1</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;boo&quot;</span>

<span class="c"># @@PLEAC@@_3.11</span>
<span class="c">#----------------------------- </span>
<span class="c"># Program HopDelta</span>
<span class="c"># Save a raw email to disk and run &quot;python hopdelta.py FILE&quot;</span>
<span class="c"># and it will process the headers and show the time taken</span>
<span class="c"># for each server hop (nb: if server times are wrong, negative dates</span>
<span class="c"># might appear in the output).</span>

<span class="kn">import</span> <span class="nn">datetime</span><span class="o">,</span> <span class="nn">email</span><span class="o">,</span> <span class="nn">email.Utils</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">extract_date</span><span class="p">(</span><span class="n">hop</span><span class="p">):</span>
    <span class="c"># According to RFC822, the date will be prefixed with</span>
    <span class="c"># a semi-colon, and is the last part of a received</span>
    <span class="c"># header.</span>
    <span class="n">date_string</span> <span class="o">=</span> <span class="n">hop</span><span class="p">[</span><span class="n">hop</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">:]</span>
    <span class="n">date_string</span> <span class="o">=</span> <span class="n">date_string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">time_tuple</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">Utils</span><span class="o">.</span><span class="n">parsedate</span><span class="p">(</span><span class="n">date_string</span><span class="p">)</span>

    <span class="c"># convert time_tuple to datetime</span>
    <span class="n">EpochSeconds</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">time_tuple</span><span class="p">)</span> 
    <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">EpochSeconds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dt</span>

<span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="c"># Main email file processing</span>
    <span class="c"># read the headers and process them</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_file</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="n">hops</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="s">&#39;received&#39;</span><span class="p">)</span>
    
    <span class="c"># in reverse order, get the server(s) and date/time involved</span>
    <span class="n">hops</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">hop</span> <span class="ow">in</span> <span class="n">hops</span><span class="p">:</span>
        <span class="n">hop</span> <span class="o">=</span> <span class="n">hop</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">hop</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;by&#39;</span><span class="p">):</span>  <span class="c"># &#39;Received: by&#39; line</span>
            <span class="n">sender</span> <span class="o">=</span> <span class="s">&quot;start&quot;</span>
            <span class="n">receiver</span> <span class="o">=</span> <span class="n">hop</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="n">hop</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">extract_date</span><span class="p">(</span><span class="n">hop</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c"># &#39;Received: from&#39; line</span>
            <span class="n">sender</span> <span class="o">=</span> <span class="n">hop</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="n">hop</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">)]</span>
            <span class="n">by</span> <span class="o">=</span> <span class="n">hop</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;by &#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span>
            <span class="n">receiver</span> <span class="o">=</span> <span class="n">hop</span><span class="p">[</span><span class="n">by</span><span class="p">:</span><span class="n">hop</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">by</span><span class="p">)]</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">extract_date</span><span class="p">(</span><span class="n">hop</span><span class="p">)</span>

        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">sender</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">date</span><span class="p">))</span>
    <span class="n">output</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Sender, Recipient, Time, Delta&quot;</span>
    <span class="k">print</span>
    <span class="n">previous_dt</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">previous_dt</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">date</span> <span class="o">-</span> <span class="n">previous_dt</span>
        
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sender</span><span class="p">,</span>
                               <span class="n">receiver</span><span class="p">,</span>
                               <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y/</span><span class="si">%d</span><span class="s">/%m %H:%M:%S&quot;</span><span class="p">),</span>
                               <span class="n">delta</span><span class="p">)</span>
        <span class="k">print</span>
        <span class="n">previous_dt</span> <span class="o">=</span> <span class="n">date</span>   
            
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c"># Perform some basic argument checking</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Usage: mailhop.py FILENAME&quot;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="n">process</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">filename</span><span class="p">,</span> <span class="s">&quot;doesn&#39;t seem to be a valid file.&quot;</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>


<span class="c"># @@PLEAC@@_4.0</span>
<span class="c">#-----------------------------</span>
<span class="c"># Python does not automatically flatten lists, in other words</span>
<span class="c"># in the following, non-nested contains four elements and</span>
<span class="c"># nested contains three elements, the third element of which</span>
<span class="c"># is itself a list containing two elements:</span>
<span class="n">non_nested</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;this&quot;</span><span class="p">,</span> <span class="s">&quot;that&quot;</span><span class="p">,</span> <span class="s">&quot;the&quot;</span><span class="p">,</span> <span class="s">&quot;other&quot;</span><span class="p">]</span>
<span class="n">nested</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;this&quot;</span><span class="p">,</span> <span class="s">&quot;that&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;the&quot;</span><span class="p">,</span> <span class="s">&quot;other&quot;</span><span class="p">]]</span>
<span class="c">#-----------------------------</span>
<span class="n">tune</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;The&quot;</span><span class="p">,</span> <span class="s">&quot;Star-Spangled&quot;</span><span class="p">,</span> <span class="s">&quot;Banner&quot;</span><span class="p">]</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_4.1</span>
<span class="c">#-----------------------------</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;quick&quot;</span><span class="p">,</span> <span class="s">&quot;brown&quot;</span><span class="p">,</span> <span class="s">&quot;fox&quot;</span><span class="p">]</span>
<span class="n">a</span> <span class="o">=</span> <span class="s">&quot;Why are you teasing me?&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="n">text</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    The boy stood on the burning deck,</span>
<span class="s">    It was as hot as glass.</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)]</span>
<span class="c">#-----------------------------</span>
<span class="n">biglist</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;mydatafile&quot;</span><span class="p">)]</span>
<span class="c">#-----------------------------</span>
<span class="n">banner</span> <span class="o">=</span> <span class="s">&quot;The Mines of Moria&quot;</span>
<span class="n">banner</span> <span class="o">=</span> <span class="s">&#39;The Mines of Moria&#39;</span>
<span class="c">#-----------------------------</span>
<span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Gandalf&quot;</span>
<span class="n">banner</span> <span class="o">=</span> <span class="s">&quot;Speak, &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;, and enter!&quot;</span>
<span class="n">banner</span> <span class="o">=</span> <span class="s">&quot;Speak, </span><span class="si">%s</span><span class="s">, and welcome!&quot;</span> <span class="o">%</span> <span class="n">name</span>
<span class="c">#-----------------------------</span>
<span class="n">his_host</span> <span class="o">=</span> <span class="s">&quot;www.python.org&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">host_info</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;nslookup &quot;</span> <span class="o">+</span> <span class="n">his_host</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c"># NOTE: not really relevant to Python (no magic &#39;$$&#39; variable)</span>
<span class="n">python_info</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;ps </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">shell_info</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;ps $$&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="c"># NOTE: not really relevant to Python (no automatic interpolation)</span>
<span class="n">banner</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Costs&quot;</span><span class="p">,</span> <span class="s">&quot;only&quot;</span><span class="p">,</span> <span class="s">&quot;$4.95&quot;</span><span class="p">]</span>
<span class="n">banner</span> <span class="o">=</span> <span class="s">&quot;Costs only $4.95&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="n">brax</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot; &#39; &quot; ( ) &lt; &gt; { } [ ] &quot;&quot;&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>            <span class="c">#&quot;&quot;&quot;</span>
<span class="n">brax</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s">&quot;&quot;&quot;&#39;&quot;()&lt;&gt;{}[]&quot;&quot;&quot;</span><span class="p">)</span>                         <span class="c">#&quot;&quot;&quot;</span>
<span class="n">rings</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;They&#39;re  &quot;Nenya Narya Vilya&quot;&#39;&#39;&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>    <span class="c">#&#39;&#39;&#39;</span>
<span class="n">tags</span>   <span class="o">=</span> <span class="s">&#39;LI TABLE TR TD A IMG H1 P&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">sample</span> <span class="o">=</span> <span class="s">r&#39;The backslash (\) is often used in regular expressions.&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="c">#-----------------------------</span>
<span class="n">banner</span> <span class="o">=</span> <span class="s">&quot;The backslash (</span><span class="se">\\</span><span class="s">) is often used in regular expressions.&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="n">ships</span> <span class="o">=</span> <span class="s">u&quot;Niсa Pinta Santa Marнa&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>          <span class="c"># WRONG (only three ships)</span>
<span class="n">ships</span> <span class="o">=</span> <span class="p">[</span><span class="s">u&quot;Niсa&quot;</span><span class="p">,</span> <span class="s">u&quot;Pinta&quot;</span><span class="p">,</span> <span class="s">u&quot;Santa Marнa&quot;</span><span class="p">]</span>        <span class="c"># right</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_4.2</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">commify_series</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
        <span class="k">return</span> <span class="s">&quot;&quot;</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot; and &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;, and &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">commify_series</span><span class="p">([])</span>
<span class="n">commify_series</span><span class="p">([</span><span class="s">&quot;red&quot;</span><span class="p">])</span>
<span class="n">commify_series</span><span class="p">([</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;yellow&quot;</span><span class="p">])</span>
<span class="n">commify_series</span><span class="p">([</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;yellow&quot;</span><span class="p">,</span> <span class="s">&quot;green&quot;</span><span class="p">])</span>
<span class="c">#-----------------------------</span>
<span class="n">mylist</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;yellow&quot;</span><span class="p">,</span> <span class="s">&quot;green&quot;</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&quot;I have&quot;</span><span class="p">,</span> <span class="n">mylist</span><span class="p">,</span> <span class="s">&quot;marbles.&quot;</span>
<span class="k">print</span> <span class="s">&quot;I have&quot;</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mylist</span><span class="p">),</span> <span class="s">&quot;marbles.&quot;</span>
<span class="c">#=&gt; I have [&#39;red&#39;, &#39;yellow&#39;, &#39;green&#39;] marbles.</span>
<span class="c">#=&gt; I have red yellow green marbles.</span>

<span class="c">#-----------------------------</span>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># commify_series - show proper comma insertion in list output</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span> <span class="s">&#39;just one thing&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">(</span> <span class="s">&#39;Mutt Jeff&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="p">),</span>
    <span class="p">(</span> <span class="s">&#39;Peter Paul Mary&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="p">),</span>
    <span class="p">(</span> <span class="s">&#39;To our parents&#39;</span><span class="p">,</span> <span class="s">&#39;Mother Theresa&#39;</span><span class="p">,</span> <span class="s">&#39;God&#39;</span> <span class="p">),</span>
    <span class="p">(</span> <span class="s">&#39;pastrami&#39;</span><span class="p">,</span> <span class="s">&#39;ham and cheese&#39;</span><span class="p">,</span> <span class="s">&#39;peanut butter and jelly&#39;</span><span class="p">,</span> <span class="s">&#39;tuna&#39;</span> <span class="p">),</span>
    <span class="p">(</span> <span class="s">&#39;recycle tired, old phrases&#39;</span><span class="p">,</span> <span class="s">&#39;ponder big, happy thoughts&#39;</span> <span class="p">),</span>
    <span class="p">(</span> <span class="s">&#39;recycle tired, old phrases&#39;</span><span class="p">,</span>
      <span class="s">&#39;ponder big, happy thoughts&#39;</span><span class="p">,</span>
      <span class="s">&#39;sleep and dream peacefully&#39;</span> <span class="p">),</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">commify_series</span><span class="p">(</span><span class="n">terms</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">term</span><span class="p">:</span>
            <span class="n">sepchar</span> <span class="o">=</span> <span class="s">&quot;; &quot;</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sepchar</span> <span class="o">=</span> <span class="s">&quot;, &quot;</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
        <span class="k">return</span> <span class="s">&quot;&quot;</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">terms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&quot; and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s%s</span><span class="s">and </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sepchar</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">terms</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">sepchar</span><span class="p">,</span> <span class="n">terms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;The list is: </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">commify_series</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

<span class="c">#=&gt; The list is: just one thing.</span>
<span class="c">#=&gt; The list is: Mutt and Jeff.</span>
<span class="c">#=&gt; The list is: Peter, Paul, and Mary.</span>
<span class="c">#=&gt; The list is: To our parents, Mother Theresa, and God.</span>
<span class="c">#=&gt; The list is: pastrami, ham and cheese, peanut butter and jelly, and tuna.</span>
<span class="c">#=&gt; The list is: recycle tired, old phrases and ponder big, happy thoughts.</span>
<span class="c">#=&gt; The list is: recycle tired, old phrases; ponder big, happy thoughts; and</span>
<span class="c">#   sleep and dream peacefully.</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_4.3</span>
<span class="c">#-----------------------------</span>
<span class="c"># Python allocates more space than is necessary every time a list needs to</span>
<span class="c"># grow and only shrinks lists when more than half the available space is</span>
<span class="c"># unused.  This means that adding or removing an element will in most cases</span>
<span class="c"># not force a reallocation.</span>

<span class="k">del</span> <span class="n">mylist</span><span class="p">[</span><span class="n">size</span><span class="p">:]</span>         <span class="c"># shrink mylist</span>
<span class="n">mylist</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">size</span>   <span class="c"># grow mylist by appending &#39;size&#39; None elements</span>

<span class="c"># To add an element to the end of a list, use the append method:</span>
<span class="n">mylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="c"># To insert an element, use the insert method:</span>
<span class="n">mylist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="c"># Insert 10 at the beginning of the list</span>

<span class="c"># To extend one list with the contents of another, use the extend method:</span>
<span class="n">list2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">mylist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">list2</span><span class="p">)</span>

<span class="c"># To insert the contents of one list into another, overwriting zero or </span>
<span class="c"># more elements, specify a slice:</span>
<span class="n">mylist</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">list2</span>   <span class="c"># Don&#39;t overwrite anything; grow mylist if needed</span>
<span class="n">mylist</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">list2</span>   <span class="c"># Overwrite mylist[2] and grow mylist if needed</span>

<span class="c"># To remove one element from the middle of a list:</span>
<span class="c"># To remove elements from the middle of a list:</span>
<span class="k">del</span> <span class="n">mylist</span><span class="p">[</span><span class="n">idx1</span><span class="p">:</span><span class="n">idx2</span><span class="p">]</span>  <span class="c"># 0 or more</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">mylist</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>    <span class="c"># remove mylist[idx] and assign it to x</span>

<span class="c"># You cannot assign to or get a non-existent element:</span>
<span class="c"># &gt;&gt;&gt; x = []</span>
<span class="c"># &gt;&gt;&gt; x[4] = 5</span>
<span class="c">#</span>
<span class="c"># Traceback (most recent call last):</span>
<span class="c">#   File &quot;&lt;pyshell#1&gt;&quot;, line 1, in -toplevel-</span>
<span class="c">#     x[4] = 5</span>
<span class="c"># IndexError: list assignment index out of range</span>
<span class="c">#</span>
<span class="c"># &gt;&gt;&gt; print x[1000]</span>
<span class="c">#</span>
<span class="c"># Traceback (most recent call last):</span>
<span class="c">#  File &quot;&lt;pyshell#16&gt;&quot;, line 1, in -toplevel-</span>
<span class="c">#    print x[1000]</span>
<span class="c"># IndexError: list index out of range</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">what_about_that_list</span><span class="p">(</span><span class="n">terms</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;The list now has&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">),</span> <span class="s">&quot;elements.&quot;</span>
    <span class="k">print</span> <span class="s">&quot;The index of the last element is&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;(or -1).&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Element #3 is </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">terms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

<span class="n">people</span> <span class="o">=</span> <span class="s">&quot;Crosby Stills Nash Young&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">what_about_that_list</span><span class="p">(</span><span class="n">people</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c">#=&gt; The list now has 4 elements.</span>
<span class="c">#=&gt; The index of the last element is 3 (or -1).</span>
<span class="c">#=&gt; Element #3 is Young.</span>
<span class="c">#-----------------------------</span>
<span class="n">people</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="n">what_about_that_list</span><span class="p">(</span><span class="n">people</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">people</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10000</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">people</span><span class="p">))</span>
<span class="c">#-----------------------------</span>
<span class="c">#&gt;&gt;&gt; people += [None] * (10000 - len(people))</span>
<span class="c">#&gt;&gt;&gt; what_about_that_list(people)</span>
<span class="c">#The list now has 10000 elements.</span>
<span class="c">#The index of the last element is 9999 (or -1).</span>
<span class="c">#Element #3 is None.</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_4.4</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
    <span class="k">pass</span> <span class="c"># do something with item</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">bad_users</span><span class="p">:</span>
    <span class="n">complain</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">all_users</span><span class="p">:</span>
    <span class="n">disk_space</span> <span class="o">=</span> <span class="n">get_usage</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>    <span class="c"># find out how much disk space in use</span>
    <span class="k">if</span> <span class="n">disk_space</span> <span class="o">&gt;</span> <span class="n">MAX_QUOTA</span><span class="p">:</span>      <span class="c"># if it&#39;s more than we want ...</span>
        <span class="n">complain</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>              <span class="c"># ... then object vociferously</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;who&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="s">&quot;dalke&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">line</span><span class="p">,</span>  <span class="c"># or print line[:-1]</span>

<span class="c"># or:</span>
<span class="k">print</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;who&quot;</span><span class="p">)</span>
                   <span class="k">if</span> <span class="s">&quot;dalke&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">]),</span>

<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">myfile</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span> <span class="c"># Split on whitespace</span>
        <span class="k">print</span> <span class="n">word</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>     <span class="c"># reverse word</span>
    <span class="k">print</span>

<span class="c"># pre 2.3:</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">myfile</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span> <span class="c"># Split on whitespace</span>
        <span class="n">chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>    <span class="c"># Turn the string into a list of characters</span>
        <span class="n">chars</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chars</span><span class="p">),</span>
    <span class="k">print</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;i =&quot;</span><span class="p">,</span> <span class="n">item</span>
<span class="c">#-----------------------------</span>
<span class="c"># NOTE: you can&#39;t modify in place the way Perl does:</span>
<span class="c"># data = [1, 2, 3]</span>
<span class="c"># for elem in data:</span>
<span class="c">#     elem -= 1</span>
<span class="c">#print data</span>
<span class="c">#=&gt;[1, 2, 3]</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
<span class="k">print</span> <span class="n">data</span>
<span class="c">#=&gt;[0, 1, 2]</span>

<span class="c"># or</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">elem</span> <span class="o">-</span> <span class="mi">1</span>
<span class="c">#-----------------------------</span>
<span class="c"># NOTE: strings are immutable in Python so this doesn&#39;t translate well.</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mydict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">mydict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_4.5</span>
<span class="c">#-----------------------------</span>
<span class="n">fruits</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Apple&quot;</span><span class="p">,</span> <span class="s">&quot;Blackberry&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">fruit</span> <span class="ow">in</span> <span class="n">fruits</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">fruit</span><span class="p">,</span> <span class="s">&quot;tastes good in a pie.&quot;</span>
<span class="c">#=&gt; Apple tastes good in a pie.</span>
<span class="c">#=&gt; Blackberry tastes good in a pie.</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fruits</span><span class="p">)):</span>
    <span class="k">print</span> <span class="n">fruits</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s">&quot;tastes good in a pie.&quot;</span>

<span class="c"># If you must explicitly index, use enumerate():</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fruit</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fruits</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">) </span><span class="si">%s</span><span class="s"> tastes good in a pie.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">fruit</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">rogue_cats</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Morris&quot;</span><span class="p">,</span> <span class="s">&quot;Felix&quot;</span><span class="p">]</span>
<span class="n">namedict</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;felines&quot;</span><span class="p">:</span> <span class="n">rogue_cats</span> <span class="p">}</span>
<span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">namedict</span><span class="p">[</span><span class="s">&quot;felines&quot;</span><span class="p">]:</span>
    <span class="k">print</span> <span class="n">cat</span><span class="p">,</span> <span class="s">&quot;purrs hypnotically.&quot;</span>
<span class="k">print</span> <span class="s">&quot;--More--</span><span class="se">\n</span><span class="s">You are controlled.&quot;</span>
<span class="c">#-----------------------------</span>
<span class="c"># As noted before, if you need an index, use enumerate() and not this:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">namedict</span><span class="p">[</span><span class="s">&quot;felines&quot;</span><span class="p">])):</span>
    <span class="k">print</span> <span class="n">namedict</span><span class="p">[</span><span class="s">&quot;felines&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="s">&quot;purrs hypnotically.&quot;</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_4.6</span>
<span class="c">#-----------------------------</span>
<span class="n">uniq</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">mylist</span><span class="p">))</span>
<span class="c">#-----------------------------</span>
<span class="c"># See http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/259174</span>
<span class="c"># for a more heavyweight version of a bag</span>
<span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
    <span class="n">seen</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">seen</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">uniq</span> <span class="o">=</span> <span class="n">seen</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">uniq</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">seen</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">uniq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">seen</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
<span class="c">#-----------------------------</span>
<span class="c"># generate a list of users logged in, removing duplicates</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">usernames</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;who&quot;</span><span class="p">)]</span>
<span class="n">uniq</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">usernames</span><span class="p">))</span>
<span class="k">print</span> <span class="s">&quot;users logged in:&quot;</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">uniq</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS:</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">ucnt</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;who&quot;</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>  <span class="c"># Get the first word</span>
    <span class="n">ucnt</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">=</span> <span class="n">ucnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="c"># record the users&#39; presence</span>

<span class="c"># extract and print unique keys</span>
<span class="n">users</span> <span class="o">=</span> <span class="n">ucnt</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">users</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;users logged in:&quot;</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_4.7</span>
<span class="c">#-----------------------------</span>
<span class="c"># assume a_list and b_list are already loaded</span>
<span class="n">aonly</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">a_list</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">b_list</span><span class="p">]</span>

<span class="c"># A slightly more complex Pythonic version using sets - if you had a few</span>
<span class="c"># lists, subtracting sets would be clearer than the listcomp version above</span>
<span class="n">a_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">a_list</span><span class="p">)</span>
<span class="n">b_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">b_list</span><span class="p">)</span>
<span class="n">aonly</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">a_set</span> <span class="o">-</span> <span class="n">b_set</span><span class="p">)</span>  <span class="c"># Elements in a_set but not in b_set</span>

<span class="c"># DON&#39;T DO THIS.</span>
<span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span>                 <span class="c"># lookup table to test membership of B</span>
<span class="n">aonly</span> <span class="o">=</span> <span class="p">[]</span>                <span class="c"># answer</span>

<span class="c">#    build lookup table</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">b_list</span><span class="p">:</span>
    <span class="n">seen</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c">#    find only elements in a_list and not in b_list</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">a_list</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
        <span class="c"># it&#39;s not in &#39;seen&#39;, so add to &#39;aonly&#39;</span>
        <span class="n">aonly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS.  There&#39;s lots of ways not to do it.</span>
<span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span>   <span class="c"># lookup table</span>
<span class="n">aonly</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c"># answer</span>

<span class="c">#     build lookup table - unnecessary and poor Python style</span>
<span class="p">[</span><span class="n">seen</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">b_list</span><span class="p">]</span>

<span class="n">aonly</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">a_list</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">]</span>

<span class="c">#-----------------------------</span>
<span class="n">aonly</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">a_list</span><span class="p">))</span>

<span class="c"># DON&#39;T DO THIS.</span>
<span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">aonly</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">a_list</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
        <span class="n">aonly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">seen</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>                    <span class="c"># mark as seen</span>
<span class="c">#-----------------------------</span>
<span class="n">mydict</span><span class="p">[</span><span class="s">&quot;key1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mydict</span><span class="p">[</span><span class="s">&quot;key2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c">#-----------------------------</span>
<span class="n">mydict</span><span class="p">[(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span> <span class="s">&quot;key2&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS:</span>
<span class="n">seen</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="c"># DON&#39;T DO THIS pre-2.3:</span>
<span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">B</span><span class="p">:</span>
    <span class="n">seen</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS:</span>
<span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">B</span><span class="p">:</span>
    <span class="n">seen</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_4.8</span>
<span class="c">#-----------------------------</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="n">a_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">b_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<span class="n">union</span> <span class="o">=</span> <span class="n">a_set</span> <span class="o">|</span> <span class="n">b_set</span>   <span class="c"># or a_set.union(b_set)</span>
<span class="n">isect</span> <span class="o">=</span> <span class="n">a_set</span> <span class="o">&amp;</span> <span class="n">b_set</span>   <span class="c"># or a_set.intersection(b_set) </span>
<span class="n">diff</span> <span class="o">=</span> <span class="n">a_set</span> <span class="o">^</span> <span class="n">b_set</span>    <span class="c"># or a_set.symmetric_difference(b_set)</span>


<span class="c"># DON&#39;T DO THIS:</span>
<span class="n">union_list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">isect_list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">diff</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">union_dict</span> <span class="o">=</span> <span class="p">{};</span> <span class="n">isect_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">count</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS:</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
    <span class="n">union_dict</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">union_dict</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
        <span class="n">isect_dict</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">union_dict</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">union_list</span> <span class="o">=</span> <span class="n">union_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">isect_list</span> <span class="o">=</span> <span class="n">isect_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS:</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">union</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">isect</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">union</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">union</span> <span class="o">=</span> <span class="n">union</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">isect</span> <span class="o">=</span> <span class="n">isect</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS:</span>
<span class="n">count</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">:</span>
    <span class="n">count</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">union</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">isect</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">diff</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">count</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">union</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">count</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">isect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">diff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS:</span>
<span class="n">isect</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">diff</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">union</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">count</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">:</span>
    <span class="n">count</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">count</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">union</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">isect</span><span class="p">][</span><span class="n">num</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_4.9</span>
<span class="c">#-----------------------------</span>
<span class="c"># &quot;append&quot; for a single term and</span>
<span class="c"># &quot;extend&quot; for many terms</span>
<span class="n">mylist1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">mylist2</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">mylist1</span> <span class="o">=</span> <span class="n">mylist1</span> <span class="o">+</span> <span class="n">mylist2</span>
<span class="n">mylist1</span> <span class="o">+=</span> <span class="n">mylist2</span>
<span class="c">#-----------------------------</span>
<span class="n">members</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Time&quot;</span><span class="p">,</span> <span class="s">&quot;Flies&quot;</span><span class="p">]</span>
<span class="n">initiates</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;An&quot;</span><span class="p">,</span> <span class="s">&quot;Arrow&quot;</span><span class="p">]</span>
<span class="n">members</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">initiates</span><span class="p">)</span>
<span class="c"># members is now [&quot;Time&quot;, &quot;Flies&quot;, &quot;An&quot;, &quot;Arrow&quot;]</span>
<span class="c">#-----------------------------</span>
<span class="n">members</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Like&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">initiates</span>
<span class="k">print</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
<span class="n">members</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Fruit&quot;</span><span class="p">]</span>           <span class="c"># or members[1] = &quot;Fruit&quot;</span>
<span class="n">members</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;A&quot;</span><span class="p">,</span> <span class="s">&quot;Banana&quot;</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c">#=&gt; Time Flies Like An Arrow</span>
<span class="c">#=&gt; Fruit Flies Like A Banana</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_4.10</span>
<span class="c">#-----------------------------</span>
<span class="c"># reverse mylist into revlist</span>

<span class="n">revlist</span> <span class="o">=</span> <span class="n">mylist</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c"># or</span>
<span class="n">revlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">mylist</span><span class="p">))</span>

<span class="c"># or pre-2.3</span>
<span class="n">revlist</span> <span class="o">=</span> <span class="n">mylist</span><span class="p">[:]</span>    <span class="c"># shallow copy</span>
<span class="n">revlist</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">mylist</span><span class="p">):</span>
    <span class="k">pass</span> <span class="c"># do something with elem</span>

<span class="c"># or</span>
<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
    <span class="k">pass</span> <span class="c"># do something with elem</span>

<span class="c"># if you need the index and the list won&#39;t take too much memory:</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">mylist</span><span class="p">))):</span>
    <span class="k">pass</span>

<span class="c"># If you absolutely must explicitly index:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="c">#-----------------------------</span>
<span class="n">descending</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_4.11</span>
<span class="c">#-----------------------------</span>
<span class="c"># remove n elements from the front of mylist</span>
<span class="n">mylist</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>       <span class="c"># or del mylist[:n]</span>

<span class="c"># remove n elements from front of mylist, saving them into front</span>
<span class="n">front</span><span class="p">,</span> <span class="n">mylist</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">mylist</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span> <span class="p">[]</span>

<span class="c"># remove 1 element from the front of mylist, saving it in front:</span>
<span class="n">front</span> <span class="o">=</span> <span class="n">mylist</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c"># remove n elements from the end of mylist</span>
<span class="n">mylist</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[]</span>      <span class="c"># or del mylist[-n:]</span>

<span class="c"># remove n elements from the end of mylist, saving them in end</span>
<span class="n">end</span><span class="p">,</span> <span class="n">mylist</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">:]</span> <span class="o">=</span> <span class="n">mylist</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">:],</span> <span class="p">[]</span>

<span class="c"># remove 1 element from the end of mylist, saving it in end:</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">mylist</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">shift2</span><span class="p">(</span><span class="n">terms</span><span class="p">):</span>
    <span class="n">front</span> <span class="o">=</span> <span class="n">terms</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">terms</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="n">front</span>

<span class="k">def</span> <span class="nf">pop2</span><span class="p">(</span><span class="n">terms</span><span class="p">):</span>
    <span class="n">back</span> <span class="o">=</span> <span class="n">terms</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
    <span class="n">terms</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="n">back</span>
<span class="c">#-----------------------------</span>
<span class="n">friends</span> <span class="o">=</span> <span class="s">&quot;Peter Paul Mary Jim Tim&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">this</span><span class="p">,</span> <span class="n">that</span> <span class="o">=</span> <span class="n">shift2</span><span class="p">(</span><span class="n">friends</span><span class="p">)</span>
<span class="c"># &#39;this&#39; contains Peter, &#39;that&#39; has Paul, and</span>
<span class="c"># &#39;friends&#39; has Mary, Jim, and Tim</span>

<span class="n">beverages</span> <span class="o">=</span> <span class="s">&quot;Dew Jolt Cola Sprite Fresca&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">pair</span> <span class="o">=</span> <span class="n">pop2</span><span class="p">(</span><span class="n">beverages</span><span class="p">)</span>
<span class="c"># pair[0] contains Sprite, pair[1] has Fresca,</span>
<span class="c"># and &#39;beverages&#39; has (Dew, Jolt, Cola)</span>

<span class="c"># In general you probably shouldn&#39;t do things that way because it&#39;s </span>
<span class="c"># not clear from these calls that the lists are modified.</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_4.12</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">criterion</span><span class="p">:</span>
        <span class="k">pass</span>    <span class="c"># do something with matched item</span>
        <span class="k">break</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">pass</span>     <span class="c"># unfound</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mylist</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">criterion</span><span class="p">:</span>
        <span class="k">pass</span>    <span class="c"># do something with elem found at mylist[idx]</span>
        <span class="k">break</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">pass</span> <span class="c">## unfound</span>
<span class="c">#-----------------------------</span>
<span class="c"># Assuming employees are sorted high-&gt;low by wage.</span>
<span class="k">for</span> <span class="n">employee</span> <span class="ow">in</span> <span class="n">employees</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">employee</span><span class="o">.</span><span class="n">category</span> <span class="o">==</span> <span class="s">&#39;engineer&#39;</span><span class="p">:</span>
        <span class="n">highest_engineer</span> <span class="o">=</span> <span class="n">employee</span>
        <span class="k">break</span>

<span class="k">print</span> <span class="s">&quot;Highest paid engineer is:&quot;</span><span class="p">,</span> <span class="n">highest_engineer</span><span class="o">.</span><span class="n">name</span>
<span class="c">#-----------------------------</span>
<span class="c"># If you need the index, use enumerate:</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">employee</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">employees</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">employee</span><span class="o">.</span><span class="n">category</span> <span class="o">==</span> <span class="s">&#39;engineer&#39;</span><span class="p">:</span>
        <span class="n">highest_engineer</span> <span class="o">=</span> <span class="n">employee</span>
        <span class="k">break</span>
<span class="k">print</span> <span class="s">&quot;Highest paid engineer is: #</span><span class="si">%s</span><span class="s"> - </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">highest_engineer</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>


<span class="c"># The following is rarely appropriate:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mylist</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">criterion</span><span class="p">:</span>
        <span class="k">pass</span>    <span class="c"># do something</span>
        <span class="k">break</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">pass</span> <span class="c">## not found</span>
<span class="c">#-----------------------------</span>


<span class="c"># @@PLEAC@@_4.13</span>
<span class="n">matching</span> <span class="o">=</span> <span class="p">[</span><span class="n">term</span> <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">mylist</span> <span class="k">if</span> <span class="n">test</span><span class="p">(</span><span class="n">term</span><span class="p">)]</span>
<span class="c">#-----------------------------</span>
<span class="n">matching</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">test</span><span class="p">(</span><span class="n">term</span><span class="p">):</span>
        <span class="n">matching</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">bigs</span> <span class="o">=</span> <span class="p">[</span><span class="n">num</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">nums</span> <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">1000000</span><span class="p">]</span>
<span class="n">pigs</span> <span class="o">=</span> <span class="p">[</span><span class="n">user</span> <span class="k">for</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">users</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mf">1e7</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">matching</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;who&quot;</span><span class="p">)</span> 
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;gnat &quot;</span><span class="p">)]</span>
<span class="c">#-----------------------------</span>
<span class="n">engineers</span> <span class="o">=</span> <span class="p">[</span><span class="n">employee</span> <span class="k">for</span> <span class="n">employee</span> <span class="ow">in</span> <span class="n">employees</span>
                 <span class="k">if</span> <span class="n">employee</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s">&quot;Engineer&quot;</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="n">secondary_assistance</span> <span class="o">=</span> <span class="p">[</span><span class="n">applicant</span> <span class="k">for</span> <span class="n">applicant</span> <span class="ow">in</span> <span class="n">applicants</span>
                            <span class="k">if</span> <span class="mi">26000</span> <span class="o">&lt;=</span> <span class="n">applicant</span><span class="o">.</span><span class="n">income</span> <span class="o">&lt;</span> <span class="mi">30000</span><span class="p">]</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_4.14</span>
<span class="n">sorted_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">unsorted_list</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># pids is an unsorted list of process IDs</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">signal</span><span class="o">,</span> <span class="nn">time</span>
<span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pids</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">pid</span>

<span class="n">pid</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;Select a process ID to kill: &quot;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">pid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s">&quot;Exiting ... &quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">)</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIGKILL</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">errno</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>  <span class="c"># was it already killed?</span>
        <span class="k">raise</span>
<span class="c">#-----------------------------</span>
<span class="n">descending</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">unsorted_list</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">allnums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">allnums</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>              <span class="c"># inplace</span>
<span class="c">#-----------------------------</span>
<span class="c"># pre 2.3</span>
<span class="n">allnums</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>                          <span class="c"># inplace</span>
<span class="n">allnums</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>                       <span class="c"># inplace</span>
<span class="c">#or</span>
<span class="n">allnums</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">allnums</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># reallocating</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_4.15</span>
<span class="n">ordered</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">unordered</span><span class="p">,</span> <span class="nb">cmp</span><span class="o">=</span><span class="n">compare</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">ordered</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">unordered</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">compute</span><span class="p">)</span>

<span class="c"># ...which is somewhat equivalent to: </span>
<span class="n">precomputed</span> <span class="o">=</span> <span class="p">[(</span><span class="n">compute</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">unordered</span><span class="p">]</span>
<span class="n">precomputed</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">ordered</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">precomputed</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS.</span>
<span class="k">def</span> <span class="nf">functional_sort</span><span class="p">(</span><span class="n">mylist</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
    <span class="n">mylist</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mylist</span>

<span class="n">ordered</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">functional_sort</span><span class="p">([(</span><span class="n">compute</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">unordered</span><span class="p">],</span>
                                        <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>
<span class="c">#-----------------------------</span>
<span class="n">ordered</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">employees</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">employee</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">employees</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> earns $</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">employee</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">employee</span><span class="o">.</span><span class="n">salary</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">sorted_employees</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">employees</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
<span class="k">for</span> <span class="n">employee</span> <span class="ow">in</span> <span class="n">sorted_employees</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> earns $</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">employee</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">employee</span><span class="o">.</span><span class="n">salary</span><span class="p">)</span>

<span class="c"># load bonus</span>
<span class="k">for</span> <span class="n">employee</span> <span class="ow">in</span> <span class="n">sorted_employees</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">bonus</span><span class="p">(</span><span class="n">employee</span><span class="o">.</span><span class="n">ssn</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">employee</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;got a bonus!&quot;</span>
<span class="c">#-----------------------------</span>
<span class="n">sorted_employees</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">employees</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">age</span><span class="p">)):</span>
<span class="c">#-----------------------------</span>
<span class="c"># NOTE: Python should allow access to the pwd fields by name</span>
<span class="c"># as well as by position.</span>
<span class="kn">import</span> <span class="nn">pwd</span>
<span class="c"># fetch all users</span>
<span class="n">users</span> <span class="o">=</span> <span class="n">pwd</span><span class="o">.</span><span class="n">getpwall</span><span class="p">()</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="k">print</span> <span class="n">user</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="n">sorted_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span>
<span class="c">#-----------------------------</span>
<span class="n">sorted_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS.</span>
<span class="n">temp</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">]</span>
<span class="n">temp</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">sorted_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS.</span>
<span class="k">def</span> <span class="nf">functional_sort</span><span class="p">(</span><span class="n">mylist</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
    <span class="n">mylist</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mylist</span>

<span class="n">sorted_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">functional_sort</span><span class="p">(</span>
              <span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;(\d+)&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">],</span>
                                   <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>
<span class="c">#-----------------------------</span>
<span class="n">entries</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;/etc/passwd&quot;</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
    <span class="k">print</span> <span class="n">entry</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_4.16</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="k">for</span> <span class="n">process</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]):</span>
    <span class="k">print</span> <span class="s">&quot;Handling process&quot;</span><span class="p">,</span> <span class="n">process</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># pre 2.3:</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">class</span> <span class="nc">Circular</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Cannot use an empty list&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">elem</span>

<span class="n">circular</span> <span class="o">=</span> <span class="n">Circular</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>

<span class="k">for</span> <span class="n">process</span> <span class="ow">in</span> <span class="n">circular</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Handling process&quot;</span><span class="p">,</span> <span class="n">process</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS. All those pops and appends mean that the list needs to be </span>
<span class="c"># constantly reallocated.  This is rather bad if your list is large:</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">class</span> <span class="nc">Circular</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Cannot use an empty list&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">head</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">head</span>

<span class="n">circular</span> <span class="o">=</span> <span class="n">Circular</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">process</span> <span class="o">=</span> <span class="n">circular</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&quot;Handling process&quot;</span><span class="p">,</span> <span class="n">process</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_4.17</span>
<span class="c">#-----------------------------</span>
<span class="c"># generate a random permutation of mylist in place</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_4.18</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">make_columns</span><span class="p">(</span><span class="n">mylist</span><span class="p">,</span> <span class="n">screen_width</span><span class="o">=</span><span class="mi">78</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">mylist</span><span class="p">:</span>
        <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">])</span>
        <span class="n">maxlen</span> <span class="o">+=</span> <span class="mi">1</span>   <span class="c"># to make extra space</span>

        <span class="n">cols</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">screen_width</span><span class="o">/</span><span class="n">maxlen</span><span class="p">)</span> 
        <span class="n">rows</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span><span class="o">/</span><span class="n">cols</span>

        <span class="c"># pre-create mask for faster computation</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%%</span><span class="s">-</span><span class="si">%d</span><span class="s">s &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">maxlen</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">mask</span><span class="o">%</span><span class="n">elem</span>
                       <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">[</span><span class="n">n</span><span class="p">::</span><span class="n">rows</span><span class="p">]]</span>
            <span class="k">yield</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">make_columns</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">readlines</span><span class="p">(),</span> <span class="n">screen_width</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">row</span>


<span class="c"># A more literal translation</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c"># subroutine to check whether at last item on line</span>
<span class="k">def</span> <span class="nf">EOL</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">item</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">cols</span> <span class="o">==</span> <span class="mi">0</span>

<span class="c"># Might not be portable to non-linux systems</span>
<span class="k">def</span> <span class="nf">getwinsize</span><span class="p">():</span>
    <span class="c"># Use the curses module if installed</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">curses</span>
        <span class="n">stdscr</span> <span class="o">=</span> <span class="n">curses</span><span class="o">.</span><span class="n">initscr</span><span class="p">()</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">stdscr</span><span class="o">.</span><span class="n">getmaxyx</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cols</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c"># Nope, so deal with ioctl directly.  What value for TIOCGWINSZ?</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">termios</span>
        <span class="n">TIOCGWINSZ</span> <span class="o">=</span> <span class="n">termios</span><span class="o">.</span><span class="n">TIOCGWINSZ</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">TIOCGWINSZ</span> <span class="o">=</span> <span class="mh">0x40087468</span>  <span class="c"># This is Linux specific</span>

    <span class="kn">import</span> <span class="nn">struct</span><span class="o">,</span> <span class="nn">fcntl</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&quot;HHHH&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">ioctl</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="n">TIOCGWINSZ</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">80</span>
    <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&quot;HHHH&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">cols</span>

<span class="n">cols</span> <span class="o">=</span> <span class="n">getwinsize</span><span class="p">()</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">maxlen</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>

<span class="n">maxlen</span> <span class="o">+=</span> <span class="mi">1</span>       <span class="c"># to make extra space</span>

<span class="c"># determine boundaries of screen</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">(</span><span class="n">cols</span> <span class="o">/</span> <span class="n">maxlen</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">1</span>
<span class="n">rows</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">+</span><span class="n">cols</span><span class="p">)</span> <span class="o">/</span> <span class="n">cols</span>

<span class="c"># pre-create mask for faster computation</span>
<span class="n">mask</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%%</span><span class="s">-</span><span class="si">%d</span><span class="s">s &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">maxlen</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># now process each item, picking out proper piece for this position</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span> <span class="o">*</span> <span class="n">cols</span><span class="p">):</span>
    <span class="n">target</span> <span class="o">=</span> <span class="p">(</span><span class="n">item</span> <span class="o">%</span> <span class="n">cols</span><span class="p">)</span> <span class="o">*</span> <span class="n">rows</span> <span class="o">+</span> <span class="p">(</span><span class="n">item</span><span class="o">/</span><span class="n">cols</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">target</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">piece</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">piece</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">%</span> <span class="s">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">EOL</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="n">piece</span> <span class="o">=</span> <span class="n">piece</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>  <span class="c"># don&#39;t blank-pad to EOL</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">piece</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">EOL</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">EOL</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_4.19</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">*=</span> <span class="n">n</span>
        <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">s</span>   
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">permute</span><span class="p">(</span><span class="n">alist</span><span class="p">,</span> <span class="n">blist</span><span class="o">=</span><span class="p">[]):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">alist</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">blist</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">alist</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">permute</span><span class="p">(</span><span class="n">alist</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">alist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:],</span> <span class="n">blist</span> <span class="o">+</span> <span class="p">[</span><span class="n">elem</span><span class="p">]):</span>
            <span class="k">yield</span> <span class="n">elem</span>

<span class="k">for</span> <span class="n">permutation</span> <span class="ow">in</span> <span class="n">permute</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)):</span>
    <span class="k">print</span> <span class="n">permutation</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS</span>
<span class="kn">import</span> <span class="nn">fileinput</span>

<span class="c"># Slightly modified from</span>
<span class="c">#   http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/66463</span>
<span class="k">def</span> <span class="nf">print_list</span><span class="p">(</span><span class="n">alist</span><span class="p">,</span> <span class="n">blist</span><span class="o">=</span><span class="p">[]):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">alist</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">blist</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">alist</span><span class="p">)):</span>
        <span class="n">blist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alist</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">print_list</span><span class="p">(</span><span class="n">alist</span><span class="p">,</span> <span class="n">blist</span><span class="p">)</span>
        <span class="n">alist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">blist</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">print_list</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">class</span> <span class="nc">FactorialMemo</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ret</span>

<span class="n">factorial</span> <span class="o">=</span> <span class="n">FactorialMemo</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="n">sys</span><span class="o">.</span><span class="n">setrecursionlimit</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>

<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">factorial</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
<span class="n">factorial</span><span class="p">(</span><span class="mi">2100</span><span class="p">)</span>                 <span class="c"># First 2000 values are cached already</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">f1</span> <span class="o">-</span> <span class="n">start</span>
<span class="k">print</span> <span class="s">&quot;Slow first time:&quot;</span><span class="p">,</span> <span class="n">f1</span>
<span class="k">print</span> <span class="s">&quot;Quicker the second time:&quot;</span><span class="p">,</span> <span class="n">f2</span>
<span class="c">#-----------------------------</span>

<span class="k">class</span> <span class="nc">MemoizedPermutations</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alist</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="n">alist</span><span class="p">,</span> <span class="p">[])</span>
        
    <span class="k">def</span> <span class="nf">permute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alist</span><span class="p">,</span> <span class="n">blist</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">alist</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">blist</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">alist</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="n">alist</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">alist</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:],</span> <span class="n">blist</span> <span class="o">+</span> <span class="p">[</span><span class="n">elem</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">seq</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span>


<span class="n">p5</span> <span class="o">=</span> <span class="n">MemoizedPermutations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

<span class="n">words</span> <span class="o">=</span> <span class="s">&quot;This sentence has five words&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="k">print</span> <span class="n">p5</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>
<span class="k">print</span> <span class="n">p5</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="mi">81</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_5.0</span>
<span class="c">#-----------------------------</span>
<span class="c"># dictionaries</span>
<span class="n">age</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Nat&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
       <span class="s">&quot;Jules&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
       <span class="s">&quot;Josh&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">}</span>
<span class="c">#-----------------------------</span>
<span class="n">age</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">age</span><span class="p">[</span><span class="s">&quot;Nat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">age</span><span class="p">[</span><span class="s">&quot;Jules&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">age</span><span class="p">[</span><span class="s">&quot;Josh&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">17</span>
<span class="c">#-----------------------------</span>
<span class="n">food_color</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Apple&quot;</span><span class="p">:</span>  <span class="s">&quot;red&quot;</span><span class="p">,</span>
              <span class="s">&quot;Banana&quot;</span><span class="p">:</span> <span class="s">&quot;yellow&quot;</span><span class="p">,</span>
              <span class="s">&quot;Lemon&quot;</span><span class="p">:</span>  <span class="s">&quot;yellow&quot;</span><span class="p">,</span>
              <span class="s">&quot;Carrot&quot;</span><span class="p">:</span> <span class="s">&quot;orange&quot;</span>
             <span class="p">}</span>
<span class="c">#-----------------------------</span>
<span class="c"># NOTE: keys must be quoted in Python</span>


<span class="c"># @@PLEAC@@_5.1</span>
<span class="n">mydict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="c">#-----------------------------</span>
<span class="c"># food_color defined per the introduction</span>
<span class="n">food_color</span><span class="p">[</span><span class="s">&quot;Raspberry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;pink&quot;</span>
<span class="k">print</span> <span class="s">&quot;Known foods:&quot;</span>
<span class="k">for</span> <span class="n">food</span> <span class="ow">in</span> <span class="n">food_color</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">food</span>

<span class="c">#=&gt; Known foods:</span>
<span class="c">#=&gt; Raspberry</span>
<span class="c">#=&gt; Carrot</span>
<span class="c">#=&gt; Lemon</span>
<span class="c">#=&gt; Apple</span>
<span class="c">#=&gt; Banana</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_5.2</span>
<span class="c"># does mydict have a value for key?</span>
<span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mydict</span><span class="p">:</span>
    <span class="k">pass</span> <span class="c"># it exists</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">pass</span> <span class="c"># it doesn&#39;t</span>

<span class="c">#-----------------------------</span>
<span class="c"># food_color per the introduction</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;Banana&quot;</span><span class="p">,</span> <span class="s">&quot;Martini&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">food_color</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">name</span><span class="p">,</span> <span class="s">&quot;is a food.&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">name</span><span class="p">,</span> <span class="s">&quot;is a drink.&quot;</span>

<span class="c">#=&gt; Banana is a food.</span>
<span class="c">#=&gt; Martini is a drink.</span>
<span class="c">#-----------------------------</span>
<span class="n">age</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">age</span><span class="p">[</span><span class="s">&quot;Toddler&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">age</span><span class="p">[</span><span class="s">&quot;Unborn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">age</span><span class="p">[</span><span class="s">&quot;Phantasm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;Toddler&quot;</span><span class="p">,</span> <span class="s">&quot;Unborn&quot;</span><span class="p">,</span> <span class="s">&quot;Phantasm&quot;</span><span class="p">,</span> <span class="s">&quot;Relic&quot;</span><span class="p">):</span>
    <span class="k">print</span> <span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">:&quot;</span><span class="o">%</span><span class="n">thing</span><span class="p">),</span>
    <span class="k">if</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">age</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Exists&quot;</span><span class="p">,</span>
        <span class="k">if</span> <span class="n">age</span><span class="p">[</span><span class="n">thing</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Defined&quot;</span><span class="p">,</span>
        <span class="k">if</span> <span class="n">age</span><span class="p">[</span><span class="n">thing</span><span class="p">]:</span>
            <span class="k">print</span> <span class="s">&quot;True&quot;</span><span class="p">,</span>
    <span class="k">print</span>
<span class="c">#=&gt; Toddler: Exists Defined True</span>
<span class="c">#=&gt; Unborn: Exists Defined</span>
<span class="c">#=&gt; Phantasm: Exists</span>
<span class="c">#=&gt; Relic:</span>
<span class="c">#-----------------------------</span>
<span class="c"># Get file sizes for the requested filenames</span>
<span class="kn">import</span> <span class="nn">fileinput</span><span class="o">,</span> <span class="nn">os</span>
<span class="n">size</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">size</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">size</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>


<span class="c"># @@PLEAC@@_5.3</span>
<span class="c"># remove key and its value from mydict</span>
<span class="k">del</span> <span class="n">mydict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="c"># food_color as per Introduction</span>
<span class="k">def</span> <span class="nf">print_foods</span><span class="p">():</span>
    <span class="n">foods</span> <span class="o">=</span> <span class="n">food_color</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">print</span> <span class="s">&quot;Keys:&quot;</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">foods</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;Values:&quot;</span><span class="p">,</span>

    <span class="k">for</span> <span class="n">food</span> <span class="ow">in</span> <span class="n">foods</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">food_color</span><span class="p">[</span><span class="n">food</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">color</span><span class="p">,</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;(undef)&quot;</span><span class="p">,</span>
    <span class="k">print</span>

<span class="k">print</span> <span class="s">&quot;Initially:&quot;</span>
<span class="n">print_foods</span><span class="p">()</span>

<span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">With Banana set to None&quot;</span>
<span class="n">food_color</span><span class="p">[</span><span class="s">&quot;Banana&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">print_foods</span><span class="p">()</span>

<span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">With Banana deleted&quot;</span>
<span class="k">del</span> <span class="n">food_color</span><span class="p">[</span><span class="s">&quot;Banana&quot;</span><span class="p">]</span>
<span class="n">print_foods</span><span class="p">()</span>

<span class="c">#=&gt; Initially:</span>
<span class="c">#=&gt; Keys: Carrot Lemon Apple Banana</span>
<span class="c">#=&gt; Values: orange yellow red yellow</span>
<span class="c">#=&gt; </span>
<span class="c">#=&gt; With Banana set to None</span>
<span class="c">#=&gt; Keys: Carrot Lemon Apple Banana</span>
<span class="c">#=&gt; Values: orange yellow red (undef)</span>
<span class="c">#=&gt; </span>
<span class="c">#=&gt; With Banana deleted</span>
<span class="c">#=&gt; Keys: Carrot Lemon Apple</span>
<span class="c">#=&gt; Values: orange yellow red</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;Banana&quot;</span><span class="p">,</span> <span class="s">&quot;Apple&quot;</span><span class="p">,</span> <span class="s">&quot;Cabbage&quot;</span><span class="p">]:</span>
    <span class="k">del</span> <span class="n">food_color</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="c">#-----------------------------</span>


<span class="c"># @@PLEAC@@_5.4</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mydict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>  
    <span class="k">pass</span> <span class="c"># do something with key and value</span>

<span class="c"># If mydict is large, use iteritems() instead</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mydict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>  
    <span class="k">pass</span> <span class="c"># do something with key and value</span>

<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS:</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">mydict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">mydict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="c"># do something with key and value</span>
<span class="c">#-----------------------------</span>
<span class="c"># food_color per the introduction</span>
<span class="k">for</span> <span class="n">food</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">food_color</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> is </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">food</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS:</span>
<span class="k">for</span> <span class="n">food</span> <span class="ow">in</span> <span class="n">food_color</span><span class="p">:</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">food_color</span><span class="p">[</span><span class="n">food</span><span class="p">]</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> is </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">food</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="k">print</span> <span class="s">&quot;&quot;&quot;</span><span class="si">%(food)s</span><span class="s"></span>

<span class="s">is</span>

<span class="si">%(color)s</span><span class="s">.</span>
<span class="s">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="nb">vars</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">food</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">food_color</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> is </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">food</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># countfrom - count number of messages from each sender</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">infile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">infile</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>

<span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;From: &quot;</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">counts</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>

<span class="c">#-----------------------------</span>


<span class="c"># @@PLEAC@@_5.5</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">mydict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">key</span><span class="p">,</span> <span class="s">&quot;=&gt;&quot;</span><span class="p">,</span> <span class="n">val</span>
<span class="c">#-----------------------------</span>
<span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> =&gt; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">mydict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<span class="c">#-----------------------------</span>
<span class="k">print</span> <span class="n">mydict</span>
<span class="c">#=&gt; {&#39;firstname&#39;: &#39;Andrew&#39;, &#39;login&#39;: &#39;dalke&#39;, &#39;state&#39;: &#39;New Mexico&#39;, &#39;lastname&#39;: &#39;Dalke&#39;}</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
<span class="c">#=&gt; {&#39;firstname&#39;: &#39;Andrew&#39;,</span>
<span class="c">#=&gt;  &#39;lastname&#39;: &#39;Dalke&#39;,</span>
<span class="c">#=&gt;  &#39;login&#39;: &#39;dalke&#39;,</span>
<span class="c">#=&gt;  &#39;state&#39;: &#39;New Mexico&#39;}</span>
<span class="c">#-----------------------------</span>


<span class="c"># @@PLEAC@@_5.6</span>
<span class="c">#-----------------------------</span>
<span class="k">class</span> <span class="nc">SequenceDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dictionary that remembers the insertion order.</span>
<span class="sd">    The lists returned by keys(), values() and items() are</span>
<span class="sd">    in the insertion order.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="o">=</span><span class="p">{}</span> <span class="c"># key --&gt; id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ids</span><span class="o">=</span><span class="p">{}</span>      <span class="c"># id  --&gt; key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_id</span><span class="o">=</span><span class="mi">0</span>
        
    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_next_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ids</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_next_id</span><span class="p">]</span><span class="o">=</span><span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_id</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">del</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">del</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ids</span><span class="p">[</span><span class="nb">id</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="n">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">values</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">ids</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ids</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">ids</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">items</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">ids</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ids</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">ids</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">items</span>

    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ids</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ids</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">ids</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">keys</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
            <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">keys</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">dict</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ids</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_id</span><span class="o">=</span><span class="mi">0</span>
        
<span class="k">def</span> <span class="nf">testSequenceDict</span><span class="p">():</span>
    <span class="n">sd</span><span class="o">=</span><span class="n">SequenceDict</span><span class="p">()</span>

    <span class="c"># First Test</span>
    <span class="n">sd</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;first&quot;</span>
    <span class="n">sd</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;second&quot;</span>
    <span class="n">sd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;third&quot;</span>
    <span class="k">print</span> <span class="n">sd</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">sd</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">sd</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

    <span class="k">del</span><span class="p">(</span><span class="n">sd</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">del</span><span class="p">(</span><span class="n">sd</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">del</span><span class="p">(</span><span class="n">sd</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="k">print</span> <span class="n">sd</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">sd</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">sd</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">sd</span><span class="o">.</span><span class="n">_ids</span><span class="p">,</span> <span class="n">sd</span><span class="o">.</span><span class="n">_keys</span>

    <span class="k">print</span> <span class="s">&quot;---------------&quot;</span>
    <span class="c"># Second Test</span>
    <span class="n">sd</span><span class="p">[</span><span class="s">&quot;b&quot;</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;first&quot;</span>
    <span class="n">sd</span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;second&quot;</span>
    <span class="n">sd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&quot;c&quot;</span><span class="p">:</span> <span class="s">&quot;third&quot;</span><span class="p">})</span>
    <span class="k">print</span> <span class="n">sd</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">sd</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">sd</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

    <span class="k">del</span><span class="p">(</span><span class="n">sd</span><span class="p">[</span><span class="s">&quot;b&quot;</span><span class="p">])</span>
    <span class="k">del</span><span class="p">(</span><span class="n">sd</span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">])</span>
    <span class="k">del</span><span class="p">(</span><span class="n">sd</span><span class="p">[</span><span class="s">&quot;c&quot;</span><span class="p">])</span>

    <span class="k">print</span> <span class="n">sd</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">sd</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">sd</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">sd</span><span class="o">.</span><span class="n">_ids</span><span class="p">,</span> <span class="n">sd</span><span class="o">.</span><span class="n">_keys</span>

<span class="k">def</span> <span class="nf">likePerlCookbook</span><span class="p">():</span>
    <span class="n">food_color</span><span class="o">=</span><span class="n">SequenceDict</span><span class="p">()</span>
    <span class="n">food_color</span><span class="p">[</span><span class="s">&quot;Banana&quot;</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;Yellow&quot;</span><span class="p">;</span>
    <span class="n">food_color</span><span class="p">[</span><span class="s">&quot;Apple&quot;</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;Green&quot;</span><span class="p">;</span>
    <span class="n">food_color</span><span class="p">[</span><span class="s">&quot;Lemon&quot;</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;Yellow&quot;</span>
    <span class="k">print</span> <span class="s">&quot;In insertion order, the foods&#39; color are:&quot;</span>
    <span class="k">for</span> <span class="n">food</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">food_color</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> is colored </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">food</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c">#testSequenceDict()</span>
    <span class="n">likePerlCookbook</span><span class="p">()</span>
    

<span class="c"># @@PLEAC@@_5.7</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">ttys</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">who</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;who&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">who</span><span class="p">:</span>
    <span class="n">user</span><span class="p">,</span> <span class="n">tty</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">ttys</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tty</span><span class="p">)</span>

<span class="k">for</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">tty_list</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ttys</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="k">print</span> <span class="n">user</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tty_list</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">pwd</span>
<span class="k">for</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">tty_list</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ttys</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">user</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tty_list</span><span class="p">),</span> <span class="s">&quot;ttys.&quot;</span>
    <span class="k">for</span> <span class="n">tty</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tty_list</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">uid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="s">&quot;/dev/&quot;</span> <span class="o">+</span> <span class="n">tty</span><span class="p">)</span><span class="o">.</span><span class="n">st_uid</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">pwd</span><span class="o">.</span><span class="n">getpwuid</span><span class="p">(</span><span class="n">uid</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">os</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="n">user</span> <span class="o">=</span> <span class="s">&quot;(not available)&quot;</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\t</span><span class="si">%s</span><span class="s"> (owned by </span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tty</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>

<span class="c"># @@PLEAC@@_5.8</span>
<span class="c"># lookup_dict maps keys to values</span>
<span class="n">reverse</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">val</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">lookup_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<span class="c">#-----------------------------</span>
<span class="n">surname</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Mickey&quot;</span><span class="p">:</span> <span class="s">&quot;Mantle&quot;</span><span class="p">,</span> <span class="s">&quot;Babe&quot;</span><span class="p">:</span> <span class="s">&quot;Ruth&quot;</span><span class="p">}</span>
<span class="n">first_name</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">last</span><span class="p">,</span> <span class="n">first</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span> <span class="ow">in</span> <span class="n">surname</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

<span class="k">print</span> <span class="n">first_name</span><span class="p">[</span><span class="s">&quot;Mantle&quot;</span><span class="p">]</span>
<span class="c">#=&gt; Mickey</span>
<span class="c">#-----------------------------</span>
<span class="c">#!/usr/bin/perl -w</span>
<span class="c"># foodfind - find match for food or color</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s">&quot;usage: foodfind food_or_color&quot;</span><span class="p">)</span>
<span class="n">given</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">color_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Apple&quot;</span><span class="p">:</span>  <span class="s">&quot;red&quot;</span><span class="p">,</span>
              <span class="s">&quot;Banana&quot;</span><span class="p">:</span> <span class="s">&quot;yellow&quot;</span><span class="p">,</span>
              <span class="s">&quot;Lemon&quot;</span><span class="p">:</span>  <span class="s">&quot;yellow&quot;</span><span class="p">,</span>
              <span class="s">&quot;Carrot&quot;</span><span class="p">:</span> <span class="s">&quot;orange&quot;</span><span class="p">,</span>
             <span class="p">}</span>
<span class="n">food_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">color</span><span class="p">,</span> <span class="n">food</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">food</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="ow">in</span> <span class="n">color_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

<span class="k">if</span> <span class="n">given</span> <span class="ow">in</span> <span class="n">color_dict</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">given</span><span class="p">,</span> <span class="s">&quot;is a food with color&quot;</span><span class="p">,</span> <span class="n">color_dict</span><span class="p">[</span><span class="n">given</span><span class="p">]</span>
<span class="k">elif</span> <span class="n">given</span> <span class="ow">in</span> <span class="n">food_dict</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">food_dict</span><span class="p">[</span><span class="n">given</span><span class="p">],</span> <span class="s">&quot;is a food with color&quot;</span><span class="p">,</span> <span class="n">given</span>
<span class="c">#-----------------------------</span>
<span class="c"># food_color as per the introduction</span>
<span class="n">foods_with_color</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">food</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">food_color</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">foods_with_color</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">food</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">foods_with_color</span><span class="p">[</span><span class="s">&quot;yellow&quot;</span><span class="p">]),</span> <span class="s">&quot;were yellow foods.&quot;</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_5.9</span>
<span class="c">#-----------------------------</span>
<span class="c"># mydict is the hash to sort</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mydict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="c"># do something with key, value</span>
<span class="c">#-----------------------------</span>
<span class="c"># food_color as per section 5.8</span>
<span class="k">for</span> <span class="n">food</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">food_color</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> is </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">food</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># NOTE: alternative version</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">food_color</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> is </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">item</span>
<span class="c">#-----------------------------</span>
<span class="c"># NOTE: alternative version showing a user-defined function</span>
<span class="k">def</span> <span class="nf">food_cmp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="k">for</span> <span class="n">food</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">food_color</span><span class="p">,</span> <span class="nb">cmp</span><span class="o">=</span><span class="n">food_cmp</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> is </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">food</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">food_len_cmp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

<span class="k">for</span> <span class="n">food</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">food_color</span><span class="p">,</span> <span class="nb">cmp</span><span class="o">=</span><span class="n">food_len_cmp</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> is </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">food</span><span class="p">,</span> <span class="n">food_color</span><span class="p">[</span><span class="n">food</span><span class="p">])</span>

<span class="c"># In this instance, however, the following is both simpler and faster:</span>
<span class="k">for</span> <span class="n">food</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">food_color</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> is </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">food</span><span class="p">,</span> <span class="n">food_color</span><span class="p">[</span><span class="n">food</span><span class="p">])</span>
<span class="c">#-----------------------------</span>


<span class="c"># @@PLEAC@@_5.10</span>
<span class="c">#-----------------------------</span>
<span class="n">merged</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">merged</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a_dict</span><span class="p">)</span>
<span class="n">merged</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">b_dict</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="c"># NOTE: alternative version</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">a_dict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">merged</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">b_dict</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS:</span>

<span class="n">merged</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">a_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">merged</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">b_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">merged</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<span class="c">#-----------------------------</span>
<span class="c"># food_color as per section 5.8</span>
<span class="n">drink_color</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Galliano&quot;</span><span class="p">:</span> <span class="s">&quot;yellow&quot;</span><span class="p">,</span>
               <span class="s">&quot;Mai Tai&quot;</span><span class="p">:</span> <span class="s">&quot;blue&quot;</span><span class="p">}</span>

<span class="n">ingested_color</span> <span class="o">=</span> <span class="n">drink_color</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ingested_color</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">food_color</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS:</span>
<span class="n">drink_color</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Galliano&quot;</span><span class="p">:</span> <span class="s">&quot;yellow&quot;</span><span class="p">,</span>
               <span class="s">&quot;Mai Tai&quot;</span><span class="p">:</span> <span class="s">&quot;blue&quot;</span><span class="p">}</span>

<span class="n">substance_color</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">food_color</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">substance_color</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">drink_color</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">substance_color</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS:</span>
<span class="n">substance_color</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">mydict</span> <span class="ow">in</span> <span class="p">(</span><span class="n">food_color</span><span class="p">,</span> <span class="n">drink_color</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mydict</span><span class="p">:</span>
        <span class="n">substance_color</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS:</span>
<span class="n">substance_color</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">food_color</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">drink_color</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mydict</span><span class="p">:</span>
        <span class="n">substance_color</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<span class="c">#-----------------------------</span>
<span class="n">substance_color</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">mydict</span> <span class="ow">in</span> <span class="p">(</span><span class="n">food_color</span><span class="p">,</span> <span class="n">drink_color</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mydict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">substance_color</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;Warning:&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="s">&quot;seen twice.  Using the first definition.&quot;</span>
            <span class="k">continue</span>
        <span class="n">substance_color</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

<span class="c"># I think it&#39;s a copy, in which case</span>
<span class="n">all_colors</span> <span class="o">=</span> <span class="n">new_colors</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>


<span class="c"># @@PLEAC@@_5.11</span>
<span class="n">common</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dict1</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dict2</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="n">this_not_that</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dict1</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dict2</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="c"># citrus_color is a dict mapping citrus food name to its color.</span>
<span class="n">citrus_color</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Lemon&quot;</span><span class="p">:</span>  <span class="s">&quot;yellow&quot;</span><span class="p">,</span>
                <span class="s">&quot;Orange&quot;</span><span class="p">:</span> <span class="s">&quot;orange&quot;</span><span class="p">,</span>
                <span class="s">&quot;Lime&quot;</span><span class="p">:</span>   <span class="s">&quot;green&quot;</span><span class="p">}</span>

<span class="c"># build up a list of non-citrus foods</span>
<span class="n">non_citrus</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">food_color</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">citruscolor</span><span class="p">]</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_5.12</span>
<span class="c">#-----------------------------</span>
<span class="c"># references as keys of dictionaries is no pb in python</span>

<span class="n">name</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;/etc/termcap&quot;</span><span class="p">,</span> <span class="s">&quot;/vmunix&quot;</span><span class="p">,</span> <span class="s">&quot;/bin/cat&quot;</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">names</span><span class="p">[</span><span class="n">myfile</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>

<span class="k">print</span> <span class="s">&quot;open files:&quot;</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">name</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>       <span class="c"># seek to the end</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> is </span><span class="si">%d</span><span class="s"> bytes long.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">())</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_5.13</span>
<span class="c"># Python doesn&#39;t allow presizing of dicts, but hashing is efficient -</span>
<span class="c"># it only re-sizes at intervals, not every time an item is added.</span>

<span class="c"># @@PLEAC@@_5.14</span>
<span class="n">count</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
    <span class="n">count</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c"># @@PLEAC@@_5.15</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">fileinput</span>

<span class="n">father</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Cain&#39;</span><span class="p">:</span> <span class="s">&#39;Adam&#39;</span><span class="p">,</span>
          <span class="s">&#39;Abel&#39;</span><span class="p">:</span> <span class="s">&#39;Adam&#39;</span><span class="p">,</span>
          <span class="s">&#39;Seth&#39;</span><span class="p">:</span> <span class="s">&#39;Adam&#39;</span><span class="p">,</span>
          <span class="s">&#39;Enoch&#39;</span><span class="p">:</span> <span class="s">&#39;Cain&#39;</span><span class="p">,</span>
          <span class="s">&#39;Irad&#39;</span><span class="p">:</span> <span class="s">&#39;Enoch&#39;</span><span class="p">,</span>
          <span class="s">&#39;Mehujael&#39;</span><span class="p">:</span> <span class="s">&#39;Irad&#39;</span><span class="p">,</span>
          <span class="s">&#39;Methusael&#39;</span><span class="p">:</span> <span class="s">&#39;Mehujael&#39;</span><span class="p">,</span>
          <span class="s">&#39;Lamech&#39;</span><span class="p">:</span> <span class="s">&#39;Methusael&#39;</span><span class="p">,</span>
          <span class="s">&#39;Jabal&#39;</span><span class="p">:</span> <span class="s">&#39;Lamech&#39;</span><span class="p">,</span>
          <span class="s">&#39;Tubalcain&#39;</span><span class="p">:</span> <span class="s">&#39;Lamech&#39;</span><span class="p">,</span>
          <span class="s">&#39;Enos&#39;</span><span class="p">:</span> <span class="s">&#39;Seth&#39;</span><span class="p">,</span>
         <span class="p">}</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="k">while</span> <span class="n">person</span><span class="p">:</span>                    <span class="c"># as long as we have people,</span>
        <span class="k">print</span> <span class="n">person</span><span class="p">,</span>                <span class="c"># print the current name</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">father</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>  <span class="c"># set the person to the person&#39;s father</span>
    <span class="k">print</span>

<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">fileinput</span>

<span class="n">children</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">father</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">children</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="n">kids</span> <span class="o">=</span> <span class="n">children</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">person</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;nobody&quot;</span><span class="p">])</span>
    <span class="k">print</span> <span class="n">person</span><span class="p">,</span> <span class="s">&quot;begat&quot;</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kids</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">re</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;^\s*#\s*include\s*&lt;([^&gt;]+)&#39;</span><span class="p">)</span>
<span class="n">includes</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">infile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">print</span><span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">err</span>
        <span class="k">continue</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">includes</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># list of files that don&#39;t include others</span>
<span class="n">mydict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">includes</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">includes</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
        <span class="n">mydict</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">include_free</span> <span class="o">=</span> <span class="n">mydict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">include_free</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

<span class="c"># @@PLEAC@@_5.16</span>
<span class="c">#-----------------------------</span>
<span class="c">#!/usr/bin/env python -w</span>
<span class="c"># dutree - print sorted indented rendition of du output</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">get_input</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="c"># NOTE: This is insecure - use only from trusted code!</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s">&quot;du &quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">infile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

    <span class="n">dirsize</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">kids</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
        <span class="n">size</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">dirsize</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">kids</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="c"># Remove the last field added, which is the root</span>
    <span class="n">kids</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">kids</span><span class="p">[</span><span class="n">parent</span><span class="p">]:</span> 
        <span class="k">del</span> <span class="n">kids</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">dirsize</span><span class="p">,</span> <span class="n">kids</span>

<span class="k">def</span> <span class="nf">getdots</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">dirsize</span><span class="p">,</span> <span class="n">kids</span><span class="p">):</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">cursize</span> <span class="o">=</span> <span class="n">dirsize</span><span class="p">[</span><span class="n">root</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">kids</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">kid</span> <span class="ow">in</span> <span class="n">kids</span><span class="p">[</span><span class="n">root</span><span class="p">]:</span>
            <span class="n">cursize</span> <span class="o">-=</span> <span class="n">dirsize</span><span class="p">[</span><span class="n">kid</span><span class="p">]</span>
            <span class="n">getdots</span><span class="p">(</span><span class="n">kid</span><span class="p">,</span> <span class="n">dirsize</span><span class="p">,</span> <span class="n">kids</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">size</span> <span class="o">!=</span> <span class="n">cursize</span><span class="p">:</span>
        <span class="n">dot</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="s">&quot;/.&quot;</span>
        <span class="n">dirsize</span><span class="p">[</span><span class="n">dot</span><span class="p">]</span> <span class="o">=</span> <span class="n">cursize</span>
        <span class="n">kids</span><span class="p">[</span><span class="n">root</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dot</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">dirsize</span><span class="p">,</span> <span class="n">kids</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">dirsize</span><span class="p">[</span><span class="n">root</span><span class="p">]</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s">&quot;%&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;d </span><span class="si">%s</span><span class="s">&quot;</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">line</span>

    <span class="n">prefix</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;| &quot;</span>  <span class="o">+</span> <span class="p">(</span><span class="s">&quot; &quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">kids</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
        <span class="n">kid_list</span> <span class="o">=</span> <span class="n">kids</span><span class="p">[</span><span class="n">root</span><span class="p">]</span>
        <span class="n">kid_list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dirsize</span><span class="o">=</span><span class="n">dirsize</span><span class="p">:</span>
                          <span class="nb">cmp</span><span class="p">(</span><span class="n">dirsize</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">dirsize</span><span class="p">[</span><span class="n">y</span><span class="p">]))</span>
        <span class="n">width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dirsize</span><span class="p">[</span><span class="n">kid_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]))</span>
        <span class="k">for</span> <span class="n">kid</span> <span class="ow">in</span> <span class="n">kid_list</span><span class="p">:</span>
            <span class="n">output</span><span class="p">(</span><span class="n">kid</span><span class="p">,</span> <span class="n">dirsize</span><span class="p">,</span> <span class="n">kids</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">root</span><span class="p">,</span> <span class="n">dirsize</span><span class="p">,</span> <span class="n">kids</span> <span class="o">=</span> <span class="n">get_input</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">getdots</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">dirsize</span><span class="p">,</span> <span class="n">kids</span><span class="p">)</span>
    <span class="n">output</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">dirsize</span><span class="p">,</span> <span class="n">kids</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>


<span class="c"># @@PLEAC@@_6.0</span>
<span class="c"># Note: regexes are used less often in Python than in Perl as tasks are often</span>
<span class="c"># covered by string methods, or specialised objects, modules, or packages.</span>

<span class="kn">import</span> <span class="nn">re</span>                   <span class="c"># &quot;re&quot; is the regular expression module.</span>
<span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;sheep&quot;</span><span class="p">,</span><span class="n">meadow</span><span class="p">)</span>   <span class="c"># returns a MatchObject is meadow contains &quot;sheep&quot;.</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;sheep&quot;</span><span class="p">,</span><span class="n">meadow</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;no sheep on this meadow only a fat python.&quot;</span>
<span class="c"># replacing strings is not done by &quot;re&quot;gular expressions.</span>
<span class="n">meadow</span> <span class="o">=</span> <span class="n">meadow</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;old&quot;</span><span class="p">,</span><span class="s">&quot;new&quot;</span><span class="p">)</span>   <span class="c"># replace &quot;old&quot; with &quot;new&quot; and assign result.</span>
<span class="c">#-----------------------------</span>
<span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;ovine&quot;</span><span class="p">,</span><span class="n">meadow</span><span class="p">)</span>

<span class="n">meadow</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Fine bovines demand fine toreadors.</span>
<span class="s">Muskoxen are polar ovibovine species.</span>
<span class="s">Grooviness went out of fashion decades ago.&quot;&quot;&quot;</span>

<span class="n">meadow</span> <span class="o">=</span> <span class="s">&quot;Ovines are found typically in ovaries.&quot;</span>

<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;\bovines\b&quot;</span><span class="p">,</span><span class="n">meadow</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="p">:</span> <span class="k">print</span> <span class="s">&quot;Here be sheep!&quot;</span>
<span class="c">#-----------------------------</span>
<span class="c"># The tricky bit</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&quot;good food&quot;</span>
<span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;o*&quot;</span><span class="p">,</span><span class="s">&quot;e&quot;</span><span class="p">,</span><span class="n">mystr</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c"># gives &#39;egood food&#39;</span>

<span class="n">echo</span> <span class="n">ababacaca</span> <span class="o">|</span> <span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s">&quot;import sys,re; print re.search(&#39;(a|ba|b)+(a|ac)+&#39;,sys.stdin.read()).group()&quot;</span>
<span class="c">#-----------------------------</span>
<span class="c"># pattern matching modifiers</span>
<span class="c"># assume perl code iterates over some file</span>
<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">fileinput</span>
<span class="k">for</span> <span class="n">ln</span> <span class="o">=</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="n">fnd</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;(\d+)&quot;</span><span class="p">,</span><span class="n">ln</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fnd</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Found number </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fnd</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c"># ----------------------------</span>
<span class="n">digits</span> <span class="o">=</span> <span class="s">&quot;123456789&quot;</span>
<span class="n">nonlap</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;(\d\d\d)&quot;</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span>
<span class="n">yeslap</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;not yet&quot;</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&quot;Non-overlapping:&quot;</span><span class="p">,</span><span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nonlap</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Overlapping    :&quot;</span><span class="p">,</span><span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">yeslap</span><span class="p">)</span>
<span class="c"># ----------------------------</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&quot;And little lambs eat ivy&quot;</span>
<span class="n">fnd</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;(l[^s]*s)&quot;</span><span class="p">,</span> <span class="n">mystr</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;(</span><span class="si">%s</span><span class="s">) (</span><span class="si">%s</span><span class="s">) (</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mystr</span><span class="p">[:</span><span class="n">fnd</span><span class="o">.</span><span class="n">start</span><span class="p">()],</span> <span class="n">fnd</span><span class="o">.</span><span class="n">group</span><span class="p">(),</span> <span class="n">mystr</span><span class="p">[</span><span class="n">fnd</span><span class="o">.</span><span class="n">end</span><span class="p">():])</span>
<span class="c"># (And ) (little lambs) ( eat ivy)</span>


<span class="c"># @@PLEAC@@_6.1</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">dst</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;this&quot;</span><span class="p">,</span><span class="s">&quot;that&quot;</span><span class="p">,</span><span class="n">src</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># strip to basename</span>
<span class="n">basename</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;.*/(?=[^/]+)&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">progname</span><span class="p">)</span>

<span class="c"># Make All Words Title-Cased</span>
<span class="c"># DON&#39;T DO THIS - use str.title() instead</span>
<span class="k">def</span> <span class="nf">cap</span><span class="p">(</span><span class="n">mo</span><span class="p">):</span> <span class="k">return</span> <span class="n">mo</span><span class="o">.</span><span class="n">group</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
<span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;(?P&lt;n&gt;\w+)&quot;</span><span class="p">,</span><span class="n">cap</span><span class="p">,</span><span class="s">&quot;make all words title-cased&quot;</span><span class="p">)</span>

<span class="c"># /usr/man/man3/foo.1 changes to /usr/man/cat3/foo.1</span>
<span class="n">manpage</span> <span class="o">=</span> <span class="s">&quot;/usr/man/man3/foo.1&quot;</span>
<span class="n">catpage</span>  <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;man(?=\d)&quot;</span><span class="p">,</span><span class="s">&quot;cat&quot;</span><span class="p">,</span><span class="n">manpage</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">bindirs</span> <span class="o">=</span> <span class="s">&quot;/usr/bin /bin /usr/local/bin&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">libdirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;bin&quot;</span><span class="p">,</span> <span class="s">&quot;lib&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">bindirs</span><span class="p">]</span>

<span class="k">print</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">libdirs</span><span class="p">)</span>
<span class="c">#=&gt; /usr/lib /lib /usr/local/lib</span>
<span class="c">#-----------------------------</span>
<span class="c"># strings are never modified in place.</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_6.2</span>
<span class="c">##---------------------------</span>

<span class="c"># DON&#39;T DO THIS.  use line[:-1].isalpha() [this probably goes for the</span>
<span class="c">#    remainder of this section too!]</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;^[A-Za-z]+$&quot;</span><span class="p">,</span><span class="n">line</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;pure alphabetic&quot;</span>
<span class="c">##---------------------------</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^[^\W\d_]+$&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">LOCALE</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;pure alphabetic&quot;</span>
<span class="c">##---------------------------</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">locale</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">locale</span><span class="o">.</span><span class="n">setlocale</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">LC_ALL</span><span class="p">,</span> <span class="s">&#39;fr_CA.ISO8859-1&#39;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;couldn&#39;t set locale to French Cnadian&quot;</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span>

<span class="n">DATA</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">silly</span>
<span class="s">faзade</span>
<span class="s">coцperate</span>
<span class="s">niсo</span>
<span class="s">Renйe</span>
<span class="s">Moliиre </span>
<span class="s">hжmoglobin</span>
<span class="s">naпve</span>
<span class="s">tschья</span>
<span class="s">random!stuff#here</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">DATA</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
    <span class="n">ln</span> <span class="o">=</span> <span class="n">ln</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^[^\W\d_]+$&quot;</span><span class="p">,</span><span class="n">ln</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">LOCALE</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: alphabetic&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ln</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: line noise&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ln</span><span class="p">)</span>
<span class="c"># although i dont think &quot;coцperate&quot; should be in canadian</span>
<span class="c">##---------------------------</span>

<span class="c"># @@PLEAC@@_6.3</span>
<span class="c"># Matching Words</span>
<span class="s">&quot;\S+&quot;</span>          <span class="c"># as many non-whitespace bytes as possible</span>
<span class="s">&quot;[A-Za-z&#39;-]+&quot;</span>  <span class="c"># as many letters, apostrophes, and hyphens</span>

<span class="c"># string split is similar to splitting on &quot;\s+&quot;</span>
<span class="s">&quot;A text   with some</span><span class="se">\t</span><span class="s">separator&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="s">&quot;</span><span class="se">\b</span><span class="s">*([A-Za-z]+)</span><span class="se">\b</span><span class="s">*&quot;</span>   <span class="c"># word boundaries </span>
<span class="s">&quot;\s*([A-Za-z]+)\s*&quot;</span>   <span class="c"># might work too as on letters are allowed.</span>

<span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;\Bis\B&quot;</span><span class="p">,</span><span class="s">&quot;this thistle&quot;</span><span class="p">)</span> <span class="c"># matches on thistle not on this</span>
<span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;\Bis\B&quot;</span><span class="p">,</span><span class="s">&quot;vis-a-vis&quot;</span><span class="p">)</span>    <span class="c"># does not match</span>

<span class="c"># @@PLEAC@@_6.4</span>
<span class="c">#-----------------------------</span>
<span class="c">#!/usr/bin/python</span>
<span class="c"># resname - change all &quot;foo.bar.com&quot; style names in the input stream</span>
<span class="c"># into &quot;foo.bar.com [204.148.40.9]&quot; (or whatever) instead</span>

<span class="kn">import</span> <span class="nn">socket</span>               <span class="c"># load inet_addr</span>
<span class="kn">import</span> <span class="nn">fileinput</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;&quot;&quot;(?P&lt;hostname&gt;  # capture hostname</span>
<span class="s">                         (?:         # these parens for grouping only</span>
<span class="s">                            [\w-]+   # hostname component</span>
<span class="s">                            \.       # ant the domain dot</span>
<span class="s">                         ) +         # now repeat that whole thing a bunch of times</span>
<span class="s">                         [A-Za-z]    # next must be a letter</span>
<span class="s">                         [\w-] +     # now trailing domain part</span>
<span class="s">                      )              # end of hostname capture</span>
<span class="s">                   &quot;&quot;&quot;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>   <span class="c"># for nice formatting</span>

<span class="k">def</span> <span class="nf">repl</span><span class="p">(</span><span class="n">match_obj</span><span class="p">):</span>
    <span class="n">orig_hostname</span> <span class="o">=</span> <span class="n">match_obj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&quot;hostname&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">orig_hostname</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span><span class="p">:</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="s">&quot;???&quot;</span>
    <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> [</span><span class="si">%s</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">orig_hostname</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">match</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">repl</span><span class="p">,</span> <span class="n">ln</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;&quot;&quot;(?x)     # nicer formatting</span>
<span class="s">          \#       #   a pound sign</span>
<span class="s">          (\w+)    #   the variable name</span>
<span class="s">          \#       #   another pound sign</span>
<span class="s">          &quot;&quot;&quot;</span><span class="p">,</span>
          <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>  <span class="c"># replace with the value of the global variable</span>
          <span class="n">line</span>
      <span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;&quot;&quot;(?x)     # nicer formatting</span>
<span class="s">          \#       #   a pound sign</span>
<span class="s">          (\w+)    #   the variable name</span>
<span class="s">          \#       #   another pound sign</span>
<span class="s">          &quot;&quot;&quot;</span><span class="p">,</span>
          <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))),</span>  <span class="c"># replace with the value of *any* variable</span>
          <span class="n">line</span>
      <span class="p">)</span>
<span class="c">##-----------------------------</span>

<span class="c"># @@PLEAC@@_6.5</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">pond</span> <span class="o">=</span> <span class="s">&quot;one fish two fish red fish blue fish&quot;</span>
<span class="n">fishes</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?i)(\w+)\s+fish\b&quot;</span><span class="p">,</span><span class="n">pond</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fishes</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;The third fish is a </span><span class="si">%s</span><span class="s"> one.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fishes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="c">##-----------------------------</span>
<span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?i)(?:\w+\s+fish\s+){2}(\w+)\s+fish&quot;</span><span class="p">,</span><span class="n">pond</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">match_object</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s">r&quot;PAT&quot;</span><span class="p">,</span> <span class="n">mystr</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>   <span class="c"># or whatever you want to do here</span>

<span class="c"># &quot;progressive&quot; matching might be better if one wants match 5 from 50.</span>
<span class="c"># to count use</span>
<span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;PAT&quot;</span><span class="p">,</span><span class="n">mystr</span><span class="p">))</span>
<span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;aba&quot;</span><span class="p">,</span><span class="s">&quot;abaababa&quot;</span><span class="p">))</span>

<span class="c"># &quot;count&quot; overlapping matches</span>
<span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?=aba)&quot;</span><span class="p">,</span><span class="s">&quot;abaababa&quot;</span><span class="p">))</span>

<span class="c"># FASTEST non-overlapping might be str.count</span>
<span class="s">&quot;abaababa&quot;</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;aba&quot;</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">pond</span> <span class="o">=</span> <span class="s">&quot;one fish two fish red fish blue fish&quot;</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?i)(\w+)\s+fish\b&quot;</span><span class="p">,</span><span class="n">pond</span><span class="p">)</span>   <span class="c"># get all matches</span>
<span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>                                 <span class="c"># then the one we want</span>

<span class="c"># or without a temporary list</span>
<span class="n">color</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?i)(\w+)\s+fish\b&quot;</span><span class="p">,</span><span class="n">pond</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="c"># just grab element 3</span>

<span class="k">print</span> <span class="s">&quot;The third fish in the pond is </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">color</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">pond</span> <span class="o">=</span> <span class="s">&quot;one fish two fish red fish blue fish&quot;</span>
<span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(\w+)\s+fish\b&quot;</span><span class="p">,</span><span class="n">pond</span><span class="p">)</span>
<span class="n">evens</span> <span class="o">=</span> <span class="p">[</span><span class="n">fish</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">fish</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">2</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&quot;Even numbered fish are </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">evens</span><span class="p">))</span>
<span class="c">##-----------------------------</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">def</span> <span class="nf">four_is_sushi</span><span class="p">(</span><span class="n">match_obj</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">count</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">count</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&quot;sushi</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">match_obj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">match_obj</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>

<span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;(?x)               # VERBOSE</span>
<span class="s">           \b                 # makes next \w more efficient</span>
<span class="s">           ( \w+ )            # this is what we&#39;ll be changing</span>
<span class="s">           (</span>
<span class="s">             \s+ fish \b</span>
<span class="s">           )&quot;&quot;&quot;</span><span class="p">,</span>
           <span class="n">four_is_sushi</span><span class="p">,</span>
           <span class="n">pond</span><span class="p">)</span>
<span class="c"># one fish two fish red fish sushi fish</span>
<span class="c">##-----------------------------</span>
<span class="c"># greedily</span>
<span class="n">last_fish</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?i).*\b(\w+)\s+fish\b&quot;</span><span class="p">,</span><span class="n">pond</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">pond</span> <span class="o">=</span> <span class="s">&quot;One fish two fish red fish blue fish swim here&quot;</span>
<span class="n">color</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?i)\b(\w+)\s+fish\b&quot;</span><span class="p">,</span><span class="n">pond</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&quot;Last fish is &quot;</span><span class="o">+</span><span class="n">color</span><span class="o">+</span><span class="s">&quot;.&quot;</span>
<span class="c"># FASTER using string.</span>
<span class="n">lastfish</span> <span class="o">=</span> <span class="n">pond</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&quot;fish&quot;</span><span class="p">)</span>
<span class="n">color</span> <span class="o">=</span> <span class="n">pond</span><span class="p">[:</span><span class="n">lastfish</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c">##-----------------------------</span>
<span class="sd">r&quot;&quot;&quot;(?x)</span>
<span class="sd">    A             # find some pattern A</span>
<span class="sd">    (?!           # mustn&#39;t be able to find</span>
<span class="sd">      .*          # something</span>
<span class="sd">      A           # and A</span>
<span class="sd">    )</span>
<span class="sd">    $             # through the end of string</span>
<span class="sd"> &quot;&quot;&quot;</span>

<span class="n">pond</span> <span class="o">=</span> <span class="s">&quot;One fish two fish red fish blue fish swim here&quot;</span>
<span class="n">fnd</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;(?xis)                # VERBOSE, CASEINSENSITIVE, DOTALL</span>
<span class="s">                  \b ( \w+ ) \s+ fish \b</span>
<span class="s">                  (?! .* \b fish \b )&quot;&quot;&quot;</span><span class="p">,</span>
                  <span class="n">pond</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fnd</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Last fish is </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fnd</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Failed!&quot;</span>


<span class="c"># @@PLEAC@@_6.6</span>
<span class="c"># Matching Multiple Lines</span>
<span class="c">#</span>
<span class="c">#!/usr/bin/python</span>
<span class="c"># killtags - very bad html tag killer</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">text</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>        <span class="c"># read the whole file</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;(?ms)&lt;.*?&gt;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>    <span class="c"># strip tags (terrible</span>
<span class="k">print</span> <span class="n">text</span>
<span class="c">## ----------------------------</span>
<span class="c">#!/usr/bin/python</span>
<span class="c"># headerfy: change certain chapter headers to html</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">re</span>

<span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;(?xms)          # re.VERBOSE, re.MULTILINE, and re.DOTALL</span>
<span class="s">                       \A              # start of the string</span>
<span class="s">                       (?P&lt;chapter&gt;    # capture in g&lt;chapter&gt;</span>
<span class="s">                         Chapter       # literal string</span>
<span class="s">                         \s+           # mandatory whitespace</span>
<span class="s">                         \d+           # decimal number</span>
<span class="s">                         \s*           # optional whitespace</span>
<span class="s">                         :             # a real colon</span>
<span class="s">                         . *           # anything not a newline till end of line</span>
<span class="s">                       )</span>
<span class="s">                    &quot;&quot;&quot;</span><span class="p">)</span>
<span class="n">text</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>        <span class="c"># read the whole file</span>
<span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">):</span>   <span class="c"># split on unix end of lines</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;&lt;h1&gt;\g&lt;chapter&gt;&lt;/h1&gt;&quot;</span><span class="p">,</span><span class="n">paragraph</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">p</span>
<span class="c">## ----------------------------</span>
<span class="c"># the one liner does not run.</span>
<span class="c"># python -c &#39;import sys,re; for p in open(sys.argv[1]).read().split(&quot;\n\n&quot;): print re.sub(r&quot;(?ms)\A(Chapter\s+\d+\s*:.*)&quot;,&quot;&lt;h1&gt;\g0&lt;/h1&gt;&quot;,p)&#39;</span>
<span class="c">## ----------------------------</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;(?ms)^START(.*?)^END&quot;</span><span class="p">)</span>
     <span class="c"># s makes . span line boundaries</span>
     <span class="c"># m makes ^ match at the beginning of the string and at the beginning of each line</span>

<span class="n">chunk</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">):</span>
    <span class="n">chunk</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">fnd</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">paragraph</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fnd</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;chunk </span><span class="si">%d</span><span class="s"> in </span><span class="si">%s</span><span class="s"> has &lt;&lt;</span><span class="si">%s</span><span class="s">&gt;&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">chunk</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&quot;&gt;&gt;,&lt;&lt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fnd</span><span class="p">))</span>
<span class="c">## ----------------------------</span>

<span class="c"># @@PLEAC@@_6.7</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="c"># Read the whole file and split</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>      <span class="c"># on whitespace</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>  <span class="c"># on line ends</span>

<span class="c"># splitting on pattern</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="s">r&quot;x&quot;</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="c">##-----------------------------</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&quot;(?m)^\.(Ch|Se|Ss)$&quot;</span><span class="p">,</span><span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="k">print</span> <span class="s">&quot;I read </span><span class="si">%d</span><span class="s"> chunks.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">))</span>
<span class="c"># without delimiters</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&quot;(?m)^\.(?:Ch|Se|Ss)$&quot;</span><span class="p">,</span><span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="c"># with delimiters</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&quot;(?m)^(\.(?:Ch|Se|Ss))$&quot;</span><span class="p">,</span><span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="c"># with delimiters at chunkstart</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;(?xms)       # multiline, dot matches lineend, allow comments</span>
<span class="s">                          ((?:^\.)?  # consume the separator if present</span>
<span class="s">                           .*?)      # match everything but not greedy</span>
<span class="s">                          (?=        # end the match on this but dont consume it</span>
<span class="s">                            (?:                  # dont put into group [1]</span>
<span class="s">                               ^\.(?:Ch|Se|Ss)$  # either end on one of the roff commands</span>
<span class="s">                               |\Z               # or end of text</span>
<span class="s">                            )</span>
<span class="s">                          )&quot;&quot;&quot;</span><span class="p">,</span>
                    <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="c"># [1] if &quot;?:&quot; is removed the result holds tuples: (&#39;.Ch\nchapter x&#39;,&#39;.Ch&#39;)</span>
<span class="c">#     which might be more usefull. </span>

<span class="c"># @@PLEAC@@_6.8</span>
<span class="c">##-----------------------------</span>
<span class="c"># Python doesn&#39;t have perl&#39;s range operators</span>
<span class="c"># If you want to only use a selected line range, use enumerate</span>
<span class="c"># (though note that indexing starts at zero:</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">myfile</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">firstlinenum</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">lastlinenum</span><span class="p">:</span>
        <span class="n">dosomethingwith</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="c"># Using patterned ranges is slightly trickier -</span>
<span class="c"># You need to search for the first pattern then</span>
<span class="c"># search for the next pattern:</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">myfile</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat1</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="k">break</span>

<span class="n">dosomethingwith</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>    <span class="c"># Only if pat1 can be on same line as pat2</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">myfile</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat2</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="k">break</span>
    <span class="n">dosomethingwith</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="c"># If you need to extract ranges a lot, the following generator funcs</span>
<span class="c"># may be useful:</span>
<span class="k">def</span> <span class="nf">extract_range</span><span class="p">(</span><span class="n">myfile</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">myfile</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">finish</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">line</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">finish</span><span class="p">:</span>
            <span class="k">break</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">extract_range</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&quot;/etc/passwd&quot;</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">line</span>

<span class="k">def</span> <span class="nf">patterned_range</span><span class="p">(</span><span class="n">myfile</span><span class="p">,</span> <span class="n">startpat</span><span class="p">,</span> <span class="n">endpat</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">startpat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">startpat</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">endpat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">endpat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">endpat</span><span class="p">)</span>
    <span class="n">in_range</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">myfile</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">startpat</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="n">in_range</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">in_range</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">line</span>
        <span class="k">if</span> <span class="n">endpat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">endpat</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
            <span class="k">break</span>

<span class="c"># DO NOT DO THIS.  Use the email module instead</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">patterned_range</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&quot;^From:?&quot;</span><span class="p">,</span> <span class="s">&quot;^$&quot;</span><span class="p">):</span>
    <span class="k">pass</span> <span class="c">#...</span>


<span class="c"># @@PLEAC@@_6.9</span>
<span class="n">tests</span> <span class="o">=</span> <span class="p">((</span><span class="s">&quot;list.?&quot;</span><span class="p">,</span><span class="s">r&quot;^list\..$&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;project.*&quot;</span><span class="p">,</span><span class="s">r&quot;^project\..*$&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;*old&quot;</span><span class="p">,</span><span class="s">r&quot;^.*old$&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;type*.[ch]&quot;</span><span class="p">,</span><span class="s">r&quot;^type.*\.[ch]$&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;*.*&quot;</span><span class="p">,</span><span class="s">r&quot;^.*\..*$&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="s">r&quot;^.*$&quot;</span><span class="p">),</span>
        <span class="p">)</span>

<span class="c"># The book says convert &quot;*&quot;,&quot;?&quot;,&quot;[&quot;,&quot;]&quot; all other characters will be quoted.</span>
<span class="c"># The book uses &quot;\Q&quot; which escapes any characters that would otherwise be</span>
<span class="c"># treated as regular expression.</span>
<span class="c"># Escaping every char fails as &quot;\s&quot; is not &quot;s&quot; in a regex.</span>

<span class="k">def</span> <span class="nf">glob2pat</span><span class="p">(</span><span class="n">globstr</span><span class="p">):</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="n">globstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">,</span><span class="s">r&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="n">pat</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">,</span><span class="s">r&quot;\.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;?&quot;</span><span class="p">,</span><span class="s">r&quot;.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span><span class="s">r&quot;.*&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="s">&quot;^&quot;</span><span class="o">+</span><span class="n">pat</span><span class="o">+</span><span class="s">&quot;$&quot;</span>

<span class="k">for</span> <span class="n">globstr</span><span class="p">,</span> <span class="n">patstr</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
    <span class="n">g2p</span> <span class="o">=</span> <span class="n">glob2pat</span><span class="p">(</span><span class="n">globstr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">g2p</span> <span class="o">!=</span> <span class="n">patstr</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">globstr</span><span class="p">,</span> <span class="s">&quot;failed! Should be&quot;</span><span class="p">,</span> <span class="n">patstr</span><span class="p">,</span> <span class="s">&quot;but was&quot;</span><span class="p">,</span> <span class="n">g2p</span>


<span class="c"># @@PLEAC@@_6.10</span>

<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch06/popgrep1</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># popgrep1 - grep for abbreviations of places that say &quot;pop&quot;</span>
<span class="c"># version 1: slow but obvious way</span>
<span class="kn">import</span> <span class="nn">fileinput</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">popstates</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;CO&quot;</span><span class="p">,</span><span class="s">&quot;ON&quot;</span><span class="p">,</span><span class="s">&quot;MI&quot;</span><span class="p">,</span><span class="s">&quot;WI&quot;</span><span class="p">,</span><span class="s">&quot;MN&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">popstates</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;\b&quot;</span><span class="o">+</span><span class="n">state</span><span class="o">+</span><span class="s">r&quot;\b&quot;</span><span class="p">,</span><span class="n">line</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">line</span>



<span class="c">#-----------------------------</span>
<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch06/popgrep2</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># popgrep2 - grep for abbreviations of places that say &quot;pop&quot;</span>
<span class="c"># version 2: compile the patterns</span>
<span class="kn">import</span> <span class="nn">fileinput</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">popstates</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;CO&quot;</span><span class="p">,</span><span class="s">&quot;ON&quot;</span><span class="p">,</span><span class="s">&quot;MI&quot;</span><span class="p">,</span><span class="s">&quot;WI&quot;</span><span class="p">,</span><span class="s">&quot;MN&quot;</span><span class="p">]</span>
<span class="n">state_re</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">popstates</span><span class="p">:</span>
    <span class="n">state_re</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;\b&quot;</span><span class="o">+</span><span class="n">state</span><span class="o">+</span><span class="s">r&quot;\b&quot;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">state_re</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">line</span>


<span class="c">#-----------------------------</span>
<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch06/popgrep3</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># popgrep3 - grep for abbreviations of places that say &quot;pop&quot;</span>
<span class="c"># version 3: compile a single pattern</span>
<span class="kn">import</span> <span class="nn">fileinput</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">popstates</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;CO&quot;</span><span class="p">,</span><span class="s">&quot;ON&quot;</span><span class="p">,</span><span class="s">&quot;MI&quot;</span><span class="p">,</span><span class="s">&quot;WI&quot;</span><span class="p">,</span><span class="s">&quot;MN&quot;</span><span class="p">]</span>
<span class="n">state_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;\b(?:&quot;</span><span class="o">+</span><span class="s">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">popstates</span><span class="p">)</span><span class="o">+</span><span class="s">r&quot;)\b&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">state_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">line</span>


<span class="c">#-----------------------------</span>
<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch06/grepauth</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># grepauth - print lines that mention both Tom and Nat</span>
<span class="kn">import</span> <span class="nn">fileinput</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">build_match_any</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">uniq</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
        <span class="n">seen</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">seen</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">seen</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">build_match_all</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">uniq</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">line</span><span class="p">)))</span><span class="o">&gt;=</span><span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">c</span>

<span class="nb">any</span> <span class="o">=</span> <span class="n">build_match_any</span><span class="p">((</span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="s">&quot;Nat&quot;</span><span class="p">))</span>
<span class="nb">all</span> <span class="o">=</span> <span class="n">build_match_all</span><span class="p">((</span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="s">&quot;Nat&quot;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">any</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;any:&quot;</span><span class="p">,</span> <span class="n">line</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;all:&quot;</span><span class="p">,</span> <span class="n">line</span>



<span class="c">#-----------------------------</span>


<span class="c"># @@PLEAC@@_6.11</span>
<span class="c"># Testing for a Valid Pattern</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;Pattern? &quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;INVALID PATTERN&quot;</span><span class="p">,</span> <span class="n">err</span>
        <span class="k">continue</span>
    <span class="k">break</span>

<span class="c"># ----</span>
<span class="k">def</span> <span class="nf">is_valid_pattern</span><span class="p">(</span><span class="n">pat</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>

<span class="c"># ----</span>

<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch06/paragrep</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># paragrep - trivial paragraph grepper</span>
<span class="c">#</span>
<span class="c"># differs from perl version in parano.</span>
<span class="c"># python version displays paragraph in current file.</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os.path</span><span class="o">,</span> <span class="nn">re</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">:</span>
	<span class="k">print</span> <span class="s">&quot;usage: </span><span class="si">%s</span><span class="s"> pat [files]</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
	<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">pat</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">try</span><span class="p">:</span>
	<span class="n">pat_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
	<span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: bad pattern </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pat</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
	<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">:]):</span>
	<span class="n">parano</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">):</span>
		<span class="n">parano</span> <span class="o">+=</span> <span class="mi">1</span>
		<span class="k">if</span> <span class="n">pat_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">para</span><span class="p">):</span>
			<span class="k">print</span> <span class="n">filename</span><span class="p">,</span> <span class="n">parano</span><span class="p">,</span> <span class="n">para</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
			


<span class="c"># ----</span>

<span class="c"># as we dont evaluate patterns the attack ::</span>
<span class="c">#</span>
<span class="c">#   $pat = &quot;You lose @{[ system(&#39;rm -rf *&#39;]} big here&quot;;</span>
<span class="c">#</span>
<span class="c"># does not work.</span>


<span class="c"># @@PLEAC@@_6.12</span>

<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch06/localeg</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># localeg - demonstrates locale effects</span>
<span class="c">#</span>
<span class="c"># re must be told to respect locale either in the regexp</span>
<span class="c"># &quot;(?L)&quot; or as flag to the call (python 2.4) &quot;re.LOCALE&quot;.</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">string</span>
<span class="kn">from</span> <span class="nn">locale</span> <span class="kn">import</span> <span class="n">LC_CTYPE</span><span class="p">,</span> <span class="n">setlocale</span><span class="p">,</span> <span class="n">getlocale</span>

<span class="n">name</span> <span class="o">=</span> <span class="s">&quot;andreas k</span><span class="se">\xF6</span><span class="s">nig&quot;</span>
<span class="n">locale</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;German&quot;</span> <span class="p">:</span> <span class="s">&quot;de_DE.ISO_8859-1&quot;</span><span class="p">,</span> <span class="s">&quot;English&quot;</span> <span class="p">:</span> <span class="s">&quot;en_US&quot;</span><span class="p">}</span>
<span class="c"># us-ascii is not supported on linux py23</span>
<span class="c"># none works in activestate py24</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">setlocale</span><span class="p">(</span><span class="n">LC_CTYPE</span><span class="p">,</span> <span class="n">locale</span><span class="p">[</span><span class="s">&quot;English&quot;</span><span class="p">])</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Invalid locale </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">locale</span><span class="p">[</span><span class="s">&quot;English&quot;</span><span class="p">]</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">english_names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?L)\b(\w+)\b&quot;</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
    <span class="n">english_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">setlocale</span><span class="p">(</span><span class="n">LC_CTYPE</span><span class="p">,</span> <span class="n">locale</span><span class="p">[</span><span class="s">&quot;German&quot;</span><span class="p">])</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Invalid locale </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">locale</span><span class="p">[</span><span class="s">&quot;German&quot;</span><span class="p">]</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">german_names</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">capitalize</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(?L)\b(\w+)\b&quot;</span><span class="p">,</span><span class="n">name</span><span class="p">))</span>

<span class="k">print</span> <span class="s">&quot;English names: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">english_names</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;German names: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">german_names</span><span class="p">)</span>


<span class="c"># @@PLEAC@@_6.13</span>
<span class="c">##-----------------------------</span>
<span class="kn">import</span> <span class="nn">difflib</span>
<span class="n">matchlist</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;ape&quot;</span><span class="p">,</span> <span class="s">&quot;apple&quot;</span><span class="p">,</span> <span class="s">&quot;lapel&quot;</span><span class="p">,</span> <span class="s">&quot;peach&quot;</span><span class="p">,</span> <span class="s">&quot;puppy&quot;</span><span class="p">]</span>
<span class="k">print</span> <span class="n">difflib</span><span class="o">.</span><span class="n">get_close_matches</span><span class="p">(</span><span class="s">&quot;appel&quot;</span><span class="p">,</span> <span class="n">matchlist</span><span class="p">)</span>
<span class="c">#=&gt; [&#39;lapel&#39;, &#39;apple&#39;, &#39;ape&#39;]</span>
<span class="c">##-----------------------------</span>
<span class="c"># Also see:</span>
<span class="c">#     http://www.personal.psu.edu/staff/i/u/iua1/python/apse/</span>
<span class="c">#     http://www.bio.cam.ac.uk/~mw263/pyagrep.html</span>

<span class="c"># @@PLEAC@@_6.14</span>
<span class="c">##-----------------------------</span>
<span class="c"># To search (potentially) repeatedly for a pattern, use re.finditer():</span>

<span class="c"># DO NOT DO THIS.  Split on commas and convert elems using int()</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&quot;3,4,5,9,120&quot;</span>
<span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s">&quot;(\d+)&quot;</span><span class="p">,</span> <span class="n">mystr</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="s">&quot;9&quot;</span><span class="p">:</span>
        <span class="k">break</span> <span class="c"># &#39;120&#39; will never be matched</span>
    <span class="k">print</span> <span class="s">&quot;Found number&quot;</span><span class="p">,</span> <span class="n">n</span>

<span class="c"># matches know their end position</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">&quot;The year 1752 lost 10 days on the 3rd of September&quot;</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s">&quot;(\d+)&quot;</span><span class="p">,</span> <span class="n">mystr</span><span class="p">)</span>
<span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;Found number&quot;</span><span class="p">,</span> <span class="n">n</span>

<span class="n">tail</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;(\S+)&quot;</span><span class="p">,</span> <span class="n">mystr</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">():])</span>
<span class="k">if</span> <span class="n">tail</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Found </span><span class="si">%s</span><span class="s"> after the last number.&quot;</span><span class="o">%</span><span class="n">tail</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="c"># @@PLEAC@@_6.15</span>
<span class="c"># Python&#39;s regexes are based on Perl&#39;s, so it has the non-greedy </span>
<span class="c"># &#39;*?&#39;, &#39;+?&#39;, and &#39;??&#39; versions of &#39;*&#39;, &#39;+&#39;, and &#39;?&#39;.</span>
<span class="c"># DO NOT DO THIS. import htmllib, formatter, etc, instead</span>
<span class="c">#-----------------------------</span>
<span class="c"># greedy pattern</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;&lt;.*&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span> <span class="c"># try to remove tags, very badly</span>

<span class="c"># non-greedy pattern</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;&lt;.*?&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span> <span class="c"># try to remove tags, still rather badly</span>
<span class="c">#-----------------------------</span>
<span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;&lt;b&gt;&lt;i&gt;this&lt;/i&gt; and &lt;i&gt;that&lt;/i&gt; are important&lt;/b&gt; Oh, &lt;b&gt;&lt;i&gt;me too!&lt;/i&gt;&lt;/b&gt;&quot;</span>

<span class="k">print</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;&lt;b&gt;&lt;i&gt;(.*?)&lt;/i&gt;&lt;/b&gt;&quot;</span><span class="p">,</span> <span class="n">txt</span>
<span class="c">##-----------------------------</span>
<span class="k">print</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;/BEGIN((?:(?!BEGIN).)*)END/&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="k">print</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;&lt;b&gt;&lt;i&gt;((?:(?!&lt;b&gt;|&lt;i&gt;).)*)&lt;/i&gt;&lt;/b&gt;&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="k">print</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;&lt;b&gt;&lt;i&gt;((?:(?!&lt;[ib]&gt;).)*)&lt;/i&gt;&lt;/b&gt;&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="k">print</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    &lt;b&gt;&lt;i&gt; </span>
<span class="s">    [^&lt;]*  # stuff not possibly bad, and not possibly the end.</span>
<span class="s">    (?:    # at this point, we can have &#39;&lt;&#39; if not part of something bad</span>
<span class="s">     (?!  &lt;/?[ib]&gt;  )   # what we can&#39;t have</span>
<span class="s">     &lt;                  # okay, so match the &#39;&lt;&#39;</span>
<span class="s">     [^&lt;]*              # and continue with more safe stuff</span>
<span class="s">    ) *</span>
<span class="s">    &lt;/i&gt;&lt;/b&gt;</span>
<span class="s">    &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>

<span class="c"># @@PLEAC@@_6.16</span>
<span class="c">##-----------------------------</span>
<span class="n">text</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">This is a test</span>
<span class="s">test of the duplicate word finder.</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="n">words</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="k">for</span> <span class="n">curr</span><span class="p">,</span> <span class="nb">next</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">words</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
    <span class="k">if</span> <span class="n">curr</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="nb">next</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
	    <span class="k">print</span> <span class="s">&quot;Duplicate word &#39;</span><span class="si">%s</span><span class="s">&#39; found.&quot;</span> <span class="o">%</span> <span class="n">curr</span>

<span class="c"># DON&#39;T DO THIS</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;</span>
<span class="s">      \b            # start at a word boundary (begin letters)</span>
<span class="s">      (\S+)         # find chunk of non-whitespace</span>
<span class="s">      \b            # until another word boundary (end letters)</span>
<span class="s">      (</span>
<span class="s">          \s+       # separated by some whitespace</span>
<span class="s">          \1        # and that very same chunk again</span>
<span class="s">          \b        # until another word boundary</span>
<span class="s">      ) +           # one or more sets of those</span>
<span class="s">      &quot;&quot;&quot;</span>
<span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Duplicate word &#39;</span><span class="si">%s</span><span class="s">&#39; found.&quot;</span> <span class="o">%</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">a</span> <span class="o">=</span> <span class="s">&#39;nobody&#39;</span><span class="p">;</span>
<span class="n">b</span> <span class="o">=</span> <span class="s">&#39;bodysnatcher&#39;</span><span class="p">;</span>

<span class="n">text</span> <span class="o">=</span> <span class="n">a</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">b</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">r&quot;^(\w+)(\w+) \2(\w+)$&quot;</span>
<span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">m2</span><span class="p">,</span> <span class="s">&quot;overlaps in </span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">r&quot;^(\w+?)(\w+) \2(\w+)$&quot;</span>
<span class="c">##-----------------------------</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^(oo+?)\1+$&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">factor</span><span class="p">,</span> <span class="s">&quot;o&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="k">def</span> <span class="nf">diaphantine</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="s">r&quot;^(o*)\1{</span><span class="si">%s</span><span class="s">}(o*)\2{</span><span class="si">%s</span><span class="s">}(o*)\3{</span><span class="si">%s</span><span class="s">}$&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">z</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;o&quot;</span><span class="o">*</span><span class="n">n</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;No solutions.&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;One solution is: x=</span><span class="si">%s</span><span class="s">, y=</span><span class="si">%s</span><span class="s">, z=</span><span class="si">%s</span><span class="s">.&quot;</span><span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
        
<span class="n">diaphantine</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">281</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c"># @@PLEAC@@_6.17</span>
<span class="c">##-----------------------------</span>
<span class="c"># Pass any of the following patterns to re.match(), etc</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">&quot;ALPHA|BETA&quot;</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">&quot;^(?=.*ALPHA)(?=.*BETA)&quot;</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">&quot;ALPHA.*BETA|BETA.*ALPHA&quot;</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">&quot;^(?:(?!PAT).)*$&quot;</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">&quot;(?=^(?:(?!BAD).)*$)GOOD&quot;</span>
<span class="c">##-----------------------------</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="n">something</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat1</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat2</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="n">something</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat1</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat2</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="n">something</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="c"># DON&#39;T DO THIS.</span>
<span class="sd">&quot;&quot;&quot;minigrep - trivial grep&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">re</span>

<span class="n">pat</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c">##-----------------------------</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^(?=.*bell)(?=.*lab)&quot;</span><span class="p">,</span> <span class="s">&quot;labelled&quot;</span><span class="p">):</span>
    <span class="n">something</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;bell&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;lab&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="n">something</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">             ^              # start of string</span>
<span class="s">            (?=             # zero-width lookahead</span>
<span class="s">                .*          # any amount of intervening stuff</span>
<span class="s">                bell        # the desired bell string</span>
<span class="s">            )               # rewind, since we were only looking</span>
<span class="s">            (?=             # and do the same thing</span>
<span class="s">                .*          # any amount of intervening stuff</span>
<span class="s">                lab         # and the lab part</span>
<span class="s">            )</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">,</span>
            <span class="n">murray_hill</span><span class="p">,</span>
            <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Looks like Bell Labs might be in Murray Hill!&quot;</span>
<span class="c">##-----------------------------</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;(?:^.*bell.*lab)|(?:^.*lab.*bell)&quot;</span><span class="p">,</span> <span class="s">&quot;labelled&quot;</span><span class="p">):</span>
    <span class="n">something</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="n">brand</span> <span class="o">=</span> <span class="s">&quot;labelled&quot;</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            (?:                 # non-capturing grouper</span>
<span class="s">                ^ .*?           # any amount of stuff at the front</span>
<span class="s">                bell            # look for a bell</span>
<span class="s">                .*?             # followed by any amount of anything</span>
<span class="s">                lab             # look for a lab</span>
<span class="s">            )                   # end grouper</span>
<span class="s">            |                   # otherwise, try the other direction</span>
<span class="s">            (?:                 # non-capturing grouper</span>
<span class="s">                ^ .*?           # any amount of stuff at the front</span>
<span class="s">                lab             # look for a lab</span>
<span class="s">                .*?             # followed by any amount of anything</span>
<span class="s">                bell            # followed by a bell</span>
<span class="s">            )                   # end grouper</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">,</span>
            <span class="n">brand</span><span class="p">,</span>
            <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Our brand has bell and lab separate.&quot;</span>
<span class="c">##-----------------------------</span>
<span class="n">x</span> <span class="o">=</span> <span class="s">&quot;odlaw&quot;</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;^(?:(?!waldo).)*$&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
   <span class="k">print</span> <span class="s">&quot;There&#39;s no waldo here!&quot;</span>
<span class="c">##-----------------------------</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">            ^                   # start of string</span>
<span class="s">            (?:                 # non-capturing grouper</span>
<span class="s">                (?!             # look ahead negation</span>
<span class="s">                    waldo       # is he ahead of us now?</span>
<span class="s">                )               # is so, the negation failed</span>
<span class="s">                .               # any character (cuzza /s)</span>
<span class="s">            ) *                 # repeat that grouping 0 or more</span>
<span class="s">            $                   # through the end of the string</span>
<span class="s">            &quot;&quot;&quot;</span><span class="p">,</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;There&#39;s no waldo here!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="c">##-----------------------------</span>

<span class="c"># @@PLEAC@@_6.18</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_6.19</span>
<span class="c">##-----------------------------</span>
<span class="kn">from</span> <span class="nn">email._parseaddr</span> <span class="kn">import</span> <span class="n">AddressList</span>

<span class="k">print</span> <span class="n">AddressList</span><span class="p">(</span><span class="s">&quot;fred&amp;barney@stonehenge.com&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">addresslist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">print</span> <span class="n">AddressList</span><span class="p">(</span><span class="s">&quot;fred&amp;barney@stonehenge.com (Hanna Barbara)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">addresslist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">name</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="n">AddressList</span><span class="p">(</span><span class="s">&quot;Mr Fooby Blah &lt;me@nowhere.com&gt;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">addresslist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">&#39;s address is &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>

<span class="c"># @@PLEAC@@_6.20</span>
<span class="c">##-----------------------------</span>
<span class="c"># Assuming the strings all start with different letters, or you don&#39;t</span>
<span class="c"># mind there being precedence, use the startswith string method:</span>

<span class="k">def</span> <span class="nf">get_action</span><span class="p">(</span><span class="n">answer</span><span class="p">):</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="n">answer</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;send&quot;</span><span class="p">,</span> <span class="s">&quot;stop&quot;</span><span class="p">,</span> <span class="s">&quot;abort&quot;</span><span class="p">,</span> <span class="s">&quot;list&quot;</span><span class="p">,</span> <span class="s">&quot;end&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">answer</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">action</span>

<span class="k">print</span> <span class="s">&quot;Action is </span><span class="si">%s</span><span class="s">.&quot;</span><span class="o">%</span><span class="n">get_action</span><span class="p">(</span><span class="s">&quot;L&quot;</span><span class="p">)</span>
<span class="c">#=&gt; Action is list.</span>
<span class="c">##-----------------------------</span>
<span class="c">#DON&#39;T DO THIS:</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">answer</span> <span class="o">=</span> <span class="s">&quot;ab&quot;</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">answer</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
<span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;SEND&quot;</span><span class="p">,</span> <span class="s">&quot;STOP&quot;</span><span class="p">,</span> <span class="s">&quot;ABORT&quot;</span><span class="p">,</span> <span class="s">&quot;LIST&quot;</span><span class="p">,</span> <span class="s">&quot;EDIT&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">answer</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;Action is </span><span class="si">%s</span><span class="s">.&quot;</span><span class="o">%</span><span class="n">action</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">sys</span>
<span class="k">def</span> <span class="nf">handle_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>    
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">action</span> <span class="ow">in</span> <span class="p">{</span><span class="s">&quot;edit&quot;</span><span class="p">:</span> <span class="n">invoke_editor</span><span class="p">,</span>
                         <span class="s">&quot;send&quot;</span><span class="p">:</span> <span class="n">deliver_message</span><span class="p">,</span>
                         <span class="s">&quot;list&quot;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">system</span><span class="p">(</span><span class="n">pager</span><span class="p">,</span> <span class="n">myfile</span><span class="p">),</span>
                         <span class="s">&quot;abort&quot;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">,</span>
                         <span class="p">}</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
            <span class="n">action</span><span class="p">()</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Unknown command:&quot;</span><span class="p">,</span> <span class="n">cmd</span>
<span class="n">handle_cmd</span><span class="p">(</span><span class="s">&quot;ab&quot;</span><span class="p">)</span>

<span class="c"># @@PLEAC@@_6.21</span>
<span class="c">##-----------------------------</span>
<span class="c"># urlify - wrap HTML links around URL-like constructs</span>
<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">fileinput</span>

<span class="k">def</span> <span class="nf">urlify_string</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="s">r&#39;(http|telnet|gopher|file|wais|ftp)&#39;</span>
    
    <span class="n">ltrs</span> <span class="o">=</span> <span class="s">r&#39;\w&#39;</span><span class="p">;</span>
    <span class="n">gunk</span> <span class="o">=</span> <span class="s">r&#39;/#~:.?+=&amp;%@!\-&#39;</span>
    <span class="n">punc</span> <span class="o">=</span> <span class="s">r&#39;.:?\-&#39;</span>
    <span class="nb">any</span>  <span class="o">=</span> <span class="n">ltrs</span> <span class="o">+</span> <span class="n">gunk</span> <span class="o">+</span> <span class="n">punc</span> 

    <span class="n">pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;</span>
<span class="s">      \b                    # start at word boundary</span>
<span class="s">      (                     # begin \1  {</span>
<span class="s">       </span><span class="si">%(urls)s</span><span class="s">  :          # need resource and a colon</span>
<span class="s">       [</span><span class="si">%(any)s</span><span class="s">] +?         # followed by one or more</span>
<span class="s">                            #  of any valid character, but</span>
<span class="s">                            #  be conservative and take only</span>
<span class="s">                            #  what you need to....</span>
<span class="s">      )                     # end   \1  }</span>
<span class="s">      (?=                   # look-ahead non-consumptive assertion</span>
<span class="s">       [</span><span class="si">%(punc)s</span><span class="s">]*          # either 0 or more punctuation</span>
<span class="s">       [^</span><span class="si">%(any)s</span><span class="s">]           #   followed by a non-url char</span>
<span class="s">       |                    # or else</span>
<span class="s">       $                    #   then end of the string</span>
<span class="s">      )</span>
<span class="s">    &quot;&quot;&quot;</span><span class="o">%</span><span class="nb">locals</span><span class="p">(),</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="s">r&quot;&lt;A HREF=\1&gt;\1&lt;/A&gt;&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
        <span class="k">print</span> <span class="n">urlify_string</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>


<span class="c"># @@PLEAC@@_6.22</span>
<span class="c">##-----------------------------</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_6.23</span>
<span class="c"># The majority of regexes in this section are either partially</span>
<span class="c"># or completely The Wrong Thing to Do.</span>
<span class="c">##-----------------------------</span>
<span class="c"># DON&#39;T DO THIS.  Use a Roman Numeral module, etc. (since</span>
<span class="c"># you need one anyway to calculate values)</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">r&quot;^m*(d?c{0,3}|c[dm])(l?x{0,3}|x[lc])(v?i{0,3}|i[vx])$&quot;</span>
<span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="s">&quot;mcmlxcvii&quot;</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;one two three four five&quot;</span>

<span class="c"># If the words are cleanly delimited just split and rejoin:</span>
<span class="n">word1</span><span class="p">,</span> <span class="n">word2</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">word2</span><span class="p">,</span> <span class="n">word1</span><span class="p">,</span> <span class="n">rest</span><span class="p">])</span>

<span class="c"># Otherwise:</span>
<span class="n">frompat</span> <span class="o">=</span> <span class="s">r&quot;(\S+)(\s+)(\S+)&quot;</span>
<span class="n">topat</span> <span class="o">=</span>  <span class="s">r&quot;\3\2\1&quot;</span>
<span class="k">print</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">frompat</span><span class="p">,</span> <span class="n">topat</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>

<span class="c">##-----------------------------</span>
<span class="k">print</span> <span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;=&quot;</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">r&quot;(\w+)\s*=\s*(.*)\s*$&quot;</span>
<span class="k">print</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="s">&quot;key=val&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="n">line</span> <span class="o">=</span> <span class="s">&quot;such a very very very very very very very very very very very very very long line&quot;</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
    <span class="n">process</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">&quot;.{80,}&quot;</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
    <span class="n">process</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s">&quot;12/11/05 12:34:56&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">/%m/%y %H:%M:%S&quot;</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">r&quot;(\d+)/(\d+)/(\d+) (\d+):(\d+):(\d+)&quot;</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="s">&quot;12/11/05 12:34:56&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;/usr/bin/python&quot;</span>
<span class="k">print</span> <span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;/usr/bin&quot;</span><span class="p">,</span> <span class="s">&quot;/usr/local/bin&quot;</span><span class="p">)</span>
<span class="c"># Alternatively for file operations use os.path, shutil, etc.</span>

<span class="c"># DON&#39;T DO THIS</span>
<span class="k">print</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;/usr/bin&quot;</span><span class="p">,</span> <span class="s">&quot;/usr/local/bin&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">unescape_hex</span><span class="p">(</span><span class="n">matchobj</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">matchobj</span><span class="o">.</span><span class="n">groups</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">16</span><span class="p">))</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;%([0-9A-Fa-f][0-9A-Fa-f])&quot;</span><span class="p">,</span> <span class="n">unescape_hex</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>

<span class="c"># Assuming that the hex escaping is well-behaved, an alternative is:</span>
<span class="k">def</span> <span class="nf">unescape_hex</span><span class="p">(</span><span class="n">seg</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">seg</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="mi">16</span><span class="p">))</span> <span class="o">+</span> <span class="n">seg</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>

<span class="n">segs</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;%&quot;</span><span class="p">)</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">segs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unescape_hex</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span> <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">segs</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="c">##-----------------------------</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;</span>
<span class="s">             /\*                    # Match the opening delimiter</span>
<span class="s">             .*?                    # Match a minimal number of characters</span>
<span class="s">             \*/                    # Match the closing delimiter</span>
<span class="s">             &quot;&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">txt</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="c"># DON&#39;T DO THIS</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;^\s+&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;\s+$&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;^.*::&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="n">socket</span><span class="o">.</span><span class="n">inet_aton</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="c"># Will raise an error if incorrect</span>

<span class="c"># DON&#39;T DO THIS.</span>
<span class="n">octseg</span> <span class="o">=</span><span class="s">r&quot;([01]?\d\d|2[0-4]\d|25[0-5])&quot;</span>
<span class="n">dot</span> <span class="o">=</span> <span class="s">r&quot;\.&quot;</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">&quot;^&quot;</span> <span class="o">+</span> <span class="n">octseg</span> <span class="o">+</span> <span class="n">dot</span> <span class="o">+</span> <span class="n">octseg</span> <span class="o">+</span> <span class="n">dot</span> <span class="o">+</span> <span class="n">octseg</span> <span class="o">+</span> <span class="n">dot</span> <span class="o">+</span> <span class="n">octseg</span> <span class="o">+</span> <span class="s">&quot;$&quot;</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>
   <span class="k">raise</span> <span class="ne">ValueError</span>

<span class="c"># Defitely DON&#39;T DO THIS.</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;^([01]?\d\d|2[0-4]\d|25[0-5])\.([01]?\d\d|2[0-4]\d|25[0-5])\.</span>
<span class="s">          ([01]?\d\d|2[0-4]\d|25[0-5])\.([01]?\d\d|2[0-4]\d|25[0-5])$&quot;&quot;&quot;</span>
<span class="c">##-----------------------------</span>
<span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS.</span>
<span class="n">fname</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;^.*/&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">tc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;TERMCAP&quot;</span><span class="p">]</span>
<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="mi">80</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;:co#(\d+):&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="c"># (not quite equivalent to the Perl version)</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c"># DON&#39;T DO THIS.</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;^.*/&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c">##-----------------------------</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="s">&quot;linux&quot;</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s">&quot;This isn&#39;t Linux&quot;</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;\n\s+&quot;</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>

<span class="c"># In many cases you could just use:</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">nums</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;\d+\.?\d*|\.\d+&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="c"># If the words are clearly delimited just use:</span>
<span class="n">capwords</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">isupper</span><span class="p">()]</span>

<span class="c"># Otherwise</span>
<span class="n">capwords</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;\b(\S+)\b&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span> <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">isupper</span><span class="p">()]</span>

<span class="c"># (probably) DON&#39;T DO THIS. </span>
<span class="n">capwords</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(\b[^\Wa-z0-9_]+\b)&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="c"># If the words are clearly delimited just use:</span>
<span class="n">lowords</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">islower</span><span class="p">()]</span>

<span class="c"># Otherwise</span>
<span class="n">lowords</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;\b(\S+)\b&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span> <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">islower</span><span class="p">()]</span>

<span class="c"># (probably) DON&#39;T DO THIS. </span>
<span class="n">lowords</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(\b[^\WA-Z0-9_]+\b)&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="c"># If the words are clearly delimited just use:</span>
<span class="n">icwords</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">istitle</span><span class="p">()]</span>

<span class="c"># Otherwise</span>
<span class="n">icwords</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s">r&quot;\b(\S+)\b&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">istitle</span><span class="p">()]</span>

<span class="c"># DON&#39;T DO THIS. </span>
<span class="n">icwords</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(\b[^\Wa-z0-9_][^\WA-Z0-9_]*\b)&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="c"># DON&#39;T DO THIS - use HTMLParser, etc.</span>
<span class="n">links</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;&lt;A[^&gt;]+?HREF\s*=\s*[&quot;&#39;]?([^&#39;&quot; &gt;]+?)[ &#39;&quot;]?&gt;&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">names</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">initial</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">initial</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

<span class="c"># DON&#39;T DO THIS. </span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">&quot;^\S+\s+(\S)\S*\s+\S&quot;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">initial</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="n">initial</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
<span class="c">##-----------------------------</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;&quot;([^&quot;]*)&quot;&#39;</span><span class="p">,</span> <span class="s">&quot;``</span><span class="se">\1</span><span class="s">&#39;&#39;&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(.*?[!?.])(  |\Z)&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)]</span>
<span class="c">##-----------------------------</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS.</span>
<span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;(\d{4})-(\d\d)-(\d\d)&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="c">##-----------------------------</span>
<span class="n">pat</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;</span>
<span class="s">      ^</span>
<span class="s">      (?:</span>
<span class="s">       1 \s (?: \d\d\d \s)?            # 1, or 1 and area code</span>
<span class="s">       |                               # ... or ...</span>
<span class="s">       \(\d\d\d\) \s                   # area code with parens</span>
<span class="s">       |                               # ... or ...</span>
<span class="s">       (?: \+\d\d?\d? \s)?             # optional +country code</span>
<span class="s">       \d\d\d ([\s\-])                 # and area code</span>
<span class="s">      )</span>
<span class="s">      \d\d\d (\s|\1)                   # prefix (and area code separator)</span>
<span class="s">      \d\d\d\d                         # exchange</span>
<span class="s">        $</span>
<span class="s">      &quot;&quot;&quot;</span>
<span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;\boh\s+my\s+gh?o(d(dess(es)?|s?)|odness|sh)\b&quot;</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
<span class="c">##-----------------------------</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&quot;Ur&quot;</span><span class="p">):</span>          <span class="c">#Universal newlines</span>
    <span class="n">process</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS</span>
<span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;^([^\012\015]*)(\012\015?|\015\012?)&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> 
         <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">(</span><span class="n">fname</span><span class="p">)]</span>
<span class="c">##-----------------------------</span>


<span class="c"># @@PLEAC@@_7.0</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;/usr/local/widgets/data&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">blue</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c">#---------</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">re</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;\d&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;No digit found.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Read: &quot;</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c">#---------</span>
<span class="n">logfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;/tmp/log&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
<span class="c">#---------</span>
<span class="n">logfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c">#---------</span>
<span class="k">print</span><span class="o">&gt;&gt;</span><span class="n">logfile</span><span class="p">,</span> <span class="s">&quot;Countdown initiated ...&quot;</span>
<span class="k">print</span> <span class="s">&quot;You have 30 seconds to reach minimum safety distance.&quot;</span>

<span class="c"># DONT DO THIS</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">old_output</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">logfile</span>
<span class="k">print</span> <span class="s">&quot;Countdown initiated ...&quot;</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">old_output</span>
<span class="k">print</span> <span class="s">&quot;You have 30 seconds to reach minimum safety distance.&quot;</span>
<span class="c">#---------</span>

<span class="c"># @@PLEAC@@_7.1</span>
<span class="c"># Python&#39;s open() function somewhat covers both perl&#39;s open() and </span>
<span class="c"># sysopen() as it has optional arguments for mode and buffering.</span>
<span class="n">source</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">sink</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
<span class="c">#---------</span>
<span class="c"># NOTE: almost no one uses the low-level os.open and os.fdopen</span>
<span class="c"># commands, so their inclusion here is just silly.  If </span>
<span class="c"># os.fdopen(os.open(...)) were needed often, it would be turned</span>
<span class="c"># into its own function.  Instead, I&#39;ll use &#39;fd&#39; to hint that</span>
<span class="c"># os.open returns a file descriptor</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">source_fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RDONLY</span><span class="p">)</span>
<span class="n">source</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
<span class="n">sink_fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_WRONLY</span><span class="p">)</span>
<span class="n">sink</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">sink_fd</span><span class="p">)</span>
<span class="c">#---------</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_WRONLY</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span><span class="p">)</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;r+&quot;</span><span class="p">)</span>
<span class="c">#---------</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
<span class="c">#---------</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RDONLY</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_WRONLY</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_TRUNC</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span><span class="p">)</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_WRONLY</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_TRUNC</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span><span class="p">,</span> <span class="mo">0600</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_WRONLY</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_EXCL</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span><span class="p">)</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_WRONLY</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_EXCL</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span><span class="p">,</span> <span class="mo">0600</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_WRONLY</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_APPEND</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span><span class="p">)</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_WRONLY</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_APPEND</span><span class="o">|</span><span class="n">s</span><span class="o">.</span><span class="n">O_CREAT</span><span class="p">,</span> <span class="mo">0600</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_WRONLY</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_APPEND</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;rw&quot;</span><span class="p">)</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RDWR</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RDWR</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span><span class="p">)</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RDWR</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span><span class="p">,</span> <span class="mo">0600</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RDWR</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_EXCL</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span><span class="p">)</span>
<span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RDWR</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_EXCL</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span><span class="p">,</span> <span class="mo">0600</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_7.2</span>
<span class="c"># Nothing different needs to be done with Python</span>

<span class="c"># @@PLEAC@@_7.3</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="c"># @@PLEAC@@_7.4</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>   <span class="c"># raise an exception on error</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">IOError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t open </span><span class="si">%s</span><span class="s"> for reading : </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                         <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">strerror</span><span class="p">))</span>

<span class="c"># @@PLEAC@@_7.5</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="n">myfile</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryFile</span><span class="p">()</span>

<span class="c">#-----------------------------</span>
<span class="c"># NOTE: The TemporaryFile() call is much more appropriate</span>
<span class="c"># I would not suggest using this code for real work.</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">tempfile</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">tmpnam</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RDWR</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">O_EXCL</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="k">except</span> <span class="n">os</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
        <span class="k">pass</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryFileWrapper</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">fd</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span>

<span class="c"># now go on to use the file ...</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">tmpname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">tmpnam</span><span class="p">()</span>
    <span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpnam</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RDWR</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_EXCL</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fd</span><span class="p">:</span>
        <span class="n">tmpfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="k">break</span>

<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tmpnam</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="n">myfile</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryFile</span><span class="p">(</span><span class="n">bufsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="k">print</span><span class="o">&gt;&gt;</span><span class="n">myfile</span><span class="p">,</span> <span class="n">i</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Tmp file has:&quot;</span><span class="p">,</span> <span class="n">myfile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_7.6</span>
<span class="n">DATA</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">your data goes here</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">DATA</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">):</span>
    <span class="k">pass</span> <span class="c"># process the line</span>

<span class="c"># @@PLEAC@@_7.7</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
    <span class="k">pass</span> <span class="c"># do something with the line</span>

<span class="c"># processing a list of files from commandline</span>
<span class="kn">import</span> <span class="nn">fileinput</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
     <span class="n">do</span> <span class="n">something</span> <span class="k">with</span> <span class="n">the</span> <span class="n">line</span>

<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">do_with</span><span class="p">(</span><span class="n">myfile</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">myfile</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">filenames</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="k">if</span> <span class="n">filenames</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">do_with</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Can&#39;t open </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">strerror</span><span class="p">))</span>
            <span class="k">continue</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">do_with</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">glob</span>
<span class="n">ARGV</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">or</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&quot;*.[Cch]&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># NOTE: the getopt module is the prefered mechanism for reading</span>
<span class="c"># command line arguments</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">chop_first</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">if</span> <span class="n">args</span> <span class="ow">and</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;-c&quot;</span><span class="p">:</span>
    <span class="n">chop_first</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c"># arg demo 2: Process optional -NUMBER flag</span>

<span class="c"># NOTE: You just wouldn&#39;t process things this way for Python,</span>
<span class="c"># but I&#39;m trying to preserve the same semantics.</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">re</span>
<span class="n">digit_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;-(\d+)$&quot;</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="k">if</span> <span class="n">args</span><span class="p">:</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">digit_pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c"># NOTE: here&#39;s the more idiomatic way, which also checks</span>
<span class="c"># for the &quot;--&quot; or a non &quot;-&quot; argument to stop processing</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)):</span>
    <span class="n">arg</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">arg</span> <span class="o">==</span> <span class="s">&quot;--&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">arg</span><span class="o">.</span><span class="n">startwith</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">):</span>
        <span class="k">break</span>
    <span class="k">if</span> <span class="n">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">continue</span>



<span class="c"># arg demo 3: Process clustering -a, -i, -n, or -u flags</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">getopt</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">args</span><span class="p">,</span> <span class="n">filenames</span> <span class="o">=</span> <span class="n">getopt</span><span class="o">.</span><span class="n">getopt</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s">&quot;ainu&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">getopt</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s">&quot;usage: </span><span class="si">%s</span><span class="s"> [-ainu] [filenames] ...&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">append</span> <span class="o">=</span> <span class="n">ignore_ints</span> <span class="o">=</span> <span class="n">nostdout</span> <span class="o">=</span> <span class="n">unbuffer</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s">&quot;-a&quot;</span><span class="p">:</span> <span class="n">append</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s">&quot;-i&quot;</span><span class="p">:</span> <span class="n">ignore_ints</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s">&quot;-n&quot;</span><span class="p">:</span> <span class="n">nostdout</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s">&quot;-u&quot;</span><span class="p">:</span> <span class="n">unbuffer</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&quot;Unexpected argument: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="c"># Note: Idiomatic Perl get translated to idiomatic Python</span>
<span class="kn">import</span> <span class="nn">fileinput</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                     <span class="p">(</span><span class="n">fileinput</span><span class="o">.</span><span class="n">filename</span><span class="p">(),</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">filelineno</span><span class="p">(),</span> <span class="n">line</span><span class="p">))</span>
<span class="c">#-----------------------------</span>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># findlogin1 - print all lines containing the string &quot;login&quot;</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span> <span class="c"># loop over files on command line</span>
    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;login&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># lowercase - turn all lines into lowercase</span>
<span class="c">### NOTE: I don&#39;t know how to do locales in Python</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span> <span class="c"># loop over files on command line</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

<span class="c">#-----------------------------</span>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># NOTE: The Perl code appears buggy, in that &quot;Q__END__W&quot; is considered</span>
<span class="c">#       to be a __END__ and words after the __END__ on the same line</span>
<span class="c">#       are included in the count!!!</span>
<span class="c"># countchunks - count how many words are used.</span>
<span class="c"># skip comments, and bail on file if __END__</span>
<span class="c"># or __DATA__ seen.</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;#&quot;</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;__DATA__&quot;</span><span class="p">,</span> <span class="s">&quot;__END__&quot;</span><span class="p">):</span>
            <span class="n">fileinput</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">break</span>
        <span class="n">chunks</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">print</span> <span class="s">&quot;Found&quot;</span><span class="p">,</span> <span class="n">chunks</span><span class="p">,</span> <span class="s">&quot;chunks&quot;</span>


<span class="c"># @@PLEAC@@_7.8</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="n">old</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;old&quot;</span><span class="p">)</span>
<span class="n">new</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;new&quot;</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">old</span><span class="p">:</span>
    <span class="n">new</span><span class="o">.</span><span class="n">writeline</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="n">new</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">old</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="s">&quot;old&quot;</span><span class="p">,</span> <span class="s">&quot;old.orig&quot;</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="s">&quot;new&quot;</span><span class="p">,</span> <span class="s">&quot;old&quot;</span><span class="p">)</span>

<span class="c"># insert lines at line 20:</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">old</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">20</span><span class="p">:</span>
        <span class="k">print</span><span class="o">&gt;&gt;</span><span class="n">new</span><span class="p">,</span> <span class="s">&quot;Extra line 1</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">print</span><span class="o">&gt;&gt;</span><span class="n">new</span><span class="p">,</span> <span class="s">&quot;Extra line 2</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="k">print</span><span class="o">&gt;&gt;</span><span class="n">new</span><span class="p">,</span> <span class="n">line</span>


<span class="c"># or delete lines 20 through 30:</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">old</span><span class="p">):</span>
    <span class="k">if</span> <span class="mi">20</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">print</span><span class="o">&gt;&gt;</span><span class="n">new</span><span class="p">,</span> <span class="n">line</span>


<span class="c"># @@PLEAC@@_7.9</span>
<span class="c"># modifying with &quot;-i&quot; commandline switch is a perl feature</span>
<span class="c"># python has fileinput</span>
<span class="kn">import</span> <span class="nn">fileinput</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">time</span>
<span class="n">today</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">,</span><span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">())</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="s">&quot;.orig&quot;</span><span class="p">):</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;DATE&quot;</span><span class="p">,</span><span class="n">today</span><span class="p">))</span>

<span class="c"># set up to iterate over the *.c files in the current directory,</span>
<span class="c"># editing in place and saving the old file with a .orig extension.</span>
<span class="kn">import</span> <span class="nn">glob</span><span class="o">,</span> <span class="nn">re</span>
<span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;(?&lt;=[pP])earl&quot;</span><span class="p">)</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">FileInput</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&quot;*.c&quot;</span><span class="p">),</span> <span class="n">inplace</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">backup</span><span class="o">=</span><span class="s">&quot;.orig&quot;</span><span class="p">)</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="k">if</span> <span class="n">files</span><span class="o">.</span><span class="n">isfirstline</span><span class="p">():</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;This line should appear at the top of each file</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;erl&quot;</span><span class="p">,</span><span class="n">line</span><span class="p">))</span>


<span class="c"># @@PLEAC@@_7.10</span>
<span class="c">#-----------------------------</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;r+&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">myfile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="c"># change data here</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">myfile</span><span class="o">.</span><span class="n">tell</span><span class="p">())</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;r+&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">process</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">myfile</span><span class="p">]</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">myfile</span><span class="o">.</span><span class="n">tell</span><span class="p">())</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_7.11</span>
                                                                                                                                                                                                                                                               
<span class="kn">import</span> <span class="nn">fcntl</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">somepath</span><span class="p">,</span> <span class="s">&#39;r+&#39;</span><span class="p">)</span>
<span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">myfile</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_EX</span><span class="p">)</span>
<span class="c"># update file, then...</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_SH</span>
<span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_EX</span>
<span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_NB</span>
<span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_UN</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">myfile</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_EX</span><span class="o">|</span><span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_NB</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;can&#39;t immediately write-lock the file ($!), blocking ...&quot;</span><span class="p">)</span>
    <span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">myfile</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_EX</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">myfile</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_UN</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># option &quot;r+&quot; instead &quot;w+&quot; stops python from truncating the file on opening</span>
<span class="c"># when another process might well hold an advisory exclusive lock on it.</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">somepath</span><span class="p">,</span> <span class="s">&quot;r+&quot;</span><span class="p">)</span>
<span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">myfile</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_EX</span><span class="p">)</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">print</span><span class="o">&gt;&gt;</span><span class="n">myfile</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>   <span class="c"># or myfile.write(&quot;\n&quot;)</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_7.12</span>
<span class="c"># Python doesn&#39;t have command buffering.  Files can have buffering set,</span>
<span class="c"># when opened:</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="n">buffering</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>   <span class="c">#Unbuffered</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="n">buffering</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>   <span class="c">#Line buffered</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="n">buffering</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span> <span class="c">#Use buffer of (approx) 100 bytes</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="n">buffering</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c">#Use system default</span>

<span class="n">myfile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>  <span class="c"># Flush the I/O buffer</span>

<span class="c"># stdout is treated as a file.  If you ever need to flush it, do so:</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="c"># DON&#39;T DO THIS.  Use urllib, etc.</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="n">mysock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>
<span class="n">mysock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">&#39;www.perl.com&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>
<span class="c"># mysock.setblocking(True)</span>
<span class="n">mysock</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;GET /index.html http/1.1</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">mysock</span><span class="o">.</span><span class="n">makefile</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;Doc is:&quot;</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c"># @@PLEAC@@_7.13</span>
<span class="kn">import</span> <span class="nn">select</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">rlist</span><span class="p">,</span> <span class="n">wlist</span><span class="p">,</span> <span class="n">xlist</span> <span class="o">=</span> <span class="n">select</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">file1</span><span class="p">,</span> <span class="n">file2</span><span class="p">,</span> <span class="n">file3</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rlist</span><span class="p">:</span>
        <span class="k">pass</span> <span class="c"># Do something with the file handle</span>

<span class="c"># @@PLEAC@@_7.14</span>
<span class="c"># @@SKIP@@ Use select.poll() on Unix systems.</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_7.15</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_7.16</span>
<span class="c"># NOTE: this is all much easier in Python</span>
<span class="k">def</span> <span class="nf">subroutine</span><span class="p">(</span><span class="n">myfile</span><span class="p">):</span>
    <span class="k">print</span><span class="o">&gt;&gt;</span><span class="n">myfile</span><span class="p">,</span> <span class="s">&quot;Hello, file&quot;</span>

<span class="n">variable</span> <span class="o">=</span> <span class="n">myfile</span>
<span class="n">subroutine</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>

<span class="c"># @@PLEAC@@_7.17</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_7.18</span>
<span class="k">for</span> <span class="n">myfile</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="k">print</span><span class="o">&gt;&gt;</span><span class="n">myfile</span><span class="p">,</span> <span class="n">stuff_to_print</span>

<span class="c"># NOTE: This is unix specific</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="nb">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;tee file1 file2 file3 &gt;/dev/null&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="o">&gt;&gt;</span><span class="n">myfile</span><span class="p">,</span> <span class="s">&quot;whatever&quot;</span>

<span class="c"># NOTE: the &quot;make STDOUT go to three files&quot; is bad programming style</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;tee file1 file2 file3&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;whatever&quot;</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># You could use a utility object to redirect writes:</span>
<span class="k">class</span> <span class="nc">FileDispatcher</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">files</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="n">files</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">x</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;C:/test1.txt&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;C:/test2.txt&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;C:/test3.txt&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>

<span class="n">fd</span> <span class="o">=</span> <span class="n">FileDispatcher</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
<span class="k">print</span><span class="o">&gt;&gt;</span><span class="n">fd</span><span class="p">,</span> <span class="s">&quot;Foo&quot;</span>     <span class="c"># equiv to fd.write(&quot;Foo&quot;); fd.write(&quot;\n&quot;)</span>
<span class="k">print</span><span class="o">&gt;&gt;</span><span class="n">fd</span><span class="p">,</span> <span class="s">&quot;Testing&quot;</span>  
<span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># @@PLEAC@@_7.19</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">fdnum</span><span class="p">)</span> <span class="c"># open the descriptor itself</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">dup</span><span class="p">(</span><span class="n">fdnum</span><span class="p">))</span> <span class="c"># open to a copy of the descriptor</span>

<span class="c">###</span>
<span class="n">outcopy</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">dup</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">fileno</span><span class="p">()),</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
<span class="n">incopy</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">dup</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">fileno</span><span class="p">()),</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>

<span class="c"># @@PLEAC@@_7.20</span>
<span class="n">original</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;C:/test.txt&quot;</span><span class="p">)</span>
<span class="n">alias</span> <span class="o">=</span> <span class="n">original</span>
<span class="n">alias</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">print</span> <span class="n">original</span><span class="o">.</span><span class="n">closed</span>
<span class="c">#=&gt;True</span>

<span class="kn">import</span> <span class="nn">copy</span>

<span class="n">original</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;C:/test.txt&quot;</span><span class="p">)</span>
<span class="n">dupe</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">original</span><span class="p">)</span>
<span class="n">dupe</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">print</span> <span class="n">original</span><span class="o">.</span><span class="n">closed</span>
<span class="c">#=&gt;False</span>

<span class="c"># DON&#39;T DO THIS.</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">oldstderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
<span class="n">oldstdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>

<span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;C:/stderrfile.txt&quot;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;C:/stdoutfile.txt&quot;</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;Blah&quot;</span>  <span class="c"># Will be written to C:/stdoutfile.txt</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">oldstdout</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">oldstderr</span>


<span class="c"># @@PLEAC@@_7.21</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_7.22</span>
<span class="c"># On Windows:</span>
<span class="kn">import</span> <span class="nn">msvcrt</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">msvcrt</span><span class="o">.</span><span class="n">locking</span><span class="p">(</span><span class="n">myfile</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="n">msvcrt</span><span class="o">.</span><span class="n">LK_NBLCK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="c"># On Unix:</span>
<span class="kn">import</span> <span class="nn">fcntl</span>
<span class="n">fcntl</span><span class="o">.</span><span class="n">lockf</span><span class="p">(</span><span class="n">myfile</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_EX</span> <span class="o">|</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_NB</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>


<span class="c"># ^^PLEAC^^_8.0</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">DATAFILE</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">size</span>        <span class="c"># output size of line</span>

<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">datafile</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">length</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>     <span class="c"># output size of line</span>
<span class="c">#-----------------------------</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="n">whole_file</span> <span class="o">=</span> <span class="n">myfile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="c">## No direct equivalent in Python</span>
<span class="c">#% perl -040 -e &#39;$word = &lt;&gt;; print &quot;First word is $word\n&quot;;&#39;</span>
<span class="c">#-----------------------------</span>
<span class="c">## No direct equivalent in Python</span>
<span class="c">#% perl -ne &#39;BEGIN { $/=&quot;%%\n&quot; } chomp; print if /Unix/i&#39; fortune.dat</span>
<span class="c">#-----------------------------</span>
<span class="k">print</span><span class="o">&gt;&gt;</span><span class="n">myfile</span><span class="p">,</span> <span class="s">&quot;One&quot;</span><span class="p">,</span> <span class="s">&quot;two&quot;</span><span class="p">,</span> <span class="s">&quot;three&quot;</span>  <span class="c"># &quot;One two three&quot;</span>
<span class="k">print</span> <span class="s">&quot;Baa baa black sheep.&quot;</span>         <span class="c"># Sent to default output file</span>
<span class="c">#-----------------------------</span>
<span class="nb">buffer</span> <span class="o">=</span> <span class="n">myfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
<span class="n">rv</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">buffer</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
<span class="nb">open</span><span class="p">(</span><span class="s">&quot;/tmp/</span><span class="si">%d</span><span class="s">.pid&quot;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span> <span class="s">&quot;a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">myfile</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;I&#39;m&quot;</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;bytes from the start of DATAFILE.&quot;</span>
<span class="c">#-----------------------------</span>
<span class="n">logfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>   <span class="c"># Seek to the end</span>
<span class="n">datafile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>   <span class="c"># Seek to a given byte</span>
<span class="n">outfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c"># Seek back 20 bytes</span>
<span class="c">#-----------------------------</span>
<span class="n">written</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">datafile</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="n">mystr</span><span class="p">)</span>
<span class="k">if</span> <span class="n">written</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mystr</span><span class="p">):</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;only read </span><span class="si">%s</span><span class="s"> bytes, not </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">written</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mystr</span><span class="p">)))</span>
<span class="c">#-----------------------------</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">lseek</span><span class="p">(</span><span class="n">myfile</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>       <span class="c"># don&#39;t change position</span>
<span class="c">#-----------------------------</span>

 
<span class="c"># ^^PLEAC^^_8.1</span>
<span class="k">def</span> <span class="nf">ContReader</span><span class="p">(</span><span class="n">infile</span><span class="p">):</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">):</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">continue</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">yield</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">yield</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">ContReader</span><span class="p">(</span><span class="n">datafile</span><span class="p">):</span>
    <span class="k">pass</span> <span class="c"># process full record in &#39;line&#39; here</span>

<span class="c"># ^^PLEAC^^_8.2</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;wc -l &lt; &quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)):</span>
    <span class="k">pass</span>
<span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c"># indexing is zero based</span>
<span class="c">#-----------------------------</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">myfile</span><span class="p">:</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="c"># &#39;count&#39; now holds the number of lines read</span>
<span class="c">#-----------------------------</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">myfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="c">#-----------------------------</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">myfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxint</span><span class="p">)):</span>
    <span class="k">pass</span>
<span class="c"># &#39;count&#39; now holds the number of lines read</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">fileinput</span>
<span class="n">fi</span> <span class="o">=</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">FileInput</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="k">while</span> <span class="n">fi</span><span class="o">.</span><span class="n">readline</span><span class="p">():</span> <span class="k">pass</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">fi</span><span class="o">.</span><span class="n">lineno</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">SepReader</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">yield</span> <span class="n">field</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">new_text</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">new_text</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">text</span>
            <span class="k">break</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="n">new_text</span>

<span class="n">para_count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="n">SepReader</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)):</span>
    <span class="n">para_count</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="c"># FIXME: For my test case (Python-pre2.2 README from CVS) this</span>
<span class="c"># returns 175 paragraphs while Perl returns 174.</span>
<span class="c">#-----------------------------</span>

 
<span class="c"># ^^PLEAC^^_8.3</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="k">pass</span> <span class="c"># do something with &#39;chunk&#39;</span>
<span class="c">#-----------------------------</span>
<span class="n">pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;(\w[\w&#39;-]*)&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pat</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c"># do something with match.group(1)</span>

<span class="c"># EXPERIMENTAL in the sre implementation but</span>
<span class="c"># likely to be included in future (post-2.2) releases.</span>
<span class="n">pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;(\w[\w&#39;-]*)&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
    <span class="n">scanner</span> <span class="o">=</span> <span class="n">pat</span><span class="o">.</span><span class="n">scanner</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">search</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="c"># do something with match.group(1)</span>


<span class="c">#-----------------------------</span>
<span class="c"># Make a word frequency count</span>
<span class="kn">import</span> <span class="nn">fileinput</span><span class="o">,</span> <span class="nn">re</span>
<span class="n">pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;(\w[\w&#39;-]*)&quot;</span><span class="p">)</span>
<span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pat</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">seen</span><span class="p">[</span><span class="n">text</span><span class="p">]</span> <span class="o">=</span> <span class="n">seen</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c"># output dict in a descending numeric sort of its values</span>
<span class="k">for</span> <span class="n">text</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">seen</span><span class="o">.</span><span class="n">items</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%5d</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="c"># Line frequency count</span>
<span class="kn">import</span> <span class="nn">fileinput</span><span class="o">,</span> <span class="nn">sys</span>
<span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">seen</span><span class="p">[</span><span class="n">text</span><span class="p">]</span> <span class="o">=</span> <span class="n">seen</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">text</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">seen</span><span class="o">.</span><span class="n">items</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%5d</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>

<span class="c">#-----------------------------</span>

 
<span class="c"># ^^PLEAC^^_8.4</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">myfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="k">while</span> <span class="n">lines</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="c"># do something with &#39;line&#39;</span>

<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">myfile</span><span class="p">):</span>
    <span class="k">pass</span>  <span class="c"># do something with line</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">SepReader</span><span class="p">(</span><span class="n">infile</span><span class="p">)):</span>
    <span class="k">pass</span> <span class="c"># do something</span>
<span class="c">#-----------------------------</span>

 

<span class="c"># ^^PLEAC^^_8.5</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
        <span class="k">pass</span> <span class="c"># do something with the line</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SOMETIME</span><span class="p">)</span>
    <span class="n">infile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="n">naptime</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">logfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;/tmp/logfile&quot;</span><span class="p">)</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">logfile</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">naptime</span><span class="p">)</span>
    <span class="n">infile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">curpos</span> <span class="o">=</span> <span class="n">logfile</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">logfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">curpos</span> <span class="o">=</span> <span class="n">logfile</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
    <span class="n">sleep</span><span class="p">(</span><span class="n">naptime</span><span class="p">)</span>
    <span class="n">logfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">curpos</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c"># seek to where we had been</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">LOGFILENAME</span><span class="p">)</span><span class="o">.</span><span class="n">st_nlink</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span>
<span class="c">#-----------------------------</span>

 
<span class="c"># ^^PLEAC^^_8.6</span>
<span class="kn">import</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">fileinput</span>
<span class="n">text</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">input</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">fileinput</span><span class="o">.</span><span class="n">lineno</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">line</span>
<span class="c"># &#39;text&#39; is the random line</span>
<span class="c">#-----------------------------</span>
<span class="c"># XXX is the perl code correct?  Where is the fortunes file opened?</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">adage</span> <span class="o">=</span> <span class="bp">None</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">SepReader</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&quot;/usr/share/games/fortunes&quot;</span><span class="p">),</span> <span class="s">&quot;%</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">adage</span> <span class="o">=</span> <span class="n">rec</span>
<span class="k">print</span> <span class="n">adage</span>
<span class="c">#-----------------------------</span>

 
<span class="c"># ^^PLEAC^^_8.7</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
<span class="c">#-----------------------------</span>

 

<span class="c"># ^^PLEAC^^_8.8</span>
<span class="c"># using efficient caching system</span>
<span class="kn">import</span> <span class="nn">linecache</span>
<span class="n">linecache</span><span class="o">.</span><span class="n">getline</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">DESIRED_LINE_NUMBER</span><span class="p">)</span>

<span class="c"># or doing it more oldskool</span>
<span class="n">lineno</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span> <span class="ow">or</span> <span class="n">lineno</span> <span class="o">==</span> <span class="n">DESIRED_LINE_NUMBER</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">lineno</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="c">#-----------------------------</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">DESIRED_LINE_NUMBER</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DESIRED_LINE_NUMBER</span><span class="p">):</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">break</span>
<span class="c">#-----------------------------</span>

<span class="c">## Not sure what this thing is doing.  Allow fast access to a given</span>
<span class="c">## line number?</span>

<span class="c"># usage: build_index(*DATA_HANDLE, *INDEX_HANDLE)</span>

<span class="c"># ^^PLEAC^^_8.9</span>
<span class="c"># given $RECORD with field separated by PATTERN,</span>
<span class="c"># extract @FIELDS.</span>
<span class="n">fields</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">pattern_string</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern_string</span><span class="p">)</span>
<span class="n">fields</span> <span class="o">=</span> <span class="n">pat</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&quot;([+-])&quot;</span><span class="p">,</span> <span class="s">&quot;3+5-2&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="n">fields</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">fields</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&quot;:&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">fields</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&quot;\s+&quot;</span><span class="p">,</span> <span class="n">record</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">fields</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

 
<span class="c"># ^^PLEAC^^_8.10</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>
<span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">myfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">pos</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">myfile</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">prev_pos</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

 

<span class="c"># ^^PLEAC^^_8.11</span>
<span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span>
<span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">gifname</span> <span class="o">=</span> <span class="s">&quot;picture.gif&quot;</span>
<span class="n">gif_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">gifname</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span>

<span class="c"># Don&#39;t think there&#39;s an equivalent for these in Python</span>
<span class="c">#binmode(GIF);               # now DOS won&#39;t mangle binary input from GIF</span>
<span class="c">#binmode(STDOUT);            # now DOS won&#39;t mangle binary output to STDOUT</span>

<span class="c">#-----------------------------</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">buff</span> <span class="o">=</span> <span class="n">gif</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">buff</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

 

<span class="c"># ^^PLEAC^^_8.12</span>
<span class="n">address</span> <span class="o">=</span> <span class="n">recsize</span> <span class="o">*</span> <span class="n">recno</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">buffer</span> <span class="o">=</span> <span class="n">myfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">recsize</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">address</span> <span class="o">=</span> <span class="n">recsize</span> <span class="o">*</span> <span class="p">(</span><span class="n">recno</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

 

<span class="c"># ^^PLEAC^^_8.13</span>
<span class="kn">import</span> <span class="nn">posixfile</span>
<span class="n">address</span> <span class="o">=</span> <span class="n">recsize</span> <span class="o">*</span> <span class="n">recno</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
<span class="nb">buffer</span> <span class="o">=</span> <span class="n">myfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">recsize</span><span class="p">)</span>
<span class="c"># ... work with the buffer, then turn it back into a string and ...</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="o">-</span><span class="n">recsize</span><span class="p">,</span> <span class="n">posixfile</span><span class="o">.</span><span class="n">SEEK_CUR</span><span class="p">)</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">buffer</span><span class="p">)</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="c">## Not yet implemented</span>
<span class="c"># weekearly -- set someone&#39;s login date back a week</span>
<span class="c"># @@INCOMPLETE@@</span>


<span class="c"># ^^PLEAC^^_8.14</span>
<span class="c">## Note: this isn&#39;t optimal -- the &#39;s+=c&#39; may go O(N**2) so don&#39;t</span>
<span class="c">## use for large strings.</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;</span><span class="se">\0</span><span class="s">&quot;</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">c</span>
<span class="c">#-----------------------------</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
<span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">myfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\0</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">offset</span> <span class="o">+=</span> <span class="n">x</span>
        <span class="k">break</span>
    <span class="n">offset</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1000</span><span class="p">:</span>  <span class="c"># EOF</span>
        <span class="k">break</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">myfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">offset</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">myfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="c">## Not Implemented</span>
<span class="c"># bgets - get a string from an address in a binary file</span>
<span class="c">#-----------------------------</span>
<span class="c">#!/usr/bin/perl</span>
<span class="c"># strings - pull strings out of a binary file</span>
<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">sys</span>

<span class="c">## Assumes SepReader from above</span>

<span class="n">pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;([\040-\176\s]{4,})&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">SepReader</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\0</span><span class="s">&quot;</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pat</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">print</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
 

<span class="c"># @@PLEAC@@_8.15</span>

<span class="c"># RECORDSIZE is the length of a record, in bytes.</span>
<span class="c"># TEMPLATE is the unpack template for the record</span>
<span class="c"># FILE is the file to read from</span>
<span class="c"># FIELDS is a tuple, one element per field</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="n">RECORDSIZE</span><span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">TEMPLATE</span><span class="p">)</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">record</span> <span class="o">=</span> <span class="n">FILE</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">RECORDSIZE</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span><span class="o">!=</span><span class="n">RECORDSIZE</span><span class="p">:</span>
        <span class="k">raise</span> <span class="s">&quot;short read&quot;</span>
    <span class="n">FIELDS</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">TEMPLATE</span><span class="p">,</span> <span class="n">record</span><span class="p">)</span>
<span class="c"># ----</span>


<span class="c"># ^^PLEAC^^_8.16</span>
<span class="c"># NOTE: to parse INI file, see the stanard ConfigParser module.</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;\s*=\s*&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">config_file</span><span class="p">:</span>
    <span class="k">if</span> <span class="s">&quot;#&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>         <span class="c"># no comments</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">line</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&quot;#&quot;</span><span class="p">)]</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>     <span class="c"># no leading or trailing white</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>            <span class="c"># anything left?</span>
        <span class="k">continue</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">pat</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">():]</span>
    <span class="n">User_Preferences</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>


<span class="c"># ^^PLEAC^^_8.17</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">mode</span><span class="p">,</span> <span class="n">ino</span><span class="p">,</span> <span class="n">dev</span><span class="p">,</span> <span class="n">nlink</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> \
<span class="n">atime</span><span class="p">,</span> <span class="n">mtime</span><span class="p">,</span> <span class="n">ctime</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="n">mode</span> <span class="o">&amp;=</span> <span class="mo">07777</span>               <span class="c"># discard file type info</span>

<span class="c">#-----------------------------</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">st_uid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Superuser owns&quot;</span><span class="p">,</span> <span class="n">filename</span>
<span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">st_atime</span> <span class="o">&gt;</span> <span class="n">info</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">filename</span><span class="p">,</span> <span class="s">&quot;has been read since it was written.&quot;</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">def</span> <span class="nf">is_safe</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="c"># owner neither superuser nor me </span>
    <span class="c"># the real uid is in stored in the $&lt; variable</span>
    <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">st_uid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getuid</span><span class="p">()):</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="c"># check whether group or other can write file.</span>
    <span class="c"># use 066 to detect either reading or writing</span>
    <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="mo">022</span><span class="p">:</span>  <span class="c"># someone else can write this</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>  <span class="c"># non-directories aren&#39;t safe</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="c"># but directories with the sticky bit (01000) are</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="mo">01000</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>
<span class="c">#-----------------------------</span>
<span class="c">## XXX What is &#39;_PC_CHOWN_RESTRICTED&#39;?</span>

<span class="k">def</span> <span class="nf">is_verysafe</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">path</span><span class="p">,</span> <span class="n">ending</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ending</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">terms</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ending</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">term</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_safe</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>
<span class="c">#-----------------------------</span>

<span class="c"># Program: tctee</span>
<span class="c"># Not Implemented (requires reimplementing Perl&#39;s builtin &#39;&gt;&gt;&#39;, &#39;|&#39;,</span>
<span class="c"># etc. semantics)</span>

<span class="c"># @@PLEAC@@_8.18</span>
<span class="c">#!/usr/bin/python</span>
<span class="c"># tailwtmp - watch for logins and logouts;</span>
<span class="c"># uses linux utmp structure, from /usr/include/bits/utmp.h</span>

<span class="c"># /* The structure describing an entry in the user accounting database.  */</span>
<span class="c"># struct utmp</span>
<span class="c"># {</span>
<span class="c">#   short int ut_type;            /* Type of login.  */</span>
<span class="c">#   pid_t ut_pid;                 /* Process ID of login process.  */</span>
<span class="c">#   char ut_line[UT_LINESIZE];    /* Devicename.  */</span>
<span class="c">#   char ut_id[4];                /* Inittab ID.  */</span>
<span class="c">#   char ut_user[UT_NAMESIZE];    /* Username.  */</span>
<span class="c">#   char ut_host[UT_HOSTSIZE];    /* Hostname for remote login.  */</span>
<span class="c">#   struct exit_status ut_exit;   /* Exit status of a process marked</span>
<span class="c">#                                    as DEAD_PROCESS.  */</span>
<span class="c">#   long int ut_session;          /* Session ID, used for windowing.  */</span>
<span class="c">#   struct timeval ut_tv;         /* Time entry was made.  */</span>
<span class="c">#   int32_t ut_addr_v6[4];        /* Internet address of remote host.  */</span>
<span class="c">#   char __unused[20];            /* Reserved for future use.  */</span>
<span class="c"># };</span>

<span class="c"># /* Values for the `ut_type&#39; field of a `struct utmp&#39;.  */</span>
<span class="c"># #define EMPTY       0   /* No valid user accounting information.  */</span>
<span class="c"># </span>
<span class="c"># #define RUN_LVL     1   /* The system&#39;s runlevel.  */</span>
<span class="c"># #define BOOT_TIME   2   /* Time of system boot.  */</span>
<span class="c"># #define NEW_TIME    3   /* Time after system clock changed.  */</span>
<span class="c"># #define OLD_TIME    4   /* Time when system clock changed.  */</span>
<span class="c"># </span>
<span class="c"># #define INIT_PROCESS    5   /* Process spawned by the init process.  */</span>
<span class="c"># #define LOGIN_PROCESS   6   /* Session leader of a logged in user.  */</span>
<span class="c"># #define USER_PROCESS    7   /* Normal process.  */</span>
<span class="c"># #define DEAD_PROCESS    8   /* Terminated process.  */</span>
<span class="c"># </span>
<span class="c"># #define ACCOUNTING  9</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">class</span> <span class="nc">WTmpRecord</span><span class="p">:</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s">&quot;hI32s4s32s256siili4l20s&quot;</span><span class="p">;</span>
    <span class="n">_fieldnames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;type&quot;</span><span class="p">,</span><span class="s">&quot;PID&quot;</span><span class="p">,</span><span class="s">&quot;Line&quot;</span><span class="p">,</span><span class="s">&quot;inittab&quot;</span><span class="p">,</span><span class="s">&quot;User&quot;</span><span class="p">,</span><span class="s">&quot;Hostname&quot;</span><span class="p">,</span>
                    <span class="s">&quot;exit_status&quot;</span><span class="p">,</span> <span class="s">&quot;session&quot;</span><span class="p">,</span> <span class="s">&quot;time&quot;</span><span class="p">,</span> <span class="s">&quot;addr&quot;</span> <span class="p">]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rec_size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rec_size</span>
    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bin_data</span><span class="p">):</span>
        <span class="n">rec</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">,</span> <span class="n">bin_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rec</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rec</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
                <span class="c"># remove character zeros from strings</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\0</span><span class="s">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rec</span>
    <span class="k">def</span> <span class="nf">fieldnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fieldnames</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rec</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_fieldnames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span>
        
<span class="n">rec</span> <span class="o">=</span> <span class="n">WTmpRecord</span><span class="p">()</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;/var/log/wtmp&quot;</span><span class="p">,</span><span class="s">&quot;rb&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="nb">bin</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">bin</span><span class="p">)</span> <span class="o">!=</span> <span class="n">rec</span><span class="o">.</span><span class="n">size</span><span class="p">():</span>
            <span class="k">break</span>
        <span class="n">rec</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="nb">bin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot; </span><span class="si">%1d</span><span class="s"> </span><span class="si">%-8s</span><span class="s"> </span><span class="si">%-12s</span><span class="s"> </span><span class="si">%-24s</span><span class="s"> </span><span class="si">%-20s</span><span class="s"> </span><span class="si">%5d</span><span class="s"> </span><span class="si">%08x</span><span class="s">&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">rec</span><span class="o">.</span><span class="n">User</span><span class="p">,</span> <span class="n">rec</span><span class="o">.</span><span class="n">Line</span><span class="p">,</span> 
                 <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%a %Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&quot;</span><span class="p">,</span><span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">time</span><span class="p">)),</span>
                 <span class="n">rec</span><span class="o">.</span><span class="n">Hostname</span><span class="p">,</span> <span class="n">rec</span><span class="o">.</span><span class="n">PID</span><span class="p">,</span> <span class="n">rec</span><span class="o">.</span><span class="n">addr</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># @@PLEAC@@_8.19</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_8.20</span>
<span class="c">#!/usr/bin/python</span>
<span class="c"># laston - find out when given user last logged on</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">pwd</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;/var/log/lastlog&quot;</span><span class="p">,</span><span class="s">&quot;rb&quot;</span><span class="p">)</span>

<span class="n">fmt</span> <span class="o">=</span> <span class="s">&quot;L32s256s&quot;</span>
<span class="n">rec_size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>

<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&quot;^\d+$&quot;</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user_id</span> <span class="o">=</span> <span class="n">pwd</span><span class="o">.</span><span class="n">getpwnam</span><span class="p">(</span><span class="n">user</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;no such uid </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">user</span><span class="p">)</span>
            <span class="k">continue</span>
    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">rec_size</span> <span class="o">*</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="nb">bin</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">rec_size</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">bin</span><span class="p">)</span> <span class="o">==</span> <span class="n">rec_size</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="nb">bin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">logged_in</span> <span class="o">=</span> <span class="s">&quot;at </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%a %H:%M:%S %Y-%m-</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">,</span>
                                    <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s">&quot; on </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">host</span> <span class="o">=</span> <span class="s">&quot; from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logged_in</span> <span class="o">=</span> <span class="s">&quot;never logged in&quot;</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="n">host</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%-8s</span><span class="s"> UID </span><span class="si">%5d</span><span class="s"> </span><span class="si">%s%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">logged_in</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">host</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Read failed.&quot;</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="c"># ^^PLEAC^^_9.0</span>
<span class="c">#-----------------------------</span>
<span class="n">entry</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="s">&quot;/usr/bin/vi&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">entry</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="s">&quot;/usr/bin&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">entry</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">INFILE</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">entry</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="s">&quot;/usr/bin/vi&quot;</span><span class="p">)</span>
<span class="n">ctime</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">st_ino</span>
<span class="n">size</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">st_size</span>
<span class="c">#-----------------------------</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">():</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> doesn&#39;t have text in it.&quot;</span><span class="o">%</span><span class="n">filename</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&quot;/usr/bin&quot;</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Inside /usr/bin is something called&quot;</span><span class="p">,</span> <span class="n">filename</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_9.1</span>
<span class="c">#-----------------------------</span>
<span class="n">fstat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">readtime</span> <span class="o">=</span> <span class="n">fstat</span><span class="o">.</span><span class="n">st_atime</span>
<span class="n">writetime</span> <span class="o">=</span> <span class="n">fstat</span><span class="o">.</span><span class="n">st_mtime</span>

<span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">(</span><span class="n">newreadtime</span><span class="p">,</span> <span class="n">newwritetime</span><span class="p">))</span>

<span class="c">#DON&#39;T DO THIS:</span>
<span class="n">readtime</span><span class="p">,</span> <span class="n">writetime</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">7</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="n">SECONDS_PER_DAY</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span>
<span class="n">fstat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">atime</span> <span class="o">=</span> <span class="n">fstat</span><span class="o">.</span><span class="n">st_atime</span> <span class="o">-</span> <span class="mi">7</span> <span class="o">*</span> <span class="n">SECONDS_PER_DAY</span>
<span class="n">mtime</span> <span class="o">=</span> <span class="n">fstat</span><span class="o">.</span><span class="n">st_mtime</span> <span class="o">-</span> <span class="mi">7</span> <span class="o">*</span> <span class="n">SECONDS_PER_DAY</span>

<span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">(</span><span class="n">atime</span><span class="p">,</span> <span class="n">mtime</span><span class="p">))</span>     
<span class="c">#-----------------------------</span>
<span class="n">mtime</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span>
<span class="n">utime</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">mtime</span><span class="p">))</span>
<span class="c">#-----------------------------</span>
<span class="c">#!/usr/bin/perl -w</span>
<span class="c"># uvi - vi a file without changing its access times</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s">&quot;usage: uvi filename&quot;</span><span class="p">)</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">fstat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="c"># WARNING: potential security risk</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;EDITOR&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&quot;vi&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">(</span><span class="n">fstat</span><span class="o">.</span><span class="n">st_atime</span><span class="p">,</span> <span class="n">fstat</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">))</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_9.2</span>
<span class="c">#-----------------------------</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="n">err_flg</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
        <span class="n">err_flg</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">if</span> <span class="n">err_flg</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t remove all of </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>
<span class="c">#-----------------------------</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">success</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">success</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">pass</span>
<span class="k">if</span> <span class="n">success</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">):</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;could only delete </span><span class="si">%d</span><span class="s"> of </span><span class="si">%d</span><span class="s"> files&quot;</span> <span class="o">%</span> \
                     <span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)))</span>

<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_9.3</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">oldfile</span><span class="p">,</span> <span class="n">newfile</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c">## NOTE: this doesn&#39;t do the same thing as the Perl code,</span>
<span class="c">## eg, handling of partial writes.</span>
<span class="n">infile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">oldfile</span><span class="p">)</span>
<span class="n">outfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">newfile</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>

<span class="n">blksize</span> <span class="o">=</span> <span class="mi">16384</span>          <span class="c"># preferred block size?</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">blksize</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">buf</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>

<span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="c"># WARNING: these are insecure - do not use in hostile environments</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;cp </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">oldfile</span><span class="p">,</span> <span class="n">newfile</span><span class="p">))</span>       <span class="c"># unix</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;copy </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">oldfile</span><span class="p">,</span> <span class="n">newfile</span><span class="p">))</span>     <span class="c"># dos, vms</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s">&quot;datafile.dat&quot;</span><span class="p">,</span> <span class="s">&quot;datafile.bak&quot;</span><span class="p">)</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s">&quot;datafile.new&quot;</span><span class="p">,</span> <span class="s">&quot;datafile.dat&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;datafile.new&quot;</span><span class="p">)</span>

<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_9.4</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">seen</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">def</span> <span class="nf">do_my_thing</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">fstat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">fstat</span><span class="o">.</span><span class="n">st_ino</span><span class="p">,</span> <span class="n">fstat</span><span class="o">.</span><span class="n">st_dev</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">seen</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
        <span class="c"># do something with filename because we haven&#39;t</span>
        <span class="c"># seen it before</span>
        <span class="k">pass</span>
    <span class="n">seen</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">seen</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">fstat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">fstat</span><span class="o">.</span><span class="n">st_ino</span><span class="p">,</span> <span class="n">fstat</span><span class="o">.</span><span class="n">st_dev</span><span class="p">)</span>
    <span class="n">seen</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="n">keys</span> <span class="o">=</span> <span class="n">seen</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="k">for</span> <span class="n">inodev</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
    <span class="n">ino</span><span class="p">,</span> <span class="n">dev</span> <span class="o">=</span> <span class="n">inodev</span>
    <span class="n">filenames</span> <span class="o">=</span> <span class="n">seen</span><span class="p">[</span><span class="n">inodev</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c"># &#39;filenames&#39; is a list of filenames for the same file</span>
        <span class="k">pass</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_9.5</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span>
    <span class="c"># do something with &quot;$dirname/$file&quot;</span>
    <span class="k">pass</span>
<span class="c">#-----------------------------</span>
<span class="c"># XXX No -T equivalent in Python</span>
<span class="c">#-----------------------------</span>
<span class="c"># &#39;readir&#39; always skipes &#39;.&#39; and &#39;..&#39; on OSes where those are</span>
<span class="c"># standard directory names</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="c">#-----------------------------</span>
<span class="c"># XX Not Implemented -- need to know what DirHandle does</span>
<span class="c"># use DirHandle;</span>

<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_9.6</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&quot;*.c&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filename</span> <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;.c&quot;</span><span class="p">)]</span> 
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">allowed_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;\.[ch]$&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span><span class="o">.</span><span class="n">search</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">allowed_name</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">os</span>
<span class="n">allowed_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;\.[ch]$&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span><span class="o">.</span><span class="n">search</span>

<span class="n">fnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span> 
              <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
              <span class="k">if</span> <span class="n">allowed_name</span><span class="p">(</span><span class="n">fname</span><span class="p">)]</span>
<span class="c">#-----------------------------</span>
<span class="n">dirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()]</span>
<span class="n">dirs</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">d</span><span class="p">)]</span>
<span class="n">dirs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dirs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>    <span class="c"># Sort by numeric value - &quot;9&quot; before &quot;11&quot;</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_9.7</span>
<span class="c"># Processing All Files in a Directory Recursively</span>

<span class="c"># os.walk is new in 2.3.</span>

<span class="c"># For pre-2.3 code, there is os.path.walk, which is</span>
<span class="c"># little harder to use.</span>

<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">top</span><span class="p">):</span>
    <span class="k">pass</span> <span class="c"># do whatever</span>

<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">os.path</span>
<span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">top</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">os.path</span>
<span class="n">numbytes</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">top</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">numbytes</span> <span class="o">+=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> contains </span><span class="si">%s</span><span class="s"> bytes&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">numbytes</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">os.path</span>
<span class="n">saved_size</span><span class="p">,</span> <span class="n">saved_name</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;&#39;</span>
<span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">top</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="n">saved_size</span><span class="p">:</span>
            <span class="n">saved_size</span> <span class="o">=</span> <span class="n">size</span>
            <span class="n">saved_name</span> <span class="o">=</span> <span class="n">path</span>
<span class="k">print</span> <span class="s">&quot;Biggest file </span><span class="si">%s</span><span class="s"> in </span><span class="si">%s</span><span class="s"> is </span><span class="si">%s</span><span class="s"> bytes long&quot;</span> <span class="o">%</span> <span class="p">(</span>
    <span class="n">saved_name</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">saved_size</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">os.path</span><span class="o">,</span> <span class="nn">time</span>
<span class="n">saved_age</span><span class="p">,</span> <span class="n">saved_name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;&#39;</span>
<span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">top</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">age</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">saved_age</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">age</span> <span class="o">&gt;</span> <span class="n">saved_age</span><span class="p">:</span>
            <span class="n">saved_age</span> <span class="o">=</span> <span class="n">age</span>
            <span class="n">saved_name</span> <span class="o">=</span> <span class="n">path</span>
<span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">saved_name</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">saved_age</span><span class="p">))</span>

<span class="c">#-----------------------------</span>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># fdirs - find all directories</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">os.path</span>
<span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">or</span> <span class="p">[</span><span class="s">&#39;.&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">top</span> <span class="ow">in</span> <span class="n">argv</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">top</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">print</span> <span class="n">path</span>


<span class="c"># ^^PLEAC^^_9.8</span>
<span class="c">#-----------------------------</span>
<span class="c"># DeleteDir - remove whole directory trees like rm -r</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS:</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="k">def</span> <span class="nf">DeleteDir</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span>
            <span class="n">DeleteDir</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>

<span class="c"># @@PLEAC@@_9.9</span>
<span class="c"># Renaming Files</span>

<span class="c"># code sample one to one from my perlcookbook</span>
<span class="c"># looks strange to me.</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">:</span>
    <span class="n">newname</span> <span class="o">=</span> <span class="n">fname</span>
    <span class="c"># change the file&#39;s name</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Couldn&#39;t rename </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">!&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">newfile</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

<span class="c"># use os.renames if newname needs directory creation.</span>

<span class="c">#A vaguely Pythonic solution is:</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="k">def</span> <span class="nf">rename</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">transfunc</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">:</span>
        <span class="n">newname</span> <span class="o">=</span> <span class="n">transfunc</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">newname</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Couldn&#39;t rename </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">!&quot;</span> <span class="o">%</span> \
                  <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">newfile</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">transfunc</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">fname</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>
<span class="n">rename</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&quot;*.orig&quot;</span><span class="p">),</span> <span class="n">transfunc</span><span class="p">)</span> 

<span class="k">def</span> <span class="nf">transfunc</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">fname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="n">rename</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;Make)], transfunc) </span>

<span class="k">def</span> <span class="nf">transfunc</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">fname</span> <span class="o">+</span> <span class="s">&quot;.bad&quot;</span>
<span class="n">rename</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&quot;*.f&quot;</span><span class="p">),</span> <span class="n">transfunc</span><span class="p">)</span> 

<span class="k">def</span> <span class="nf">transfunc</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span> 
    <span class="n">answer</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="n">fname</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">answer</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;Y&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">fname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span>
<span class="n">rename</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">),</span> <span class="n">transfunc</span><span class="p">)</span> 

<span class="k">def</span> <span class="nf">transfunc</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;.#&quot;</span> <span class="o">+</span> <span class="n">fname</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">rename</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&quot;/tmp/*~&quot;</span><span class="p">),</span> <span class="n">transfunc</span><span class="p">)</span> 

<span class="c"># This _could_ be made to eval code taken directly from the command line, </span>
<span class="c"># but it would be fragile</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_9.10</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">base</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="n">path</span> <span class="o">=</span> <span class="s">&#39;/usr/lib/libc.a&#39;</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;dir is </span><span class="si">%s</span><span class="s">, file is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<span class="c"># dir is /usr/lib, file is libc.a</span>
<span class="c">#-----------------------------</span>
<span class="n">path</span> <span class="o">=</span> <span class="s">&#39;/usr/lib/libc.a&#39;</span>
<span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;dir is </span><span class="si">%s</span><span class="s">, name is </span><span class="si">%s</span><span class="s">, extension is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
<span class="c">#   NOTE: The Python code prints</span>
<span class="c"># dir is /usr/lib, name is libc, extension is .a</span>
<span class="c">#   while the Perl code prints a &#39;/&#39; after the directory name</span>
<span class="c"># dir is /usr/lib/, name is libc, extension is .a</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">macpath</span>
<span class="n">path</span> <span class="o">=</span> <span class="s">&quot;Hard%20Drive:System</span><span class="si">%20F</span><span class="s">older:README.txt&quot;</span>
<span class="n">dirname</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="n">macpath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">macpath</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;dir is </span><span class="si">%s</span><span class="s">, name is </span><span class="si">%s</span><span class="s">, extension is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
<span class="c"># dir is Hard%20Drive:System%20Folder, name is README, extension is .txt</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS - it&#39;s not portable.</span>
<span class="k">def</span> <span class="nf">extension</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">if</span> <span class="s">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">ext</span><span class="p">:</span>
        <span class="c"># wasn&#39;t passed a basename -- this is of the form &#39;x.y/z&#39;</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ext</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_9.11</span>

<span class="c">#!/usr/bin/python</span>
<span class="c"># sysmirror - build spectral forest of symlinks</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">os.path</span>

<span class="n">pgmname</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="o">!=</span><span class="mi">3</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;usage: </span><span class="si">%s</span><span class="s"> realdir mirrordir&quot;</span> <span class="o">%</span> <span class="n">pgmname</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span>

<span class="p">(</span><span class="n">srcdir</span><span class="p">,</span> <span class="n">dstdir</span><span class="p">)</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">srcdir</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s"> is not a directory&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pgmname</span><span class="p">,</span><span class="n">srcdir</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dstdir</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dstdir</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: can&#39;t make directory </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pgmname</span><span class="p">,</span><span class="n">dstdir</span><span class="p">)</span>
	  <span class="k">raise</span> <span class="ne">SystemExit</span>

<span class="c"># fix relative paths</span>
<span class="n">srcdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">srcdir</span><span class="p">)</span>
<span class="n">dstdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">dstdir</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">wanted</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">direntry</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="n">relname</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">direntry</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">relname</span><span class="p">):</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">relname</span><span class="p">)</span><span class="o">.</span><span class="n">st_mode</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dstdir</span><span class="p">,</span><span class="n">relname</span><span class="p">),</span> <span class="n">mode</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;can&#39;t mkdir </span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dstdir</span><span class="p">,</span><span class="n">relname</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">SystemExit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">relname</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;./&quot;</span><span class="p">:</span>
                <span class="n">relname</span> <span class="o">=</span> <span class="n">relname</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">srcdir</span><span class="p">,</span> <span class="n">relname</span><span class="p">),</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dstdir</span><span class="p">,</span><span class="n">relname</span><span class="p">))</span>

<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">srcdir</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">,</span><span class="n">wanted</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>

<span class="c"># @@PLEAC@@_9.12</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>


<span class="c"># ^^PLEAC^^_10.0</span>
<span class="c">#-----------------------------</span>
<span class="c"># DO NOT DO THIS...</span>
<span class="n">greeted</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">greeted</span>
    <span class="n">greeted</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">print</span> <span class="s">&quot;hi there&quot;</span>

<span class="c">#... as using a callable object to save state is cleaner</span>
<span class="c"># class hello</span>
<span class="c">#     def __init__(self):</span>
<span class="c">#         self.greeted = 0</span>
<span class="c">#     def __call__(self):</span>
<span class="c">#         self.greeted += 1</span>
<span class="c">#         print &quot;hi there&quot;</span>
<span class="c"># hello = hello()</span>
<span class="c">#-----------------------------</span>
<span class="n">hello</span><span class="p">()</span>                 <span class="c"># call subroutine hello with no arguments/parameters</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_10.1</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="c"># Provided for demonstration purposes only.  Use math.hypot() instead.</span>
<span class="k">def</span> <span class="nf">hypotenuse</span><span class="p">(</span><span class="n">side1</span><span class="p">,</span> <span class="n">side2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">side1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">side2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">diag</span> <span class="o">=</span> <span class="n">hypotenuse</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  <span class="c"># diag is 5.0</span>
<span class="c">#-----------------------------</span>
<span class="k">print</span> <span class="n">hypotenuse</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>               <span class="c"># prints 5.0</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="k">print</span> <span class="n">hypotenuse</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>                 <span class="c"># prints 5.0</span>
<span class="c">#-----------------------------</span>
<span class="n">both</span> <span class="o">=</span> <span class="n">men</span> <span class="o">+</span> <span class="n">women</span>
<span class="c">#-----------------------------</span>
<span class="n">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">6.7</span><span class="p">]</span>
<span class="c"># Provided for demonstration purposes only.  Use:</span>
<span class="c">#     ints = [int(num) for num in nums] </span>
<span class="k">def</span> <span class="nf">int_all</span><span class="p">(</span><span class="n">nums</span><span class="p">):</span>
    <span class="n">retlist</span> <span class="o">=</span> <span class="p">[]</span>            <span class="c"># make new list for return</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">:</span>
        <span class="n">retlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">retlist</span>
<span class="n">ints</span> <span class="o">=</span> <span class="n">int_all</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>        <span class="c"># nums unchanged</span>
<span class="c">#-----------------------------</span>
<span class="n">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">6.7</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">trunc_em</span><span class="p">(</span><span class="n">nums</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nums</span><span class="p">):</span>
        <span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
<span class="n">trunc_em</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>               <span class="c"># nums now [1,3,6]</span>

<span class="c">#-----------------------------</span>
<span class="c"># By convention, if a method (or function) modifies an object</span>
<span class="c"># in-place, it returns None rather than the modified object.</span>
<span class="c"># None of Python&#39;s built-in functions modify in-place; methods</span>
<span class="c"># such as list.sort() are somewhat more common.</span>
<span class="n">mylist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">mylist</span> <span class="o">=</span> <span class="n">mylist</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>   <span class="c"># incorrect - returns None</span>
<span class="n">mylist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span>  <span class="c"># correct - returns sorted copy</span>
<span class="n">mylist</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>            <span class="c"># correct - sorts in-place</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_10.2</span>
<span class="c">#-----------------------------</span>
<span class="c"># Using global variables is discouraged - by default variables</span>
<span class="c"># are visible only at and below the scope at which they are declared.</span>
<span class="c"># Global variables modified by a function or method must be declared </span>
<span class="c"># using the &quot;global&quot; keyword if they are modified</span>
<span class="k">def</span> <span class="nf">somefunc</span><span class="p">():</span>
    <span class="n">variable</span> <span class="o">=</span> <span class="n">something</span>  <span class="c"># variable is invisible outside of somefunc</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">name</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="c"># assumes two and only two command line parameters</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">fetch_time</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">pair</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">fetch_time</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">check_x</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="s">&quot;whatever&quot;</span>
    <span class="n">run_check</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">condition</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;got&quot;</span><span class="p">,</span> <span class="n">x</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">save_list</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">Global_List</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_10.3</span>
<span class="c">#-----------------------------</span>
<span class="c">## Python allows static nesting of scopes for reading but not writing,</span>
<span class="c">## preferring to use objects.  The closest equivalent to:</span>
<span class="c">#{</span>
<span class="c">#    my $counter;</span>
<span class="c">#    sub next_counter { return ++$counter }</span>
<span class="c">#}</span>
<span class="c">## is:</span>
<span class="k">def</span> <span class="nf">next_counter</span><span class="p">(</span><span class="n">counter</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>  <span class="c"># default lists are created once only.</span>
    <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c"># As that&#39;s a little tricksy (and can&#39;t make more than one counter),</span>
<span class="c"># many Pythonistas would prefer either:</span>
<span class="k">def</span> <span class="nf">make_counter</span><span class="p">():</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">yield</span> <span class="n">counter</span>
<span class="n">next_counter</span> <span class="o">=</span> <span class="n">make_counter</span><span class="p">()</span><span class="o">.</span><span class="n">next</span>

<span class="c"># Or:</span>
<span class="k">class</span> <span class="nc">Counter</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span>
<span class="n">next_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>

<span class="c">#-----------------------------</span>
<span class="c">## A close equivalent of</span>
<span class="c">#BEGIN {</span>
<span class="c">#    my $counter = 42;</span>
<span class="c">#    sub next_counter { return ++$counter }</span>
<span class="c">#    sub prev_counter { return --$counter }</span>
<span class="c">#}</span>
<span class="c">## is to use a list (to save the counter) and closured functions:</span>
<span class="k">def</span> <span class="nf">make_counter</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">next_counter</span><span class="p">():</span>
        <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">prev_counter</span><span class="p">():</span>
        <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">next_counter</span><span class="p">,</span> <span class="n">prev_counter</span>
<span class="n">next_counter</span><span class="p">,</span> <span class="n">prev_counter</span> <span class="o">=</span> <span class="n">make_counter</span><span class="p">()</span>

<span class="c">## A clearer way uses a class:</span>
<span class="k">class</span> <span class="nc">Counter</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">start</span>
    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
    <span class="k">def</span> <span class="nf">prev</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
    <span class="k">def</span> <span class="nf">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

<span class="n">counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">next_counter</span> <span class="o">=</span> <span class="n">counter</span><span class="o">.</span><span class="n">next</span>
<span class="n">prev_counter</span> <span class="o">=</span> <span class="n">counter</span><span class="o">.</span><span class="n">prev</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_10.4</span>
<span class="c">## This sort of code inspection is liable to change as</span>
<span class="c">## Python evolves.  There may be cleaner ways to do this.</span>
<span class="c">## This also may not work for code called from functions</span>
<span class="c">## written in C.</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">this_function</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
<span class="c">#-----------------------------</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># how far up the call stack to look</span>
<span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">f_globals</span><span class="p">[</span><span class="s">&quot;__name__&quot;</span><span class="p">]</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_filename</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">f_lineno</span>
<span class="n">subr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
<span class="n">has_args</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_argcount</span><span class="p">)</span>

<span class="c"># &#39;wantarray&#39; is Perl specific</span>

<span class="c">#-----------------------------</span>
<span class="n">me</span> <span class="o">=</span> <span class="n">whoami</span><span class="p">()</span>
<span class="n">him</span> <span class="o">=</span> <span class="n">whowasi</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">whoami</span><span class="p">():</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
<span class="k">def</span> <span class="nf">whowasi</span><span class="p">():</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_10.5</span>
<span class="c">#-----------------------------</span>
<span class="c"># Every variable name is a reference to an object, thus nothing special</span>
<span class="c"># needs to be done to pass a list or a dict as a parameter.</span>
<span class="n">list_diff</span><span class="p">(</span><span class="n">list1</span><span class="p">,</span> <span class="n">list2</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># Note: if one parameter to zip() is longer it will be truncated</span>
<span class="k">def</span> <span class="nf">add_vecpair</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x1</span><span class="o">+</span><span class="n">y1</span> <span class="k">for</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">add_vecpair</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)])</span>
<span class="c">#=&gt; 6 10</span>
<span class="c">#-----------------------------</span>
<span class="c"># DO NOT DO THIS:</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">type</span><span class="p">([]))</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nb">type</span><span class="p">([])),</span> \
    <span class="s">&quot;usage: add_vecpair(list1, list2)&quot;</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_10.6</span>
<span class="c">#-----------------------------</span>
<span class="c"># perl return context is not something standard in python...</span>
<span class="c"># but still you can achieve something alike if you really need it</span>
<span class="c"># (but you must really need it badly since you should never use this!!)</span>
<span class="c">#</span>
<span class="c"># see http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/284742 for more</span>
<span class="c">#</span>
<span class="c"># NB: it has been tested under Python 2.3.x and no guarantees can be given</span>
<span class="c">#     that it works under any future Python version.</span>
<span class="kn">import</span> <span class="nn">inspect</span><span class="o">,</span><span class="nn">dis</span>

<span class="k">def</span> <span class="nf">expecting</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return how many values the caller is expecting&quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span><span class="o">.</span><span class="n">f_back</span>
    <span class="n">bytecode</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_code</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">f_lasti</span>
    <span class="n">instruction</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">bytecode</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">instruction</span> <span class="o">==</span> <span class="n">dis</span><span class="o">.</span><span class="n">opmap</span><span class="p">[</span><span class="s">&#39;UNPACK_SEQUENCE&#39;</span><span class="p">]:</span>
        <span class="n">howmany</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">bytecode</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">howmany</span>
    <span class="k">elif</span> <span class="n">instruction</span> <span class="o">==</span> <span class="n">dis</span><span class="o">.</span><span class="n">opmap</span><span class="p">[</span><span class="s">&#39;POP_TOP&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">cleverfunc</span><span class="p">():</span>
    <span class="n">howmany</span> <span class="o">=</span> <span class="n">expecting</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">howmany</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;return value discarded&quot;</span>
    <span class="k">if</span> <span class="n">howmany</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
    <span class="k">elif</span> <span class="n">howmany</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span>
    <span class="k">return</span> <span class="mi">1</span>

<span class="n">cleverfunc</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">cleverfunc</span><span class="p">()</span>
<span class="k">print</span> <span class="n">x</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">cleverfunc</span><span class="p">()</span>
<span class="k">print</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">cleverfunc</span><span class="p">()</span>
<span class="k">print</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span>

<span class="c"># ^^PLEAC^^_10.7</span>
<span class="c">#-----------------------------</span>
<span class="n">thefunc</span><span class="p">(</span><span class="n">increment</span><span class="o">=</span> <span class="s">&quot;20s&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s">&quot;+5m&quot;</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="s">&quot;+30m&quot;</span><span class="p">)</span>
<span class="n">thefunc</span><span class="p">(</span><span class="n">start</span><span class="o">=</span> <span class="s">&quot;+5m&quot;</span><span class="p">,</span><span class="n">finish</span><span class="o">=</span><span class="s">&quot;+30m&quot;</span><span class="p">)</span>
<span class="n">thefunc</span><span class="p">(</span><span class="n">finish</span><span class="o">=</span> <span class="s">&quot;+30m&quot;</span><span class="p">)</span>
<span class="n">thefunc</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s">&quot;+5m&quot;</span><span class="p">,</span> <span class="n">increment</span><span class="o">=</span><span class="s">&quot;15s&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">thefunc</span><span class="p">(</span><span class="n">increment</span><span class="o">=</span><span class="s">&#39;10s&#39;</span><span class="p">,</span>
            <span class="n">finish</span><span class="o">=</span><span class="s">&#39;0&#39;</span><span class="p">,</span>
            <span class="n">start</span><span class="o">=</span><span class="s">&#39;0&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">increment</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;m&quot;</span><span class="p">):</span>
        <span class="k">pass</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_10.8</span>
<span class="c">#-----------------------------</span>
<span class="n">a</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>       <span class="c"># Use _ as a placeholder...</span>
<span class="n">a</span><span class="p">,</span> <span class="n">ignore</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>  <span class="c"># ...or assign to an otherwise unused variable</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_10.9</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">somefunc</span><span class="p">():</span>
    <span class="n">mylist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mydict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c"># ...</span>
    <span class="k">return</span> <span class="n">mylist</span><span class="p">,</span> <span class="n">mydict</span>

<span class="n">mylist</span><span class="p">,</span> <span class="n">mydict</span> <span class="o">=</span> <span class="n">somefunc</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">fn</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>

<span class="c">#-----------------------------</span>
<span class="n">h0</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span> <span class="o">=</span> <span class="n">fn</span><span class="p">()</span>
<span class="n">tuple_of_dicts</span> <span class="o">=</span> <span class="n">fn</span><span class="p">()</span>   <span class="c"># eg: tuple_of_dicts[2][&quot;keystring&quot;]</span>
<span class="n">r0</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span> <span class="o">=</span> <span class="n">fn</span><span class="p">()</span>       <span class="c"># eg: r2[&quot;keystring&quot;]</span>

<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_10.10</span>
<span class="c">#-----------------------------</span>
<span class="c"># Note: Exceptions are almost always preferred to error values</span>
<span class="k">return</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">empty_retval</span><span class="p">():</span>
    <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">empty_retval</span><span class="p">():</span>
    <span class="k">return</span>          <span class="c"># identical to return None</span>

<span class="k">def</span> <span class="nf">empty_retval</span><span class="p">():</span>
    <span class="k">pass</span>            <span class="c"># None returned by default (empty func needs pass)</span>
<span class="c">#-----------------------------</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">yourfunc</span><span class="p">()</span>
<span class="k">if</span> <span class="n">a</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="c">#-----------------------------</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">sfunc</span><span class="p">()</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&quot;sfunc failed&quot;</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">sfunc</span><span class="p">(),</span> <span class="s">&quot;sfunc failed&quot;</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_10.11</span>
<span class="c"># Prototypes are inapplicable to Python as Python disallows calling</span>
<span class="c"># functions without using brackets, and user functions are able to</span>
<span class="c"># mimic built-in functions with no special actions required as they</span>
<span class="c"># only flatten lists (and convert dicts to named arguments) if</span>
<span class="c"># explicitly told to do so.  Python functions use named parameters</span>
<span class="c"># rather than shifting arguments:</span>

<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
   <span class="k">print</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>

<span class="n">mylist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>

<span class="n">mydict1</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;b&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">mydict2</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;b&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>

<span class="n">myfunc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="c">#=&gt; 1 2 3</span>

<span class="n">myfunc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="c">#=&gt; 1 2 4</span>

<span class="n">myfunc</span><span class="p">(</span><span class="o">*</span><span class="n">mylist</span><span class="p">)</span>
<span class="c">#=&gt; 1 2 4</span>

<span class="n">myfunc</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="o">*</span><span class="n">mylist</span><span class="p">)</span>
<span class="c">#=&gt; 5, 1, 2</span>

<span class="n">myfunc</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">mydict1</span><span class="p">)</span>
<span class="c">#=&gt; 5, 2, 3</span>

<span class="n">myfunc</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">mydict2</span><span class="p">)</span>
<span class="c">#=&gt; 5, 2, 4</span>

<span class="n">myfunc</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c">#=&gt; 1, 2, 3</span>

<span class="n">myfunc</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c">#=&gt; 1, 2, 4</span>

<span class="n">myfunc</span><span class="p">(</span><span class="n">mylist</span><span class="p">,</span> <span class="n">mydict1</span><span class="p">)</span>
<span class="c">#=&gt; [1, 2] {&#39;c&#39;: 3, &#39;b&#39;: 2} 4</span>

<span class="c"># For demonstration purposes only - don&#39;t do this</span>
<span class="k">def</span> <span class="nf">mypush</span><span class="p">(</span><span class="n">mylist</span><span class="p">,</span> <span class="o">*</span><span class="n">vals</span><span class="p">):</span>
   <span class="n">mylist</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

<span class="n">mylist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">mypush</span><span class="p">(</span><span class="n">mylist</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="k">print</span> <span class="n">mylist</span>
<span class="c">#=&gt; [1, 2, 3, 4, 5]</span>

<span class="c"># ^^PLEAC^^_10.12</span>
<span class="c">#-----------------------------</span>
<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;some message&quot;</span><span class="p">)</span>  <span class="c"># specific exception class</span>
<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;use me rarely&quot;</span><span class="p">)</span>  <span class="c"># general exception</span>
<span class="k">raise</span> <span class="s">&quot;don&#39;t use me&quot;</span>              <span class="c"># string exception (deprecated)</span>
<span class="c">#-----------------------------</span>
<span class="c"># Note that bare excepts are considered bad style.  Normally you should</span>
<span class="c"># trap specific exceptions.  For instance these bare excepts will</span>
<span class="c"># catch KeyboardInterrupt, SystemExit, and MemoryError as well as</span>
<span class="c"># more common errors.  In addition they force you to import sys to</span>
<span class="c"># get the error message.</span>
<span class="kn">import</span> <span class="nn">warnings</span><span class="o">,</span> <span class="nn">sys</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">func</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;func raised an exception: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
<span class="c">#-----------------------------</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">func</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;func blew up: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
<span class="c">#-----------------------------</span>
<span class="k">class</span> <span class="nc">MoonPhaseError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span>
<span class="k">class</span> <span class="nc">FullMoonError</span><span class="p">(</span><span class="n">MoonPhaseError</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">MoonPhaseError</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="s">&quot;full moon&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">raise</span> <span class="n">FullMoonError</span><span class="p">()</span>

<span class="c"># Ignore only FullMoonError exceptions</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">func</span><span class="p">()</span>
<span class="k">except</span> <span class="n">FullMoonError</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="c">#-----------------------------</span>
<span class="c"># Ignore only MoonPhaseError for a full moon</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">func</span><span class="p">()</span>
<span class="k">except</span> <span class="n">MoonPhaseError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">phase</span> <span class="o">!=</span> <span class="s">&quot;full moon&quot;</span><span class="p">:</span>
        <span class="k">raise</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_10.13</span>
<span class="c"># There is no direct equivalent to &#39;local&#39; in Python, and</span>
<span class="c"># it&#39;s impossible to write your own.  But then again, even in</span>
<span class="c"># Perl it&#39;s considered poor style.</span>

<span class="c"># DON&#39;T DO THIS (You probably shouldn&#39;t use global variables anyway):</span>
<span class="k">class</span> <span class="nc">Local</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">globalname</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">globalname</span> <span class="o">=</span> <span class="n">globalname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">globalval</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="n">globalname</span><span class="p">]</span>
        <span class="nb">globals</span><span class="p">()[</span><span class="n">globalname</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">globals</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">globalname</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">globalval</span>

<span class="n">foo</span> <span class="o">=</span> <span class="mi">4</span>

<span class="k">def</span> <span class="nf">blah</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">foo</span>

<span class="k">def</span> <span class="nf">blech</span><span class="p">():</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">Local</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">blah</span><span class="p">()</span>

<span class="n">blah</span><span class="p">()</span>
<span class="n">blech</span><span class="p">()</span>
<span class="n">blah</span><span class="p">()</span>

<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_10.14</span>
<span class="c">#-----------------------------</span>
<span class="n">grow</span> <span class="o">=</span> <span class="n">expand</span>
<span class="n">grow</span><span class="p">()</span>                     <span class="c"># calls expand()</span>

<span class="c">#-----------------------------</span>
<span class="n">one</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">two</span><span class="o">.</span><span class="n">table</span>   <span class="c"># make one.var the same as two.table</span>
<span class="n">one</span><span class="o">.</span><span class="n">big</span> <span class="o">=</span> <span class="n">two</span><span class="o">.</span><span class="n">small</span>   <span class="c"># make one.big the same as two.small</span>
<span class="c">#-----------------------------</span>
<span class="n">fred</span> <span class="o">=</span> <span class="n">barney</span>     <span class="c"># alias fred to barney</span>
<span class="c">#-----------------------------</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">red</span><span class="p">(</span><span class="s">&quot;careful here&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">s</span>
<span class="c">#&gt; &lt;FONT COLOR=&#39;red&#39;&gt;careful here&lt;/FONT&gt;</span>
<span class="c">#-----------------------------</span>
<span class="c"># Note: the &#39;text&#39; should be HTML escaped if it can contain</span>
<span class="c"># any of the characters &#39;&lt;&#39;, &#39;&gt;&#39; or &#39;&amp;&#39;</span>
<span class="k">def</span> <span class="nf">red</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;&lt;FONT COLOR=&#39;red&#39;&gt;&quot;</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="s">&quot;&lt;/FONT&gt;&quot;</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">color_font</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;&lt;FONT COLOR=&#39;</span><span class="si">%s</span><span class="s">&#39;&gt;</span><span class="si">%s</span><span class="s">&lt;/FONT&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">red</span><span class="p">(</span><span class="n">text</span><span class="p">):</span> <span class="k">return</span> <span class="n">color_font</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">green</span><span class="p">(</span><span class="n">text</span><span class="p">):</span> <span class="k">return</span> <span class="n">color_font</span><span class="p">(</span><span class="s">&quot;green&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">blue</span><span class="p">(</span><span class="n">text</span><span class="p">):</span> <span class="k">return</span> <span class="n">color_font</span><span class="p">(</span><span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">purple</span><span class="p">(</span><span class="n">text</span><span class="p">):</span> <span class="k">return</span> <span class="n">color_font</span><span class="p">(</span><span class="s">&quot;purple&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span class="c"># etc</span>
<span class="c">#-----------------------------</span>
<span class="c"># This is done in Python by making an object, instead of</span>
<span class="c"># saving state in a local anonymous context.</span>
<span class="k">class</span> <span class="nc">ColorFont</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&lt;FONT COLOR=&#39;</span><span class="si">%s</span><span class="s">&#39;&gt;</span><span class="si">%s</span><span class="s">&lt;/FONT&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="s">&quot;red blue green yellow orange purple violet&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">:</span>
    <span class="nb">globals</span><span class="p">()[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ColorFont</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># If you really don&#39;t want to make a new class, you can</span>
<span class="c"># fake it somewhat by passing in default args.</span>
<span class="n">colors</span> <span class="o">=</span> <span class="s">&quot;red blue green yellow orange purple violet&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">colors</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">temp</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&lt;FONT COLOR=&#39;</span><span class="si">%s</span><span class="s">&#39;&gt;</span><span class="si">%s</span><span class="s">&lt;/FONT&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="nb">globals</span><span class="p">()[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>

<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_10.15</span>

<span class="c"># Python has the ability to derive from ModuleType and add</span>
<span class="c"># new __getattr__ and __setattr__ methods.  I don&#39;t know the</span>
<span class="c"># expected way to use them to emulate Perl&#39;s AUTOLOAD.  Instead,</span>
<span class="c"># here&#39;s how something similar would be done in Python.  This</span>
<span class="c"># uses the ColorFont defined above.</span>

<span class="c">#-----------------------------</span>
<span class="k">class</span> <span class="nc">AnyColor</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ColorFont</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="n">AnyColor</span><span class="p">()</span>

<span class="k">print</span> <span class="n">colors</span><span class="o">.</span><span class="n">chartreuse</span><span class="p">(</span><span class="s">&quot;stuff&quot;</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="c">## Skipping this translation because &#39;local&#39; is too Perl</span>
<span class="c">## specific, and there isn&#39;t enough context to figure out</span>
<span class="c">## what this is supposed to do.</span>
<span class="c">#{</span>
<span class="c">#    local *yellow = \&amp;violet;</span>
<span class="c">#    local (*red, *green) = (\&amp;green, \&amp;red);</span>
<span class="c">#    print_stuff();</span>
<span class="c">#}</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_10.16</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">outer</span><span class="p">(</span><span class="n">arg1</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">arg1</span> <span class="o">+</span> <span class="mi">35</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">19</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">inner</span><span class="p">()</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_10.17</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">mailbox</span><span class="o">,</span> <span class="nn">sys</span>
<span class="n">mbox</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">PortableUnixMailbox</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">extract_data</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="s">&quot;Subject&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">subject</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;re:&quot;</span><span class="p">:</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="n">subject</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">subject</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">text</span>
<span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">extract_data</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mbox</span><span class="p">)]</span>

<span class="c">#-----------------------------</span>
<span class="c"># Sorts by subject then by original position in the list</span>
<span class="k">for</span> <span class="n">subject</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">messages</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="c"># Sorts by subject then date then original position</span>
<span class="k">def</span> <span class="nf">subject_date_position</span><span class="p">(</span><span class="n">elem</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">elem</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">getdate</span><span class="p">(</span><span class="s">&quot;Date&quot;</span><span class="p">),</span> <span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">messages</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">subject_date_position</span><span class="p">)</span>

<span class="c"># Pre 2.4:</span>
<span class="n">messages</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">subject_date_position</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_11.0</span>
<span class="c">#Introduction.</span>
<span class="c">#   In Python, all names are references.</span>
<span class="c">#   All objects are inherently anonymous, they don&#39;t know what names refer to them.</span>
<span class="k">print</span> <span class="n">ref</span>   <span class="c"># prints the value that the name ref refers to. </span>
<span class="n">ref</span> <span class="o">=</span> <span class="mi">3</span>     <span class="c"># assigns the name ref to the value 3.</span>
<span class="c">#-----------------------------</span>
<span class="n">aref</span> <span class="o">=</span> <span class="n">mylist</span>
<span class="c">#-----------------------------</span>
<span class="n">aref</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>    <span class="c"># aref is a name for this list</span>
<span class="n">href</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;How&quot;</span><span class="p">:</span> <span class="s">&quot;Now&quot;</span><span class="p">,</span> <span class="s">&quot;Brown&quot;</span><span class="p">:</span> <span class="s">&quot;Cow&quot;</span><span class="p">}</span> <span class="c"># href is a name for this dictionary</span>
<span class="c">#-----------------------------</span>
<span class="c">#   Python doesn&#39;t have autovivification as (for simple types) there is no difference between a name and a reference.</span>
<span class="c">#   If we try the equivalent of the Perl code we get the list, not a reference to the list.</span>
<span class="c">#-----------------------------</span>
<span class="c">#   To handle multidimensional arrays, you should use an extension to Python,</span>
<span class="c">#   such as numarray (http://www.stsci.edu/resources/software_hardware/numarray)</span>
<span class="c">#-----------------------------</span>
<span class="c">#   In Python, assignment doesn&#39;t return anything. </span>
<span class="c">#-----------------------------</span>
<span class="n">Nat</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;Name&quot;</span><span class="p">:</span> <span class="s">&quot;Leonhard Euler&quot;</span><span class="p">,</span>
        <span class="s">&quot;Address&quot;</span><span class="p">:</span> <span class="s">&quot;1729 Ramanujan Lane</span><span class="se">\n</span><span class="s">Mathworld, PI 31416&quot;</span><span class="p">,</span>
        <span class="s">&quot;Birthday&quot;</span><span class="p">:</span> <span class="mh">0x5bb5580</span>
<span class="p">}</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_11.1</span>
<span class="n">aref</span> <span class="o">=</span> <span class="n">mylist</span>
<span class="n">anon_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">anon_copy</span> <span class="o">=</span> <span class="n">anon_list</span>
<span class="n">implicit_creation</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="n">anon_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">two</span> <span class="o">=</span> <span class="n">implicit_creation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="c">#  To get the last index of a list, you can use len() </span>
<span class="c"># [or list.__len__() - but don&#39;t] directly</span>
<span class="n">last_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aref</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

<span class="c"># Normally, though, you&#39;d use an index of -1 for the last</span>
<span class="c"># element, -2 for the second last, etc.</span>
<span class="k">print</span> <span class="n">implicit_creation</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c">#=&gt; 10</span>

<span class="n">num_items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aref</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">last_idx</span> <span class="o">=</span> <span class="n">aref</span><span class="o">.</span><span class="n">__len__</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">num_items</span> <span class="o">=</span> <span class="n">aref</span><span class="o">.</span><span class="n">__len__</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">someVar</span><span class="p">,</span> <span class="nb">type</span><span class="p">([])):</span>
    <span class="k">print</span> <span class="s">&quot;Expected a list&quot;</span>
<span class="c">#-----------------------------</span>
<span class="k">print</span> <span class="n">list_ref</span>
<span class="c">#-----------------------------</span>
<span class="c">#   sort is in place.</span>
<span class="n">list_ref</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="n">list_ref</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">list_ref</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[]</span>

<span class="n">aref1</span> <span class="o">=</span> <span class="n">list_ref</span><span class="p">()</span>
<span class="n">aref2</span> <span class="o">=</span> <span class="n">list_ref</span><span class="p">()</span>
<span class="c">#   aref1 and aref2 point to different lists.</span>
<span class="c">#-----------------------------</span>
<span class="n">list_ref</span><span class="p">[</span><span class="n">N</span><span class="p">]</span> <span class="c"># refers to the Nth item in the list_ref list.</span>
<span class="c">#-----------------------------</span>
<span class="c"># The following two statements are equivalent and return up to 3 elements</span>
<span class="c"># at indices 3, 4, and 5 (if they exist).</span>
<span class="n">pie</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
<span class="n">pie</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="c">#   This will insert 3 elements, overwriting elements at indices 3,4, or 5 - if they exist.</span>
<span class="n">pie</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;blackberry&quot;</span><span class="p">,</span> <span class="s">&quot;blueberry&quot;</span><span class="p">,</span> <span class="s">&quot;pumpkin&quot;</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">pie</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">item</span>

<span class="c"># DON&#39;T DO THIS (this type of indexing should be done with enumerate)</span>
<span class="c"># xrange does not create a list 0..len(pie) - 1, it creates an object </span>
<span class="c"># that returns one index at a time.</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pie</span><span class="p">)):</span>
    <span class="k">print</span> <span class="n">pie</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

<span class="c"># @@PLEAC@@_11.2</span>
<span class="c"># Making Hashes of Arrays</span>

<span class="nb">hash</span><span class="p">[</span><span class="s">&quot;KEYNAME&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;new value&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">mystr</span> <span class="ow">in</span> <span class="nb">hash</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mystr</span><span class="p">,</span> <span class="nb">hash</span><span class="p">[</span><span class="n">mystr</span><span class="p">])</span>

<span class="nb">hash</span><span class="p">[</span><span class="s">&quot;a key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="n">values</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">[</span><span class="s">&quot;a key&quot;</span><span class="p">]</span>

<span class="nb">hash</span><span class="p">[</span><span class="s">&quot;a key&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="c"># autovivification also does not work in python.</span>
<span class="n">residents</span> <span class="o">=</span> <span class="n">phone2name</span><span class="p">[</span><span class="n">number</span><span class="p">]</span>
<span class="c"># do this instead</span>
<span class="n">residents</span> <span class="o">=</span> <span class="n">phone2name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="p">[])</span>


<span class="c"># @@PLEAC@@_11.3</span>
<span class="c"># Taking References to Hashes</span>

<span class="n">href</span> <span class="o">=</span> <span class="nb">hash</span>
<span class="n">anon_hash</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;key1&quot;</span><span class="p">:</span><span class="s">&quot;value1&quot;</span><span class="p">,</span> <span class="s">&quot;key2&quot;</span> <span class="p">:</span> <span class="s">&quot;value2 ...&quot;</span> <span class="p">}</span>
<span class="n">anon_hash_copy</span> <span class="o">=</span> <span class="n">anon_hash</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="nb">hash</span> <span class="o">=</span> <span class="n">href</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">href</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="nb">slice</span> <span class="o">=</span> <span class="p">[</span><span class="n">href</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">,</span> <span class="n">key3</span><span class="p">)]</span>
<span class="n">keys</span> <span class="o">=</span> <span class="nb">hash</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">types</span>
<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">someref</span><span class="p">)</span> <span class="o">!=</span> <span class="n">types</span><span class="o">.</span><span class="n">DictType</span><span class="p">:</span>
    <span class="k">raise</span> <span class="s">&quot;Expected a dictionary, not </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">someref</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">someref</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
    <span class="k">raise</span> <span class="s">&quot;Expected a dictionary, not </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">someref</span><span class="p">)</span>

<span class="k">for</span> <span class="n">href</span> <span class="ow">in</span> <span class="p">(</span> <span class="n">ENV</span><span class="p">,</span> <span class="n">INC</span> <span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">href</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> =&gt; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">href</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">hash_ref</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="p">,</span> <span class="n">key3</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span> <span class="s">&quot;key2&quot;</span><span class="p">,</span> <span class="s">&quot;key3&quot;</span><span class="p">):</span>
    <span class="n">hash_ref</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">7</span>    <span class="c"># not like in perl but the same result.</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_11.4</span>
<span class="c">#-----------------------------</span>
<span class="n">cref</span> <span class="o">=</span> <span class="n">func</span>
<span class="n">cref</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="o">...</span>
<span class="c">#-----------------------------</span>
<span class="n">returned</span> <span class="o">=</span> <span class="n">cref</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">funcname</span> <span class="o">=</span> <span class="s">&quot;thefunc&quot;</span>
<span class="nb">locals</span><span class="p">()[</span><span class="n">funcname</span><span class="p">]();</span>
<span class="c">#-----------------------------</span>
<span class="n">commands</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;happy&#39;</span><span class="p">:</span> <span class="n">joy</span><span class="p">,</span>
    <span class="s">&#39;sad&#39;</span><span class="p">:</span> <span class="n">sullen</span><span class="p">,</span>
    <span class="s">&#39;done&#39;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()),</span>  <span class="c"># In this case &quot;done: sys.exit&quot; would suffice</span>
    <span class="s">&#39;mad&#39;</span><span class="p">:</span> <span class="n">angry</span><span class="p">,</span>
    <span class="p">}</span>

<span class="k">print</span> <span class="s">&quot;How are you?&quot;</span><span class="p">,</span>
<span class="n">cmd</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">()</span>
<span class="k">if</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
    <span class="n">commands</span><span class="p">[</span><span class="n">cmd</span><span class="p">]()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;No such command: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">cmd</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">counter_maker</span><span class="p">():</span>
    <span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">counter_function</span><span class="p">():</span>
        <span class="c"># start refers to the variable defined in counter_maker, but</span>
        <span class="c"># we can&#39;t reassign or increment variables in parent scopes.</span>
        <span class="c"># By using a one-element list we can modify the list without</span>
        <span class="c"># reassigning the variable.  This way of using a list is very</span>
        <span class="c"># like a reference.</span>
        <span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">counter_function</span>

<span class="n">counter</span> <span class="o">=</span> <span class="n">counter_maker</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">counter</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="n">counter1</span> <span class="o">=</span> <span class="n">counter_maker</span><span class="p">()</span>
<span class="n">counter2</span> <span class="o">=</span> <span class="n">counter_maker</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">counter1</span><span class="p">()</span>
<span class="k">print</span> <span class="n">counter1</span><span class="p">(),</span> <span class="n">counter2</span><span class="p">()</span>
<span class="c">#=&gt; 0</span>
<span class="c">#=&gt; 1</span>
<span class="c">#=&gt; 2</span>
<span class="c">#=&gt; 3</span>
<span class="c">#=&gt; 4</span>
<span class="c">#=&gt; 5 0</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">def</span> <span class="nf">timestamp</span><span class="p">():</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">elapsed</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="k">return</span> <span class="n">elapsed</span>
<span class="n">early</span> <span class="o">=</span> <span class="n">timestamp</span><span class="p">()</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">later</span> <span class="o">=</span> <span class="n">timestamp</span><span class="p">()</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;It&#39;s been </span><span class="si">%d</span><span class="s"> seconds since early&quot;</span> <span class="o">%</span> <span class="n">early</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;It&#39;s been </span><span class="si">%d</span><span class="s"> seconds since later&quot;</span> <span class="o">%</span> <span class="n">later</span><span class="p">()</span>
<span class="c">#=&gt; It&#39;s been 30 seconds since early.</span>
<span class="c">#=&gt; It&#39;s been 10 seconds since later.</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_11.5</span>
<span class="c"># A name is a reference to an object and an object can be referred to</span>
<span class="c"># by any number of names. There is no way to manipulate pointers or</span>
<span class="c"># an object&#39;s id.  This section is thus inapplicable.</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span>
<span class="k">print</span> <span class="n">x</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>    <span class="c"># &quot;x&quot; now refers to a different object than y</span>
<span class="k">print</span> <span class="n">x</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">4</span>     <span class="c"># &quot;y&quot; now refers to a different object than it did before</span>
<span class="k">print</span> <span class="n">x</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="c"># Some objects (including ints and strings) are immutable, however, which</span>
<span class="c"># can give the illusion of a by-value/by-reference distinction:</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">z</span> <span class="o">=</span> <span class="s">&quot;s&quot;</span>
<span class="k">print</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>
<span class="c">#=&gt; [1] 1 s</span>

<span class="n">x</span> <span class="o">+=</span> <span class="n">x</span>      <span class="c"># calls list.__iadd__ which is inplace.</span>
<span class="n">y</span> <span class="o">+=</span> <span class="n">y</span>      <span class="c"># can&#39;t find int.__iadd__ so calls int.__add__ which isn&#39;t inplace</span>
<span class="n">z</span> <span class="o">+=</span> <span class="n">z</span>      <span class="c"># can&#39;t find str.__iadd__ so calls str.__add__ which isn&#39;t inplace              </span>
<span class="k">print</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>
<span class="c">#=&gt; [1, 1] 1 s</span>

<span class="c"># @@PLEAC@@_11.6</span>
<span class="c"># As indicated by the previous section, everything is referenced, so</span>
<span class="c"># just create a list as normal, and beware that augmented assignment</span>
<span class="c"># works differently with immutable objects to mutable ones:</span>
<span class="n">mylist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;s&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<span class="k">print</span> <span class="n">mylist</span>
<span class="c">#=&gt; [1, s, [1]]</span>

<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
    <span class="n">elem</span> <span class="o">*=</span> <span class="mi">2</span>
<span class="k">print</span> <span class="n">mylist</span>
<span class="c">#=&gt; [1, s, [1, 1]]</span>

<span class="n">mylist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">2</span>
<span class="n">mylist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">2</span>
<span class="k">print</span> <span class="n">mylist</span>
<span class="c">#=&gt; [1, s, [1, 1, 1, 1]]</span>

<span class="c"># If you need to modify every value in a list, you should use a list comprehension</span>
<span class="c"># which does NOT modify inplace:</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="n">mylist</span> <span class="o">=</span> <span class="p">[(</span><span class="n">val</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">4</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">]</span>

<span class="c"># @@PLEAC@@_11.7</span>
<span class="c">#-----------------------------</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">mkcounter</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">mkcounter</span><span class="p">(</span><span class="mi">77</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;next c1: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">c1</span><span class="p">[</span><span class="s">&#39;next&#39;</span><span class="p">]()</span>  <span class="c"># 21</span>
<span class="k">print</span> <span class="s">&quot;next c2: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">c2</span><span class="p">[</span><span class="s">&#39;next&#39;</span><span class="p">]()</span>  <span class="c"># 78</span>
<span class="k">print</span> <span class="s">&quot;next c1: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">c1</span><span class="p">[</span><span class="s">&#39;next&#39;</span><span class="p">]()</span>  <span class="c"># 22</span>
<span class="k">print</span> <span class="s">&quot;last c1: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">c1</span><span class="p">[</span><span class="s">&#39;prev&#39;</span><span class="p">]()</span>  <span class="c"># 21</span>
<span class="k">print</span> <span class="s">&quot;old  c2: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">c2</span><span class="p">[</span><span class="s">&#39;reset&#39;</span><span class="p">]()</span> <span class="c"># 77</span>
<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS.  Use an object instead  </span>
<span class="k">def</span> <span class="nf">mkcounter</span><span class="p">(</span><span class="n">start</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">next</span><span class="p">():</span>
        <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">prev</span><span class="p">():</span>
        <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">bump</span><span class="p">(</span><span class="n">incr</span><span class="p">):</span>
        <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">incr</span>
        <span class="k">return</span> <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">():</span>
        <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">start</span>
        <span class="k">return</span> <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">&#39;next&#39;</span><span class="p">:</span> <span class="nb">next</span><span class="p">,</span> <span class="s">&#39;prev&#39;</span><span class="p">:</span> <span class="n">prev</span><span class="p">,</span> <span class="s">&#39;get&#39;</span><span class="p">:</span> <span class="n">get</span><span class="p">,</span> <span class="s">&#39;set&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">,</span>
        <span class="s">&#39;bump&#39;</span><span class="p">:</span> <span class="n">bump</span><span class="p">,</span> <span class="s">&#39;reset&#39;</span><span class="p">:</span> <span class="n">reset</span><span class="p">,</span> <span class="s">&#39;last&#39;</span><span class="p">:</span> <span class="n">prev</span><span class="p">}</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_11.8</span>
<span class="c">#-----------------------------</span>
<span class="n">mref</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">meth</span>
<span class="c"># later...</span>
<span class="n">mref</span><span class="p">(</span><span class="s">&quot;args&quot;</span><span class="p">,</span> <span class="s">&quot;go&quot;</span><span class="p">,</span> <span class="s">&quot;here&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_11.9</span>
<span class="c">#-----------------------------</span>
<span class="n">record</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="s">&quot;Jason&quot;</span><span class="p">,</span>
    <span class="s">&quot;empno&quot;</span><span class="p">:</span> <span class="mi">132</span><span class="p">,</span>
    <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="s">&quot;deputy peon&quot;</span><span class="p">,</span>
    <span class="s">&quot;age&quot;</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span>
    <span class="s">&quot;salary&quot;</span><span class="p">:</span> <span class="mi">37000</span><span class="p">,</span>
    <span class="s">&quot;pals&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;Norbert&quot;</span><span class="p">,</span> <span class="s">&quot;Rhys&quot;</span><span class="p">,</span> <span class="s">&quot;Phineas&quot;</span><span class="p">],</span>
<span class="p">}</span>
<span class="k">print</span> <span class="s">&quot;I am </span><span class="si">%s</span><span class="s">, and my pals are </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">],</span>
                                        <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s">&quot;pals&quot;</span><span class="p">]))</span>
<span class="c">#-----------------------------</span>
<span class="n">byname</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">byname</span><span class="p">[</span><span class="n">record</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">record</span>

<span class="n">rp</span> <span class="o">=</span> <span class="n">byname</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;Aron&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">rp</span><span class="p">:</span>
     <span class="k">print</span> <span class="s">&quot;Aron is employee </span><span class="si">%d</span><span class="s">.&quot;</span><span class="o">%</span> <span class="n">rp</span><span class="p">[</span><span class="s">&quot;empno&quot;</span><span class="p">]</span>

<span class="n">byname</span><span class="p">[</span><span class="s">&quot;Jason&quot;</span><span class="p">][</span><span class="s">&quot;pals&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;Theodore&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Jason now has </span><span class="si">%d</span><span class="s"> pals.&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">byname</span><span class="p">[</span><span class="s">&quot;Jason&quot;</span><span class="p">][</span><span class="s">&quot;pals&quot;</span><span class="p">])</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">byname</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> is employee number </span><span class="si">%d</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="s">&quot;empno&quot;</span><span class="p">])</span>

<span class="n">employees</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">employees</span><span class="p">[</span><span class="n">record</span><span class="p">[</span><span class="s">&quot;empno&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">record</span><span class="p">;</span>

<span class="c"># lookup by id</span>
<span class="n">rp</span> <span class="o">=</span> <span class="n">employees</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">rp</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Employee number 132 is </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">rp</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span>

<span class="n">byname</span><span class="p">[</span><span class="s">&quot;Jason&quot;</span><span class="p">][</span><span class="s">&quot;salary&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">1.035</span>

<span class="n">peons</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">employees</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s">&quot;title&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;peon&quot;</span><span class="p">]</span>
<span class="n">tsevens</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">employees</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s">&quot;age&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">27</span><span class="p">]</span>

<span class="c"># Go through all records</span>
<span class="k">print</span> <span class="n">employees</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

<span class="k">for</span> <span class="n">rp</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">employees</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="s">&quot;age&quot;</span><span class="p">]):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> is age </span><span class="si">%d</span><span class="s">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">rp</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">],</span> <span class="n">rp</span><span class="p">[</span><span class="s">&quot;age&quot;</span><span class="p">])</span>

<span class="c"># use @byage, an array of arrays of records</span>
<span class="n">byage</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">byage</span><span class="p">[</span><span class="n">record</span><span class="p">[</span><span class="s">&quot;age&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">byage</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s">&quot;age&quot;</span><span class="p">],</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">[</span><span class="n">record</span><span class="p">]</span>

<span class="k">for</span> <span class="n">age</span><span class="p">,</span> <span class="n">records</span> <span class="ow">in</span> <span class="n">byage</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">records</span>
    <span class="k">print</span> <span class="s">&quot;Age </span><span class="si">%s</span><span class="s">:&quot;</span><span class="o">%</span><span class="n">age</span><span class="p">,</span>
    <span class="k">for</span> <span class="n">rp</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">rp</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">],</span>
    <span class="k">print</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_11.10</span>
<span class="c">#-----------------------------</span>
<span class="n">FieldName</span><span class="p">:</span> <span class="n">Value</span>
<span class="c">#-----------------------------</span>
<span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">list_of_records</span><span class="p">:</span>
    <span class="c"># Note: sorted added in Python 2.4</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">record</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="k">print</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">list_of_records</span> <span class="o">=</span> <span class="p">[{}]</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
        <span class="c"># EOF</span>
        <span class="k">break</span>
    <span class="c"># Remove trailing \n:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="c"># New record</span>
        <span class="n">list_of_records</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
        <span class="k">continue</span>
    <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&#39;:\s*&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c"># Assign the key/value to the last item in the list_of_records:</span>
    <span class="n">list_of_records</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="c">#-----------------------------</span>
<span class="c"># @@PLEAC@@_11.11</span>
<span class="kn">import</span> <span class="nn">pprint</span>

<span class="n">mylist</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]],</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="n">mydict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;abc&quot;</span><span class="p">:</span> <span class="s">&quot;def&quot;</span><span class="p">,</span> <span class="s">&quot;ghi&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]}</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">mylist</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">fmtdict</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">mydict</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span> <span class="n">fmtdict</span>
<span class="c"># &quot;import pprint; help(pprint)&quot; for more details</span>

<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># Note that pprint does not currently handle user objects</span>

<span class="c">#-----------------------------</span>
<span class="c"># @@PLEAC@@_11.12</span>
<span class="n">newlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span> <span class="c"># shallow copy</span>
<span class="n">newdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mydict</span><span class="p">)</span> <span class="c"># shallow copy</span>

<span class="c"># Pre 2.3:</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="n">newlist</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span> <span class="c"># shallow copy</span>
<span class="n">newdict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mydict</span><span class="p">)</span> <span class="c"># shallow copy</span>

<span class="c"># shallow copies copy a data structure, but don&#39;t copy the items in those</span>
<span class="c"># data structures so if there are nested data structures, both copy and</span>
<span class="c"># original will refer to the same object</span>
<span class="n">mylist</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="s">&quot;2&quot;</span><span class="p">,</span> <span class="s">&quot;3&quot;</span><span class="p">]</span>
<span class="n">newlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span>
<span class="n">mylist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;0&quot;</span>
<span class="k">print</span> <span class="n">mylist</span><span class="p">,</span> <span class="n">newlist</span>
<span class="c">#=&gt; [&#39;0&#39;, &#39;2&#39;, &#39;3&#39;] [&#39;1&#39;, &#39;2&#39;, &#39;3&#39;]</span>

<span class="n">mylist</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="s">&quot;2&quot;</span><span class="p">,</span> <span class="s">&quot;3&quot;</span><span class="p">],</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">newlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span>
<span class="n">mylist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;0&quot;</span>
<span class="k">print</span> <span class="n">mylist</span><span class="p">,</span> <span class="n">newlist</span>
<span class="c">#=&gt; [[&#39;0&#39;, &#39;2&#39;, &#39;3&#39;], 4] [[&#39;0&#39;, &#39;2&#39;, &#39;3&#39;], 4]</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="n">newlist</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span> <span class="c"># deep copy</span>
<span class="n">newdict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mydict</span><span class="p">)</span> <span class="c"># deep copy</span>

<span class="c"># deep copies copy a data structure recursively:</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="n">mylist</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="s">&quot;2&quot;</span><span class="p">,</span> <span class="s">&quot;3&quot;</span><span class="p">],</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">newlist</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mylist</span><span class="p">)</span>
<span class="n">mylist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;0&quot;</span>
<span class="k">print</span> <span class="n">mylist</span><span class="p">,</span> <span class="n">newlist</span>
<span class="c">#=&gt; [[&#39;0&#39;, &#39;2&#39;, &#39;3&#39;], 4] [[&#39;1&#39;, &#39;2&#39;, &#39;3&#39;], 4]</span>
<span class="c">#-----------------------------</span>
<span class="c"># @@PLEAC@@_11.13</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="n">x</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">p_x</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c"># Also pickle.dump(x, myfile) which writes to myfile</span>
<span class="k">del</span> <span class="n">x</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">p_x</span><span class="p">)</span>  <span class="c"># Also x = pickle.load(myfile) which loads from myfile</span>
<span class="k">print</span> <span class="n">x</span><span class="o">.</span><span class="n">val</span>
<span class="c">#=&gt; 3</span>
<span class="c">#-----------------------------</span>
<span class="c"># @@PLEAC@@_11.14</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">shelve</span>
<span class="n">fname</span> <span class="o">=</span> <span class="s">&quot;testfile.db&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;testfile.db&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100000</span><span class="p">):</span>
        <span class="n">d</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">i</span>
    <span class="n">d</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;testfile.db&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">d</span><span class="p">[</span><span class="s">&quot;100&quot;</span><span class="p">]</span>
<span class="k">print</span> <span class="n">d</span><span class="p">[</span><span class="s">&quot;1212010201&quot;</span><span class="p">]</span> <span class="c"># KeyError</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_11.15</span>
<span class="c"># bintree - binary tree demo program</span>
<span class="c"># Use the heapq module instead?</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="k">class</span> <span class="nc">BTree</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="c">### insert given value into proper point of</span>
    <span class="c">### the tree, extending this node if necessary.</span>
    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">BTree</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">BTree</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;Duplicate insertion of </span><span class="si">%s</span><span class="s">.&quot;</span><span class="o">%</span><span class="n">value</span><span class="p">)</span>
            
    <span class="c"># recurse on left child, </span>
    <span class="c"># then show current value, </span>
    <span class="c"># then recurse on right child.</span>
    <span class="k">def</span> <span class="nf">in_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
       <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">in_order</span><span class="p">()</span>
           <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">in_order</span><span class="p">()</span>

    <span class="c"># show current value, </span>
    <span class="c"># then recurse on left child, </span>
    <span class="c"># then recurse on right child.</span>
    <span class="k">def</span> <span class="nf">pre_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">pre_order</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">pre_order</span><span class="p">()</span>
    
    <span class="c"># recurse on left child, </span>
    <span class="c"># then recurse on right child,</span>
    <span class="c"># then show current value. </span>
    <span class="k">def</span> <span class="nf">post_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">post_order</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">post_order</span><span class="p">()</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>

    <span class="c"># find out whether provided value is in the tree.</span>
    <span class="c"># if so, return the node at which the value was found.</span>
    <span class="c"># cut down search time by only looking in the correct</span>
    <span class="c"># branch, based on current value.</span>
    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">BTree</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
        <span class="n">root</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>

    <span class="c"># now dump out the tree all three ways</span>
    <span class="k">print</span> <span class="s">&quot;Pre order: &quot;</span><span class="p">,</span> <span class="n">root</span><span class="o">.</span><span class="n">pre_order</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&quot;In order:  &quot;</span><span class="p">,</span> <span class="n">root</span><span class="o">.</span><span class="n">in_order</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&quot;Post order:&quot;</span><span class="p">,</span> <span class="n">root</span><span class="o">.</span><span class="n">post_order</span><span class="p">()</span>

    <span class="c">### prompt until empty line</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;Search? &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="n">found</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Found </span><span class="si">%s</span><span class="s"> at </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">found</span><span class="p">,</span> <span class="n">found</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;No </span><span class="si">%s</span><span class="s"> in tree&quot;</span> <span class="o">%</span> <span class="n">val</span>
            
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">test</span><span class="p">()</span>


<span class="c"># ^^PLEAC^^_12.0</span>
<span class="c">#-----------------------------</span>
<span class="c">## Python&#39;s &quot;module&quot; is the closest equivalent to Perl&#39;s &quot;package&quot;</span>


<span class="c">#=== In the file &quot;Alpha.py&quot;</span>
<span class="n">name</span> <span class="o">=</span> <span class="s">&quot;first&quot;</span>

<span class="c">#=== End of file</span>

<span class="c">#=== In the file &quot;Omega.py&quot;</span>

<span class="n">name</span> <span class="o">=</span> <span class="s">&quot;last&quot;</span>
<span class="c">#=== End of file</span>

<span class="kn">import</span> <span class="nn">Alpha</span><span class="o">,</span> <span class="nn">Omega</span>
<span class="k">print</span> <span class="s">&quot;Alpha is </span><span class="si">%s</span><span class="s">, Omega is </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Alpha</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Omega</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="c">#&gt; Alpha is first, Omega is last.</span>
<span class="c">#-----------------------------</span>
<span class="c"># Python does not have an equivalent to &quot;compile-time load&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c"># Depending on the implementation, this could use a builtin</span>
<span class="c"># module or load a file with the extension .py, .pyc, pyo, .pyd,</span>
<span class="c"># .so, .dll, or (with imputils) load from other files.</span>
<span class="kn">import</span> <span class="nn">Cards.Poker</span>

<span class="c">#-----------------------------</span>
<span class="c">#=== In the file Cards/Poker.py</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;card_deck&quot;</span><span class="p">,</span> <span class="s">&quot;shuffle&quot;</span><span class="p">]</span>  <span class="c"># not usually needed</span>
<span class="n">card_deck</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">def</span> <span class="nf">shuffle</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_12.1</span>
<span class="c">#-----------------------------</span>
<span class="c">#== In the file &quot;YourModule.py&quot;</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>          <span class="c"># Or higher</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;...&quot;</span><span class="p">,</span> <span class="s">&quot;...&quot;</span><span class="p">]</span>      <span class="c"># Override names included in &quot;... import *&quot;</span>
                              <span class="c">#   Note: &#39;import *&#39; is considered poor style</span>
                              <span class="c">#   and it is rare to use this variable.</span>
<span class="c">########################</span>
<span class="c"># your code goes here</span>
<span class="c">########################</span>

<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">YourModule</span>             <span class="c"># Import the module into my package</span>
                              <span class="c">#  (does not import any of its symbols)</span>

<span class="kn">import</span> <span class="nn">YourModule</span> <span class="kn">as</span> <span class="nn">Module</span>   <span class="c"># Use a different name for the module</span>

<span class="kn">from</span> <span class="nn">YourModule</span> <span class="kn">import</span> <span class="o">*</span>      <span class="c"># Import all module symbols not starting</span>
                              <span class="c">#  with an underscore (default); if __all__</span>
                              <span class="c">#  is defined, only imports those symbols.</span>
                              <span class="c"># Using this is discouraged unless the </span>
                              <span class="c">#  module is specifically designed for it.</span>

<span class="kn">from</span> <span class="nn">YourModule</span> <span class="kn">import</span> <span class="n">name1</span><span class="p">,</span> <span class="n">name2</span><span class="p">,</span> <span class="n">xxx</span>
                              <span class="c"># Import the named symbols from the module</span>

<span class="kn">from</span> <span class="nn">YourModule</span> <span class="kn">import</span> <span class="n">name1</span> <span class="k">as</span> <span class="n">name2</span>
                              <span class="c"># Import the named object, but use a</span>
                              <span class="c">#  different name to access it locally.</span>

<span class="c">#-----------------------------</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;F1&quot;</span><span class="p">,</span> <span class="s">&quot;F2&quot;</span><span class="p">,</span> <span class="s">&quot;List&quot;</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Op_Func&quot;</span><span class="p">,</span> <span class="s">&quot;Table&quot;</span><span class="p">]</span>
<span class="c">#-----------------------------</span>
<span class="kn">from</span> <span class="nn">YourModule</span> <span class="kn">import</span> <span class="n">Op_Func</span><span class="p">,</span> <span class="n">Table</span><span class="p">,</span> <span class="n">F1</span>
<span class="c">#-----------------------------</span>
<span class="kn">from</span> <span class="nn">YourModule</span> <span class="kn">import</span> <span class="n">Functions</span><span class="p">,</span> <span class="n">Table</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_12.2</span>
<span class="c">#-----------------------------</span>
<span class="c"># no import</span>
<span class="n">mod</span> <span class="o">=</span> <span class="s">&quot;module&quot;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="nb">__import__</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&quot;couldn&#39;t load </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>

<span class="c"># imports into current package</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">module</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&quot;couldn&#39;t load &#39;module&#39;: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="p">))</span>

<span class="c"># imports into current package, if the name is known</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">module</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&quot;couldn&#39;t load &#39;module&#39;: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="p">))</span>

<span class="c"># Use a fixed local name for a named module</span>
<span class="n">mod</span> <span class="o">=</span> <span class="s">&quot;module&quot;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">local_name</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&quot;couldn&#39;t load </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>

<span class="c"># Use the given name for the named module.</span>
<span class="c"># (You probably don&#39;t need to do this.)</span>
<span class="n">mod</span> <span class="o">=</span> <span class="s">&quot;module&quot;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="nb">globals</span><span class="p">()[</span><span class="n">mod</span><span class="p">]</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&quot;couldn&#39;t load </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>

<span class="c">#-----------------------------</span>
<span class="n">DBs</span> <span class="o">=</span> <span class="s">&quot;Giant.Eenie Giant.Meanie Mouse.Mynie Moe&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="n">DBs</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">loaded_module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="c"># __import__ returns a reference to the top-most module</span>
    <span class="c"># Need to get the actual submodule requested.</span>
    <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">mod</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">loaded_module</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">loaded_module</span><span class="p">,</span> <span class="n">term</span><span class="p">)</span>
    <span class="k">break</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&quot;None of </span><span class="si">%s</span><span class="s"> loaded&quot;</span> <span class="o">%</span> <span class="n">DBs</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_12.3</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> \
                          <span class="ow">or</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s">&quot;usage: </span><span class="si">%s</span><span class="s"> num1 num2&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="kn">import</span> <span class="nn">Some.Module</span>
<span class="kn">import</span> <span class="nn">More.Modules</span>
<span class="c">#-----------------------------</span>
<span class="k">if</span> <span class="n">opt_b</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">math</span>
<span class="c">#-----------------------------</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">O_EXCL</span><span class="p">,</span> <span class="n">O_CREAT</span><span class="p">,</span> <span class="n">O_RDWR</span>

<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">O_EXCL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">O_EXCL</span>
<span class="n">O_CREAT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span>
<span class="n">O_RDWR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RDWR</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">O_EXCL</span><span class="p">,</span> <span class="n">O_CREAT</span><span class="p">,</span> <span class="n">O_RDWR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">O_EXCL</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RDWR</span>
<span class="c">#-----------------------------</span>
<span class="n">load_module</span><span class="p">(</span><span class="s">&#39;os&#39;</span><span class="p">,</span> <span class="s">&quot;O_EXCL O_CREAT O_RDWR&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">load_module</span><span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">symbols</span><span class="p">):</span>
    <span class="n">module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">:</span>
        <span class="nb">globals</span><span class="p">()[</span><span class="n">symbol</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_12.4</span>
<span class="c">#-----------------------------</span>
<span class="c"># Python doesn&#39;t have Perl-style packages</span>

<span class="c"># Flipper.py</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;flip_boundary&quot;</span><span class="p">,</span> <span class="s">&quot;flip_words&quot;</span><span class="p">]</span>

<span class="n">Separatrix</span> <span class="o">=</span> <span class="s">&#39; &#39;</span>  <span class="c"># default to blank</span>

<span class="k">def</span> <span class="nf">flip_boundary</span><span class="p">(</span><span class="n">sep</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="n">prev_sep</span> <span class="o">=</span> <span class="n">Separatrix</span>
    <span class="k">if</span> <span class="n">sep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">global</span> <span class="n">Separatrix</span>
        <span class="n">Separatrix</span> <span class="o">=</span> <span class="n">sep</span>
    <span class="k">return</span> <span class="n">prev_sep</span>

<span class="k">def</span> <span class="nf">flip_words</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">Separatrix</span><span class="p">)</span>
    <span class="n">words</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">Separatrix</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_12.5</span>
<span class="c">#-----------------------------</span>
<span class="n">this_pack</span> <span class="o">=</span> <span class="n">__name__</span>
<span class="c">#-----------------------------</span>
<span class="n">that_pack</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">f_globals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;__name__&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;string&gt;&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">print</span> <span class="s">&quot;I am in package&quot;</span><span class="p">,</span> <span class="n">__name__</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">nreadline</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">myfile</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Count must be &gt; 0&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">myfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">myfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;/etc/termcap&quot;</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">nreadline</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">myfile</span><span class="p">)</span>
    <span class="n">myfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>

<span class="c"># DON&#39;T DO THIS:</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">nreadline</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">handle_name</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;count must be &gt; 0&quot;</span>
    <span class="nb">locals</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">f_locals</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">locals</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">handle_name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&quot;need open filehandle&quot;</span><span class="p">)</span>
    <span class="n">infile</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">[</span><span class="n">handle_name</span><span class="p">]</span>
    <span class="n">retlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
        <span class="n">retlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">retlist</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">FH</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;/etc/termcap&quot;</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">nreadline</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s">&quot;FH&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_12.6</span>
<span class="c">#-----------------------------</span>
<span class="c">## There is no direct equivalent in Python to an END block</span>
<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>

<span class="c"># Tricks to ensure the needed functions exist during module cleanup</span>
<span class="k">def</span> <span class="nf">_getgmtime</span><span class="p">(</span><span class="n">asctime</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">,</span> <span class="n">gmtime</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">,</span>
               <span class="n">t</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">asctime</span><span class="p">(</span><span class="n">gmtime</span><span class="p">(</span><span class="n">t</span><span class="p">()))</span>

<span class="k">class</span> <span class="nc">Logfile</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="nb">file</span>

    <span class="k">def</span> <span class="nf">_logmsg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">argv0</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pid</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span>
                <span class="n">_getgmtime</span><span class="o">=</span><span class="n">_getgmtime</span><span class="p">):</span>
        <span class="c"># more tricks to keep all needed references</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">_getgmtime</span><span class="p">()</span>
        <span class="k">print</span><span class="o">&gt;&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="n">argv0</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">now</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">logmsg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logmsg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logmsg</span><span class="p">(</span><span class="s">&quot;shutdown&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="c"># forward everything else to the file handle</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

<span class="c"># 0 means unbuffered</span>
<span class="n">LF</span> <span class="o">=</span> <span class="n">Logfile</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&quot;/tmp/mylog&quot;</span><span class="p">,</span> <span class="s">&quot;a+&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">logmsg</span> <span class="o">=</span> <span class="n">LF</span><span class="o">.</span><span class="n">logmsg</span>

<span class="c">#-----------------------------</span>
<span class="c">## It is more appropriate to use try/finally around the</span>
<span class="c">## main code, so the order of initialization and finalization</span>
<span class="c">## can be specified.</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">logger</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="s">&quot;/tmp/mylog&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">main</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_12.7</span>
<span class="c">#-----------------------------</span>
<span class="c">#% python -c &#39;import sys\</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">maxint</span><span class="p">),</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>\
    <span class="k">print</span> <span class="n">i</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="c">#&gt; 0 &#39;&#39;</span>
<span class="c">#&gt; 1 &#39;/usr/lib/python2.2&#39;</span>
<span class="c">#&gt; 2 &#39;/usr/lib/python2.2/plat-linux2&#39;</span>
<span class="c">#&gt; 3 &#39;/usr/lib/python2.2/lib-tk&#39;</span>
<span class="c">#-----------------------------</span>
<span class="c"># syntax for sh, bash, ksh, or zsh</span>
<span class="c">#$ export PYTHONPATH=$HOME/pythonlib</span>

<span class="c"># syntax for csh or tcsh</span>
<span class="c">#% setenv PYTHONPATH ~/pythonlib</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;/projects/spectre/lib&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">FindBin</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">FindBin</span><span class="o">.</span><span class="n">Bin</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">FindBin</span>
<span class="n">Bin</span> <span class="o">=</span> <span class="s">&quot;Name&quot;</span>
<span class="nb">bin</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">FindBin</span><span class="p">,</span> <span class="n">Bin</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">bin</span> <span class="o">+</span> <span class="s">&quot;/../lib&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_12.8</span>
<span class="c">#-----------------------------</span>
<span class="c">#% h2xs -XA -n Planets</span>
<span class="c">#% h2xs -XA -n Astronomy::Orbits</span>
<span class="c">#-----------------------------</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># Need a distutils example</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_12.9</span>
<span class="c">#-----------------------------</span>
<span class="c"># Python compiles a file to bytecode the first time it is imported and </span>
<span class="c"># stores this compiled form in a .pyc file.  There is thus less need for</span>
<span class="c"># incremental compilation as once there is a .pyc file, the sourcecode</span>
<span class="c"># is only recompiled if it is modified.  </span>

<span class="c"># ^^PLEAC^^_12.10</span>
<span class="c">#-----------------------------</span>
<span class="c"># See previous section</span>

<span class="c"># ^^PLEAC^^_12.11</span>
<span class="c">#-----------------------------</span>
<span class="c">## Any definition in a Python module overrides the builtin</span>
<span class="c">## for that module</span>

<span class="c">#=== In MyModule</span>
<span class="k">def</span> <span class="nf">open</span><span class="p">():</span>
    <span class="k">pass</span> <span class="c"># TBA</span>
<span class="c">#-----------------------------</span>
<span class="kn">from</span> <span class="nn">MyModule</span> <span class="kn">import</span> <span class="nb">open</span>
<span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">()</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_12.12</span>
<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">even_only</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>     <span class="c"># one way to test</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> is not even&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,))</span>
    <span class="c">#....</span>

<span class="c">#-----------------------------</span>
<span class="k">def</span> <span class="nf">even_only</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>    <span class="c"># here&#39;s another</span>
        <span class="c"># choice of exception depends on the problem</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> is not even&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,))</span>
    <span class="c">#....</span>

<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="k">def</span> <span class="nf">even_only</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>           <span class="c"># test whether odd number</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> is not even, continuing&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c">#....</span>
<span class="c">#-----------------------------</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s">&quot;ignore&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_12.13</span>
<span class="c">#-----------------------------</span>
<span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">__import__</span><span class="p">(</span><span class="n">packname</span><span class="p">),</span> <span class="n">varname</span><span class="p">)</span>
<span class="n">vals</span> <span class="o">=</span>  <span class="nb">getattr</span><span class="p">(</span><span class="nb">__import__</span><span class="p">(</span><span class="n">packname</span><span class="p">),</span> <span class="n">aryname</span><span class="p">)</span>
<span class="nb">getattr</span><span class="p">(</span><span class="nb">__import__</span><span class="p">(</span><span class="n">packname</span><span class="p">),</span> <span class="n">funcname</span><span class="p">)(</span><span class="s">&quot;args&quot;</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="c"># DON&#39;T DO THIS [Use math.log(val, base) instead]</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="k">def</span> <span class="nf">make_log</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">logn</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">logn</span>

<span class="c"># Modifying the global dictionary - this could also be done</span>
<span class="c"># using locals(), or someobject.__dict__</span>
<span class="n">globaldict</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1000</span><span class="p">):</span>
    <span class="n">globaldict</span><span class="p">[</span><span class="s">&quot;log</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_log</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="c"># DON&#39;T DO THIS</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1000</span><span class="p">):</span>
    <span class="k">exec</span> <span class="s">&quot;log</span><span class="si">%s</span><span class="s"> = make_log(i)&quot;</span><span class="o">%</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span>
    
<span class="k">print</span> <span class="n">log20</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
<span class="c">#=&gt;2.0</span>
<span class="c">#-----------------------------</span>
<span class="n">blue</span> <span class="o">=</span> <span class="n">colours</span><span class="o">.</span><span class="n">blue</span>
<span class="n">someobject</span><span class="o">.</span><span class="n">blue</span> <span class="o">=</span> <span class="n">colours</span><span class="o">.</span><span class="n">azure</span>  <span class="c"># someobject could be a module...</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_12.14</span>
<span class="c">#-----------------------------</span>
<span class="c"># Python extension modules can be imported and used just like</span>
<span class="c"># a pure python module.</span>
<span class="c">#</span>
<span class="c"># See http://www.cosc.canterbury.ac.nz/~greg/python/Pyrex/ for</span>
<span class="c"># information on how to create extension modules in Pyrex [a</span>
<span class="c"># language that&#39;s basically Python with type definitions which</span>
<span class="c"># converts to compiled C code]</span>
<span class="c">#</span>
<span class="c"># See http://www.boost.org/libs/python/doc/ for information on how</span>
<span class="c"># to create extension modules in C++.</span>
<span class="c">#</span>
<span class="c"># See http://www.swig.org/Doc1.3/Python.html for information on how</span>
<span class="c"># to create extension modules in C/C++</span>
<span class="c">#</span>
<span class="c"># See http://docs.python.org/ext/ext.html for information on how to</span>
<span class="c"># create extension modules in C/C++ (manual reference count management).</span>
<span class="c">#</span>
<span class="c"># See http://cens.ioc.ee/projects/f2py2e/ for information on how to</span>
<span class="c"># create extension modules in Fortran</span>
<span class="c">#</span>
<span class="c"># See http://www.scipy.org/Weave for information on how to </span>
<span class="c"># include inline C code in Python code.</span>
<span class="c">#</span>
<span class="c"># @@INCOMPLETE@@ Need examples of FineTime extensions using the different methods...</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_12.15</span>
<span class="c">#-----------------------------</span>
<span class="c"># See previous section</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_12.16</span>
<span class="c">#-----------------------------</span>
<span class="c"># To document code, use docstrings. A docstring is a bare string that</span>
<span class="c"># is placed at the beginning of a module or immediately after the </span>
<span class="c"># definition line of a class, method, or function. Normally, the</span>
<span class="c"># first line is a brief description of the object; if a longer</span>
<span class="c"># description is needed, it commences on the third line (the second</span>
<span class="c"># line being left blank).  Multiline comments should use triple</span>
<span class="c"># quoted strings.</span>
<span class="c"># </span>
<span class="c"># Docstrings are automagically assigned to an object&#39;s __doc__ property.</span>
<span class="c">#</span>
<span class="c"># In other words these three classes are identical:</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="s">&quot;A class demonstrating docstrings.&quot;</span>

<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__doc__</span> <span class="o">=</span> <span class="s">&quot;A class demonstrating docstrings.&quot;</span>

<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="n">Foo</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s">&quot;A class demonstrating docstrings.&quot;</span>

<span class="c"># as are these two functions:</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="s">&quot;A function demonstrating docstrings.&quot;</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">pass</span>
<span class="n">foo</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="s">&quot;A function demonstrating docstrings.&quot;</span>

<span class="c"># the pydoc module is used to display a range of information about </span>
<span class="c"># an object including its docstrings:</span>
<span class="kn">import</span> <span class="nn">pydoc</span> 
<span class="k">print</span> <span class="n">pydoc</span><span class="o">.</span><span class="n">getdoc</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">pydoc</span><span class="o">.</span><span class="n">help</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c"># In the interactive interpreter, objects&#39; documentation can be </span>
<span class="c"># using the help function:</span>
<span class="n">help</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_12.17</span>
<span class="c">#-----------------------------</span>
<span class="c"># Recent Python distributions are built and installed with disutils.</span>
<span class="c"># </span>
<span class="c"># To build and install under unix</span>
<span class="c"># </span>
<span class="c"># % python setup.py install</span>
<span class="c"># </span>
<span class="c"># If you want to build under one login and install under another</span>
<span class="c"># </span>
<span class="c"># % python setup.py build</span>
<span class="c"># $ python setup.py install</span>
<span class="c"># </span>
<span class="c"># A package may also be available prebuilt, eg, as an RPM or Windows</span>
<span class="c"># installer.  Details will be specific to the operating system.</span>

<span class="c">#-----------------------------</span>
<span class="c"># % python setup.py --prefix ~/python-lib</span>
<span class="c">#-----------------------------</span>


<span class="c"># ^^PLEAC^^_12.18</span>
<span class="c">#-----------------------------</span>
<span class="c">#== File Some/Module.py</span>

<span class="c"># There are so many differences between Python and Perl that</span>
<span class="c"># it isn&#39;t worthwhile trying to come up with an equivalent to</span>
<span class="c"># this Perl code.  The Python code is much smaller, and there&#39;s</span>
<span class="c"># no need to have a template.</span>

<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_12.19</span>
<span class="c">#-----------------------------</span>
<span class="c">#% pmdesc</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">pydoc</span>

<span class="k">def</span> <span class="nf">print_module_info</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="n">desc</span><span class="p">):</span>
   <span class="c"># Skip files starting with &quot;test_&quot;</span>
   <span class="k">if</span> <span class="n">modname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;test_&quot;</span><span class="p">):</span>
       <span class="k">return</span>
   <span class="k">try</span><span class="p">:</span>
       <span class="c"># This assumes the modules are safe for importing,</span>
       <span class="c"># in that they don&#39;t have side effects.  Could also</span>
       <span class="c"># grep the file for the __version__ line.</span>
       <span class="n">mod</span> <span class="o">=</span> <span class="n">pydoc</span><span class="o">.</span><span class="n">safeimport</span><span class="p">(</span><span class="n">modname</span><span class="p">)</span>
   <span class="k">except</span> <span class="n">pydoc</span><span class="o">.</span><span class="n">ErrorDuringImport</span><span class="p">:</span>
       <span class="k">return</span>
   <span class="n">version</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="s">&quot;__version__&quot;</span><span class="p">,</span> <span class="s">&quot;unknown&quot;</span><span class="p">)</span>
   <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)):</span>
       <span class="c"># Use the string if it&#39;s given</span>
       <span class="k">pass</span>
   <span class="k">else</span><span class="p">:</span>
       <span class="c"># Assume it&#39;s a list of version numbers, from major to minor</span>
       <span class="s">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">))</span>
   <span class="n">synopsis</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="n">pydoc</span><span class="o">.</span><span class="n">splitdoc</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span>
   <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">) - </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">synopsis</span><span class="p">)</span>

<span class="n">scanner</span> <span class="o">=</span> <span class="n">pydoc</span><span class="o">.</span><span class="n">ModuleScanner</span><span class="p">()</span>
<span class="n">scanner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">print_module_info</span><span class="p">)</span>

<span class="c">#-----------------------------</span>


<span class="c"># ^^PLEAC^^_13.0</span>
<span class="c">#-----------------------------</span>
<span class="c"># Inside a module named &#39;Data&#39; / file named &#39;Data.py&#39;</span>
<span class="k">class</span> <span class="nc">Encoder</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="c">#-----------------------------</span>
<span class="n">obj</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">ob</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c">## Changing the class of builtin types is not supported</span>
<span class="c">## in Python.</span>

<span class="c">#-----------------------------</span>
<span class="n">obj</span><span class="o">.</span><span class="n">Stomach</span> <span class="o">=</span> <span class="s">&quot;Empty&quot;</span>    <span class="c"># directly accessing an object&#39;s contents</span>
<span class="n">obj</span><span class="o">.</span><span class="n">NAME</span> <span class="o">=</span> <span class="s">&quot;Thag&quot;</span>        <span class="c"># uppercase field name to make it stand out</span>
<span class="p">(</span><span class="n">optional</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">encoded</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">encoded</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">Encoder</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">class</span> <span class="nc">Class</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
<span class="c">#-----------------------------</span>
<span class="nb">object</span> <span class="o">=</span> <span class="n">Class</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="k">class</span> <span class="nc">Class</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">class_only_method</span><span class="p">():</span>
        <span class="k">pass</span> <span class="c"># more code here</span>
    <span class="n">class_only_method</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">class_only_method</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="k">class</span> <span class="nc">Class</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">instance_only_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span> <span class="c"># more code here</span>
<span class="c">#-----------------------------</span>
<span class="n">lector</span> <span class="o">=</span> <span class="n">Human</span><span class="o">.</span><span class="n">Cannibal</span><span class="p">()</span>
<span class="n">lector</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="s">&quot;Zak&quot;</span><span class="p">)</span>
<span class="n">lector</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="s">&quot;New York&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># NOTE: it is rare to use these forms except inside of</span>
<span class="c"># methods to call specific methods from a parent class</span>
<span class="n">lector</span> <span class="o">=</span> <span class="n">Human</span><span class="o">.</span><span class="n">Cannibal</span><span class="p">()</span>
<span class="n">Human</span><span class="o">.</span><span class="n">Cannibal</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">lector</span><span class="p">,</span> <span class="s">&quot;Zak&quot;</span><span class="p">)</span>
<span class="n">Human</span><span class="o">.</span><span class="n">Cannibal</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">lector</span><span class="p">,</span> <span class="s">&quot;New York&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">print</span><span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;stuff here</span><span class="se">\n</span><span class="s">&quot;</span>

<span class="c"># ^^PLEAC^^_13.1</span>
<span class="c">#-----------------------------</span>
<span class="k">class</span> <span class="nc">Class</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">class</span> <span class="nc">Class</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>  <span class="c"># init data fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">class</span> <span class="nc">Class</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c"># Sets self.start to the current time, and self.age to 0.  If called</span>
        <span class="c"># with arguments, interpret them as key+value pairs to</span>
        <span class="c"># initialize the object with</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_13.2</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">class</span> <span class="nc">Class</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&quot;dying at&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="c">## Why is the perl code introducing a cycle?  I guess it&#39;s an</span>
<span class="c">## example of how to keep from calling the finalizer</span>
<span class="bp">self</span><span class="o">.</span><span class="n">WHATEVER</span> <span class="o">=</span> <span class="bp">self</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_13.3</span>
<span class="c">#-----------------------------</span>
<span class="c"># It is standard practice to access attributes directly:</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;default&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">()</span>
<span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bob&quot;</span>
<span class="k">print</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span>
<span class="n">obj</span><span class="o">.</span><span class="n">age</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c"># If you later find that you need to compute an attribute, you can always </span>
<span class="c"># retrofit a property(), leaving user code untouched:</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;default&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_age</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_name</span><span class="p">,</span> <span class="n">set_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_age</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_age</span>
    <span class="k">def</span> <span class="nf">set_age</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Invalid age: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_age</span> <span class="o">=</span> <span class="n">val</span>
    <span class="n">age</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_age</span><span class="p">,</span> <span class="n">set_age</span><span class="p">)</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">()</span>
<span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bob&quot;</span>
<span class="k">print</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span>
<span class="n">obj</span><span class="o">.</span><span class="n">age</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c"># DON&#39;T DO THIS - explicit getters and setters should not be used:</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;default&quot;</span>
    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">()</span>
<span class="n">obj</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s">&quot;bob&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="c">## DON&#39;T DO THIS (It&#39;s complex, ugly, and unnecessary):</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;name only takes 0 or 1 arguments&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">age</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">prev</span>

<span class="c"># sample call of get and set: happy birthday!</span>
<span class="n">obj</span><span class="o">.</span><span class="n">age</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">age</span><span class="p">())</span>

<span class="c">#-----------------------------</span>
<span class="n">him</span> <span class="o">=</span> <span class="n">Person</span><span class="p">()</span>
<span class="n">him</span><span class="o">.</span><span class="n">NAME</span> <span class="o">=</span> <span class="s">&quot;Sylvester&quot;</span>
<span class="n">him</span><span class="o">.</span><span class="n">AGE</span> <span class="o">=</span> <span class="mi">23</span>
<span class="c">#-----------------------------</span>
<span class="c"># Here&#39;s another way to implement the &#39;obj.method()&#39; is a getter</span>
<span class="c"># and &#39;obj.method(value)&#39; is a settor.  Again, this is not a</span>
<span class="c"># common Python idiom and should not be used.  See below for a</span>
<span class="c"># more common way to do parameter checking of attribute assignment.</span>

<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">carp</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;WARNING: &quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Class</span><span class="p">:</span>
    <span class="n">no_name</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">no_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">Class</span><span class="o">.</span><span class="n">no_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NAME</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enforce_name_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NAME</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_enforce_name_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;[^\s\w&#39;-]&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="n">carp</span><span class="p">(</span><span class="s">&quot;funny characters in name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;\d&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="n">carp</span><span class="p">(</span><span class="s">&quot;numbers in name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;\S+(\s+\S+)+&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="n">carp</span><span class="p">(</span><span class="s">&quot;prefer multiword name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;\S&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="n">carp</span><span class="p">(</span><span class="s">&quot;name is blank&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>   <span class="c"># enforce capitalization</span>
<span class="c">#-----------------------------</span>
<span class="c"># A more typical way to enforce restrictions on a value</span>
<span class="c"># to set</span>
<span class="k">class</span> <span class="nc">Class</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;name&quot;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enforce_name_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>  <span class="c"># Do any conversions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>  <span class="c"># Do the default __setattr__ action</span>

    <span class="k">def</span> <span class="nf">_enforce_name_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;[^\s\w&#39;-]&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="n">carp</span><span class="p">(</span><span class="s">&quot;funny characters in name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;\d&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="n">carp</span><span class="p">(</span><span class="s">&quot;numbers in name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;\S+(\s+\S+)+&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="n">carp</span><span class="p">(</span><span class="s">&quot;prefer multiword name&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;\S&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="n">carp</span><span class="p">(</span><span class="s">&quot;name is blank&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>   <span class="c"># enforce capitalization</span>

<span class="c">#-----------------------------</span>
<span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">peers</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">peers</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">peers</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c"># See Python FAQ 6.25</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peers</span> <span class="o">=</span> <span class="n">peers</span>

    <span class="k">def</span> <span class="nf">exclaim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;Hi, I&#39;m </span><span class="si">%s</span><span class="s">, age </span><span class="si">%d</span><span class="s">, working with </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peers</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">happy_birthday</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_13.4</span>
<span class="c">#-----------------------------</span>
<span class="c">## In the module named &#39;Person&#39; ...</span>
<span class="k">def</span> <span class="nf">population</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Person</span><span class="o">.</span><span class="n">body_count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">body_count</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>        <span class="c"># class variable - shared across all instances</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>      <span class="c"># Beware - may be non-deterministic (Jython)!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>

<span class="c"># later, the user can say this:</span>
<span class="kn">import</span> <span class="nn">Person</span>
<span class="n">people</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">people</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">Person</span><span class="p">())</span>
<span class="k">print</span> <span class="s">&quot;There are&quot;</span><span class="p">,</span> <span class="n">Person</span><span class="o">.</span><span class="n">population</span><span class="p">(),</span> <span class="s">&quot;people alive.&quot;</span>

<span class="c">#=&gt; There are 10 people alive.</span>
<span class="c">#-----------------------------</span>
<span class="n">him</span> <span class="o">=</span> <span class="n">Person</span><span class="p">()</span>
<span class="n">him</span><span class="o">.</span><span class="n">gender</span> <span class="o">=</span> <span class="s">&quot;male&quot;</span>

<span class="n">her</span> <span class="o">=</span> <span class="n">Person</span><span class="p">()</span>
<span class="n">her</span><span class="o">.</span><span class="n">gender</span> <span class="o">=</span> <span class="s">&quot;female&quot;</span>

<span class="c">#-----------------------------</span>
<span class="n">FixedArray</span><span class="o">.</span><span class="n">max_bounds</span> <span class="o">=</span> <span class="mi">100</span>                <span class="c"># set for whole class</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">FixedArray</span><span class="o">.</span><span class="n">FixedArray</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;Bound on alpha is&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">.</span><span class="n">max_bounds</span>
<span class="c">#=&gt;100</span>

<span class="n">beta</span> <span class="o">=</span> <span class="n">FixedArray</span><span class="o">.</span><span class="n">FixedArray</span><span class="p">()</span>
<span class="n">beta</span><span class="o">.</span><span class="n">max_bounds</span> <span class="o">=</span> <span class="mi">50</span>                      <span class="c"># still sets for whole class</span>
<span class="k">print</span> <span class="s">&quot;Bound on alpha is&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">.</span><span class="n">max_bounds</span>
<span class="c">#=&gt;50</span>
<span class="c">#-----------------------------</span>
<span class="c"># In the module named &#39;FixedArray&#39;</span>

<span class="k">class</span> <span class="nc">FixedArray</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">_max_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">]</span>        <span class="c"># Shared across whole class</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">bounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_bounds</span> <span class="o">=</span> <span class="n">bounds</span>

    <span class="k">def</span> <span class="nf">get_max_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">set_max_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
    <span class="n">max_bounds</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_max_bounds</span><span class="p">,</span> <span class="n">set_max_bounds</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_13.5</span>
<span class="c">#-----------------------------</span>
<span class="c"># There isn&#39;t the severe separation between scalar, arrays and hashs</span>
<span class="c"># in Python, so there isn&#39;t a direct equivalent to the Perl code.</span>
<span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">peers</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">peers</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> 
            <span class="n">peers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peers</span> <span class="o">=</span> <span class="n">peers</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s">&quot;Jason Smythe&quot;</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;Wilbur&quot;</span><span class="p">,</span> <span class="s">&quot;Ralph&quot;</span><span class="p">,</span> <span class="s">&quot;Fred&quot;</span><span class="p">])</span>

<span class="c"># or this way.  (This is not the prefered style as objects should</span>
<span class="c"># be constructed with all the appropriate data, if possible.)</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">()</span>  <span class="c"># allocate an empty Person</span>
<span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Jason Smythe&quot;</span>                         <span class="c"># set its name field</span>
<span class="n">p</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">13</span>                                      <span class="c"># set its age field</span>
<span class="n">p</span><span class="o">.</span><span class="n">peers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="p">[</span><span class="s">&quot;Wilbur&quot;</span><span class="p">,</span> <span class="s">&quot;Ralph&quot;</span><span class="p">,</span> <span class="s">&quot;Fred&quot;</span> <span class="p">]</span> <span class="p">)</span>  <span class="c"># set its peers field</span>

<span class="n">p</span><span class="o">.</span><span class="n">peers</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Wilbur&quot;</span><span class="p">,</span> <span class="s">&quot;Ralph&quot;</span><span class="p">,</span> <span class="s">&quot;Fred&quot;</span><span class="p">]</span>

<span class="n">p</span><span class="o">.</span><span class="n">peers</span><span class="p">[:]</span><span class="o">=</span> <span class="p">[</span><span class="s">&quot;Wilbur&quot;</span><span class="p">,</span> <span class="s">&quot;Ralph&quot;</span><span class="p">,</span> <span class="s">&quot;Fred&quot;</span><span class="p">]</span>

<span class="c"># fetch various values, including the zeroth friend</span>
<span class="k">print</span> <span class="s">&quot;At age </span><span class="si">%d</span><span class="s">, </span><span class="si">%s</span><span class="s">&#39;s first friend is </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> \
    <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">peers</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c">#-----------------------------</span>
<span class="c"># This isn&#39;t very Pythonic - should create objects with the</span>
<span class="c"># needed data, and not depend on defaults and modifing the object.</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="k">def</span> <span class="nf">carp</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;WARNING: &quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;age&quot;</span><span class="p">:</span>
            <span class="c"># This is very unpythonic</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="mi">0</span><span class="p">)):</span>
                <span class="n">carp</span><span class="p">(</span><span class="s">&quot;age &#39;</span><span class="si">%s</span><span class="s">&#39; isn&#39;t numeric&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,))</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="p">:</span> <span class="n">carp</span><span class="p">(</span><span class="s">&quot;age &#39;</span><span class="si">%s</span><span class="s">&#39; is unreasonable&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

<span class="k">class</span> <span class="nc">Family</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">members</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">members</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">members</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head</span> <span class="o">=</span> <span class="n">head</span> <span class="ow">or</span> <span class="n">Person</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">members</span> <span class="o">=</span> <span class="n">members</span>

<span class="n">folks</span> <span class="o">=</span> <span class="n">Family</span><span class="p">()</span>

<span class="n">dad</span> <span class="o">=</span> <span class="n">folks</span><span class="o">.</span><span class="n">head</span>
<span class="n">dad</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;John&quot;</span>
<span class="n">dad</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">34</span>

<span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">&#39;s age is </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">folks</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">folks</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">class</span> <span class="nc">Card</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="nb">type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">release</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cost</span> <span class="o">=</span> <span class="n">cost</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">release</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
<span class="c">#-----------------------------</span>
<span class="c"># For positional args</span>
<span class="k">class</span> <span class="nc">Card</span><span class="p">:</span>
    <span class="n">_names</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;color&quot;</span><span class="p">,</span> <span class="s">&quot;cost&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="s">&quot;release&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># For keyword args</span>
<span class="k">class</span> <span class="nc">Card</span><span class="p">:</span>
    <span class="n">_names</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;color&quot;</span><span class="p">,</span> <span class="s">&quot;cost&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="s">&quot;release&quot;</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">:</span>  <span class="c"># Set the defaults</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>  <span class="c"># add in the kwargs</span>
            <span class="k">assert</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">,</span> <span class="s">&quot;Unexpected kwarg: &quot;</span> <span class="o">+</span> <span class="n">k</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">class</span> <span class="nc">hostent</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr_list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="n">addrtype</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">aliases</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addr_list</span> <span class="o">=</span> <span class="n">addr_list</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span> <span class="ow">or</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addrtype</span> <span class="o">=</span> <span class="n">addrtype</span> <span class="ow">or</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span> <span class="o">=</span> <span class="n">aliases</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="s">&quot;&quot;</span>
<span class="c">#-----------------------------</span>
<span class="c">## XXX What do I do with these?</span>
<span class="c">#define h_type h_addrtype</span>
<span class="c">#define h_addr h_addr_list[0]</span>
<span class="c">#-----------------------------</span>
<span class="c"># make (hostent object)-&gt;type() same as (hostent object)-&gt;addrtype()</span>
<span class="c">#</span>
<span class="c"># *hostent::type = \&amp;hostent::addrtype;</span>
<span class="c">#</span>
<span class="c"># # make (hostenv object)-&gt;</span>
<span class="c"># addr()</span>
<span class="c">#  same as (hostenv object)-&gt;addr_list(0)</span>
<span class="c">#sub hostent::addr { shift-&gt;addr_list(0,@_) }</span>
<span class="c">#-----------------------------</span>
<span class="c"># No equivalent to Net::hostent (Python uses an unnamed tuple)</span>
<span class="c">#package Extra::hostent;</span>
<span class="c">#use Net::hostent;</span>
<span class="c">#@ISA = qw(hostent);</span>
<span class="c">#sub addr { shift-&gt;addr_list(0,@_) }</span>
<span class="c">#1;</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_13.6</span>
<span class="c">#-----------------------------</span>
<span class="k">class</span> <span class="nc">Class</span><span class="p">(</span><span class="n">Parent</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="c">#-----------------------------</span>
<span class="c">## Note: this is unusual in Python code</span>
<span class="n">ob1</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="p">()</span>
<span class="c"># later on</span>
<span class="n">ob2</span> <span class="o">=</span> <span class="n">ob1</span><span class="o">.</span><span class="n">__class__</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="c">## Note: this is unusual in Python code</span>
<span class="n">ob1</span> <span class="o">=</span> <span class="n">Widget</span><span class="p">()</span>
<span class="n">ob2</span> <span class="o">=</span> <span class="n">ob1</span><span class="o">.</span><span class="n">__class__</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="c"># XXX I do not know the intent of the original Perl code</span>
<span class="c"># Do not use this style of programming in Python.</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">possible</span><span class="p">,</span><span class="n">base</span><span class="p">,</span><span class="n">classes</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c"># Call the parents&#39; constructors, if there are any</span>
        <span class="k">for</span> <span class="n">baseclass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__bases__</span><span class="p">:</span>
            <span class="n">init</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">baseclass</span><span class="p">,</span> <span class="s">&quot;__init__&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">init</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PARENT</span> <span class="o">=</span> <span class="n">parent</span>      <span class="c"># init data fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">START</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AGE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_13.7</span>
<span class="c">#-----------------------------</span>
<span class="n">methname</span> <span class="o">=</span> <span class="s">&quot;flicker&quot;</span>
<span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">methname</span><span class="p">)(</span><span class="mi">10</span><span class="p">)</span>    <span class="c"># calls obj-&gt;flicker(10);</span>

<span class="c"># call three methods on the object, by name</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;start&quot;</span><span class="p">,</span> <span class="s">&quot;run&quot;</span><span class="p">,</span> <span class="s">&quot;stop&quot;</span><span class="p">):</span>
    <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">m</span><span class="p">)()</span>
<span class="c">#-----------------------------</span>
<span class="n">methods</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;rank&quot;</span><span class="p">,</span> <span class="s">&quot;serno&quot;</span><span class="p">)</span>
<span class="n">his_info</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
   <span class="n">his_info</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ob</span><span class="p">,</span> <span class="n">m</span><span class="p">)()</span>

<span class="c"># same as this:</span>

<span class="n">his_info</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">ob</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span>
    <span class="s">&#39;rank&#39;</span><span class="p">:</span> <span class="n">ob</span><span class="o">.</span><span class="n">rank</span><span class="p">(),</span>
    <span class="s">&#39;serno&#39;</span><span class="p">:</span> <span class="n">ob</span><span class="o">.</span><span class="n">serno</span><span class="p">(),</span>
<span class="p">}</span>
<span class="c">#-----------------------------</span>
<span class="n">fnref</span> <span class="o">=</span> <span class="n">ob</span><span class="o">.</span><span class="n">method</span>
<span class="c">#-----------------------------</span>
<span class="n">fnref</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s">&quot;fred&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">obj</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s">&quot;fred&quot;</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># XXX Not sure if this is the correct translation.</span>
<span class="c"># XXX Is &#39;can&#39; special?</span>
<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj_target</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">can</span><span class="p">(</span><span class="s">&#39;method_name&#39;</span><span class="p">)(</span><span class="n">obj_target</span><span class="p">,</span> <span class="o">*</span><span class="n">arguments</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_13.8</span>
<span class="c">#-----------------------------</span>
<span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">mimetools</span><span class="o">.</span><span class="n">Message</span><span class="p">)</span>
<span class="nb">issubclass</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">mimetools</span><span class="o">.</span><span class="n">Message</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&quot;method_name&quot;</span><span class="p">):</span>  <span class="c"># check method validity</span>
    <span class="k">pass</span>
<span class="c">#-----------------------------</span>
<span class="c">## Explicit type checking is needed fewer times than you think.</span>
<span class="n">his_print_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&quot;as_string&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">Some_Module</span><span class="o">.</span><span class="n">__version__</span>

<span class="c"># Almost never used, and doesn&#39;t work for builtin types, which don&#39;t</span>
<span class="c"># have a __module__.</span>

<span class="n">his_vers</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">__module__</span><span class="o">.</span><span class="n">__version__</span>
<span class="c">#-----------------------------</span>
<span class="k">if</span> <span class="n">Some_Module</span><span class="o">.</span><span class="n">__version__</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
  <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&quot;Some_Module version </span><span class="si">%s</span><span class="s"> is too old, expected (3, 0)&quot;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">Some_Module</span><span class="o">.</span><span class="n">__version__</span><span class="p">,))</span>
<span class="c"># or more simply</span>
<span class="k">assert</span> <span class="n">Some_Module</span><span class="o">.</span><span class="n">__version__</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s">&quot;version too old&quot;</span>

<span class="c">#-----------------------------</span>
<span class="n">__VERSION__</span> <span class="o">=</span> <span class="s">&#39;1.01&#39;</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_13.9</span>
<span class="c">#-----------------------------</span>
<span class="c"># Note: This uses the standard Python idiom of accessing the</span>
<span class="c"># attributes directly rather than going through a method call.</span>
<span class="c"># See earlier in this chapter for examples of how this does</span>
<span class="c"># not break encapsulation.</span>
<span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
<span class="c">#-----------------------------</span>
<span class="c"># Prefered: dude = Person(&quot;Jason&quot;, 23)</span>
<span class="n">dude</span> <span class="o">=</span> <span class="n">Person</span><span class="p">()</span>
<span class="n">dude</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Jason&quot;</span>
<span class="n">dude</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">23</span>
<span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> is age </span><span class="si">%d</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dude</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dude</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Person</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="c">#-----------------------------</span>
<span class="c"># Prefered: empl = Employee(&quot;Jason&quot;, 23)</span>
<span class="n">emp</span> <span class="o">=</span> <span class="n">Employee</span><span class="p">()</span>
<span class="n">empl</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Jason&quot;</span>
<span class="n">empl</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">23</span>
<span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> is age </span><span class="si">%d</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">empl</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">empl</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_13.10</span>
<span class="c">#-----------------------------</span>
<span class="c"># This doesn&#39;t need to be done since if &#39;method&#39; doesn&#39;t</span>
<span class="c"># exist in the Class it will be looked for in its BaseClass(es)</span>
<span class="k">class</span> <span class="nc">Class</span><span class="p">(</span><span class="n">BaseClass</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">BaseClass</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c"># This lets you pick the specific method in one of the base classes</span>
<span class="k">class</span> <span class="nc">Class</span><span class="p">(</span><span class="n">BaseClass1</span><span class="p">,</span> <span class="n">BaseClass2</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">BaseClass2</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c"># This looks for the first method in the base class(es) without</span>
<span class="c"># specifically knowing which base class.  This reimplements</span>
<span class="c"># the default action so isn&#39;t really needed.</span>
<span class="k">class</span> <span class="nc">Class</span><span class="p">(</span><span class="n">BaseClass1</span><span class="p">,</span> <span class="n">BaseClass2</span><span class="p">,</span> <span class="n">BaseClass3</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">baseclass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__bases__</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">baseclass</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;method&quot;</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="bp">self</span><span class="o">.</span><span class="n">meth</span><span class="p">()</span>   <span class="c"># Call wherever first meth is found</span>

<span class="n">Where</span><span class="o">.</span><span class="n">meth</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c"># Call in the base class &quot;Where&quot;</span>

<span class="c"># XXX Does Perl only have single inheritence?  Or does</span>
<span class="c"># it check all base classes?  No directly equivalent way</span>
<span class="c"># to do this in Python, but see above.</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c"># The Perl code calls a private &#39;_init&#39; function, but in</span>
<span class="c"># Python there&#39;s need for the complexity of &#39;new&#39; mechanism</span>
<span class="c"># so it&#39;s best just to put the &#39;_init&#39; code in &#39;__init__&#39;.</span>
<span class="k">class</span> <span class="nc">Class</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="c"># init data fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">START</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AGE</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EXTRA</span> <span class="o">=</span> <span class="n">args</span>          <span class="c"># anything extra</span>
<span class="c">#-----------------------------</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">Widget</span><span class="p">(</span><span class="n">haircolor</span> <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="n">freckles</span> <span class="o">=</span> <span class="mi">121</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="k">class</span> <span class="nc">Class</span><span class="p">(</span><span class="n">Base1</span><span class="p">,</span> <span class="n">Base2</span><span class="p">,</span> <span class="n">Base3</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__bases__</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s">&quot;__init__&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_13.11</span>
<span class="c">#-----------------------------</span>
<span class="c"># NOTE: Python prefers direct attribute lookup rather than</span>
<span class="c"># method calls.  Python 2.2 will introduce a &#39;get_set&#39; which</span>
<span class="c"># *may* be equivalent, but I don&#39;t know enough about it.  So</span>
<span class="c"># instead I&#39;ll describe a class that lets you restrict access</span>
<span class="c"># to only specific attributes.</span>

<span class="k">class</span> <span class="nc">Private</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__names</span> <span class="o">=</span> <span class="n">names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__names</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;_Private&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;cannot set the attribute </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,))</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Private</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">Private</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;age&quot;</span><span class="p">,</span> <span class="s">&quot;peers&quot;</span><span class="p">,</span> <span class="s">&quot;parent&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
    <span class="k">def</span> <span class="nf">new_child</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Person</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="n">dad</span> <span class="o">=</span> <span class="n">Person</span><span class="p">()</span>
<span class="n">dad</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Jason&quot;</span>
<span class="n">dad</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">23</span>
<span class="n">kid</span> <span class="o">=</span> <span class="n">dad</span><span class="o">.</span><span class="n">new_child</span><span class="p">()</span>
<span class="n">kid</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Rachel&quot;</span>
<span class="n">kid</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">print</span> <span class="s">&quot;Kid&#39;s parent is&quot;</span><span class="p">,</span> <span class="n">kid</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span>
<span class="c">#=&gt;Kid&#39;s parent is Jason</span>

<span class="c"># ^^PLEAC^^_13.12</span>
<span class="c">#-----------------------------</span>
<span class="c">## XXX No clue on what this does.  For that matter, what&#39;s</span>
<span class="c">## &quot;The Data Inheritance Problem&quot;?</span>

<span class="c"># ^^PLEAC^^_13.13</span>
<span class="c">#-----------------------------</span>
<span class="n">node</span><span class="o">.</span><span class="n">NEXT</span> <span class="o">=</span> <span class="n">node</span>
<span class="c">#-----------------------------</span>
<span class="c"># This is not a faithful copy of the Perl code, but it does</span>
<span class="c"># show how to have the container&#39;s __del__ remove cycles in</span>
<span class="c"># its contents.  Note that Python 2.0 includes a garbage</span>
<span class="c"># collector that is able to remove these sorts of cycles, but</span>
<span class="c"># it&#39;s still best to prevent cycles in your code.</span>
<span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

<span class="k">class</span> <span class="nc">Ring</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ring</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Helpful when debugging, to print the contents of the ring</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;#</span><span class="si">%d</span><span class="s">: &quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ring</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">next</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">ring</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&quot; -&gt; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot; -&gt;&quot;</span>

    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ring</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">node</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">next</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">ring</span><span class="p">:</span>
                <span class="k">break</span>

    <span class="k">def</span> <span class="nf">insert_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ring</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">prev</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ring</span><span class="o">.</span><span class="n">prev</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ring</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ring</span><span class="o">.</span><span class="n">prev</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ring</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ring</span> <span class="o">=</span> <span class="n">node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">delete_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="n">node</span><span class="o">.</span><span class="n">next</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ring</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">prev</span><span class="o">.</span><span class="n">next</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">next</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">next</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">prev</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">ring</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ring</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">next</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">ring</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ring</span><span class="p">)</span>

<span class="n">COUNT</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="k">for</span> <span class="n">rep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Ring</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">COUNT</span><span class="p">):</span>
        <span class="n">r</span><span class="o">.</span><span class="n">insert_value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="c">#-----------------------------</span>

<span class="c"># ^^PLEAC^^_13.14</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">UserString</span>
<span class="k">class</span> <span class="nc">MyString</span><span class="p">(</span><span class="n">UserString</span><span class="o">.</span><span class="n">UserString</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">idnum</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idnum</span> <span class="o">=</span> <span class="n">idnum</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> (</span><span class="si">%05d</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">idnum</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="k">class</span> <span class="nc">TimeNumber</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">minutes</span> <span class="o">&lt;</span> <span class="mi">60</span> <span class="ow">and</span> <span class="n">seconds</span> <span class="o">&lt;</span> <span class="mi">60</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hours</span> <span class="o">=</span> <span class="n">hours</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minutes</span> <span class="o">=</span> <span class="n">minutes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">=</span> <span class="n">seconds</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">:</span><span class="si">%02d</span><span class="s">:</span><span class="si">%02d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hours</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minutes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">seconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">seconds</span>
        <span class="n">minutes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minutes</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">minutes</span>
        <span class="n">hours</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hours</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">hours</span>
        <span class="k">if</span> <span class="n">seconds</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">seconds</span> <span class="o">%=</span> <span class="mi">60</span>
            <span class="n">minutes</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">minutes</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">minutes</span> <span class="o">%=</span> <span class="mi">60</span>
            <span class="n">hours</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">TimeNumber</span><span class="p">(</span><span class="n">hours</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">TimeNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">59</span><span class="p">)</span>
<span class="n">sec</span> <span class="o">=</span> <span class="n">TimeNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">min</span> <span class="o">=</span> <span class="n">TimeNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">print</span> <span class="n">t1</span> <span class="o">+</span> <span class="n">sec</span> <span class="o">+</span> <span class="nb">min</span> <span class="o">+</span> <span class="nb">min</span>
<span class="c"># 1:01:00</span>

<span class="c">#-----------------------------</span>
<span class="c"># For demo purposes only - the StrNum class is superfluous in this</span>
<span class="c"># case as plain strings would give the same result.</span>
<span class="k">class</span> <span class="nc">StrNum</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>  <span class="c"># both &lt;=&gt; and cmp</span>
        <span class="c"># providing &lt;=&gt; gives us &lt;, ==, etc. for free.</span>
        <span class="c"># __lt__, __eq__, and __gt__ can also be individually specified</span>
        <span class="k">return</span> <span class="nb">cmp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c"># &quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>   <span class="c"># bool</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>   <span class="c"># 0+</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>   <span class="c"># +</span>
        <span class="k">return</span> <span class="n">StrNum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>   <span class="c"># +, inverted</span>
        <span class="k">return</span> <span class="n">StrNum</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>   <span class="c"># *</span>
        <span class="k">return</span> <span class="n">StrNum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>   <span class="c"># *, inverted</span>
        <span class="k">return</span> <span class="n">StrNum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">other</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">demo</span><span class="p">():</span>
    <span class="c"># show_strnum - demo operator overloading</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">StrNum</span><span class="p">(</span><span class="s">&quot;Red&quot;</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">StrNum</span><span class="p">(</span><span class="s">&quot;Black&quot;</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">z</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="k">print</span> <span class="s">&quot;values are </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, and </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;LT&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;GE&quot;</span>
    <span class="k">print</span> <span class="n">x</span><span class="p">,</span> <span class="s">&quot;is&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">y</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">demo</span><span class="p">()</span>
<span class="c"># values are Red, Black, RedBlack, and RedBlackRedBlackRedBlack</span>
<span class="c"># Red is GE Black</span>

<span class="c">#-----------------------------</span>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># demo_fixnum - show operator overloading</span>

<span class="c"># sum of STRFixNum: 40 and STRFixNum: 12 is STRFixNum: 52</span>
<span class="c"># product of STRFixNum: 40 and STRFixNum: 12 is STRFixNum: 480</span>
<span class="c"># STRFixNum: 3 has 0 places</span>
<span class="c"># div of STRFixNum: 40 by STRFixNum: 12 is STRFixNum: 3.33</span>
<span class="c"># square of that is  STRFixNum: 11.11</span>

<span class="c"># This isn&#39;t excatly the same as the original Perl code since</span>
<span class="c"># I couldn&#39;t figure out why the PLACES variable was used.</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">_places_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;\.(\d+)&quot;</span><span class="p">)</span>

<span class="n">default_places</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">class</span> <span class="nc">FixNum</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">places</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">places</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># get from the value</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">_places_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">places</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">places</span> <span class="o">=</span> <span class="n">default_places</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">places</span> <span class="o">=</span> <span class="n">places</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">FixNum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                      <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">places</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">places</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">FixNum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                      <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">places</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">places</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c"># Force to use floating point, since 2/3 in Python is 0</span>
        <span class="c"># Don&#39;t use float() since that will convert strings</span>
        <span class="k">return</span> <span class="n">FixNum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">+</span><span class="mf">0.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                      <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">places</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">places</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;STR</span><span class="si">%s</span><span class="s">: </span><span class="si">%.*f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">places</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

<span class="k">def</span> <span class="nf">demo</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">FixNum</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">FixNum</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">&quot;sum of&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s">&quot;and&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&quot;is&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span>
    <span class="k">print</span> <span class="s">&quot;product of&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s">&quot;and&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&quot;is&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span>

    <span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="n">y</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> has </span><span class="si">%d</span><span class="s"> places&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">places</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">z</span><span class="o">.</span><span class="n">places</span><span class="p">:</span>
        <span class="n">z</span><span class="o">.</span><span class="n">places</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">print</span> <span class="s">&quot;div of&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s">&quot;by&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&quot;is&quot;</span><span class="p">,</span> <span class="n">z</span>
    <span class="k">print</span> <span class="s">&quot;square of that is &quot;</span><span class="p">,</span> <span class="n">z</span><span class="o">*</span><span class="n">z</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">demo</span><span class="p">()</span>


<span class="c"># ^^PLEAC^^_13.15</span>
<span class="c"># You can&#39;t tie a variable, but you can use properties.  </span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="k">class</span> <span class="nc">ValueRing</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colours</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colourcycle</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span><span class="n">colours</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">next_colour</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">colourcycle</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
    <span class="n">colour</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">next_colour</span><span class="p">)</span>
<span class="n">vr</span> <span class="o">=</span> <span class="n">ValueRing</span><span class="p">([</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;blue&quot;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">vr</span><span class="o">.</span><span class="n">colour</span><span class="p">,</span>
<span class="k">print</span>

<span class="c"># Note that you MUST refer directly to the property</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">vr</span><span class="o">.</span><span class="n">colour</span>
<span class="k">print</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span>
<span class="c">#-------------------------------------</span>
<span class="c"># Ties are generally unnecessary in Python because of its strong OO support -</span>
<span class="c"># The resulting code is MUCH shorter:</span>
<span class="k">class</span> <span class="nc">AppendDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">AppendDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">[</span><span class="n">val</span><span class="p">])</span>
<span class="n">tab</span> <span class="o">=</span> <span class="n">AppendDict</span><span class="p">()</span>
<span class="n">tab</span><span class="p">[</span><span class="s">&quot;beer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;guinness&quot;</span>
<span class="n">tab</span><span class="p">[</span><span class="s">&quot;food&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;potatoes&quot;</span>
<span class="n">tab</span><span class="p">[</span><span class="s">&quot;food&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;peas&quot;</span>

<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">tab</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">key</span><span class="p">,</span> <span class="s">&quot;=&gt;&quot;</span><span class="p">,</span> <span class="n">val</span>
<span class="c">#-------------------------------------</span>
<span class="k">class</span> <span class="nc">CaselessDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CaselessDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">val</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CaselessDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

<span class="n">tab</span> <span class="o">=</span> <span class="n">CaselessDict</span><span class="p">()</span>
<span class="n">tab</span><span class="p">[</span><span class="s">&quot;VILLAIN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;big &quot;</span>
<span class="n">tab</span><span class="p">[</span><span class="s">&quot;herOine&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;red riding hood&quot;</span>
<span class="n">tab</span><span class="p">[</span><span class="s">&quot;villain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;bad wolf&quot;</span>

<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">tab</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">key</span><span class="p">,</span> <span class="s">&quot;is&quot;</span><span class="p">,</span> <span class="n">val</span>
<span class="c">#=&gt;villain is bad wolf</span>
<span class="c">#=&gt;heroine is red riding hood</span>
<span class="c">#-------------------------------------</span>
<span class="k">class</span> <span class="nc">RevDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RevDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RevDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

<span class="n">tab</span> <span class="o">=</span> <span class="n">RevDict</span><span class="p">()</span>
<span class="n">tab</span><span class="p">[</span><span class="s">&quot;red&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;rojo&quot;</span>
<span class="n">tab</span><span class="p">[</span><span class="s">&quot;blue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;azul&quot;</span>
<span class="n">tab</span><span class="p">[</span><span class="s">&quot;green&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;verde&quot;</span>
<span class="n">tab</span><span class="p">[</span><span class="s">&quot;evil&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;No Way!&quot;</span><span class="p">,</span> <span class="s">&quot;Way!&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">tab</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">key</span><span class="p">,</span> <span class="s">&quot;is&quot;</span><span class="p">,</span> <span class="n">val</span>
<span class="c">#=&gt;blue is azul</span>
<span class="c">#=&gt;(&#39;No Way!&#39;, &#39;Way!&#39;) is evil</span>
<span class="c">#=&gt;rojo is red</span>
<span class="c">#=&gt;evil is (&#39;No Way!&#39;, &#39;Way!&#39;)</span>
<span class="c">#=&gt;azul is blue</span>
<span class="c">#=&gt;verde is green</span>
<span class="c">#=&gt;green is verde</span>
<span class="c">#=&gt;red is rojo</span>
<span class="c">#-------------------------------------</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">&quot;Got&quot;</span><span class="p">,</span> <span class="n">elem</span>
<span class="c">#-------------------------------------</span>
<span class="c"># You could use FileDispatcher from section 7.18</span>
<span class="n">tee</span> <span class="o">=</span> <span class="n">FileDispatcher</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="c">#-------------------------------------</span>
<span class="c"># @@PLEAC@@_14.0</span>

<span class="c"># See http://www.python.org/doc/topics/database/ for Database Interfaces details.</span>
<span class="c"># currently listed on http://www.python.org/doc/topics/database/modules/</span>
<span class="c">#</span>
<span class="c">#  DB/2, Informix, Interbase, Ingres, JDBC, MySQL, pyodbc, mxODBC, ODBC Interface,</span>
<span class="c">#  DCOracle, DCOracle2, PyGresQL, psycopg, PySQLite, sapdbapi, Sybase, ThinkSQL.</span>
<span class="c">#</span>

<span class="c"># @@PLEAC@@_14.1</span>
<span class="c">#-------------------------------------</span>
<span class="kn">import</span> <span class="nn">anydbm</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;test.db&quot;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">anydbm</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="k">except</span> <span class="n">anydbm</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Can&#39;t open </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

<span class="n">db</span><span class="p">[</span><span class="s">&quot;key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;value&quot;</span>        <span class="c"># put value into database</span>
<span class="k">if</span> <span class="s">&quot;key&quot;</span> <span class="ow">in</span> <span class="n">db</span><span class="p">:</span>            <span class="c"># check whether in database</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&quot;key&quot;</span><span class="p">)</span>    <span class="c"># retrieve and remove from database</span>
<span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>                 <span class="c"># close the database</span>
<span class="c">#-------------------------------------</span>
<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch14/userstats</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># userstats - generates statistics on who logged in.</span>
<span class="c"># call with an argument to display totals</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">anydbm</span><span class="o">,</span> <span class="nn">re</span>

<span class="n">db_file</span> <span class="o">=</span> <span class="s">&#39;/tmp/userstats.db&#39;</span>       <span class="c"># where data is kept between runs</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">anydbm</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">db_file</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">)</span>   <span class="c"># open, create if it does not exist</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Can&#39;t open db </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">db_file</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;ALL&#39;</span><span class="p">:</span>
        <span class="n">userlist</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">userlist</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">userlist</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">userlist</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">db</span><span class="p">[</span><span class="n">user</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">who</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&#39;who&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>  <span class="c"># run who(1)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">who</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;error running who&quot;</span>       <span class="c"># exit</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c"># extract username (first thin on the line) and update</span>
    <span class="n">user_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;^(\S+)&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">who</span><span class="p">:</span>
        <span class="n">fnd</span> <span class="o">=</span> <span class="n">user_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fnd</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Bad line from who: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">line</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">fnd</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">db</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
            <span class="n">db</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;0&quot;</span>
        <span class="n">db</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="n">user</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c"># only strings are allowed</span>
<span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    



<span class="c"># @@PLEAC@@_14.2</span>
<span class="c"># Emptying a DBM File</span>

<span class="kn">import</span> <span class="nn">anydbm</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">anydbm</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">FILENAME</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>   <span class="c"># open, for writing</span>
<span class="k">except</span> <span class="n">anydbm</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Can&#39;t open db </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">db</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c"># -------------------------------</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">anydbm</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;n&#39;</span><span class="p">)</span>   <span class="c"># open, always create a new empty db</span>
<span class="k">except</span> <span class="n">anydbm</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Can&#39;t open db </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c"># -------------------------------</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">FILENAME</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Couldn&#39;t remove </span><span class="si">%s</span><span class="s"> to empty the database: </span><span class="si">%s</span><span class="s">!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">FILENAME</span><span class="p">,</span>
        <span class="n">err</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">anydbm</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">FILENAME</span><span class="p">,</span><span class="s">&#39;n&#39;</span><span class="p">)</span>   <span class="c"># open, flways create a new empty db</span>
<span class="k">except</span> <span class="n">anydbm</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Couldn&#39;t create </span><span class="si">%s</span><span class="s"> database: </span><span class="si">%s</span><span class="s">!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">FILENAME</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span>

<span class="c"># @@PLEAC@@_14.3</span>
<span class="c"># Converting Between DBM Files</span>

<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch14/db2gdbm</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># db2gdbm: converts DB to GDBM</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">dbm</span><span class="o">,</span> <span class="nn">gdbm</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;usage: db2gdbm infile outfile&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c"># open the files</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">db_in</span> <span class="o">=</span> <span class="n">dbm</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Can&#39;t open infile </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">db_out</span> <span class="o">=</span> <span class="n">dbm</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="s">&quot;n&quot;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Can&#39;t open outfile </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># copy (don&#39;t use db_out = db_in because it&#39;s slow on big databases)</span>
<span class="c"># is this also so for python ?</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">db_in</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">db_out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">db_in</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

<span class="c"># these close happen automatically at program exit</span>
<span class="n">db_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">db_in</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>



<span class="c"># @@PLEAC@@_14.4</span>

<span class="n">OUTPUT</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">INPUT1</span><span class="p">)</span>
<span class="n">OUTPUT</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">INPUT2</span><span class="p">)</span>

<span class="n">OUTPUT</span> <span class="o">=</span> <span class="n">anydbm</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;OUT&quot;</span><span class="p">,</span><span class="s">&quot;n&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">INPUT</span> <span class="ow">in</span> <span class="p">(</span><span class="n">INPUT1</span><span class="p">,</span> <span class="n">INPUT2</span><span class="p">,</span> <span class="n">INPUT1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">INPUT</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">OUTPUT</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="c"># decide which value to use and set OUTPUT[key] if necessary</span>
            <span class="k">print</span> <span class="s">&quot;key </span><span class="si">%s</span><span class="s"> already present: </span><span class="si">%s</span><span class="s">, new: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">key</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">value</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">OUTPUT</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

<span class="c"># @@PLEAC@@_14.5</span>
<span class="c"># On systems where the Berkeley DB supports it, dbhash takes an</span>
<span class="c"># &quot;l&quot; flag:</span>
<span class="kn">import</span> <span class="nn">dbhash</span>
<span class="n">dbhash</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;mydb.db&quot;</span><span class="p">,</span> <span class="s">&quot;cl&quot;</span><span class="p">)</span> <span class="c"># &#39;c&#39;: create if doesn&#39;t exist</span>

<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_14.6</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_14.7</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_14.8</span>
<span class="c"># shelve uses anydbm to access and chooses between DBMs.</span>
<span class="c"># anydbm detect file formats automatically.</span>
<span class="kn">import</span> <span class="nn">shelve</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;celebrities.db&quot;</span><span class="p">)</span>

<span class="n">name1</span> <span class="o">=</span> <span class="s">&quot;Greg Stein&quot;</span>
<span class="n">name2</span> <span class="o">=</span> <span class="s">&quot;Greg Ward&quot;</span>

<span class="c"># shelve uses pickle to convert objects into strings and back.</span>
<span class="c"># This is automatic.</span>
<span class="n">db</span><span class="p">[</span><span class="n">name1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;of ViewCVS fame&quot;</span><span class="p">,</span> <span class="s">&quot;gstein@lyra.org&quot;</span><span class="p">]</span>
<span class="n">db</span><span class="p">[</span><span class="n">name2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;of Distutils fame&quot;</span><span class="p">,</span> <span class="s">&quot;gward@python.net&quot;</span><span class="p">]</span>

<span class="n">greg1</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">name1</span><span class="p">]</span>
<span class="n">greg2</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">name2</span><span class="p">]</span>

<span class="k">print</span> <span class="s">&quot;Two Gregs: </span><span class="si">%x</span><span class="s"> </span><span class="si">%x</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">greg1</span><span class="p">),</span> <span class="nb">id</span><span class="p">(</span><span class="n">greg2</span><span class="p">))</span>

<span class="k">if</span> <span class="n">greg1</span> <span class="o">==</span> <span class="n">greg2</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;You&#39;re having runtime fun with one Greg made two.&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;No two Gregs are ever alike.&quot;</span>

<span class="c"># Changes to mutable entries are not written back by default.</span>
<span class="c"># You can get the copy, change it, and put it back.</span>
<span class="n">entry</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">name1</span><span class="p">]</span>
<span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;of Subversion fame&quot;</span>
<span class="n">db</span><span class="p">[</span><span class="n">name1</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>

<span class="c"># Or you can open shelve with writeback option. Then you can</span>
<span class="c"># change mutable entries directly. (New in 2.3)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;celebrities.db&quot;</span><span class="p">,</span> <span class="n">writeback</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">db</span><span class="p">[</span><span class="n">name2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;of Optik fame&quot;</span>

<span class="c"># However, writeback option can consume vast amounts of memory</span>
<span class="c"># to do its magic. You can clear cache with sync().</span>
<span class="n">db</span><span class="o">.</span><span class="n">sync</span><span class="p">()</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_14.9</span>
<span class="c"># DON&#39;T DO THIS.</span>
<span class="kn">import</span> <span class="nn">os</span> <span class="kn">as</span> <span class="nn">_os</span><span class="o">,</span> <span class="nn">shelve</span> <span class="kn">as</span> <span class="nn">_shelve</span>

<span class="n">_fname</span> <span class="o">=</span> <span class="s">&quot;persist.db&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_fname</span><span class="p">):</span>
    <span class="n">var1</span> <span class="o">=</span> <span class="s">&quot;foo&quot;</span>
    <span class="n">var2</span> <span class="o">=</span> <span class="s">&quot;bar&quot;</span>
<span class="n">_d</span> <span class="o">=</span> <span class="n">_shelve</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;persist.db&quot;</span><span class="p">)</span>
<span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_d</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;var1 is </span><span class="si">%s</span><span class="s">; var2 is </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">)</span>
<span class="n">var1</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;New var1: &quot;</span><span class="p">)</span>
<span class="n">var2</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;New var2: &quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">):</span>
        <span class="n">_d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_14.10</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">dbmodule</span>

<span class="n">dbconn</span> <span class="o">=</span> <span class="n">dbmodule</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">arguments</span><span class="o">...</span><span class="p">)</span>

<span class="n">cursor</span> <span class="o">=</span> <span class="n">dbconn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
   <span class="n">row</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
   <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
       <span class="k">break</span>
   <span class="o">...</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">dbconn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">MySQLdb</span>
<span class="kn">import</span> <span class="nn">pwd</span>

<span class="n">dbconn</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="s">&#39;dbname&#39;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s">&#39;mysqlserver.domain.com&#39;</span><span class="p">,</span>
                        <span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">&#39;user&#39;</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="s">&#39;password&#39;</span><span class="p">)</span>

<span class="n">cursor</span> <span class="o">=</span> <span class="n">dbconn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;CREATE TABLE users (uid INT, login CHAR(8))&quot;</span><span class="p">)</span>

<span class="c"># Note: some databases use %s for parameters, some use ? or other</span>
<span class="c"># formats</span>
<span class="n">sql_fmt</span> <span class="o">=</span> <span class="s">&quot;INSERT INTO users VALUES( </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s"> )&quot;</span>

<span class="k">for</span> <span class="n">userent</span> <span class="ow">in</span> <span class="n">pwd</span><span class="o">.</span><span class="n">getpwall</span><span class="p">():</span>
   <span class="c"># the second argument contains a list of parameters which will</span>
   <span class="c"># be quoted before being put in the query</span>
   <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_fmt</span><span class="p">,</span> <span class="p">(</span><span class="n">userent</span><span class="o">.</span><span class="n">pw_uid</span><span class="p">,</span> <span class="n">userent</span><span class="o">.</span><span class="n">pw_name</span><span class="p">))</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;SELECT * FROM users WHERE uid &lt; 50&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
   <span class="c"># NULL will be displayed as None</span>
   <span class="k">print</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;DROP TABLE users&quot;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">dbconn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_14.11</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_15.1</span>
<span class="c">#-----------------------------</span>
<span class="c"># Parsing program arguments</span>
<span class="c"># -- getopt way (All Python versions)</span>

<span class="c">#-----------------------------</span>
<span class="c"># Preamble</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">getopt</span>

<span class="c"># getopt() explicitly receives arguments for it to process.</span>
<span class="c"># No magic. Explicit is better than implicit.</span>

<span class="c"># PERL: @ARGV</span>
<span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c"># Note that sys.argv[0] is the script name, and need to be</span>
<span class="c"># stripped.</span>

<span class="c">#-----------------------------</span>
<span class="c"># Short options</span>

<span class="c"># PERL: getopt(&quot;vDo&quot;);</span>
<span class="c"># Polluting the caller&#39;s namespace is evil. Don&#39;t do that.</span>

<span class="c"># PERL: getopt(&quot;vDo:&quot;, \%opts);</span>
<span class="n">opts</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">getopt</span><span class="o">.</span><span class="n">getopt</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="s">&quot;vDo:&quot;</span><span class="p">)</span>

<span class="c"># If you want switches to take arguments, you must say so.</span>
<span class="c"># Unlike PERL, which silently performs its magic, switches</span>
<span class="c"># specified without trailing colons are considered boolean</span>
<span class="c"># flags by default.</span>

<span class="c"># PERL: getopt(&quot;vDo&quot;, \%opts);</span>
<span class="n">opts</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">getopt</span><span class="o">.</span><span class="n">getopt</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="s">&quot;v:D:o:&quot;</span><span class="p">)</span>

<span class="c"># PERL: getopts(&quot;vDo:&quot;, \%opts);</span>
<span class="c"># getopt/getopts distinction is not present in Python &#39;getopt&#39;</span>
<span class="c"># module.</span>

<span class="c">#-----------------------------</span>
<span class="c"># getopt() return values, compared to PERL</span>

<span class="c"># getopt() returns two values. The first is a list of</span>
<span class="c"># (option, value) pair. (Not a dictionary, i.e. Python hash.)</span>
<span class="c"># The second is the list of arguments left unprocessed.</span>

<span class="c"># Example</span>
<span class="c"># &gt;&gt;&gt; argv = &quot;-v ARG1 -D ARG2 -o ARG3&quot;.split()</span>
<span class="c"># &gt;&gt;&gt; opts, rest = getopt.getopt(argv, &quot;v:D:o:&quot;)</span>
<span class="c"># &gt;&gt;&gt; print opts</span>
<span class="c"># [(&#39;-v&#39;, &#39;ARG1&#39;), (&#39;-D&#39;, &#39;ARG2&#39;), (&#39;-o&#39;, &#39;ARG3&#39;)]</span>

<span class="c">#-----------------------------</span>
<span class="c"># Long options</span>

<span class="c"># getopt() handles long options too. Pass a list of option</span>
<span class="c"># names as the third argument. If an option takes an argument,</span>
<span class="c"># append an equal sign.</span>

<span class="n">opts</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">getopt</span><span class="o">.</span><span class="n">getopt</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s">&quot;verbose&quot;</span><span class="p">,</span> <span class="s">&quot;Debug&quot;</span><span class="p">,</span> <span class="s">&quot;output=&quot;</span><span class="p">])</span>

<span class="c">#-----------------------------</span>
<span class="c"># Switch clustering</span>

<span class="c"># getopt() does switch clustering just fine.</span>

<span class="c"># Example</span>
<span class="c"># &gt;&gt;&gt; argv1 = &#39;-r -f /tmp/testdir&#39;.split()</span>
<span class="c"># &gt;&gt;&gt; argv2 = &#39;-rf /tmp/testdir&#39;.split()</span>
<span class="c"># &gt;&gt;&gt; print getopt.getopt(argv1, &#39;rf&#39;)</span>
<span class="c"># ([(&#39;-r&#39;, &#39;&#39;), (&#39;-f&#39;, &#39;&#39;)], [&#39;/tmp/testdir&#39;])</span>
<span class="c"># &gt;&gt;&gt; print getopt.getopt(argv2, &#39;rf&#39;)</span>
<span class="c"># ([(&#39;-r&#39;, &#39;&#39;), (&#39;-f&#39;, &#39;&#39;)], [&#39;/tmp/testdir&#39;])</span>

<span class="c">#-----------------------------</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># TODO: Complete this section using &#39;getopt&#39;. Show how to</span>
<span class="c"># use the parsed result.</span>

<span class="c"># http://www.python.org/doc/current/lib/module-getopt.html</span>
<span class="c"># Python library reference has a &quot;typical usage&quot; demo.</span>

<span class="c"># TODO: Introduce &#39;optparse&#39;, a very powerful command line</span>
<span class="c"># option parsing module. New in 2.3.</span>


<span class="c"># @@PLEAC@@_15.2</span>
<span class="c">##------------------</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">is_interactive_python</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ps</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">ps1</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>
<span class="c">##------------------</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="k">def</span> <span class="nf">is_interactive</span><span class="p">():</span>
    <span class="c"># only False if stdin is redirected like &quot;-t&quot; in perl.</span>
    <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">isatty</span><span class="p">()</span>

<span class="c"># Or take advantage of Python&#39;s Higher Order Functions:</span>
<span class="n">is_interactive</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">isatty</span>
<span class="c">##------------------</span>
<span class="kn">import</span> <span class="nn">posix</span>
<span class="k">def</span> <span class="nf">is_interactive_posix</span><span class="p">():</span>
    <span class="n">tty</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;/dev/tty&quot;</span><span class="p">)</span>
    <span class="n">tpgrp</span> <span class="o">=</span> <span class="n">posix</span><span class="o">.</span><span class="n">tcgetpgrp</span><span class="p">(</span><span class="n">tty</span><span class="o">.</span><span class="n">fileno</span><span class="p">())</span>
    <span class="n">pgrp</span> <span class="o">=</span> <span class="n">posix</span><span class="o">.</span><span class="n">getpgrp</span><span class="p">()</span>
    <span class="n">tty</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">tpgrp</span> <span class="o">==</span> <span class="n">pgrp</span><span class="p">)</span>

<span class="c"># test with:</span>
<span class="c">#  python 15.2.py</span>
<span class="c">#  echo &quot;dummy&quot; | python 15.2.py | cat</span>
<span class="k">print</span> <span class="s">&quot;is python shell:&quot;</span><span class="p">,</span> <span class="n">is_interactive_python</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;is a tty:&quot;</span><span class="p">,</span> <span class="n">is_interactive</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;has no tty:&quot;</span><span class="p">,</span> <span class="n">is_interactive_posix</span><span class="p">()</span>

<span class="k">if</span> <span class="n">is_interactive</span><span class="p">():</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ln</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;Prompt:&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">print</span> <span class="s">&quot;you typed:&quot;</span><span class="p">,</span> <span class="n">ln</span>


<span class="c"># @@PLEAC@@_15.3</span>

<span class="c"># Python has no Term::Cap module.</span>
<span class="c"># One could use the curses, but this was not ported to windows,</span>
<span class="c"># use console.</span>

<span class="c"># just run clear</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;clear&quot;</span><span class="p">)</span>
<span class="c"># cache output</span>
<span class="n">clear</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;clear&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">print</span> <span class="n">clear</span>
<span class="c"># or to avoid print&#39;s newline</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">clear</span><span class="p">)</span>

<span class="c"># @@PLEAC@@_15.4</span>
<span class="c"># Determining Terminal or Window Size</span>

<span class="c"># eiter use ioctl</span>
<span class="kn">import</span> <span class="nn">struct</span><span class="o">,</span> <span class="nn">fcntl</span><span class="o">,</span> <span class="nn">termios</span><span class="o">,</span> <span class="nn">sys</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&quot;HHHH&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">hchar</span><span class="p">,</span> <span class="n">wchar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&quot;HHHH&quot;</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">ioctl</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span>
                                 <span class="n">termios</span><span class="o">.</span><span class="n">TIOCGWINSZ</span><span class="p">,</span> <span class="n">s</span><span class="p">))[:</span><span class="mi">2</span><span class="p">]</span>
<span class="c"># or curses</span>
<span class="kn">import</span> <span class="nn">curses</span>
<span class="p">(</span><span class="n">hchar</span><span class="p">,</span><span class="n">wchar</span><span class="p">)</span> <span class="o">=</span> <span class="n">curses</span><span class="o">.</span><span class="n">getmaxyx</span><span class="p">()</span>

<span class="c"># graph contents of values</span>
<span class="kn">import</span> <span class="nn">struct</span><span class="o">,</span> <span class="nn">fcntl</span><span class="o">,</span> <span class="nn">termios</span><span class="o">,</span> <span class="nn">sys</span>
<span class="n">width</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&quot;HHHH&quot;</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">ioctl</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span>
                                 <span class="n">termios</span><span class="o">.</span><span class="n">TIOCGWINSZ</span><span class="p">,</span> 
                                 <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&quot;HHHH&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">if</span> <span class="n">width</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;You must have at least 10 characters&quot;</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span>

<span class="n">max_value</span> <span class="o">=</span> <span class="mi">0</span>                    
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
    <span class="n">max_value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_value</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
    
<span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="n">max_value</span>   <span class="c"># chars per unit</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%8.1f</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s">&quot;*&quot;</span><span class="o">*</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="n">ratio</span><span class="p">))</span>

<span class="c"># @@PLEAC@@_15.5</span>

<span class="c"># there seems to be no standard ansi module</span>
<span class="c"># and BLINK does not blink here.</span>
<span class="n">RED</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\033</span><span class="s">[31m&#39;</span>
<span class="n">RESET</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\033</span><span class="s">[0;0m&#39;</span>
<span class="n">BLINK</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\033</span><span class="s">[05m&#39;</span>
<span class="n">NOBLINK</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\033</span><span class="s">[25m&#39;</span>

<span class="k">print</span> <span class="n">RED</span><span class="o">+</span><span class="s">&quot;DANGER, Will Robinson!&quot;</span><span class="o">+</span><span class="n">RESET</span>
<span class="k">print</span> <span class="s">&quot;This is just normal text&quot;</span>
<span class="k">print</span> <span class="s">&quot;Will ``&quot;</span><span class="o">+</span><span class="n">BLINK</span><span class="o">+</span><span class="s">&quot;Do you hurt yet?&quot;</span><span class="o">+</span><span class="n">NOBLINK</span><span class="o">+</span><span class="s">&quot;&#39;&#39; and back&quot;</span>

<span class="c"># @@PLEAC@@_15.6</span>

<span class="c"># Show ASCII values for keypresses</span>

<span class="c"># _Getch is from http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/134892</span>
<span class="k">class</span> <span class="nc">_Getch</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Gets a single character from standard input.  Doesn&#39;t echo to screen.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">impl</span> <span class="o">=</span> <span class="n">_GetchWindows</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">impl</span> <span class="o">=</span> <span class="n">_GetchUnix</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">impl</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">_GetchUnix</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">tty</span><span class="o">,</span> <span class="nn">sys</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">tty</span><span class="o">,</span> <span class="nn">termios</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">fileno</span><span class="p">()</span>
        <span class="n">old_settings</span> <span class="o">=</span> <span class="n">termios</span><span class="o">.</span><span class="n">tcgetattr</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tty</span><span class="o">.</span><span class="n">setraw</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">fileno</span><span class="p">())</span>
            <span class="n">ch</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">termios</span><span class="o">.</span><span class="n">tcsetattr</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">termios</span><span class="o">.</span><span class="n">TCSADRAIN</span><span class="p">,</span> <span class="n">old_settings</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ch</span>


<span class="k">class</span> <span class="nc">_GetchWindows</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">msvcrt</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">msvcrt</span>
        <span class="k">return</span> <span class="n">msvcrt</span><span class="o">.</span><span class="n">getch</span><span class="p">()</span>


<span class="n">getch</span> <span class="o">=</span> <span class="n">_Getch</span><span class="p">()</span>

<span class="k">print</span> <span class="s">&quot;Press keys to see their ASCII values.  Use Ctrl-C to quit.</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">char</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">getch</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">print</span> <span class="s">&quot; Decimal: </span><span class="si">%3d</span><span class="s">   Octal: </span><span class="si">%3o</span><span class="s">   Hex: x</span><span class="si">%02x</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="n">char</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span>
<span class="k">except</span> <span class="n">KeyboardError</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="c">#----------------------------------------</span>

<span class="c"># @@PLEAC@@_15.7</span>
<span class="k">print</span> <span class="s">&quot;</span><span class="se">\a</span><span class="s">Wake up!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="c">#----------------------------------------</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_15.8</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_15.9</span>
<span class="c"># On Windows</span>
<span class="kn">import</span> <span class="nn">msvcrt</span>
<span class="k">if</span> <span class="n">msvcrt</span><span class="o">.</span><span class="n">kbhit</span><span class="p">():</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">msvcrt</span><span class="o">.</span><span class="n">getch</span>

<span class="c"># See http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/134892</span>
<span class="c"># @@INCOMPLETE@@</span>


<span class="c"># @@PLEAC@@_15.10</span>
<span class="c">#----------------------------------------</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">pwd</span>
<span class="kn">import</span> <span class="nn">crypt</span>
<span class="n">password</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">(</span><span class="s">&#39;Enter your password: &#39;</span><span class="p">)</span>
<span class="n">username</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span>
<span class="n">encrypted</span> <span class="o">=</span> <span class="n">pwd</span><span class="o">.</span><span class="n">getpwnam</span><span class="p">(</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">pw_passwd</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">encrypted</span> <span class="ow">or</span> <span class="n">encrypted</span> <span class="o">==</span> <span class="s">&#39;x&#39;</span><span class="p">:</span>
    <span class="c"># If using shadow passwords, this will be empty or &#39;x&#39;</span>
    <span class="k">print</span> <span class="s">&quot;Cannot verify password&quot;</span>
<span class="k">elif</span> <span class="n">crypt</span><span class="o">.</span><span class="n">crypt</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">encrypted</span><span class="p">)</span> <span class="o">!=</span> <span class="n">encrypted</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;You are not&quot;</span><span class="p">,</span> <span class="n">username</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Welcome,&quot;</span><span class="p">,</span> <span class="n">username</span>
<span class="c">#----------------------------------------</span>

<span class="c"># @@PLEAC@@_15.11</span>

<span class="c"># simply importing readline gives line edit capabilities to raw_</span>
<span class="kn">import</span> <span class="nn">readline</span>
<span class="n">readline</span><span class="o">.</span><span class="n">add_history</span><span class="p">(</span><span class="s">&quot;fake line&quot;</span><span class="p">)</span>
<span class="n">line</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">()</span>

<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch15/vbsh</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># vbsh - very bad shell</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">readline</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;$ &#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="n">exit_value</span> <span class="o">=</span> <span class="n">status</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
    <span class="n">signal_num</span> <span class="o">=</span> <span class="n">status</span> <span class="o">&amp;</span> <span class="mi">127</span>
    <span class="n">dumped_core</span> <span class="o">=</span> <span class="n">status</span> <span class="o">&amp;</span> <span class="mi">128</span> <span class="ow">and</span> <span class="s">&quot;(core dumped)&quot;</span> <span class="ow">or</span> <span class="s">&quot;&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Program terminated with status </span><span class="si">%d</span><span class="s"> from signal </span><span class="si">%d%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">exit_value</span><span class="p">,</span> <span class="n">signal_num</span><span class="p">,</span> <span class="n">dumped_core</span><span class="p">)</span>



<span class="n">readline</span><span class="o">.</span><span class="n">add_history</span><span class="p">(</span><span class="s">&quot;some line!&quot;</span><span class="p">)</span>
<span class="n">readline</span><span class="o">.</span><span class="n">remove_history_item</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">readline</span><span class="o">.</span><span class="n">get_history_item</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

<span class="c"># an interactive python shell would be</span>
<span class="kn">import</span> <span class="nn">code</span><span class="o">,</span> <span class="nn">readline</span>
<span class="n">code</span><span class="o">.</span><span class="n">InteractiveConsole</span><span class="p">()</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="s">&quot;code.InteractiveConsole&quot;</span><span class="p">)</span>

<span class="c"># @@PLEAC@@_15.12</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_15.13</span>
<span class="c">#----------------------------------------</span>
<span class="c"># This entry uses pexpect, a pure Python Expect-like module.</span>
<span class="c"># http://pexpect.sourceforge.net/</span>

<span class="c"># for more information, check pexpect&#39;s documentation and example.</span>

<span class="kn">import</span> <span class="nn">pexpect</span>

<span class="c">#----------------------------------------</span>
<span class="c"># spawn program</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">command</span> <span class="o">=</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="s">&quot;program to run&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">ExceptionPexpect</span><span class="p">:</span>
    <span class="c"># couldn&#39;t spawn program</span>
    <span class="k">pass</span>

<span class="c">#----------------------------------------</span>
<span class="c"># you can pass any filelike object to setlog</span>
<span class="c"># passing None will stop logging</span>

<span class="c"># stop logging</span>
<span class="n">command</span><span class="o">.</span><span class="n">setlog</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

<span class="c"># log to stdout</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">command</span><span class="o">.</span><span class="n">setlog</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

<span class="c"># log to specific file</span>
<span class="n">fp</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="s">&quot;pexpect.log&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
<span class="n">command</span><span class="o">.</span><span class="n">setlog</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>

<span class="c">#----------------------------------------</span>
<span class="c"># expecting simple string</span>
<span class="n">command</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;ftp&gt;&quot;</span><span class="p">)</span>

<span class="c"># expecting regular expression</span>
<span class="c"># actually, string is always treated as regular expression</span>

<span class="c"># so it&#39;s the same thing</span>
<span class="n">command</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Name.*:&quot;</span><span class="p">)</span>

<span class="c"># you can do it this way, too</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;Name.*:&quot;</span><span class="p">)</span>
<span class="n">command</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>

<span class="c">#----------------------------------------</span>
<span class="c"># expecting with timeout</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">command</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Password:&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="k">except</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">:</span>
    <span class="c"># timed out</span>
    <span class="k">pass</span>

<span class="c"># setting default timeout</span>
<span class="n">command</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c"># since we set default timeout, following does same as above</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">command</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Password:&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">:</span>
    <span class="c"># timed out</span>
    <span class="k">pass</span>

<span class="c">#----------------------------------------</span>
<span class="c"># what? do you *really* want to wait forever?</span>

<span class="c">#----------------------------------------</span>
<span class="c"># sending line: normal way</span>
<span class="n">command</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&quot;get spam_and_ham&quot;</span><span class="p">)</span>

<span class="c"># you can also treat it as file</span>
<span class="k">print</span><span class="o">&gt;&gt;</span><span class="n">command</span><span class="p">,</span> <span class="s">&quot;get spam_and_ham&quot;</span>

<span class="c">#----------------------------------------</span>
<span class="c"># finalization</span>

<span class="c"># close connection with child process</span>
<span class="c"># (that is, freeing file descriptor)</span>
<span class="n">command</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># kill child process</span>
<span class="kn">import</span> <span class="nn">signal</span>
<span class="n">command</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGKILL</span><span class="p">)</span>

<span class="c">#----------------------------------------</span>
<span class="c"># expecting multiple choices</span>
<span class="n">which</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">expect</span><span class="p">([</span><span class="s">&quot;invalid&quot;</span><span class="p">,</span> <span class="s">&quot;success&quot;</span><span class="p">,</span> <span class="s">&quot;error&quot;</span><span class="p">,</span> <span class="s">&quot;boom&quot;</span><span class="p">])</span>

<span class="c"># return value is index of matched choice</span>
<span class="c"># 0: invalid</span>
<span class="c"># 1: success</span>
<span class="c"># 2: error</span>
<span class="c"># 3: boom</span>

<span class="c">#----------------------------------------</span>
<span class="c"># avoiding exception handling</span>
<span class="n">choices</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;invalid&quot;</span><span class="p">,</span> <span class="s">&quot;success&quot;</span><span class="p">,</span> <span class="s">&quot;error&quot;</span><span class="p">,</span> <span class="s">&quot;boom&quot;</span><span class="p">]</span>
<span class="n">choices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pexpect</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">)</span>
<span class="n">choices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pexpect</span><span class="o">.</span><span class="n">EOF</span><span class="p">)</span>

<span class="n">which</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">choices</span><span class="p">)</span>

<span class="c"># if TIMEOUT or EOF occurs, appropriate index is returned</span>
<span class="c"># (instead of raising exception)</span>
<span class="c"># 4: TIMEOUT</span>
<span class="c"># 5: EOF</span>

<span class="c"># @@PLEAC@@_15.14</span>
<span class="kn">from</span> <span class="nn">Tkinter</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">print_callback</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">&quot;print_callback&quot;</span>

<span class="n">main</span> <span class="o">=</span> <span class="n">Tk</span><span class="p">()</span>

<span class="n">menubar</span> <span class="o">=</span> <span class="n">Menu</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>
<span class="n">main</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">menubar</span><span class="p">)</span>

<span class="n">file_menu</span> <span class="o">=</span> <span class="n">Menu</span><span class="p">(</span><span class="n">menubar</span><span class="p">)</span>
<span class="n">menubar</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;File&quot;</span><span class="p">,</span> <span class="n">underline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">menu</span><span class="o">=</span><span class="n">file_menu</span><span class="p">)</span>
<span class="n">file_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;Print&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="n">print_callback</span><span class="p">)</span>

<span class="n">main</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>

<span class="c"># using a class</span>
<span class="kn">from</span> <span class="nn">Tkinter</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">Application</span><span class="p">(</span><span class="n">Tk</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">print_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;print_callback&quot;</span>
    <span class="k">def</span> <span class="nf">debug_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;debug:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;debug level:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_level</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">createWidgets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">menubar</span> <span class="o">=</span> <span class="n">Menu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">menubar</span><span class="p">)</span>
        <span class="n">file_menu</span> <span class="o">=</span> <span class="n">Menu</span><span class="p">(</span><span class="n">menubar</span><span class="p">)</span>
        <span class="n">menubar</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;File&quot;</span><span class="p">,</span>      
                    <span class="n">underline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">menu</span><span class="o">=</span><span class="n">file_menu</span><span class="p">)</span>
        <span class="n">file_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;Print&quot;</span><span class="p">,</span>
                <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">print_callback</span><span class="p">)</span>
        <span class="n">file_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;Quit Immediately&quot;</span><span class="p">,</span>
                <span class="n">command</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">)</span>
        <span class="c"># </span>
        <span class="n">options_menu</span> <span class="o">=</span> <span class="n">Menu</span><span class="p">(</span><span class="n">menubar</span><span class="p">)</span>
        <span class="n">menubar</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;Options&quot;</span><span class="p">,</span>
                <span class="n">underline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">menu</span><span class="o">=</span><span class="n">options_menu</span><span class="p">)</span>
        <span class="n">options_menu</span><span class="o">.</span><span class="n">add_checkbutton</span><span class="p">(</span>
                <span class="n">label</span><span class="o">=</span><span class="s">&quot;Create Debugging File&quot;</span><span class="p">,</span>
                <span class="n">variable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">,</span>
                <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_callback</span><span class="p">,</span>
                <span class="n">onvalue</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">offvalue</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">options_menu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">()</span>
        <span class="n">options_menu</span><span class="o">.</span><span class="n">add_radiobutton</span><span class="p">(</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;Level 1&quot;</span><span class="p">,</span>
                <span class="n">variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_level</span><span class="p">,</span>
                <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="p">)</span>
        <span class="n">options_menu</span><span class="o">.</span><span class="n">add_radiobutton</span><span class="p">(</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;Level 2&quot;</span><span class="p">,</span>
                <span class="n">variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_level</span><span class="p">,</span>
                <span class="n">value</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="p">)</span>
        <span class="n">options_menu</span><span class="o">.</span><span class="n">add_radiobutton</span><span class="p">(</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;Level 3&quot;</span><span class="p">,</span>
                <span class="n">variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_level</span><span class="p">,</span>
                <span class="n">value</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">Tk</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">)</span>
        <span class="c"># bound variables must be IntVar, StrVar, ...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">IntVar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_level</span> <span class="o">=</span> <span class="n">IntVar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_level</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createWidgets</span><span class="p">()</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Application</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>

<span class="c"># @@PLEAC@@_15.15</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_15.16</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_15.17</span>
<span class="c"># Start Python scripts without the annoying DOS window on win32</span>
<span class="c"># Use extension &quot;.pyw&quot; on files - eg: &quot;foo.pyw&quot; instead of &quot;foo.py&quot;</span>
<span class="c"># Or run programs using &quot;pythonw.exe&quot; rather than &quot;python.exe&quot; </span>

<span class="c"># @@PLEAC@@_15.18</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_15.19</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>


<span class="c"># @@PLEAC@@_16.1</span>
<span class="kn">import</span> <span class="nn">popen2</span>

<span class="c"># other popen methods than popen4 can lead to deadlocks</span>
<span class="c"># if there is much data on stdout and stderr</span>

<span class="p">(</span><span class="n">err_out</span><span class="p">,</span> <span class="n">stdin</span><span class="p">)</span> <span class="o">=</span> <span class="n">popen2</span><span class="o">.</span><span class="n">popen4</span><span class="p">(</span><span class="s">&quot;program args&quot;</span><span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">err_out</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="c"># collect output into one multiline string</span>

<span class="p">(</span><span class="n">err_out</span><span class="p">,</span> <span class="n">stdin</span><span class="p">)</span> <span class="o">=</span> <span class="n">popen2</span><span class="o">.</span><span class="n">popen4</span><span class="p">(</span><span class="s">&quot;program args&quot;</span><span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">err_out</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span> <span class="c"># collect output into a list, one line per element</span>

<span class="c">#-----------------------------</span>

<span class="p">(</span><span class="n">err_out</span><span class="p">,</span> <span class="n">stdin</span><span class="p">)</span> <span class="o">=</span> <span class="n">popen2</span><span class="o">.</span><span class="n">popen4</span><span class="p">(</span><span class="s">&quot;program args&quot;</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">err_out</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">output</span><span class="o">.</span><span class="n">appen</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

<span class="c"># @@PLEAC@@_16.2</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="s">&quot;foo.txt&quot;</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;vi </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">myfile</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;cmd1 args | cmd2 | cmd3 &gt;outfile&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;cmd args &lt;infile &gt;outfile 2&gt;errfile&quot;</span><span class="p">)</span>

<span class="n">status</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">))</span>
<span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> exited funny: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span>
    

<span class="c"># @@PLEAC@@_16.3</span>
<span class="c"># -----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&quot;*.data&quot;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">execvp</span><span class="p">(</span><span class="s">&quot;archive&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Couldn&#39;t replace myself with archive: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">err</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span>

<span class="c"># The error message does not contain the line number like the &quot;die&quot; in</span>
<span class="c"># perl. But if you want to show more information for debugging, you can</span>
<span class="c"># delete the try...except and you get a nice traceback which shows all</span>
<span class="c"># line numbers and filenames.</span>

<span class="c"># -----------------------------</span>
<span class="n">os</span><span class="o">.</span><span class="n">execvp</span><span class="p">(</span><span class="s">&quot;archive&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;accounting.data&quot;</span><span class="p">])</span>

<span class="c"># @@PLEAC@@_16.4</span>
<span class="c"># -------------------------</span>
<span class="c"># Read from a child process</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">popen2</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">popen2</span><span class="o">.</span><span class="n">Popen4</span><span class="p">(</span><span class="s">&quot;program arguments&quot;</span><span class="p">)</span>
<span class="n">pid</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">pid</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fromchild</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

<span class="c"># Popen4 provides stdout and stderr.</span>
<span class="c"># This avoids deadlocks if you get data</span>
<span class="c"># from both streams.</span>
<span class="c">#</span>
<span class="c"># If you don&#39;t need the pid, you</span>
<span class="c"># can use popen2.popen4(...)</span>

<span class="c"># -----------------------------</span>
<span class="c"># Write to a child process</span>

<span class="kn">import</span> <span class="nn">popen2</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">popen2</span><span class="o">.</span><span class="n">Popen4</span><span class="p">(</span><span class="s">&quot;gzip &gt; foo.gz&quot;</span><span class="p">)</span>
<span class="n">pid</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">pid</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">tochild</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Hello zipped world!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">tochild</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c"># programm will get EOF on STDIN</span>

<span class="c"># @@PLEAC@@_16.5</span>
<span class="k">class</span> <span class="nc">OutputFilter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textbuffer</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">textbuffer</span> <span class="o">+</span> <span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">textbuffer</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">textbuffer</span> <span class="o">+=</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">data</span>

<span class="k">class</span> <span class="nc">HeadFilter</span><span class="p">(</span><span class="n">OutputFilter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxcount</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxcount</span> <span class="o">=</span> <span class="n">maxcount</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxcount</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">data</span>

<span class="k">class</span> <span class="nc">NumberFilter</span><span class="p">(</span><span class="n">OutputFilter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="o">=</span><span class="mi">0</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">QuoteFilter</span><span class="p">(</span><span class="n">OutputFilter</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&gt; &quot;</span> <span class="o">+</span> <span class="n">data</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">HeadFilter</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">130</span><span class="p">):</span>
    <span class="k">print</span><span class="o">&gt;&gt;</span><span class="n">f</span><span class="p">,</span> <span class="n">i</span>

<span class="k">print</span>

<span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;Welcome to Linux, version 2.0.33 on a i686</span>

<span class="s">&quot;The software required `Windows 95 or better&#39;, </span>
<span class="s">so I installed Linux.&quot; &quot;&quot;&quot;</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">NumberFilter</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">QuoteFilter</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">):</span>
    <span class="k">print</span><span class="o">&gt;&gt;</span><span class="n">f2</span><span class="p">,</span> <span class="n">line</span>
<span class="k">print</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">QuoteFilter</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">NumberFilter</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">):</span>
    <span class="k">print</span><span class="o">&gt;&gt;</span><span class="n">f2</span><span class="p">,</span> <span class="n">line</span>


<span class="c"># @@PLEAC@@_16.6</span>
<span class="c"># This script accepts several filenames</span>
<span class="c"># as argument. If the file is zipped, unzip</span>
<span class="c"># it first. Then read each line if the file</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">popen2</span>

<span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="k">if</span> <span class="nb">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;.gz&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;.Z&quot;</span><span class="p">):</span>
        <span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="n">stdin</span><span class="p">)</span> <span class="o">=</span> <span class="n">popen2</span><span class="o">.</span><span class="n">popen2</span><span class="p">(</span><span class="s">&quot;gzip -dc &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="nb">file</span><span class="p">)</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="n">stdout</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fd</span><span class="p">:</span>
        <span class="c"># ....</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c">#-----------------------------</span>

<span class="c">#-----------------------------</span>
<span class="c"># Ask for filename and open it</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="k">print</span> <span class="s">&quot;File, please?&quot;</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="nb">file</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="c"># chomp</span>
<span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>

<span class="c"># @@PLEAC@@_16.7</span>
<span class="c"># Execute foo_command and read the output</span>

<span class="kn">import</span> <span class="nn">popen2</span>
<span class="p">(</span><span class="n">stdout_err</span><span class="p">,</span> <span class="n">stdin</span><span class="p">)</span> <span class="o">=</span> <span class="n">popen2</span><span class="o">.</span><span class="n">popen4</span><span class="p">(</span><span class="s">&quot;foo_command&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">stdout_err</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
    <span class="c"># ....</span>

<span class="c"># @@PLEAC@@_16.8</span>
<span class="c"># Open command in a pipe</span>
<span class="c"># which reads from stdin and writes to stdout</span>

<span class="kn">import</span> <span class="nn">popen2</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">popen2</span><span class="o">.</span><span class="n">Popen4</span><span class="p">(</span><span class="s">&quot;wc -l&quot;</span><span class="p">)</span> <span class="c"># Unix command</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">tochild</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;line 1</span><span class="se">\n</span><span class="s">line 2</span><span class="se">\n</span><span class="s">line 3</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">tochild</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">fromchild</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c"># @@PLEAC@@_16.9</span>

<span class="c"># popen3: get stdout and stderr of new process</span>
<span class="c"># Attetion: This can lead to deadlock,</span>
<span class="c"># since the buffer of stderr or stdout might get filled.</span>
<span class="c"># You need to use select if you want to avoid this.</span>

<span class="kn">import</span> <span class="nn">popen2</span>
<span class="p">(</span><span class="n">child_stdout</span><span class="p">,</span> <span class="n">child_stdin</span><span class="p">,</span> <span class="n">child_stderr</span><span class="p">)</span> <span class="o">=</span> <span class="n">popen2</span><span class="o">.</span><span class="n">popen3</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c"># @@PLEAC@@_16.10</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_16.11</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_16.12</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_16.13</span>
<span class="c">#</span>
<span class="c"># Print available signals and their value</span>
<span class="c"># See &quot;man signal&quot; &quot;man kill&quot; on unix.</span>

<span class="kn">import</span> <span class="nn">signal</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">signal</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;SIG&quot;</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">signal</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="c"># @@PLEAC@@_16.14</span>
<span class="c"># You can send signals to processes</span>
<span class="c"># with os.kill(pid, signal)</span>


<span class="c"># @@PLEAC@@_16.15</span>
<span class="kn">import</span> <span class="nn">signal</span>

<span class="k">def</span> <span class="nf">get_sig_quit</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
    <span class="o">....</span>

<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGQUIT</span><span class="p">,</span> <span class="n">get_sig_quit</span><span class="p">)</span>   <span class="c"># Install handler</span>

<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIG_IGN</span><span class="p">)</span>  <span class="c"># Ignore this signal</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGSTOP</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIG_DFL</span><span class="p">)</span> <span class="c"># Restore to default handling</span>

<span class="c"># @@PLEAC@@_16.16</span>
<span class="c"># Example of handler: User must Enter Name ctrl-c does not help</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">signal</span>

<span class="k">def</span> <span class="nf">ding</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\a</span><span class="s">Enter your name!&quot;</span>
    <span class="k">return</span>

<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">ding</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Please enter your name:&quot;</span>

<span class="n">name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
<span class="k">while</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="k">print</span> <span class="s">&quot;Hello: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">name</span>

<span class="c"># @@PLEAC@@_16.17</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_16.18</span>
<span class="kn">import</span> <span class="nn">signal</span>

<span class="c"># ignore signal INT</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIG_IGN</span><span class="p">)</span>

<span class="c"># Install signal handler</span>
<span class="k">def</span> <span class="nf">tsktsk</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;...&quot;</span>

<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">tsktsk</span><span class="p">)</span>

<span class="c"># @@PLEAC@@_16.19</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_16.20</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_16.21</span>
<span class="kn">import</span> <span class="nn">signal</span>

<span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
    <span class="k">raise</span> <span class="s">&quot;timeout&quot;</span>

<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGALRM</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c"># signal.alarm(3600)</span>

    <span class="c"># long-time operation</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;foo&quot;</span>

    <span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;timed out&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;no time out&quot;</span>

<span class="c"># @@PLEAC@@_16.22</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_17.0</span>
<span class="c"># Socket Programming (tcp/ip and udp/ip)</span>

<span class="kn">import</span> <span class="nn">socket</span>

<span class="c"># Convert human readable form to 32 bit value</span>
<span class="n">packed_ip</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_aton</span><span class="p">(</span><span class="s">&quot;208.146.240.1&quot;</span><span class="p">)</span>
<span class="n">packed_ip</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_aton</span><span class="p">(</span><span class="s">&quot;www.oreilly.com&quot;</span><span class="p">)</span>

<span class="c"># Convert 32 bit value to ip adress</span>
<span class="n">ip_adress</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_ntoa</span><span class="p">(</span><span class="n">packed_ip</span><span class="p">)</span>

<span class="c"># Create socket object</span>
<span class="n">socketobj</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="c"># Example socket.AF_INT, socket.SOCK_STREAM</span>
       
<span class="c"># Get socketname</span>
<span class="n">socketobj</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()</span> <span class="c"># Example, get port adress of client</span>

<span class="c"># @@PLEAC@@_17.1</span>

<span class="c"># Example: Connect to a server (tcp)</span>
<span class="c"># Connect to a smtp server at localhost and send an email.</span>
<span class="c"># For real applications you should use smtplib.</span>

<span class="kn">import</span> <span class="nn">socket</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span> <span class="c"># SMTP</span>
<span class="k">print</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;mail from: &lt;pleac@localhost&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;rcpt to: &lt;guettli@localhost&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;data</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;From: Python Lover</span><span class="se">\n</span><span class="s">Subject: Python is better then perl</span><span class="se">\n\n</span><span class="s">YES!</span><span class="se">\n</span><span class="s">.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># @@PLEAC@@_17.2</span>

<span class="c"># Create a Server, calling handler for every client</span>
<span class="c"># You can test it with &quot;telnet localhost 1029&quot;</span>

<span class="kn">from</span> <span class="nn">SocketServer</span> <span class="kn">import</span> <span class="n">TCPServer</span>
<span class="kn">from</span> <span class="nn">SocketServer</span> <span class="kn">import</span> <span class="n">BaseRequestHandler</span>

<span class="k">class</span> <span class="nc">MyHandler</span><span class="p">(</span><span class="n">BaseRequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;I got an request&quot;</span>
        
<span class="n">server</span> <span class="o">=</span> <span class="n">TCPServer</span><span class="p">((</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="mi">1029</span><span class="p">),</span> <span class="n">MyHandler</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>

<span class="c"># @@PLEAC@@_17.3</span>
<span class="c"># This is the continuation of 17.2</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">SocketServer</span> <span class="kn">import</span> <span class="n">TCPServer</span>
<span class="kn">from</span> <span class="nn">SocketServer</span> <span class="kn">import</span> <span class="n">BaseRequestHandler</span>

<span class="k">class</span> <span class="nc">MyHandler</span><span class="p">(</span><span class="n">BaseRequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># self.request is the socket object</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> I got an request from ip=</span><span class="si">%s</span><span class="s"> port=</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&quot;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_address</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client_address</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;What is your name?</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">bufsize</span><span class="o">=</span><span class="mi">1024</span>
        <span class="n">response</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">bufsize</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="c"># or recv(bufsize, flags)</span>
        <span class="n">data_to_send</span><span class="o">=</span><span class="s">&quot;Welcome </span><span class="si">%s</span><span class="s">!</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">response</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data_to_send</span><span class="p">)</span> <span class="c"># or send(data, flags)</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> connection finnished&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_address</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
<span class="n">server</span> <span class="o">=</span> <span class="n">TCPServer</span><span class="p">((</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="mi">1028</span><span class="p">),</span> <span class="n">MyHandler</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>

<span class="c"># -----------------</span>
<span class="c"># Using select</span>

<span class="kn">import</span> <span class="nn">select</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">in_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">in_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mysocket</span><span class="p">)</span>
<span class="n">in_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">myfile</span><span class="p">)</span>
<span class="c"># ...</span>

<span class="n">out_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">out_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">except_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">except_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="p">(</span><span class="n">in_</span><span class="p">,</span> <span class="n">out_</span><span class="p">,</span> <span class="n">exc_</span><span class="p">)</span> <span class="o">=</span> <span class="n">select</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">in_list</span><span class="p">,</span> <span class="n">out_list</span><span class="p">,</span> <span class="n">except_list</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>

<span class="k">for</span> <span class="n">fd</span> <span class="ow">in</span> <span class="n">in_</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Can read&quot;</span><span class="p">,</span> <span class="n">fd</span>
<span class="k">for</span> <span class="n">fd</span> <span class="ow">in</span> <span class="n">out_</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Can write&quot;</span><span class="p">,</span> <span class="n">fd</span>
<span class="k">for</span> <span class="n">fd</span> <span class="ow">in</span> <span class="n">exc_</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Exception on&quot;</span><span class="p">,</span> <span class="n">fd</span>

<span class="c"># Missing: setting TCP_NODELAY</span>

<span class="c"># @@PLEAC@@_17.4</span>

<span class="kn">import</span> <span class="nn">socket</span>
<span class="c"># Set up a UDP socket</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
<span class="c"># send </span>
<span class="n">MSG</span> <span class="o">=</span> <span class="s">&#39;Hello&#39;</span>
<span class="n">HOSTNAME</span> <span class="o">=</span> <span class="s">&#39;127.0.0.1&#39;</span>
<span class="n">PORTNO</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">HOSTNAME</span><span class="p">,</span> <span class="n">PORTNO</span><span class="p">))</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">MSG</span><span class="p">)</span> <span class="o">!=</span> <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">MSG</span><span class="p">):</span>
    <span class="c"># where to get error message &quot;$!&quot;.</span>
    <span class="k">print</span> <span class="s">&quot;cannot send to </span><span class="si">%s</span><span class="s">(</span><span class="si">%d</span><span class="s">):&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">HOSTNAME</span><span class="p">,</span><span class="n">PORTNO</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">MAXLEN</span> <span class="o">=</span> <span class="mi">1024</span>
<span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">addr</span><span class="p">)</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recvfrom</span><span class="p">(</span><span class="n">MAXLEN</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">(</span><span class="si">%d</span><span class="s">) said &quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">)</span>

<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch17/clockdrift</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># clockdrift - compare another system&#39;s clock with this one</span>

<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">him</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">him</span> <span class="o">=</span> <span class="s">&#39;127.1&#39;</span>

<span class="n">SECS_of_70_YEARS</span> <span class="o">=</span> <span class="mi">2208988800</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">him</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">getservbyname</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">,</span><span class="s">&#39;udp&#39;</span><span class="p">)))</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">ptime</span><span class="p">,</span> <span class="n">src</span><span class="p">)</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recvfrom</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">host</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyaddr</span><span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">delta</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&quot;!L&quot;</span><span class="p">,</span> <span class="n">ptime</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">SECS_of_70_YEARS</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;Clock on </span><span class="si">%s</span><span class="s"> is </span><span class="si">%d</span><span class="s"> seconds ahead of this one.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">host</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">delta</span><span class="p">)</span>



<span class="c"># @@PLEAC@@_17.5</span>

<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">server_port</span><span class="p">))</span>
<span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Couldn&#39;t be a udp server on port </span><span class="si">%d</span><span class="s"> : </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">server_port</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">datagram</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">MAX_TO_READ</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">datagram</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="c"># do something</span>
<span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># or </span>
<span class="kn">import</span> <span class="nn">SocketServer</span>

<span class="k">class</span> <span class="nc">handler</span><span class="p">(</span><span class="n">SocketServer</span><span class="o">.</span><span class="n">DatagramRequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># do something (with self.request[0])</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">SocketServer</span><span class="o">.</span><span class="n">UDPServer</span><span class="p">((</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="mi">10000</span><span class="p">),</span> <span class="n">handler</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>

<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch17/udpqotd</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># udpqotd - UDP message server</span>

<span class="kn">import</span> <span class="nn">SocketServer</span>

<span class="n">PORTNO</span> <span class="o">=</span> <span class="mi">5151</span>

<span class="k">class</span> <span class="nc">handler</span><span class="p">(</span><span class="n">SocketServer</span><span class="o">.</span><span class="n">DatagramRequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">newmsg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;Client </span><span class="si">%s</span><span class="s"> said ``</span><span class="si">%s</span><span class="s">&#39;&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_address</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">newmsg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">oldmsg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">oldmsg</span> <span class="o">=</span> <span class="n">newmsg</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">SocketServer</span><span class="o">.</span><span class="n">UDPServer</span><span class="p">((</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">PORTNO</span><span class="p">),</span> <span class="n">handler</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Awaiting UDP messages on port </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">PORTNO</span>
<span class="n">s</span><span class="o">.</span><span class="n">oldmsg</span> <span class="o">=</span> <span class="s">&quot;This is the starting message.&quot;</span>
<span class="n">s</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>


<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch17/udpmsg</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># udpmsg - send a message to the udpquotd server</span>

<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">MAXLEN</span> <span class="o">=</span> <span class="mi">1024</span>
<span class="n">PORTNO</span> <span class="o">=</span> <span class="mi">5151</span>
<span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">server_host</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">msg</span> <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>

<span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
<span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">TIMEOUT</span><span class="p">)</span>
<span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">server_host</span><span class="p">,</span> <span class="n">PORTNO</span><span class="p">))</span>
<span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">MAXLEN</span><span class="p">)</span>
    <span class="n">ipaddr</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">getpeername</span><span class="p">()</span>
    <span class="n">hishost</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyaddr</span><span class="p">(</span><span class="n">ipaddr</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;Server </span><span class="si">%s</span><span class="s"> responded ``</span><span class="si">%s</span><span class="s">&#39;&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">hishost</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">msg</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;recv from </span><span class="si">%s</span><span class="s"> failed (timeout or no server running).&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">server_host</span> <span class="p">)</span>
<span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="c"># @@PLEAC@@_17.6</span>

<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">os.path</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s">&quot;/tmp/mysock&quot;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;/tmp/mysock&quot;</span><span class="p">)</span>
        
<span class="n">server</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_UNIX</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s">&quot;/tmp/mysock&quot;</span><span class="p">)</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_UNIX</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;/tmp/mysock&quot;</span><span class="p">)</span>
        
<span class="c"># @@PLEAC@@_17.7</span>

<span class="n">ipaddr</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getpeername</span><span class="p">()</span>
<span class="n">hostname</span><span class="p">,</span> <span class="n">aliaslist</span><span class="p">,</span> <span class="n">ipaddrlist</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyaddr</span><span class="p">(</span><span class="n">ipaddr</span><span class="p">)</span>
<span class="n">ipaddr</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="s">&#39;www.python.org&#39;</span><span class="p">)</span>
<span class="c"># &#39;194.109.137.226&#39;</span>
<span class="n">hostname</span><span class="p">,</span> <span class="n">aliaslist</span><span class="p">,</span> <span class="n">ipaddrlist</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname_ex</span><span class="p">(</span><span class="s">&#39;www.python.org&#39;</span><span class="p">)</span>
<span class="c"># (&#39;fang.python.org&#39;, [&#39;www.python.org&#39;], [&#39;194.109.137.226&#39;])</span>
<span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname_ex</span><span class="p">(</span><span class="s">&#39;www.google.org&#39;</span><span class="p">)</span>
<span class="c"># (&#39;www.l.google.com&#39;, [&#39;www.google.org&#39;, &#39;www.google.com&#39;], </span>
<span class="c">#  [&#39;64.233.161.147&#39;,&#39;64.233.161.104&#39;, &#39;64.233.161.99&#39;])</span>

<span class="c"># @@PLEAC@@_17.8</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="n">kernel</span><span class="p">,</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">hardware</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">address</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
<span class="n">hostname</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyaddr</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
<span class="n">hostname</span><span class="p">,</span> <span class="n">aliaslist</span><span class="p">,</span> <span class="n">ipaddrlist</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname_ex</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
<span class="c"># e.g. (&#39;lx3.local&#39;, [&#39;lx3&#39;, &#39;b70&#39;], [&#39;192.168.0.13&#39;, &#39;192.168.0.70&#39;])</span>

<span class="c"># @@PLEAC@@_17.9</span>

<span class="n">socket</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>   <span class="c"># Further receives are disallowed</span>
<span class="n">socket</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="c"># Further sends are disallowed.</span>
<span class="n">socket</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>   <span class="c"># Further sends and receives are disallowed.</span>

<span class="c">#</span>

<span class="n">server</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;my request</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>  <span class="c"># send some data</span>
<span class="n">server</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>           <span class="c"># send eof; no more writing</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>   <span class="c"># but you can still read</span>

<span class="c"># @@PLEAC@@_17.10</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_17.11</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_17.12</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_17.13</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_17.14</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_17.15</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_17.16</span>
<span class="c">#------------------------------</span>
<span class="c"># Restart programm on signal SIGHUP</span>
<span class="c"># Script must be executable: chmod a+x foo.py</span>

<span class="c">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">signal</span>

<span class="k">def</span> <span class="nf">phoenix</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Restarting myself: </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">execv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

<span class="bp">self</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[:]</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGHUP</span><span class="p">,</span> <span class="n">phoenix</span><span class="p">)</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;work&quot;</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c">#--------------------</span>
<span class="c"># Read config file on SIGHUP</span>
<span class="kn">import</span> <span class="nn">signal</span>

<span class="n">config_file</span> <span class="o">=</span> <span class="s">&quot;/usr/local/etc/myprog/server_conf.py&quot;</span>

<span class="k">def</span> <span class="nf">read_config</span><span class="p">():</span>
    <span class="nb">execfile</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>

<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGHUP</span><span class="p">,</span> <span class="n">read_config</span><span class="p">)</span>

<span class="c"># @@PLEAC@@_17.17</span>

<span class="c"># chroot</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chroot</span><span class="p">(</span><span class="s">&quot;/var/daemon&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Could not chroot&quot;</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="c"># fork (Unix): Create a new process</span>
<span class="c"># if pid == 0 --&gt; parent process</span>
<span class="c"># else child process</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="n">pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fork</span><span class="p">()</span>
<span class="k">if</span> <span class="n">pid</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;I am the new child </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">pid</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;I am still the parent&quot;</span>
    

<span class="c"># ----------------------------</span>
<span class="c"># setsid (Unix): Create a new session</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="nb">id</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">setsid</span><span class="p">()</span>

<span class="c"># ----------------------------</span>
<span class="c"># Work until INT TERM or HUP signal is received</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">signal</span>

<span class="n">time_to_die</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">sighandler</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;time to die&quot;</span>
    <span class="k">global</span> <span class="n">time_to_die</span>
    <span class="n">time_to_die</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">sighandler</span><span class="p">)</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">sighandler</span><span class="p">)</span>
<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGHUP</span><span class="p">,</span> <span class="n">sighandler</span><span class="p">)</span>

<span class="k">while</span> <span class="ow">not</span> <span class="n">time_to_die</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;work&quot;</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># @@PLEAC@@_17.18</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_18.1</span>

<span class="kn">import</span> <span class="nn">socket</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">host_info</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname_ex</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="c"># (hostname, aliaslist, ipaddrlist)</span>
<span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Can&#39;t resolve hostname </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">err</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    
<span class="c"># if you only need the first one</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">address</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Can&#39;t resolve hostname </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">err</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c"># if you have an ip address</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">host_info</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyaddr</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
    <span class="c"># (hostname, aliaslist, ipaddrlist)</span>
<span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Can&#39;t resolve address </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">err</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    
<span class="c"># checking back</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">host_info</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyaddr</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
<span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Can&#39;t look up </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">err</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">host_info</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname_ex</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Can&#39;t look up </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">err</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">found</span> <span class="o">=</span> <span class="n">address</span> <span class="ow">in</span> <span class="n">host_info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="c"># use dnspython for more complex jobs.</span>
<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch18/mxhost</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># mxhost - find mx exchangers for a host</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">dns</span>
<span class="kn">import</span> <span class="nn">dns.resolver</span>

<span class="n">answers</span> <span class="o">=</span> <span class="n">dns</span><span class="o">.</span><span class="n">resolver</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;MX&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">rdata</span> <span class="ow">in</span> <span class="n">answers</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">rdata</span><span class="o">.</span><span class="n">preference</span><span class="p">,</span> <span class="n">rdata</span><span class="o">.</span><span class="n">exchange</span>



<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch18/hostaddrs</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># hostaddrs - canonize name and show addresses</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">hent</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname_ex</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> aliases: </span><span class="si">%s</span><span class="s"> =&gt; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">hent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">hent</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="s">&quot;None&quot;</span> <span class="ow">or</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hent</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hent</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">)</span>


<span class="c"># @@PLEAC@@_18.2</span>
<span class="kn">import</span> <span class="nn">ftplib</span>
<span class="n">ftp</span> <span class="o">=</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP</span><span class="p">(</span><span class="s">&quot;ftp.host.com&quot;</span><span class="p">)</span>
<span class="n">ftp</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<span class="n">ftp</span><span class="o">.</span><span class="n">cwd</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

<span class="c"># get file</span>
<span class="n">outfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span>
<span class="n">ftp</span><span class="o">.</span><span class="n">retrbinary</span><span class="p">(</span><span class="s">&quot;RETR </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">,</span> <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
<span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># upload file</span>
<span class="n">upfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">upfilename</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span>
<span class="n">ftp</span><span class="o">.</span><span class="n">storbinary</span><span class="p">(</span><span class="s">&quot;STOR </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">upfilename</span><span class="p">,</span> <span class="n">upfile</span><span class="p">)</span>
<span class="n">upfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">ftp</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>


<span class="c"># @@PLEAC@@_18.3</span>
<span class="kn">import</span> <span class="nn">smtplib</span>
<span class="kn">from</span> <span class="nn">email.MIMEText</span> <span class="kn">import</span> <span class="n">MIMEText</span>

<span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
<span class="n">msg</span><span class="p">[</span><span class="s">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">from_address</span>
<span class="n">msg</span><span class="p">[</span><span class="s">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_address</span>
<span class="n">msg</span><span class="p">[</span><span class="s">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>

<span class="n">mailer</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">()</span>
<span class="n">mailer</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">mailer</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">from_address</span><span class="p">,</span> <span class="p">[</span><span class="n">to_address</span><span class="p">],</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>

<span class="c"># @@PLEAC@@_18.4</span>
<span class="kn">import</span> <span class="nn">nntplib</span>

<span class="c"># You can except nntplib.NNTPError to process errors</span>
<span class="c"># instead of displaying traceback.</span>

<span class="n">server</span> <span class="o">=</span> <span class="n">nntplib</span><span class="o">.</span><span class="n">NNTP</span><span class="p">(</span><span class="s">&quot;news.example.com&quot;</span><span class="p">)</span>
<span class="n">response</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s">&quot;misc.test&quot;</span><span class="p">)</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
<span class="n">bodytext</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">body</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>
<span class="n">article</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">article</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="s">&quot;article.txt&quot;</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">response</span><span class="p">,</span> <span class="n">grouplist</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouplist</span><span class="p">:</span>
    <span class="n">name</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="n">group</span>
    <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="s">&#39;y&#39;</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c"># I can post to group</span>

<span class="c"># @@PLEAC@@_18.5</span>
<span class="kn">import</span> <span class="nn">poplib</span>

<span class="n">pop</span> <span class="o">=</span> <span class="n">poplib</span><span class="o">.</span><span class="n">POP3</span><span class="p">(</span><span class="s">&quot;mail.example.com&quot;</span><span class="p">)</span>
<span class="n">pop</span><span class="o">.</span><span class="n">user</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
<span class="n">pop</span><span class="o">.</span><span class="n">pass_</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
<span class="n">count</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">pop</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">reponse</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">octets</span> <span class="o">=</span> <span class="n">pop</span><span class="o">.</span><span class="n">retr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="c"># message is a list of lines</span>
    <span class="n">pop</span><span class="o">.</span><span class="n">dele</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="c"># You must quit, otherwise mailbox remains locked.</span>
<span class="n">pop</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

<span class="c"># @@PLEAC@@_18.6</span>

<span class="kn">import</span> <span class="nn">telnetlib</span>

<span class="n">tn</span> <span class="o">=</span> <span class="n">telnetlib</span><span class="o">.</span><span class="n">Telnet</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>

<span class="n">tn</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="s">&quot;login: &quot;</span><span class="p">)</span>
<span class="n">tn</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">user</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="n">tn</span><span class="o">.</span><span class="n">read_until</span><span class="p">(</span><span class="s">&quot;Password: &quot;</span><span class="p">)</span>
<span class="n">tn</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">password</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="c"># read the logon message up to the prompt</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">tn</span><span class="o">.</span><span class="n">expect</span><span class="p">([</span><span class="n">prompt</span><span class="p">,],</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">tn</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;ls</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">),</span> <span class="s">&quot;files&quot;</span>
<span class="n">tn</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;exit</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">tn</span><span class="o">.</span><span class="n">read_all</span><span class="p">()</span> <span class="c"># blocks till eof</span>

<span class="c"># @@PLEAC@@_18.7</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_18.8</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_18.9</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_19.0</span>
<span class="c"># Introduction</span>
<span class="c">#</span>
<span class="c"># There is no standard cgi/web framework in python,</span>
<span class="c"># this is reason for ranting now and then.</span>
<span class="c">#</span>
<span class="c"># See `PyWebOff &lt;http://pyre.third-bit.com/pyweb/index.html&gt;`__</span>
<span class="c"># which compares CherryPy, Quixote, Twisted, WebWare and Zope</span>
<span class="c"># Karrigell and print stantements. </span>
<span class="c">#</span>
<span class="c"># Then there is Nevow and Standalone ZPT.</span>

<span class="c"># @@PLEAC@@_19.1</span>
<span class="c"># Partial implementation of PLEAC Python section 19.1</span>
<span class="c"># Written by Seo Sanghyeon</span>

<span class="c"># Standard CGI module is where PERL shines. Python</span>
<span class="c"># module, cgi, is nothing but a form parser. So it is</span>
<span class="c"># not really fair to compare these two. But I hesitate</span>
<span class="c"># to introduce any non-standard module. After all,</span>
<span class="c"># which one should I choose?</span>

<span class="c"># I would stick to simple print statements. I believe</span>
<span class="c"># the following is close to how these tasks are usually</span>
<span class="c"># done in Python.</span>

<span class="c">#-----------------------------</span>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># hiweb - using FieldStorage class to get at form data</span>

<span class="kn">import</span> <span class="nn">cgi</span>
<span class="n">form</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">FieldStorage</span><span class="p">()</span>

<span class="c"># get a value from the form</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(</span><span class="s">&quot;PARAM_NAME&quot;</span><span class="p">)</span>

<span class="c"># print a standard header</span>
<span class="k">print</span> <span class="s">&quot;Content-Type: text/html&quot;</span>
<span class="k">print</span>

<span class="c"># print a document</span>
<span class="k">print</span> <span class="s">&quot;&lt;P&gt;You typed: &lt;TT&gt;</span><span class="si">%s</span><span class="s">&lt;/TT&gt;&lt;/P&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span>
    <span class="n">cgi</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
    <span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">cgi</span>
<span class="n">form</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">FieldStorage</span><span class="p">()</span>

<span class="n">who</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">)</span>
<span class="n">phone</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(</span><span class="s">&quot;Number&quot;</span><span class="p">)</span>
<span class="n">picks</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(</span><span class="s">&quot;Choices&quot;</span><span class="p">)</span>

<span class="c"># if you want to assure `picks&#39; to be a list</span>
<span class="n">picks</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s">&quot;Choices&quot;</span><span class="p">)</span>

<span class="c">#-----------------------------</span>
<span class="c"># Not Implemented</span>

<span class="c"># To implement -EXPIRES =&gt; &#39;+3d&#39;, I need to study about</span>
<span class="kn">import</span> <span class="nn">cgi</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">time_format</span> <span class="o">=</span> <span class="s">&quot;%a, </span><span class="si">%d</span><span class="s"> %b %Y %H:%M:%S %Z&quot;</span>
<span class="k">print</span> <span class="s">&quot;Expires: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="o">+</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">time_format</span><span class="p">)</span>
        <span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Date: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">time_format</span><span class="p">))</span>
<span class="k">print</span> <span class="s">&quot;Content-Type: text/plain; charset=ISO-8859-1&quot;</span>

<span class="c">#-----------------------------</span>
<span class="c"># NOTES</span>

<span class="c"># CGI::param() is a multi-purpose function. Here I want to</span>
<span class="c"># note which Python functions correspond to it.</span>

<span class="c"># PERL version 5.6.1, CGI.pm version 2.80.</span>
<span class="c"># Python version 2.2.3. cgi.py CVS revision 1.68.</span>

<span class="c"># Assume that `form&#39; is the FieldStorage instance.</span>

<span class="c"># param() with zero argument returns parameter names as</span>
<span class="c"># a list. It is `form.keys()&#39; in Python, following Python&#39;s</span>
<span class="c"># usual mapping interface.</span>

<span class="c"># param() with one argument returns the value of the named</span>
<span class="c"># parameter. It is `form.getvalue()&#39;, but there are some</span>
<span class="c"># twists:</span>

<span class="c"># 1) A single value is passed.</span>
<span class="c"># No problem.</span>

<span class="c"># 2) Multiple values are passed.</span>
<span class="c"># PERL: in LIST context, you get a list. in SCALAR context,</span>
<span class="c">#       you get the first value from the list.</span>
<span class="c"># Python: `form.getvalue()&#39; returns a list if multiple</span>
<span class="c">#         values are passed, a raw value if a single value</span>
<span class="c">#         is passed. With `form.getlist()&#39;, you always</span>
<span class="c">#         get a list. (When a single value is passed, you</span>
<span class="c">#         get a list with one element.) With `form.getfirst()&#39;,</span>
<span class="c">#         you always get a value. (When multiple values are</span>
<span class="c">#         passed, you get the first one.)</span>

<span class="c"># 3) Parameter name is given, but no value is passed.</span>
<span class="c"># PERL: returns an empty string, not undef. POD says this</span>
<span class="c">#       feature is new in 2.63, and was introduced to avoid</span>
<span class="c">#       &quot;undefined value&quot; warnings when running with the</span>
<span class="c">#       -w switch.</span>
<span class="c"># Python: tricky. If you want black values to be retained,</span>
<span class="c">#         you should pass a nonzero `keep_blank_values&#39; keyword</span>
<span class="c">#         argument. Default is not to retain blanks. In case</span>
<span class="c">#         values are not retained, see below.</span>

<span class="c"># 4) Even parameter name is never mentioned.</span>
<span class="c"># PERL: returns undef.</span>
<span class="c"># Python: returns None, or whatever you passed as the second</span>
<span class="c">#         argument, or `default` keyword argument. This is</span>
<span class="c">#         consistent with `get()&#39; method of the Python mapping</span>
<span class="c">#         interface.</span>

<span class="c"># param() with more than one argument modifies the already</span>
<span class="c"># set form data. This functionality is not available in Python</span>
<span class="c"># cgi module.</span>


<span class="c"># @@PLEAC@@_19.2</span>
<span class="c"># enable() from &#39;cgitb&#39; module, by default, redirects traceback</span>
<span class="c"># to the browser. It is defined as &#39;enable(display=True, logdir=None,</span>
<span class="c"># context=5)&#39;.</span>

<span class="c"># equivalent to importing CGI::Carp::fatalsToBrowser.</span>
<span class="kn">import</span> <span class="nn">cgitb</span>
<span class="n">cgitb</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>

<span class="c"># to suppress browser output, you should explicitly say so.</span>
<span class="kn">import</span> <span class="nn">cgitb</span>
<span class="n">cgitb</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c"># equivalent to call CGI::Carp::carpout with temporary files.</span>
<span class="kn">import</span> <span class="nn">cgitb</span>
<span class="n">cgitb</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="n">logdir</span><span class="o">=</span><span class="s">&quot;/var/local/cgi-logs/&quot;</span><span class="p">)</span>

<span class="c"># Python exception, traceback facilities are much richer than PERL&#39;s</span>
<span class="c"># die and its friends. You can use your custom exception formatter</span>
<span class="c"># by replacing sys.excepthook. (equivalent to CGI::Carp::set_message.)</span>
<span class="c"># Default formatter is available as traceback.print_exc() in pure</span>
<span class="c"># Python. In fact, what cgitb.enable() does is replacing excepthook</span>
<span class="c"># to cgitb.handler(), which knows how to format exceptions to HTML.</span>

<span class="c"># If this is not enough, (usually this is enough!) Python 2.3 comes</span>
<span class="c"># with a new standard module called &#39;logging&#39;, which is complex, but</span>
<span class="c"># very flexible and entirely customizable.</span>

<span class="c"># @@PLEAC@@_19.3</span>
<span class="c">#</span>
<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch19/webwhoami</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># webwhoami - show web users id</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="k">print</span> <span class="s">&quot;Content-Type: text/plain</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="k">print</span> <span class="s">&quot;Running as </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span>



<span class="c"># STDOUT/ERR flushing</span>
<span class="c">#</span>
<span class="c"># In contrast to what the perl cookbook says, modpython.org tells</span>
<span class="c"># STDERR is buffered too.</span>

<span class="c"># @@PLEAC@@_19.4</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_19.5</span>

<span class="c"># use mod_python in the Apache web server.</span>

<span class="c"># Load the module in httpd.conf or apache.conf</span>

<span class="n">LoadModule</span> <span class="n">python_module</span> <span class="n">libexec</span><span class="o">/</span><span class="n">mod_python</span><span class="o">.</span><span class="n">so</span>

<span class="o">&lt;</span><span class="n">Directory</span> <span class="o">/</span><span class="n">some</span><span class="o">/</span><span class="n">directory</span><span class="o">/</span><span class="n">htdocs</span><span class="o">/</span><span class="n">test</span><span class="o">&gt;</span>
    <span class="n">AddHandler</span> <span class="n">mod_python</span> <span class="o">.</span><span class="n">py</span>
    <span class="n">PythonHandler</span> <span class="n">mptest</span>
    <span class="n">PythonDebug</span> <span class="n">On</span>
<span class="o">&lt;/</span><span class="n">Directory</span><span class="o">&gt;</span>

<span class="c"># test.py file in /some/directory/htdocs/test</span>
<span class="kn">from</span> <span class="nn">mod_python</span> <span class="kn">import</span> <span class="n">apache</span>

<span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">req</span><span class="p">):</span>
    <span class="n">req</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Hello World!&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">apache</span><span class="o">.</span><span class="n">OK</span>

<span class="c"># @@PLEAC@@_19.6</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;command </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">files</span><span class="p">)))</span> <span class="c"># UNSAFE</span>

<span class="c"># python doc lib cgi-security it says</span>
<span class="c">#</span>
<span class="c"># To be on the safe side, if you must pass a string gotten from a form to a shell</span>
<span class="c"># command, you should make sure the string contains only alphanumeric characters, dashes,</span>
<span class="c"># underscores, and periods.</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">cmd</span> <span class="o">=</span> <span class="s">&quot;command </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">files</span><span class="p">))</span>
<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;[^a-zA-Z0-9._\-]&quot;</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;rejected&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
<span class="n">trans</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span><span class="o">+</span><span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="o">+</span><span class="s">&quot;-_.&quot;</span><span class="p">,</span>

<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_19.7</span>
<span class="c">#-----------------------------</span>
<span class="c"># This uses nevow&#39;s (http://nevow.com) stan; there&#39;s no standard</span>
<span class="c"># way to generate HTML, though there are many implementations of</span>
<span class="c"># this basic idea.</span>
<span class="kn">from</span> <span class="nn">nevow</span> <span class="kn">import</span> <span class="n">tags</span> <span class="k">as</span> <span class="n">T</span>
<span class="k">print</span> <span class="n">T</span><span class="o">.</span><span class="n">ol</span><span class="p">[</span><span class="n">T</span><span class="o">.</span><span class="n">li</span><span class="p">[</span><span class="s">&#39;red&#39;</span><span class="p">],</span> <span class="n">T</span><span class="o">.</span><span class="n">li</span><span class="p">[</span><span class="s">&#39;blue&#39;</span><span class="p">],</span> <span class="n">T</span><span class="o">.</span><span class="n">li</span><span class="p">[</span><span class="s">&#39;green&#39;</span><span class="p">]]</span>
<span class="c"># &lt;ol&gt;&lt;li&gt;red&lt;/li&gt;&lt;li&gt;blue&lt;/li&gt;&lt;li&gt;green&lt;/li&gt;&lt;/ol&gt;</span>

<span class="n">names</span> <span class="o">=</span> <span class="s">&#39;Larry Moe Curly&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="k">print</span> <span class="n">T</span><span class="o">.</span><span class="n">ul</span><span class="p">[</span> <span class="p">[</span><span class="n">T</span><span class="o">.</span><span class="n">li</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;disc&quot;</span><span class="p">)[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span> <span class="p">]</span>
<span class="c"># &lt;ul&gt;&lt;li type=&quot;disc&quot;&gt;Larry&lt;/li&gt;&lt;li type=&quot;disc&quot;&gt;Moe&lt;/li&gt;</span>
<span class="c">#     &lt;li type=&quot;disc&quot;&gt;Curly&lt;/li&gt;&lt;/ul&gt;</span>
<span class="c">#-----------------------------</span>
<span class="k">print</span> <span class="n">T</span><span class="o">.</span><span class="n">li</span><span class="p">[</span><span class="s">&quot;alpha&quot;</span><span class="p">]</span>
<span class="c">#     &lt;li&gt;alpha&lt;/li&gt;</span>

<span class="k">print</span> <span class="n">T</span><span class="o">.</span><span class="n">li</span><span class="p">[</span><span class="s">&#39;alpha&#39;</span><span class="p">],</span> <span class="n">T</span><span class="o">.</span><span class="n">li</span><span class="p">[</span><span class="s">&#39;omega&#39;</span><span class="p">]</span>
<span class="c">#     &lt;li&gt;alpha&lt;/li&gt; &lt;li&gt;omega&lt;/li&gt;</span>
<span class="c">#-----------------------------</span>
<span class="n">states</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;Wisconsin&quot;</span><span class="p">:</span>  <span class="p">[</span> <span class="s">&quot;Superior&quot;</span><span class="p">,</span> <span class="s">&quot;Lake Geneva&quot;</span><span class="p">,</span> <span class="s">&quot;Madison&quot;</span> <span class="p">],</span>
    <span class="s">&quot;Colorado&quot;</span><span class="p">:</span>   <span class="p">[</span> <span class="s">&quot;Denver&quot;</span><span class="p">,</span> <span class="s">&quot;Fort Collins&quot;</span><span class="p">,</span> <span class="s">&quot;Boulder&quot;</span> <span class="p">],</span>
    <span class="s">&quot;Texas&quot;</span><span class="p">:</span>      <span class="p">[</span> <span class="s">&quot;Plano&quot;</span><span class="p">,</span> <span class="s">&quot;Austin&quot;</span><span class="p">,</span> <span class="s">&quot;Fort Stockton&quot;</span> <span class="p">],</span>
    <span class="s">&quot;California&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s">&quot;Sebastopol&quot;</span><span class="p">,</span> <span class="s">&quot;Santa Rosa&quot;</span><span class="p">,</span> <span class="s">&quot;Berkeley&quot;</span> <span class="p">],</span>
<span class="p">}</span>

<span class="k">print</span> <span class="s">&quot;&lt;TABLE&gt; &lt;CAPTION&gt;Cities I Have Known&lt;/CAPTION&gt;&quot;</span><span class="p">;</span>
<span class="k">print</span> <span class="n">T</span><span class="o">.</span><span class="n">tr</span><span class="p">[</span><span class="n">T</span><span class="o">.</span><span class="n">th</span><span class="p">(</span><span class="s">&#39;State&#39;</span><span class="p">),</span> <span class="n">T</span><span class="o">.</span><span class="n">th</span><span class="p">(</span><span class="s">&#39;Cities&#39;</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">states</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="k">print</span> <span class="n">T</span><span class="o">.</span><span class="n">tr</span><span class="p">[</span> <span class="p">[</span><span class="n">T</span><span class="o">.</span><span class="n">th</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">T</span><span class="o">.</span><span class="n">td</span><span class="p">(</span><span class="n">city</span><span class="p">)</span> <span class="k">for</span> <span class="n">city</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="n">k</span><span class="p">])]</span> <span class="p">]</span>
<span class="k">print</span> <span class="s">&quot;&lt;/TABLE&gt;&quot;</span><span class="p">;</span>
<span class="c">#-----------------------------</span>
<span class="c"># &lt;TABLE&gt; &lt;CAPTION&gt;Cities I Have Known&lt;/CAPTION&gt;</span>
<span class="c">#</span>
<span class="c">#     &lt;TR&gt;&lt;TH&gt;State&lt;/TH&gt; &lt;TH&gt;Cities&lt;/TH&gt;&lt;/TR&gt;</span>
<span class="c">#</span>
<span class="c">#     &lt;TR&gt;&lt;TH&gt;California&lt;/TH&gt; &lt;TD&gt;Berkeley&lt;/TD&gt; &lt;TD&gt;Santa Rosa&lt;/TD&gt;</span>
<span class="c">#</span>
<span class="c">#         &lt;TD&gt;Sebastopol&lt;/TD&gt; &lt;/TR&gt;</span>
<span class="c">#</span>
<span class="c">#     &lt;TR&gt;&lt;TH&gt;Colorado&lt;/TH&gt; &lt;TD&gt;Boulder&lt;/TD&gt; &lt;TD&gt;Denver&lt;/TD&gt;</span>
<span class="c">#</span>
<span class="c">#         &lt;TD&gt;Fort Collins&lt;/TD&gt; &lt;/TR&gt;</span>
<span class="c">#</span>
<span class="c">#     &lt;TR&gt;&lt;TH&gt;Texas&lt;/TH&gt; &lt;TD&gt;Austin&lt;/TD&gt; &lt;TD&gt;Fort Stockton&lt;/TD&gt;</span>
<span class="c">#</span>
<span class="c">#         &lt;TD&gt;Plano&lt;/TD&gt;&lt;/TR&gt;</span>
<span class="c">#</span>
<span class="c">#     &lt;TR&gt;&lt;TH&gt;Wisconsin&lt;/TH&gt; &lt;TD&gt;Lake Geneva&lt;/TD&gt; &lt;TD&gt;Madison&lt;/TD&gt;</span>
<span class="c">#</span>
<span class="c">#         &lt;TD&gt;Superior&lt;/TD&gt;&lt;/TR&gt;</span>
<span class="c">#</span>
<span class="c"># &lt;/TABLE&gt;</span>
<span class="c">#-----------------------------</span>
<span class="k">print</span> <span class="n">T</span><span class="o">.</span><span class="n">table</span><span class="p">[</span>
        <span class="p">[</span><span class="n">T</span><span class="o">.</span><span class="n">caption</span><span class="p">[</span><span class="s">&#39;Cities I have Known&#39;</span><span class="p">],</span>
         <span class="n">T</span><span class="o">.</span><span class="n">tr</span><span class="p">[</span><span class="n">T</span><span class="o">.</span><span class="n">th</span><span class="p">[</span><span class="s">&#39;State&#39;</span><span class="p">],</span> <span class="n">T</span><span class="o">.</span><span class="n">th</span><span class="p">[</span><span class="s">&#39;Cities&#39;</span><span class="p">]]</span> <span class="p">]</span> <span class="o">+</span>
        <span class="p">[</span><span class="n">T</span><span class="o">.</span><span class="n">tr</span><span class="p">[</span> <span class="p">[</span><span class="n">T</span><span class="o">.</span><span class="n">th</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">T</span><span class="o">.</span><span class="n">td</span><span class="p">(</span><span class="n">city</span><span class="p">)</span> <span class="k">for</span> <span class="n">city</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">states</span><span class="p">[</span><span class="n">k</span><span class="p">])]]</span>
         <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">states</span><span class="o">.</span><span class="n">keys</span><span class="p">())]]</span>
<span class="c">#-----------------------------</span>
<span class="c"># salcheck - check for salaries</span>
<span class="kn">import</span> <span class="nn">MySQLdb</span>
<span class="kn">import</span> <span class="nn">cgi</span>

<span class="n">form</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">FieldStorage</span><span class="p">()</span>

<span class="k">if</span> <span class="s">&#39;limit&#39;</span> <span class="ow">in</span> <span class="n">form</span><span class="p">:</span>
    <span class="n">limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">form</span><span class="p">[</span><span class="s">&#39;limit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">limit</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

<span class="c"># There&#39;s not a good way to start an HTML/XML construct with stan</span>
<span class="c"># without completing it.</span>
<span class="k">print</span> <span class="s">&#39;&lt;html&gt;&lt;head&gt;&lt;title&gt;Salary Query&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&#39;</span>
<span class="k">print</span> <span class="n">T</span><span class="o">.</span><span class="n">h1</span><span class="p">[</span><span class="s">&#39;Search&#39;</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&#39;&lt;form&gt;&#39;</span>
<span class="k">print</span> <span class="n">T</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s">&#39;Enter minimum salary&#39;</span><span class="p">,</span>
          <span class="n">T</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;limit&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">limit</span><span class="p">)]</span>
<span class="k">print</span> <span class="n">T</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;&lt;/form&gt;&#39;</span>

<span class="k">if</span> <span class="n">limit</span><span class="p">:</span>
    <span class="n">dbconn</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="s">&#39;somedb&#39;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s">&#39;server.host.dom&#39;</span><span class="p">,</span>
                             <span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">&#39;username&#39;</span><span class="p">,</span>
                             <span class="n">passwd</span><span class="o">=</span><span class="s">&#39;password&#39;</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbconn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    SELECT name, salary FROM employees</span>
<span class="s">    WHERE salary &gt; </span><span class="si">%s</span><span class="s">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">limit</span><span class="p">,))</span>

    <span class="k">print</span> <span class="n">T</span><span class="o">.</span><span class="n">h1</span><span class="p">[</span><span class="s">&quot;Results&quot;</span><span class="p">]</span>
    <span class="k">print</span> <span class="s">&quot;&lt;TABLE BORDER=1&gt;&quot;</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
        <span class="k">print</span> <span class="n">T</span><span class="o">.</span><span class="n">tr</span><span class="p">[</span> <span class="p">[</span><span class="n">T</span><span class="o">.</span><span class="n">td</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span> <span class="p">]</span>

    <span class="k">print</span> <span class="s">&quot;&lt;/TABLE&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">dbconn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">print</span> <span class="s">&#39;&lt;/body&gt;&lt;/html&gt;&#39;</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_19.8</span>
<span class="c">#-----------------------------</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://python.org/pypi&quot;</span>
<span class="k">print</span> <span class="s">&quot;Location: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">url</span>
<span class="k">raise</span> <span class="ne">SystemExit</span>
<span class="c">#-----------------------------</span>
<span class="c"># oreobounce - set a cookie and redirect the browser</span>
<span class="kn">import</span> <span class="nn">Cookie</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">Cookie</span><span class="o">.</span><span class="n">SimpleCookie</span><span class="p">()</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;filling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;vanilla cr?me&#39;</span>
<span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">future</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">30</span><span class="p">)</span> <span class="c"># 3 months</span>
<span class="n">expire_date</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%a </span><span class="si">%d</span><span class="s"> %b %Y %H:%M:%S GMT&#39;</span><span class="p">,</span> <span class="n">future</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;filling&#39;</span><span class="p">][</span><span class="s">&#39;expires&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">expire_date</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;filling&#39;</span><span class="p">][</span><span class="s">&#39;domain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;.python.org&#39;</span>

<span class="n">whither</span>  <span class="o">=</span> <span class="s">&quot;http://somewhere.python.org/nonesuch.html&quot;</span>

<span class="c"># Prints the cookie header</span>
<span class="k">print</span> <span class="s">&#39;Status: 302 Moved Temporarily&#39;</span>
<span class="k">print</span> <span class="n">c</span>
<span class="k">print</span> <span class="s">&#39;Location:&#39;</span><span class="p">,</span> <span class="n">whither</span>
<span class="k">print</span>

<span class="c">#-----------------------------</span>
<span class="c">#Status: 302 Moved Temporarily</span>
<span class="c">#Set-Cookie: filling=vanilla%20cr%E4me; domain=.perl.com;</span>
<span class="c">#    expires=Tue, 21-Jul-1998 11:58:55 GMT</span>
<span class="c">#Location: http://somewhere.perl.com/nonesuch.html</span>
<span class="c">#-----------------------------</span>
<span class="c"># os_snipe - redirect to a Jargon File entry about current OS</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">re</span>
<span class="nb">dir</span> <span class="o">=</span> <span class="s">&#39;http://www.wins.uva.nl/</span><span class="si">%7E</span><span class="s">mes/jargon&#39;</span>
<span class="n">matches</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s">r&#39;Mac&#39;</span><span class="p">,</span> <span class="s">&#39;m/Macintrash.html&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">r&#39;Win(dows )?NT&#39;</span><span class="p">,</span> <span class="s">&#39;e/evilandrude.html&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">r&#39;Win|MSIE|WebTV&#39;</span><span class="p">,</span> <span class="s">&#39;m/MicroslothWindows.html&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">r&#39;Linux&#39;</span><span class="p">,</span> <span class="s">&#39;l/Linux.html&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">r&#39;HP-UX&#39;</span><span class="p">,</span> <span class="s">&#39;h/HP-SUX.html&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s">r&#39;SunOS&#39;</span><span class="p">,</span> <span class="s">&#39;s/ScumOS.html&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;a/AppendixB.html&#39;</span><span class="p">),</span>
    <span class="p">]</span>

<span class="k">for</span> <span class="n">regex</span><span class="p">,</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">regex</span><span class="p">:</span> <span class="c"># default</span>
        <span class="k">break</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;HTTP_USER_AGENT&#39;</span><span class="p">]):</span>
        <span class="k">break</span>
<span class="k">print</span> <span class="s">&#39;Location: </span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">page</span><span class="p">)</span>
<span class="c">#-----------------------------</span>
<span class="c"># There&#39;s no special way to print headers</span>
<span class="k">print</span> <span class="s">&#39;Status: 204 No response&#39;</span>
<span class="k">print</span>
<span class="c">#-----------------------------</span>
<span class="c">#Status: 204 No response</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_19.9</span>
<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch19/dummyhttpd</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># dummyhttpd - start a HTTP daemon and print what the client sends</span>

<span class="kn">import</span> <span class="nn">SocketServer</span>
<span class="c"># or use BaseHTTPServer, SimpleHTTPServer, CGIHTTPServer</span>

<span class="k">def</span> <span class="nf">adr_str</span><span class="p">(</span><span class="n">adr</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">:</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">adr</span>

<span class="k">class</span> <span class="nc">RequestHandler</span><span class="p">(</span><span class="n">SocketServer</span><span class="o">.</span><span class="n">BaseRequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;client access from </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">adr_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_address</span><span class="p">)</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;Content-Type: text/plain</span><span class="se">\n</span><span class="s">&quot;</span>
                          <span class="s">&quot;Server: dymmyhttpd/1.0.0</span><span class="se">\n</span><span class="s">&quot;</span>
                          <span class="s">&quot;</span><span class="se">\n</span><span class="s">...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="n">adr</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">8001</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Please contact me at &lt;http://</span><span class="si">%s</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="n">adr_str</span><span class="p">(</span><span class="n">adr</span><span class="p">)</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">SocketServer</span><span class="o">.</span><span class="n">TCPServer</span><span class="p">(</span><span class="n">adr</span><span class="p">,</span> <span class="n">RequestHandler</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
<span class="n">server</span><span class="o">.</span><span class="n">server_close</span><span class="p">()</span>


<span class="c"># @@PLEAC@@_19.10</span>

<span class="kn">import</span> <span class="nn">Cookie</span>
<span class="n">cookies</span> <span class="o">=</span> <span class="n">Cookie</span><span class="o">.</span><span class="n">SimpleCookie</span><span class="p">()</span>
<span class="c"># SimpleCookie is more secure, but does not support all characters.</span>
<span class="n">cookies</span><span class="p">[</span><span class="s">&quot;preference-name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;whatever you&#39;d like&quot;</span> 
<span class="k">print</span> <span class="n">cookies</span>

<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch19/ic_cookies</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># ic_cookies - sample CGI script that uses a cookie</span>

<span class="kn">import</span> <span class="nn">cgi</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">Cookie</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">cookname</span> <span class="o">=</span> <span class="s">&quot;favorite-ice-cream&quot;</span>  <span class="c"># SimpleCookie does not support blanks</span>
<span class="n">fieldname</span> <span class="o">=</span> <span class="s">&quot;flavor&quot;</span>

<span class="n">cookies</span> <span class="o">=</span> <span class="n">Cookie</span><span class="o">.</span><span class="n">SimpleCookie</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;HTTP_COOKIE&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="k">if</span> <span class="n">cookies</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">cookname</span><span class="p">):</span>
    <span class="n">favorite</span> <span class="o">=</span> <span class="n">cookies</span><span class="p">[</span><span class="n">cookname</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">favorite</span> <span class="o">=</span> <span class="s">&quot;mint&quot;</span>

<span class="n">form</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">FieldStorage</span><span class="p">()</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">form</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">fieldname</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Content-Type: text/html&quot;</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;html&gt;&lt;body&gt;&quot;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;h1&gt;Hello Ice Cream&lt;/h1&gt;&quot;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;form&gt;&quot;</span>
    <span class="k">print</span> <span class="s">&#39;Please select a flavor: &lt;input type=&quot;text&quot; name=&quot;</span><span class="si">%s</span><span class="s">&quot; value=&quot;</span><span class="si">%s</span><span class="s">&quot; /&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">fieldname</span><span class="p">,</span> <span class="n">favorite</span> <span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/form&gt;&quot;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;hr /&gt;&quot;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">favorite</span> <span class="o">=</span> <span class="n">form</span><span class="p">[</span><span class="n">fieldname</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">cookies</span><span class="p">[</span><span class="n">cookname</span><span class="p">]</span> <span class="o">=</span> <span class="n">favorite</span>
    <span class="n">expire</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">730</span><span class="p">)</span>
    <span class="n">cookies</span><span class="p">[</span><span class="n">cookname</span><span class="p">][</span><span class="s">&quot;expires&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">expire</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%a, </span><span class="si">%d</span><span class="s"> %b %Y %H:00:00 GMT&quot;</span><span class="p">)</span>
    <span class="n">cookies</span><span class="p">[</span><span class="n">cookname</span><span class="p">][</span><span class="s">&quot;path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;/&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Content-Type: text/html&quot;</span>
    <span class="k">print</span> <span class="n">cookies</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;html&gt;&lt;body&gt;&quot;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;h1&gt;Hello Ice Cream&lt;/h1&gt;&quot;</span>
    <span class="k">print</span> <span class="s">&quot;&lt;p&gt;You chose as your favorite flavor </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s">&lt;/p&gt;&quot;</span> <span class="o">%</span> <span class="n">favorite</span>
    <span class="k">print</span> <span class="s">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>


<span class="c"># @@PLEAC@@_19.11</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_19.12</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_19.13</span>
<span class="c">#-----------------------------</span>
<span class="c"># first open and exclusively lock the file</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">cgi</span><span class="o">,</span> <span class="nn">fcntl</span><span class="o">,</span> <span class="nn">cPickle</span>
<span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/tmp/formlog&#39;</span><span class="p">,</span> <span class="s">&#39;ab&#39;</span><span class="p">)</span>
<span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">fh</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_EX</span><span class="p">)</span>

<span class="n">form</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">FieldStorage</span><span class="p">()</span>
<span class="c"># This doesn&#39;t produce a readable file; we copy the environment so</span>
<span class="c"># that we save a plain dictionary (os.environ is a dictionary-like</span>
<span class="c"># object).</span>
<span class="n">cPickle</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="n">form</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span> <span class="n">fh</span><span class="p">)</span>
<span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">cgi</span><span class="o">,</span> <span class="nn">smtplib</span><span class="o">,</span> <span class="nn">sys</span>

<span class="n">form</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">FieldStorage</span><span class="p">()</span>
<span class="n">email</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">From: %S</span>
<span class="s">To: hisname@hishost.com</span>
<span class="s">Subject: mailed form submission</span>

<span class="s">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">form</span><span class="p">:</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">form</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">email</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="n">server</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="s">&#39;localhost&#39;</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;hisname@hishost.com&#39;</span><span class="p">],</span> <span class="n">email</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
<span class="c">#-----------------------------</span>
<span class="c"># @@INCOMPLETE@@ I don&#39;t get the point of these:</span>
<span class="c"># param(&quot;_timestamp&quot;, scalar localtime);</span>
<span class="c"># param(&quot;_environs&quot;, %ENV);</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">fcntl</span><span class="o">,</span> <span class="nn">cPickle</span>
<span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;/tmp/formlog&#39;</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>
<span class="n">fcntl</span><span class="o">.</span><span class="n">flock</span><span class="p">(</span><span class="n">fh</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">LOCK_SH</span><span class="p">)</span>

<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">form</span><span class="p">,</span> <span class="n">environ</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="k">if</span> <span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;REMOTE_HOST&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;perl.com&#39;</span><span class="p">):</span>
        <span class="k">continue</span>
    <span class="k">if</span> <span class="s">&#39;items requested&#39;</span> <span class="ow">in</span> <span class="n">form</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">form</span><span class="p">[</span><span class="s">&#39;items requested&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;Total orders:&#39;</span><span class="p">,</span> <span class="n">count</span>
<span class="c">#-----------------------------</span>

<span class="c"># @@PLEAC@@_19.14</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_20.1</span>
<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">urllib</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;could not get </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">url</span>

<span class="c">#-----------------------------</span>
<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch20/titlebytes</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># titlebytes - find the title and size of documents</span>
<span class="c">#</span>
<span class="c"># differences to perl</span>
<span class="c"># </span>
<span class="c"># * no URI::Heuristics</span>
<span class="c"># * perl LWP supports fetching files from local system</span>
<span class="c"># * fetching a title from ftp or file doesnt work in perl either.</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">urllib2</span><span class="o">,</span> <span class="nn">HTMLParser</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;usage: </span><span class="si">%s</span><span class="s"> url&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">raw_url</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 

<span class="c"># python has no equivalent to pearls URI::Heuristics, which</span>
<span class="c"># would do some guessing like :</span>
<span class="c">#</span>
<span class="c">#   perl            -&gt; http://www.perl.com</span>
<span class="c">#   www.oreilly.com -&gt; http://www.oreilly.com</span>
<span class="c">#   ftp.funet.fi    -&gt; ftp://ftp.funet.fi</span>
<span class="c">#   /etc/passwd     -&gt; file:/etc/passwd</span>

<span class="c"># simple but pedantic html parser: tpj.com breaks it.</span>
<span class="k">class</span> <span class="nc">html</span><span class="p">(</span><span class="n">HTMLParser</span><span class="o">.</span><span class="n">HTMLParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">HTMLParser</span><span class="o">.</span><span class="n">HTMLParser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_tags</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">handle_starttag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_endtag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_open_tags</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_open_tags</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_open_tags</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_open_tags</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">attr</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>

<span class="n">url</span> <span class="o">=</span> <span class="n">raw_url</span>
<span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> =&gt;</span><span class="se">\n\t</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">url</span><span class="p">,</span>
<span class="c"># TODO fake user agent &quot;Schmozilla/v9.17 Platinum&quot;</span>
<span class="c"># TODO referer &quot;http://wizard.yellowbrick.oz&quot;</span>
<span class="c"># as we only do http httplib would do also</span>
<span class="k">try</span><span class="p">:</span>
	<span class="n">response</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
	<span class="k">print</span> <span class="s">&quot; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reason</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
	<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c"># title is not in response</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">html</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c"># force processing all data</span>
<span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
<span class="nb">bytes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> (</span><span class="si">%d</span><span class="s"> lines, </span><span class="si">%d</span><span class="s"> bytes)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> 
        <span class="n">count</span><span class="p">,</span> 
        <span class="nb">bytes</span><span class="p">)</span>

<span class="c"># omly bytes is in response.info()</span>


<span class="c"># @@PLEAC@@_20.2</span>

<span class="c"># GET method</span>
<span class="kn">import</span> <span class="nn">httplib</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">httplib</span><span class="o">.</span><span class="n">HTTPConnection</span><span class="p">(</span><span class="s">&#39;www.perl.com&#39;</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;GET&#39;</span><span class="p">,</span><span class="s">&#39;/cgi-bin/cpan_mod?module=DB_File&amp;readme=1&#39;</span><span class="p">)</span>
<span class="n">r1</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c"># POST method</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">({</span><span class="s">&#39;module&#39;</span><span class="p">:</span> <span class="s">&#39;DB_File&#39;</span><span class="p">,</span> <span class="s">&#39;readme&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">&#39;http://www.perl.com&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c"># fields must be properly escaped</span>
<span class="c"># script.cgi?field1?arg=%22this%20isn%27t%20%3CEASY%3E%22</span>

<span class="c"># proxies can be taken from environment, or specified</span>
<span class="c"># as the optional thrid parameter to urlopen.</span>

<span class="c"># @@PLEAC@@_20.3</span>
<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch20/xurl</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># xurl - extract unique, sorted list of links from URL</span>

<span class="kn">from</span> <span class="nn">HTMLParser</span> <span class="kn">import</span> <span class="n">HTMLParser</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">from</span> <span class="nn">sets</span> <span class="kn">import</span> <span class="n">Set</span> <span class="k">as</span> <span class="nb">set</span> <span class="c"># not needed in 2.4</span>
<span class="k">class</span> <span class="nc">myParser</span><span class="p">(</span><span class="n">HTMLParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseUrl</span> <span class="o">=</span> <span class="n">url</span><span class="p">[:</span><span class="n">url</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)]</span>
        <span class="n">HTMLParser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">urls</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">HTMLParser</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_starttag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;href&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="c"># we need to add the base URL.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">urls</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseUrl</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">urls</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">&#39;http://www.perl.com/CPAN&#39;</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">myParser</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">urllist</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">urls</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">urllist</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">urllist</span><span class="p">)</span>



<span class="c"># @@PLEAC@@_20.4</span>
<span class="c"># Converting ASCII to HTML</span>

<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch20/text2html</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># text2html - trivial html encoding of normal text</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c"># precompile regular expressions</span>
<span class="n">re_quoted</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;(?m)^(&gt;.*?)$&quot;</span><span class="p">)</span>
<span class="n">re_url</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;&lt;URL:(.*)&gt;&quot;</span><span class="p">)</span>
<span class="n">re_http</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;(http:\S+)&quot;</span><span class="p">)</span>
<span class="n">re_strong</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;\*(\S+)\*&quot;</span><span class="p">)</span>
<span class="n">re_em</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;\b_(\S+)_\b&quot;</span><span class="p">)</span>

<span class="c"># split paragraphs</span>
<span class="k">for</span> <span class="n">para</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">):</span>
    <span class="c"># TODO encode entities: dont encode &quot;&lt;&gt;&quot; but do &quot;&amp;&quot;</span>
    <span class="k">if</span> <span class="n">para</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;&lt;pre&gt;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&lt;/pre&gt;&quot;</span> <span class="o">%</span> <span class="n">para</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">para</span> <span class="o">=</span> <span class="n">re_quoted</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;\1&lt;br /&gt;&quot;</span><span class="p">,</span> <span class="n">para</span><span class="p">)</span>          <span class="c"># quoted text</span>
        <span class="n">para</span> <span class="o">=</span> <span class="n">re_url</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;&lt;a href=&quot;\1&quot;&gt;\1&lt;/a&gt;&#39;</span><span class="p">,</span> <span class="n">para</span><span class="p">)</span>  <span class="c"># embedded URL</span>
        <span class="n">para</span> <span class="o">=</span> <span class="n">re_http</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39;&lt;a href=&quot;\1&quot;&gt;\1&lt;/a&gt;&#39;</span><span class="p">,</span> <span class="n">para</span><span class="p">)</span> <span class="c"># guessed URL</span>
        <span class="n">para</span> <span class="o">=</span> <span class="n">re_strong</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;&lt;strong&gt;\1&lt;/strong&gt;&quot;</span><span class="p">,</span><span class="n">para</span><span class="p">)</span>   <span class="c"># this is *bold* here</span>
        <span class="n">para</span> <span class="o">=</span> <span class="n">re_em</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;&lt;em&gt;\1&lt;/em&gt;&quot;</span><span class="p">,</span><span class="n">para</span><span class="p">)</span>            <span class="c"># this is _italic_ here</span>
        <span class="k">print</span> <span class="s">&quot;&lt;p&gt;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&lt;/p&gt;&quot;</span> <span class="o">%</span> <span class="n">para</span>                     <span class="c"># add paragraph tags</span>



<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">htmlentitydefs</span>

<span class="k">def</span> <span class="nf">encode_entities</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">htmlentitydefs</span><span class="o">.</span><span class="n">codepoint2name</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">&lt;</span><span class="mi">256</span><span class="p">:</span> <span class="c"># no unicodes</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="s">&quot;&amp;</span><span class="si">%s</span><span class="s">;&quot;</span><span class="o">%</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span>

<span class="k">print</span> <span class="s">&quot;&lt;table&gt;&quot;</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">encode_entities</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;(\n[ \t]+)&quot;</span><span class="p">,</span><span class="s">&quot; . &quot;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>   <span class="c"># continuation lines</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;(?m)^(\S+?:)\s*(.*?)$&quot;</span><span class="p">,</span>
              <span class="s">r&#39;&lt;tr&gt;&lt;th align=&quot;left&quot;&gt;\1&lt;/th&gt;&lt;td&gt;\2&lt;/td&gt;&lt;/tr&gt;&#39;</span><span class="p">,</span>
                            <span class="n">text</span><span class="p">);</span>
<span class="k">print</span> <span class="n">text</span>    
<span class="k">print</span> <span class="s">&quot;&lt;/table&gt;&quot;</span>
                            
<span class="c"># @@PLEAC@@_20.5</span>
<span class="c"># Converting HTML to ASCII</span>

<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">ascii</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;lynx -dump &quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c">#-----------------------------</span>
<span class="kn">import</span> <span class="nn">formatter</span>
<span class="kn">import</span> <span class="nn">htmllib</span>

<span class="n">w</span> <span class="o">=</span> <span class="n">formatter</span><span class="o">.</span><span class="n">DumbWriter</span><span class="p">()</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">formatter</span><span class="o">.</span><span class="n">AbstractFormatter</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">htmllib</span><span class="o">.</span><span class="n">HTMLParser</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># Above is a bare minimum to use writer/formatter/parser</span>
<span class="c"># framework of Python.</span>

<span class="c"># Search Python Cookbook for more details, like writing</span>
<span class="c"># your own writers or formatters.</span>

<span class="c"># Recipe #52297 has TtyFormatter, formatting underline</span>
<span class="c"># and bold in Terminal. Recipe #135005 has a writer</span>
<span class="c"># accumulating text instead of printing.</span>

<span class="c"># @@PLEAC@@_20.6</span>

<span class="kn">import</span> <span class="nn">re</span>

<span class="n">plain_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&quot;&lt;[^&gt;]*&gt;&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">html_text</span><span class="p">)</span> <span class="c">#WRONG</span>

<span class="c"># using HTMLParser</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">HTMLParser</span>

<span class="k">class</span> <span class="nc">html</span><span class="p">(</span><span class="n">HTMLParser</span><span class="o">.</span><span class="n">HTMLParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">HTMLParser</span><span class="o">.</span><span class="n">HTMLParser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plaintext</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ignore</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">def</span> <span class="nf">handle_starttag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s">&quot;script&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ignore</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">def</span> <span class="nf">handle_endtag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s">&quot;script&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ignore</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ignore</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_plaintext</span> <span class="o">+=</span> <span class="n">data</span>
    <span class="k">def</span> <span class="nf">get_plaintext</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plaintext</span>
    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
        <span class="c"># ignore all errors</span>
        <span class="k">pass</span>

<span class="n">html_text</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">html</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">html_text</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c"># force processing all data</span>
<span class="k">print</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_plaintext</span><span class="p">()</span>

<span class="n">title_s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&quot;(?i)&lt;title&gt;\s*(.*?)\s*&lt;/title&gt;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span class="n">title</span> <span class="o">=</span> <span class="n">title_s</span> <span class="ow">and</span> <span class="n">title_s</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&quot;NO TITLE&quot;</span>

<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch20/htitle</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># htitlebytes - get html title from URL</span>
<span class="c">#</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">urllib2</span><span class="o">,</span> <span class="nn">HTMLParser</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;usage: </span><span class="si">%s</span><span class="s"> url ...&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># simple but pedantic html parser: tpj.com breaks it.</span>
<span class="k">class</span> <span class="nc">html</span><span class="p">(</span><span class="n">HTMLParser</span><span class="o">.</span><span class="n">HTMLParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">HTMLParser</span><span class="o">.</span><span class="n">HTMLParser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_tags</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">handle_starttag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_endtag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_open_tags</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_open_tags</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_open_tags</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_open_tags</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">attr</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
        <span class="c"># ignore all errors</span>
        <span class="k">pass</span>

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span> <span class="n">url</span><span class="p">,</span>
    <span class="c"># TODO fake user agent &quot;Schmozilla/v9.17 Platinum&quot;</span>
    <span class="c"># TODO referer &quot;http://wizard.yellowbrick.oz&quot;</span>
    <span class="c"># as we only do http httplib would do also</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c"># title is not in response</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">html</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c"># force processing all data</span>
    <span class="k">print</span> <span class="n">parser</span><span class="o">.</span><span class="n">title</span> 



<span class="c"># @@PLEAC@@_20.7</span>
<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch20/churl</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># churl - check urls</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="c"># head request</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="k">def</span> <span class="nf">valid</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="c"># parser class as in xurl</span>
<span class="kn">from</span> <span class="nn">HTMLParser</span> <span class="kn">import</span> <span class="n">HTMLParser</span>
<span class="kn">from</span> <span class="nn">sets</span> <span class="kn">import</span> <span class="n">Set</span> <span class="k">as</span> <span class="nb">set</span> <span class="c"># not needed in 2.4</span>
<span class="k">class</span> <span class="nc">myParser</span><span class="p">(</span><span class="n">HTMLParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseUrl</span> <span class="o">=</span> <span class="n">url</span><span class="p">[:</span><span class="n">url</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)]</span>
        <span class="n">HTMLParser</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">urls</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">HTMLParser</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_starttag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;href&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="c"># we need to add the base URL.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">urls</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseUrl</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">urls</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;usage: </span><span class="si">%s</span><span class="s"> &lt;start_url&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
<span class="n">base_url</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">print</span> <span class="n">base_url</span><span class="o">+</span><span class="s">&quot;:&quot;</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">myParser</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">urls</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">state</span> <span class="o">=</span> <span class="s">&quot;UNKNOWN URL&quot;</span>
    <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;http:&quot;</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="s">&quot;BAD&quot;</span>
        <span class="k">if</span> <span class="n">valid</span><span class="p">(</span><span class="n">link</span><span class="p">):</span>
            <span class="n">state</span> <span class="o">=</span> <span class="s">&quot;OK&quot;</span>
    <span class="k">print</span> <span class="s">&quot;  </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>



<span class="c"># @@PLEAC@@_20.8</span>
<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch20/surl</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># surl - sort URLs by their last modification date</span>

<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">Date</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
    <span class="c"># we only read from stdin not from argv.</span>
    <span class="n">ln</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ln</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">ln</span> <span class="o">=</span> <span class="n">ln</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">info</span><span class="p">()</span><span class="o">.</span><span class="n">getdate</span><span class="p">(</span><span class="s">&quot;date&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Date</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
            <span class="n">Date</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Date</span><span class="p">[</span><span class="n">date</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">!</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>

<span class="n">dates</span> <span class="o">=</span> <span class="n">Date</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">dates</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>    <span class="c"># python 2.4 would have sorted</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">  </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">d</span><span class="p">)),</span>
                    <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Date</span><span class="p">[</span><span class="n">d</span><span class="p">]))</span>


<span class="c"># @@PLEAC@@_20.9</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">template</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">fillings</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">repl</span><span class="p">(</span><span class="n">matchobj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fillings</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">matchobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">fillings</span><span class="p">[</span><span class="n">matchobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)])</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span>
    <span class="c"># replace quoted words with value from fillings dictionary</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%%</span><span class="s">(.+?)</span><span class="si">%%</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">repl</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>

<span class="n">fields</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;username&quot;</span><span class="p">:</span><span class="s">&quot;peter&quot;</span><span class="p">,</span> <span class="s">&quot;count&quot;</span><span class="p">:</span><span class="s">&quot;23&quot;</span><span class="p">,</span> <span class="s">&quot;total&quot;</span><span class="p">:</span> <span class="s">&quot;1234&quot;</span><span class="p">}</span>
<span class="k">print</span> <span class="n">template</span><span class="p">(</span><span class="s">&quot;/home/httpd/templates/simple.template&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span>

<span class="c"># <font size="-1"><a href="http://pleac.sourceforge.net/include/python/ch20/userrep1</span>">download the following standalone program</a></font>
<span class="c">#!/usr/bin/python</span>
<span class="c"># userrep1 - report duration of user logins using SQL database</span>

<span class="kn">import</span> <span class="nn">MySQLdb</span>
<span class="kn">import</span> <span class="nn">cgi</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">template</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">fillings</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">repl</span><span class="p">(</span><span class="n">matchobj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fillings</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">matchobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">fillings</span><span class="p">[</span><span class="n">matchobj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)])</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span>
    <span class="c"># replace quoted words with value from fillings dictionary</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%%</span><span class="s">(.+?)</span><span class="si">%%</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">repl</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>

<span class="n">fields</span> <span class="o">=</span> <span class="n">cgi</span><span class="o">.</span><span class="n">FieldStorage</span><span class="p">()</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Content-Type: text/plain</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="k">print</span> <span class="s">&quot;No username&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_userdata</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">passwd</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">db</span><span class="o">=</span><span class="s">&quot;connections&quot;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">&quot;bert&quot;</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">&quot;select count(duration) as count,&quot;</span>
            <span class="o">+</span><span class="s">&quot; sum(duration) as total from logins&quot;</span>
            <span class="o">+</span><span class="s">&quot; where username=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">username</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">store_result</span><span class="p">()</span><span class="o">.</span><span class="n">fetch_row</span><span class="p">(</span><span class="n">maxrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&quot;username&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>
    <span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        
<span class="k">print</span> <span class="s">&quot;Content-Type: text/html</span><span class="se">\n</span><span class="s">&quot;</span>

<span class="k">print</span> <span class="n">template</span><span class="p">(</span><span class="s">&quot;report.tpl&quot;</span><span class="p">,</span> <span class="n">get_userdata</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s">&quot;user&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>

<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_20.10</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_20.11</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_20.12</span>

<span class="c"># sample data, use ``LOGFILE = open(sys.argv[1])`` in real life</span>
<span class="n">LOGFILE</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">&#39;127.0.0.1 - - [04/Sep/2005:20:50:31 +0200] &quot;GET /bus HTTP/1.1&quot; 301 303</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;127.0.0.1 - - [04/Sep/2005:20:50:31 +0200] &quot;GET /bus HTTP/1.1&quot; 301 303 &quot;-&quot; &quot;Opera/8.02 (X11; Linux i686; U; en)&quot;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;192.168.0.1 - - [04/Sep/2005:20:50:36 +0200] &quot;GET /bus/libjs/layersmenu-library.js HTTP/1.1&quot; 200 6228</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
        <span class="s">&#39;192.168.0.1 - - [04/Sep/2005:20:50:36 +0200] &quot;GET /bus/libjs/layersmenu-library.js HTTP/1.1&quot; 200 6228 &quot;http://localhost/bus/&quot; &quot;Opera/8.02 (X11; Linux i686; U; en)&quot;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
    <span class="p">]</span>

<span class="kn">import</span> <span class="nn">re</span>

<span class="c"># similar too perl version.</span>
<span class="n">web_server_log_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;^(\S+) (\S+) (\S+) \[([^:]+):(\d+:\d+:\d+) ([^\]]+)\] &quot;(\S+) (.*?) (\S+)&quot; (\S+) (\S+)$&#39;</span><span class="p">)</span>
    
<span class="c"># with group naming.</span>
<span class="n">split_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;&#39;&#39;(?x)         # allow nicer formatting (but requires escaping blanks)</span>
<span class="s">                       ^(?P&lt;client&gt;\S+)\s</span>
<span class="s">                       (?P&lt;identuser&gt;\S+)\s</span>
<span class="s">                       (?P&lt;authuser&gt;\S+)\s</span>
<span class="s">                       \[</span>
<span class="s">                         (?P&lt;date&gt;[^:]+):</span>
<span class="s">                         (?P&lt;time&gt;[\d:]+)\s</span>
<span class="s">                         (?P&lt;tz&gt;[^\]]+)</span>
<span class="s">                       \]\s</span>
<span class="s">                       &quot;</span>
<span class="s">                         (?P&lt;method&gt;\S+)\s</span>
<span class="s">                         (?P&lt;url&gt;.*?)\s</span>
<span class="s">                         (?P&lt;protocol&gt;\S+)</span>
<span class="s">                       &quot;\s</span>
<span class="s">                       (?P&lt;status&gt;\S+)\s</span>
<span class="s">                       (?P&lt;bytes&gt;\S+)</span>
<span class="s">                       (?:</span>
<span class="s">                         \s</span>
<span class="s">                         &quot;</span>
<span class="s">                           (?P&lt;referrer&gt;[^&quot;]+)</span>
<span class="s">                         &quot;\s</span>
<span class="s">                         &quot;</span>
<span class="s">                           (?P&lt;agent&gt;[^&quot;]+)</span>
<span class="s">                         &quot;</span>
<span class="s">                       )?&#39;&#39;&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">LOGFILE</span><span class="p">:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">split_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;agent = </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">f</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()[</span><span class="s">&#39;agent&#39;</span><span class="p">]</span>

<span class="c"># @@PLEAC@@_20.13</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>

<span class="c"># @@PLEAC@@_20.14</span>
<span class="c"># @@INCOMPLETE@@</span>
<span class="c"># @@INCOMPLETE@@</span>
</pre></div>
</body>
</html>
