<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Directories</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Guile 1.8"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="File Contents"
HREF="filecontents.html"><LINK
REL="NEXT"
TITLE="Subroutines"
HREF="subroutines.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Guile 1.8</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="filecontents.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="subroutines.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="DIRECTORIES"
>9. Directories</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN495"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="k">define </span><span class="nv">entry</span> <span class="p">(</span><span class="nf">stat</span> <span class="s">&quot;/usr/bin/vi&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">entry</span> <span class="p">(</span><span class="nf">stat</span> <span class="s">&quot;/usr/bin&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">entry</span> <span class="p">(</span><span class="nf">stat</span> <span class="nv">port</span><span class="p">))</span>

<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">ice-9</span> <span class="nv">posix</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">inode</span> <span class="p">(</span><span class="nf">stat</span> <span class="s">&quot;/usr/bin/vi&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">ctime</span> <span class="p">(</span><span class="nf">stat:ctime</span> <span class="nv">inode</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">size</span> <span class="p">(</span><span class="nf">stat:size</span> <span class="nv">inode</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">F</span> <span class="p">(</span><span class="nb">open-input-file </span><span class="nv">filename</span><span class="p">))</span>
<span class="c1">;; no equivalent - what defines -T?</span>
<span class="c1">; unless (-s F &amp;&amp; -T _) {</span>
<span class="c1">;     die &quot;$filename doesn&#39;t have text in it.\n&quot;;</span>
<span class="c1">; }</span>

<span class="p">(</span><span class="k">define </span><span class="nv">dir</span> <span class="p">(</span><span class="nf">opendir</span> <span class="s">&quot;/usr/bin&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">do </span><span class="p">((</span><span class="nf">filename</span> <span class="p">(</span><span class="nf">readdir</span> <span class="nv">dir</span><span class="p">)</span> <span class="p">(</span><span class="nf">readdir</span> <span class="nv">dir</span><span class="p">)))</span>
    <span class="p">((</span><span class="nb">eof-object? </span><span class="nv">filename</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;Inside /usr/bin is something called ~A\n&quot;</span> <span class="nv">filename</span><span class="p">))</span>
<span class="p">(</span><span class="nf">closedir</span> <span class="nv">dir</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN498"
>Getting and Setting Timestamps</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="k">define </span><span class="nv">inode</span> <span class="p">(</span><span class="nf">stat</span> <span class="nv">filename</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">readtime</span> <span class="p">(</span><span class="nf">stat:atime</span> <span class="nv">inode</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">writetime</span> <span class="p">(</span><span class="nf">stat:mtime</span> <span class="nv">inode</span><span class="p">))</span>

<span class="p">(</span><span class="nf">utime</span> <span class="nv">newreadtime</span> <span class="nv">newwritetime</span> <span class="nv">filename</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">seconds-per-day</span> <span class="p">(</span><span class="nb">* </span><span class="mi">60</span> <span class="mi">60</span> <span class="mi">24</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">inode</span> <span class="p">(</span><span class="nf">stat</span> <span class="nv">file</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">atime</span> <span class="p">(</span><span class="nf">stat:atime</span> <span class="nv">inode</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">mtime</span> <span class="p">(</span><span class="nf">stat:mtime</span> <span class="nv">inode</span><span class="p">))</span>
<span class="p">(</span><span class="k">set! </span><span class="nv">atime</span> <span class="p">(</span><span class="nb">- </span><span class="nv">atime</span> <span class="p">(</span><span class="nb">* </span><span class="mi">7</span> <span class="nv">seconds-per-day</span><span class="p">)))</span>
<span class="p">(</span><span class="k">set! </span><span class="nv">mtime</span> <span class="p">(</span><span class="nb">- </span><span class="nv">mtime</span> <span class="p">(</span><span class="nb">* </span><span class="mi">7</span> <span class="nv">seconds-per-day</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">utime</span> <span class="nv">file</span> <span class="nv">atime</span> <span class="nv">mtime</span><span class="p">)</span>

<span class="c1">;; mtime is optional</span>
<span class="p">(</span><span class="nf">utime</span> <span class="nv">file</span> <span class="p">(</span><span class="nf">current-time</span><span class="p">))</span>
<span class="p">(</span><span class="nf">utime</span> <span class="nv">file</span> <span class="p">(</span><span class="nf">stat:atime</span> <span class="p">(</span><span class="nf">stat</span> <span class="nv">file</span><span class="p">))</span> <span class="p">(</span><span class="nf">current-time</span><span class="p">))</span>

<span class="o">#</span><span class="nv">!/usr/local/bin/guile</span> <span class="nv">-s</span>
<span class="nv">!</span><span class="o">#</span>
<span class="c1">;; uvi - vi a file without changing its access times</span>

<span class="p">(</span><span class="k">define </span><span class="nv">file</span> <span class="p">(</span><span class="nb">cadr </span><span class="p">(</span><span class="nf">command-line</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">inode</span> <span class="p">(</span><span class="nf">stat</span> <span class="nv">file</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">atime</span> <span class="p">(</span><span class="nf">stat:atime</span> <span class="nv">inode</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">mtime</span> <span class="p">(</span><span class="nf">stat:mtime</span> <span class="nv">inode</span><span class="p">))</span>
<span class="p">(</span><span class="nf">system</span> <span class="p">(</span><span class="nb">string-append </span><span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nf">getenv</span> <span class="s">&quot;EDITOR&quot;</span><span class="p">)</span>  <span class="s">&quot;vi&quot;</span><span class="p">)</span> <span class="s">&quot; &quot;</span> <span class="nv">file</span><span class="p">))</span>
<span class="p">(</span><span class="nf">utime</span> <span class="nv">file</span> <span class="nv">atime</span> <span class="nv">mtime</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN501"
>Deleting a File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="nf">delete-file</span> <span class="nv">file</span><span class="p">)</span>

<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">count</span> <span class="mi">0</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">for-each</span>
   <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">catch</span> <span class="no">#t</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">()</span> <span class="p">(</span><span class="nf">delete-file</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="k">set! </span><span class="nv">count</span> <span class="p">(</span><span class="mi">1</span><span class="nv">+</span> <span class="nv">count</span><span class="p">)))</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">err</span> <span class="o">.</span> <span class="nv">args</span><span class="p">)</span> <span class="no">#f</span><span class="p">)))</span>
   <span class="nv">file-list</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">= </span><span class="nv">count</span> <span class="p">(</span><span class="nb">length </span><span class="nv">file-list</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">format</span> <span class="p">(</span><span class="nf">current-error-port</span><span class="p">)</span> <span class="s">&quot;could only delete ~A of ~A files&quot;</span>
            <span class="nv">count</span> <span class="p">(</span><span class="nb">length </span><span class="nv">file-list</span><span class="p">))))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN504"
>Copying or Moving a File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; use builtin copy-file</span>
<span class="p">(</span><span class="nf">copy-file</span> <span class="nv">oldfile</span> <span class="nv">newfile</span><span class="p">)</span>
<span class="p">(</span><span class="nf">rename-file</span> <span class="nv">oldfile</span> <span class="nv">newfile</span><span class="p">)</span>

<span class="c1">;; or do it by hand (clumsy, error-prone)</span>
<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">ice-9</span> <span class="nv">rw</span><span class="p">)</span> <span class="p">(</span><span class="nf">ice-9</span> <span class="nv">posix</span><span class="p">))</span>
<span class="p">(</span><span class="nb">with-input-from-file </span><span class="nv">oldfile</span>
  <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
    <span class="p">(</span><span class="nb">call-with-output-file </span><span class="nv">newfile</span>
      <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p</span><span class="p">)</span>
        <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">inode</span> <span class="p">(</span><span class="nf">stat</span> <span class="nv">oldfile</span><span class="p">))</span>
               <span class="p">(</span><span class="nf">blksize</span> <span class="p">(</span><span class="k">if </span><span class="nv">inode</span> <span class="p">(</span><span class="nf">stat:size</span> <span class="nv">inode</span><span class="p">)</span> <span class="mi">16384</span><span class="p">))</span>
               <span class="p">(</span><span class="nf">buf</span> <span class="p">(</span><span class="nb">make-string </span><span class="nv">blksize</span><span class="p">)))</span>
          <span class="p">(</span><span class="k">let </span><span class="nv">loop</span> <span class="p">((</span><span class="nf">len</span> <span class="p">(</span><span class="nf">read-string!/partial</span> <span class="nv">buf</span><span class="p">)))</span>
            <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="k">and </span><span class="nv">len</span> <span class="p">(</span><span class="nb">&gt; </span><span class="nv">len</span> <span class="mi">0</span><span class="p">))</span>
                   <span class="p">(</span><span class="nf">write-string/partial</span> <span class="nv">buf</span> <span class="nv">p</span> <span class="mi">0</span> <span class="nv">len</span><span class="p">)</span>
                   <span class="p">(</span><span class="nf">loop</span> <span class="p">(</span><span class="nf">read-string!/partial</span> <span class="nv">buf</span><span class="p">))))))))))</span>

<span class="c1">;; or call out to the system (non-portable, insecure)</span>
<span class="p">(</span><span class="nf">system</span> <span class="p">(</span><span class="nb">string-append </span><span class="s">&quot;cp &quot;</span> <span class="nv">oldfile</span> <span class="s">&quot; &quot;</span> <span class="nv">newfile</span><span class="p">))</span>    <span class="c1">; unix</span>
<span class="p">(</span><span class="nf">system</span> <span class="p">(</span><span class="nb">string-append </span><span class="s">&quot;copy &quot;</span> <span class="nv">oldfile</span> <span class="s">&quot; &quot;</span> <span class="nv">newfile</span><span class="p">))</span>  <span class="c1">; dos, vms</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN507"
>Recognizing Two Names for the Same File</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; use a hash lookup of inodes</span>
<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">ice-9</span> <span class="nv">posix</span><span class="p">))</span>
<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">seen</span> <span class="p">(</span><span class="nf">make-hash-table</span> <span class="mi">31</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">for-each</span>
   <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">file</span><span class="p">)</span>
     <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">stats</span> <span class="p">(</span><span class="nf">stat</span> <span class="nv">file</span><span class="p">))</span>
            <span class="p">(</span><span class="nf">key</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">stat:dev</span> <span class="nv">stats</span><span class="p">)</span> <span class="p">(</span><span class="nf">stat:ino</span> <span class="nv">stats</span><span class="p">)))</span>
            <span class="p">(</span><span class="nf">val</span> <span class="p">(</span><span class="nf">hash-ref</span> <span class="nv">seen</span> <span class="nv">key</span> <span class="mi">0</span><span class="p">)))</span>
       <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">val</span> <span class="mi">0</span><span class="p">)</span>
              <span class="c1">;; do something with new file</span>
              <span class="p">))</span>
       <span class="p">(</span><span class="nf">hash-set!</span> <span class="nv">seen</span> <span class="nv">key</span> <span class="p">(</span><span class="mi">1</span><span class="nv">+</span> <span class="nv">val</span><span class="p">))))</span>
   <span class="nv">file-names</span><span class="p">))</span>

<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">seen</span> <span class="p">(</span><span class="nf">make-hash-table</span> <span class="mi">31</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">for-each</span>
   <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">file</span><span class="p">)</span>
     <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">stats</span> <span class="p">(</span><span class="nf">stat</span> <span class="nv">file</span><span class="p">))</span>
            <span class="p">(</span><span class="nf">key</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">stat:dev</span> <span class="nv">stats</span><span class="p">)</span> <span class="p">(</span><span class="nf">stat:ino</span> <span class="nv">stats</span><span class="p">)))</span>
            <span class="p">(</span><span class="nf">val</span> <span class="p">(</span><span class="nf">hash-ref</span> <span class="nv">seen</span> <span class="nv">key</span> <span class="o">&#39;</span><span class="p">())))</span>
       <span class="p">(</span><span class="nf">hash-set!</span> <span class="nv">seen</span> <span class="nv">key</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">file</span> <span class="nv">val</span><span class="p">))))</span>
   <span class="nv">file-names</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">hash-fold</span>
   <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">key</span> <span class="nv">value</span> <span class="nv">prior</span><span class="p">)</span>
     <span class="c1">;; process key == (dev . inode), value == list of filenames</span>
     <span class="p">)</span>
   <span class="o">&#39;</span><span class="p">()</span> <span class="nv">seen</span><span class="p">))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN510"
>Processing All Files in a Directory</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; use opendir, readdir, closedir</span>
<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">p</span> <span class="p">(</span><span class="nf">opendir</span> <span class="nv">dir</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">let </span><span class="nv">loop</span> <span class="p">((</span><span class="nf">file</span> <span class="p">(</span><span class="nf">readdir</span> <span class="nv">p</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">eof-object? </span><span class="nv">file</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">close</span> <span class="nv">p</span><span class="p">)</span>
      <span class="c1">;; do something with file</span>
      <span class="p">)))</span>

<span class="c1">;; or define a utility function for this</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">directory-files</span> <span class="nv">dir</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nf">access?</span> <span class="nv">dir</span> <span class="nv">R_OK</span><span class="p">))</span>
    <span class="o">&#39;</span><span class="p">()</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">p</span> <span class="p">(</span><span class="nf">opendir</span> <span class="nv">dir</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">do </span><span class="p">((</span><span class="nf">file</span> <span class="p">(</span><span class="nf">readdir</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nf">readdir</span> <span class="nv">p</span><span class="p">))</span>
           <span class="p">(</span><span class="nf">ls</span> <span class="o">&#39;</span><span class="p">()))</span>
          <span class="p">((</span><span class="nb">eof-object? </span><span class="nv">file</span><span class="p">)</span> <span class="p">(</span><span class="nf">closedir</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nf">reverse!</span> <span class="nv">ls</span><span class="p">))</span>
        <span class="p">(</span><span class="k">set! </span><span class="nv">ls</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">file</span> <span class="nv">ls</span><span class="p">))))))</span>

<span class="c1">;; to skip . and ..</span>
<span class="p">(</span><span class="nb">cddr </span><span class="p">(</span><span class="nf">directory-files</span> <span class="nv">dir</span><span class="p">))</span>

<span class="c1">;; probably better to implement full Emacs style directory-files</span>
<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">ice-9</span> <span class="nv">posix</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">plain-files</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">rx</span> <span class="p">(</span><span class="nf">make-regexp</span> <span class="s">&quot;^\\.&quot;</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">dir</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">sort</span> <span class="p">(</span><span class="nf">filter</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">eq? </span><span class="ss">&#39;regular</span> <span class="p">(</span><span class="nf">stat:type</span> <span class="p">(</span><span class="nf">stat</span> <span class="nv">x</span><span class="p">))))</span>
                    <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">string-append </span><span class="nv">dir</span> <span class="s">&quot;/&quot;</span> <span class="nv">x</span><span class="p">))</span>
                         <span class="p">(</span><span class="nf">remove</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">regexp-exec</span> <span class="nv">rx</span> <span class="nv">x</span><span class="p">))</span>
                                 <span class="p">(</span><span class="nb">cddr </span><span class="p">(</span><span class="nf">directory-files</span> <span class="nv">dir</span><span class="p">)))))</span>
            <span class="nv">string&lt;</span><span class="p">))))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN513"
>Globbing, or Getting a List of Filenames Matching a Pattern</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">glob-&gt;regexp</span> <span class="nv">pat</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">len</span> <span class="p">(</span><span class="nb">string-length </span><span class="nv">pat</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">ls</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;^&quot;</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">in-brace?</span> <span class="no">#f</span><span class="p">))</span>
    <span class="p">(</span><span class="k">do </span><span class="p">((</span><span class="nf">i</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">1</span><span class="nv">+</span> <span class="nv">i</span><span class="p">)))</span>
        <span class="p">((</span><span class="nb">= </span><span class="nv">i</span> <span class="nv">len</span><span class="p">))</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">char</span> <span class="p">(</span><span class="nb">string-ref </span><span class="nv">pat</span> <span class="nv">i</span><span class="p">)))</span>
        <span class="p">(</span><span class="k">case </span><span class="nv">char</span>
          <span class="p">((</span><span class="o">#</span><span class="err">\</span><span class="nv">*</span><span class="p">)</span> <span class="p">(</span><span class="k">set! </span><span class="nv">ls</span> <span class="p">(</span><span class="nb">cons </span><span class="s">&quot;[^.]*&quot;</span> <span class="nv">ls</span><span class="p">)))</span>
          <span class="p">((</span><span class="sc">#\?</span><span class="p">)</span> <span class="p">(</span><span class="k">set! </span><span class="nv">ls</span> <span class="p">(</span><span class="nb">cons </span><span class="s">&quot;[^.]&quot;</span> <span class="nv">ls</span><span class="p">)))</span>
          <span class="p">((</span><span class="o">#</span><span class="err">\</span><span class="p">[)</span> <span class="p">(</span><span class="k">set! </span><span class="nv">ls</span> <span class="p">(</span><span class="nb">cons </span><span class="s">&quot;[&quot;</span> <span class="nv">ls</span><span class="p">)))</span>
          <span class="p">((</span><span class="o">#</span><span class="err">\</span><span class="p">])</span> <span class="p">(</span><span class="k">set! </span><span class="nv">ls</span> <span class="p">(</span><span class="nb">cons </span><span class="s">&quot;]&quot;</span> <span class="nv">ls</span><span class="p">)))</span>
          <span class="p">((</span><span class="o">#</span><span class="err">\\</span><span class="p">)</span>
           <span class="p">(</span><span class="k">set! </span><span class="nv">i</span> <span class="p">(</span><span class="mi">1</span><span class="nv">+</span> <span class="nv">i</span><span class="p">))</span>
           <span class="p">(</span><span class="k">set! </span><span class="nv">ls</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">make-string </span><span class="mi">1</span> <span class="p">(</span><span class="nb">string-ref </span><span class="nv">pat</span> <span class="nv">i</span><span class="p">))</span> <span class="nv">ls</span><span class="p">))</span>
           <span class="p">(</span><span class="k">set! </span><span class="nv">ls</span> <span class="p">(</span><span class="nb">cons </span><span class="s">&quot;\\&quot;</span> <span class="nv">ls</span><span class="p">)))</span>
          <span class="p">(</span><span class="nf">else</span>
           <span class="p">(</span><span class="k">set! </span><span class="nv">ls</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">regexp-quote</span> <span class="p">(</span><span class="nb">make-string </span><span class="mi">1</span> <span class="nv">char</span><span class="p">))</span> <span class="nv">ls</span><span class="p">))))))</span>
    <span class="p">(</span><span class="nf">string-concatenate</span> <span class="p">(</span><span class="nb">reverse </span><span class="p">(</span><span class="nb">cons </span><span class="s">&quot;$&quot;</span> <span class="nv">ls</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">glob</span> <span class="nv">pat</span> <span class="nv">dir</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">rx</span> <span class="p">(</span><span class="nf">make-regexp</span> <span class="p">(</span><span class="nf">glob-&gt;regexp</span> <span class="nv">pat</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">filter</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">regexp-exec</span> <span class="nv">rx</span> <span class="nv">x</span><span class="p">))</span> <span class="p">(</span><span class="nf">directory-files</span> <span class="nv">dir</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">files</span> <span class="p">(</span><span class="nf">glob</span> <span class="s">&quot;*.c&quot;</span> <span class="s">&quot;.&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">files</span> <span class="p">(</span><span class="nf">glob</span> <span class="s">&quot;*.[ch]&quot;</span> <span class="s">&quot;.&quot;</span><span class="p">))</span>

<span class="c1">;; Not sure if the Schwartzian Transform would really be more</span>
<span class="c1">;; efficient here... perhaps with a much larger directory where very</span>
<span class="c1">;; few files matched.</span>
<span class="p">(</span><span class="k">define </span><span class="nv">dirs</span> <span class="p">(</span><span class="nf">filter</span>
              <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">eq? </span><span class="ss">&#39;directory</span> <span class="p">(</span><span class="nf">stat:type</span> <span class="p">(</span><span class="nf">stat</span> <span class="nv">x</span><span class="p">))))</span>
              <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">string-append </span><span class="nv">dir</span> <span class="s">&quot;/&quot;</span> <span class="nv">x</span><span class="p">))</span>
                   <span class="p">(</span><span class="nf">sort</span> <span class="p">(</span><span class="nf">filter</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">string-match</span> <span class="s">&quot;^[0-9]+$&quot;</span> <span class="nv">x</span><span class="p">))</span>
                                 <span class="p">(</span><span class="nf">directory-files</span> <span class="nv">dir</span><span class="p">))</span>
                         <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)</span>
                           <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nb">string-&gt;number </span><span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nb">string-&gt;number </span><span class="nv">b</span><span class="p">)))))))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN516"
>Processing All Files in a Directory Recursively</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">find</span> <span class="nv">proc</span> <span class="o">.</span> <span class="nv">dirs</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">pair? </span><span class="nv">dirs</span><span class="p">)</span>
         <span class="p">(</span><span class="nb">for-each </span><span class="nv">proc</span> <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">string-append </span><span class="p">(</span><span class="nb">car </span><span class="nv">dirs</span><span class="p">)</span> <span class="s">&quot;/&quot;</span> <span class="nv">x</span><span class="p">))</span>
                             <span class="p">(</span><span class="nf">directory-files</span> <span class="p">(</span><span class="nb">car </span><span class="nv">dirs</span><span class="p">))))</span>
         <span class="p">(</span><span class="nb">apply </span><span class="nv">find</span> <span class="nv">proc</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">dirs</span><span class="p">)))))</span>

<span class="p">(</span><span class="nf">find</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;~A~A\n&quot;</span> <span class="nv">x</span>
                          <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">equal? </span><span class="p">(</span><span class="nf">stat:type</span> <span class="p">(</span><span class="nf">stat</span> <span class="nv">x</span><span class="p">))</span> <span class="ss">&#39;directory</span><span class="p">)</span>
                            <span class="s">&quot;/&quot;</span> <span class="s">&quot;&quot;</span><span class="p">)))</span> <span class="s">&quot;.&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">saved-size</span> <span class="mi">-1</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="nv">saved-name</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">biggest</span> <span class="nv">file</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">stats</span> <span class="p">(</span><span class="nf">stat</span> <span class="nv">file</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">eq? </span><span class="p">(</span><span class="nf">stat:type</span> <span class="nv">stats</span><span class="p">)</span> <span class="ss">&#39;regular</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">size</span> <span class="p">(</span><span class="nf">stat:size</span> <span class="p">(</span><span class="nf">stat</span> <span class="nv">file</span><span class="p">))))</span>
        <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">&gt; </span><span class="nv">size</span> <span class="nv">saved-size</span><span class="p">)</span>
               <span class="p">(</span><span class="k">set! </span><span class="nv">saved-size</span> <span class="nv">size</span><span class="p">)</span>
               <span class="p">(</span><span class="k">set! </span><span class="nv">saved-name</span> <span class="nv">file</span><span class="p">)))))))</span>
<span class="p">(</span><span class="nb">apply </span><span class="nv">find</span> <span class="nv">biggest</span> <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nf">command-line</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;Biggest file ~A in ~A is ~A bytes long.\n&quot;</span>
        <span class="nv">saved-name</span> <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nf">command-line</span><span class="p">))</span> <span class="nv">saved-size</span><span class="p">)</span>

<span class="o">#</span><span class="nv">!/usr/local/bin/guile</span> <span class="nv">-s</span>
<span class="nv">!</span><span class="o">#</span>
<span class="c1">;; fdirs - find all directories</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">print-dirs</span> <span class="nv">f</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">eq? </span><span class="p">(</span><span class="nf">stat:type</span> <span class="p">(</span><span class="nf">stat</span> <span class="nv">f</span><span class="p">))</span> <span class="ss">&#39;directory</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">write-line</span> <span class="nv">f</span><span class="p">)))</span>
<span class="p">(</span><span class="nb">apply </span><span class="nv">find</span> <span class="nv">print-dirs</span> <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nf">command-line</span><span class="p">)))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN519"
>Removing a Directory and Its Contents</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="o">#</span><span class="nv">!/usr/local/bin/guile</span> <span class="nv">-s</span>
<span class="nv">!</span><span class="o">#</span>
<span class="c1">;; rmtree - remove whole directory trees like rm -f</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">finddepth</span> <span class="nv">proc</span> <span class="o">.</span> <span class="nv">dirs</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">pair? </span><span class="nv">dirs</span><span class="p">)</span>
         <span class="p">(</span><span class="nb">apply </span><span class="nv">finddepth</span> <span class="nv">proc</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">dirs</span><span class="p">))</span>
         <span class="p">(</span><span class="nb">for-each </span><span class="nv">proc</span> <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">string-append </span><span class="p">(</span><span class="nb">car </span><span class="nv">dirs</span><span class="p">)</span> <span class="s">&quot;/&quot;</span> <span class="nv">x</span><span class="p">))</span>
                             <span class="p">(</span><span class="nf">directory-files</span> <span class="p">(</span><span class="nb">car </span><span class="nv">dirs</span><span class="p">)))))))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">zap</span> <span class="nv">f</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">rm</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">eq? </span><span class="p">(</span><span class="nf">stat:type</span> <span class="p">(</span><span class="nf">stat</span> <span class="nv">f</span><span class="p">))</span> <span class="ss">&#39;directory</span><span class="p">)</span> <span class="nv">rmdir</span> <span class="nv">delete-file</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;deleting ~A\n&quot;</span> <span class="nv">f</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">catch</span> <span class="no">#t</span>
      <span class="p">(</span><span class="k">lambda </span><span class="p">()</span> <span class="p">(</span><span class="nf">rm</span> <span class="nv">f</span><span class="p">))</span>
      <span class="p">(</span><span class="k">lambda </span><span class="nv">args</span> <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;couldn&#39;t delete ~A\n&quot;</span> <span class="nv">f</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">args</span> <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nf">command-line</span><span class="p">))))</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">args</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">error</span> <span class="s">&quot;usage: rmtree dir ..\n&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">apply </span><span class="nv">finddepth</span> <span class="nv">zap</span> <span class="nv">args</span><span class="p">)))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN522"
>Renaming Files</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="nf">for-each</span>
 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">file</span><span class="p">)</span>
   <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">newname</span> <span class="p">(</span><span class="nf">function-of</span> <span class="nv">file</span><span class="p">)))</span>
     <span class="p">(</span><span class="nf">catch</span> <span class="no">#t</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">()</span> <span class="p">(</span><span class="nf">rename-file</span> <span class="nv">file</span> <span class="nv">newname</span><span class="p">))</span>
       <span class="p">(</span><span class="k">lambda </span><span class="nv">args</span> <span class="p">(</span><span class="nf">format</span> <span class="p">(</span><span class="nf">current-error-port</span><span class="p">)</span>
                            <span class="s">&quot;couldn&#39;t rename ~A to ~A\n&quot;</span> <span class="nv">file</span> <span class="nv">newname</span><span class="p">)))))</span>
 <span class="nv">names</span><span class="p">)</span>

<span class="o">#</span><span class="nv">!/usr/local/bin/guile</span> <span class="nv">-s</span>
<span class="nv">!</span><span class="o">#</span>
<span class="c1">;; rename - Guile&#39;s filename fixer</span>
<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">ice-9</span> <span class="nv">regex</span><span class="p">))</span> <span class="c1">; not needed, but often useful here</span>
<span class="p">(</span><span class="k">define </span><span class="nv">args</span> <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nf">command-line</span><span class="p">)))</span>
<span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">args</span><span class="p">)</span> <span class="p">(</span><span class="nf">error</span> <span class="s">&quot;usage: rename expr [files]\n&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">proc</span> <span class="p">(</span><span class="nf">eval-string</span> <span class="p">(</span><span class="nb">car </span><span class="nv">args</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">for-each</span>
 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">old</span><span class="p">)</span>
   <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">new</span> <span class="p">(</span><span class="nf">proc</span> <span class="nv">old</span><span class="p">)))</span>
     <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">string=? </span><span class="nv">old</span> <span class="nv">new</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">catch</span> <span class="no">#t</span>
         <span class="p">(</span><span class="k">lambda </span><span class="p">()</span> <span class="p">(</span><span class="nf">rename-file</span> <span class="nv">old</span> <span class="nv">new</span><span class="p">))</span>
         <span class="p">(</span><span class="k">lambda </span><span class="nv">args</span> <span class="p">(</span><span class="nf">format</span> <span class="p">(</span><span class="nf">current-error-port</span><span class="p">)</span>
                              <span class="s">&quot;couldn&#39;t rename ~A to ~A\n&quot;</span> <span class="nv">old</span> <span class="nv">new</span><span class="p">))))))</span>
 <span class="p">(</span><span class="nb">cdr </span><span class="nv">args</span><span class="p">))</span>

<span class="c1">;; command-line examples:</span>
<span class="c1">;; rename &#39;(lambda (x) (regexp-substitute/global #f &quot;\\.orig\$&quot; x (quote pre)))&#39; *.orig</span>
<span class="c1">;; rename string-downcase *</span>
<span class="c1">;; rename &#39;(lambda (x) (if (string-match &quot;^Make&quot; x) x (string-downcase x)))&#39; *</span>
<span class="c1">;; rename &#39;(lambda (x) (string-append x &quot;.bad&quot;))&#39; *.pl</span>
<span class="c1">;; rename &#39;(lambda (x) (format #t &quot;~a: &quot;) (read-line))&#39; *</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN525"
>Splitting a Filename into Its Component Parts</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="k">define </span><span class="nv">base</span> <span class="p">(</span><span class="nf">basename</span> <span class="nv">path</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">base</span> <span class="p">(</span><span class="nf">dirname</span> <span class="nv">path</span> <span class="nv">ext</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">dir</span> <span class="p">(</span><span class="nf">dirname</span> <span class="nv">path</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">path</span> <span class="s">&quot;/usr/lib/libc.a&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="nv">file</span> <span class="p">(</span><span class="nf">basename</span> <span class="nv">path</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">dir</span> <span class="p">(</span><span class="nf">dirname</span> <span class="nv">path</span><span class="p">))</span>

<span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;dir is ~A, file is ~A\n&quot;</span> <span class="nv">dir</span> <span class="nv">file</span><span class="p">)</span>

<span class="p">(</span><span class="nf">basename</span> <span class="nv">path</span> <span class="s">&quot;.a&quot;</span><span class="p">)</span> <span class="c1">; libc</span>

<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">ice-9</span> <span class="nv">regex</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">file-parse</span> <span class="nv">path</span> <span class="o">.</span> <span class="nv">args</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">ext</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">args</span><span class="p">)</span> <span class="s">&quot;\\..*&quot;</span> <span class="p">(</span><span class="nb">car </span><span class="nv">args</span><span class="p">)))</span>
         <span class="p">(</span><span class="nf">rx1</span> <span class="p">(</span><span class="nb">string-append </span><span class="s">&quot;^((.*)/)?(.*)?(&quot;</span> <span class="nv">ext</span> <span class="s">&quot;)$&quot;</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">rx2</span> <span class="p">(</span><span class="nb">string-append </span><span class="s">&quot;^((.*)/)?(.*)?()$&quot;</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">m</span> <span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nf">string-match</span> <span class="nv">rx1</span> <span class="nv">path</span><span class="p">)</span> <span class="p">(</span><span class="nf">string-match</span> <span class="nv">rx2</span> <span class="nv">path</span><span class="p">))))</span>
      <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">match:substring</span> <span class="nv">m</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">match:substring</span> <span class="nv">m</span> <span class="mi">3</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">match:substring</span> <span class="nv">m</span> <span class="mi">4</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">extension</span> <span class="nv">path</span> <span class="o">.</span> <span class="nv">args</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">caddr </span><span class="p">(</span><span class="nb">apply </span><span class="nv">file-parse</span> <span class="nv">path</span> <span class="nv">args</span><span class="p">)))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN528"
>Program: symirror</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN531"
>Program: lst</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="filecontents.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="subroutines.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>File Contents</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Subroutines</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>