<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Strings</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Guile 1.8"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="PLEAC-Guile 1.8"
HREF="index.html"><LINK
REL="NEXT"
TITLE="Numbers"
HREF="numbers.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Guile 1.8</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="index.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="numbers.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="STRINGS"
>1. Strings</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN14"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="k">define </span><span class="nv">string</span> <span class="s">&quot;\\n&quot;</span><span class="p">)</span>                    <span class="c1">; two characters, \ and an n</span>
<span class="p">(</span><span class="k">define </span><span class="nv">string</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>                     <span class="c1">; a &quot;newline&quot; character</span>
<span class="p">(</span><span class="k">define </span><span class="nv">string</span> <span class="s">&quot;Jon \&quot;Maddog\&quot; Orwant&quot;</span><span class="p">)</span>  <span class="c1">; literal double quotes</span>
<span class="p">(</span><span class="k">define </span><span class="nv">string</span> <span class="s">&quot;Jon &#39;Maddog&#39; Orwant&quot;</span><span class="p">)</span>    <span class="c1">; literal single quotes</span>

<span class="p">(</span><span class="k">define </span><span class="nv">a</span> <span class="s">&quot;This is a multiline here document</span>
<span class="s">terminated by a closing double quote&quot;</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN17"
>Accessing Substrings</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; Use substring</span>

<span class="p">(</span><span class="nb">substring </span><span class="nv">str</span> <span class="nv">start</span> <span class="nv">end</span><span class="p">)</span>
<span class="p">(</span><span class="nb">substring </span><span class="nv">str</span> <span class="nv">start</span><span class="p">)</span>

<span class="c1">;; You can fill portions of a string with another string</span>

<span class="p">(</span><span class="nf">substring-move-right!</span> <span class="nv">str</span> <span class="nv">start</span> <span class="nv">end</span> <span class="nv">newstring</span> <span class="nv">newstart</span><span class="p">)</span>
<span class="p">(</span><span class="nf">substring-move-left!</span> <span class="nv">str</span> <span class="nv">start</span> <span class="nv">end</span> <span class="nv">newstring</span> <span class="nv">newstart</span><span class="p">)</span>

<span class="c1">;; Guile has a separate character type, and you can treat strings as a</span>
<span class="c1">;; character array.</span>

<span class="p">(</span><span class="nb">string-ref </span><span class="nv">str</span> <span class="nv">pos</span><span class="p">)</span>
<span class="p">(</span><span class="nb">string-set! </span><span class="nv">str</span> <span class="nv">pos</span> <span class="nv">char</span><span class="p">)</span>
<span class="p">(</span><span class="nb">string-fill! </span><span class="nv">str</span> <span class="nv">char</span><span class="p">)</span>
<span class="p">(</span><span class="nf">substring-fill!</span> <span class="nv">str</span> <span class="nv">start</span> <span class="nv">end</span> <span class="nv">char</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">s</span> <span class="s">&quot;This is what you have&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="nv">first</span> <span class="p">(</span><span class="nb">substring </span><span class="nv">s</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">))</span>                     <span class="c1">; &quot;T&quot;</span>
<span class="p">(</span><span class="k">define </span><span class="nv">start</span> <span class="p">(</span><span class="nb">substring </span><span class="nv">s</span> <span class="mi">5</span> <span class="mi">7</span><span class="p">))</span>                     <span class="c1">; &quot;is&quot;</span>
<span class="p">(</span><span class="k">define </span><span class="nv">rest</span>  <span class="p">(</span><span class="nb">substring </span><span class="nv">s</span> <span class="mi">13</span><span class="p">))</span>                      <span class="c1">; &quot;you have&quot;</span>
<span class="p">(</span><span class="k">define </span><span class="nv">last</span>  <span class="p">(</span><span class="nb">substring </span><span class="nv">s</span> <span class="p">(</span><span class="mi">1</span><span class="nv">-</span> <span class="p">(</span><span class="nb">string-length </span><span class="nv">s</span><span class="p">))))</span>  <span class="c1">; &quot;e&quot;</span>
<span class="p">(</span><span class="k">define </span><span class="nv">end</span>   <span class="p">(</span><span class="nb">substring </span><span class="nv">s</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">string-length </span><span class="nv">s</span><span class="p">)</span> <span class="mi">4</span><span class="p">)))</span> <span class="c1">; &quot;have&quot;</span>
<span class="p">(</span><span class="k">define </span><span class="nv">piece</span> <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">len</span> <span class="p">(</span><span class="nb">string-length </span><span class="nv">s</span><span class="p">)))</span>
                <span class="p">(</span><span class="nb">substring </span><span class="nv">s</span> <span class="p">(</span><span class="nb">- </span><span class="nv">len</span> <span class="mi">8</span><span class="p">)</span> <span class="p">(</span><span class="nb">- </span><span class="nv">len</span> <span class="mi">5</span><span class="p">))))</span>  <span class="c1">; &quot;you&quot;</span>


<span class="c1">;;; Or use the string library SRFI-13</span>
<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-13</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">s</span> <span class="s">&quot;This is what you have&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="nv">first</span> <span class="p">(</span><span class="nf">string-take</span> <span class="nv">s</span> <span class="mi">1</span><span class="p">))</span>                     <span class="c1">; &quot;T&quot;</span>
<span class="p">(</span><span class="k">define </span><span class="nv">start</span> <span class="p">(</span><span class="nf">xsubstring</span> <span class="nv">s</span> <span class="mi">5</span> <span class="mi">7</span><span class="p">))</span>                    <span class="c1">; &quot;is&quot;</span>
<span class="p">(</span><span class="k">define </span><span class="nv">rest</span>  <span class="p">(</span><span class="nf">xsubstring</span> <span class="nv">s</span> <span class="mi">13</span> <span class="mi">-1</span><span class="p">))</span>                  <span class="c1">; &quot;you have&quot;</span>
<span class="p">(</span><span class="k">define </span><span class="nv">last</span>  <span class="p">(</span><span class="nf">string-take-right</span> <span class="nv">s</span> <span class="mi">1</span><span class="p">))</span>               <span class="c1">; &quot;e&quot;</span>
<span class="p">(</span><span class="k">define </span><span class="nv">end</span>   <span class="p">(</span><span class="nf">string-take-right</span> <span class="nv">s</span> <span class="mi">4</span><span class="p">))</span>               <span class="c1">; &quot;have&quot;</span>
<span class="p">(</span><span class="k">define </span><span class="nv">piece</span> <span class="p">(</span><span class="nf">xsubstring</span> <span class="nv">s</span> <span class="mi">-8</span> <span class="mi">-5</span><span class="p">))</span>                  <span class="c1">; &quot;you&quot;</span>

<span class="c1">;; Mutation of different sized strings is not allowed.  You have to</span>
<span class="c1">;; use set! to change the variable.</span>

<span class="p">(</span><span class="k">set! </span><span class="nv">s</span> <span class="p">(</span><span class="nf">string-replace</span> <span class="nv">s</span> <span class="s">&quot;wasn&#39;t&quot;</span> <span class="mi">5</span> <span class="mi">7</span><span class="p">))</span>
<span class="c1">;; This wasn&#39;t what you have</span>
<span class="p">(</span><span class="k">set! </span><span class="nv">s</span> <span class="p">(</span><span class="nf">string-replace</span> <span class="nv">s</span> <span class="s">&quot;ondrous&quot;</span> <span class="mi">13</span> <span class="mi">25</span><span class="p">))</span>
<span class="c1">;; This wasn&#39;t wondrous</span>
<span class="p">(</span><span class="k">set! </span><span class="nv">s</span> <span class="p">(</span><span class="nf">string-take-right</span> <span class="nv">s</span> <span class="p">(</span><span class="mi">1</span><span class="nv">-</span> <span class="p">(</span><span class="nb">string-length </span><span class="nv">s</span><span class="p">))))</span>
<span class="c1">;; his wasn&#39;t wondrous</span>
<span class="p">(</span><span class="k">set! </span><span class="nv">s</span> <span class="p">(</span><span class="nf">string-take</span> <span class="nv">s</span> <span class="mi">9</span><span class="p">))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN20"
>Establishing a Default Value</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="k">define </span><span class="nv">a</span> <span class="p">(</span><span class="k">or </span><span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">a</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">defined?</span> <span class="nv">b</span><span class="p">)</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">a</span> <span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nf">defined?</span> <span class="nv">b</span><span class="p">)</span> <span class="nv">b</span><span class="p">)</span> <span class="nv">c</span><span class="p">))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN23"
>Exchanging Values Without Using Temporary Variables</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; This doesn&#39;t really make sense in Scheme... temporary variables are</span>
<span class="c1">;; a natural construct and cheap.  If you want to swap variables in a</span>
<span class="c1">;; block without introducing any new variable names, you can use let:</span>

<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nf">b</span> <span class="nv">a</span><span class="p">))</span>
  <span class="c1">;; ...</span>
  <span class="p">)</span>

<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">alpha</span> <span class="nv">beta</span><span class="p">)</span> <span class="p">(</span><span class="nf">beta</span> <span class="nv">production</span><span class="p">)</span> <span class="p">(</span><span class="nf">production</span> <span class="nv">alpha</span><span class="p">))</span>
  <span class="c1">;; ...</span>
  <span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN26"
>Converting Between ASCII Characters and Values</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="k">define </span><span class="nv">num</span> <span class="p">(</span><span class="nb">char-&gt;integer </span><span class="nv">char</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">char</span> <span class="p">(</span><span class="nb">integer-&gt;char </span><span class="nv">num</span><span class="p">))</span>

<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-13</span><span class="p">))</span>
<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">str</span> <span class="s">&quot;sample&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">string-join</span>
            <span class="p">(</span><span class="nb">map </span><span class="nv">number-&gt;string</span>
                 <span class="p">(</span><span class="nb">map </span><span class="nv">char-&gt;integer</span> <span class="p">(</span><span class="nb">string-&gt;list </span><span class="nv">str</span><span class="p">)))</span> <span class="s">&quot; &quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">newline</span><span class="p">))</span>

<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">115</span> <span class="mi">97</span> <span class="mi">109</span> <span class="mi">112</span> <span class="mi">108</span> <span class="mi">101</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nb">list-&gt;string </span><span class="p">(</span><span class="nb">map </span><span class="nv">integer-&gt;char</span> <span class="nv">lst</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">newline</span><span class="p">))</span>

<span class="p">(</span><span class="k">letrec </span><span class="p">((</span><span class="nf">next</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">c</span><span class="p">)</span> <span class="p">(</span><span class="nb">integer-&gt;char </span><span class="p">(</span><span class="mi">1</span><span class="nv">+</span> <span class="p">(</span><span class="nb">char-&gt;integer </span><span class="nv">c</span><span class="p">))))))</span>
  <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">hal</span> <span class="s">&quot;HAL&quot;</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">ibm</span> <span class="p">(</span><span class="nb">list-&gt;string </span><span class="p">(</span><span class="nb">map </span><span class="nv">next</span> <span class="p">(</span><span class="nb">string-&gt;list </span><span class="nv">hal</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nb">display </span><span class="nv">ibm</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">newline</span><span class="p">)))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN29"
>Processing a String One Character at a Time</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; Convert the string to a list of characters</span>
<span class="p">(</span><span class="nb">map </span><span class="nv">proc</span>
     <span class="p">(</span><span class="nb">string-&gt;list </span><span class="nv">str</span><span class="p">))</span>

<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-1</span><span class="p">))</span>
<span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;unique chars are: ~A\n&quot;</span>
        <span class="p">(</span><span class="nb">apply </span><span class="nv">string</span> <span class="p">(</span><span class="nf">sort</span> <span class="p">(</span><span class="nf">delete-duplicates</span>
                             <span class="p">(</span><span class="nb">string-&gt;list </span><span class="s">&quot;an apple a day&quot;</span><span class="p">))</span> <span class="nv">char&lt;?</span><span class="p">)))</span>

<span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">str</span> <span class="s">&quot;an apple a day&quot;</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">sum</span> <span class="p">(</span><span class="nb">apply </span><span class="nv">+</span> <span class="p">(</span><span class="nb">map </span><span class="nv">char-&gt;integer</span> <span class="p">(</span><span class="nb">string-&gt;list </span><span class="nv">str</span><span class="p">)))))</span>
  <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;sum is ~A\n&quot;</span> <span class="nv">sum</span><span class="p">))</span>

<span class="c1">;;; or use string-fold/string-map/string-for-each from SRFI-13</span>
<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-13</span><span class="p">))</span>

<span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">str</span> <span class="s">&quot;an apple a day&quot;</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">sum</span> <span class="p">(</span><span class="nf">string-fold</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">c</span> <span class="nv">acc</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">acc</span> <span class="p">(</span><span class="nb">char-&gt;integer </span><span class="nv">c</span><span class="p">)))</span>
                         <span class="mi">0</span> <span class="nv">str</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;sum is ~A\n&quot;</span> <span class="nv">sum</span><span class="p">))</span>

<span class="o">#</span><span class="nv">!/usr/local/bin/guile</span> <span class="nv">-s</span>
<span class="nv">!</span><span class="o">#</span>
<span class="c1">;; sum - compute 16-bit checksum of all input files</span>
<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-13</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">checksum</span> <span class="nv">p</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="nv">loop</span> <span class="p">((</span><span class="nf">line</span> <span class="p">(</span><span class="nf">read-line</span> <span class="nv">p</span> <span class="ss">&#39;concat</span><span class="p">))</span> <span class="p">(</span><span class="nf">sum</span> <span class="mi">0</span><span class="p">))</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">eof-object? </span><span class="nv">line</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;~A ~A\n&quot;</span> <span class="nv">sum</span> <span class="p">(</span><span class="nf">port-filename</span> <span class="nv">p</span><span class="p">))</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">line-sum</span> <span class="p">(</span><span class="nf">string-fold</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">c</span> <span class="nv">acc</span><span class="p">)</span>
                                     <span class="p">(</span><span class="nb">+ </span><span class="nv">acc</span> <span class="p">(</span><span class="nb">char-&gt;integer </span><span class="nv">c</span><span class="p">)))</span>
                                   <span class="mi">0</span> <span class="nv">line</span><span class="p">)))</span>
        <span class="p">(</span><span class="nf">loop</span> <span class="p">(</span><span class="nf">read-line</span> <span class="nv">p</span> <span class="ss">&#39;concat</span><span class="p">)</span> <span class="p">(</span><span class="nb">modulo </span><span class="p">(</span><span class="nb">+ </span><span class="nv">sum</span> <span class="nv">line-sum</span><span class="p">)</span>
                                            <span class="p">(</span><span class="mi">1</span><span class="nv">-</span> <span class="p">(</span><span class="nb">expt </span><span class="mi">2</span> <span class="mi">16</span><span class="p">))))))))</span>
<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">args</span> <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nf">command-line</span><span class="p">))))</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">args</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">checksum</span> <span class="p">(</span><span class="nf">current-input-port</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">for-each </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">f</span><span class="p">)</span> <span class="p">(</span><span class="nb">call-with-input-file </span><span class="nv">f</span> <span class="nv">checksum</span><span class="p">))</span> <span class="nv">args</span><span class="p">)))</span>

<span class="o">#</span><span class="nv">!/usr/local/bin/guile</span> <span class="nv">-s</span>
<span class="nv">!</span><span class="o">#</span>
<span class="c1">;; slowcat - emulate a  s l o w  line printer</span>
<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">ice-9</span> <span class="nv">regex</span><span class="p">)</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-2</span><span class="p">)</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-13</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">args</span> <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nf">command-line</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define delay </span><span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nf">and-let*</span> <span class="p">((</span><span class="nf">p</span> <span class="p">(</span><span class="nb">pair? </span><span class="nv">args</span><span class="p">))</span>
           <span class="p">(</span><span class="nf">m</span> <span class="p">(</span><span class="nf">string-match</span> <span class="s">&quot;^-([0-9]+)$&quot;</span> <span class="p">(</span><span class="nb">car </span><span class="nv">args</span><span class="p">))))</span>
  <span class="p">(</span><span class="k">set! delay </span><span class="p">(</span><span class="nb">string-&gt;number </span><span class="p">(</span><span class="nf">match:substring</span> <span class="nv">m</span> <span class="mi">1</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">set! </span><span class="nv">args</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">args</span><span class="p">)))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">slowcat</span> <span class="nv">p</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="nv">loop</span> <span class="p">((</span><span class="nf">line</span> <span class="p">(</span><span class="nf">read-line</span> <span class="nv">p</span> <span class="ss">&#39;concat</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">not </span><span class="p">(</span><span class="nb">eof-object? </span><span class="nv">line</span><span class="p">))</span>
           <span class="p">(</span><span class="nf">string-for-each</span>
            <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">c</span><span class="p">)</span> <span class="p">(</span><span class="nb">display </span><span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nf">usleep</span> <span class="p">(</span><span class="nb">* </span><span class="mi">5</span> <span class="nv">delay</span><span class="p">)))</span> <span class="nv">line</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">loop</span> <span class="p">(</span><span class="nf">read-line</span> <span class="nv">p</span> <span class="ss">&#39;concat</span><span class="p">))))))</span>
<span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">args</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">slowcat</span> <span class="p">(</span><span class="nf">current-input-port</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">for-each </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">f</span><span class="p">)</span> <span class="p">(</span><span class="nb">call-with-input-file </span><span class="nv">f</span> <span class="nv">slowcat</span><span class="p">))</span> <span class="nv">args</span><span class="p">))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN32"
>Reversing a String by Word or Character</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="k">define </span><span class="nv">revbytes</span> <span class="p">(</span><span class="nb">list-&gt;string </span><span class="p">(</span><span class="nb">reverse </span><span class="p">(</span><span class="nb">string-&gt;list </span><span class="nv">str</span><span class="p">))))</span>

<span class="c1">;;; Or from SRFI-13</span>
<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-13</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">revbytes</span> <span class="p">(</span><span class="nf">string-reverse</span> <span class="nv">str</span><span class="p">))</span>
<span class="p">(</span><span class="nf">string-reverse!</span> <span class="nv">str</span><span class="p">)</span> <span class="c1">; modifies in place</span>

<span class="p">(</span><span class="k">define </span><span class="nv">revwords</span> <span class="p">(</span><span class="nf">string-join</span> <span class="p">(</span><span class="nb">reverse </span><span class="p">(</span><span class="nf">string-tokenize</span> <span class="nv">str</span><span class="p">))</span> <span class="s">&quot; &quot;</span><span class="p">))</span>

<span class="p">(</span><span class="nb">with-input-from-file </span><span class="s">&quot;/usr/share/dict/words&quot;</span>
  <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
    <span class="p">(</span><span class="k">do </span><span class="p">((</span><span class="nf">word</span> <span class="p">(</span><span class="nf">read-line</span><span class="p">)</span> <span class="p">(</span><span class="nf">read-line</span><span class="p">)))</span>
        <span class="p">((</span><span class="nb">eof-object? </span><span class="nv">word</span><span class="p">))</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">&gt; </span><span class="p">(</span><span class="nb">string-length </span><span class="nv">word</span><span class="p">)</span> <span class="mi">5</span><span class="p">)</span>
               <span class="p">(</span><span class="nb">string=? </span><span class="nv">word</span> <span class="p">(</span><span class="nf">string-reverse</span> <span class="nv">word</span><span class="p">)))</span>
        <span class="p">(</span><span class="nf">write-line</span> <span class="nv">word</span><span class="p">)))))</span>

<span class="c1">;; A little too verbose on the command line</span>
<span class="c1">;; guile --use-srfi=13 -c</span>
<span class="c1">;; &#39;(with-input-from-file &quot;/usr/share/dict/words&quot;</span>
<span class="c1">;; (lambda () (do ((word (read-line) (read-line))) ((eof-object? word))</span>
<span class="c1">;; (if (and (&gt; (string-length word) 5) (string=? word (string-reverse word)))</span>
<span class="c1">;; (write-line word)))))&#39;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN35"
>Expanding and Compressing Tabs</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; Use regexp-substitute/global</span>
<span class="p">(</span><span class="nf">regexp-substitute/global</span>
 <span class="no">#f</span> <span class="s">&quot;([^\t]*)(\t+)&quot;</span> <span class="nv">str</span>
 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">m</span><span class="p">)</span>
   <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">pre-string</span> <span class="p">(</span><span class="nf">match:substring</span> <span class="nv">m</span> <span class="mi">1</span><span class="p">))</span>
          <span class="p">(</span><span class="nf">pre-len</span> <span class="p">(</span><span class="nb">string-length </span><span class="nv">pre-string</span><span class="p">))</span>
          <span class="p">(</span><span class="nf">match-len</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">match:end</span> <span class="nv">m</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">match:start</span> <span class="nv">m</span> <span class="mi">2</span><span class="p">))))</span>
     <span class="p">(</span><span class="nf">string-append</span>
      <span class="nv">pre-string</span>
      <span class="p">(</span><span class="nf">make-string</span>
       <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">* </span><span class="nv">match-len</span> <span class="mi">8</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">modulo </span><span class="nv">pre-len</span> <span class="mi">8</span><span class="p">))</span>
       <span class="sc">#\space</span><span class="p">))))</span>
 <span class="ss">&#39;post</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN38"
>Expanding Variables in User Input</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; just interpolate $abc in strings:</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">varsubst</span> <span class="nv">str</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">regexp-substitute/global</span> <span class="no">#f</span> <span class="s">&quot;\\$(\\w+)&quot;</span> <span class="nv">str</span>
   <span class="ss">&#39;pre</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">m</span><span class="p">)</span> <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nb">string-&gt;symbol </span><span class="p">(</span><span class="nf">match:substring</span> <span class="nv">m</span> <span class="mi">1</span><span class="p">))</span>
                          <span class="p">(</span><span class="nf">current-module</span><span class="p">)))</span>
   <span class="ss">&#39;post</span><span class="p">))</span>

<span class="c1">;; interpolate $abc with error messages:</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">safe-varsubst</span> <span class="nv">str</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">regexp-substitute/global</span> <span class="no">#f</span> <span class="s">&quot;\\$(\\w+)&quot;</span> <span class="nv">str</span>
   <span class="ss">&#39;pre</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">m</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">catch</span> <span class="no">#t</span>
            <span class="p">(</span><span class="k">lambda </span><span class="p">()</span> <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nb">string-&gt;symbol </span><span class="p">(</span><span class="nf">match:substring</span> <span class="nv">m</span> <span class="mi">1</span><span class="p">))</span>
                             <span class="p">(</span><span class="nf">current-module</span><span class="p">)))</span>
            <span class="p">(</span><span class="k">lambda </span><span class="nv">args</span>
              <span class="p">(</span><span class="nf">format</span> <span class="no">#f</span> <span class="s">&quot;[NO VARIABLE: ~A]&quot;</span> <span class="p">(</span><span class="nf">match:substring</span> <span class="nv">m</span> <span class="mi">1</span><span class="p">)))))</span>
   <span class="ss">&#39;post</span><span class="p">))</span>

<span class="c1">;; interpolate ${(any (scheme expression))} in strings:</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">interpolate</span> <span class="nv">str</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">regexp-substitute/global</span> <span class="no">#f</span> <span class="s">&quot;\\${([^{}]+)}&quot;</span> <span class="nv">str</span>
   <span class="ss">&#39;pre</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">m</span><span class="p">)</span> <span class="p">(</span><span class="nf">eval-string</span> <span class="p">(</span><span class="nf">match:substring</span> <span class="nv">m</span> <span class="mi">1</span><span class="p">)))</span> <span class="ss">&#39;post</span><span class="p">))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN41"
>Controlling Case</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-13</span><span class="p">))</span>

<span class="p">(</span><span class="nf">string-upcase</span> <span class="s">&quot;bo beep&quot;</span><span class="p">)</span>     <span class="c1">; BO PEEP</span>
<span class="p">(</span><span class="nf">string-downcase</span> <span class="s">&quot;JOHN&quot;</span><span class="p">)</span>      <span class="c1">; john</span>
<span class="p">(</span><span class="nf">string-titlecase</span> <span class="s">&quot;bo&quot;</span><span class="p">)</span>       <span class="c1">; Bo</span>
<span class="p">(</span><span class="nf">string-titlecase</span> <span class="s">&quot;JOHN&quot;</span><span class="p">)</span>     <span class="c1">; John</span>

<span class="p">(</span><span class="nf">string-titlecase</span> <span class="s">&quot;thIS is a loNG liNE&quot;</span><span class="p">)</span>  <span class="c1">; This Is A Long Line</span>

<span class="o">#</span><span class="nv">!/usr/local/bin/guile</span> <span class="nv">-s</span>
<span class="nv">!</span><span class="o">#</span>
<span class="c1">;; randcap: filter to randomly capitalize 20% of the time</span>
<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-13</span><span class="p">))</span>
<span class="p">(</span><span class="nf">seed-&gt;random-state</span> <span class="p">(</span><span class="nf">current-time</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">randcap</span> <span class="nv">p</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="nv">loop</span> <span class="p">((</span><span class="nf">line</span> <span class="p">(</span><span class="nf">read-line</span> <span class="nv">p</span> <span class="ss">&#39;concat</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">not </span><span class="p">(</span><span class="nb">eof-object? </span><span class="nv">line</span><span class="p">))</span>
           <span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">string-map</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">c</span><span class="p">)</span>
                                  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nf">random</span> <span class="mi">5</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
                                    <span class="p">(</span><span class="nb">char-upcase </span><span class="nv">c</span><span class="p">)</span>
                                    <span class="p">(</span><span class="nb">char-downcase </span><span class="nv">c</span><span class="p">)))</span>
                                <span class="nv">line</span><span class="p">))</span>
           <span class="p">(</span><span class="nf">loop</span> <span class="p">(</span><span class="nf">read-line</span> <span class="nv">p</span> <span class="ss">&#39;concat</span><span class="p">))))))</span>
<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">args</span> <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nf">command-line</span><span class="p">))))</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">args</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">randcap</span> <span class="p">(</span><span class="nf">current-input-port</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">for-each </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">f</span><span class="p">)</span> <span class="p">(</span><span class="nb">call-with-input-file </span><span class="nv">f</span> <span class="nv">randcap</span><span class="p">))</span> <span class="nv">args</span><span class="p">)))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN44"
>Interpolating Functions and Expressions Within Strings</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; You can do this with format.  Lisp/Scheme format is a little</span>
<span class="c1">;; different from what you may be used to with C/Perl style printf</span>
<span class="c1">;; (actually far more powerful) , but if you keep in mind that we use</span>
<span class="c1">;; ~ instead of %, and , instead of . for the prefix characters, you</span>
<span class="c1">;; won&#39;t have trouble getting used to Guile&#39;s format.</span>

<span class="p">(</span><span class="nf">format</span> <span class="no">#f</span> <span class="s">&quot;I have ~A guanacos.&quot;</span> <span class="nv">n</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN47"
>Indenting Here Documents</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="k">define </span><span class="nv">var</span> <span class="s">&quot;</span>
<span class="s">        your text</span>
<span class="s">        goes here&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">ice-9</span> <span class="nv">regexp</span><span class="p">))</span>
<span class="p">(</span><span class="k">set! </span><span class="nv">var</span> <span class="p">(</span><span class="nf">regexp-substitute/global</span> <span class="no">#f</span> <span class="s">&quot;\n +&quot;</span> <span class="nv">var</span> <span class="ss">&#39;pre</span> <span class="s">&quot;\n&quot;</span> <span class="ss">&#39;post</span><span class="p">))</span>

<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-13</span><span class="p">))</span>
<span class="p">(</span><span class="k">set! </span><span class="nv">var</span> <span class="p">(</span><span class="nf">string-join</span> <span class="p">(</span><span class="nb">map </span><span class="nv">string-trim</span> <span class="p">(</span><span class="nf">string-tokenize</span> <span class="nv">var</span> <span class="sc">#\newline</span><span class="p">))</span> <span class="s">&quot;\n&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">ice-9</span> <span class="nv">regexp</span><span class="p">)</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-13</span><span class="p">)</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-14</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">dequote</span> <span class="nv">str</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">str</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">char=? </span><span class="p">(</span><span class="nb">string-ref </span><span class="nv">str</span> <span class="mi">0</span><span class="p">)</span> <span class="sc">#\newline</span><span class="p">)</span>
                <span class="p">(</span><span class="nb">substring </span><span class="nv">str</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">str</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">lines</span> <span class="p">(</span><span class="nf">string-tokenize</span> <span class="nv">str</span> <span class="sc">#\newline</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">rx</span> <span class="p">(</span><span class="k">let </span><span class="nv">loop</span> <span class="p">((</span><span class="nf">leader</span> <span class="p">(</span><span class="nb">car </span><span class="nv">lines</span><span class="p">))</span> <span class="p">(</span><span class="nf">lst</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">lines</span><span class="p">)))</span>
               <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">string=</span> <span class="nv">leader</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
                      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">pos</span> <span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nf">string-skip</span> <span class="p">(</span><span class="nb">car </span><span class="nv">lines</span><span class="p">)</span>
                                                  <span class="nv">char-set:whitespace</span><span class="p">)</span> <span class="mi">0</span><span class="p">)))</span>
                        <span class="p">(</span><span class="nf">make-regexp</span> <span class="p">(</span><span class="nf">format</span> <span class="no">#f</span> <span class="s">&quot;^[ \\t]{1,~A}&quot;</span> <span class="nv">pos</span><span class="p">)</span>
                                     <span class="nv">regexp/newline</span><span class="p">)))</span>
                     <span class="p">((</span><span class="nb">null? </span><span class="nv">lst</span><span class="p">)</span>
                      <span class="p">(</span><span class="nf">make-regexp</span> <span class="p">(</span><span class="nb">string-append </span><span class="s">&quot;^[ \\t]*&quot;</span>
                                                  <span class="p">(</span><span class="nf">regexp-quote</span> <span class="nv">leader</span><span class="p">))</span>
                                   <span class="nv">regexp/newline</span><span class="p">))</span>
                     <span class="p">(</span><span class="nf">else</span>
                      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">pos</span> <span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nf">string-prefix-length</span> <span class="nv">leader</span> <span class="p">(</span><span class="nb">car </span><span class="nv">lst</span><span class="p">))</span>
                                      <span class="mi">0</span><span class="p">)))</span>
                        <span class="p">(</span><span class="nf">loop</span> <span class="p">(</span><span class="nb">substring </span><span class="nv">leader</span> <span class="mi">0</span> <span class="nv">pos</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">lst</span><span class="p">))))))))</span>
    <span class="p">(</span><span class="nf">regexp-substitute/global</span> <span class="no">#f</span> <span class="nv">rx</span> <span class="nv">str</span> <span class="ss">&#39;pre</span> <span class="ss">&#39;post</span><span class="p">)))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN50"
>Reformatting Paragraphs</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-13</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">text</span> <span class="s">&quot;Folding and splicing is the work of an editor,</span>
<span class="s">not a mere collection of silicon</span>
<span class="s">and</span>
<span class="s">mobile electrons!&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">wrap</span> <span class="nv">str</span> <span class="nv">max-col</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">words</span> <span class="p">(</span><span class="nf">string-tokenize</span> <span class="nv">str</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">all</span> <span class="o">&#39;</span><span class="p">())</span>
         <span class="p">(</span><span class="nf">first</span> <span class="p">(</span><span class="nb">car </span><span class="nv">words</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">col</span> <span class="p">(</span><span class="nb">string-length </span><span class="nv">first</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">line</span> <span class="p">(</span><span class="nb">list </span><span class="nv">first</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">for-each</span>
     <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span>
       <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">len</span> <span class="p">(</span><span class="nb">string-length </span><span class="nv">x</span><span class="p">))</span>
              <span class="p">(</span><span class="nf">new-col</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">col</span> <span class="nv">len</span> <span class="mi">1</span><span class="p">)))</span>
         <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">&gt; </span><span class="nv">new-col</span> <span class="nv">max-col</span><span class="p">)</span>
                <span class="p">(</span><span class="k">set! </span><span class="nv">all</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">string-join</span> <span class="p">(</span><span class="nf">reverse!</span> <span class="nv">line</span><span class="p">)</span> <span class="s">&quot; &quot;</span><span class="p">)</span> <span class="nv">all</span><span class="p">))</span>
                <span class="p">(</span><span class="k">set! </span><span class="nv">line</span> <span class="p">(</span><span class="nb">list </span><span class="nv">x</span><span class="p">))</span>
                <span class="p">(</span><span class="k">set! </span><span class="nv">col</span> <span class="nv">len</span><span class="p">))</span>
               <span class="p">(</span><span class="nf">else</span>
                <span class="p">(</span><span class="k">set! </span><span class="nv">line</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="nv">line</span><span class="p">))</span>
                <span class="p">(</span><span class="k">set! </span><span class="nv">col</span> <span class="nv">new-col</span><span class="p">)))))</span>
     <span class="p">(</span><span class="nb">cdr </span><span class="nv">words</span><span class="p">))</span>
    <span class="p">(</span><span class="k">set! </span><span class="nv">all</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">string-join</span> <span class="p">(</span><span class="nf">reverse!</span> <span class="nv">line</span><span class="p">)</span> <span class="s">&quot; &quot;</span><span class="p">)</span> <span class="nv">all</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">string-join</span> <span class="p">(</span><span class="nf">reverse!</span> <span class="nv">all</span><span class="p">)</span> <span class="s">&quot;\n&quot;</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">display </span><span class="p">(</span><span class="nf">wrap</span> <span class="nv">text</span> <span class="mi">20</span><span class="p">))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN53"
>Escaping Characters</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="k">define </span><span class="nv">str</span> <span class="s">&quot;Mom said, \&quot;Don&#39;t do that.\&quot;&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">set! </span><span class="nv">str</span> <span class="p">(</span><span class="nf">regexp-substitute/global</span> <span class="no">#f</span> <span class="s">&quot;[&#39;\&quot;]&quot;</span> <span class="nv">str</span> <span class="ss">&#39;pre</span> <span class="s">&quot;\\&quot;</span>
                                    <span class="nv">match:substring</span> <span class="ss">&#39;post</span><span class="p">))</span>
<span class="p">(</span><span class="k">set! </span><span class="nv">str</span> <span class="p">(</span><span class="nf">regexp-substitute/global</span> <span class="no">#f</span> <span class="s">&quot;[^A-Z]&quot;</span> <span class="nv">str</span> <span class="ss">&#39;pre</span> <span class="s">&quot;\\&quot;</span>
                                    <span class="nv">match:substring</span> <span class="ss">&#39;post</span><span class="p">))</span>
<span class="p">(</span><span class="k">set! </span><span class="nv">str</span> <span class="p">(</span><span class="nb">string-append </span><span class="s">&quot;this &quot;</span> <span class="p">(</span><span class="nf">regexp-substitute/global</span>
                                  <span class="no">#f</span> <span class="s">&quot;\W&quot;</span> <span class="s">&quot;is a test!&quot;</span> <span class="ss">&#39;pre</span> <span class="s">&quot;\\&quot;</span>
                                  <span class="nv">match:substring</span> <span class="ss">&#39;post</span><span class="p">)))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN56"
>Trimming Blanks from the Ends of a String</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-13</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">str</span> <span class="s">&quot;  space  &quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">string-trim</span> <span class="nv">str</span><span class="p">)</span>          <span class="c1">; &quot;space  &quot;</span>
<span class="p">(</span><span class="nf">string-trim-right</span> <span class="nv">str</span><span class="p">)</span>    <span class="c1">; &quot;  space&quot;</span>
<span class="p">(</span><span class="nf">string-trim-both</span> <span class="nv">str</span><span class="p">)</span>     <span class="c1">; &quot;space&quot;</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN59"
>Parsing Comma-Separated Data</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-2</span><span class="p">)</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-13</span><span class="p">)</span> <span class="p">(</span><span class="nf">ice-9</span> <span class="nv">format</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">parse-csv</span>
  <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">csv-match</span> <span class="p">(</span><span class="nf">string-join</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;\&quot;([^\&quot;\\\\]*(\\\\.[^\&quot;\\\\]*)*)\&quot;,?&quot;</span>
                                   <span class="s">&quot;([^,]+),?&quot;</span>
                                   <span class="s">&quot;,&quot;</span><span class="p">)</span>
                                 <span class="s">&quot;|&quot;</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">csv-rx</span> <span class="p">(</span><span class="nf">make-regexp</span> <span class="nv">csv-match</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">text</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">start</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">result</span> <span class="o">&#39;</span><span class="p">()))</span>
        <span class="p">(</span><span class="k">let </span><span class="nv">loop</span> <span class="p">((</span><span class="nf">start</span> <span class="mi">0</span><span class="p">))</span>
          <span class="p">(</span><span class="nf">and-let*</span> <span class="p">((</span><span class="nf">m</span> <span class="p">(</span><span class="nf">regexp-exec</span> <span class="nv">csv-rx</span> <span class="nv">text</span> <span class="nv">start</span><span class="p">)))</span>
            <span class="p">(</span><span class="k">set! </span><span class="nv">result</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nf">match:substring</span> <span class="nv">m</span> <span class="mi">1</span><span class="p">)</span>
                                   <span class="p">(</span><span class="nf">match:substring</span> <span class="nv">m</span> <span class="mi">3</span><span class="p">))</span>
                               <span class="nv">result</span><span class="p">))</span>
            <span class="p">(</span><span class="nf">loop</span> <span class="p">(</span><span class="nf">match:end</span> <span class="nv">m</span><span class="p">))))</span>
        <span class="p">(</span><span class="nb">reverse </span><span class="nv">result</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">line</span> <span class="s">&quot;XYZZY,\&quot;\&quot;,\&quot;O&#39;Reilly, Inc\&quot;,\&quot;Wall,</span>
<span class="s">             Larry\&quot;,\&quot;a \\\&quot;glug\\\&quot; bit,\&quot;,5,\&quot;Error, Core Dumped\&quot;&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">do </span><span class="p">((</span><span class="nf">i</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">1</span><span class="nv">+</span> <span class="nv">i</span><span class="p">))</span>
     <span class="p">(</span><span class="nf">fields</span> <span class="p">(</span><span class="nf">parse-csv</span> <span class="nv">line</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">fields</span><span class="p">)))</span>
    <span class="p">((</span><span class="nb">null? </span><span class="nv">fields</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;~D : ~A\n&quot;</span> <span class="nv">i</span> <span class="p">(</span><span class="nb">car </span><span class="nv">fields</span><span class="p">)))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN62"
>Soundex Matching</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-13</span><span class="p">)</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-14</span><span class="p">))</span>

<span class="c1">;; Knuth&#39;s soundex algorithm from The Art of Computer Programming, Vol 3</span>
<span class="p">(</span><span class="k">define </span><span class="nv">soundex</span>
  <span class="p">(</span><span class="k">letrec </span><span class="p">((</span><span class="nf">chars</span> <span class="s">&quot;AEIOUYBFPVCGJKQSXZDTLMNR&quot;</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">nums</span> <span class="s">&quot;000000111122222222334556&quot;</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">skipchars</span> <span class="p">(</span><span class="nf">string-&gt;char-set</span> <span class="s">&quot;HW&quot;</span><span class="p">))</span>
           <span class="p">(</span><span class="nf">trans</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">c</span><span class="p">)</span>
                    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">i</span> <span class="p">(</span><span class="nf">string-index</span> <span class="nv">chars</span> <span class="nv">c</span><span class="p">)))</span>
                      <span class="p">(</span><span class="k">if </span><span class="nv">i</span> <span class="p">(</span><span class="nb">string-ref </span><span class="nv">nums</span> <span class="nv">i</span><span class="p">)</span> <span class="nv">c</span><span class="p">)))))</span>
    <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">str</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">ustr</span> <span class="p">(</span><span class="nf">string-upcase</span> <span class="nv">str</span><span class="p">))</span>
             <span class="p">(</span><span class="nf">f</span> <span class="p">(</span><span class="nb">string-ref </span><span class="nv">ustr</span> <span class="mi">0</span><span class="p">))</span>
             <span class="p">(</span><span class="nf">skip</span> <span class="p">(</span><span class="nf">trans</span> <span class="nv">f</span><span class="p">)))</span>
        <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">mstr</span> <span class="p">(</span><span class="nf">string-map</span> <span class="nv">trans</span> <span class="p">(</span><span class="nf">string-delete</span> <span class="nv">ustr</span> <span class="nv">skipchars</span> <span class="mi">1</span><span class="p">)))</span>
               <span class="p">(</span><span class="nf">dstr</span> <span class="p">(</span><span class="nf">string-map</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">c</span><span class="p">)</span>
                                   <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">eq? </span><span class="nv">c</span> <span class="nv">skip</span><span class="p">)</span> <span class="sc">#\0</span><span class="p">)</span>
                                         <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="k">set! </span><span class="nv">skip</span> <span class="nv">c</span><span class="p">)</span> <span class="nv">c</span><span class="p">)))</span>
                                 <span class="nv">mstr</span><span class="p">))</span>
               <span class="p">(</span><span class="nf">zstr</span> <span class="p">(</span><span class="nf">string-delete</span> <span class="nv">dstr</span> <span class="sc">#\0</span><span class="p">)))</span>
          <span class="p">(</span><span class="nb">substring </span><span class="p">(</span><span class="nb">string-append </span><span class="p">(</span><span class="nb">make-string </span><span class="mi">1</span> <span class="nv">f</span><span class="p">)</span> <span class="nv">zstr</span> <span class="s">&quot;000&quot;</span><span class="p">)</span> <span class="mi">0</span> <span class="mi">4</span><span class="p">))))))</span>

<span class="p">(</span><span class="nf">soundex</span> <span class="s">&quot;Knuth&quot;</span><span class="p">)</span>  <span class="c1">; K530</span>
<span class="p">(</span><span class="nf">soundex</span> <span class="s">&quot;Kant&quot;</span><span class="p">)</span>   <span class="c1">; K530</span>
<span class="p">(</span><span class="nf">soundex</span> <span class="s">&quot;Lloyd&quot;</span><span class="p">)</span>  <span class="c1">; L300</span>
<span class="p">(</span><span class="nf">soundex</span> <span class="s">&quot;Ladd&quot;</span><span class="p">)</span>   <span class="c1">; L300</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN65"
>Program: fixstyle</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="o">#</span><span class="nv">!/usr/local/bin/guile</span> <span class="nv">-s</span>
<span class="nv">!</span><span class="o">#</span>

<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-13</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-14</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">ice-9</span> <span class="nv">rw</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">ice-9</span> <span class="nv">regex</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">data</span> <span class="s">&quot;analysed        =&gt; analyzed</span>
<span class="s">built-in        =&gt; builtin</span>
<span class="s">chastized       =&gt; chastised</span>
<span class="s">commandline     =&gt; command-line</span>
<span class="s">de-allocate     =&gt; deallocate</span>
<span class="s">dropin          =&gt; drop-in</span>
<span class="s">hardcode        =&gt; hard-code</span>
<span class="s">meta-data       =&gt; metadata</span>
<span class="s">multicharacter  =&gt; multi-character</span>
<span class="s">multiway        =&gt; multi-way</span>
<span class="s">non-empty       =&gt; nonempty</span>
<span class="s">non-profit      =&gt; nonprofit</span>
<span class="s">non-trappable   =&gt; nontrappable</span>
<span class="s">pre-define      =&gt; predefine</span>
<span class="s">preextend       =&gt; pre-extend</span>
<span class="s">re-compiling    =&gt; recompiling</span>
<span class="s">reenter         =&gt; re-enter</span>
<span class="s">turnkey         =&gt; turn-key&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">input</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nf">command-line</span><span class="p">)))</span>
                <span class="p">(</span><span class="nf">current-input-port</span><span class="p">)</span>
                <span class="p">(</span><span class="nb">open-input-file </span><span class="p">(</span><span class="nb">cadr </span><span class="p">(</span><span class="nf">command-line</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">newline-char-set</span> <span class="p">(</span><span class="nf">string-&gt;char-set</span> <span class="s">&quot;\n&quot;</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">assoc-char-set</span> <span class="p">(</span><span class="nf">string-&gt;char-set</span> <span class="s">&quot; =&gt;&quot;</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">dict</span> <span class="p">(</span><span class="nf">map</span>
              <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">line</span><span class="p">)</span>
                <span class="p">(</span><span class="nf">string-tokenize</span> <span class="nv">line</span> <span class="nv">assoc-char-set</span><span class="p">))</span>
              <span class="p">(</span><span class="nf">string-tokenize</span> <span class="nv">data</span> <span class="nv">newline-char-set</span><span class="p">)))</span>
       <span class="p">(</span><span class="nf">dict-match</span> <span class="p">(</span><span class="nf">string-join</span> <span class="p">(</span><span class="nb">map </span><span class="nv">car</span> <span class="nv">dict</span><span class="p">)</span> <span class="s">&quot;|&quot;</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">let </span><span class="nv">loop</span> <span class="p">((</span><span class="nf">line</span> <span class="p">(</span><span class="nf">read-line</span> <span class="nv">input</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">not </span><span class="p">(</span><span class="nb">eof-object? </span><span class="nv">line</span><span class="p">))</span>
           <span class="p">(</span><span class="nf">regexp-substitute/global</span>
            <span class="p">(</span><span class="nf">current-output-port</span><span class="p">)</span> <span class="nv">dict-match</span> <span class="nv">line</span>
            <span class="ss">&#39;pre</span>
            <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span>
              <span class="p">(</span><span class="nb">cadr </span><span class="p">(</span><span class="nb">assoc </span><span class="p">(</span><span class="nf">match:substring</span> <span class="nv">x</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">dict</span><span class="p">)))</span>
            <span class="ss">&#39;post</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">loop</span> <span class="p">(</span><span class="nf">read-line</span> <span class="nv">input</span> <span class="ss">&#39;concat</span><span class="p">))))))</span>

<span class="p">(</span><span class="nf">close-port</span> <span class="nv">input</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN68"
>Program: psgrep</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="numbers.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>PLEAC-Guile 1.8</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Numbers</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>