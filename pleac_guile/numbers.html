<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Numbers</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Guile 1.8"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Strings"
HREF="strings.html"><LINK
REL="NEXT"
TITLE="Dates and Times"
HREF="datesandtimes.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Guile 1.8</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="strings.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="datesandtimes.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="NUMBERS"
>2. Numbers</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN73"
>Checking Whether a String Is a Valid Number</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; Strings and numbers are separate data types in Scheme, so this</span>
<span class="c1">;; isn&#39;t as important as it is in Perl.  More often you would use the</span>
<span class="c1">;; type predicates, string? and number?.</span>

<span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">string-match</span> <span class="s">&quot;[^\\d]&quot;</span> <span class="nv">str</span><span class="p">)</span> <span class="p">(</span><span class="nb">display </span><span class="s">&quot;has nondigits&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nf">string-match</span> <span class="s">&quot;^\\d+$&quot;</span> <span class="nv">str</span><span class="p">)</span> <span class="p">(</span><span class="nb">display </span><span class="s">&quot;not a natural number&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nf">string-match</span> <span class="s">&quot;^-?\\d+$&quot;</span> <span class="nv">str</span><span class="p">)</span> <span class="p">(</span><span class="nb">display </span><span class="s">&quot;not an integer&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nf">string-match</span> <span class="s">&quot;^[\\-+]?\\d+$&quot;</span> <span class="nv">str</span><span class="p">)</span> <span class="p">(</span><span class="nb">display </span><span class="s">&quot;not an integer&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nf">string-match</span> <span class="s">&quot;^-?\\d+\.?\d*$&quot;</span> <span class="nv">str</span><span class="p">)</span> <span class="p">(</span><span class="nb">display </span><span class="s">&quot;not a decimal number&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nf">string-match</span> <span class="s">&quot;^-?(\d+(\.\d*)?|\.\d+)$&quot;</span> <span class="nv">str</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">display </span><span class="s">&quot;not a decimal number&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nf">string-match</span> <span class="s">&quot;^([+-]?)(\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$&quot;</span> <span class="nv">str</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">display </span><span class="s">&quot;not a C float&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">num1</span> <span class="p">(</span><span class="nb">string-&gt;number </span><span class="nv">str</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">num2</span> <span class="p">(</span><span class="nf">read</span><span class="p">))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN76"
>Comparing Floating-Point Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; (approx-equal? num1 num2 accuracy) : returns #t if num1 and num2 are</span>
<span class="c1">;;   equal to accuracy number of decimal places</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">approx-equal?</span> <span class="nv">num1</span> <span class="nv">num2</span> <span class="nv">accuracy</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nb">abs </span><span class="p">(</span><span class="nb">- </span><span class="nv">num1</span> <span class="nv">num2</span><span class="p">))</span> <span class="p">(</span><span class="nb">expt </span><span class="mf">10.0</span> <span class="p">(</span><span class="nb">- </span><span class="nv">accuracy</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">wage</span> <span class="mi">536</span><span class="p">)</span>                     <span class="c1">;; $5.36/hour</span>
<span class="p">(</span><span class="k">define </span><span class="nv">week</span> <span class="p">(</span><span class="nb">* </span><span class="mi">40</span> <span class="nv">wage</span><span class="p">))</span>             <span class="c1">;; $214.40</span>
<span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;One week&#39;s wage is: $~$\n&quot;</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">week</span> <span class="mf">100.0</span><span class="p">))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN79"
>Rounding Floating-Point Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="nb">round </span><span class="nv">num</span><span class="p">)</span>                           <span class="c1">;; rounds to inexact whole number</span>
<span class="p">(</span><span class="nb">inexact-&gt;exact </span><span class="nv">num</span><span class="p">)</span>                  <span class="c1">;; rounds to exact integer</span>

<span class="c1">;; You can also use format to convert numbers to more precisely</span>
<span class="c1">;; formatted strings.  Note Guile has a builtin format which is a more</span>
<span class="c1">;; limited version of that found in the (ice-9 format) module, to save</span>
<span class="c1">;; load time.  Basically, if you are doing anything you couldn&#39;t do</span>
<span class="c1">;; with a series of (display), (write) and (newline), then you&#39;ll need</span>
<span class="c1">;; to use the module.</span>
<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">ice-9</span> <span class="nv">format</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">a</span> <span class="mf">0.255</span><span class="p">)</span>
<span class="p">(</span><span class="k">define </span><span class="nv">b</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">round </span><span class="p">(</span><span class="nb">* </span><span class="mf">100.0</span> <span class="nv">a</span><span class="p">))</span> <span class="mf">100.0</span><span class="p">))</span>
<span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;Unrounded: ~F\nRounded: ~F\n&quot;</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
<span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;Unrounded: ~F\nRounded: ~,2F\n&quot;</span> <span class="nv">a</span> <span class="nv">a</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">a</span> <span class="o">&#39;</span><span class="p">(</span><span class="mf">3.3</span> <span class="mf">3.5</span> <span class="mf">3.7</span> <span class="mf">-3.3</span><span class="p">))</span>
<span class="p">(</span><span class="nb">display </span><span class="s">&quot;number\tint\tfloor\tceil\n&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">for-each</span>
 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">n</span><span class="p">)</span>
   <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;~,1F\t~,1F\t~,1F\t~,1F\n&quot;</span>
           <span class="nv">n</span> <span class="p">(</span><span class="nb">round </span><span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">floor </span><span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">ceiling </span><span class="nv">n</span><span class="p">)))</span>
 <span class="nv">a</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN82"
>Converting Between Binary and Decimal</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; numbers are radix independent internally, so you usually only</span>
<span class="c1">;; convert on output, however to convert strings:</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">dec-&gt;bin</span> <span class="nv">num</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">number-&gt;string </span><span class="p">(</span><span class="nb">string-&gt;number </span><span class="nv">num</span> <span class="mi">10</span><span class="p">)</span> <span class="mi">2</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">bin-&gt;dec</span> <span class="nv">num</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">number-&gt;string </span><span class="p">(</span><span class="nb">string-&gt;number </span><span class="nv">num</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">10</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">num</span> <span class="p">(</span><span class="nf">bin-&gt;dec</span> <span class="s">&quot;0110110&quot;</span><span class="p">))</span>  <span class="c1">; 54</span>
<span class="p">(</span><span class="k">define </span><span class="nv">binstr</span> <span class="p">(</span><span class="nf">dec-&gt;bin</span> <span class="s">&quot;54&quot;</span><span class="p">))</span>    <span class="c1">; 110110</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN85"
>Operating on a Series of Integers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; do is the most general loop iterator</span>
<span class="p">(</span><span class="k">do </span><span class="p">((</span><span class="nf">i</span> <span class="nv">x</span> <span class="p">(</span><span class="mi">1</span><span class="nv">+</span> <span class="nv">i</span><span class="p">)))</span>   <span class="c1">; var  init-value  step-value</span>
    <span class="p">((</span><span class="nb">&gt; </span><span class="nv">i</span> <span class="nv">y</span><span class="p">))</span>        <span class="c1">; end when true</span>
  <span class="c1">;; i is set to every integer from x to y, inclusive</span>
  <span class="c1">;; ...</span>
  <span class="p">)</span>

<span class="c1">;; Guile also offers a while loop</span>
<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">i</span> <span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">while</span> <span class="p">(</span><span class="nb">&lt;= </span><span class="nv">i</span> <span class="nv">y</span><span class="p">)</span>
         <span class="c1">;; i is set to every integer from x to y, inclusive</span>
         <span class="c1">; ...</span>
         <span class="p">(</span><span class="k">set! </span><span class="nv">i</span> <span class="p">(</span><span class="mi">1</span><span class="nv">+</span> <span class="nv">i</span><span class="p">))))</span>

<span class="c1">;; named let is another common loop</span>
<span class="p">(</span><span class="k">let </span><span class="nv">loop</span> <span class="p">((</span><span class="nf">i</span> <span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">&lt;= </span><span class="nv">i</span> <span class="nv">y</span><span class="p">)</span>
         <span class="c1">;; i is set to every integer from x to y, step-size 7</span>
         <span class="c1">;; ...</span>
         <span class="p">(</span><span class="nf">loop</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">i</span> <span class="mi">7</span><span class="p">)))))</span>  <span class="c1">; tail-recursive call</span>

<span class="p">(</span><span class="nb">display </span><span class="s">&quot;Infancy is: &quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">do </span><span class="p">((</span><span class="nf">i</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">1</span><span class="nv">+</span> <span class="nv">i</span><span class="p">)))</span>
    <span class="p">((</span><span class="nb">&gt; </span><span class="nv">i</span> <span class="mi">2</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;~A &quot;</span> <span class="nv">i</span><span class="p">))</span>
<span class="p">(</span><span class="nf">newline</span><span class="p">)</span>

<span class="p">(</span><span class="nb">display </span><span class="s">&quot;Toddling is: &quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">i</span> <span class="mi">3</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">while</span> <span class="p">(</span><span class="nb">&lt;= </span><span class="nv">i</span> <span class="mi">4</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;~A &quot;</span> <span class="nv">i</span><span class="p">)</span>
         <span class="p">(</span><span class="k">set! </span><span class="nv">i</span> <span class="p">(</span><span class="mi">1</span><span class="nv">+</span> <span class="nv">i</span><span class="p">))))</span>
<span class="p">(</span><span class="nf">newline</span><span class="p">)</span>

<span class="p">(</span><span class="nb">display </span><span class="s">&quot;Childhood is: &quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">let </span><span class="nv">loop</span> <span class="p">((</span><span class="nf">i</span> <span class="mi">5</span><span class="p">))</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">&lt;= </span><span class="nv">i</span> <span class="mi">12</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;~A &quot;</span> <span class="nv">i</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">loop</span> <span class="p">(</span><span class="mi">1</span><span class="nv">+</span> <span class="nv">i</span><span class="p">)))))</span>
<span class="p">(</span><span class="nf">newline</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN88"
>Working with Roman Numerals</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; format can output roman numerals - use ~:@R</span>

<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">ice-9</span> <span class="nv">format</span><span class="p">))</span>

<span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;Roman for ~R is ~:@R\n&quot;</span> <span class="mi">15</span> <span class="mi">15</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN91"
>Generating Random Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="nf">random</span> <span class="mi">5</span><span class="p">)</span>        <span class="c1">; an integer from 0 to 4</span>
<span class="p">(</span><span class="nf">random</span> <span class="mf">5.0</span><span class="p">)</span>      <span class="c1">; an inexact real in the range [0,5)</span>

<span class="c1">;; char sets from SRFI-14 and string-unfold from SRFI-13 make a quick</span>
<span class="c1">;; way to generate passwords</span>

<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-13</span><span class="p">)</span> <span class="p">(</span><span class="nf">srfi</span> <span class="nv">srfi-14</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">chars</span> <span class="p">(</span><span class="nf">char-set-&gt;string</span> <span class="nv">char-set:graphic</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">size</span> <span class="p">(</span><span class="nf">char-set-size</span> <span class="nv">char-set:graphic</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">password</span>
  <span class="p">(</span><span class="nf">string-unfold</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">= </span><span class="nv">x</span> <span class="mi">8</span><span class="p">))</span>
                 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">string-ref </span><span class="nv">chars</span> <span class="p">(</span><span class="nf">random</span> <span class="nv">size</span><span class="p">)))</span>
                 <span class="mi">1</span><span class="nv">+</span> <span class="mi">0</span><span class="p">))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN94"
>Generating Different Random Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; if you&#39;re working with random numbers you&#39;ll probably want to set</span>
<span class="c1">;; the random seed</span>

<span class="p">(</span><span class="nf">seed-&gt;random-state</span> <span class="p">(</span><span class="nf">current-time</span><span class="p">))</span>

<span class="c1">;; you can also save random states and pass them to any of the above</span>
<span class="c1">;; random functions</span>

<span class="p">(</span><span class="k">define </span><span class="nv">state</span> <span class="p">(</span><span class="nf">copy-random-state</span><span class="p">))</span>
<span class="p">(</span><span class="nf">random:uniform</span><span class="p">)</span>
<span class="c1">;; 0.939377327721761</span>
<span class="p">(</span><span class="nf">random:uniform</span> <span class="nv">state</span><span class="p">)</span>
<span class="c1">;; 0.939377327721761</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN97"
>Making Numbers Even More Random</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; @@INCOMPLETE@@</span>
<span class="c1">;; very inefficient</span>
<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">ice-9</span> <span class="nv">rw</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">make-true-random</span>
  <span class="p">(</span><span class="k">letrec </span><span class="p">((</span><span class="nf">bufsize</span> <span class="mi">8</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">accum</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">c</span> <span class="nv">acc</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nb">* </span><span class="mi">256</span> <span class="nv">acc</span><span class="p">)</span>
                                     <span class="p">(</span><span class="nb">char-&gt;integer </span><span class="nv">c</span><span class="p">))))</span>
           <span class="p">(</span><span class="nf">getbuf</span> <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
                     <span class="p">(</span><span class="nb">call-with-input-file </span><span class="s">&quot;/dev/urandom&quot;</span>
                       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p</span><span class="p">)</span>
                         <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">buf</span> <span class="p">(</span><span class="nb">make-string </span><span class="nv">bufsize</span><span class="p">)))</span>
                           <span class="p">(</span><span class="nf">read-string!/partial</span> <span class="nv">buf</span> <span class="nv">p</span><span class="p">)</span>
                           <span class="nv">buf</span><span class="p">))))))</span>
    <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">rand-proc</span><span class="p">)</span>
      <span class="p">(</span><span class="k">lambda </span><span class="nv">args</span>
        <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">state</span> <span class="p">(</span><span class="nf">seed-&gt;random-state</span> <span class="p">(</span><span class="nf">string-fold</span> <span class="nv">accum</span> <span class="mi">0</span> <span class="p">(</span><span class="nf">getbuf</span><span class="p">)))))</span>
          <span class="p">(</span><span class="nb">apply </span><span class="nv">rand-proc</span> <span class="p">(</span><span class="nb">append </span><span class="nv">args</span> <span class="p">(</span><span class="nb">list </span><span class="nv">state</span><span class="p">))))))))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">urandom</span> <span class="p">(</span><span class="nf">make-true-random</span> <span class="nv">random</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">urandom:exp</span> <span class="p">(</span><span class="nf">make-true-random</span> <span class="nv">random:exp</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">urandom:normal</span> <span class="p">(</span><span class="nf">make-true-random</span> <span class="nv">random:normal</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">urandom:uniform</span> <span class="p">(</span><span class="nf">make-true-random</span> <span class="nv">random:uniform</span><span class="p">))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN100"
>Generating Biased Random Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; Guile offers a number of random distributions</span>

<span class="p">(</span><span class="nf">random:exp</span><span class="p">)</span>      <span class="c1">; an inexact real in an exponential dist with mean 1</span>
<span class="p">(</span><span class="nf">random:normal</span><span class="p">)</span>   <span class="c1">; an inexact real in a standard normal distribution</span>
<span class="p">(</span><span class="nf">random:uniform</span><span class="p">)</span>  <span class="c1">; a uniformly distributed inexact real in [0,1)</span>

<span class="c1">;; There are also functions to fill vectors with random distributions</span>

<span class="c1">;; Fills vector v with inexact real random numbers the sum of whose</span>
<span class="c1">;; squares is equal to 1.0.</span>
<span class="p">(</span><span class="nf">random:hollow-sphere!</span> <span class="nv">v</span><span class="p">)</span>

<span class="c1">;; Fills vector v with inexact real random numbers that are</span>
<span class="c1">;; independent and standard normally distributed (i.e., with mean 0</span>
<span class="c1">;; and variance 1).</span>
<span class="p">(</span><span class="nf">random:normal-vector!</span> <span class="nv">v</span><span class="p">)</span>

<span class="c1">;; Fills vector v with inexact real random numbers the sum of whose</span>
<span class="c1">;; squares is less than 1.0.</span>
<span class="p">(</span><span class="nf">random:solid-sphere!</span> <span class="nv">v</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN103"
>Doing Trigonometry in Degrees, not Radians</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; Guile&#39;s trigonometric functions use radians.</span>

<span class="p">(</span><span class="k">define </span><span class="nv">pi</span> <span class="mf">3.14159265358979</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">degrees-&gt;radians</span> <span class="nv">deg</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">* </span><span class="nv">pi</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">deg</span> <span class="mf">180.0</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">radians-&gt;degrees</span> <span class="nv">rad</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">* </span><span class="mf">180.0</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">rad</span> <span class="nv">pi</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">degree-sine</span> <span class="nv">deg</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">sin </span><span class="p">(</span><span class="nf">degrees-&gt;radians</span> <span class="nv">deg</span><span class="p">)))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN106"
>Calculating More Trigonometric Functions</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span>
<span class="c1">;; Guile provides the following standard trigonometric functions (and</span>
<span class="c1">;; their hyperbolic equivalents), defined for all real and complex</span>
<span class="c1">;; numbers:</span>

<span class="p">(</span><span class="nb">sin </span><span class="nv">z</span><span class="p">)</span>
<span class="p">(</span><span class="nb">cos </span><span class="nv">z</span><span class="p">)</span>
<span class="p">(</span><span class="nb">tan </span><span class="nv">z</span><span class="p">)</span>
<span class="p">(</span><span class="nb">asin </span><span class="nv">z</span><span class="p">)</span>
<span class="p">(</span><span class="nb">acos </span><span class="nv">z</span><span class="p">)</span>
<span class="p">(</span><span class="nb">atan </span><span class="nv">z</span><span class="p">)</span>

<span class="p">(</span><span class="nb">acos </span><span class="mf">3.7</span><span class="p">)</span>  <span class="c1">; 0.0+1.9826969446812i</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN109"
>Taking Logarithms</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; Guile provides log in base e and 10 natively, defined for any real</span>
<span class="c1">;; or complex numbers:</span>

<span class="p">(</span><span class="nb">log </span><span class="nv">z</span><span class="p">)</span>    <span class="c1">; natural logarithm</span>
<span class="p">(</span><span class="nf">log10</span> <span class="nv">z</span><span class="p">)</span>  <span class="c1">; base-10 logarithm</span>

<span class="c1">;; For other bases, divide by the log of the base:</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">log-base</span> <span class="nv">n</span> <span class="nv">z</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">log </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nb">log </span><span class="nv">n</span><span class="p">)))</span>

<span class="c1">;; To avoid re-computing (log n) for a base you want to use</span>
<span class="c1">;; frequently, you can create a custom log function:</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-log-base</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">divisor</span> <span class="p">(</span><span class="nb">log </span><span class="nv">n</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">z</span><span class="p">)</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">log </span><span class="nv">z</span><span class="p">)</span> <span class="nv">divisor</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">log2</span> <span class="p">(</span><span class="nf">make-log-base</span> <span class="mi">2</span><span class="p">))</span>

<span class="p">(</span><span class="nf">log2</span> <span class="mi">1024</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN112"
>Multiplying Matrices</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; In addition to simple vectors, Guile has builtin support for</span>
<span class="c1">;; uniform arrays of an arbitrary dimension.</span>

<span class="c1">;; a rows x cols integer matrix</span>
<span class="p">(</span><span class="k">define </span><span class="nv">a</span> <span class="p">(</span><span class="nf">make-array</span> <span class="mi">0</span> <span class="nv">rows</span> <span class="nv">cols</span><span class="p">))</span>
<span class="p">(</span><span class="nf">array-set!</span> <span class="nv">a</span> <span class="mi">3</span> <span class="nv">row</span> <span class="nv">col</span><span class="p">)</span>
<span class="p">(</span><span class="nf">array-ref</span> <span class="nv">a</span> <span class="nv">row</span> <span class="nv">col</span><span class="p">)</span>

<span class="c1">;; a 3D matrix of reals</span>
<span class="p">(</span><span class="k">define </span><span class="nv">b</span> <span class="p">(</span><span class="nf">make-array</span> <span class="mf">0.0</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">z</span><span class="p">))</span>

<span class="c1">;; a literal boolean truth table for logical and</span>
<span class="o">&#39;#</span><span class="mi">2</span><span class="p">((</span><span class="no">#f</span> <span class="no">#f</span><span class="p">)</span> <span class="p">(</span><span class="no">#f</span> <span class="no">#t</span><span class="p">))</span>

<span class="c1">;; simple matrix multiplication</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">matrix-mult</span> <span class="nv">m1</span> <span class="nv">m2</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">d1</span> <span class="p">(</span><span class="nf">array-dimensions</span> <span class="nv">m1</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">d2</span> <span class="p">(</span><span class="nf">array-dimensions</span> <span class="nv">m2</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">m1rows</span> <span class="p">(</span><span class="nb">car </span><span class="nv">d1</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">m1cols</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">d1</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">m2rows</span> <span class="p">(</span><span class="nb">car </span><span class="nv">d2</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">m2cols</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">d2</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">= </span><span class="nv">m1cols</span> <span class="nv">m2rows</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">error</span> <span class="ss">&#39;index-error</span> <span class="s">&quot;matrices don&#39;t match&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">result</span> <span class="p">(</span><span class="nf">make-array</span> <span class="mi">0</span> <span class="nv">m1rows</span> <span class="nv">m2cols</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">do </span><span class="p">((</span><span class="nf">i</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">1</span><span class="nv">+</span> <span class="nv">i</span><span class="p">)))</span>
          <span class="p">((</span><span class="nb">= </span><span class="nv">i</span> <span class="nv">m1rows</span><span class="p">))</span>
        <span class="p">(</span><span class="k">do </span><span class="p">((</span><span class="nf">j</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">1</span><span class="nv">+</span> <span class="nv">j</span><span class="p">)))</span>
            <span class="p">((</span><span class="nb">= </span><span class="nv">j</span> <span class="nv">m2cols</span><span class="p">))</span>
          <span class="p">(</span><span class="k">do </span><span class="p">((</span><span class="nf">k</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">1</span><span class="nv">+</span> <span class="nv">k</span><span class="p">)))</span>
              <span class="p">((</span><span class="nb">= </span><span class="nv">k</span> <span class="nv">m1cols</span><span class="p">))</span>
            <span class="p">(</span><span class="nf">array-set!</span> <span class="nv">result</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">array-ref</span> <span class="nv">result</span> <span class="nv">i</span> <span class="nv">j</span><span class="p">)</span>
                                  <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">array-ref</span> <span class="nv">m1</span> <span class="nv">i</span> <span class="nv">k</span><span class="p">)</span>
                                     <span class="p">(</span><span class="nf">array-ref</span> <span class="nv">m2</span> <span class="nv">k</span> <span class="nv">j</span><span class="p">)))</span>
                        <span class="nv">i</span> <span class="nv">j</span><span class="p">))))</span>
      <span class="nv">result</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">matrix-mult</span> <span class="o">&#39;#</span><span class="mi">2</span><span class="p">((</span><span class="mi">3</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="mi">5</span> <span class="mi">9</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&#39;#</span><span class="mi">2</span><span class="p">((</span><span class="mi">4</span> <span class="mi">7</span><span class="p">)</span> <span class="p">(</span><span class="mi">9</span> <span class="mi">3</span><span class="p">)</span> <span class="p">(</span><span class="mi">8</span> <span class="mi">1</span><span class="p">)))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN115"
>Using Complex Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; Guile has builtin support for complex numbers:</span>

<span class="p">(</span><span class="k">define </span><span class="nv">i</span> <span class="mi">0</span><span class="nv">+1i</span><span class="p">)</span>       <span class="c1">; 0.0+1.0i</span>
<span class="p">(</span><span class="k">define </span><span class="nv">i</span> <span class="p">(</span><span class="nb">sqrt </span><span class="mi">-1</span><span class="p">))</span>  <span class="c1">; 0.0+1.0i</span>

<span class="p">(</span><span class="nb">complex? </span><span class="nv">i</span><span class="p">)</span>          <span class="c1">; #t</span>
<span class="p">(</span><span class="nb">real-part </span><span class="nv">i</span><span class="p">)</span>         <span class="c1">; 0.0</span>
<span class="p">(</span><span class="nb">imag-part </span><span class="nv">i</span><span class="p">)</span>         <span class="c1">; 1.0</span>

<span class="p">(</span><span class="nb">* </span><span class="mi">3</span><span class="nv">+5i</span> <span class="mi">2-2</span><span class="nv">i</span><span class="p">)</span>         <span class="c1">; 16+4i</span>
<span class="p">(</span><span class="nb">sqrt </span><span class="mi">3</span><span class="nv">+4i</span><span class="p">)</span>           <span class="c1">; 2+i</span>

<span class="c1">;; Classic identity:  -e^(pi*i) =&gt; 1</span>
<span class="p">(</span><span class="nb">inexact-&gt;exact </span><span class="p">(</span><span class="nb">real-part </span><span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">exp </span><span class="p">(</span><span class="nb">* </span><span class="nv">pi</span> <span class="mi">0</span><span class="nv">+1i</span><span class="p">)))))</span> <span class="c1">; 1</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN118"
>Converting Between Octal and Hexadecimal</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; You can type in literal numbers in alternate radixes:</span>

<span class="o">#</span><span class="nv">b01101101</span>     <span class="c1">; 109 in binary</span>
<span class="o">#</span><span class="nv">o155</span>          <span class="c1">; 109 in octal</span>
<span class="o">#</span><span class="nv">d109</span>          <span class="c1">; 109 in decimal</span>
<span class="o">#</span><span class="nv">x6d</span>           <span class="c1">; 109 in hexadecimal</span>

<span class="c1">;; number-&gt;string and string-&gt;number also take an optional radix:</span>

<span class="p">(</span><span class="k">define </span><span class="nv">number</span> <span class="p">(</span><span class="nb">string-&gt;number </span><span class="nv">hexadecimal</span> <span class="mi">16</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">number</span> <span class="p">(</span><span class="nb">string-&gt;number </span><span class="nv">octal</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1">;; format will also output in different radixes:</span>

<span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;~B ~O ~D ~X\n&quot;</span> <span class="nv">num</span> <span class="nv">num</span> <span class="nv">num</span> <span class="nv">num</span><span class="p">)</span>

<span class="c1">;; converting Unix file permissions read from stdin:</span>

<span class="p">(</span><span class="k">let </span><span class="nv">loop</span> <span class="p">((</span><span class="nf">perm</span> <span class="p">(</span><span class="nf">read-line</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">not </span><span class="p">(</span><span class="nb">eof-object? </span><span class="nv">perm</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;The decimal value is ~D\n&quot;</span> <span class="p">(</span><span class="nb">string-&gt;number </span><span class="nv">perm</span> <span class="mi">8</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">loop</span> <span class="p">(</span><span class="nf">read-line</span><span class="p">)))))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN121"
>Putting Commas in Numbers</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; once again, format is our friend :)</span>
<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">ice-9</span> <span class="nv">format</span><span class="p">))</span>

<span class="c1">;; the : prefix to the D directive causes commas to be output every</span>
<span class="c1">;; three digits.</span>
<span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;~:D\n&quot;</span> <span class="p">(</span><span class="nf">random</span> <span class="mi">10000000000000000</span><span class="p">))</span>
<span class="c1">; =&gt; 2,301,267,079,619,540</span>

<span class="c1">;; the third prefix arg to the D directive is the separator character</span>
<span class="c1">;; to use instead of a comma, useful for European style numbers:</span>
<span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;~,,&#39;.:D\n&quot;</span> <span class="p">(</span><span class="nf">random</span> <span class="mi">10000000000000000</span><span class="p">))</span>
<span class="c1">; =&gt; 6.486.470.447.356.534</span>

<span class="c1">;; the F directive, however, does not support grouping by commas.  to</span>
<span class="c1">;; achieve this, we can format the integer and fractional parts</span>
<span class="c1">;; separately:</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">commify</span> <span class="nv">num</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">int</span> <span class="p">(</span><span class="nb">inexact-&gt;exact </span><span class="p">(</span><span class="nb">truncate </span><span class="nv">num</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">num</span> <span class="nv">int</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">format</span> <span class="no">#f</span> <span class="s">&quot;~:D&quot;</span> <span class="nv">int</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">string-append </span><span class="p">(</span><span class="nf">format</span> <span class="no">#f</span> <span class="s">&quot;~:D&quot;</span> <span class="nv">int</span><span class="p">)</span>
                     <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">str</span> <span class="p">(</span><span class="nf">format</span> <span class="no">#f</span> <span class="s">&quot;~F&quot;</span> <span class="nv">num</span><span class="p">)))</span>
                       <span class="p">(</span><span class="nb">substring </span><span class="nv">str</span> <span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nf">string-index</span> <span class="nv">str</span> <span class="sc">#\.</span><span class="p">)</span>
                                          <span class="p">(</span><span class="nb">string-length </span><span class="nv">str</span><span class="p">))))))))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN124"
>Printing Correct Plurals</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; format can handle simple &#39;s&#39; plurals with ~p, and &#39;y/ies&#39; plurals</span>
<span class="c1">;; with the @ prefix:</span>

<span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;It took ~D hour~P\n&quot;</span> <span class="nv">hours</span> <span class="nv">hours</span><span class="p">)</span>

<span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;It took ~D centur~@P\n&quot;</span> <span class="nv">centuries</span> <span class="nv">centuries</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">noun-plural</span>
  <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">suffixes</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;ss&quot;</span>  <span class="o">.</span> <span class="s">&quot;sses&quot;</span><span class="p">)</span>
                     <span class="p">(</span><span class="s">&quot;ph&quot;</span>  <span class="o">.</span> <span class="s">&quot;phes&quot;</span><span class="p">)</span>
                     <span class="p">(</span><span class="s">&quot;sh&quot;</span>  <span class="o">.</span> <span class="s">&quot;shes&quot;</span><span class="p">)</span>
                     <span class="p">(</span><span class="s">&quot;ch&quot;</span>  <span class="o">.</span> <span class="s">&quot;ches&quot;</span><span class="p">)</span>
                     <span class="p">(</span><span class="s">&quot;z&quot;</span>   <span class="o">.</span> <span class="s">&quot;zes&quot;</span><span class="p">)</span>
                     <span class="p">(</span><span class="s">&quot;ff&quot;</span>  <span class="o">.</span> <span class="s">&quot;ffs&quot;</span><span class="p">)</span>
                     <span class="p">(</span><span class="s">&quot;f&quot;</span>   <span class="o">.</span> <span class="s">&quot;ves&quot;</span><span class="p">)</span>
                     <span class="p">(</span><span class="s">&quot;ey&quot;</span>  <span class="o">.</span> <span class="s">&quot;eys&quot;</span><span class="p">)</span>
                     <span class="p">(</span><span class="s">&quot;y&quot;</span>   <span class="o">.</span> <span class="s">&quot;ies&quot;</span><span class="p">)</span>
                     <span class="p">(</span><span class="s">&quot;ix&quot;</span>  <span class="o">.</span> <span class="s">&quot;ices&quot;</span><span class="p">)</span>
                     <span class="p">(</span><span class="s">&quot;s&quot;</span>   <span class="o">.</span> <span class="s">&quot;ses&quot;</span><span class="p">)</span>
                     <span class="p">(</span><span class="s">&quot;x&quot;</span>   <span class="o">.</span> <span class="s">&quot;xes&quot;</span><span class="p">)</span>
                     <span class="p">(</span><span class="s">&quot;ius&quot;</span> <span class="o">.</span> <span class="s">&quot;ii&quot;</span><span class="p">)))</span>
        <span class="p">(</span><span class="nf">suffix-match</span>
         <span class="p">(</span><span class="nb">string-append </span><span class="s">&quot;(&quot;</span> <span class="p">(</span><span class="nf">string-join</span> <span class="p">(</span><span class="nb">map </span><span class="nv">car</span> <span class="nv">suffixes</span><span class="p">)</span> <span class="s">&quot;|&quot;</span><span class="p">)</span> <span class="s">&quot;)$&quot;</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">suffix-rx</span> <span class="p">(</span><span class="nf">make-regexp</span> <span class="nv">suffix-match</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">noun</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">m</span> <span class="p">(</span><span class="nf">regexp-exec</span> <span class="nv">suffix-rx</span> <span class="nv">noun</span><span class="p">)))</span>
        <span class="p">(</span><span class="k">if </span><span class="nv">m</span>
          <span class="p">(</span><span class="nb">string-append </span><span class="p">(</span><span class="nf">regexp-substitute</span> <span class="no">#f</span> <span class="nv">m</span> <span class="ss">&#39;pre</span><span class="p">)</span>
                         <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nb">assoc </span><span class="p">(</span><span class="nf">match:substring</span> <span class="nv">m</span><span class="p">)</span> <span class="nv">suffixes</span><span class="p">)))</span>
          <span class="p">(</span><span class="nb">string-append </span><span class="nv">noun</span> <span class="s">&quot;s&quot;</span><span class="p">))))))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN127"
>Program: Calculating Prime Factors</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="o">#</span><span class="nv">!/usr/local/bin/guile</span> <span class="nv">-s</span>
<span class="nv">!</span><span class="o">#</span>

<span class="c1">;; very naive factoring algorithm</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">factor</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">factors</span> <span class="o">&#39;</span><span class="p">())</span>
        <span class="p">(</span><span class="nf">limit</span> <span class="p">(</span><span class="nb">inexact-&gt;exact </span><span class="p">(</span><span class="nb">round </span><span class="p">(</span><span class="nb">sqrt </span><span class="nv">n</span><span class="p">))))</span>
        <span class="p">(</span><span class="nf">twos</span> <span class="mi">0</span><span class="p">))</span>
    <span class="c1">;; factor out 2&#39;s</span>
    <span class="p">(</span><span class="nf">while</span> <span class="p">(</span><span class="nb">even? </span><span class="nv">n</span><span class="p">)</span>
           <span class="p">(</span><span class="k">set! </span><span class="nv">n</span> <span class="p">(</span><span class="nf">ash</span> <span class="nv">n</span> <span class="mi">-1</span><span class="p">))</span>
           <span class="p">(</span><span class="k">set! </span><span class="nv">twos</span> <span class="p">(</span><span class="mi">1</span><span class="nv">+</span> <span class="nv">twos</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">twos</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="k">set! </span><span class="nv">factors</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">cons </span><span class="mi">2</span> <span class="nv">twos</span><span class="p">))))</span>
    <span class="c1">;; factor out odd primes</span>
    <span class="p">(</span><span class="k">let </span><span class="nv">loop</span> <span class="p">((</span><span class="nf">i</span> <span class="mi">3</span><span class="p">))</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">r</span> <span class="p">(</span><span class="nb">remainder </span><span class="nv">n</span> <span class="nv">i</span><span class="p">)))</span>
        <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">r</span> <span class="mi">0</span><span class="p">)</span>
               <span class="p">(</span><span class="k">set! </span><span class="nv">n</span> <span class="p">(</span><span class="nb">quotient </span><span class="nv">n</span> <span class="nv">i</span><span class="p">))</span>
               <span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">old-val</span> <span class="p">(</span><span class="nb">assv </span><span class="nv">i</span> <span class="nv">factors</span><span class="p">))</span>
                      <span class="p">(</span><span class="nf">new-val</span> <span class="p">(</span><span class="k">if </span><span class="nv">old-val</span> <span class="p">(</span><span class="mi">1</span><span class="nv">+</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">old-val</span><span class="p">))</span> <span class="mi">1</span><span class="p">)))</span>
                 <span class="p">(</span><span class="k">set! </span><span class="nv">factors</span> <span class="p">(</span><span class="nf">assv-set!</span> <span class="nv">factors</span> <span class="nv">i</span> <span class="nv">new-val</span><span class="p">)))</span>
               <span class="p">(</span><span class="nf">loop</span> <span class="nv">i</span><span class="p">))</span>
              <span class="p">((</span><span class="nb">&lt; </span><span class="nv">i</span> <span class="nv">limit</span><span class="p">)</span>
               <span class="p">(</span><span class="nf">loop</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">2</span> <span class="nv">i</span><span class="p">))))))</span>
    <span class="c1">;; remainder</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="k">set! </span><span class="nv">factors</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">cons </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">factors</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">reverse!</span> <span class="nv">factors</span><span class="p">)))</span>

<span class="c1">;; pretty print a term of a factor</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">pp-term</span> <span class="nv">pair</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">pair</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">number-&gt;string </span><span class="p">(</span><span class="nb">car </span><span class="nv">pair</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">format</span> <span class="no">#f</span> <span class="s">&quot;~A^~A&quot;</span> <span class="p">(</span><span class="nb">car </span><span class="nv">pair</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">pair</span><span class="p">))))</span>

<span class="c1">;; factor each number given on the command line</span>
<span class="p">(</span><span class="nf">for-each</span>
 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">n</span><span class="p">)</span>
   <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">factors</span> <span class="p">(</span><span class="nf">factor</span> <span class="nv">n</span><span class="p">)))</span>
     <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;~A = ~A&quot;</span> <span class="nv">n</span> <span class="p">(</span><span class="nf">pp-term</span> <span class="p">(</span><span class="nb">car </span><span class="nv">factors</span><span class="p">)))</span>
     <span class="p">(</span><span class="nf">for-each</span>
      <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot; * ~A&quot;</span> <span class="p">(</span><span class="nf">pp-term</span> <span class="nv">x</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">cdr </span><span class="nv">factors</span><span class="p">))</span>
     <span class="p">(</span><span class="nf">newline</span><span class="p">)))</span>
 <span class="p">(</span><span class="nb">map </span><span class="nv">string-&gt;number</span> <span class="p">(</span><span class="nb">cdr </span><span class="p">(</span><span class="nf">command-line</span><span class="p">))))</span></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="strings.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="datesandtimes.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Strings</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Dates and Times</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>