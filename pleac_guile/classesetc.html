<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN""http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Classes, Objects, and Ties</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="PLEAC-Guile 1.8"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Packages, Libraries, and Modules"
HREF="packagesetc.html"><LINK
REL="NEXT"
TITLE="Database Access"
HREF="dbaccess.html"><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }

  </style></head
><BODY TEXT="#cecece" BGCOLOR="#4f6f6f" LINK="#f5deb3" VLINK="#d5ae83"
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PLEAC-Guile 1.8</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="packagesetc.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="dbaccess.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="CLASSESETC"
>13. Classes, Objects, and Ties</A
></H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN704"
>Introduction</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; Guile OOP is in the (oop goops) module (based on CLOS).  All</span>
<span class="c1">;; following sections assume you have (oop goops loaded).</span>
<span class="p">(</span><span class="nf">use-modules</span> <span class="p">(</span><span class="nf">oop</span> <span class="nv">goops</span><span class="p">))</span>
<span class="p">(</span><span class="nf">define-class</span> <span class="nv">&lt;data-encoder&gt;</span> <span class="p">())</span>
<span class="p">(</span><span class="k">define </span><span class="nv">obj</span> <span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;data-encoder&gt;</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">obj</span> <span class="o">#</span><span class="p">(</span><span class="mi">3</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;~A ~A\n&quot;</span> <span class="p">(</span><span class="nf">class-of</span> <span class="nv">obj</span><span class="p">)</span> <span class="p">(</span><span class="nf">array-ref</span> <span class="nv">obj</span> <span class="mi">1</span><span class="p">))</span>
<span class="p">(</span><span class="nf">change-class</span> <span class="nv">v</span> <span class="nv">&lt;human-cannibal&gt;</span><span class="p">)</span> <span class="c1">; has to be defined</span>
<span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;~A ~A\n&quot;</span> <span class="p">(</span><span class="nf">slot-ref</span> <span class="nv">obj</span> <span class="nv">stomach</span><span class="p">)</span> <span class="p">(</span><span class="nf">slot-ref</span> <span class="nv">obj</span> <span class="nv">name</span><span class="p">))</span>

<span class="p">(</span><span class="nf">slot-ref</span> <span class="nv">obj</span> <span class="ss">&#39;stomach</span><span class="p">)</span>
<span class="p">(</span><span class="nf">slot-set!</span> <span class="nv">obj</span> <span class="ss">&#39;stomach</span> <span class="s">&quot;Empty&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">name</span> <span class="nv">obj</span><span class="p">)</span>
<span class="p">(</span><span class="k">set! </span><span class="p">(</span><span class="nf">name</span> <span class="nv">obj</span><span class="p">)</span> <span class="s">&quot;Thag&quot;</span><span class="p">)</span>

<span class="c1">;; inheritance</span>
<span class="p">(</span><span class="nf">define-class</span> <span class="nv">&lt;lawyer&gt;</span> <span class="p">(</span><span class="nf">&lt;human-cannibal&gt;</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">lector</span> <span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;human-cannibal&gt;</span><span class="p">))</span>
<span class="p">(</span><span class="nf">feed</span> <span class="nv">lector</span> <span class="s">&quot;Zak&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">move</span> <span class="nv">lector</span> <span class="s">&quot;New York&quot;</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN707"
>Constructing an Object</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="p">(</span><span class="nf">define-class</span> <span class="nv">&lt;my-class&gt;</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">start</span> <span class="o">#</span><span class="nv">:init-form</span> <span class="p">(</span><span class="nf">current-time</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">age</span> <span class="o">#</span><span class="nv">:init-value</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1">;; classes must have predefined slots, but you could use one as a</span>
<span class="c1">;; dictionary:</span>
<span class="p">(</span><span class="nf">define-class</span> <span class="nv">&lt;my-class&gt;</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">start</span> <span class="o">#</span><span class="nv">:init-form</span> <span class="p">(</span><span class="nf">current-time</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">age</span> <span class="o">#</span><span class="nv">:init-value</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">properties</span> <span class="o">#</span><span class="nv">:init-value</span> <span class="o">&#39;</span><span class="p">()))</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">initialize</span> <span class="p">(</span><span class="nf">m</span> <span class="nv">&lt;my-class&gt;</span><span class="p">)</span> <span class="nv">initargs</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">and-let*</span> <span class="p">((</span><span class="nf">extra</span> <span class="p">(</span><span class="nb">memq </span><span class="o">#</span><span class="nv">:extra</span> <span class="nv">initargs</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">slot-set!</span> <span class="nv">m</span> <span class="ss">&#39;properties</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">extra</span><span class="p">))))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN710"
>Destroying an Object</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; For smobs (external C objects), you can specify a callback to be</span>
<span class="c1">;; performed when the object is garbage collected with the C API</span>
<span class="c1">;; function `scm_set_smob_free&#39;.  This solves the problem of cleaning up</span>
<span class="c1">;; after external objects and connections.  Guile doesn&#39;t use reference</span>
<span class="c1">;; count garbage collection, so circular data structures aren&#39;t a</span>
<span class="c1">;; problem.</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN713"
>Managing Instance Data</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; either use slot-ref/set!</span>
<span class="p">(</span><span class="nf">slot-ref</span> <span class="nv">obj</span> <span class="ss">&#39;name</span><span class="p">)</span>
<span class="p">(</span><span class="nf">slot-set!</span> <span class="nv">obj</span> <span class="ss">&#39;name</span> <span class="nv">value</span><span class="p">)</span>

<span class="c1">;; or define the class with accessors</span>
<span class="p">(</span><span class="nf">define-class</span> <span class="nv">&lt;my-class&gt;</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">name</span> <span class="o">#</span><span class="nv">:accessor</span> <span class="nv">name</span><span class="p">))</span>
<span class="p">(</span><span class="nf">name</span> <span class="nv">obj</span><span class="p">)</span>
<span class="p">(</span><span class="k">set! </span><span class="p">(</span><span class="nf">name</span> <span class="nv">obj</span><span class="p">)</span> <span class="nv">value</span><span class="p">)</span>

<span class="c1">;; or use getters/setters to implement read/write-only slots</span>
<span class="p">(</span><span class="nf">define-class</span> <span class="nv">&lt;my-class&gt;</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">name</span> <span class="o">#</span><span class="nv">:getter</span> <span class="nv">name</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">age</span> <span class="o">#</span><span class="nv">:setter</span> <span class="nv">age</span><span class="p">))</span>
<span class="p">(</span><span class="nf">name</span> <span class="nv">obj</span><span class="p">)</span>
<span class="p">(</span><span class="k">set! </span><span class="p">(</span><span class="nf">age</span> <span class="nv">obj</span><span class="p">)</span> <span class="nv">value</span><span class="p">)</span>

<span class="c1">;; or implement getters/setters manually</span>
<span class="p">(</span><span class="nf">define-method</span> <span class="p">((</span><span class="nf">setter</span> <span class="nv">name</span><span class="p">)</span> <span class="p">(</span><span class="nf">obj</span> <span class="nv">&lt;my-class&gt;</span><span class="p">)</span> <span class="nv">value</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">string-match</span> <span class="s">&quot;[^-\\w0-9&#39;]&quot;</span> <span class="nv">value</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">warn</span> <span class="s">&quot;funny characters in name&quot;</span><span class="p">))</span>
        <span class="p">((</span><span class="nf">string-match</span> <span class="s">&quot;[0-9]&quot;</span> <span class="nv">value</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">warn</span> <span class="s">&quot;numbers in name&quot;</span><span class="p">))</span>
        <span class="p">((</span><span class="nb">not </span><span class="p">(</span><span class="nf">string-match</span> <span class="s">&quot;\\w+\\W+\\w+&quot;</span> <span class="nv">value</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">warn</span> <span class="s">&quot;prefer multiword names&quot;</span><span class="p">))</span>
        <span class="p">((</span><span class="nb">not </span><span class="p">(</span><span class="nf">string-match</span> <span class="s">&quot;\\w&quot;</span> <span class="nv">value</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">warn</span> <span class="s">&quot;name is blank&quot;</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">slot-set!</span> <span class="nv">obj</span> <span class="ss">&#39;name</span> <span class="p">(</span><span class="nf">string-downcase</span> <span class="nv">value</span><span class="p">)))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN716"
>Managing Class Data</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; override the initialize method</span>
<span class="p">(</span><span class="k">define </span><span class="nv">body-count</span> <span class="mi">0</span><span class="p">)</span>

<span class="p">(</span><span class="nf">define-method</span> <span class="p">(</span><span class="nf">initialize</span> <span class="p">(</span><span class="nf">obj</span> <span class="nv">&lt;person&gt;</span><span class="p">)</span> <span class="nv">initargs</span><span class="p">)</span>
  <span class="p">(</span><span class="k">set! </span><span class="nv">body-count</span> <span class="p">(</span><span class="mi">1</span><span class="nv">+</span> <span class="nv">body-count</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">next-method</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">people</span> <span class="o">&#39;</span><span class="p">())</span>
<span class="p">(</span><span class="k">do </span><span class="p">((</span><span class="nf">i</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">1</span><span class="nv">+</span> <span class="nv">i</span><span class="p">)))</span>
    <span class="p">((</span><span class="nb">&gt; </span><span class="nv">i</span> <span class="mi">10</span><span class="p">))</span>
  <span class="p">(</span><span class="k">set! </span><span class="nv">people</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;person&gt;</span><span class="p">)</span> <span class="nv">people</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;There are ~A people alive.\n&quot;</span> <span class="nv">body-count</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">him</span> <span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;person&gt;</span><span class="p">))</span>
<span class="p">(</span><span class="nf">slot-set!</span> <span class="nv">him</span> <span class="ss">&#39;gender</span> <span class="s">&quot;male&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">her</span> <span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;person&gt;</span><span class="p">))</span>
<span class="p">(</span><span class="nf">slot-set!</span> <span class="nv">her</span> <span class="ss">&#39;gender</span> <span class="s">&quot;female&quot;</span><span class="p">)</span>

<span class="c1">;; use the :class allocation method</span>
<span class="p">(</span><span class="nf">slot-set!</span> <span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;fixed-array&gt;</span><span class="p">)</span> <span class="ss">&#39;max-bounds</span> <span class="mi">100</span><span class="p">)</span> <span class="c1">; set for whole class</span>
<span class="p">(</span><span class="k">define </span><span class="nv">alpha</span> <span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;fixed-array&gt;</span><span class="p">))</span>
<span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;Bound on alpha is ~D\n&quot;</span> <span class="p">(</span><span class="nf">slot-ref</span> <span class="nv">alpha</span> <span class="ss">&#39;max-bounds</span><span class="p">))</span>
<span class="c1">;; 100</span>

<span class="p">(</span><span class="k">define </span><span class="nv">beta</span> <span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;fixed-array&gt;</span><span class="p">))</span>
<span class="p">(</span><span class="nf">slot-set!</span> <span class="nv">beta</span> <span class="ss">&#39;max-bounds</span> <span class="mi">50</span><span class="p">)</span>          <span class="c1">; still sets for whole class</span>
<span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;Bound on alpha is ~D\n&quot;</span> <span class="p">(</span><span class="nf">slot-ref</span> <span class="nv">alpha</span> <span class="ss">&#39;max-bounds</span><span class="p">))</span>
<span class="c1">;; 50</span>

<span class="c1">;; defined simply as</span>
<span class="p">(</span><span class="nf">define-class</span> <span class="nv">&lt;fixed-array&gt;</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">max-bounds</span> <span class="o">#</span><span class="nv">:init-value</span> <span class="mi">7</span> <span class="o">#</span><span class="nv">:allocation</span> <span class="o">#</span><span class="nv">:class</span><span class="p">))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN719"
>Using Classes as Structs</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; Guile classes are basically structs by definition.  If you don&#39;t care</span>
<span class="c1">;; about OO programming at all, you can use records, which are portable</span>
<span class="c1">;; across most Schemes.  This is, however, an OO chapter so I&#39;ll stick</span>
<span class="c1">;; to classes.</span>
<span class="p">(</span><span class="nf">define-class</span> <span class="nv">&lt;person&gt;</span> <span class="p">()</span> <span class="nv">name</span> <span class="nv">age</span> <span class="nv">peers</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">p</span> <span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;person&gt;</span><span class="p">))</span>
<span class="p">(</span><span class="nf">slot-set!</span> <span class="nv">p</span> <span class="ss">&#39;name</span> <span class="s">&quot;Jason Smythe&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">slot-set!</span> <span class="nv">p</span> <span class="ss">&#39;age</span> <span class="mi">13</span><span class="p">)</span>
<span class="p">(</span><span class="nf">slot-set!</span> <span class="nv">p</span> <span class="ss">&#39;peers</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;Wilbur&quot;</span> <span class="s">&quot;Ralph&quot;</span> <span class="s">&quot;Fred&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;At age ~D, ~A&#39;s first friend is ~A.\n&quot;</span>
        <span class="p">(</span><span class="nf">slot-ref</span> <span class="nv">p</span> <span class="ss">&#39;age</span><span class="p">)</span> <span class="p">(</span><span class="nf">slot-ref</span> <span class="nv">p</span> <span class="ss">&#39;name</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nf">slot-ref</span> <span class="nv">p</span> <span class="ss">&#39;peers</span><span class="p">)))</span>

<span class="c1">;; For type-checking and field validation, define the setters</span>
<span class="c1">;; accordingly.</span>
<span class="p">(</span><span class="nf">define-class</span> <span class="nv">&lt;person&gt;</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">name</span> <span class="o">#</span><span class="nv">:accessor</span> <span class="nv">name</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">age</span> <span class="o">#</span><span class="nv">:accessor</span> <span class="nv">age</span><span class="p">))</span>

<span class="p">(</span><span class="nf">define-method</span> <span class="p">((</span><span class="nf">setter</span> <span class="nv">age</span><span class="p">)</span> <span class="p">(</span><span class="nf">p</span> <span class="nv">&lt;person&gt;</span><span class="p">)</span> <span class="nv">a</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">not </span><span class="p">(</span><span class="nb">number? </span><span class="nv">a</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">warn</span> <span class="s">&quot;age&quot;</span> <span class="nv">a</span> <span class="s">&quot;isn&#39;t numeric&quot;</span><span class="p">))</span>
        <span class="p">((</span><span class="nb">&gt; </span><span class="nv">a</span> <span class="mi">150</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">warn</span> <span class="s">&quot;age&quot;</span> <span class="nv">a</span> <span class="s">&quot;is unreasonable&quot;</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">slot-set!</span> <span class="nv">p</span> <span class="ss">&#39;age</span> <span class="nv">a</span><span class="p">))</span>

<span class="p">(</span><span class="nf">define-class</span> <span class="nv">&lt;family&gt;</span> <span class="p">()</span>
  <span class="p">(</span><span class="nf">head</span> <span class="o">#</span><span class="nv">:init-form</span> <span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;person&gt;</span><span class="p">)</span> <span class="o">#</span><span class="nv">:accessor</span> <span class="nv">head</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">address</span> <span class="o">#</span><span class="nv">:init-value</span> <span class="s">&quot;&quot;</span> <span class="o">#</span><span class="nv">:accessor</span> <span class="nv">address</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">members</span> <span class="o">#</span><span class="nv">:init-value</span> <span class="o">&#39;</span><span class="p">()</span> <span class="o">#</span><span class="nv">:accessor</span> <span class="nv">members</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">folks</span> <span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;family&gt;</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="nv">dad</span> <span class="p">(</span><span class="nf">head</span> <span class="nv">folks</span><span class="p">))</span>
<span class="p">(</span><span class="k">set! </span><span class="p">(</span><span class="nf">name</span> <span class="nv">dad</span><span class="p">)</span> <span class="s">&quot;John&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">set! </span><span class="p">(</span><span class="nf">age</span> <span class="nv">dad</span><span class="p">)</span> <span class="mi">34</span><span class="p">)</span>

<span class="p">(</span><span class="nf">format</span> <span class="no">#t</span> <span class="s">&quot;~A&#39;s age is ~D\n&quot;</span> <span class="p">(</span><span class="nf">name</span> <span class="nv">dad</span><span class="p">)</span> <span class="p">(</span><span class="nf">age</span> <span class="nv">dad</span><span class="p">))</span>

<span class="c1">;; Macros are the usual way to add syntactic sugar</span>

<span class="c1">;; For all fields of the same type, let&#39;s use _ to mean the slot name in</span>
<span class="c1">;; the options expansion.</span>
<span class="p">(</span><span class="nf">define-macro</span> <span class="p">(</span><span class="nf">define-uniform-class</span> <span class="nv">name</span> <span class="nv">supers</span> <span class="nv">slots</span> <span class="o">.</span> <span class="nv">options</span><span class="p">)</span>
  <span class="o">`</span><span class="p">(</span><span class="nf">define-class</span> <span class="o">,</span><span class="nv">name</span> <span class="o">,</span><span class="nv">supers</span>
     <span class="o">,@</span><span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">s</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">s</span> <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">o</span><span class="p">)</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">eq? </span><span class="nv">o</span> <span class="ss">&#39;_</span><span class="p">)</span> <span class="nv">s</span> <span class="nv">o</span><span class="p">))</span> <span class="nv">options</span><span class="p">)))</span>
            <span class="nv">slots</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">define-uniform-class</span> <span class="nv">&lt;card&gt;</span> <span class="p">(</span><span class="nf">name</span> <span class="nv">color</span> <span class="nv">cost</span> <span class="nv">type</span> <span class="nv">release</span> <span class="nv">text</span><span class="p">)</span>
  <span class="o">#</span><span class="nv">:accessor</span> <span class="nv">_</span> <span class="o">#</span><span class="nv">:init-value</span> <span class="s">&quot;&quot;</span><span class="p">)</span>

<span class="c1">;; If you *really* wanted to enforce slot types you could use something</span>
<span class="c1">;; like the above with the custom setter.  To illustrate reversing</span>
<span class="c1">;; normal slot definition args, we&#39;ll reverse an init-value:</span>
<span class="p">(</span><span class="nf">define-macro</span> <span class="p">(</span><span class="nf">define-default-class</span> <span class="nv">name</span> <span class="nv">supers</span> <span class="o">.</span> <span class="nv">default&amp;slots</span><span class="p">)</span>
  <span class="o">`</span><span class="p">(</span><span class="nf">define-class</span> <span class="o">,</span><span class="nv">name</span> <span class="o">,</span><span class="nv">supers</span>
     <span class="o">,@</span><span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">d&amp;s</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">cadr </span><span class="nv">d&amp;s</span><span class="p">)</span>
                                <span class="o">#</span><span class="nv">:init-value</span> <span class="p">(</span><span class="nb">car </span><span class="nv">d&amp;s</span><span class="p">)</span>
                                <span class="o">#</span><span class="nv">:accessor</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">d&amp;s</span><span class="p">)))</span>
            <span class="nv">default&amp;slots</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">define-default-class</span> <span class="nv">hostent</span> <span class="p">()</span>
  <span class="p">(</span><span class="s">&quot;&quot;</span> <span class="nv">name</span><span class="p">)</span>
  <span class="p">(</span><span class="o">&#39;</span><span class="p">()</span> <span class="nv">aliases</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&quot;&quot;</span> <span class="nv">addrtype</span><span class="p">)</span>
  <span class="p">(</span><span class="mi">0</span>  <span class="nv">length</span><span class="p">)</span>
  <span class="p">(</span><span class="o">&#39;</span><span class="p">()</span> <span class="nv">addr-list</span><span class="p">))</span>

<span class="c1">;; Nothing special needed for Aliases - all names are equal</span>
<span class="p">(</span><span class="k">define </span><span class="nv">type</span> <span class="nv">addrtype</span><span class="p">)</span>
<span class="p">(</span><span class="nf">define-method</span> <span class="p">(</span><span class="nf">addr</span> <span class="p">(</span><span class="nf">h</span> <span class="nv">&lt;hostent&gt;</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nf">addr-list</span> <span class="nv">h</span><span class="p">)))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN722"
>Cloning Objects</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; A little more clear than the Perl, but not very useful.</span>
<span class="p">(</span><span class="k">define </span><span class="nv">obj1</span> <span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;some-class&gt;</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">obj2</span> <span class="p">(</span><span class="nf">make</span> <span class="p">(</span><span class="nf">class-of</span> <span class="nv">obj1</span><span class="p">)))</span>

<span class="c1">;; Use the shallow-clone or deep-clone methods to initialize from</span>
<span class="c1">;; another instance.</span>
<span class="p">(</span><span class="k">define </span><span class="nv">obj1</span> <span class="p">(</span><span class="nf">make</span> <span class="nv">&lt;widget&gt;</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">obj2</span> <span class="p">(</span><span class="nf">deep-clone</span> <span class="nv">obj1</span><span class="p">))</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN725"
>Calling Methods Indirectly</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; Use eval or a variant to convert from a symbol or string to the</span>
<span class="c1">;; actual method.  As shown in 13.5 above, methods are first class and</span>
<span class="c1">;; you&#39;d be more likely to store the actual method than the name in a</span>
<span class="c1">;; real Scheme program.</span>
<span class="p">(</span><span class="k">define </span><span class="nv">methname</span> <span class="s">&quot;flicker&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">apply-generic</span> <span class="p">(</span><span class="nf">eval-string</span> <span class="nv">methname</span><span class="p">)</span> <span class="nv">obj</span> <span class="mi">10</span><span class="p">)</span>

<span class="p">(</span><span class="nb">for-each </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">m</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="nv">obj</span> <span class="p">(</span><span class="nf">eval-string</span> <span class="nv">m</span><span class="p">)))</span>
          <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;start&quot;</span> <span class="s">&quot;run&quot;</span> <span class="s">&quot;stop&quot;</span><span class="p">))</span>

<span class="c1">;; really, don&#39;t do this...</span>
<span class="p">(</span><span class="k">define </span><span class="nv">methods</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;name&quot;</span> <span class="s">&quot;rank&quot;</span> <span class="s">&quot;serno&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">define </span><span class="nv">his-info</span>
  <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">m</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">m</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="p">(</span><span class="nf">eval-string</span> <span class="nv">m</span><span class="p">)</span> <span class="nv">obj</span><span class="p">)))</span>
       <span class="nv">methods</span><span class="p">))</span>

<span class="c1">;; same as this:</span>
<span class="p">(</span><span class="k">define </span><span class="nv">his-info</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">cons </span><span class="s">&quot;name&quot;</span> <span class="p">(</span><span class="nf">name</span> <span class="nv">obj</span><span class="p">))</span>
                       <span class="p">(</span><span class="nb">cons </span><span class="s">&quot;rank&quot;</span> <span class="p">(</span><span class="nf">rank</span> <span class="nv">obj</span><span class="p">))</span>
                       <span class="p">(</span><span class="nb">cons </span><span class="s">&quot;serno&quot;</span> <span class="p">(</span><span class="nf">serno</span> <span class="nv">obj</span><span class="p">))))</span>

<span class="c1">;; a closure works</span>
<span class="p">(</span><span class="k">define </span><span class="nv">fnref</span> <span class="p">(</span><span class="k">lambda </span><span class="nv">args</span> <span class="p">(</span><span class="nf">method</span> <span class="nv">obj</span> <span class="nv">args</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">fnref</span> <span class="mi">10</span> <span class="s">&quot;fred&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">method</span> <span class="nv">obj</span> <span class="mi">10</span> <span class="nv">fred</span><span class="p">)</span></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN728"
>Determining Subclass Membership</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><font color="#f5deb3" size="+1"><span class="c1"></span><span class="c1">;; use is-a?</span>
<span class="p">(</span><span class="nf">is-a?</span> <span class="nv">obj</span> <span class="nv">&lt;http-message&gt;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">is-a?</span> <span class="nv">&lt;http-response&gt;</span> <span class="nv">&lt;http-message&gt;</span><span class="p">)</span>
</pre></div>
</body>
</html></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN731"
>Writing an Inheritable Class</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN734"
>Accessing Overridden Methods</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN737"
>Generating Attribute Methods Using AUTOLOAD</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN740"
>Solving the Data Inheritance Problem</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN743"
>Coping with Circular Data Structures</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN746"
>Overloading Operators</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN749"
>Creating Magic Variables with tie</A
></H2
><TABLE
BORDER="0"
BGCOLOR="#2F4F4F"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
></PRE
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="packagesetc.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="dbaccess.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Packages, Libraries, and Modules</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Database Access</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>